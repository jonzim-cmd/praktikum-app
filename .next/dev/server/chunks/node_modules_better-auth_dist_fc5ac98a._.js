module.exports = [
"[project]/node_modules/better-auth/dist/dialect-D9ZUZA4J.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "n",
    ()=>getKyselyDatabaseType,
    "t",
    ()=>createKyselyAdapter
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$kysely$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/kysely/dist/esm/kysely.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$mssql$2f$mssql$2d$dialect$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/kysely/dist/esm/dialect/mssql/mssql-dialect.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$mysql$2f$mysql$2d$dialect$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/kysely/dist/esm/dialect/mysql/mysql-dialect.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$postgres$2f$postgres$2d$dialect$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/kysely/dist/esm/dialect/postgres/postgres-dialect.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$sqlite$2f$sqlite$2d$dialect$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/kysely/dist/esm/dialect/sqlite/sqlite-dialect.js [app-route] (ecmascript)");
;
//#region src/adapters/kysely-adapter/dialect.ts
function getKyselyDatabaseType(db) {
    if (!db) return null;
    if ("dialect" in db) return getKyselyDatabaseType(db.dialect);
    if ("createDriver" in db) {
        if (db instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$sqlite$2f$sqlite$2d$dialect$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["SqliteDialect"]) return "sqlite";
        if (db instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$mysql$2f$mysql$2d$dialect$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["MysqlDialect"]) return "mysql";
        if (db instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$postgres$2f$postgres$2d$dialect$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["PostgresDialect"]) return "postgres";
        if (db instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$mssql$2f$mssql$2d$dialect$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["MssqlDialect"]) return "mssql";
    }
    if ("aggregate" in db) return "sqlite";
    if ("getConnection" in db) return "mysql";
    if ("connect" in db) return "postgres";
    if ("fileControl" in db) return "sqlite";
    if ("open" in db && "close" in db && "prepare" in db) return "sqlite";
    return null;
}
const createKyselyAdapter = async (config)=>{
    const db = config.database;
    if (!db) return {
        kysely: null,
        databaseType: null,
        transaction: void 0
    };
    if ("db" in db) return {
        kysely: db.db,
        databaseType: db.type,
        transaction: db.transaction
    };
    if ("dialect" in db) return {
        kysely: new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$kysely$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Kysely"]({
            dialect: db.dialect
        }),
        databaseType: db.type,
        transaction: db.transaction
    };
    let dialect = void 0;
    const databaseType = getKyselyDatabaseType(db);
    if ("createDriver" in db) dialect = db;
    if ("aggregate" in db && !("createSession" in db)) dialect = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$sqlite$2f$sqlite$2d$dialect$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["SqliteDialect"]({
        database: db
    });
    if ("getConnection" in db) dialect = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$mysql$2f$mysql$2d$dialect$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["MysqlDialect"](db);
    if ("connect" in db) dialect = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$postgres$2f$postgres$2d$dialect$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["PostgresDialect"]({
        pool: db
    });
    if ("fileControl" in db) {
        const { BunSqliteDialect } = await __turbopack_context__.A("[project]/node_modules/better-auth/dist/bun-sqlite-dialect-C3P_ISb5.mjs [app-route] (ecmascript, async loader)");
        dialect = new BunSqliteDialect({
            database: db
        });
    }
    if ("createSession" in db && ("TURBOPACK compile-time value", "undefined") === "undefined") {
        let DatabaseSync = void 0;
        try {
            let nodeSqlite = "node:sqlite";
            ({ DatabaseSync } = await import(/* @vite-ignore */ /* webpackIgnore: true */ nodeSqlite));
        } catch (error) {
            if (error !== null && typeof error === "object" && "code" in error && error.code !== "ERR_UNKNOWN_BUILTIN_MODULE") throw error;
        }
        if (DatabaseSync && db instanceof DatabaseSync) {
            const { NodeSqliteDialect } = await __turbopack_context__.A("[project]/node_modules/better-auth/dist/node-sqlite-dialect-D6w8Ekdz.mjs [app-route] (ecmascript, async loader)");
            dialect = new NodeSqliteDialect({
                database: db
            });
        }
    }
    return {
        kysely: dialect ? new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$kysely$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Kysely"]({
            dialect
        }) : null,
        databaseType,
        transaction: void 0
    };
};
;
}),
"[project]/node_modules/better-auth/dist/get-model-name-D4DUV7S2.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "a",
    ()=>getAuthTables,
    "i",
    ()=>initGetDefaultModelName,
    "n",
    ()=>initGetFieldName,
    "r",
    ()=>initGetDefaultFieldName,
    "t",
    ()=>initGetModelName
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error-BhAKg8LX.mjs [app-route] (ecmascript) <export t as BetterAuthError>");
;
//#region src/db/get-tables.ts
const getAuthTables = (options)=>{
    const pluginSchema = (options.plugins ?? []).reduce((acc, plugin)=>{
        const schema = plugin.schema;
        if (!schema) return acc;
        for (const [key, value] of Object.entries(schema))acc[key] = {
            fields: {
                ...acc[key]?.fields,
                ...value.fields
            },
            modelName: value.modelName || key
        };
        return acc;
    }, {});
    const shouldAddRateLimitTable = options.rateLimit?.storage === "database";
    const rateLimitTable = {
        rateLimit: {
            modelName: options.rateLimit?.modelName || "rateLimit",
            fields: {
                key: {
                    type: "string",
                    fieldName: options.rateLimit?.fields?.key || "key"
                },
                count: {
                    type: "number",
                    fieldName: options.rateLimit?.fields?.count || "count"
                },
                lastRequest: {
                    type: "number",
                    bigint: true,
                    fieldName: options.rateLimit?.fields?.lastRequest || "lastRequest"
                }
            }
        }
    };
    const { user, session, account, ...pluginTables } = pluginSchema;
    const sessionTable = {
        session: {
            modelName: options.session?.modelName || "session",
            fields: {
                expiresAt: {
                    type: "date",
                    required: true,
                    fieldName: options.session?.fields?.expiresAt || "expiresAt"
                },
                token: {
                    type: "string",
                    required: true,
                    fieldName: options.session?.fields?.token || "token",
                    unique: true
                },
                createdAt: {
                    type: "date",
                    required: true,
                    fieldName: options.session?.fields?.createdAt || "createdAt",
                    defaultValue: ()=>/* @__PURE__ */ new Date()
                },
                updatedAt: {
                    type: "date",
                    required: true,
                    fieldName: options.session?.fields?.updatedAt || "updatedAt",
                    onUpdate: ()=>/* @__PURE__ */ new Date()
                },
                ipAddress: {
                    type: "string",
                    required: false,
                    fieldName: options.session?.fields?.ipAddress || "ipAddress"
                },
                userAgent: {
                    type: "string",
                    required: false,
                    fieldName: options.session?.fields?.userAgent || "userAgent"
                },
                userId: {
                    type: "string",
                    fieldName: options.session?.fields?.userId || "userId",
                    references: {
                        model: options.user?.modelName || "user",
                        field: "id",
                        onDelete: "cascade"
                    },
                    required: true,
                    index: true
                },
                ...session?.fields,
                ...options.session?.additionalFields
            },
            order: 2
        }
    };
    return {
        user: {
            modelName: options.user?.modelName || "user",
            fields: {
                name: {
                    type: "string",
                    required: true,
                    fieldName: options.user?.fields?.name || "name",
                    sortable: true
                },
                email: {
                    type: "string",
                    unique: true,
                    required: true,
                    fieldName: options.user?.fields?.email || "email",
                    sortable: true
                },
                emailVerified: {
                    type: "boolean",
                    defaultValue: false,
                    required: true,
                    fieldName: options.user?.fields?.emailVerified || "emailVerified",
                    input: false
                },
                image: {
                    type: "string",
                    required: false,
                    fieldName: options.user?.fields?.image || "image"
                },
                createdAt: {
                    type: "date",
                    defaultValue: ()=>/* @__PURE__ */ new Date(),
                    required: true,
                    fieldName: options.user?.fields?.createdAt || "createdAt"
                },
                updatedAt: {
                    type: "date",
                    defaultValue: ()=>/* @__PURE__ */ new Date(),
                    onUpdate: ()=>/* @__PURE__ */ new Date(),
                    required: true,
                    fieldName: options.user?.fields?.updatedAt || "updatedAt"
                },
                ...user?.fields,
                ...options.user?.additionalFields
            },
            order: 1
        },
        ...!options.secondaryStorage || options.session?.storeSessionInDatabase ? sessionTable : {},
        account: {
            modelName: options.account?.modelName || "account",
            fields: {
                accountId: {
                    type: "string",
                    required: true,
                    fieldName: options.account?.fields?.accountId || "accountId"
                },
                providerId: {
                    type: "string",
                    required: true,
                    fieldName: options.account?.fields?.providerId || "providerId"
                },
                userId: {
                    type: "string",
                    references: {
                        model: options.user?.modelName || "user",
                        field: "id",
                        onDelete: "cascade"
                    },
                    required: true,
                    fieldName: options.account?.fields?.userId || "userId",
                    index: true
                },
                accessToken: {
                    type: "string",
                    required: false,
                    fieldName: options.account?.fields?.accessToken || "accessToken"
                },
                refreshToken: {
                    type: "string",
                    required: false,
                    fieldName: options.account?.fields?.refreshToken || "refreshToken"
                },
                idToken: {
                    type: "string",
                    required: false,
                    fieldName: options.account?.fields?.idToken || "idToken"
                },
                accessTokenExpiresAt: {
                    type: "date",
                    required: false,
                    fieldName: options.account?.fields?.accessTokenExpiresAt || "accessTokenExpiresAt"
                },
                refreshTokenExpiresAt: {
                    type: "date",
                    required: false,
                    fieldName: options.account?.fields?.refreshTokenExpiresAt || "refreshTokenExpiresAt"
                },
                scope: {
                    type: "string",
                    required: false,
                    fieldName: options.account?.fields?.scope || "scope"
                },
                password: {
                    type: "string",
                    required: false,
                    fieldName: options.account?.fields?.password || "password"
                },
                createdAt: {
                    type: "date",
                    required: true,
                    fieldName: options.account?.fields?.createdAt || "createdAt",
                    defaultValue: ()=>/* @__PURE__ */ new Date()
                },
                updatedAt: {
                    type: "date",
                    required: true,
                    fieldName: options.account?.fields?.updatedAt || "updatedAt",
                    onUpdate: ()=>/* @__PURE__ */ new Date()
                },
                ...account?.fields,
                ...options.account?.additionalFields
            },
            order: 3
        },
        verification: {
            modelName: options.verification?.modelName || "verification",
            fields: {
                identifier: {
                    type: "string",
                    required: true,
                    fieldName: options.verification?.fields?.identifier || "identifier",
                    index: true
                },
                value: {
                    type: "string",
                    required: true,
                    fieldName: options.verification?.fields?.value || "value"
                },
                expiresAt: {
                    type: "date",
                    required: true,
                    fieldName: options.verification?.fields?.expiresAt || "expiresAt"
                },
                createdAt: {
                    type: "date",
                    required: true,
                    defaultValue: ()=>/* @__PURE__ */ new Date(),
                    fieldName: options.verification?.fields?.createdAt || "createdAt"
                },
                updatedAt: {
                    type: "date",
                    required: true,
                    defaultValue: ()=>/* @__PURE__ */ new Date(),
                    onUpdate: ()=>/* @__PURE__ */ new Date(),
                    fieldName: options.verification?.fields?.updatedAt || "updatedAt"
                }
            },
            order: 4
        },
        ...pluginTables,
        ...shouldAddRateLimitTable ? rateLimitTable : {}
    };
};
//#endregion
//#region src/adapters/adapter-factory/get-default-model-name.ts
const initGetDefaultModelName = ({ usePlural, schema })=>{
    /**
	* This function helps us get the default model name from the schema defined by devs.
	* Often times, the user will be using the `modelName` which could had been customized by the users.
	* This function helps us get the actual model name useful to match against the schema. (eg: schema[model])
	*
	* If it's still unclear what this does:
	*
	* 1. User can define a custom modelName.
	* 2. When using a custom modelName, doing something like `schema[model]` will not work.
	* 3. Using this function helps us get the actual model name based on the user's defined custom modelName.
	*/ const getDefaultModelName = (model)=>{
        if (usePlural && model.charAt(model.length - 1) === "s") {
            let pluralessModel = model.slice(0, -1);
            let m$1 = schema[pluralessModel] ? pluralessModel : void 0;
            if (!m$1) m$1 = Object.entries(schema).find(([_, f])=>f.modelName === pluralessModel)?.[0];
            if (m$1) return m$1;
        }
        let m = schema[model] ? model : void 0;
        if (!m) m = Object.entries(schema).find(([_, f])=>f.modelName === model)?.[0];
        if (!m) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`Model "${model}" not found in schema`);
        return m;
    };
    return getDefaultModelName;
};
//#endregion
//#region src/adapters/adapter-factory/get-default-field-name.ts
const initGetDefaultFieldName = ({ schema, usePlural })=>{
    const getDefaultModelName = initGetDefaultModelName({
        schema,
        usePlural
    });
    /**
	* This function helps us get the default field name from the schema defined by devs.
	* Often times, the user will be using the `fieldName` which could had been customized by the users.
	* This function helps us get the actual field name useful to match against the schema. (eg: schema[model].fields[field])
	*
	* If it's still unclear what this does:
	*
	* 1. User can define a custom fieldName.
	* 2. When using a custom fieldName, doing something like `schema[model].fields[field]` will not work.
	*/ const getDefaultFieldName = ({ field, model: unsafeModel })=>{
        if (field === "id" || field === "_id") return "id";
        const model = getDefaultModelName(unsafeModel);
        let f = schema[model]?.fields[field];
        if (!f) {
            const result = Object.entries(schema[model].fields).find(([_, f$1])=>f$1.fieldName === field);
            if (result) {
                f = result[1];
                field = result[0];
            }
        }
        if (!f) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`Field ${field} not found in model ${model}`);
        return field;
    };
    return getDefaultFieldName;
};
//#endregion
//#region src/adapters/adapter-factory/get-field-name.ts
const initGetFieldName = ({ schema, usePlural })=>{
    const getDefaultModelName = initGetDefaultModelName({
        schema,
        usePlural
    });
    const getDefaultFieldName = initGetDefaultFieldName({
        schema,
        usePlural
    });
    /**
	* Get the field name which is expected to be saved in the database based on the user's schema.
	*
	* This function is useful if you need to save the field name to the database.
	*
	* For example, if the user has defined a custom field name for the `user` model, then you can use this function to get the actual field name from the schema.
	*/ function getFieldName({ model: modelName, field: fieldName }) {
        const model = getDefaultModelName(modelName);
        const field = getDefaultFieldName({
            model,
            field: fieldName
        });
        return schema[model]?.fields[field]?.fieldName || field;
    }
    return getFieldName;
};
//#endregion
//#region src/adapters/adapter-factory/get-model-name.ts
const initGetModelName = ({ usePlural, schema })=>{
    const getDefaultModelName = initGetDefaultModelName({
        schema,
        usePlural
    });
    /**
	* Users can overwrite the default model of some tables. This function helps find the correct model name.
	* Furthermore, if the user passes `usePlural` as true in their adapter config,
	* then we should return the model name ending with an `s`.
	*/ const getModelName = (model)=>{
        const defaultModelKey = getDefaultModelName(model);
        if (schema && schema[defaultModelKey] && schema[defaultModelKey].modelName !== model) return usePlural ? `${schema[defaultModelKey].modelName}s` : schema[defaultModelKey].modelName;
        return usePlural ? `${model}s` : model;
    };
    return getModelName;
};
;
}),
"[project]/node_modules/better-auth/dist/crypto-CFUhAR9W.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "a",
    ()=>verifyPassword,
    "c",
    ()=>symmetricEncodeJWT,
    "i",
    ()=>hashPassword,
    "l",
    ()=>verifyJWT,
    "n",
    ()=>symmetricEncrypt,
    "o",
    ()=>signJWT,
    "r",
    ()=>generateRandomString,
    "s",
    ()=>symmetricDecodeJWT,
    "t",
    ()=>symmetricDecrypt,
    "u",
    ()=>constantTimeEqual
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error-BhAKg8LX.mjs [app-route] (ecmascript) <export t as BetterAuthError>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/hash.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$ciphers$2f$chacha$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@noble/ciphers/chacha.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$ciphers$2f$utils$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@noble/ciphers/utils.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$hashes$2f$hkdf$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@noble/hashes/hkdf.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$hashes$2f$sha2$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@noble/hashes/sha2.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$encrypt$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/jwt/encrypt.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$sign$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/jwt/sign.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$util$2f$base64url$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__base64url$3e$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/util/base64url.js [app-route] (ecmascript) <export * as base64url>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwk$2f$thumbprint$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/jwk/thumbprint.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$decrypt$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/jwt/decrypt.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$verify$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/jwt/verify.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hex$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/hex.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$hashes$2f$scrypt$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@noble/hashes/scrypt.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$hashes$2f$utils$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@noble/hashes/utils.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$random$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/random.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
//#region src/crypto/buffer.ts
/**
* Compare two buffers in constant time.
*/ function constantTimeEqual(a, b) {
    if (typeof a === "string") a = new TextEncoder().encode(a);
    if (typeof b === "string") b = new TextEncoder().encode(b);
    const aBuffer = new Uint8Array(a);
    const bBuffer = new Uint8Array(b);
    let c = aBuffer.length ^ bBuffer.length;
    const length = Math.max(aBuffer.length, bBuffer.length);
    for(let i = 0; i < length; i++)c |= (i < aBuffer.length ? aBuffer[i] : 0) ^ (i < bBuffer.length ? bBuffer[i] : 0);
    return c === 0;
}
//#endregion
//#region src/crypto/jwt.ts
async function signJWT(payload, secret, expiresIn = 3600) {
    return await new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$sign$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["SignJWT"](payload).setProtectedHeader({
        alg: "HS256"
    }).setIssuedAt().setExpirationTime(Math.floor(Date.now() / 1e3) + expiresIn).sign(new TextEncoder().encode(secret));
}
async function verifyJWT(token, secret) {
    try {
        return (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$verify$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["jwtVerify"])(token, new TextEncoder().encode(secret))).payload;
    } catch (error) {
        return null;
    }
}
const info = new Uint8Array([
    66,
    101,
    116,
    116,
    101,
    114,
    65,
    117,
    116,
    104,
    46,
    106,
    115,
    32,
    71,
    101,
    110,
    101,
    114,
    97,
    116,
    101,
    100,
    32,
    69,
    110,
    99,
    114,
    121,
    112,
    116,
    105,
    111,
    110,
    32,
    75,
    101,
    121
]);
const now = ()=>Date.now() / 1e3 | 0;
const alg = "dir";
const enc = "A256CBC-HS512";
async function symmetricEncodeJWT(payload, secret, salt, expiresIn = 3600) {
    const encryptionSecret = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$hashes$2f$hkdf$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hkdf"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$hashes$2f$sha2$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sha256"], new TextEncoder().encode(secret), new TextEncoder().encode(salt), info, 64);
    const thumbprint = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwk$2f$thumbprint$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["calculateJwkThumbprint"])({
        kty: "oct",
        k: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$util$2f$base64url$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__base64url$3e$__["base64url"].encode(encryptionSecret)
    }, "sha256");
    return await new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$encrypt$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["EncryptJWT"](payload).setProtectedHeader({
        alg,
        enc,
        kid: thumbprint
    }).setIssuedAt().setExpirationTime(now() + expiresIn).setJti(crypto.randomUUID()).encrypt(encryptionSecret);
}
async function symmetricDecodeJWT(token, secret, salt) {
    if (!token) return null;
    try {
        const { payload } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$decrypt$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["jwtDecrypt"])(token, async ({ kid })=>{
            const encryptionSecret = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$hashes$2f$hkdf$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hkdf"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$hashes$2f$sha2$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sha256"], new TextEncoder().encode(secret), new TextEncoder().encode(salt), info, 64);
            if (kid === void 0) return encryptionSecret;
            if (kid === await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwk$2f$thumbprint$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["calculateJwkThumbprint"])({
                kty: "oct",
                k: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$util$2f$base64url$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__base64url$3e$__["base64url"].encode(encryptionSecret)
            }, "sha256")) return encryptionSecret;
            throw new Error("no matching decryption secret");
        }, {
            clockTolerance: 15,
            keyManagementAlgorithms: [
                alg
            ],
            contentEncryptionAlgorithms: [
                enc,
                "A256GCM"
            ]
        });
        return payload;
    } catch (error) {
        return null;
    }
}
//#endregion
//#region src/crypto/password.ts
const config = {
    N: 16384,
    r: 16,
    p: 1,
    dkLen: 64
};
async function generateKey(password, salt) {
    return await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$hashes$2f$scrypt$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["scryptAsync"])(password.normalize("NFKC"), salt, {
        N: config.N,
        p: config.p,
        r: config.r,
        dkLen: config.dkLen,
        maxmem: 128 * config.N * config.r * 2
    });
}
const hashPassword = async (password)=>{
    const salt = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hex$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hex"].encode(crypto.getRandomValues(new Uint8Array(16)));
    const key = await generateKey(password, salt);
    return `${salt}:${__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hex$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hex"].encode(key)}`;
};
const verifyPassword = async ({ hash, password })=>{
    const [salt, key] = hash.split(":");
    if (!salt || !key) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("Invalid password hash");
    return constantTimeEqual(await generateKey(password, salt), (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$hashes$2f$utils$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hexToBytes"])(key));
};
//#endregion
//#region src/crypto/random.ts
const generateRandomString = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$random$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createRandomStringGenerator"])("a-z", "0-9", "A-Z", "-_");
//#endregion
//#region src/crypto/index.ts
const symmetricEncrypt = async ({ key, data })=>{
    const keyAsBytes = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createHash"])("SHA-256").digest(key);
    const dataAsBytes = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$ciphers$2f$utils$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["utf8ToBytes"])(data);
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$ciphers$2f$utils$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["bytesToHex"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$ciphers$2f$utils$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["managedNonce"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$ciphers$2f$chacha$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["xchacha20poly1305"])(new Uint8Array(keyAsBytes)).encrypt(dataAsBytes));
};
const symmetricDecrypt = async ({ key, data })=>{
    const keyAsBytes = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createHash"])("SHA-256").digest(key);
    const dataAsBytes = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$ciphers$2f$utils$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hexToBytes"])(data);
    const chacha = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$ciphers$2f$utils$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["managedNonce"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$ciphers$2f$chacha$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["xchacha20poly1305"])(new Uint8Array(keyAsBytes));
    return new TextDecoder().decode(chacha.decrypt(dataAsBytes));
};
;
}),
"[project]/node_modules/better-auth/dist/utils-db7gNqd-.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "a",
    ()=>getOAuthState,
    "i",
    ()=>parseState,
    "n",
    ()=>HIDE_METADATA,
    "r",
    ()=>generateState,
    "t",
    ()=>generateId
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/crypto-CFUhAR9W.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/context/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__a__as__defineRequestState$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/context-DgQ9XGBl.mjs [app-route] (ecmascript) <export a as defineRequestState>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/external.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$random$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/random.mjs [app-route] (ecmascript)");
;
;
;
;
;
//#region src/api/middlewares/oauth.ts
const { get: getOAuthState, set: setOAuthState } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__a__as__defineRequestState$3e$__["defineRequestState"])(()=>null);
//#endregion
//#region src/oauth2/state.ts
async function generateState(c, link, additionalData) {
    const callbackURL = c.body?.callbackURL || c.context.options.baseURL;
    if (!callbackURL) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "callbackURL is required"
    });
    const codeVerifier = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(128);
    const state = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(32);
    const storeStateStrategy = c.context.oauthConfig?.storeStateStrategy || "cookie";
    const stateData = {
        ...additionalData ? additionalData : {},
        callbackURL,
        codeVerifier,
        errorURL: c.body?.errorCallbackURL,
        newUserURL: c.body?.newUserCallbackURL,
        link,
        expiresAt: Date.now() + 600 * 1e3,
        requestSignUp: c.body?.requestSignUp
    };
    await setOAuthState(stateData);
    if (storeStateStrategy === "cookie") {
        const encryptedData = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])({
            key: c.context.secret,
            data: JSON.stringify(stateData)
        });
        const stateCookie$1 = c.context.createAuthCookie("oauth_state", {
            maxAge: 600 * 1e3
        });
        c.setCookie(stateCookie$1.name, encryptedData, stateCookie$1.attributes);
        return {
            state,
            codeVerifier
        };
    }
    const stateCookie = c.context.createAuthCookie("state", {
        maxAge: 300 * 1e3
    });
    await c.setSignedCookie(stateCookie.name, state, c.context.secret, stateCookie.attributes);
    const expiresAt = /* @__PURE__ */ new Date();
    expiresAt.setMinutes(expiresAt.getMinutes() + 10);
    const verification = await c.context.internalAdapter.createVerificationValue({
        value: JSON.stringify(stateData),
        identifier: state,
        expiresAt
    });
    if (!verification) {
        c.context.logger.error("Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database");
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
            message: "Unable to create verification"
        });
    }
    return {
        state: verification.identifier,
        codeVerifier
    };
}
async function parseState(c) {
    const state = c.query.state || c.body.state;
    const storeStateStrategy = c.context.oauthConfig.storeStateStrategy || "cookie";
    const stateDataSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["looseObject"]({
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
        codeVerifier: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
        errorURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional(),
        newUserURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional(),
        expiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"](),
        link: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
            email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
            userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].string()
        }).optional(),
        requestSignUp: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().optional()
    });
    let parsedData;
    if (storeStateStrategy === "cookie") {
        const stateCookie = c.context.createAuthCookie("oauth_state");
        const encryptedData = c.getCookie(stateCookie.name);
        if (!encryptedData) {
            c.context.logger.error("State Mismatch. OAuth state cookie not found", {
                state
            });
            const errorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;
            throw c.redirect(`${errorURL}?error=please_restart_the_process`);
        }
        try {
            const decryptedData = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                key: c.context.secret,
                data: encryptedData
            });
            parsedData = stateDataSchema.parse(JSON.parse(decryptedData));
        } catch (error) {
            c.context.logger.error("Failed to decrypt or parse OAuth state cookie", {
                error
            });
            const errorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;
            throw c.redirect(`${errorURL}?error=please_restart_the_process`);
        }
        c.setCookie(stateCookie.name, "", {
            maxAge: 0
        });
    } else {
        const data = await c.context.internalAdapter.findVerificationValue(state);
        if (!data) {
            c.context.logger.error("State Mismatch. Verification not found", {
                state
            });
            const errorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;
            throw c.redirect(`${errorURL}?error=please_restart_the_process`);
        }
        parsedData = stateDataSchema.parse(JSON.parse(data.value));
        const stateCookie = c.context.createAuthCookie("state");
        const stateCookieValue = await c.getSignedCookie(stateCookie.name, c.context.secret);
        if (!c.context.oauthConfig?.skipStateCookieCheck && (!stateCookieValue || stateCookieValue !== state)) {
            const errorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;
            throw c.redirect(`${errorURL}?error=state_mismatch`);
        }
        c.setCookie(stateCookie.name, "", {
            maxAge: 0
        });
        await c.context.internalAdapter.deleteVerificationValue(data.id);
    }
    if (!parsedData.errorURL) parsedData.errorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;
    if (parsedData.expiresAt < Date.now()) {
        const errorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;
        throw c.redirect(`${errorURL}?error=please_restart_the_process`);
    }
    if (parsedData) await setOAuthState(parsedData);
    return parsedData;
}
//#endregion
//#region src/utils/hide-metadata.ts
const HIDE_METADATA = {
    isAction: false
};
//#endregion
//#region src/utils/id.ts
const generateId = (size)=>{
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$random$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createRandomStringGenerator"])("a-z", "A-Z", "0-9")(size || 32);
};
;
}),
"[project]/node_modules/better-auth/dist/schema-Bb7wzeK_.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "a",
    ()=>parseInputData,
    "c",
    ()=>parseUserInput,
    "i",
    ()=>parseAdditionalUserInput,
    "l",
    ()=>parseUserOutput,
    "n",
    ()=>parseAccountInput,
    "o",
    ()=>parseSessionInput,
    "r",
    ()=>parseAccountOutput,
    "s",
    ()=>parseSessionOutput,
    "t",
    ()=>mergeSchema,
    "u",
    ()=>getDate
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript)");
;
//#region src/utils/date.ts
const getDate = (span, unit = "ms")=>{
    return new Date(Date.now() + (unit === "sec" ? span * 1e3 : span));
};
//#endregion
//#region src/db/schema.ts
const cache = /* @__PURE__ */ new WeakMap();
function parseOutputData(data, schema) {
    const fields = schema.fields;
    const parsedData = {};
    for(const key in data){
        const field = fields[key];
        if (!field) {
            parsedData[key] = data[key];
            continue;
        }
        if (field.returned === false) continue;
        parsedData[key] = data[key];
    }
    return parsedData;
}
function getAllFields(options, table) {
    if (!cache.has(options)) cache.set(options, /* @__PURE__ */ new Map());
    const tableCache = cache.get(options);
    if (tableCache.has(table)) return tableCache.get(table);
    let schema = {
        ...table === "user" ? options.user?.additionalFields : {},
        ...table === "session" ? options.session?.additionalFields : {}
    };
    for (const plugin of options.plugins || [])if (plugin.schema && plugin.schema[table]) schema = {
        ...schema,
        ...plugin.schema[table].fields
    };
    cache.get(options).set(table, schema);
    return schema;
}
function parseUserOutput(options, user) {
    return {
        ...parseOutputData(user, {
            fields: getAllFields(options, "user")
        }),
        id: user.id
    };
}
function parseAccountOutput(options, account) {
    return parseOutputData(account, {
        fields: getAllFields(options, "account")
    });
}
function parseSessionOutput(options, session) {
    return parseOutputData(session, {
        fields: getAllFields(options, "session")
    });
}
function parseInputData(data, schema) {
    const action = schema.action || "create";
    const fields = schema.fields;
    const parsedData = Object.assign(Object.create(null), null);
    for(const key in fields){
        if (key in data) {
            if (fields[key].input === false) {
                if (fields[key].defaultValue !== void 0) {
                    if (action !== "update") {
                        parsedData[key] = fields[key].defaultValue;
                        continue;
                    }
                }
                if (data[key]) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: `${key} is not allowed to be set`
                });
                continue;
            }
            if (fields[key].validator?.input && data[key] !== void 0) {
                parsedData[key] = fields[key].validator.input["~standard"].validate(data[key]);
                continue;
            }
            if (fields[key].transform?.input && data[key] !== void 0) {
                parsedData[key] = fields[key].transform?.input(data[key]);
                continue;
            }
            parsedData[key] = data[key];
            continue;
        }
        if (fields[key].defaultValue !== void 0 && action === "create") {
            if (typeof fields[key].defaultValue === "function") {
                parsedData[key] = fields[key].defaultValue();
                continue;
            }
            parsedData[key] = fields[key].defaultValue;
            continue;
        }
        if (fields[key].required && action === "create") throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: `${key} is required`
        });
    }
    return parsedData;
}
function parseUserInput(options, user = {}, action) {
    return parseInputData(user, {
        fields: getAllFields(options, "user"),
        action
    });
}
function parseAdditionalUserInput(options, user) {
    const schema = getAllFields(options, "user");
    return parseInputData(user || {}, {
        fields: schema
    });
}
function parseAccountInput(options, account) {
    return parseInputData(account, {
        fields: getAllFields(options, "account")
    });
}
function parseSessionInput(options, session) {
    return parseInputData(session, {
        fields: getAllFields(options, "session")
    });
}
function mergeSchema(schema, newSchema) {
    if (!newSchema) return schema;
    for(const table in newSchema){
        const newModelName = newSchema[table]?.modelName;
        if (newModelName) schema[table].modelName = newModelName;
        for(const field in schema[table].fields){
            const newField = newSchema[table]?.fields?.[field];
            if (!newField) continue;
            schema[table].fields[field].fieldName = newField;
        }
    }
    return schema;
}
;
}),
"[project]/node_modules/better-auth/dist/get-request-ip-D6st-mto.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>getIp
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__d__as__isDevelopment$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env-8yWFh7b8.mjs [app-route] (ecmascript) <export d as isDevelopment>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__p__as__isTest$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env-8yWFh7b8.mjs [app-route] (ecmascript) <export p as isTest>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
;
;
//#region src/utils/get-request-ip.ts
const LOCALHOST_IP = "127.0.0.1";
function getIp(req, options) {
    if (options.advanced?.ipAddress?.disableIpTracking) return null;
    if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__p__as__isTest$3e$__["isTest"])() || (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__d__as__isDevelopment$3e$__["isDevelopment"])()) return LOCALHOST_IP;
    const headers = "headers" in req ? req.headers : req;
    const ipHeaders = options.advanced?.ipAddress?.ipAddressHeaders || [
        "x-forwarded-for"
    ];
    for (const key of ipHeaders){
        const value = "get" in headers ? headers.get(key) : headers[key];
        if (typeof value === "string") {
            const ip = value.split(",")[0].trim();
            if (isValidIP(ip)) return ip;
        }
    }
    return null;
}
function isValidIP(ip) {
    if (__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ipv4"]().safeParse(ip).success) return true;
    if (__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ipv6"]().safeParse(ip).success) return true;
    return false;
}
;
}),
"[project]/node_modules/better-auth/dist/json-CnHxKYpj.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>safeJSONParse
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__logger$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env-8yWFh7b8.mjs [app-route] (ecmascript) <export i as logger>");
;
//#region src/utils/json.ts
function safeJSONParse(data) {
    function reviver(_, value) {
        if (typeof value === "string") {
            if (/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(value)) {
                const date = new Date(value);
                if (!isNaN(date.getTime())) return date;
            }
        }
        return value;
    }
    try {
        if (typeof data !== "string") return data;
        return JSON.parse(data, reviver);
    } catch (e) {
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__logger$3e$__["logger"].error("Error parsing JSON", {
            error: e
        });
        return null;
    }
}
;
}),
"[project]/node_modules/better-auth/dist/get-migration-Bf0TuCzm.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "a",
    ()=>createInternalAdapter,
    "c",
    ()=>convertToDB,
    "d",
    ()=>getBaseAdapter,
    "i",
    ()=>toZodSchema,
    "l",
    ()=>createFieldAttribute,
    "n",
    ()=>matchType,
    "o",
    ()=>getWithHooks,
    "r",
    ()=>getSchema,
    "s",
    ()=>convertFromDB,
    "t",
    ()=>getMigrations,
    "u",
    ()=>getAdapter
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$dialect$2d$D9ZUZA4J$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/dialect-D9ZUZA4J.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/get-model-name-D4DUV7S2.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2d$db7gNqd$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/utils-db7gNqd-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/schema-Bb7wzeK_.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$request$2d$ip$2d$D6st$2d$mto$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/get-request-ip-D6st-mto.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/json-CnHxKYpj.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/context/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/context-DgQ9XGBl.mjs [app-route] (ecmascript) <export t as getCurrentAdapter>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__u__as__getCurrentAuthContext$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/context-DgQ9XGBl.mjs [app-route] (ecmascript) <export u as getCurrentAuthContext>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__runWithTransaction$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/context-DgQ9XGBl.mjs [app-route] (ecmascript) <export i as runWithTransaction>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__createLogger$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env-8yWFh7b8.mjs [app-route] (ecmascript) <export n as createLogger>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__logger$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env-8yWFh7b8.mjs [app-route] (ecmascript) <export i as logger>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error-BhAKg8LX.mjs [app-route] (ecmascript) <export t as BetterAuthError>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$raw$2d$builder$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/kysely/dist/esm/raw-builder/sql.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/index.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
//#region src/db/adapter-base.ts
async function getBaseAdapter(options, handleDirectDatabase) {
    let adapter;
    if (!options.database) {
        const tables = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["a"])(options);
        const memoryDB = Object.keys(tables).reduce((acc, key)=>{
            acc[key] = [];
            return acc;
        }, {});
        const { memoryAdapter } = await __turbopack_context__.A("[project]/node_modules/better-auth/dist/adapters/memory-adapter/index.mjs [app-route] (ecmascript, async loader)");
        adapter = memoryAdapter(memoryDB)(options);
    } else if (typeof options.database === "function") adapter = options.database(options);
    else adapter = await handleDirectDatabase(options);
    if (!adapter.transaction) {
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__logger$3e$__["logger"].warn("Adapter does not correctly implement transaction function, patching it automatically. Please update your adapter implementation.");
        adapter.transaction = async (cb)=>{
            return cb(adapter);
        };
    }
    return adapter;
}
//#endregion
//#region src/db/adapter-kysely.ts
async function getAdapter(options) {
    return getBaseAdapter(options, async (opts)=>{
        const { createKyselyAdapter: createKyselyAdapter$1 } = await __turbopack_context__.A("[project]/node_modules/better-auth/dist/adapters/kysely-adapter/index.mjs [app-route] (ecmascript, async loader)");
        const { kysely, databaseType, transaction } = await createKyselyAdapter$1(opts);
        if (!kysely) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("Failed to initialize database adapter");
        const { kyselyAdapter } = await __turbopack_context__.A("[project]/node_modules/better-auth/dist/adapters/kysely-adapter/index.mjs [app-route] (ecmascript, async loader)");
        return kyselyAdapter(kysely, {
            type: databaseType || "sqlite",
            debugLogs: opts.database && "debugLogs" in opts.database ? opts.database.debugLogs : false,
            transaction
        })(opts);
    });
}
//#endregion
//#region src/db/field.ts
const createFieldAttribute = (type, config)=>{
    return {
        type,
        ...config
    };
};
//#endregion
//#region src/db/field-converter.ts
function convertToDB(fields, values) {
    let result = values.id ? {
        id: values.id
    } : {};
    for(const key in fields){
        const field = fields[key];
        const value = values[key];
        if (value === void 0) continue;
        result[field.fieldName || key] = value;
    }
    return result;
}
function convertFromDB(fields, values) {
    if (!values) return null;
    let result = {
        id: values.id
    };
    for (const [key, value] of Object.entries(fields))result[key] = values[value.fieldName || key];
    return result;
}
//#endregion
//#region src/db/with-hooks.ts
function getWithHooks(adapter, ctx) {
    const hooks = ctx.hooks;
    async function createWithHooks(data, model, customCreateFn) {
        const context = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__u__as__getCurrentAuthContext$3e$__["getCurrentAuthContext"])();
        let actualData = data;
        for (const hook of hooks || []){
            const toRun = hook[model]?.create?.before;
            if (toRun) {
                const result = await toRun(actualData, context);
                if (result === false) return null;
                if (typeof result === "object" && "data" in result) actualData = {
                    ...actualData,
                    ...result.data
                };
            }
        }
        const customCreated = customCreateFn ? await customCreateFn.fn(actualData) : null;
        const created = !customCreateFn || customCreateFn.executeMainFn ? await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).create({
            model,
            data: actualData,
            forceAllowId: true
        }) : customCreated;
        for (const hook of hooks || []){
            const toRun = hook[model]?.create?.after;
            if (toRun) await toRun(created, context);
        }
        return created;
    }
    async function updateWithHooks(data, where, model, customUpdateFn) {
        const context = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__u__as__getCurrentAuthContext$3e$__["getCurrentAuthContext"])();
        let actualData = data;
        for (const hook of hooks || []){
            const toRun = hook[model]?.update?.before;
            if (toRun) {
                const result = await toRun(data, context);
                if (result === false) return null;
                if (typeof result === "object" && "data" in result) actualData = {
                    ...actualData,
                    ...result.data
                };
            }
        }
        const customUpdated = customUpdateFn ? await customUpdateFn.fn(actualData) : null;
        const updated = !customUpdateFn || customUpdateFn.executeMainFn ? await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).update({
            model,
            update: actualData,
            where
        }) : customUpdated;
        for (const hook of hooks || []){
            const toRun = hook[model]?.update?.after;
            if (toRun) await toRun(updated, context);
        }
        return updated;
    }
    async function updateManyWithHooks(data, where, model, customUpdateFn) {
        const context = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__u__as__getCurrentAuthContext$3e$__["getCurrentAuthContext"])();
        let actualData = data;
        for (const hook of hooks || []){
            const toRun = hook[model]?.update?.before;
            if (toRun) {
                const result = await toRun(data, context);
                if (result === false) return null;
                if (typeof result === "object" && "data" in result) actualData = {
                    ...actualData,
                    ...result.data
                };
            }
        }
        const customUpdated = customUpdateFn ? await customUpdateFn.fn(actualData) : null;
        const updated = !customUpdateFn || customUpdateFn.executeMainFn ? await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).updateMany({
            model,
            update: actualData,
            where
        }) : customUpdated;
        for (const hook of hooks || []){
            const toRun = hook[model]?.update?.after;
            if (toRun) await toRun(updated, context);
        }
        return updated;
    }
    async function deleteWithHooks(where, model, customDeleteFn) {
        const context = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__u__as__getCurrentAuthContext$3e$__["getCurrentAuthContext"])();
        let entityToDelete = null;
        try {
            entityToDelete = (await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).findMany({
                model,
                where,
                limit: 1
            }))[0] || null;
        } catch (error) {}
        if (entityToDelete) for (const hook of hooks || []){
            const toRun = hook[model]?.delete?.before;
            if (toRun) {
                if (await toRun(entityToDelete, context) === false) return null;
            }
        }
        const customDeleted = customDeleteFn ? await customDeleteFn.fn(where) : null;
        const deleted = !customDeleteFn || customDeleteFn.executeMainFn ? await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).delete({
            model,
            where
        }) : customDeleted;
        if (entityToDelete) for (const hook of hooks || []){
            const toRun = hook[model]?.delete?.after;
            if (toRun) await toRun(entityToDelete, context);
        }
        return deleted;
    }
    async function deleteManyWithHooks(where, model, customDeleteFn) {
        const context = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__u__as__getCurrentAuthContext$3e$__["getCurrentAuthContext"])();
        let entitiesToDelete = [];
        try {
            entitiesToDelete = await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).findMany({
                model,
                where
            });
        } catch (error) {}
        for (const entity of entitiesToDelete)for (const hook of hooks || []){
            const toRun = hook[model]?.delete?.before;
            if (toRun) {
                if (await toRun(entity, context) === false) return null;
            }
        }
        const customDeleted = customDeleteFn ? await customDeleteFn.fn(where) : null;
        const deleted = !customDeleteFn || customDeleteFn.executeMainFn ? await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).deleteMany({
            model,
            where
        }) : customDeleted;
        for (const entity of entitiesToDelete)for (const hook of hooks || []){
            const toRun = hook[model]?.delete?.after;
            if (toRun) await toRun(entity, context);
        }
        return deleted;
    }
    return {
        createWithHooks,
        updateWithHooks,
        updateManyWithHooks,
        deleteWithHooks,
        deleteManyWithHooks
    };
}
//#endregion
//#region src/db/internal-adapter.ts
const createInternalAdapter = (adapter, ctx)=>{
    const logger$1 = ctx.logger;
    const options = ctx.options;
    const secondaryStorage = options.secondaryStorage;
    const sessionExpiration = options.session?.expiresIn || 3600 * 24 * 7;
    const { createWithHooks, updateWithHooks, updateManyWithHooks, deleteWithHooks, deleteManyWithHooks } = getWithHooks(adapter, ctx);
    async function refreshUserSessions(user) {
        if (!secondaryStorage) return;
        const listRaw = await secondaryStorage.get(`active-sessions-${user.id}`);
        if (!listRaw) return;
        const now = Date.now();
        const validSessions = ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(listRaw) || []).filter((s)=>s.expiresAt > now);
        await Promise.all(validSessions.map(async ({ token })=>{
            const cached = await secondaryStorage.get(token);
            if (!cached) return;
            const parsed = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(cached);
            if (!parsed) return;
            const sessionTTL = Math.max(Math.floor(new Date(parsed.session.expiresAt).getTime() - now) / 1e3, 0);
            await secondaryStorage.set(token, JSON.stringify({
                session: parsed.session,
                user
            }), Math.floor(sessionTTL));
        }));
    }
    return {
        createOAuthUser: async (user, account)=>{
            return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__runWithTransaction$3e$__["runWithTransaction"])(adapter, async ()=>{
                const createdUser = await createWithHooks({
                    createdAt: /* @__PURE__ */ new Date(),
                    updatedAt: /* @__PURE__ */ new Date(),
                    ...user
                }, "user", void 0);
                return {
                    user: createdUser,
                    account: await createWithHooks({
                        ...account,
                        userId: createdUser.id,
                        createdAt: /* @__PURE__ */ new Date(),
                        updatedAt: /* @__PURE__ */ new Date()
                    }, "account", void 0)
                };
            });
        },
        createUser: async (user)=>{
            return await createWithHooks({
                createdAt: /* @__PURE__ */ new Date(),
                updatedAt: /* @__PURE__ */ new Date(),
                ...user,
                email: user.email?.toLowerCase()
            }, "user", void 0);
        },
        createAccount: async (account)=>{
            return await createWithHooks({
                createdAt: /* @__PURE__ */ new Date(),
                updatedAt: /* @__PURE__ */ new Date(),
                ...account
            }, "account", void 0);
        },
        listSessions: async (userId)=>{
            if (secondaryStorage) {
                const currentList = await secondaryStorage.get(`active-sessions-${userId}`);
                if (!currentList) return [];
                const list = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(currentList) || [];
                const now = Date.now();
                const validSessions = list.filter((s)=>s.expiresAt > now);
                const sessions = [];
                for (const session of validSessions){
                    const sessionStringified = await secondaryStorage.get(session.token);
                    if (sessionStringified) {
                        const s = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(sessionStringified);
                        if (!s) return [];
                        const parsedSession = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["s"])(ctx.options, {
                            ...s.session,
                            expiresAt: new Date(s.session.expiresAt)
                        });
                        sessions.push(parsedSession);
                    }
                }
                return sessions;
            }
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).findMany({
                model: "session",
                where: [
                    {
                        field: "userId",
                        value: userId
                    }
                ]
            });
        },
        listUsers: async (limit, offset, sortBy, where)=>{
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).findMany({
                model: "user",
                limit,
                offset,
                sortBy,
                where
            });
        },
        countTotalUsers: async (where)=>{
            const total = await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).count({
                model: "user",
                where
            });
            if (typeof total === "string") return parseInt(total);
            return total;
        },
        deleteUser: async (userId)=>{
            if (secondaryStorage) await secondaryStorage.delete(`active-sessions-${userId}`);
            if (!secondaryStorage || options.session?.storeSessionInDatabase) await deleteManyWithHooks([
                {
                    field: "userId",
                    value: userId
                }
            ], "session", void 0);
            await deleteManyWithHooks([
                {
                    field: "userId",
                    value: userId
                }
            ], "account", void 0);
            await deleteWithHooks([
                {
                    field: "id",
                    value: userId
                }
            ], "user", void 0);
        },
        createSession: async (userId, dontRememberMe, override, overrideAll)=>{
            const ctx$1 = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__u__as__getCurrentAuthContext$3e$__["getCurrentAuthContext"])().catch(()=>null);
            const headers = ctx$1?.headers || ctx$1?.request?.headers;
            const { id: _, ...rest } = override || {};
            const defaultAdditionalFields = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["o"])(ctx$1?.context.options ?? options, {});
            const data = {
                ipAddress: ctx$1?.request || ctx$1?.headers ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$request$2d$ip$2d$D6st$2d$mto$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(ctx$1?.request || ctx$1?.headers, ctx$1?.context.options) || "" : "",
                userAgent: headers?.get("user-agent") || "",
                ...rest,
                expiresAt: dontRememberMe ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(3600 * 24, "sec") : (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(sessionExpiration, "sec"),
                userId,
                token: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2d$db7gNqd$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(32),
                createdAt: /* @__PURE__ */ new Date(),
                updatedAt: /* @__PURE__ */ new Date(),
                ...defaultAdditionalFields,
                ...overrideAll ? rest : {}
            };
            return await createWithHooks(data, "session", secondaryStorage ? {
                fn: async (sessionData)=>{
                    /**
					* store the session token for the user
					* so we can retrieve it later for listing sessions
					*/ const currentList = await secondaryStorage.get(`active-sessions-${userId}`);
                    let list = [];
                    const now = Date.now();
                    if (currentList) {
                        list = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(currentList) || [];
                        list = list.filter((session)=>session.expiresAt > now);
                    }
                    const sorted = list.sort((a, b)=>a.expiresAt - b.expiresAt);
                    let furthestSessionExp = sorted.at(-1)?.expiresAt;
                    sorted.push({
                        token: data.token,
                        expiresAt: data.expiresAt.getTime()
                    });
                    if (!furthestSessionExp || furthestSessionExp < data.expiresAt.getTime()) furthestSessionExp = data.expiresAt.getTime();
                    const furthestSessionTTL = Math.max(Math.floor((furthestSessionExp - now) / 1e3), 0);
                    if (furthestSessionTTL > 0) await secondaryStorage.set(`active-sessions-${userId}`, JSON.stringify(sorted), furthestSessionTTL);
                    const user = await adapter.findOne({
                        model: "user",
                        where: [
                            {
                                field: "id",
                                value: userId
                            }
                        ]
                    });
                    const sessionTTL = Math.max(Math.floor((data.expiresAt.getTime() - now) / 1e3), 0);
                    if (sessionTTL > 0) await secondaryStorage.set(data.token, JSON.stringify({
                        session: sessionData,
                        user
                    }), sessionTTL);
                    return sessionData;
                },
                executeMainFn: options.session?.storeSessionInDatabase
            } : void 0);
        },
        findSession: async (token)=>{
            if (secondaryStorage) {
                const sessionStringified = await secondaryStorage.get(token);
                if (!sessionStringified && !options.session?.storeSessionInDatabase) return null;
                if (sessionStringified) {
                    const s = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(sessionStringified);
                    if (!s) return null;
                    return {
                        session: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["s"])(ctx.options, {
                            ...s.session,
                            expiresAt: new Date(s.session.expiresAt),
                            createdAt: new Date(s.session.createdAt),
                            updatedAt: new Date(s.session.updatedAt)
                        }),
                        user: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["l"])(ctx.options, {
                            ...s.user,
                            createdAt: new Date(s.user.createdAt),
                            updatedAt: new Date(s.user.updatedAt)
                        })
                    };
                }
            }
            const result = await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).findOne({
                model: "session",
                where: [
                    {
                        value: token,
                        field: "token"
                    }
                ],
                join: {
                    user: true
                }
            });
            if (!result) return null;
            const { user, ...session } = result;
            if (!user) return null;
            return {
                session: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["s"])(ctx.options, session),
                user: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["l"])(ctx.options, user)
            };
        },
        findSessions: async (sessionTokens)=>{
            if (secondaryStorage) {
                const sessions$1 = [];
                for (const sessionToken of sessionTokens){
                    const sessionStringified = await secondaryStorage.get(sessionToken);
                    if (sessionStringified) {
                        const s = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(sessionStringified);
                        if (!s) return [];
                        const session = {
                            session: {
                                ...s.session,
                                expiresAt: new Date(s.session.expiresAt)
                            },
                            user: {
                                ...s.user,
                                createdAt: new Date(s.user.createdAt),
                                updatedAt: new Date(s.user.updatedAt)
                            }
                        };
                        sessions$1.push(session);
                    }
                }
                return sessions$1;
            }
            const sessions = await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).findMany({
                model: "session",
                where: [
                    {
                        field: "token",
                        value: sessionTokens,
                        operator: "in"
                    }
                ],
                join: {
                    user: true
                }
            });
            if (!sessions.length) return [];
            if (sessions.some((session)=>!session.user)) return [];
            return sessions.map((_session)=>{
                const { user, ...session } = _session;
                return {
                    session,
                    user
                };
            });
        },
        updateSession: async (sessionToken, session)=>{
            return await updateWithHooks(session, [
                {
                    field: "token",
                    value: sessionToken
                }
            ], "session", secondaryStorage ? {
                async fn (data) {
                    const currentSession = await secondaryStorage.get(sessionToken);
                    let updatedSession = null;
                    if (currentSession) {
                        const parsedSession = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(currentSession);
                        if (!parsedSession) return null;
                        updatedSession = {
                            ...parsedSession.session,
                            ...data
                        };
                        return updatedSession;
                    } else return null;
                },
                executeMainFn: options.session?.storeSessionInDatabase
            } : void 0);
        },
        deleteSession: async (token)=>{
            if (secondaryStorage) {
                const data = await secondaryStorage.get(token);
                if (data) {
                    const { session } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(data) ?? {};
                    if (!session) {
                        logger$1.error("Session not found in secondary storage");
                        return;
                    }
                    const userId = session.userId;
                    const currentList = await secondaryStorage.get(`active-sessions-${userId}`);
                    if (currentList) {
                        let list = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(currentList) || [];
                        const now = Date.now();
                        const filtered = list.filter((session$1)=>session$1.expiresAt > now && session$1.token !== token);
                        const furthestSessionExp = filtered.sort((a, b)=>a.expiresAt - b.expiresAt).at(-1)?.expiresAt;
                        if (filtered.length > 0 && furthestSessionExp && furthestSessionExp > Date.now()) await secondaryStorage.set(`active-sessions-${userId}`, JSON.stringify(filtered), Math.floor((furthestSessionExp - now) / 1e3));
                        else await secondaryStorage.delete(`active-sessions-${userId}`);
                    } else logger$1.error("Active sessions list not found in secondary storage");
                }
                await secondaryStorage.delete(token);
                if (!options.session?.storeSessionInDatabase || ctx.options.session?.preserveSessionInDatabase) return;
            }
            await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).delete({
                model: "session",
                where: [
                    {
                        field: "token",
                        value: token
                    }
                ]
            });
        },
        deleteAccounts: async (userId)=>{
            await deleteManyWithHooks([
                {
                    field: "userId",
                    value: userId
                }
            ], "account", void 0);
        },
        deleteAccount: async (accountId)=>{
            await deleteWithHooks([
                {
                    field: "id",
                    value: accountId
                }
            ], "account", void 0);
        },
        deleteSessions: async (userIdOrSessionTokens)=>{
            if (secondaryStorage) {
                if (typeof userIdOrSessionTokens === "string") {
                    const activeSession = await secondaryStorage.get(`active-sessions-${userIdOrSessionTokens}`);
                    const sessions = activeSession ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(activeSession) : [];
                    if (!sessions) return;
                    for (const session of sessions)await secondaryStorage.delete(session.token);
                } else for (const sessionToken of userIdOrSessionTokens)if (await secondaryStorage.get(sessionToken)) await secondaryStorage.delete(sessionToken);
                if (!options.session?.storeSessionInDatabase || ctx.options.session?.preserveSessionInDatabase) return;
            }
            await deleteManyWithHooks([
                {
                    field: Array.isArray(userIdOrSessionTokens) ? "token" : "userId",
                    value: userIdOrSessionTokens,
                    operator: Array.isArray(userIdOrSessionTokens) ? "in" : void 0
                }
            ], "session", void 0);
        },
        findOAuthUser: async (email, accountId, providerId)=>{
            const account = await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).findMany({
                model: "account",
                where: [
                    {
                        value: accountId,
                        field: "accountId"
                    }
                ],
                join: {
                    user: true
                }
            }).then((accounts)=>{
                return accounts.find((a)=>a.providerId === providerId);
            });
            if (account) if (account.user) return {
                user: account.user,
                accounts: [
                    account
                ]
            };
            else {
                const user = await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).findOne({
                    model: "user",
                    where: [
                        {
                            value: email.toLowerCase(),
                            field: "email"
                        }
                    ]
                });
                if (user) return {
                    user,
                    accounts: [
                        account
                    ]
                };
                return null;
            }
            else {
                const user = await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).findOne({
                    model: "user",
                    where: [
                        {
                            value: email.toLowerCase(),
                            field: "email"
                        }
                    ]
                });
                if (user) return {
                    user,
                    accounts: await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).findMany({
                        model: "account",
                        where: [
                            {
                                value: user.id,
                                field: "userId"
                            }
                        ]
                    }) || []
                };
                else return null;
            }
        },
        findUserByEmail: async (email, options$1)=>{
            const result = await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).findOne({
                model: "user",
                where: [
                    {
                        value: email.toLowerCase(),
                        field: "email"
                    }
                ],
                join: {
                    ...options$1?.includeAccounts ? {
                        account: true
                    } : {}
                }
            });
            if (!result) return null;
            const { account: accounts, ...user } = result;
            return {
                user,
                accounts: accounts ?? []
            };
        },
        findUserById: async (userId)=>{
            if (!userId) return null;
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).findOne({
                model: "user",
                where: [
                    {
                        field: "id",
                        value: userId
                    }
                ]
            });
        },
        linkAccount: async (account)=>{
            return await createWithHooks({
                createdAt: /* @__PURE__ */ new Date(),
                updatedAt: /* @__PURE__ */ new Date(),
                ...account
            }, "account", void 0);
        },
        updateUser: async (userId, data)=>{
            const user = await updateWithHooks(data, [
                {
                    field: "id",
                    value: userId
                }
            ], "user", void 0);
            await refreshUserSessions(user);
            await refreshUserSessions(user);
            return user;
        },
        updateUserByEmail: async (email, data)=>{
            const user = await updateWithHooks(data, [
                {
                    field: "email",
                    value: email.toLowerCase()
                }
            ], "user", void 0);
            await refreshUserSessions(user);
            await refreshUserSessions(user);
            return user;
        },
        updatePassword: async (userId, password)=>{
            await updateManyWithHooks({
                password
            }, [
                {
                    field: "userId",
                    value: userId
                },
                {
                    field: "providerId",
                    value: "credential"
                }
            ], "account", void 0);
        },
        findAccounts: async (userId)=>{
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).findMany({
                model: "account",
                where: [
                    {
                        field: "userId",
                        value: userId
                    }
                ]
            });
        },
        findAccount: async (accountId)=>{
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).findOne({
                model: "account",
                where: [
                    {
                        field: "accountId",
                        value: accountId
                    }
                ]
            });
        },
        findAccountByProviderId: async (accountId, providerId)=>{
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).findOne({
                model: "account",
                where: [
                    {
                        field: "accountId",
                        value: accountId
                    },
                    {
                        field: "providerId",
                        value: providerId
                    }
                ]
            });
        },
        findAccountByUserId: async (userId)=>{
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).findMany({
                model: "account",
                where: [
                    {
                        field: "userId",
                        value: userId
                    }
                ]
            });
        },
        updateAccount: async (id, data)=>{
            return await updateWithHooks(data, [
                {
                    field: "id",
                    value: id
                }
            ], "account", void 0);
        },
        createVerificationValue: async (data)=>{
            return await createWithHooks({
                createdAt: /* @__PURE__ */ new Date(),
                updatedAt: /* @__PURE__ */ new Date(),
                ...data
            }, "verification", void 0);
        },
        findVerificationValue: async (identifier)=>{
            const verification = await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).findMany({
                model: "verification",
                where: [
                    {
                        field: "identifier",
                        value: identifier
                    }
                ],
                sortBy: {
                    field: "createdAt",
                    direction: "desc"
                },
                limit: 1
            });
            if (!options.verification?.disableCleanup) await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).deleteMany({
                model: "verification",
                where: [
                    {
                        field: "expiresAt",
                        value: /* @__PURE__ */ new Date(),
                        operator: "lt"
                    }
                ]
            });
            return verification[0];
        },
        deleteVerificationValue: async (id)=>{
            await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).delete({
                model: "verification",
                where: [
                    {
                        field: "id",
                        value: id
                    }
                ]
            });
        },
        deleteVerificationByIdentifier: async (identifier)=>{
            await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__["getCurrentAdapter"])(adapter)).delete({
                model: "verification",
                where: [
                    {
                        field: "identifier",
                        value: identifier
                    }
                ]
            });
        },
        updateVerificationValue: async (id, data)=>{
            return await updateWithHooks(data, [
                {
                    field: "id",
                    value: id
                }
            ], "verification", void 0);
        }
    };
};
//#endregion
//#region src/db/to-zod.ts
function toZodSchema({ fields, isClientSide }) {
    const zodFields = Object.keys(fields).reduce((acc, key)=>{
        const field = fields[key];
        if (!field) return acc;
        if (isClientSide && field.input === false) return acc;
        let schema;
        if (field.type === "json") schema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__.json ? __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__.json() : __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__.any();
        else if (field.type === "string[]" || field.type === "number[]") schema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__.array(field.type === "string[]" ? __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__.string() : __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__.number());
        else if (Array.isArray(field.type)) schema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__.any();
        else schema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__[field.type]();
        if (field?.required === false) schema = schema.optional();
        if (field?.returned === false) return acc;
        return {
            ...acc,
            [key]: schema
        };
    }, {});
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__.object(zodFields);
}
//#endregion
//#region src/db/get-schema.ts
function getSchema(config) {
    const tables = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["a"])(config);
    let schema = {};
    for(const key in tables){
        const table = tables[key];
        const fields = table.fields;
        let actualFields = {};
        Object.entries(fields).forEach(([key$1, field])=>{
            actualFields[field.fieldName || key$1] = field;
            if (field.references) {
                const refTable = tables[field.references.model];
                if (refTable) actualFields[field.fieldName || key$1].references = {
                    ...field.references,
                    model: refTable.modelName,
                    field: field.references.field
                };
            }
        });
        if (schema[table.modelName]) {
            schema[table.modelName].fields = {
                ...schema[table.modelName].fields,
                ...actualFields
            };
            continue;
        }
        schema[table.modelName] = {
            fields: actualFields,
            order: table.order || Infinity
        };
    }
    return schema;
}
//#endregion
//#region src/db/get-migration.ts
const map = {
    postgres: {
        string: [
            "character varying",
            "varchar",
            "text",
            "uuid"
        ],
        number: [
            "int4",
            "integer",
            "bigint",
            "smallint",
            "numeric",
            "real",
            "double precision"
        ],
        boolean: [
            "bool",
            "boolean"
        ],
        date: [
            "timestamptz",
            "timestamp",
            "date"
        ],
        json: [
            "json",
            "jsonb"
        ]
    },
    mysql: {
        string: [
            "varchar",
            "text",
            "uuid"
        ],
        number: [
            "integer",
            "int",
            "bigint",
            "smallint",
            "decimal",
            "float",
            "double"
        ],
        boolean: [
            "boolean",
            "tinyint"
        ],
        date: [
            "timestamp",
            "datetime",
            "date"
        ],
        json: [
            "json"
        ]
    },
    sqlite: {
        string: [
            "TEXT"
        ],
        number: [
            "INTEGER",
            "REAL"
        ],
        boolean: [
            "INTEGER",
            "BOOLEAN"
        ],
        date: [
            "DATE",
            "INTEGER"
        ],
        json: [
            "TEXT"
        ]
    },
    mssql: {
        string: [
            "varchar",
            "nvarchar",
            "uniqueidentifier"
        ],
        number: [
            "int",
            "bigint",
            "smallint",
            "decimal",
            "float",
            "double"
        ],
        boolean: [
            "bit",
            "smallint"
        ],
        date: [
            "datetime2",
            "date",
            "datetime"
        ],
        json: [
            "varchar",
            "nvarchar"
        ]
    }
};
function matchType(columnDataType, fieldType, dbType) {
    function normalize(type) {
        return type.toLowerCase().split("(")[0].trim();
    }
    if (fieldType === "string[]" || fieldType === "number[]") return columnDataType.toLowerCase().includes("json");
    const types = map[dbType];
    return (Array.isArray(fieldType) ? types["string"].map((t)=>t.toLowerCase()) : types[fieldType].map((t)=>t.toLowerCase())).includes(normalize(columnDataType));
}
/**
* Get the current PostgreSQL schema (search_path) for the database connection
* Returns the first schema in the search_path, defaulting to 'public' if not found
*/ async function getPostgresSchema(db) {
    try {
        const result = await __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$raw$2d$builder$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`SHOW search_path`.execute(db);
        if (result.rows[0]?.search_path) return result.rows[0].search_path.split(",").map((s)=>s.trim()).map((s)=>s.replace(/^["']|["']$/g, "")).filter((s)=>!s.startsWith("$"))[0] || "public";
    } catch (error) {}
    return "public";
}
async function getMigrations(config) {
    const betterAuthSchema = getSchema(config);
    const logger$1 = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__createLogger$3e$__["createLogger"])(config.logger);
    let { kysely: db, databaseType: dbType } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$dialect$2d$D9ZUZA4J$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(config);
    if (!dbType) {
        logger$1.warn("Could not determine database type, defaulting to sqlite. Please provide a type in the database options to avoid this.");
        dbType = "sqlite";
    }
    if (!db) {
        logger$1.error("Only kysely adapter is supported for migrations. You can use `generate` command to generate the schema, if you're using a different adapter.");
        process.exit(1);
    }
    let currentSchema = "public";
    if (dbType === "postgres") {
        currentSchema = await getPostgresSchema(db);
        logger$1.debug(`PostgreSQL migration: Using schema '${currentSchema}' (from search_path)`);
        try {
            if (!(await __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$raw$2d$builder$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`
				SELECT schema_name 
				FROM information_schema.schemata 
				WHERE schema_name = ${currentSchema}
			`.execute(db)).rows[0]) logger$1.warn(`Schema '${currentSchema}' does not exist. Tables will be inspected from available schemas. Consider creating the schema first or checking your database configuration.`);
        } catch (error) {
            logger$1.debug(`Could not verify schema existence: ${error instanceof Error ? error.message : String(error)}`);
        }
    }
    const allTableMetadata = await db.introspection.getTables();
    let tableMetadata = allTableMetadata;
    if (dbType === "postgres") try {
        const tablesInSchema = await __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$raw$2d$builder$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`
				SELECT table_name 
				FROM information_schema.tables 
				WHERE table_schema = ${currentSchema}
				AND table_type = 'BASE TABLE'
			`.execute(db);
        const tableNamesInSchema = new Set(tablesInSchema.rows.map((row)=>row.table_name));
        tableMetadata = allTableMetadata.filter((table)=>table.schema === currentSchema && tableNamesInSchema.has(table.name));
        logger$1.debug(`Found ${tableMetadata.length} table(s) in schema '${currentSchema}': ${tableMetadata.map((t)=>t.name).join(", ") || "(none)"}`);
    } catch (error) {
        logger$1.warn(`Could not filter tables by schema. Using all discovered tables. Error: ${error instanceof Error ? error.message : String(error)}`);
    }
    const toBeCreated = [];
    const toBeAdded = [];
    for (const [key, value] of Object.entries(betterAuthSchema)){
        const table = tableMetadata.find((t)=>t.name === key);
        if (!table) {
            const tIndex = toBeCreated.findIndex((t)=>t.table === key);
            const tableData = {
                table: key,
                fields: value.fields,
                order: value.order || Infinity
            };
            const insertIndex = toBeCreated.findIndex((t)=>(t.order || Infinity) > tableData.order);
            if (insertIndex === -1) if (tIndex === -1) toBeCreated.push(tableData);
            else toBeCreated[tIndex].fields = {
                ...toBeCreated[tIndex].fields,
                ...value.fields
            };
            else toBeCreated.splice(insertIndex, 0, tableData);
            continue;
        }
        let toBeAddedFields = {};
        for (const [fieldName, field] of Object.entries(value.fields)){
            const column = table.columns.find((c)=>c.name === fieldName);
            if (!column) {
                toBeAddedFields[fieldName] = field;
                continue;
            }
            if (matchType(column.dataType, field.type, dbType)) continue;
            else logger$1.warn(`Field ${fieldName} in table ${key} has a different type in the database. Expected ${field.type} but got ${column.dataType}.`);
        }
        if (Object.keys(toBeAddedFields).length > 0) toBeAdded.push({
            table: key,
            fields: toBeAddedFields,
            order: value.order || Infinity
        });
    }
    const migrations = [];
    const useUUIDs = config.advanced?.database?.generateId === "uuid";
    const useNumberId = config.advanced?.database?.useNumberId || config.advanced?.database?.generateId === "serial";
    function getType(field, fieldName) {
        const type = field.type;
        const typeMap = {
            string: {
                sqlite: "text",
                postgres: "text",
                mysql: field.unique ? "varchar(255)" : field.references ? "varchar(36)" : field.sortable ? "varchar(255)" : field.index ? "varchar(255)" : "text",
                mssql: field.unique || field.sortable ? "varchar(255)" : field.references ? "varchar(36)" : "varchar(8000)"
            },
            boolean: {
                sqlite: "integer",
                postgres: "boolean",
                mysql: "boolean",
                mssql: "smallint"
            },
            number: {
                sqlite: field.bigint ? "bigint" : "integer",
                postgres: field.bigint ? "bigint" : "integer",
                mysql: field.bigint ? "bigint" : "integer",
                mssql: field.bigint ? "bigint" : "integer"
            },
            date: {
                sqlite: "date",
                postgres: "timestamptz",
                mysql: "timestamp(3)",
                mssql: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$raw$2d$builder$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`datetime2(3)`
            },
            json: {
                sqlite: "text",
                postgres: "jsonb",
                mysql: "json",
                mssql: "varchar(8000)"
            },
            id: {
                postgres: useNumberId ? __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$raw$2d$builder$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`integer GENERATED BY DEFAULT AS IDENTITY` : useUUIDs ? "uuid" : "text",
                mysql: useNumberId ? "integer" : useUUIDs ? "varchar(36)" : "varchar(36)",
                mssql: useNumberId ? "integer" : useUUIDs ? "varchar(36)" : "varchar(36)",
                sqlite: useNumberId ? "integer" : "text"
            },
            foreignKeyId: {
                postgres: useNumberId ? "integer" : useUUIDs ? "uuid" : "text",
                mysql: useNumberId ? "integer" : useUUIDs ? "varchar(36)" : "varchar(36)",
                mssql: useNumberId ? "integer" : useUUIDs ? "varchar(36)" : "varchar(36)",
                sqlite: useNumberId ? "integer" : "text"
            }
        };
        if (fieldName === "id" || field.references?.field === "id") {
            if (fieldName === "id") return typeMap.id[dbType];
            return typeMap.foreignKeyId[dbType];
        }
        if (dbType === "sqlite" && (type === "string[]" || type === "number[]")) return "text";
        if (type === "string[]" || type === "number[]") return "jsonb";
        if (Array.isArray(type)) return "text";
        if (!(type in typeMap)) throw new Error(`Unsupported field type '${String(type)}' for field '${fieldName}'. Allowed types are: string, number, boolean, date, string[], number[]. If you need to store structured data, store it as a JSON string (type: "string") or split it into primitive fields. See https://better-auth.com/docs/advanced/schema#additional-fields`);
        return typeMap[type][dbType || "sqlite"];
    }
    const getModelName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
        schema: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["a"])(config),
        usePlural: false
    });
    const getFieldName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])({
        schema: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["a"])(config),
        usePlural: false
    });
    function getReferencePath(model, field) {
        try {
            return `${getModelName(model)}.${getFieldName({
                model,
                field
            })}`;
        } catch  {
            return `${model}.${field}`;
        }
    }
    if (toBeAdded.length) for (const table of toBeAdded)for (const [fieldName, field] of Object.entries(table.fields)){
        const type = getType(field, fieldName);
        let builder = db.schema.alterTable(table.table);
        if (field.index) {
            const index = db.schema.alterTable(table.table).addIndex(`${table.table}_${fieldName}_idx`);
            migrations.push(index);
        }
        let built = builder.addColumn(fieldName, type, (col)=>{
            col = field.required !== false ? col.notNull() : col;
            if (field.references) col = col.references(getReferencePath(field.references.model, field.references.field)).onDelete(field.references.onDelete || "cascade");
            if (field.unique) col = col.unique();
            if (field.type === "date" && typeof field.defaultValue === "function" && (dbType === "postgres" || dbType === "mysql" || dbType === "mssql")) if (dbType === "mysql") col = col.defaultTo(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$raw$2d$builder$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`CURRENT_TIMESTAMP(3)`);
            else col = col.defaultTo(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$raw$2d$builder$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`CURRENT_TIMESTAMP`);
            return col;
        });
        migrations.push(built);
    }
    let toBeIndexed = [];
    if (config.advanced?.database?.useNumberId) logger$1.warn("`useNumberId` is deprecated. Please use `generateId` with `serial` instead.");
    if (toBeCreated.length) for (const table of toBeCreated){
        const idType = getType({
            type: useNumberId ? "number" : "string"
        }, "id");
        let dbT = db.schema.createTable(table.table).addColumn("id", idType, (col)=>{
            if (useNumberId) {
                if (dbType === "postgres") return col.primaryKey().notNull();
                else if (dbType === "sqlite") return col.primaryKey().notNull();
                else if (dbType === "mssql") return col.identity().primaryKey().notNull();
                return col.autoIncrement().primaryKey().notNull();
            }
            if (useUUIDs) {
                if (dbType === "postgres") return col.primaryKey().defaultTo(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$raw$2d$builder$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`pg_catalog.gen_random_uuid()`).notNull();
                return col.primaryKey().notNull();
            }
            return col.primaryKey().notNull();
        });
        for (const [fieldName, field] of Object.entries(table.fields)){
            const type = getType(field, fieldName);
            dbT = dbT.addColumn(fieldName, type, (col)=>{
                col = field.required !== false ? col.notNull() : col;
                if (field.references) col = col.references(getReferencePath(field.references.model, field.references.field)).onDelete(field.references.onDelete || "cascade");
                if (field.unique) col = col.unique();
                if (field.type === "date" && typeof field.defaultValue === "function" && (dbType === "postgres" || dbType === "mysql" || dbType === "mssql")) if (dbType === "mysql") col = col.defaultTo(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$raw$2d$builder$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`CURRENT_TIMESTAMP(3)`);
                else col = col.defaultTo(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$raw$2d$builder$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`CURRENT_TIMESTAMP`);
                return col;
            });
            if (field.index) {
                let builder = db.schema.createIndex(`${table.table}_${fieldName}_${field.unique ? "uidx" : "idx"}`).on(table.table).columns([
                    fieldName
                ]);
                toBeIndexed.push(field.unique ? builder.unique() : builder);
            }
        }
        migrations.push(dbT);
    }
    if (toBeIndexed.length) for (const index of toBeIndexed)migrations.push(index);
    async function runMigrations() {
        for (const migration of migrations)await migration.execute();
    }
    async function compileMigrations() {
        return migrations.map((m)=>m.compile().sql).join(";\n\n") + ";";
    }
    return {
        toBeCreated,
        toBeAdded,
        runMigrations,
        compileMigrations
    };
}
;
}),
"[project]/node_modules/better-auth/dist/misc-BwNc0MKr.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

//#region src/utils/misc.ts
__turbopack_context__.s([
    "t",
    ()=>capitalizeFirstLetter
]);
function capitalizeFirstLetter(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
}
;
}),
"[project]/node_modules/better-auth/dist/url-CB8xCwz-.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "i",
    ()=>getProtocol,
    "n",
    ()=>getHost,
    "r",
    ()=>getOrigin,
    "t",
    ()=>getBaseURL
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env-8yWFh7b8.mjs [app-route] (ecmascript) <export c as env>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error-BhAKg8LX.mjs [app-route] (ecmascript) <export t as BetterAuthError>");
;
;
//#region src/utils/url.ts
function checkHasPath(url) {
    try {
        return (new URL(url).pathname.replace(/\/+$/, "") || "/") !== "/";
    } catch (error) {
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`Invalid base URL: ${url}. Please provide a valid base URL.`);
    }
}
function assertHasProtocol(url) {
    try {
        const parsedUrl = new URL(url);
        if (parsedUrl.protocol !== "http:" && parsedUrl.protocol !== "https:") throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`Invalid base URL: ${url}. URL must include 'http://' or 'https://'`);
    } catch (error) {
        if (error instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]) throw error;
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`Invalid base URL: ${url}. Please provide a valid base URL.`, String(error));
    }
}
function withPath(url, path = "/api/auth") {
    assertHasProtocol(url);
    if (checkHasPath(url)) return url;
    const trimmedUrl = url.replace(/\/+$/, "");
    if (!path || path === "/") return trimmedUrl;
    path = path.startsWith("/") ? path : `/${path}`;
    return `${trimmedUrl}${path}`;
}
function getBaseURL(url, path, request, loadEnv, trustedProxyHeaders) {
    if (url) return withPath(url, path);
    if (loadEnv !== false) {
        const fromEnv = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__["env"].BETTER_AUTH_URL || __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__["env"].NEXT_PUBLIC_BETTER_AUTH_URL || __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__["env"].PUBLIC_BETTER_AUTH_URL || __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__["env"].NUXT_PUBLIC_BETTER_AUTH_URL || __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__["env"].NUXT_PUBLIC_AUTH_URL || (__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__["env"].BASE_URL !== "/" ? __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__["env"].BASE_URL : void 0);
        if (fromEnv) return withPath(fromEnv, path);
    }
    const fromRequest = request?.headers.get("x-forwarded-host");
    const fromRequestProto = request?.headers.get("x-forwarded-proto");
    if (fromRequest && fromRequestProto && trustedProxyHeaders) return withPath(`${fromRequestProto}://${fromRequest}`, path);
    if (request) {
        const url$1 = getOrigin(request.url);
        if (!url$1) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("Could not get origin from request. Please provide a valid base URL.");
        return withPath(url$1, path);
    }
    if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
    ;
}
function getOrigin(url) {
    try {
        const parsedUrl = new URL(url);
        return parsedUrl.origin === "null" ? null : parsedUrl.origin;
    } catch (error) {
        return null;
    }
}
function getProtocol(url) {
    try {
        return new URL(url).protocol;
    } catch (error) {
        return null;
    }
}
function getHost(url) {
    try {
        return new URL(url).host;
    } catch (error) {
        return null;
    }
}
;
}),
"[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "a",
    ()=>getSessionCookie,
    "c",
    ()=>setSessionCookie,
    "d",
    ()=>createSessionStore,
    "f",
    ()=>getAccountCookie,
    "h",
    ()=>setAccountCookie,
    "i",
    ()=>getCookies,
    "l",
    ()=>parseSetCookieHeader,
    "m",
    ()=>getSessionQuerySchema,
    "n",
    ()=>deleteSessionCookie,
    "o",
    ()=>parseCookies,
    "p",
    ()=>getChunkedCookie,
    "r",
    ()=>getCookieCache,
    "s",
    ()=>setCookieCache,
    "t",
    ()=>createCookieGetter,
    "u",
    ()=>setCookieToHeader
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/crypto-CFUhAR9W.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/schema-Bb7wzeK_.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/json-CnHxKYpj.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$url$2d$CB8xCwz$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/url-CB8xCwz-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env-8yWFh7b8.mjs [app-route] (ecmascript) <export c as env>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__f__as__isProduction$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env-8yWFh7b8.mjs [app-route] (ecmascript) <export f as isProduction>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error-BhAKg8LX.mjs [app-route] (ecmascript) <export t as BetterAuthError>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/external.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/base64.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$binary$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/binary.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/hmac.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$node_modules$2f$ms$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/node_modules/ms/dist/index.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
//#region src/cookies/session-store.ts
const ALLOWED_COOKIE_SIZE = 4096;
const ESTIMATED_EMPTY_COOKIE_SIZE = 200;
const CHUNK_SIZE = ALLOWED_COOKIE_SIZE - ESTIMATED_EMPTY_COOKIE_SIZE;
/**
* Parse cookies from the request headers
*/ function parseCookiesFromContext(ctx) {
    const cookieHeader = ctx.headers?.get("cookie");
    if (!cookieHeader) return {};
    const cookies = {};
    const pairs = cookieHeader.split("; ");
    for (const pair of pairs){
        const [name, ...valueParts] = pair.split("=");
        if (name && valueParts.length > 0) cookies[name] = valueParts.join("=");
    }
    return cookies;
}
/**
* Extract the chunk index from a cookie name
*/ function getChunkIndex(cookieName) {
    const parts = cookieName.split(".");
    const lastPart = parts[parts.length - 1];
    const index = parseInt(lastPart || "0", 10);
    return isNaN(index) ? 0 : index;
}
/**
* Read all existing chunks from cookies
*/ function readExistingChunks(cookieName, ctx) {
    const chunks = {};
    const cookies = parseCookiesFromContext(ctx);
    for (const [name, value] of Object.entries(cookies))if (name.startsWith(cookieName)) chunks[name] = value;
    return chunks;
}
/**
* Get the full session data by joining all chunks
*/ function joinChunks(chunks) {
    return Object.keys(chunks).sort((a, b)=>{
        return getChunkIndex(a) - getChunkIndex(b);
    }).map((key)=>chunks[key]).join("");
}
/**
* Split a cookie value into chunks if needed
*/ function chunkCookie(storeName, cookie, chunks, logger$1) {
    const chunkCount = Math.ceil(cookie.value.length / CHUNK_SIZE);
    if (chunkCount === 1) {
        chunks[cookie.name] = cookie.value;
        return [
            cookie
        ];
    }
    const cookies = [];
    for(let i = 0; i < chunkCount; i++){
        const name = `${cookie.name}.${i}`;
        const start = i * CHUNK_SIZE;
        const value = cookie.value.substring(start, start + CHUNK_SIZE);
        cookies.push({
            ...cookie,
            name,
            value
        });
        chunks[name] = value;
    }
    logger$1.debug(`CHUNKING_${storeName.toUpperCase()}_COOKIE`, {
        message: `${storeName} cookie exceeds allowed ${ALLOWED_COOKIE_SIZE} bytes.`,
        emptyCookieSize: ESTIMATED_EMPTY_COOKIE_SIZE,
        valueSize: cookie.value.length,
        chunkCount,
        chunks: cookies.map((c)=>c.value.length + ESTIMATED_EMPTY_COOKIE_SIZE)
    });
    return cookies;
}
/**
* Get all cookies that should be cleaned (removed)
*/ function getCleanCookies(chunks, cookieOptions) {
    const cleanedChunks = {};
    for(const name in chunks)cleanedChunks[name] = {
        name,
        value: "",
        options: {
            ...cookieOptions,
            maxAge: 0
        }
    };
    return cleanedChunks;
}
/**
* Create a session store for handling cookie chunking.
* When session data exceeds 4KB, it automatically splits it into multiple cookies.
*
* Based on next-auth's SessionStore implementation.
* @see https://github.com/nextauthjs/next-auth/blob/27b2519b84b8eb9cf053775dea29d577d2aa0098/packages/next-auth/src/core/lib/cookie.ts
*/ const storeFactory = (storeName)=>(cookieName, cookieOptions, ctx)=>{
        const chunks = readExistingChunks(cookieName, ctx);
        const logger$1 = ctx.context.logger;
        return {
            getValue () {
                return joinChunks(chunks);
            },
            hasChunks () {
                return Object.keys(chunks).length > 0;
            },
            chunk (value, options) {
                const cleanedChunks = getCleanCookies(chunks, cookieOptions);
                for(const name in chunks)delete chunks[name];
                const cookies = cleanedChunks;
                const chunked = chunkCookie(storeName, {
                    name: cookieName,
                    value,
                    options: {
                        ...cookieOptions,
                        ...options
                    }
                }, chunks, logger$1);
                for (const chunk of chunked)cookies[chunk.name] = chunk;
                return Object.values(cookies);
            },
            clean () {
                const cleanedChunks = getCleanCookies(chunks, cookieOptions);
                for(const name in chunks)delete chunks[name];
                return Object.values(cleanedChunks);
            },
            setCookies (cookies) {
                for (const cookie of cookies)ctx.setCookie(cookie.name, cookie.value, cookie.options);
            }
        };
    };
const createSessionStore = storeFactory("Session");
const createAccountStore = storeFactory("Account");
function getChunkedCookie(ctx, cookieName) {
    const value = ctx.getCookie(cookieName);
    if (value) return value;
    const chunks = [];
    const cookieHeader = ctx.headers?.get("cookie");
    if (!cookieHeader) return null;
    const cookies = {};
    const pairs = cookieHeader.split("; ");
    for (const pair of pairs){
        const [name, ...valueParts] = pair.split("=");
        if (name && valueParts.length > 0) cookies[name] = valueParts.join("=");
    }
    for (const [name, val] of Object.entries(cookies))if (name.startsWith(cookieName + ".")) {
        const indexStr = name.split(".").at(-1);
        const index = parseInt(indexStr || "0", 10);
        if (!isNaN(index)) chunks.push({
            index,
            value: val
        });
    }
    if (chunks.length > 0) {
        chunks.sort((a, b)=>a.index - b.index);
        return chunks.map((c)=>c.value).join("");
    }
    return null;
}
async function setAccountCookie(c, accountData) {
    const accountDataCookie = c.context.authCookies.accountData;
    const options = {
        maxAge: 300,
        ...accountDataCookie.options
    };
    const data = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(accountData, c.context.secret, "better-auth-account", options.maxAge);
    if (data.length > ALLOWED_COOKIE_SIZE) {
        const accountStore = createAccountStore(accountDataCookie.name, options, c);
        const cookies = accountStore.chunk(data, options);
        accountStore.setCookies(cookies);
    } else {
        const accountStore = createAccountStore(accountDataCookie.name, options, c);
        if (accountStore.hasChunks()) {
            const cleanCookies = accountStore.clean();
            accountStore.setCookies(cleanCookies);
        }
        c.setCookie(accountDataCookie.name, data, options);
    }
}
async function getAccountCookie(c) {
    const accountCookie = getChunkedCookie(c, c.context.authCookies.accountData.name);
    if (accountCookie) {
        const accountData = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["s"])(accountCookie, c.context.secret, "better-auth-account"));
        if (accountData) return accountData;
    }
    return null;
}
const getSessionQuerySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["optional"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    disableCookieCache: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].boolean().meta({
        description: "Disable cookie cache and fetch session from database"
    }).optional(),
    disableRefresh: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].boolean().meta({
        description: "Disable session refresh. Useful for checking session status, without updating the session"
    }).optional()
}));
//#endregion
//#region src/cookies/cookie-utils.ts
function parseSetCookieHeader(setCookie) {
    const cookies = /* @__PURE__ */ new Map();
    setCookie.split(", ").forEach((cookieString)=>{
        const [nameValue, ...attributes] = cookieString.split(";").map((part)=>part.trim());
        const [name, ...valueParts] = (nameValue || "").split("=");
        const value = valueParts.join("=");
        if (!name || value === void 0) return;
        const attrObj = {
            value
        };
        attributes.forEach((attribute)=>{
            const [attrName, ...attrValueParts] = attribute.split("=");
            const attrValue = attrValueParts.join("=");
            const normalizedAttrName = attrName.trim().toLowerCase();
            switch(normalizedAttrName){
                case "max-age":
                    attrObj["max-age"] = attrValue ? parseInt(attrValue.trim(), 10) : void 0;
                    break;
                case "expires":
                    attrObj.expires = attrValue ? new Date(attrValue.trim()) : void 0;
                    break;
                case "domain":
                    attrObj.domain = attrValue ? attrValue.trim() : void 0;
                    break;
                case "path":
                    attrObj.path = attrValue ? attrValue.trim() : void 0;
                    break;
                case "secure":
                    attrObj.secure = true;
                    break;
                case "httponly":
                    attrObj.httponly = true;
                    break;
                case "samesite":
                    attrObj.samesite = attrValue ? attrValue.trim().toLowerCase() : void 0;
                    break;
                default:
                    attrObj[normalizedAttrName] = attrValue ? attrValue.trim() : true;
                    break;
            }
        });
        cookies.set(name, attrObj);
    });
    return cookies;
}
function setCookieToHeader(headers) {
    return (context)=>{
        const setCookieHeader = context.response.headers.get("set-cookie");
        if (!setCookieHeader) return;
        const cookieMap = /* @__PURE__ */ new Map();
        (headers.get("cookie") || "").split(";").forEach((cookie)=>{
            const [name, ...rest] = cookie.trim().split("=");
            if (name && rest.length > 0) cookieMap.set(name, rest.join("="));
        });
        setCookieHeader.split(",").forEach((header)=>{
            parseSetCookieHeader(header).forEach((value, name)=>{
                cookieMap.set(name, value.value);
            });
        });
        const updatedCookies = Array.from(cookieMap.entries()).map(([name, value])=>`${name}=${value}`).join("; ");
        headers.set("cookie", updatedCookies);
    };
}
//#endregion
//#region src/cookies/index.ts
function createCookieGetter(options) {
    const secureCookiePrefix = (options.advanced?.useSecureCookies !== void 0 ? options.advanced?.useSecureCookies : options.baseURL !== void 0 ? options.baseURL.startsWith("https://") ? true : false : __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__f__as__isProduction$3e$__["isProduction"]) ? "__Secure-" : "";
    const crossSubdomainEnabled = !!options.advanced?.crossSubDomainCookies?.enabled;
    const domain = crossSubdomainEnabled ? options.advanced?.crossSubDomainCookies?.domain || (options.baseURL ? new URL(options.baseURL).hostname : void 0) : void 0;
    if (crossSubdomainEnabled && !domain) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("baseURL is required when crossSubdomainCookies are enabled");
    function createCookie(cookieName, overrideAttributes = {}) {
        const prefix = options.advanced?.cookiePrefix || "better-auth";
        const name = options.advanced?.cookies?.[cookieName]?.name || `${prefix}.${cookieName}`;
        const attributes = options.advanced?.cookies?.[cookieName]?.attributes;
        return {
            name: `${secureCookiePrefix}${name}`,
            attributes: {
                secure: !!secureCookiePrefix,
                sameSite: "lax",
                path: "/",
                httpOnly: true,
                ...crossSubdomainEnabled ? {
                    domain
                } : {},
                ...options.advanced?.defaultCookieAttributes,
                ...overrideAttributes,
                ...attributes
            }
        };
    }
    return createCookie;
}
function getCookies(options) {
    const createCookie = createCookieGetter(options);
    const sessionToken = createCookie("session_token", {
        maxAge: options.session?.expiresIn || (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$node_modules$2f$ms$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ms"])("7d") / 1e3
    });
    const sessionData = createCookie("session_data", {
        maxAge: options.session?.cookieCache?.maxAge || 300
    });
    const accountData = createCookie("account_data", {
        maxAge: options.session?.cookieCache?.maxAge || 300
    });
    const dontRememberToken = createCookie("dont_remember");
    return {
        sessionToken: {
            name: sessionToken.name,
            options: sessionToken.attributes
        },
        sessionData: {
            name: sessionData.name,
            options: sessionData.attributes
        },
        dontRememberToken: {
            name: dontRememberToken.name,
            options: dontRememberToken.attributes
        },
        accountData: {
            name: accountData.name,
            options: accountData.attributes
        }
    };
}
async function setCookieCache(ctx, session, dontRememberMe) {
    if (ctx.context.options.session?.cookieCache?.enabled) {
        const filteredSession = Object.entries(session.session).reduce((acc, [key, value])=>{
            const fieldConfig = ctx.context.options.session?.additionalFields?.[key];
            if (!fieldConfig || fieldConfig.returned !== false) acc[key] = value;
            return acc;
        }, {});
        const filteredUser = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["l"])(ctx.context.options, session.user);
        const versionConfig = ctx.context.options.session?.cookieCache?.version;
        let version = "1";
        if (versionConfig) {
            if (typeof versionConfig === "string") version = versionConfig;
            else if (typeof versionConfig === "function") {
                const result = versionConfig(session.session, session.user);
                version = result instanceof Promise ? await result : result;
            }
        }
        const sessionData = {
            session: filteredSession,
            user: filteredUser,
            updatedAt: Date.now(),
            version
        };
        const options = {
            ...ctx.context.authCookies.sessionData.options,
            maxAge: dontRememberMe ? void 0 : ctx.context.authCookies.sessionData.options.maxAge
        };
        const expiresAtDate = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(options.maxAge || 60, "sec").getTime();
        const strategy = ctx.context.options.session?.cookieCache?.strategy || "compact";
        let data;
        if (strategy === "jwe") data = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(sessionData, ctx.context.secret, "better-auth-session", options.maxAge || 300);
        else if (strategy === "jwt") data = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["o"])(sessionData, ctx.context.secret, options.maxAge || 300);
        else data = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["base64Url"].encode(JSON.stringify({
            session: sessionData,
            expiresAt: expiresAtDate,
            signature: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createHMAC"])("SHA-256", "base64urlnopad").sign(ctx.context.secret, JSON.stringify({
                ...sessionData,
                expiresAt: expiresAtDate
            }))
        }), {
            padding: false
        });
        if (data.length > 4093) {
            const sessionStore = createSessionStore(ctx.context.authCookies.sessionData.name, options, ctx);
            const cookies = sessionStore.chunk(data, options);
            sessionStore.setCookies(cookies);
        } else {
            const sessionStore = createSessionStore(ctx.context.authCookies.sessionData.name, options, ctx);
            if (sessionStore.hasChunks()) {
                const cleanCookies = sessionStore.clean();
                sessionStore.setCookies(cleanCookies);
            }
            ctx.setCookie(ctx.context.authCookies.sessionData.name, data, options);
        }
    }
}
async function setSessionCookie(ctx, session, dontRememberMe, overrides) {
    const dontRememberMeCookie = await ctx.getSignedCookie(ctx.context.authCookies.dontRememberToken.name, ctx.context.secret);
    dontRememberMe = dontRememberMe !== void 0 ? dontRememberMe : !!dontRememberMeCookie;
    const options = ctx.context.authCookies.sessionToken.options;
    const maxAge = dontRememberMe ? void 0 : ctx.context.sessionConfig.expiresIn;
    await ctx.setSignedCookie(ctx.context.authCookies.sessionToken.name, session.session.token, ctx.context.secret, {
        ...options,
        maxAge,
        ...overrides
    });
    if (dontRememberMe) await ctx.setSignedCookie(ctx.context.authCookies.dontRememberToken.name, "true", ctx.context.secret, ctx.context.authCookies.dontRememberToken.options);
    await setCookieCache(ctx, session, dontRememberMe);
    ctx.context.setNewSession(session);
    /**
	* If secondary storage is enabled, store the session data in the secondary storage
	* This is useful if the session got updated and we want to update the session data in the
	* secondary storage
	*/ if (ctx.context.options.secondaryStorage) await ctx.context.secondaryStorage?.set(session.session.token, JSON.stringify({
        user: session.user,
        session: session.session
    }), Math.floor((new Date(session.session.expiresAt).getTime() - Date.now()) / 1e3));
}
function deleteSessionCookie(ctx, skipDontRememberMe) {
    ctx.setCookie(ctx.context.authCookies.sessionToken.name, "", {
        ...ctx.context.authCookies.sessionToken.options,
        maxAge: 0
    });
    const sessionStore = createSessionStore(ctx.context.authCookies.sessionData.name, ctx.context.authCookies.sessionData.options, ctx);
    const cleanCookies = sessionStore.clean();
    sessionStore.setCookies(cleanCookies);
    if (!skipDontRememberMe) ctx.setCookie(ctx.context.authCookies.dontRememberToken.name, "", {
        ...ctx.context.authCookies.dontRememberToken.options,
        maxAge: 0
    });
}
function parseCookies(cookieHeader) {
    const cookies = cookieHeader.split("; ");
    const cookieMap = /* @__PURE__ */ new Map();
    cookies.forEach((cookie)=>{
        const [name, value] = cookie.split("=");
        cookieMap.set(name, value);
    });
    return cookieMap;
}
const getSessionCookie = (request, config)=>{
    if (config?.cookiePrefix) if (config.cookieName) config.cookiePrefix = `${config.cookiePrefix}-`;
    else config.cookiePrefix = `${config.cookiePrefix}.`;
    const headers = "headers" in request ? request.headers : request;
    const req = request instanceof Request ? request : void 0;
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$url$2d$CB8xCwz$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(req?.url, config?.path, req);
    const cookies = headers.get("cookie");
    if (!cookies) return null;
    const { cookieName = "session_token", cookiePrefix = "better-auth." } = config || {};
    const name = `${cookiePrefix}${cookieName}`;
    const secureCookieName = `__Secure-${name}`;
    const parsedCookie = parseCookies(cookies);
    const sessionToken = parsedCookie.get(name) || parsedCookie.get(secureCookieName);
    if (sessionToken) return sessionToken;
    return null;
};
const getCookieCache = async (request, config)=>{
    const cookies = (request instanceof Headers ? request : request.headers).get("cookie");
    if (!cookies) return null;
    const { cookieName = "session_data", cookiePrefix = "better-auth" } = config || {};
    const name = config?.isSecure !== void 0 ? config.isSecure ? `__Secure-${cookiePrefix}.${cookieName}` : `${cookiePrefix}.${cookieName}` : __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__f__as__isProduction$3e$__["isProduction"] ? `__Secure-${cookiePrefix}.${cookieName}` : `${cookiePrefix}.${cookieName}`;
    const parsedCookie = parseCookies(cookies);
    let sessionData = parsedCookie.get(name);
    if (!sessionData) {
        const chunks = [];
        for (const [cookieName$1, value] of parsedCookie.entries())if (cookieName$1.startsWith(name + ".")) {
            const parts = cookieName$1.split(".");
            const indexStr = parts[parts.length - 1];
            const index = parseInt(indexStr || "0", 10);
            if (!isNaN(index)) chunks.push({
                index,
                value
            });
        }
        if (chunks.length > 0) {
            chunks.sort((a, b)=>a.index - b.index);
            sessionData = chunks.map((c)=>c.value).join("");
        }
    }
    if (sessionData) {
        const secret = config?.secret || __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__["env"].BETTER_AUTH_SECRET;
        if (!secret) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("getCookieCache requires a secret to be provided. Either pass it as an option or set the BETTER_AUTH_SECRET environment variable");
        const strategy = config?.strategy || "compact";
        if (strategy === "jwe") {
            const payload = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["s"])(sessionData, secret, "better-auth-session");
            if (payload && payload.session && payload.user) {
                if (config?.version) {
                    const cookieVersion = payload.version || "1";
                    let expectedVersion = "1";
                    if (typeof config.version === "string") expectedVersion = config.version;
                    else if (typeof config.version === "function") {
                        const result = config.version(payload.session, payload.user);
                        expectedVersion = result instanceof Promise ? await result : result;
                    }
                    if (cookieVersion !== expectedVersion) return null;
                }
                return payload;
            }
            return null;
        } else if (strategy === "jwt") {
            const payload = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["l"])(sessionData, secret);
            if (payload && payload.session && payload.user) {
                if (config?.version) {
                    const cookieVersion = payload.version || "1";
                    let expectedVersion = "1";
                    if (typeof config.version === "string") expectedVersion = config.version;
                    else if (typeof config.version === "function") {
                        const result = config.version(payload.session, payload.user);
                        expectedVersion = result instanceof Promise ? await result : result;
                    }
                    if (cookieVersion !== expectedVersion) return null;
                }
                return payload;
            }
            return null;
        } else {
            const sessionDataPayload = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$binary$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["binary"].decode(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["base64Url"].decode(sessionData)));
            if (!sessionDataPayload) return null;
            if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createHMAC"])("SHA-256", "base64urlnopad").verify(secret, JSON.stringify({
                ...sessionDataPayload.session,
                expiresAt: sessionDataPayload.expiresAt
            }), sessionDataPayload.signature)) return null;
            if (config?.version && sessionDataPayload.session) {
                const cookieVersion = sessionDataPayload.session.version || "1";
                let expectedVersion = "1";
                if (typeof config.version === "string") expectedVersion = config.version;
                else if (typeof config.version === "function") {
                    const result = config.version(sessionDataPayload.session.session, sessionDataPayload.session.user);
                    expectedVersion = result instanceof Promise ? await result : result;
                }
                if (cookieVersion !== expectedVersion) return null;
            }
            return sessionDataPayload.session;
        }
    }
    return null;
};
;
}),
"[project]/node_modules/better-auth/dist/session-AaRl3_x-.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "a",
    ()=>requestOnlySessionMiddleware,
    "c",
    ()=>revokeSessions,
    "i",
    ()=>listSessions,
    "l",
    ()=>sensitiveSessionMiddleware,
    "n",
    ()=>getSession,
    "o",
    ()=>revokeOtherSessions,
    "r",
    ()=>getSessionFromCtx,
    "s",
    ()=>revokeSession,
    "t",
    ()=>freshSessionMiddleware,
    "u",
    ()=>sessionMiddleware
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/crypto-CFUhAR9W.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/schema-Bb7wzeK_.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/json-CnHxKYpj.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error-BhAKg8LX.mjs [app-route] (ecmascript) <export n as BASE_ERROR_CODES>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/base64.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$binary$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/binary.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/hmac.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
//#region src/api/routes/session.ts
const getSession = ()=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/get-session", {
        method: "GET",
        operationId: "getSession",
        query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["m"],
        requireHeaders: true,
        metadata: {
            openapi: {
                operationId: "getSession",
                description: "Get the current session",
                responses: {
                    "200": {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        session: {
                                            $ref: "#/components/schemas/Session"
                                        },
                                        user: {
                                            $ref: "#/components/schemas/User"
                                        }
                                    },
                                    required: [
                                        "session",
                                        "user"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        try {
            const sessionCookieToken = await ctx.getSignedCookie(ctx.context.authCookies.sessionToken.name, ctx.context.secret);
            if (!sessionCookieToken) return null;
            const sessionDataCookie = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["p"])(ctx, ctx.context.authCookies.sessionData.name);
            let sessionDataPayload = null;
            if (sessionDataCookie) {
                const strategy = ctx.context.options.session?.cookieCache?.strategy || "compact";
                if (strategy === "jwe") {
                    const payload = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["s"])(sessionDataCookie, ctx.context.secret, "better-auth-session");
                    if (payload && payload.session && payload.user) sessionDataPayload = {
                        session: {
                            session: payload.session,
                            user: payload.user,
                            updatedAt: payload.updatedAt,
                            version: payload.version
                        },
                        expiresAt: payload.exp ? payload.exp * 1e3 : Date.now()
                    };
                    else {
                        const dataCookie = ctx.context.authCookies.sessionData.name;
                        ctx.setCookie(dataCookie, "", {
                            maxAge: 0
                        });
                        return ctx.json(null);
                    }
                } else if (strategy === "jwt") {
                    const payload = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["l"])(sessionDataCookie, ctx.context.secret);
                    if (payload && payload.session && payload.user) sessionDataPayload = {
                        session: {
                            session: payload.session,
                            user: payload.user,
                            updatedAt: payload.updatedAt,
                            version: payload.version
                        },
                        expiresAt: payload.exp ? payload.exp * 1e3 : Date.now()
                    };
                    else {
                        const dataCookie = ctx.context.authCookies.sessionData.name;
                        ctx.setCookie(dataCookie, "", {
                            maxAge: 0
                        });
                        return ctx.json(null);
                    }
                } else {
                    const parsed = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$binary$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["binary"].decode(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["base64Url"].decode(sessionDataCookie)));
                    if (parsed) if (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createHMAC"])("SHA-256", "base64urlnopad").verify(ctx.context.secret, JSON.stringify({
                        ...parsed.session,
                        expiresAt: parsed.expiresAt
                    }), parsed.signature)) sessionDataPayload = parsed;
                    else {
                        const dataCookie = ctx.context.authCookies.sessionData.name;
                        ctx.setCookie(dataCookie, "", {
                            maxAge: 0
                        });
                        return ctx.json(null);
                    }
                }
            }
            const dontRememberMe = await ctx.getSignedCookie(ctx.context.authCookies.dontRememberToken.name, ctx.context.secret);
            /**
		* If session data is present in the cookie, check if it should be used or refreshed
		*/ if (sessionDataPayload?.session && ctx.context.options.session?.cookieCache?.enabled && !ctx.query?.disableCookieCache) {
                const session$1 = sessionDataPayload.session;
                const versionConfig = ctx.context.options.session?.cookieCache?.version;
                let expectedVersion = "1";
                if (versionConfig) {
                    if (typeof versionConfig === "string") expectedVersion = versionConfig;
                    else if (typeof versionConfig === "function") {
                        const result = versionConfig(session$1.session, session$1.user);
                        expectedVersion = result instanceof Promise ? await result : result;
                    }
                }
                if ((session$1.version || "1") !== expectedVersion) {
                    const dataCookie = ctx.context.authCookies.sessionData.name;
                    ctx.setCookie(dataCookie, "", {
                        maxAge: 0
                    });
                } else if (sessionDataPayload.expiresAt < Date.now() || session$1.session.expiresAt < /* @__PURE__ */ new Date()) {
                    const dataCookie = ctx.context.authCookies.sessionData.name;
                    ctx.setCookie(dataCookie, "", {
                        maxAge: 0
                    });
                } else {
                    const cookieRefreshCache = ctx.context.sessionConfig.cookieRefreshCache;
                    if (cookieRefreshCache === false) {
                        ctx.context.session = session$1;
                        return ctx.json({
                            session: session$1.session,
                            user: session$1.user
                        });
                    }
                    if (sessionDataPayload.expiresAt - Date.now() < cookieRefreshCache.updateAge * 1e3) {
                        const newExpiresAt = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(ctx.context.options.session?.cookieCache?.maxAge || 300, "sec");
                        const refreshedSession = {
                            session: {
                                ...session$1.session,
                                expiresAt: newExpiresAt
                            },
                            user: session$1.user,
                            updatedAt: Date.now()
                        };
                        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["s"])(ctx, refreshedSession, false);
                        const parsedRefreshedSession = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["s"])(ctx.context.options, {
                            ...refreshedSession.session,
                            expiresAt: new Date(refreshedSession.session.expiresAt),
                            createdAt: new Date(refreshedSession.session.createdAt),
                            updatedAt: new Date(refreshedSession.session.updatedAt)
                        });
                        const parsedRefreshedUser = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["l"])(ctx.context.options, {
                            ...refreshedSession.user,
                            createdAt: new Date(refreshedSession.user.createdAt),
                            updatedAt: new Date(refreshedSession.user.updatedAt)
                        });
                        ctx.context.session = {
                            session: parsedRefreshedSession,
                            user: parsedRefreshedUser
                        };
                        return ctx.json({
                            session: parsedRefreshedSession,
                            user: parsedRefreshedUser
                        });
                    }
                    const parsedSession = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["s"])(ctx.context.options, {
                        ...session$1.session,
                        expiresAt: new Date(session$1.session.expiresAt),
                        createdAt: new Date(session$1.session.createdAt),
                        updatedAt: new Date(session$1.session.updatedAt)
                    });
                    const parsedUser = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["l"])(ctx.context.options, {
                        ...session$1.user,
                        createdAt: new Date(session$1.user.createdAt),
                        updatedAt: new Date(session$1.user.updatedAt)
                    });
                    ctx.context.session = {
                        session: parsedSession,
                        user: parsedUser
                    };
                    return ctx.json({
                        session: parsedSession,
                        user: parsedUser
                    });
                }
            }
            const session = await ctx.context.internalAdapter.findSession(sessionCookieToken);
            ctx.context.session = session;
            if (!session || session.session.expiresAt < /* @__PURE__ */ new Date()) {
                (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])(ctx);
                if (session) /**
			* if session expired clean up the session
			*/ await ctx.context.internalAdapter.deleteSession(session.session.token);
                return ctx.json(null);
            }
            /**
		* We don't need to update the session if the user doesn't want to be remembered
		* or if the session refresh is disabled
		*/ if (dontRememberMe || ctx.query?.disableRefresh) {
                const parsedSession = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["s"])(ctx.context.options, session.session);
                const parsedUser = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["l"])(ctx.context.options, session.user);
                return ctx.json({
                    session: parsedSession,
                    user: parsedUser
                });
            }
            const expiresIn = ctx.context.sessionConfig.expiresIn;
            const updateAge = ctx.context.sessionConfig.updateAge;
            if (session.session.expiresAt.valueOf() - expiresIn * 1e3 + updateAge * 1e3 <= Date.now() && (!ctx.query?.disableRefresh || !ctx.context.options.session?.disableSessionRefresh)) {
                const updatedSession = await ctx.context.internalAdapter.updateSession(session.session.token, {
                    expiresAt: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(ctx.context.sessionConfig.expiresIn, "sec"),
                    updatedAt: /* @__PURE__ */ new Date()
                });
                if (!updatedSession) {
                    /**
				* Handle case where session update fails (e.g., concurrent deletion)
				*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])(ctx);
                    return ctx.json(null, {
                        status: 401
                    });
                }
                const maxAge = (updatedSession.expiresAt.valueOf() - Date.now()) / 1e3;
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, {
                    session: updatedSession,
                    user: session.user
                }, false, {
                    maxAge
                });
                const parsedUpdatedSession = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["s"])(ctx.context.options, updatedSession);
                const parsedUser = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["l"])(ctx.context.options, session.user);
                return ctx.json({
                    session: parsedUpdatedSession,
                    user: parsedUser
                });
            }
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["s"])(ctx, session, !!dontRememberMe);
            return ctx.json(session);
        } catch (error) {
            ctx.context.logger.error("INTERNAL_SERVER_ERROR", error);
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].FAILED_TO_GET_SESSION
            });
        }
    });
const getSessionFromCtx = async (ctx, config)=>{
    if (ctx.context.session) return ctx.context.session;
    const session = await getSession()({
        ...ctx,
        asResponse: false,
        headers: ctx.headers,
        returnHeaders: false,
        returnStatus: false,
        query: {
            ...config,
            ...ctx.query
        }
    }).catch((e)=>{
        return null;
    });
    ctx.context.session = session;
    return session;
};
/**
* The middleware forces the endpoint to require a valid session.
*/ const sessionMiddleware = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
    const session = await getSessionFromCtx(ctx);
    if (!session?.session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
    return {
        session
    };
});
/**
* This middleware forces the endpoint to require a valid session and ignores cookie cache.
* This should be used for sensitive operations like password changes, account deletion, etc.
* to ensure that revoked sessions cannot be used even if they're still cached in cookies.
*/ const sensitiveSessionMiddleware = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
    const session = await getSessionFromCtx(ctx, {
        disableCookieCache: true
    });
    if (!session?.session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
    return {
        session
    };
});
/**
* This middleware allows you to call the endpoint on the client if session is valid.
* However, if called on the server, no session is required.
*/ const requestOnlySessionMiddleware = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
    const session = await getSessionFromCtx(ctx);
    if (!session?.session && (ctx.request || ctx.headers)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
    return {
        session
    };
});
/**
* This middleware forces the endpoint to require a valid session,
* as well as making sure the session is fresh before proceeding.
*
* Session freshness check will be skipped if the session config's freshAge
* is set to 0
*/ const freshSessionMiddleware = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
    const session = await getSessionFromCtx(ctx);
    if (!session?.session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
    if (ctx.context.sessionConfig.freshAge === 0) return {
        session
    };
    const freshAge = ctx.context.sessionConfig.freshAge;
    const lastUpdated = new Date(session.session.updatedAt || session.session.createdAt).getTime();
    if (!(Date.now() - lastUpdated < freshAge * 1e3)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
        message: "Session is not fresh"
    });
    return {
        session
    };
});
/**
* user active sessions list
*/ const listSessions = ()=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/list-sessions", {
        method: "GET",
        operationId: "listUserSessions",
        use: [
            sessionMiddleware
        ],
        requireHeaders: true,
        metadata: {
            openapi: {
                operationId: "listUserSessions",
                description: "List all active sessions for the user",
                responses: {
                    "200": {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "array",
                                    items: {
                                        $ref: "#/components/schemas/Session"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        try {
            const activeSessions = (await ctx.context.internalAdapter.listSessions(ctx.context.session.user.id)).filter((session)=>{
                return session.expiresAt > /* @__PURE__ */ new Date();
            });
            return ctx.json(activeSessions);
        } catch (e) {
            ctx.context.logger.error(e);
            throw ctx.error("INTERNAL_SERVER_ERROR");
        }
    });
/**
* revoke a single session
*/ const revokeSession = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/revoke-session", {
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
        token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
            description: "The token to revoke"
        })
    }),
    use: [
        sensitiveSessionMiddleware
    ],
    requireHeaders: true,
    metadata: {
        openapi: {
            description: "Revoke a single session",
            requestBody: {
                content: {
                    "application/json": {
                        schema: {
                            type: "object",
                            properties: {
                                token: {
                                    type: "string",
                                    description: "The token to revoke"
                                }
                            },
                            required: [
                                "token"
                            ]
                        }
                    }
                }
            },
            responses: {
                "200": {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    status: {
                                        type: "boolean",
                                        description: "Indicates if the session was revoked successfully"
                                    }
                                },
                                required: [
                                    "status"
                                ]
                            }
                        }
                    }
                }
            }
        }
    }
}, async (ctx)=>{
    const token = ctx.body.token;
    if ((await ctx.context.internalAdapter.findSession(token))?.session.userId === ctx.context.session.user.id) try {
        await ctx.context.internalAdapter.deleteSession(token);
    } catch (error) {
        ctx.context.logger.error(error && typeof error === "object" && "name" in error ? error.name : "", error);
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR");
    }
    return ctx.json({
        status: true
    });
});
/**
* revoke all user sessions
*/ const revokeSessions = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/revoke-sessions", {
    method: "POST",
    use: [
        sensitiveSessionMiddleware
    ],
    requireHeaders: true,
    metadata: {
        openapi: {
            description: "Revoke all sessions for the user",
            responses: {
                "200": {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    status: {
                                        type: "boolean",
                                        description: "Indicates if all sessions were revoked successfully"
                                    }
                                },
                                required: [
                                    "status"
                                ]
                            }
                        }
                    }
                }
            }
        }
    }
}, async (ctx)=>{
    try {
        await ctx.context.internalAdapter.deleteSessions(ctx.context.session.user.id);
    } catch (error) {
        ctx.context.logger.error(error && typeof error === "object" && "name" in error ? error.name : "", error);
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR");
    }
    return ctx.json({
        status: true
    });
});
const revokeOtherSessions = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/revoke-other-sessions", {
    method: "POST",
    requireHeaders: true,
    use: [
        sensitiveSessionMiddleware
    ],
    metadata: {
        openapi: {
            description: "Revoke all other sessions for the user except the current one",
            responses: {
                "200": {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    status: {
                                        type: "boolean",
                                        description: "Indicates if all other sessions were revoked successfully"
                                    }
                                },
                                required: [
                                    "status"
                                ]
                            }
                        }
                    }
                }
            }
        }
    }
}, async (ctx)=>{
    const session = ctx.context.session;
    if (!session.user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
    const otherSessions = (await ctx.context.internalAdapter.listSessions(session.user.id)).filter((session$1)=>{
        return session$1.expiresAt > /* @__PURE__ */ new Date();
    }).filter((session$1)=>session$1.token !== ctx.context.session.session.token);
    await Promise.all(otherSessions.map((session$1)=>ctx.context.internalAdapter.deleteSession(session$1.token)));
    return ctx.json({
        status: true
    });
});
;
}),
"[project]/node_modules/better-auth/dist/password-BFQK0cLg.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "n",
    ()=>validatePassword,
    "t",
    ()=>checkPassword
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript)");
;
//#region src/utils/password.ts
async function validatePassword(ctx, data) {
    const credentialAccount = (await ctx.context.internalAdapter.findAccounts(data.userId))?.find((account)=>account.providerId === "credential");
    const currentPassword = credentialAccount?.password;
    if (!credentialAccount || !currentPassword) return false;
    return await ctx.context.password.verify({
        hash: currentPassword,
        password: data.password
    });
}
async function checkPassword(userId, c) {
    const credentialAccount = (await c.context.internalAdapter.findAccounts(userId))?.find((account)=>account.providerId === "credential");
    const currentPassword = credentialAccount?.password;
    if (!credentialAccount || !currentPassword || !c.body.password) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "No password credential found"
    });
    if (!await c.context.password.verify({
        hash: currentPassword,
        password: c.body.password
    })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Invalid password"
    });
    return true;
}
;
}),
"[project]/node_modules/better-auth/dist/base-CiRMFqet.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "n",
    ()=>createAuthContext,
    "t",
    ()=>createBetterAuth
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/get-model-name-D4DUV7S2.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$migration$2d$Bf0TuCzm$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/get-migration-Bf0TuCzm.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2d$db7gNqd$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/utils-db7gNqd-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/crypto-CFUhAR9W.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$url$2d$CB8xCwz$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/url-CB8xCwz-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api-CkmycQ2x.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$password$2d$BFQK0cLg$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/password-BFQK0cLg.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/context/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__r__as__runWithAdapter$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/context-DgQ9XGBl.mjs [app-route] (ecmascript) <export r as runWithAdapter>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__createLogger$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env-8yWFh7b8.mjs [app-route] (ecmascript) <export n as createLogger>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env-8yWFh7b8.mjs [app-route] (ecmascript) <export c as env>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__f__as__isProduction$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env-8yWFh7b8.mjs [app-route] (ecmascript) <export f as isProduction>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__p__as__isTest$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env-8yWFh7b8.mjs [app-route] (ecmascript) <export p as isTest>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error-BhAKg8LX.mjs [app-route] (ecmascript) <export n as BASE_ERROR_CODES>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error-BhAKg8LX.mjs [app-route] (ecmascript) <export t as BetterAuthError>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$social$2d$providers$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/social-providers/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$telemetry$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/telemetry/dist/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$defu$2f$dist$2f$defu$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/defu/dist/defu.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
;
;
;
//#region src/utils/constants.ts
const DEFAULT_SECRET = "better-auth-secret-12345678901234567890";
//#endregion
//#region src/utils/is-promise.ts
function isPromise(obj) {
    return !!obj && (typeof obj === "object" || typeof obj === "function") && typeof obj.then === "function";
}
//#endregion
//#region src/context/helpers.ts
async function runPluginInit(ctx) {
    let options = ctx.options;
    const plugins = options.plugins || [];
    let context = ctx;
    const dbHooks = [];
    for (const plugin of plugins)if (plugin.init) {
        let initPromise = plugin.init(context);
        let result;
        if (isPromise(initPromise)) result = await initPromise;
        else result = initPromise;
        if (typeof result === "object") {
            if (result.options) {
                const { databaseHooks, ...restOpts } = result.options;
                if (databaseHooks) dbHooks.push(databaseHooks);
                options = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$defu$2f$dist$2f$defu$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["defu"])(options, restOpts);
            }
            if (result.context) context = {
                ...context,
                ...result.context
            };
        }
    }
    dbHooks.push(options.databaseHooks);
    context.internalAdapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$migration$2d$Bf0TuCzm$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["a"])(context.adapter, {
        options,
        logger: context.logger,
        hooks: dbHooks.filter((u)=>u !== void 0),
        generateId: context.generateId
    });
    context.options = options;
    return {
        context
    };
}
function getInternalPlugins(options) {
    const plugins = [];
    if (options.advanced?.crossSubDomainCookies?.enabled) {}
    return plugins;
}
function getTrustedOrigins(options) {
    const baseURL = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$url$2d$CB8xCwz$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(options.baseURL, options.basePath);
    if (!baseURL) return [];
    const trustedOrigins = [
        new URL(baseURL).origin
    ];
    if (options.trustedOrigins && Array.isArray(options.trustedOrigins)) trustedOrigins.push(...options.trustedOrigins);
    const envTrustedOrigins = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__["env"].BETTER_AUTH_TRUSTED_ORIGINS;
    if (envTrustedOrigins) trustedOrigins.push(...envTrustedOrigins.split(","));
    if (trustedOrigins.filter((x)=>!x).length) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("A provided trusted origin is invalid, make sure your trusted origins list is properly defined.");
    return trustedOrigins;
}
//#endregion
//#region src/context/create-context.ts
/**
* Estimates the entropy of a string in bits.
* This is a simple approximation that helps detect low-entropy secrets.
*/ function estimateEntropy(str) {
    const unique = new Set(str).size;
    if (unique === 0) return 0;
    return Math.log2(Math.pow(unique, str.length));
}
/**
* Validates that the secret meets minimum security requirements.
* Throws BetterAuthError if the secret is invalid.
* Skips validation for DEFAULT_SECRET in test environments only.
* Only throws for DEFAULT_SECRET in production environment.
*/ function validateSecret(secret, logger$1) {
    const isDefaultSecret = secret === DEFAULT_SECRET;
    if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__p__as__isTest$3e$__["isTest"])()) return;
    if (isDefaultSecret && __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__f__as__isProduction$3e$__["isProduction"]) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("You are using the default secret. Please set `BETTER_AUTH_SECRET` in your environment variables or pass `secret` in your auth config.");
    if (!secret) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("BETTER_AUTH_SECRET is missing. Set it in your environment or pass `secret` to betterAuth({ secret }).");
    if (secret.length < 32) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`Invalid BETTER_AUTH_SECRET: must be at least 32 characters long for adequate security. Generate one with \`npx @better-auth/cli secret\` or \`openssl rand -base64 32\`.`);
    if (estimateEntropy(secret) < 120) logger$1.warn("[better-auth] Warning: your BETTER_AUTH_SECRET appears low-entropy. Use a randomly generated secret for production.");
}
async function createAuthContext(adapter, options, getDatabaseType) {
    if (!options.database) options = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$defu$2f$dist$2f$defu$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(options, {
        session: {
            cookieCache: {
                enabled: true,
                strategy: "jwe",
                refreshCache: true
            }
        },
        account: {
            storeStateStrategy: "cookie",
            storeAccountCookie: true
        }
    });
    const plugins = options.plugins || [];
    const internalPlugins = getInternalPlugins(options);
    const logger$1 = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__createLogger$3e$__["createLogger"])(options.logger);
    const baseURL = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$url$2d$CB8xCwz$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(options.baseURL, options.basePath);
    const secret = options.secret || __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__["env"].BETTER_AUTH_SECRET || __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__["env"].AUTH_SECRET || DEFAULT_SECRET;
    validateSecret(secret, logger$1);
    options = {
        ...options,
        secret,
        baseURL: baseURL ? new URL(baseURL).origin : "",
        basePath: options.basePath || "/api/auth",
        plugins: plugins.concat(internalPlugins)
    };
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["n"])(options, logger$1);
    const cookies = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["i"])(options);
    const tables = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["a"])(options);
    const providers = Object.entries(options.socialProviders || {}).map(([key, config])=>{
        if (config == null) return null;
        if (config.enabled === false) return null;
        if (!config.clientId) logger$1.warn(`Social provider ${key} is missing clientId or clientSecret`);
        const provider = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$social$2d$providers$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["socialProviders"][key](config);
        provider.disableImplicitSignUp = config.disableImplicitSignUp;
        return provider;
    }).filter((x)=>x !== null);
    const generateIdFunc = ({ model, size })=>{
        if (typeof options.advanced?.generateId === "function") return options.advanced.generateId({
            model,
            size
        });
        if (typeof options?.advanced?.database?.generateId === "function") return options.advanced.database.generateId({
            model,
            size
        });
        return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2d$db7gNqd$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(size);
    };
    const { publish } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$telemetry$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createTelemetry"])(options, {
        adapter: adapter.id,
        database: typeof options.database === "function" ? "adapter" : getDatabaseType(options.database)
    });
    const initOrPromise = runPluginInit({
        appName: options.appName || "Better Auth",
        socialProviders: providers,
        options,
        oauthConfig: {
            storeStateStrategy: options.account?.storeStateStrategy || "database",
            skipStateCookieCheck: !!options.account?.skipStateCookieCheck
        },
        tables,
        trustedOrigins: getTrustedOrigins(options),
        baseURL: baseURL || "",
        sessionConfig: {
            updateAge: options.session?.updateAge !== void 0 ? options.session.updateAge : 1440 * 60,
            expiresIn: options.session?.expiresIn || 3600 * 24 * 7,
            freshAge: options.session?.freshAge === void 0 ? 3600 * 24 : options.session.freshAge,
            cookieRefreshCache: (()=>{
                const refreshCache = options.session?.cookieCache?.refreshCache;
                const maxAge = options.session?.cookieCache?.maxAge || 300;
                if (refreshCache === false || refreshCache === void 0) return false;
                if (refreshCache === true) return {
                    enabled: true,
                    updateAge: Math.floor(maxAge * .2)
                };
                return {
                    enabled: true,
                    updateAge: refreshCache.updateAge !== void 0 ? refreshCache.updateAge : Math.floor(maxAge * .2)
                };
            })()
        },
        secret,
        rateLimit: {
            ...options.rateLimit,
            enabled: options.rateLimit?.enabled ?? __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__f__as__isProduction$3e$__["isProduction"],
            window: options.rateLimit?.window || 10,
            max: options.rateLimit?.max || 100,
            storage: options.rateLimit?.storage || (options.secondaryStorage ? "secondary-storage" : "memory")
        },
        authCookies: cookies,
        logger: logger$1,
        generateId: generateIdFunc,
        session: null,
        secondaryStorage: options.secondaryStorage,
        password: {
            hash: options.emailAndPassword?.password?.hash || __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["i"],
            verify: options.emailAndPassword?.password?.verify || __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["a"],
            config: {
                minPasswordLength: options.emailAndPassword?.minPasswordLength || 8,
                maxPasswordLength: options.emailAndPassword?.maxPasswordLength || 128
            },
            checkPassword: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$password$2d$BFQK0cLg$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"]
        },
        setNewSession (session) {
            this.newSession = session;
        },
        newSession: null,
        adapter,
        internalAdapter: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$migration$2d$Bf0TuCzm$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["a"])(adapter, {
            options,
            logger: logger$1,
            hooks: options.databaseHooks ? [
                options.databaseHooks
            ] : [],
            generateId: generateIdFunc
        }),
        createAuthCookie: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(options),
        async runMigrations () {
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("runMigrations will be set by the specific init implementation");
        },
        publishTelemetry: publish,
        skipCSRFCheck: !!options.advanced?.disableCSRFCheck,
        skipOriginCheck: options.advanced?.disableOriginCheck !== void 0 ? options.advanced.disableOriginCheck : (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__p__as__isTest$3e$__["isTest"])() ? true : false
    });
    let context;
    if (isPromise(initOrPromise)) ({ context } = await initOrPromise);
    else ({ context } = initOrPromise);
    return context;
}
//#endregion
//#region src/auth/base.ts
const createBetterAuth = (options, initFn)=>{
    const authContext = initFn(options);
    const { api } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["a"])(authContext, options);
    return {
        handler: async (request)=>{
            const ctx = await authContext;
            const basePath = ctx.options.basePath || "/api/auth";
            if (!ctx.options.baseURL) {
                const baseURL = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$url$2d$CB8xCwz$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(void 0, basePath, request, void 0, ctx.options.advanced?.trustedProxyHeaders);
                if (baseURL) {
                    ctx.baseURL = baseURL;
                    ctx.options.baseURL = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$url$2d$CB8xCwz$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(ctx.baseURL) || void 0;
                } else throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("Could not get base URL from request. Please provide a valid base URL.");
            }
            ctx.trustedOrigins = [
                ...options.trustedOrigins ? Array.isArray(options.trustedOrigins) ? options.trustedOrigins : await options.trustedOrigins(request) : [],
                ctx.options.baseURL
            ];
            const { handler } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["s"])(ctx, options);
            return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__r__as__runWithAdapter$3e$__["runWithAdapter"])(ctx.adapter, ()=>handler(request));
        },
        api,
        options,
        $context: authContext,
        $ERROR_CODES: {
            ...options.plugins?.reduce((acc, plugin)=>{
                if (plugin.$ERROR_CODES) return {
                    ...acc,
                    ...plugin.$ERROR_CODES
                };
                return acc;
            }, {}),
            ...__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"]
        }
    };
};
;
}),
"[project]/node_modules/better-auth/dist/auth-DfR8_5w3.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>betterAuth
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$dialect$2d$D9ZUZA4J$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/dialect-D9ZUZA4J.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$migration$2d$Bf0TuCzm$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/get-migration-Bf0TuCzm.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$base$2d$CiRMFqet$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/base-CiRMFqet.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error-BhAKg8LX.mjs [app-route] (ecmascript) <export t as BetterAuthError>");
;
;
;
;
//#region src/context/init.ts
const init = async (options)=>{
    const adapter = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$migration$2d$Bf0TuCzm$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(options);
    const getDatabaseType = (database)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$dialect$2d$D9ZUZA4J$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])(database) || "unknown";
    const ctx = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$base$2d$CiRMFqet$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])(adapter, options, getDatabaseType);
    ctx.runMigrations = async function() {
        if (!options.database || "updateMany" in options.database) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("Database is not provided or it's an adapter. Migrations are only supported with a database instance.");
        const { runMigrations } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$migration$2d$Bf0TuCzm$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(options);
        await runMigrations();
    };
    return ctx;
};
//#endregion
//#region src/auth/auth.ts
/**
* Better Auth initializer for full mode (with Kysely)
*
* Check `minimal.ts` for minimal mode (without Kysely)
*/ const betterAuth = (options)=>{
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$base$2d$CiRMFqet$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(options, init);
};
;
}),
"[project]/node_modules/better-auth/dist/types-BOTDmeLz.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([]);
;
}),
"[project]/node_modules/better-auth/dist/index.mjs [app-route] (ecmascript) <locals>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$dialect$2d$D9ZUZA4J$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/dialect-D9ZUZA4J.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/get-model-name-D4DUV7S2.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$migration$2d$Bf0TuCzm$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/get-migration-Bf0TuCzm.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2d$db7gNqd$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/utils-db7gNqd-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/crypto-CFUhAR9W.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$misc$2d$BwNc0MKr$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/misc-BwNc0MKr.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/schema-Bb7wzeK_.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$request$2d$ip$2d$D6st$2d$mto$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/get-request-ip-D6st-mto.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/json-CnHxKYpj.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$url$2d$CB8xCwz$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/url-CB8xCwz-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api-CkmycQ2x.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript) <export APIError as t>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/session-AaRl3_x-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$base$2d$CiRMFqet$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/base-CiRMFqet.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$password$2d$BFQK0cLg$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/password-BFQK0cLg.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$auth$2d$DfR8_5w3$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/auth-DfR8_5w3.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$types$2d$BOTDmeLz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/types-BOTDmeLz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/context/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__getCurrentAdapter$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/context-DgQ9XGBl.mjs [app-route] (ecmascript) <export t as getCurrentAdapter>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$telemetry$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/telemetry/dist/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$db$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/db/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$oauth2$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/oauth2/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
}),
"[project]/node_modules/better-auth/dist/auth-DfR8_5w3.mjs [app-route] (ecmascript) <export t as betterAuth>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "betterAuth",
    ()=>__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$auth$2d$DfR8_5w3$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"]
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$auth$2d$DfR8_5w3$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/auth-DfR8_5w3.mjs [app-route] (ecmascript)");
}),
"[project]/node_modules/better-auth/dist/adapter-factory-HF3JB9cT.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "n",
    ()=>initGetFieldAttributes,
    "r",
    ()=>initGetIdField,
    "t",
    ()=>createAdapterFactory
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/get-model-name-D4DUV7S2.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2d$db7gNqd$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/utils-db7gNqd-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/json-CnHxKYpj.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__TTY_COLORS$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env-8yWFh7b8.mjs [app-route] (ecmascript) <export t as TTY_COLORS>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__o__as__getColorDepth$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env-8yWFh7b8.mjs [app-route] (ecmascript) <export o as getColorDepth>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__logger$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env-8yWFh7b8.mjs [app-route] (ecmascript) <export i as logger>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error-BhAKg8LX.mjs [app-route] (ecmascript) <export t as BetterAuthError>");
;
;
;
;
;
//#region src/adapters/utils.ts
function withApplyDefault(value, field, action) {
    if (action === "update") {
        if (value === void 0 && field.onUpdate !== void 0) {
            if (typeof field.onUpdate === "function") return field.onUpdate();
            return field.onUpdate;
        }
        return value;
    }
    if (action === "create") {
        if (value === void 0 || field.required === true && value === null) {
            if (field.defaultValue !== void 0) {
                if (typeof field.defaultValue === "function") return field.defaultValue();
                return field.defaultValue;
            }
        }
    }
    return value;
}
//#endregion
//#region src/adapters/adapter-factory/get-id-field.ts
const initGetIdField = ({ usePlural, schema, disableIdGeneration, options, customIdGenerator, supportsUUIDs })=>{
    const getDefaultModelName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["i"])({
        usePlural,
        schema
    });
    const idField = ({ customModelName, forceAllowId })=>{
        const useNumberId = options.advanced?.database?.useNumberId || options.advanced?.database?.generateId === "serial";
        const useUUIDs = options.advanced?.database?.generateId === "uuid";
        let shouldGenerateId = (()=>{
            if (disableIdGeneration) return false;
            else if (useNumberId && !forceAllowId) return false;
            else if (useUUIDs) return !supportsUUIDs;
            else return true;
        })();
        const model = getDefaultModelName(customModelName ?? "id");
        return {
            type: useNumberId ? "number" : "string",
            required: shouldGenerateId ? true : false,
            ...shouldGenerateId ? {
                defaultValue () {
                    if (disableIdGeneration) return void 0;
                    let generateId$1 = options.advanced?.database?.generateId;
                    if (generateId$1 === false || useNumberId) return void 0;
                    if (typeof generateId$1 === "function") return generateId$1({
                        model
                    });
                    if (customIdGenerator) return customIdGenerator({
                        model
                    });
                    if (generateId$1 === "uuid") return crypto.randomUUID();
                    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2d$db7gNqd$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])();
                }
            } : {},
            transform: {
                input: (value)=>{
                    if (!value) return void 0;
                    if (useNumberId) {
                        const numberValue = Number(value);
                        if (isNaN(numberValue)) return;
                        return numberValue;
                    }
                    if (useUUIDs) {
                        if (shouldGenerateId && !forceAllowId) return value;
                        if (disableIdGeneration) return void 0;
                        if (supportsUUIDs) return void 0;
                        if (forceAllowId && typeof value === "string") if (/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(value)) return value;
                        else {
                            const stack = /* @__PURE__ */ new Error().stack?.split("\n").filter((_, i)=>i !== 1).join("\n").replace("Error:", "");
                            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__logger$3e$__["logger"].warn("[Adapter Factory] - Invalid UUID value for field `id` provided when `forceAllowId` is true. Generating a new UUID.", stack);
                        }
                        if (typeof value !== "string" && !supportsUUIDs) return crypto.randomUUID();
                        return;
                    }
                    return value;
                },
                output: (value)=>{
                    if (!value) return void 0;
                    return String(value);
                }
            }
        };
    };
    return idField;
};
//#endregion
//#region src/adapters/adapter-factory/get-field-attributes.ts
const initGetFieldAttributes = ({ usePlural, schema, options, customIdGenerator, disableIdGeneration })=>{
    const getDefaultModelName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["i"])({
        usePlural,
        schema
    });
    const getDefaultFieldName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])({
        usePlural,
        schema
    });
    const idField = initGetIdField({
        usePlural,
        schema,
        options,
        customIdGenerator,
        disableIdGeneration
    });
    const getFieldAttributes = ({ model, field })=>{
        const defaultModelName = getDefaultModelName(model);
        const defaultFieldName = getDefaultFieldName({
            field,
            model: defaultModelName
        });
        const fields = schema[defaultModelName].fields;
        fields.id = idField({
            customModelName: defaultModelName
        });
        const fieldAttributes = fields[defaultFieldName];
        if (!fieldAttributes) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`Field ${field} not found in model ${model}`);
        return fieldAttributes;
    };
    return getFieldAttributes;
};
//#endregion
//#region src/adapters/adapter-factory/index.ts
let debugLogs = [];
let transactionId = -1;
const createAsIsTransaction = (adapter)=>(fn)=>fn(adapter);
const createAdapterFactory = ({ adapter: customAdapter, config: cfg })=>(options)=>{
        const uniqueAdapterFactoryInstanceId = Math.random().toString(36).substring(2, 15);
        const config = {
            ...cfg,
            supportsBooleans: cfg.supportsBooleans ?? true,
            supportsDates: cfg.supportsDates ?? true,
            supportsJSON: cfg.supportsJSON ?? false,
            adapterName: cfg.adapterName ?? cfg.adapterId,
            supportsNumericIds: cfg.supportsNumericIds ?? true,
            supportsUUIDs: cfg.supportsUUIDs ?? false,
            transaction: cfg.transaction ?? false,
            disableTransformInput: cfg.disableTransformInput ?? false,
            disableTransformOutput: cfg.disableTransformOutput ?? false,
            disableTransformJoin: cfg.disableTransformJoin ?? false
        };
        if ((options.advanced?.database?.useNumberId === true || options.advanced?.database?.generateId === "serial") && config.supportsNumericIds === false) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`[${config.adapterName}] Your database or database adapter does not support numeric ids. Please disable "useNumberId" in your config.`);
        const schema = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["a"])(options);
        const debugLog = (...args)=>{
            if (config.debugLogs === true || typeof config.debugLogs === "object") {
                if (typeof config.debugLogs === "object" && "isRunningAdapterTests" in config.debugLogs) {
                    if (config.debugLogs.isRunningAdapterTests) {
                        args.shift();
                        debugLogs.push({
                            instance: uniqueAdapterFactoryInstanceId,
                            args
                        });
                    }
                    return;
                }
                if (typeof config.debugLogs === "object" && config.debugLogs.logCondition && !config.debugLogs.logCondition?.()) return;
                if (typeof args[0] === "object" && "method" in args[0]) {
                    const method = args.shift().method;
                    if (typeof config.debugLogs === "object") {
                        if (method === "create" && !config.debugLogs.create) return;
                        else if (method === "update" && !config.debugLogs.update) return;
                        else if (method === "updateMany" && !config.debugLogs.updateMany) return;
                        else if (method === "findOne" && !config.debugLogs.findOne) return;
                        else if (method === "findMany" && !config.debugLogs.findMany) return;
                        else if (method === "delete" && !config.debugLogs.delete) return;
                        else if (method === "deleteMany" && !config.debugLogs.deleteMany) return;
                        else if (method === "count" && !config.debugLogs.count) return;
                    }
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__logger$3e$__["logger"].info(`[${config.adapterName}]`, ...args);
                } else __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__logger$3e$__["logger"].info(`[${config.adapterName}]`, ...args);
            }
        };
        const getDefaultModelName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["i"])({
            usePlural: config.usePlural,
            schema
        });
        const getDefaultFieldName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])({
            usePlural: config.usePlural,
            schema
        });
        const getModelName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
            usePlural: config.usePlural,
            schema
        });
        const getFieldName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])({
            schema,
            usePlural: config.usePlural
        });
        const idField = initGetIdField({
            schema,
            options,
            usePlural: config.usePlural,
            disableIdGeneration: config.disableIdGeneration,
            customIdGenerator: config.customIdGenerator,
            supportsUUIDs: config.supportsUUIDs
        });
        const getFieldAttributes = initGetFieldAttributes({
            schema,
            options,
            usePlural: config.usePlural,
            disableIdGeneration: config.disableIdGeneration,
            customIdGenerator: config.customIdGenerator
        });
        const transformInput = async (data, defaultModelName, action, forceAllowId)=>{
            const transformedData = {};
            const fields = schema[defaultModelName].fields;
            const newMappedKeys = config.mapKeysTransformInput ?? {};
            const useNumberId = options.advanced?.database?.useNumberId || options.advanced?.database?.generateId === "serial";
            fields.id = idField({
                customModelName: defaultModelName,
                forceAllowId: forceAllowId && "id" in data
            });
            for(const field in fields){
                let value = data[field];
                const fieldAttributes = fields[field];
                let newFieldName = newMappedKeys[field] || fields[field].fieldName || field;
                if (value === void 0 && (fieldAttributes.defaultValue === void 0 && !fieldAttributes.transform?.input && !(action === "update" && fieldAttributes.onUpdate) || action === "update" && !fieldAttributes.onUpdate)) continue;
                if (fieldAttributes && fieldAttributes.type === "date" && !(value instanceof Date) && typeof value === "string") try {
                    value = new Date(value);
                } catch  {
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__logger$3e$__["logger"].error("[Adapter Factory] Failed to convert string to date", {
                        value,
                        field
                    });
                }
                let newValue = withApplyDefault(value, fieldAttributes, action);
                if (fieldAttributes.transform?.input) newValue = await fieldAttributes.transform.input(newValue);
                if (fieldAttributes.references?.field === "id" && useNumberId) if (Array.isArray(newValue)) newValue = newValue.map((x)=>x !== null ? Number(x) : null);
                else newValue = newValue !== null ? Number(newValue) : null;
                else if (config.supportsJSON === false && typeof newValue === "object" && fieldAttributes.type === "json") newValue = JSON.stringify(newValue);
                else if (config.supportsJSON === false && Array.isArray(newValue) && (fieldAttributes.type === "string[]" || fieldAttributes.type === "number[]")) newValue = JSON.stringify(newValue);
                else if (config.supportsDates === false && newValue instanceof Date && fieldAttributes.type === "date") newValue = newValue.toISOString();
                else if (config.supportsBooleans === false && typeof newValue === "boolean") newValue = newValue ? 1 : 0;
                if (config.customTransformInput) newValue = config.customTransformInput({
                    data: newValue,
                    action,
                    field: newFieldName,
                    fieldAttributes,
                    model: getModelName(defaultModelName),
                    schema,
                    options
                });
                if (newValue !== void 0) transformedData[newFieldName] = newValue;
            }
            return transformedData;
        };
        const transformOutput = async (data, unsafe_model, select = [], join)=>{
            const transformSingleOutput = async (data$1, unsafe_model$1, select$1 = [])=>{
                if (!data$1) return null;
                const newMappedKeys = config.mapKeysTransformOutput ?? {};
                const transformedData$1 = {};
                const tableSchema = schema[getDefaultModelName(unsafe_model$1)].fields;
                const idKey = Object.entries(newMappedKeys).find(([_, v])=>v === "id")?.[0];
                tableSchema[idKey ?? "id"] = {
                    type: options.advanced?.database?.useNumberId || options.advanced?.database?.generateId === "serial" ? "number" : "string"
                };
                for(const key in tableSchema){
                    if (select$1.length && !select$1.includes(key)) continue;
                    const field = tableSchema[key];
                    if (field) {
                        const originalKey = field.fieldName || key;
                        let newValue = data$1[Object.entries(newMappedKeys).find(([_, v])=>v === originalKey)?.[0] || originalKey];
                        if (field.transform?.output) newValue = await field.transform.output(newValue);
                        let newFieldName = newMappedKeys[key] || key;
                        if (originalKey === "id" || field.references?.field === "id") {
                            if (typeof newValue !== "undefined" && newValue !== null) newValue = String(newValue);
                        } else if (config.supportsJSON === false && typeof newValue === "string" && field.type === "json") newValue = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(newValue);
                        else if (config.supportsJSON === false && typeof newValue === "string" && (field.type === "string[]" || field.type === "number[]")) newValue = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(newValue);
                        else if (config.supportsDates === false && typeof newValue === "string" && field.type === "date") newValue = new Date(newValue);
                        else if (config.supportsBooleans === false && typeof newValue === "number" && field.type === "boolean") newValue = newValue === 1;
                        if (config.customTransformOutput) newValue = config.customTransformOutput({
                            data: newValue,
                            field: newFieldName,
                            fieldAttributes: field,
                            select: select$1,
                            model: getModelName(unsafe_model$1),
                            schema,
                            options
                        });
                        transformedData$1[newFieldName] = newValue;
                    }
                }
                return transformedData$1;
            };
            if (!join || Object.keys(join).length === 0) return await transformSingleOutput(data, unsafe_model, select);
            unsafe_model = getDefaultModelName(unsafe_model);
            let transformedData = await transformSingleOutput(data, unsafe_model, select);
            const requiredModels = Object.entries(join).map(([model, joinConfig])=>({
                    modelName: getModelName(model),
                    defaultModelName: getDefaultModelName(model),
                    joinConfig
                }));
            if (!data) return null;
            for (const { modelName, defaultModelName, joinConfig } of requiredModels){
                let joinedData = await (async ()=>{
                    if (options.experimental?.joins) return data[modelName];
                    else return await handleFallbackJoin({
                        baseModel: unsafe_model,
                        baseData: transformedData,
                        joinModel: modelName,
                        specificJoinConfig: joinConfig
                    });
                })();
                if (joinedData === void 0 || joinedData === null) joinedData = joinConfig.relation === "one-to-one" ? null : [];
                if (joinConfig.relation === "one-to-many" && !Array.isArray(joinedData)) joinedData = [
                    joinedData
                ];
                let transformed = [];
                if (Array.isArray(joinedData)) for (const item of joinedData){
                    const transformedItem = await transformSingleOutput(item, modelName, []);
                    transformed.push(transformedItem);
                }
                else {
                    const transformedItem = await transformSingleOutput(joinedData, modelName, []);
                    transformed.push(transformedItem);
                }
                transformedData[defaultModelName] = (joinConfig.relation === "one-to-one" ? transformed[0] : transformed) ?? null;
            }
            return transformedData;
        };
        const transformWhereClause = ({ model, where })=>{
            if (!where) return void 0;
            const newMappedKeys = config.mapKeysTransformInput ?? {};
            return where.map((w)=>{
                const { field: unsafe_field, value, operator = "eq", connector = "AND" } = w;
                if (operator === "in") {
                    if (!Array.isArray(value)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("Value must be an array");
                }
                let newValue = value;
                const defaultModelName = getDefaultModelName(model);
                const defaultFieldName = getDefaultFieldName({
                    field: unsafe_field,
                    model
                });
                const fieldName = newMappedKeys[defaultFieldName] || getFieldName({
                    field: defaultFieldName,
                    model: defaultModelName
                });
                const fieldAttr = getFieldAttributes({
                    field: defaultFieldName,
                    model: defaultModelName
                });
                const useNumberId = options.advanced?.database?.useNumberId || options.advanced?.database?.generateId === "serial";
                if (defaultFieldName === "id" || fieldAttr.references?.field === "id") {
                    if (useNumberId) if (Array.isArray(value)) newValue = value.map(Number);
                    else newValue = Number(value);
                }
                if (fieldAttr.type === "date" && value instanceof Date && !config.supportsDates) newValue = value.toISOString();
                if (fieldAttr.type === "boolean" && typeof value === "boolean" && !config.supportsBooleans) newValue = value ? 1 : 0;
                if (fieldAttr.type === "json" && typeof value === "object" && !config.supportsJSON) try {
                    newValue = JSON.stringify(value);
                } catch (error) {
                    throw new Error(`Failed to stringify JSON value for field ${fieldName}`, {
                        cause: error
                    });
                }
                return {
                    operator,
                    connector,
                    field: fieldName,
                    value: newValue
                };
            });
        };
        const transformJoinClause = (baseModel, unsanitizedJoin, select)=>{
            if (!unsanitizedJoin) return void 0;
            if (Object.keys(unsanitizedJoin).length === 0) return void 0;
            const transformedJoin = {};
            for (const [model, join] of Object.entries(unsanitizedJoin)){
                if (!join) continue;
                const defaultModelName = getDefaultModelName(model);
                const defaultBaseModelName = getDefaultModelName(baseModel);
                let foreignKeys = Object.entries(schema[defaultModelName].fields).filter(([field, fieldAttributes])=>fieldAttributes.references && getDefaultModelName(fieldAttributes.references.model) === defaultBaseModelName);
                let isForwardJoin = true;
                if (!foreignKeys.length) {
                    foreignKeys = Object.entries(schema[defaultBaseModelName].fields).filter(([field, fieldAttributes])=>fieldAttributes.references && getDefaultModelName(fieldAttributes.references.model) === defaultModelName);
                    isForwardJoin = false;
                }
                if (!foreignKeys.length) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`No foreign key found for model ${model} and base model ${baseModel} while performing join operation.`);
                else if (foreignKeys.length > 1) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`Multiple foreign keys found for model ${model} and base model ${baseModel} while performing join operation. Only one foreign key is supported.`);
                const [foreignKey, foreignKeyAttributes] = foreignKeys[0];
                if (!foreignKeyAttributes.references) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`No references found for foreign key ${foreignKey} on model ${model} while performing join operation.`);
                let from;
                let to;
                let requiredSelectField;
                if (isForwardJoin) {
                    requiredSelectField = foreignKeyAttributes.references.field;
                    from = getFieldName({
                        model: baseModel,
                        field: requiredSelectField
                    });
                    to = getFieldName({
                        model,
                        field: foreignKey
                    });
                } else {
                    requiredSelectField = foreignKey;
                    from = getFieldName({
                        model: baseModel,
                        field: requiredSelectField
                    });
                    to = getFieldName({
                        model,
                        field: foreignKeyAttributes.references.field
                    });
                }
                if (select && !select.includes(requiredSelectField)) select.push(requiredSelectField);
                const isUnique = to === "id" ? true : foreignKeyAttributes.unique ?? false;
                let limit = options.advanced?.database?.defaultFindManyLimit ?? 100;
                if (isUnique) limit = 1;
                else if (typeof join === "object" && typeof join.limit === "number") limit = join.limit;
                transformedJoin[getModelName(model)] = {
                    on: {
                        from,
                        to
                    },
                    limit,
                    relation: isUnique ? "one-to-one" : "one-to-many"
                };
            }
            return {
                join: transformedJoin,
                select
            };
        };
        /**
	* Handle joins by making separate queries and combining results (fallback for adapters that don't support native joins).
	*/ const handleFallbackJoin = async ({ baseModel, baseData, joinModel, specificJoinConfig: joinConfig })=>{
            if (!baseData) return baseData;
            const modelName = getModelName(joinModel);
            const field = joinConfig.on.to;
            const value = baseData[getDefaultFieldName({
                field: joinConfig.on.from,
                model: baseModel
            })];
            if (value === null || value === void 0) return joinConfig.relation === "one-to-one" ? null : [];
            let result;
            const where = transformWhereClause({
                model: modelName,
                where: [
                    {
                        field,
                        value,
                        operator: "eq",
                        connector: "AND"
                    }
                ]
            });
            try {
                if (joinConfig.relation === "one-to-one") result = await adapterInstance.findOne({
                    model: modelName,
                    where
                });
                else {
                    const limit = joinConfig.limit ?? options.advanced?.database?.defaultFindManyLimit ?? 100;
                    result = await adapterInstance.findMany({
                        model: modelName,
                        where,
                        limit
                    });
                }
            } catch (error) {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__logger$3e$__["logger"].error(`Failed to query fallback join for model ${modelName}:`, {
                    where,
                    limit: joinConfig.limit
                });
                console.error(error);
                throw error;
            }
            return result;
        };
        const adapterInstance = customAdapter({
            options,
            schema,
            debugLog,
            getFieldName,
            getModelName,
            getDefaultModelName,
            getDefaultFieldName,
            getFieldAttributes,
            transformInput,
            transformOutput,
            transformWhereClause
        });
        let lazyLoadTransaction = null;
        const adapter = {
            transaction: async (cb)=>{
                if (!lazyLoadTransaction) if (!config.transaction) lazyLoadTransaction = createAsIsTransaction(adapter);
                else {
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__logger$3e$__["logger"].debug(`[${config.adapterName}] - Using provided transaction implementation.`);
                    lazyLoadTransaction = config.transaction;
                }
                return lazyLoadTransaction(cb);
            },
            create: async ({ data: unsafeData, model: unsafeModel, select, forceAllowId = false })=>{
                transactionId++;
                let thisTransactionId = transactionId;
                const model = getModelName(unsafeModel);
                unsafeModel = getDefaultModelName(unsafeModel);
                if ("id" in unsafeData && typeof unsafeData.id !== "undefined" && !forceAllowId) {
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__logger$3e$__["logger"].warn(`[${config.adapterName}] - You are trying to create a record with an id. This is not allowed as we handle id generation for you, unless you pass in the \`forceAllowId\` parameter. The id will be ignored.`);
                    const stack = /* @__PURE__ */ new Error().stack?.split("\n").filter((_, i)=>i !== 1).join("\n").replace("Error:", "Create method with `id` being called at:");
                    console.log(stack);
                    unsafeData.id = void 0;
                }
                debugLog({
                    method: "create"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(1, 4)}`, `${formatMethod("create")} ${formatAction("Unsafe Input")}:`, {
                    model,
                    data: unsafeData
                });
                let data = unsafeData;
                if (!config.disableTransformInput) data = await transformInput(unsafeData, unsafeModel, "create", forceAllowId);
                debugLog({
                    method: "create"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(2, 4)}`, `${formatMethod("create")} ${formatAction("Parsed Input")}:`, {
                    model,
                    data
                });
                const res = await adapterInstance.create({
                    data,
                    model
                });
                debugLog({
                    method: "create"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(3, 4)}`, `${formatMethod("create")} ${formatAction("DB Result")}:`, {
                    model,
                    res
                });
                let transformed = res;
                if (!config.disableTransformOutput) transformed = await transformOutput(res, unsafeModel, select, void 0);
                debugLog({
                    method: "create"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(4, 4)}`, `${formatMethod("create")} ${formatAction("Parsed Result")}:`, {
                    model,
                    data: transformed
                });
                return transformed;
            },
            update: async ({ model: unsafeModel, where: unsafeWhere, update: unsafeData })=>{
                transactionId++;
                let thisTransactionId = transactionId;
                unsafeModel = getDefaultModelName(unsafeModel);
                const model = getModelName(unsafeModel);
                const where = transformWhereClause({
                    model: unsafeModel,
                    where: unsafeWhere
                });
                debugLog({
                    method: "update"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(1, 4)}`, `${formatMethod("update")} ${formatAction("Unsafe Input")}:`, {
                    model,
                    data: unsafeData
                });
                let data = unsafeData;
                if (!config.disableTransformInput) data = await transformInput(unsafeData, unsafeModel, "update");
                debugLog({
                    method: "update"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(2, 4)}`, `${formatMethod("update")} ${formatAction("Parsed Input")}:`, {
                    model,
                    data
                });
                const res = await adapterInstance.update({
                    model,
                    where,
                    update: data
                });
                debugLog({
                    method: "update"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(3, 4)}`, `${formatMethod("update")} ${formatAction("DB Result")}:`, {
                    model,
                    data: res
                });
                let transformed = res;
                if (!config.disableTransformOutput) transformed = await transformOutput(res, unsafeModel, void 0, void 0);
                debugLog({
                    method: "update"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(4, 4)}`, `${formatMethod("update")} ${formatAction("Parsed Result")}:`, {
                    model,
                    data: transformed
                });
                return transformed;
            },
            updateMany: async ({ model: unsafeModel, where: unsafeWhere, update: unsafeData })=>{
                transactionId++;
                let thisTransactionId = transactionId;
                const model = getModelName(unsafeModel);
                const where = transformWhereClause({
                    model: unsafeModel,
                    where: unsafeWhere
                });
                unsafeModel = getDefaultModelName(unsafeModel);
                debugLog({
                    method: "updateMany"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(1, 4)}`, `${formatMethod("updateMany")} ${formatAction("Unsafe Input")}:`, {
                    model,
                    data: unsafeData
                });
                let data = unsafeData;
                if (!config.disableTransformInput) data = await transformInput(unsafeData, unsafeModel, "update");
                debugLog({
                    method: "updateMany"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(2, 4)}`, `${formatMethod("updateMany")} ${formatAction("Parsed Input")}:`, {
                    model,
                    data
                });
                const updatedCount = await adapterInstance.updateMany({
                    model,
                    where,
                    update: data
                });
                debugLog({
                    method: "updateMany"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(3, 4)}`, `${formatMethod("updateMany")} ${formatAction("DB Result")}:`, {
                    model,
                    data: updatedCount
                });
                debugLog({
                    method: "updateMany"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(4, 4)}`, `${formatMethod("updateMany")} ${formatAction("Parsed Result")}:`, {
                    model,
                    data: updatedCount
                });
                return updatedCount;
            },
            findOne: async ({ model: unsafeModel, where: unsafeWhere, select, join: unsafeJoin })=>{
                transactionId++;
                let thisTransactionId = transactionId;
                const model = getModelName(unsafeModel);
                const where = transformWhereClause({
                    model: unsafeModel,
                    where: unsafeWhere
                });
                unsafeModel = getDefaultModelName(unsafeModel);
                let join;
                let passJoinToAdapter = true;
                if (!config.disableTransformJoin) {
                    const result = transformJoinClause(unsafeModel, unsafeJoin, select);
                    if (result) {
                        join = result.join;
                        select = result.select;
                    }
                    if (!options.experimental?.joins && join && Object.keys(join).length > 0) passJoinToAdapter = false;
                } else join = unsafeJoin;
                debugLog({
                    method: "findOne"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(1, 3)}`, `${formatMethod("findOne")}:`, {
                    model,
                    where,
                    select,
                    join
                });
                const res = await adapterInstance.findOne({
                    model,
                    where,
                    select,
                    join: passJoinToAdapter ? join : void 0
                });
                debugLog({
                    method: "findOne"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(2, 3)}`, `${formatMethod("findOne")} ${formatAction("DB Result")}:`, {
                    model,
                    data: res
                });
                let transformed = res;
                if (!config.disableTransformOutput) transformed = await transformOutput(res, unsafeModel, select, join);
                debugLog({
                    method: "findOne"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(3, 3)}`, `${formatMethod("findOne")} ${formatAction("Parsed Result")}:`, {
                    model,
                    data: transformed
                });
                return transformed;
            },
            findMany: async ({ model: unsafeModel, where: unsafeWhere, limit: unsafeLimit, sortBy, offset, join: unsafeJoin })=>{
                transactionId++;
                let thisTransactionId = transactionId;
                const limit = unsafeLimit ?? options.advanced?.database?.defaultFindManyLimit ?? 100;
                const model = getModelName(unsafeModel);
                const where = transformWhereClause({
                    model: unsafeModel,
                    where: unsafeWhere
                });
                unsafeModel = getDefaultModelName(unsafeModel);
                let join;
                let passJoinToAdapter = true;
                if (!config.disableTransformJoin) {
                    const result = transformJoinClause(unsafeModel, unsafeJoin, void 0);
                    if (result) join = result.join;
                    if (!options.experimental?.joins && join && Object.keys(join).length > 0) passJoinToAdapter = false;
                } else join = unsafeJoin;
                debugLog({
                    method: "findMany"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(1, 3)}`, `${formatMethod("findMany")}:`, {
                    model,
                    where,
                    limit,
                    sortBy,
                    offset,
                    join
                });
                const res = await adapterInstance.findMany({
                    model,
                    where,
                    limit,
                    sortBy,
                    offset,
                    join: passJoinToAdapter ? join : void 0
                });
                debugLog({
                    method: "findMany"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(2, 3)}`, `${formatMethod("findMany")} ${formatAction("DB Result")}:`, {
                    model,
                    data: res
                });
                let transformed = res;
                if (!config.disableTransformOutput) transformed = await Promise.all(res.map(async (r)=>{
                    return await transformOutput(r, unsafeModel, void 0, join);
                }));
                debugLog({
                    method: "findMany"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(3, 3)}`, `${formatMethod("findMany")} ${formatAction("Parsed Result")}:`, {
                    model,
                    data: transformed
                });
                return transformed;
            },
            delete: async ({ model: unsafeModel, where: unsafeWhere })=>{
                transactionId++;
                let thisTransactionId = transactionId;
                const model = getModelName(unsafeModel);
                const where = transformWhereClause({
                    model: unsafeModel,
                    where: unsafeWhere
                });
                unsafeModel = getDefaultModelName(unsafeModel);
                debugLog({
                    method: "delete"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(1, 2)}`, `${formatMethod("delete")}:`, {
                    model,
                    where
                });
                await adapterInstance.delete({
                    model,
                    where
                });
                debugLog({
                    method: "delete"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(2, 2)}`, `${formatMethod("delete")} ${formatAction("DB Result")}:`, {
                    model
                });
            },
            deleteMany: async ({ model: unsafeModel, where: unsafeWhere })=>{
                transactionId++;
                let thisTransactionId = transactionId;
                const model = getModelName(unsafeModel);
                const where = transformWhereClause({
                    model: unsafeModel,
                    where: unsafeWhere
                });
                unsafeModel = getDefaultModelName(unsafeModel);
                debugLog({
                    method: "deleteMany"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(1, 2)}`, `${formatMethod("deleteMany")} ${formatAction("DeleteMany")}:`, {
                    model,
                    where
                });
                const res = await adapterInstance.deleteMany({
                    model,
                    where
                });
                debugLog({
                    method: "deleteMany"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(2, 2)}`, `${formatMethod("deleteMany")} ${formatAction("DB Result")}:`, {
                    model,
                    data: res
                });
                return res;
            },
            count: async ({ model: unsafeModel, where: unsafeWhere })=>{
                transactionId++;
                let thisTransactionId = transactionId;
                const model = getModelName(unsafeModel);
                const where = transformWhereClause({
                    model: unsafeModel,
                    where: unsafeWhere
                });
                unsafeModel = getDefaultModelName(unsafeModel);
                debugLog({
                    method: "count"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(1, 2)}`, `${formatMethod("count")}:`, {
                    model,
                    where
                });
                const res = await adapterInstance.count({
                    model,
                    where
                });
                debugLog({
                    method: "count"
                }, `${formatTransactionId(thisTransactionId)} ${formatStep(2, 2)}`, `${formatMethod("count")}:`, {
                    model,
                    data: res
                });
                return res;
            },
            createSchema: adapterInstance.createSchema ? async (_, file)=>{
                const tables = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["a"])(options);
                if (options.secondaryStorage && !options.session?.storeSessionInDatabase) delete tables.session;
                if (options.rateLimit && options.rateLimit.storage === "database" && (typeof options.rateLimit.enabled === "undefined" || options.rateLimit.enabled === true)) tables.ratelimit = {
                    modelName: options.rateLimit.modelName ?? "ratelimit",
                    fields: {
                        key: {
                            type: "string",
                            unique: true,
                            required: true,
                            fieldName: options.rateLimit.fields?.key ?? "key"
                        },
                        count: {
                            type: "number",
                            required: true,
                            fieldName: options.rateLimit.fields?.count ?? "count"
                        },
                        lastRequest: {
                            type: "number",
                            required: true,
                            bigint: true,
                            defaultValue: ()=>Date.now(),
                            fieldName: options.rateLimit.fields?.lastRequest ?? "lastRequest"
                        }
                    }
                };
                return adapterInstance.createSchema({
                    file,
                    tables
                });
            } : void 0,
            options: {
                adapterConfig: config,
                ...adapterInstance.options ?? {}
            },
            id: config.adapterId,
            ...config.debugLogs?.isRunningAdapterTests ? {
                adapterTestDebugLogs: {
                    resetDebugLogs () {
                        debugLogs = debugLogs.filter((log)=>log.instance !== uniqueAdapterFactoryInstanceId);
                    },
                    printDebugLogs () {
                        const separator = ``.repeat(80);
                        const logs = debugLogs.filter((log$1)=>log$1.instance === uniqueAdapterFactoryInstanceId);
                        if (logs.length === 0) return;
                        let log = logs.reverse().map((log$1)=>{
                            log$1.args[0] = `\n${log$1.args[0]}`;
                            return [
                                ...log$1.args,
                                "\n"
                            ];
                        }).reduce((prev, curr)=>{
                            return [
                                ...curr,
                                ...prev
                            ];
                        }, [
                            `\n${separator}`
                        ]);
                        console.log(...log);
                    }
                }
            } : {}
        };
        return adapter;
    };
function formatTransactionId(transactionId$1) {
    if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__o__as__getColorDepth$3e$__["getColorDepth"])() < 8) return `#${transactionId$1}`;
    return `${__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__TTY_COLORS$3e$__["TTY_COLORS"].fg.magenta}#${transactionId$1}${__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__TTY_COLORS$3e$__["TTY_COLORS"].reset}`;
}
function formatStep(step, total) {
    return `${__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__TTY_COLORS$3e$__["TTY_COLORS"].bg.black}${__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__TTY_COLORS$3e$__["TTY_COLORS"].fg.yellow}[${step}/${total}]${__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__TTY_COLORS$3e$__["TTY_COLORS"].reset}`;
}
function formatMethod(method) {
    return `${__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__TTY_COLORS$3e$__["TTY_COLORS"].bright}${method}${__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__TTY_COLORS$3e$__["TTY_COLORS"].reset}`;
}
function formatAction(action) {
    return `${__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__TTY_COLORS$3e$__["TTY_COLORS"].dim}(${action})${__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__TTY_COLORS$3e$__["TTY_COLORS"].reset}`;
}
;
}),
"[project]/node_modules/better-auth/dist/adapters/drizzle-adapter/index.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "drizzleAdapter",
    ()=>drizzleAdapter
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/get-model-name-D4DUV7S2.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2d$db7gNqd$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/utils-db7gNqd-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/crypto-CFUhAR9W.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$misc$2d$BwNc0MKr$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/misc-BwNc0MKr.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/json-CnHxKYpj.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$adapter$2d$factory$2d$HF3JB9cT$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/adapter-factory-HF3JB9cT.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__logger$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env-8yWFh7b8.mjs [app-route] (ecmascript) <export i as logger>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error-BhAKg8LX.mjs [app-route] (ecmascript) <export t as BetterAuthError>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/expressions/conditions.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$select$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/expressions/select.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$functions$2f$aggregate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/functions/aggregate.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/sql.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
//#region src/adapters/drizzle-adapter/drizzle-adapter.ts
const drizzleAdapter = (db, config)=>{
    let lazyOptions = null;
    const createCustomAdapter = (db$1)=>({ getFieldName, options })=>{
            function getSchema(model) {
                const schema = config.schema || db$1._.fullSchema;
                if (!schema) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("Drizzle adapter failed to initialize. Schema not found. Please provide a schema object in the adapter options object.");
                const schemaModel = schema[model];
                if (!schemaModel) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`[# Drizzle Adapter]: The model "${model}" was not found in the schema object. Please pass the schema directly to the adapter options.`);
                return schemaModel;
            }
            const withReturning = async (model, builder, data, where)=>{
                if (config.provider !== "mysql") return (await builder.returning())[0];
                await builder.execute();
                const schemaModel = getSchema(model);
                const builderVal = builder.config?.values;
                if (where?.length) {
                    const clause = convertWhereClause(where.map((w)=>{
                        if (data[w.field] !== void 0) return {
                            ...w,
                            value: data[w.field]
                        };
                        return w;
                    }), model);
                    return (await db$1.select().from(schemaModel).where(...clause))[0];
                } else if (builderVal && builderVal[0]?.id?.value) {
                    let tId = builderVal[0]?.id?.value;
                    if (!tId) tId = (await db$1.select({
                        id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`LAST_INSERT_ID()`
                    }).from(schemaModel).orderBy((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$select$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["desc"])(schemaModel.id)).limit(1))[0].id;
                    return (await db$1.select().from(schemaModel).where((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(schemaModel.id, tId)).limit(1).execute())[0];
                } else if (data.id) return (await db$1.select().from(schemaModel).where((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(schemaModel.id, data.id)).limit(1).execute())[0];
                else {
                    if (!("id" in schemaModel)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`The model "${model}" does not have an "id" field. Please use the "id" field as your primary key.`);
                    return (await db$1.select().from(schemaModel).orderBy((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$select$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["desc"])(schemaModel.id)).limit(1).execute())[0];
                }
            };
            function convertWhereClause(where, model) {
                const schemaModel = getSchema(model);
                if (!where) return [];
                if (where.length === 1) {
                    const w = where[0];
                    if (!w) return [];
                    const field = getFieldName({
                        model,
                        field: w.field
                    });
                    if (!schemaModel[field]) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`The field "${w.field}" does not exist in the schema for the model "${model}". Please update your schema.`);
                    if (w.operator === "in") {
                        if (!Array.isArray(w.value)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`The value for the field "${w.field}" must be an array when using the "in" operator.`);
                        return [
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["inArray"])(schemaModel[field], w.value)
                        ];
                    }
                    if (w.operator === "not_in") {
                        if (!Array.isArray(w.value)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`The value for the field "${w.field}" must be an array when using the "not_in" operator.`);
                        return [
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["notInArray"])(schemaModel[field], w.value)
                        ];
                    }
                    if (w.operator === "contains") return [
                        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["like"])(schemaModel[field], `%${w.value}%`)
                    ];
                    if (w.operator === "starts_with") return [
                        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["like"])(schemaModel[field], `${w.value}%`)
                    ];
                    if (w.operator === "ends_with") return [
                        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["like"])(schemaModel[field], `%${w.value}`)
                    ];
                    if (w.operator === "lt") return [
                        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["lt"])(schemaModel[field], w.value)
                    ];
                    if (w.operator === "lte") return [
                        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["lte"])(schemaModel[field], w.value)
                    ];
                    if (w.operator === "ne") return [
                        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ne"])(schemaModel[field], w.value)
                    ];
                    if (w.operator === "gt") return [
                        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["gt"])(schemaModel[field], w.value)
                    ];
                    if (w.operator === "gte") return [
                        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["gte"])(schemaModel[field], w.value)
                    ];
                    return [
                        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(schemaModel[field], w.value)
                    ];
                }
                const andGroup = where.filter((w)=>w.connector === "AND" || !w.connector);
                const orGroup = where.filter((w)=>w.connector === "OR");
                const andClause = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(...andGroup.map((w)=>{
                    const field = getFieldName({
                        model,
                        field: w.field
                    });
                    if (w.operator === "in") {
                        if (!Array.isArray(w.value)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`The value for the field "${w.field}" must be an array when using the "in" operator.`);
                        return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["inArray"])(schemaModel[field], w.value);
                    }
                    if (w.operator === "not_in") {
                        if (!Array.isArray(w.value)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`The value for the field "${w.field}" must be an array when using the "not_in" operator.`);
                        return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["notInArray"])(schemaModel[field], w.value);
                    }
                    if (w.operator === "contains") return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["like"])(schemaModel[field], `%${w.value}%`);
                    if (w.operator === "starts_with") return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["like"])(schemaModel[field], `${w.value}%`);
                    if (w.operator === "ends_with") return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["like"])(schemaModel[field], `%${w.value}`);
                    if (w.operator === "lt") return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["lt"])(schemaModel[field], w.value);
                    if (w.operator === "lte") return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["lte"])(schemaModel[field], w.value);
                    if (w.operator === "gt") return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["gt"])(schemaModel[field], w.value);
                    if (w.operator === "gte") return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["gte"])(schemaModel[field], w.value);
                    if (w.operator === "ne") return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ne"])(schemaModel[field], w.value);
                    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(schemaModel[field], w.value);
                }));
                const orClause = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["or"])(...orGroup.map((w)=>{
                    const field = getFieldName({
                        model,
                        field: w.field
                    });
                    if (w.operator === "in") {
                        if (!Array.isArray(w.value)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`The value for the field "${w.field}" must be an array when using the "in" operator.`);
                        return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["inArray"])(schemaModel[field], w.value);
                    }
                    if (w.operator === "not_in") {
                        if (!Array.isArray(w.value)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`The value for the field "${w.field}" must be an array when using the "not_in" operator.`);
                        return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["notInArray"])(schemaModel[field], w.value);
                    }
                    if (w.operator === "contains") return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["like"])(schemaModel[field], `%${w.value}%`);
                    if (w.operator === "starts_with") return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["like"])(schemaModel[field], `${w.value}%`);
                    if (w.operator === "ends_with") return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["like"])(schemaModel[field], `%${w.value}`);
                    if (w.operator === "lt") return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["lt"])(schemaModel[field], w.value);
                    if (w.operator === "lte") return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["lte"])(schemaModel[field], w.value);
                    if (w.operator === "gt") return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["gt"])(schemaModel[field], w.value);
                    if (w.operator === "gte") return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["gte"])(schemaModel[field], w.value);
                    if (w.operator === "ne") return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ne"])(schemaModel[field], w.value);
                    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(schemaModel[field], w.value);
                }));
                const clause = [];
                if (andGroup.length) clause.push(andClause);
                if (orGroup.length) clause.push(orClause);
                return clause;
            }
            function checkMissingFields(schema, model, values) {
                if (!schema) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("Drizzle adapter failed to initialize. Drizzle Schema not found. Please provide a schema object in the adapter options object.");
                for(const key in values)if (!schema[key]) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"](`The field "${key}" does not exist in the "${model}" Drizzle schema. Please update your drizzle schema or re-generate using "npx @better-auth/cli@latest generate".`);
            }
            return {
                async create ({ model, data: values }) {
                    const schemaModel = getSchema(model);
                    checkMissingFields(schemaModel, model, values);
                    return await withReturning(model, db$1.insert(schemaModel).values(values), values);
                },
                async findOne ({ model, where, join }) {
                    const schemaModel = getSchema(model);
                    const clause = convertWhereClause(where, model);
                    if (options.experimental?.joins) if (!db$1.query || !db$1.query[model]) {
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__logger$3e$__["logger"].error(`[# Drizzle Adapter]: The model "${model}" was not found in the query object. Please update your Drizzle schema to include relations or re-generate using "npx @better-auth/cli@latest generate".`);
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__logger$3e$__["logger"].info("Falling back to regular query");
                    } else {
                        let includes;
                        const pluralJoinResults = [];
                        if (join) {
                            includes = {};
                            const joinEntries = Object.entries(join);
                            for (const [model$1, joinAttr] of joinEntries){
                                const limit = joinAttr.limit ?? options.advanced?.database?.defaultFindManyLimit ?? 100;
                                const isUnique = joinAttr.relation === "one-to-one";
                                const pluralSuffix = isUnique || config.usePlural ? "" : "s";
                                includes[`${model$1}${pluralSuffix}`] = isUnique ? true : {
                                    limit
                                };
                                if (!isUnique) pluralJoinResults.push(`${model$1}${pluralSuffix}`);
                            }
                        }
                        const res$1 = await db$1.query[model].findFirst({
                            where: clause[0],
                            with: includes
                        });
                        if (res$1) for (const pluralJoinResult of pluralJoinResults){
                            let singularKey = !config.usePlural ? pluralJoinResult.slice(0, -1) : pluralJoinResult;
                            res$1[singularKey] = res$1[pluralJoinResult];
                            if (pluralJoinResult !== singularKey) delete res$1[pluralJoinResult];
                        }
                        return res$1;
                    }
                    const res = await db$1.select().from(schemaModel).where(...clause);
                    if (!res.length) return null;
                    return res[0];
                },
                async findMany ({ model, where, sortBy, limit, offset, join }) {
                    const schemaModel = getSchema(model);
                    const clause = where ? convertWhereClause(where, model) : [];
                    const sortFn = sortBy?.direction === "desc" ? __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$select$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["desc"] : __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$select$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["asc"];
                    if (options.experimental?.joins) if (!db$1.query[model]) {
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__logger$3e$__["logger"].error(`[# Drizzle Adapter]: The model "${model}" was not found in the query object. Please update your Drizzle schema to include relations or re-generate using "npx @better-auth/cli@latest generate".`);
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__logger$3e$__["logger"].info("Falling back to regular query");
                    } else {
                        let includes;
                        const pluralJoinResults = [];
                        if (join) {
                            includes = {};
                            const joinEntries = Object.entries(join);
                            for (const [model$1, joinAttr] of joinEntries){
                                const isUnique = joinAttr.relation === "one-to-one";
                                const limit$1 = joinAttr.limit ?? options.advanced?.database?.defaultFindManyLimit ?? 100;
                                let pluralSuffix = isUnique || config.usePlural ? "" : "s";
                                includes[`${model$1}${pluralSuffix}`] = isUnique ? true : {
                                    limit: limit$1
                                };
                                if (!isUnique) pluralJoinResults.push(`${model$1}${pluralSuffix}`);
                            }
                        }
                        let orderBy = void 0;
                        if (sortBy?.field) orderBy = [
                            sortFn(schemaModel[getFieldName({
                                model,
                                field: sortBy?.field
                            })])
                        ];
                        let res = await db$1.query[model].findMany({
                            where: clause[0],
                            with: includes,
                            limit: limit ?? 100,
                            offset: offset ?? 0,
                            orderBy
                        });
                        if (res) for (const item of res)for (const pluralJoinResult of pluralJoinResults){
                            const singularKey = !config.usePlural ? pluralJoinResult.slice(0, -1) : pluralJoinResult;
                            if (singularKey === pluralJoinResult) continue;
                            item[singularKey] = item[pluralJoinResult];
                            delete item[pluralJoinResult];
                        }
                        return res;
                    }
                    let builder = db$1.select().from(schemaModel);
                    const effectiveLimit = limit;
                    const effectiveOffset = offset;
                    if (typeof effectiveLimit !== "undefined") builder = builder.limit(effectiveLimit);
                    if (typeof effectiveOffset !== "undefined") builder = builder.offset(effectiveOffset);
                    if (sortBy?.field) builder = builder.orderBy(sortFn(schemaModel[getFieldName({
                        model,
                        field: sortBy?.field
                    })]));
                    return await builder.where(...clause);
                },
                async count ({ model, where }) {
                    const schemaModel = getSchema(model);
                    const clause = where ? convertWhereClause(where, model) : [];
                    return (await db$1.select({
                        count: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$functions$2f$aggregate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["count"])()
                    }).from(schemaModel).where(...clause))[0].count;
                },
                async update ({ model, where, update: values }) {
                    const schemaModel = getSchema(model);
                    const clause = convertWhereClause(where, model);
                    return await withReturning(model, db$1.update(schemaModel).set(values).where(...clause), values, where);
                },
                async updateMany ({ model, where, update: values }) {
                    const schemaModel = getSchema(model);
                    const clause = convertWhereClause(where, model);
                    return await db$1.update(schemaModel).set(values).where(...clause);
                },
                async delete ({ model, where }) {
                    const schemaModel = getSchema(model);
                    const clause = convertWhereClause(where, model);
                    return await db$1.delete(schemaModel).where(...clause);
                },
                async deleteMany ({ model, where }) {
                    const schemaModel = getSchema(model);
                    const clause = convertWhereClause(where, model);
                    const res = await db$1.delete(schemaModel).where(...clause);
                    let count$1 = 0;
                    if (res && "rowCount" in res) count$1 = res.rowCount;
                    else if (Array.isArray(res)) count$1 = res.length;
                    else if (res && ("affectedRows" in res || "rowsAffected" in res || "changes" in res)) count$1 = res.affectedRows ?? res.rowsAffected ?? res.changes;
                    if (typeof count$1 !== "number") __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__i__as__logger$3e$__["logger"].error("[Drizzle Adapter] The result of the deleteMany operation is not a number. This is likely a bug in the adapter. Please report this issue to the Better Auth team.", {
                        res,
                        model,
                        where
                    });
                    return count$1;
                },
                options: config
            };
        };
    let adapterOptions = null;
    adapterOptions = {
        config: {
            adapterId: "drizzle",
            adapterName: "Drizzle Adapter",
            usePlural: config.usePlural ?? false,
            debugLogs: config.debugLogs ?? false,
            supportsUUIDs: config.provider === "pg" ? true : false,
            transaction: config.transaction ?? false ? (cb)=>db.transaction((tx)=>{
                    return cb((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$adapter$2d$factory$2d$HF3JB9cT$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                        config: adapterOptions.config,
                        adapter: createCustomAdapter(tx)
                    })(lazyOptions));
                }) : false
        },
        adapter: createCustomAdapter(db)
    };
    const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$adapter$2d$factory$2d$HF3JB9cT$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(adapterOptions);
    return (options)=>{
        lazyOptions = options;
        return adapter(options);
    };
};
;
}),
"[project]/node_modules/better-auth/dist/parser-pHp5yoAv.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

//#region src/client/parser.ts
__turbopack_context__.s([
    "n",
    ()=>parser_default,
    "t",
    ()=>parseJSON
]);
const PROTO_POLLUTION_PATTERNS = {
    proto: /"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,
    constructor: /"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,
    protoShort: /"__proto__"\s*:/,
    constructorShort: /"constructor"\s*:/
};
const JSON_SIGNATURE = /^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;
const SPECIAL_VALUES = {
    true: true,
    false: false,
    null: null,
    undefined: void 0,
    nan: NaN,
    infinity: Number.POSITIVE_INFINITY,
    "-infinity": Number.NEGATIVE_INFINITY
};
const ISO_DATE_REGEX = /^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;
function isValidDate(date) {
    return date instanceof Date && !isNaN(date.getTime());
}
function parseISODate(value) {
    const match = ISO_DATE_REGEX.exec(value);
    if (!match) return null;
    const [, year, month, day, hour, minute, second, ms, offsetSign, offsetHour, offsetMinute] = match;
    let date = new Date(Date.UTC(parseInt(year, 10), parseInt(month, 10) - 1, parseInt(day, 10), parseInt(hour, 10), parseInt(minute, 10), parseInt(second, 10), ms ? parseInt(ms.padEnd(3, "0"), 10) : 0));
    if (offsetSign) {
        const offset = (parseInt(offsetHour, 10) * 60 + parseInt(offsetMinute, 10)) * (offsetSign === "+" ? -1 : 1);
        date.setUTCMinutes(date.getUTCMinutes() + offset);
    }
    return isValidDate(date) ? date : null;
}
function betterJSONParse(value, options = {}) {
    const { strict = false, warnings = false, reviver, parseDates = true } = options;
    if (typeof value !== "string") return value;
    const trimmed = value.trim();
    if (trimmed.length > 0 && trimmed[0] === "\"" && trimmed.endsWith("\"") && !trimmed.slice(1, -1).includes("\"")) return trimmed.slice(1, -1);
    const lowerValue = trimmed.toLowerCase();
    if (lowerValue.length <= 9 && lowerValue in SPECIAL_VALUES) return SPECIAL_VALUES[lowerValue];
    if (!JSON_SIGNATURE.test(trimmed)) {
        if (strict) throw new SyntaxError("[better-json] Invalid JSON");
        return value;
    }
    if (Object.entries(PROTO_POLLUTION_PATTERNS).some(([key, pattern])=>{
        const matches = pattern.test(trimmed);
        if (matches && warnings) console.warn(`[better-json] Detected potential prototype pollution attempt using ${key} pattern`);
        return matches;
    }) && strict) throw new Error("[better-json] Potential prototype pollution attempt detected");
    try {
        const secureReviver = (key, value$1)=>{
            if (key === "__proto__" || key === "constructor" && value$1 && typeof value$1 === "object" && "prototype" in value$1) {
                if (warnings) console.warn(`[better-json] Dropping "${key}" key to prevent prototype pollution`);
                return;
            }
            if (parseDates && typeof value$1 === "string") {
                const date = parseISODate(value$1);
                if (date) return date;
            }
            return reviver ? reviver(key, value$1) : value$1;
        };
        return JSON.parse(trimmed, secureReviver);
    } catch (error) {
        if (strict) throw error;
        return value;
    }
}
function parseJSON(value, options = {
    strict: true
}) {
    return betterJSONParse(value, options);
}
var parser_default = parseJSON;
;
}),
"[project]/node_modules/better-auth/dist/access-Dx8TLKnw.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "n",
    ()=>role,
    "t",
    ()=>createAccessControl
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error-BhAKg8LX.mjs [app-route] (ecmascript) <export t as BetterAuthError>");
;
//#region src/plugins/access/access.ts
function role(statements) {
    return {
        authorize (request, connector = "AND") {
            let success = false;
            for (const [requestedResource, requestedActions] of Object.entries(request)){
                const allowedActions = statements[requestedResource];
                if (!allowedActions) return {
                    success: false,
                    error: `You are not allowed to access resource: ${requestedResource}`
                };
                if (Array.isArray(requestedActions)) success = requestedActions.every((requestedAction)=>allowedActions.includes(requestedAction));
                else if (typeof requestedActions === "object") {
                    const actions = requestedActions;
                    if (actions.connector === "OR") success = actions.actions.some((requestedAction)=>allowedActions.includes(requestedAction));
                    else success = actions.actions.every((requestedAction)=>allowedActions.includes(requestedAction));
                } else throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("Invalid access control request");
                if (success && connector === "OR") return {
                    success
                };
                if (!success && connector === "AND") return {
                    success: false,
                    error: `unauthorized to access resource "${requestedResource}"`
                };
            }
            if (success) return {
                success
            };
            return {
                success: false,
                error: "Not authorized"
            };
        },
        statements
    };
}
function createAccessControl(s) {
    return {
        newRole (statements) {
            return role(statements);
        },
        statements: s
    };
}
;
}),
"[project]/node_modules/better-auth/dist/access-h-uttVNZ.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "a",
    ()=>userAc,
    "i",
    ()=>defaultStatements,
    "n",
    ()=>defaultAc,
    "r",
    ()=>defaultRoles,
    "t",
    ()=>adminAc
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$access$2d$Dx8TLKnw$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/access-Dx8TLKnw.mjs [app-route] (ecmascript)");
;
//#region src/plugins/admin/access/statement.ts
const defaultStatements = {
    user: [
        "create",
        "list",
        "set-role",
        "ban",
        "impersonate",
        "delete",
        "set-password",
        "get",
        "update"
    ],
    session: [
        "list",
        "revoke",
        "delete"
    ]
};
const defaultAc = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$access$2d$Dx8TLKnw$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(defaultStatements);
const adminAc = defaultAc.newRole({
    user: [
        "create",
        "list",
        "set-role",
        "ban",
        "impersonate",
        "delete",
        "set-password",
        "get",
        "update"
    ],
    session: [
        "list",
        "revoke",
        "delete"
    ]
});
const userAc = defaultAc.newRole({
    user: [],
    session: []
});
const defaultRoles = {
    admin: adminAc,
    user: userAc
};
;
}),
"[project]/node_modules/better-auth/dist/has-permission-qCjQqGds.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>hasPermission
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$access$2d$h$2d$uttVNZ$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/access-h-uttVNZ.mjs [app-route] (ecmascript)");
;
//#region src/plugins/admin/has-permission.ts
const hasPermission = (input)=>{
    if (input.userId && input.options?.adminUserIds?.includes(input.userId)) return true;
    if (!input.permissions && !input.permission) return false;
    const roles = (input.role || input.options?.defaultRole || "user").split(",");
    const acRoles = input.options?.roles || __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$access$2d$h$2d$uttVNZ$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"];
    for (const role of roles)if (acRoles[role]?.authorize(input.permission ?? input.permissions)?.success) return true;
    return false;
};
;
}),
"[project]/node_modules/better-auth/dist/access-vPNO48H4.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "a",
    ()=>memberAc,
    "i",
    ()=>defaultStatements,
    "n",
    ()=>defaultAc,
    "o",
    ()=>ownerAc,
    "r",
    ()=>defaultRoles,
    "t",
    ()=>adminAc
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$access$2d$Dx8TLKnw$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/access-Dx8TLKnw.mjs [app-route] (ecmascript)");
;
//#region src/plugins/organization/access/statement.ts
const defaultStatements = {
    organization: [
        "update",
        "delete"
    ],
    member: [
        "create",
        "update",
        "delete"
    ],
    invitation: [
        "create",
        "cancel"
    ],
    team: [
        "create",
        "update",
        "delete"
    ],
    ac: [
        "create",
        "read",
        "update",
        "delete"
    ]
};
const defaultAc = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$access$2d$Dx8TLKnw$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(defaultStatements);
const adminAc = defaultAc.newRole({
    organization: [
        "update"
    ],
    invitation: [
        "create",
        "cancel"
    ],
    member: [
        "create",
        "update",
        "delete"
    ],
    team: [
        "create",
        "update",
        "delete"
    ],
    ac: [
        "create",
        "read",
        "update",
        "delete"
    ]
});
const ownerAc = defaultAc.newRole({
    organization: [
        "update",
        "delete"
    ],
    member: [
        "create",
        "update",
        "delete"
    ],
    invitation: [
        "create",
        "cancel"
    ],
    team: [
        "create",
        "update",
        "delete"
    ],
    ac: [
        "create",
        "read",
        "update",
        "delete"
    ]
});
const memberAc = defaultAc.newRole({
    organization: [],
    member: [],
    invitation: [],
    team: [],
    ac: [
        "read"
    ]
});
const defaultRoles = {
    admin: adminAc,
    owner: ownerAc,
    member: memberAc
};
;
}),
"[project]/node_modules/better-auth/dist/permission-JwliMugl.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

//#region src/plugins/organization/permission.ts
__turbopack_context__.s([
    "n",
    ()=>hasPermissionFn,
    "t",
    ()=>cacheAllRoles
]);
const hasPermissionFn = (input, acRoles)=>{
    if (!input.permissions && !input.permission) return false;
    const roles = input.role.split(",");
    const creatorRole = input.options.creatorRole || "owner";
    const isCreator = roles.includes(creatorRole);
    const allowCreatorsAllPermissions = input.allowCreatorAllPermissions || false;
    if (isCreator && allowCreatorsAllPermissions) return true;
    for (const role of roles)if (acRoles[role]?.authorize(input.permissions ?? input.permission)?.success) return true;
    return false;
};
let cacheAllRoles = /* @__PURE__ */ new Map();
;
}),
"[project]/node_modules/better-auth/dist/client-CMPEe5-e.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

//#region src/plugins/two-factor/client.ts
__turbopack_context__.s([
    "t",
    ()=>twoFactorClient
]);
const twoFactorClient = (options)=>{
    return {
        id: "two-factor",
        $InferServerPlugin: {},
        atomListeners: [
            {
                matcher: (path)=>path.startsWith("/two-factor/"),
                signal: "$sessionSignal"
            }
        ],
        pathMethods: {
            "/two-factor/disable": "POST",
            "/two-factor/enable": "POST",
            "/two-factor/send-otp": "POST",
            "/two-factor/generate-backup-codes": "POST"
        },
        fetchPlugins: [
            {
                id: "two-factor",
                name: "two-factor",
                hooks: {
                    async onSuccess (context) {
                        if (context.data?.twoFactorRedirect) {
                            if (options?.onTwoFactorRedirect) await options.onTwoFactorRedirect();
                        }
                    }
                }
            }
        ]
    };
};
;
}),
"[project]/node_modules/better-auth/dist/plugin-helper-zFdFWLgL.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>getEndpointResponse
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript)");
;
//#region src/utils/plugin-helper.ts
const getEndpointResponse = async (ctx)=>{
    const returned = ctx.context.returned;
    if (!returned) return null;
    if (returned instanceof Response) {
        if (returned.status !== 200) return null;
        return await returned.clone().json();
    }
    if (returned instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]) return null;
    return returned;
};
;
}),
"[project]/node_modules/better-auth/dist/admin-D-OMdNIc.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>admin
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/schema-Bb7wzeK_.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api-CkmycQ2x.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript) <export APIError as t>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/session-AaRl3_x-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$has$2d$permission$2d$qCjQqGds$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/has-permission-qCjQqGds.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugin$2d$helper$2d$zFdFWLgL$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugin-helper-zFdFWLgL.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error-BhAKg8LX.mjs [app-route] (ecmascript) <export n as BASE_ERROR_CODES>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils-C5EN75oV.mjs [app-route] (ecmascript) <export t as defineErrorCodes>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/external.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
//#region src/plugins/admin/error-codes.ts
const ADMIN_ERROR_CODES = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__["defineErrorCodes"])({
    FAILED_TO_CREATE_USER: "Failed to create user",
    USER_ALREADY_EXISTS: "User already exists.",
    USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL: "User already exists. Use another email.",
    YOU_CANNOT_BAN_YOURSELF: "You cannot ban yourself",
    YOU_ARE_NOT_ALLOWED_TO_CHANGE_USERS_ROLE: "You are not allowed to change users role",
    YOU_ARE_NOT_ALLOWED_TO_CREATE_USERS: "You are not allowed to create users",
    YOU_ARE_NOT_ALLOWED_TO_LIST_USERS: "You are not allowed to list users",
    YOU_ARE_NOT_ALLOWED_TO_LIST_USERS_SESSIONS: "You are not allowed to list users sessions",
    YOU_ARE_NOT_ALLOWED_TO_BAN_USERS: "You are not allowed to ban users",
    YOU_ARE_NOT_ALLOWED_TO_IMPERSONATE_USERS: "You are not allowed to impersonate users",
    YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS: "You are not allowed to revoke users sessions",
    YOU_ARE_NOT_ALLOWED_TO_DELETE_USERS: "You are not allowed to delete users",
    YOU_ARE_NOT_ALLOWED_TO_SET_USERS_PASSWORD: "You are not allowed to set users password",
    BANNED_USER: "You have been banned from this application",
    YOU_ARE_NOT_ALLOWED_TO_GET_USER: "You are not allowed to get user",
    NO_DATA_TO_UPDATE: "No data to update",
    YOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS: "You are not allowed to update users",
    YOU_CANNOT_REMOVE_YOURSELF: "You cannot remove yourself",
    YOU_ARE_NOT_ALLOWED_TO_SET_NON_EXISTENT_VALUE: "You are not allowed to set a non-existent role value"
});
//#endregion
//#region src/plugins/admin/schema.ts
const schema = {
    user: {
        fields: {
            role: {
                type: "string",
                required: false,
                input: false
            },
            banned: {
                type: "boolean",
                defaultValue: false,
                required: false,
                input: false
            },
            banReason: {
                type: "string",
                required: false,
                input: false
            },
            banExpires: {
                type: "date",
                required: false,
                input: false
            }
        }
    },
    session: {
        fields: {
            impersonatedBy: {
                type: "string",
                required: false
            }
        }
    }
};
//#endregion
//#region src/plugins/admin/admin.ts
function parseRoles(roles) {
    return Array.isArray(roles) ? roles.join(",") : roles;
}
const admin = (options)=>{
    const opts = {
        defaultRole: options?.defaultRole ?? "user",
        adminRoles: options?.adminRoles ?? [
            "admin"
        ],
        bannedUserMessage: options?.bannedUserMessage ?? "You have been banned from this application. Please contact support if you believe this is an error.",
        ...options
    };
    /**
	* Ensures a valid session, if not will throw.
	* Will also provide additional types on the user to include role types.
	*/ const adminMiddleware = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
        const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(ctx);
        if (!session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED");
        return {
            session
        };
    });
    return {
        id: "admin",
        init () {
            return {
                options: {
                    databaseHooks: {
                        user: {
                            create: {
                                async before (user) {
                                    return {
                                        data: {
                                            role: options?.defaultRole ?? "user",
                                            ...user
                                        }
                                    };
                                }
                            }
                        },
                        session: {
                            create: {
                                async before (session, ctx) {
                                    if (!ctx) return;
                                    const user = await ctx.context.internalAdapter.findUserById(session.userId);
                                    if (user.banned) {
                                        if (user.banExpires && new Date(user.banExpires).getTime() < Date.now()) {
                                            await ctx.context.internalAdapter.updateUser(session.userId, {
                                                banned: false,
                                                banReason: null,
                                                banExpires: null
                                            });
                                            return;
                                        }
                                        if (ctx && (ctx.path.startsWith("/callback") || ctx.path.startsWith("/oauth2/callback"))) {
                                            const redirectURI = ctx.context.options.onAPIError?.errorURL || `${ctx.context.baseURL}/error`;
                                            throw ctx.redirect(`${redirectURI}?error=banned&error_description=${opts.bannedUserMessage}`);
                                        }
                                        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("FORBIDDEN", {
                                            message: opts.bannedUserMessage,
                                            code: "BANNED_USER"
                                        });
                                    }
                                }
                            }
                        }
                    }
                }
            };
        },
        hooks: {
            after: [
                {
                    matcher (context) {
                        return context.path === "/list-sessions";
                    },
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        const response = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugin$2d$helper$2d$zFdFWLgL$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(ctx);
                        if (!response) return;
                        const newJson = response.filter((session)=>{
                            return !session.impersonatedBy;
                        });
                        return ctx.json(newJson);
                    })
                }
            ]
        },
        endpoints: {
            setRole: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/admin/set-role", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].string().meta({
                        description: "The user id"
                    }),
                    role: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["union"]([
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                            description: "The role to set. `admin` or `user` by default"
                        }),
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                            description: "The roles to set. `admin` or `user` by default"
                        }))
                    ]).meta({
                        description: "The role to set, this can be a string or an array of strings. Eg: `admin` or `[admin, user]`"
                    })
                }),
                requireHeaders: true,
                use: [
                    adminMiddleware
                ],
                metadata: {
                    openapi: {
                        operationId: "setUserRole",
                        summary: "Set the role of a user",
                        description: "Set the role of a user",
                        responses: {
                            200: {
                                description: "User role updated",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    $Infer: {
                        body: {}
                    }
                }
            }, async (ctx)=>{
                if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$has$2d$permission$2d$qCjQqGds$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                    userId: ctx.context.session.user.id,
                    role: ctx.context.session.user.role,
                    options: opts,
                    permissions: {
                        user: [
                            "set-role"
                        ]
                    }
                })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("FORBIDDEN", {
                    message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CHANGE_USERS_ROLE
                });
                const roles = opts.roles;
                if (roles) {
                    const inputRoles = Array.isArray(ctx.body.role) ? ctx.body.role : [
                        ctx.body.role
                    ];
                    for (const role of inputRoles)if (!roles[role]) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_SET_NON_EXISTENT_VALUE
                    });
                }
                const updatedUser = await ctx.context.internalAdapter.updateUser(ctx.body.userId, {
                    role: parseRoles(ctx.body.role)
                });
                return ctx.json({
                    user: updatedUser
                });
            }),
            getUser: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/admin/get-user", {
                method: "GET",
                query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The id of the User"
                    })
                }),
                use: [
                    adminMiddleware
                ],
                metadata: {
                    openapi: {
                        operationId: "getUser",
                        summary: "Get an existing user",
                        description: "Get an existing user",
                        responses: {
                            200: {
                                description: "User",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const { id } = ctx.query;
                if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$has$2d$permission$2d$qCjQqGds$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                    userId: ctx.context.session.user.id,
                    role: ctx.context.session.user.role,
                    options: opts,
                    permissions: {
                        user: [
                            "get"
                        ]
                    }
                })) throw ctx.error("FORBIDDEN", {
                    message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_GET_USER,
                    code: "YOU_ARE_NOT_ALLOWED_TO_GET_USER"
                });
                const user = await ctx.context.internalAdapter.findUserById(id);
                if (!user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("NOT_FOUND", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].USER_NOT_FOUND
                });
                return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["l"])(ctx.context.options, user);
            }),
            createUser: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/admin/create-user", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The email of the user"
                    }),
                    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The password of the user"
                    }),
                    name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The name of the user"
                    }),
                    role: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["union"]([
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                            description: "The role of the user"
                        }),
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                            description: "The roles of user"
                        }))
                    ]).optional().meta({
                        description: `A string or array of strings representing the roles to apply to the new user. Eg: \"user\"`
                    }),
                    data: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["any"]()).optional().meta({
                        description: "Extra fields for the user. Including custom additional fields."
                    })
                }),
                metadata: {
                    openapi: {
                        operationId: "createUser",
                        summary: "Create a new user",
                        description: "Create a new user",
                        responses: {
                            200: {
                                description: "User created",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    $Infer: {
                        body: {}
                    }
                }
            }, async (ctx)=>{
                const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(ctx);
                if (!session && (ctx.request || ctx.headers)) throw ctx.error("UNAUTHORIZED");
                if (session) {
                    if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$has$2d$permission$2d$qCjQqGds$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                        userId: session.user.id,
                        role: session.user.role,
                        options: opts,
                        permissions: {
                            user: [
                                "create"
                            ]
                        }
                    })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("FORBIDDEN", {
                        message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CREATE_USERS
                    });
                }
                const email = ctx.body.email.toLowerCase();
                if (!__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["email"]().safeParse(email).success) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].INVALID_EMAIL
                });
                if (await ctx.context.internalAdapter.findUserByEmail(email)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: ADMIN_ERROR_CODES.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL
                });
                const user = await ctx.context.internalAdapter.createUser({
                    email,
                    name: ctx.body.name,
                    role: (ctx.body.role && parseRoles(ctx.body.role)) ?? options?.defaultRole ?? "user",
                    ...ctx.body.data
                });
                if (!user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("INTERNAL_SERVER_ERROR", {
                    message: ADMIN_ERROR_CODES.FAILED_TO_CREATE_USER
                });
                const hashedPassword = await ctx.context.password.hash(ctx.body.password);
                await ctx.context.internalAdapter.linkAccount({
                    accountId: user.id,
                    providerId: "credential",
                    password: hashedPassword,
                    userId: user.id
                });
                return ctx.json({
                    user
                });
            }),
            adminUpdateUser: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/admin/update-user", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].string().meta({
                        description: "The user id"
                    }),
                    data: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["any"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["any"]()).meta({
                        description: "The user data to update"
                    })
                }),
                use: [
                    adminMiddleware
                ],
                metadata: {
                    openapi: {
                        operationId: "updateUser",
                        summary: "Update a user",
                        description: "Update a user's details",
                        responses: {
                            200: {
                                description: "User updated",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$has$2d$permission$2d$qCjQqGds$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                    userId: ctx.context.session.user.id,
                    role: ctx.context.session.user.role,
                    options: opts,
                    permissions: {
                        user: [
                            "update"
                        ]
                    }
                })) throw ctx.error("FORBIDDEN", {
                    message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS,
                    code: "YOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS"
                });
                if (Object.keys(ctx.body.data).length === 0) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: ADMIN_ERROR_CODES.NO_DATA_TO_UPDATE
                });
                if (ctx.body.data?.role) ctx.body.data.role = parseRoles(ctx.body.data.role);
                const updatedUser = await ctx.context.internalAdapter.updateUser(ctx.body.userId, ctx.body.data);
                return ctx.json(updatedUser);
            }),
            listUsers: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/admin/list-users", {
                method: "GET",
                use: [
                    adminMiddleware
                ],
                query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    searchValue: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional().meta({
                        description: "The value to search for. Eg: \"some name\""
                    }),
                    searchField: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"]([
                        "email",
                        "name"
                    ]).meta({
                        description: "The field to search in, defaults to email. Can be `email` or `name`. Eg: \"name\""
                    }).optional(),
                    searchOperator: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"]([
                        "contains",
                        "starts_with",
                        "ends_with"
                    ]).meta({
                        description: "The operator to use for the search. Can be `contains`, `starts_with` or `ends_with`. Eg: \"contains\""
                    }).optional(),
                    limit: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The number of users to return"
                    }).or(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]()).optional(),
                    offset: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The offset to start from"
                    }).or(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]()).optional(),
                    sortBy: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The field to sort by"
                    }).optional(),
                    sortDirection: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"]([
                        "asc",
                        "desc"
                    ]).meta({
                        description: "The direction to sort by"
                    }).optional(),
                    filterField: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The field to filter by"
                    }).optional(),
                    filterValue: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The value to filter by"
                    }).or(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]()).or(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]()).optional(),
                    filterOperator: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"]([
                        "eq",
                        "ne",
                        "lt",
                        "lte",
                        "gt",
                        "gte",
                        "contains"
                    ]).meta({
                        description: "The operator to use for the filter"
                    }).optional()
                }),
                metadata: {
                    openapi: {
                        operationId: "listUsers",
                        summary: "List users",
                        description: "List users",
                        responses: {
                            200: {
                                description: "List of users",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                users: {
                                                    type: "array",
                                                    items: {
                                                        $ref: "#/components/schemas/User"
                                                    }
                                                },
                                                total: {
                                                    type: "number"
                                                },
                                                limit: {
                                                    type: "number"
                                                },
                                                offset: {
                                                    type: "number"
                                                }
                                            },
                                            required: [
                                                "users",
                                                "total"
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const session = ctx.context.session;
                if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$has$2d$permission$2d$qCjQqGds$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                    userId: ctx.context.session.user.id,
                    role: session.user.role,
                    options: opts,
                    permissions: {
                        user: [
                            "list"
                        ]
                    }
                })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("FORBIDDEN", {
                    message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_LIST_USERS
                });
                const where = [];
                if (ctx.query?.searchValue) where.push({
                    field: ctx.query.searchField || "email",
                    operator: ctx.query.searchOperator || "contains",
                    value: ctx.query.searchValue
                });
                if (ctx.query?.filterValue) where.push({
                    field: ctx.query.filterField || "email",
                    operator: ctx.query.filterOperator || "eq",
                    value: ctx.query.filterValue
                });
                try {
                    const users = await ctx.context.internalAdapter.listUsers(Number(ctx.query?.limit) || void 0, Number(ctx.query?.offset) || void 0, ctx.query?.sortBy ? {
                        field: ctx.query.sortBy,
                        direction: ctx.query.sortDirection || "asc"
                    } : void 0, where.length ? where : void 0);
                    const total = await ctx.context.internalAdapter.countTotalUsers(where.length ? where : void 0);
                    return ctx.json({
                        users,
                        total,
                        limit: Number(ctx.query?.limit) || void 0,
                        offset: Number(ctx.query?.offset) || void 0
                    });
                } catch (e) {
                    return ctx.json({
                        users: [],
                        total: 0
                    });
                }
            }),
            listUserSessions: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/admin/list-user-sessions", {
                method: "POST",
                use: [
                    adminMiddleware
                ],
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].string().meta({
                        description: "The user id"
                    })
                }),
                metadata: {
                    openapi: {
                        operationId: "listUserSessions",
                        summary: "List user sessions",
                        description: "List user sessions",
                        responses: {
                            200: {
                                description: "List of user sessions",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                sessions: {
                                                    type: "array",
                                                    items: {
                                                        $ref: "#/components/schemas/Session"
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const session = ctx.context.session;
                if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$has$2d$permission$2d$qCjQqGds$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                    userId: ctx.context.session.user.id,
                    role: session.user.role,
                    options: opts,
                    permissions: {
                        session: [
                            "list"
                        ]
                    }
                })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("FORBIDDEN", {
                    message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_LIST_USERS_SESSIONS
                });
                return {
                    sessions: await ctx.context.internalAdapter.listSessions(ctx.body.userId)
                };
            }),
            unbanUser: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/admin/unban-user", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].string().meta({
                        description: "The user id"
                    })
                }),
                use: [
                    adminMiddleware
                ],
                metadata: {
                    openapi: {
                        operationId: "unbanUser",
                        summary: "Unban a user",
                        description: "Unban a user",
                        responses: {
                            200: {
                                description: "User unbanned",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const session = ctx.context.session;
                if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$has$2d$permission$2d$qCjQqGds$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                    userId: ctx.context.session.user.id,
                    role: session.user.role,
                    options: opts,
                    permissions: {
                        user: [
                            "ban"
                        ]
                    }
                })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("FORBIDDEN", {
                    message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_BAN_USERS
                });
                const user = await ctx.context.internalAdapter.updateUser(ctx.body.userId, {
                    banned: false,
                    banExpires: null,
                    banReason: null,
                    updatedAt: /* @__PURE__ */ new Date()
                });
                return ctx.json({
                    user
                });
            }),
            banUser: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/admin/ban-user", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].string().meta({
                        description: "The user id"
                    }),
                    banReason: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The reason for the ban"
                    }).optional(),
                    banExpiresIn: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]().meta({
                        description: "The number of seconds until the ban expires"
                    }).optional()
                }),
                use: [
                    adminMiddleware
                ],
                metadata: {
                    openapi: {
                        operationId: "banUser",
                        summary: "Ban a user",
                        description: "Ban a user",
                        responses: {
                            200: {
                                description: "User banned",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const session = ctx.context.session;
                if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$has$2d$permission$2d$qCjQqGds$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                    userId: ctx.context.session.user.id,
                    role: session.user.role,
                    options: opts,
                    permissions: {
                        user: [
                            "ban"
                        ]
                    }
                })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("FORBIDDEN", {
                    message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_BAN_USERS
                });
                if (!await ctx.context.internalAdapter.findUserById(ctx.body.userId)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("NOT_FOUND", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].USER_NOT_FOUND
                });
                if (ctx.body.userId === ctx.context.session.user.id) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: ADMIN_ERROR_CODES.YOU_CANNOT_BAN_YOURSELF
                });
                const user = await ctx.context.internalAdapter.updateUser(ctx.body.userId, {
                    banned: true,
                    banReason: ctx.body.banReason || options?.defaultBanReason || "No reason",
                    banExpires: ctx.body.banExpiresIn ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(ctx.body.banExpiresIn, "sec") : options?.defaultBanExpiresIn ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(options.defaultBanExpiresIn, "sec") : void 0,
                    updatedAt: /* @__PURE__ */ new Date()
                });
                await ctx.context.internalAdapter.deleteSessions(ctx.body.userId);
                return ctx.json({
                    user
                });
            }),
            impersonateUser: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/admin/impersonate-user", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].string().meta({
                        description: "The user id"
                    })
                }),
                use: [
                    adminMiddleware
                ],
                metadata: {
                    openapi: {
                        operationId: "impersonateUser",
                        summary: "Impersonate a user",
                        description: "Impersonate a user",
                        responses: {
                            200: {
                                description: "Impersonation session created",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                session: {
                                                    $ref: "#/components/schemas/Session"
                                                },
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$has$2d$permission$2d$qCjQqGds$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                    userId: ctx.context.session.user.id,
                    role: ctx.context.session.user.role,
                    options: opts,
                    permissions: {
                        user: [
                            "impersonate"
                        ]
                    }
                })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("FORBIDDEN", {
                    message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_IMPERSONATE_USERS
                });
                const targetUser = await ctx.context.internalAdapter.findUserById(ctx.body.userId);
                if (!targetUser) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("NOT_FOUND", {
                    message: "User not found"
                });
                const session = await ctx.context.internalAdapter.createSession(targetUser.id, true, {
                    impersonatedBy: ctx.context.session.user.id,
                    expiresAt: options?.impersonationSessionDuration ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(options.impersonationSessionDuration, "sec") : (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(3600, "sec")
                }, true);
                if (!session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("INTERNAL_SERVER_ERROR", {
                    message: ADMIN_ERROR_CODES.FAILED_TO_CREATE_USER
                });
                const authCookies = ctx.context.authCookies;
                (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])(ctx);
                const dontRememberMeCookie = await ctx.getSignedCookie(ctx.context.authCookies.dontRememberToken.name, ctx.context.secret);
                const adminCookieProp = ctx.context.createAuthCookie("admin_session");
                await ctx.setSignedCookie(adminCookieProp.name, `${ctx.context.session.session.token}:${dontRememberMeCookie || ""}`, ctx.context.secret, authCookies.sessionToken.options);
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, {
                    session,
                    user: targetUser
                }, true);
                return ctx.json({
                    session,
                    user: targetUser
                });
            }),
            stopImpersonating: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/admin/stop-impersonating", {
                method: "POST",
                requireHeaders: true
            }, async (ctx)=>{
                const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(ctx);
                if (!session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED");
                if (!session.session.impersonatedBy) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: "You are not impersonating anyone"
                });
                const user = await ctx.context.internalAdapter.findUserById(session.session.impersonatedBy);
                if (!user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("INTERNAL_SERVER_ERROR", {
                    message: "Failed to find user"
                });
                const adminCookieName = ctx.context.createAuthCookie("admin_session").name;
                const adminCookie = await ctx.getSignedCookie(adminCookieName, ctx.context.secret);
                if (!adminCookie) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("INTERNAL_SERVER_ERROR", {
                    message: "Failed to find admin session"
                });
                const [adminSessionToken, dontRememberMeCookie] = adminCookie?.split(":");
                const adminSession = await ctx.context.internalAdapter.findSession(adminSessionToken);
                if (!adminSession || adminSession.session.userId !== user.id) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("INTERNAL_SERVER_ERROR", {
                    message: "Failed to find admin session"
                });
                await ctx.context.internalAdapter.deleteSession(session.session.token);
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, adminSession, !!dontRememberMeCookie);
                return ctx.json(adminSession);
            }),
            revokeUserSession: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/admin/revoke-user-session", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    sessionToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The session token"
                    })
                }),
                use: [
                    adminMiddleware
                ],
                metadata: {
                    openapi: {
                        operationId: "revokeUserSession",
                        summary: "Revoke a user session",
                        description: "Revoke a user session",
                        responses: {
                            200: {
                                description: "Session revoked",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                success: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const session = ctx.context.session;
                if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$has$2d$permission$2d$qCjQqGds$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                    userId: ctx.context.session.user.id,
                    role: session.user.role,
                    options: opts,
                    permissions: {
                        session: [
                            "revoke"
                        ]
                    }
                })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("FORBIDDEN", {
                    message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS
                });
                await ctx.context.internalAdapter.deleteSession(ctx.body.sessionToken);
                return ctx.json({
                    success: true
                });
            }),
            revokeUserSessions: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/admin/revoke-user-sessions", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].string().meta({
                        description: "The user id"
                    })
                }),
                use: [
                    adminMiddleware
                ],
                metadata: {
                    openapi: {
                        operationId: "revokeUserSessions",
                        summary: "Revoke all user sessions",
                        description: "Revoke all user sessions",
                        responses: {
                            200: {
                                description: "Sessions revoked",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                success: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const session = ctx.context.session;
                if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$has$2d$permission$2d$qCjQqGds$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                    userId: ctx.context.session.user.id,
                    role: session.user.role,
                    options: opts,
                    permissions: {
                        session: [
                            "revoke"
                        ]
                    }
                })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("FORBIDDEN", {
                    message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS
                });
                await ctx.context.internalAdapter.deleteSessions(ctx.body.userId);
                return ctx.json({
                    success: true
                });
            }),
            removeUser: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/admin/remove-user", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].string().meta({
                        description: "The user id"
                    })
                }),
                use: [
                    adminMiddleware
                ],
                metadata: {
                    openapi: {
                        operationId: "removeUser",
                        summary: "Remove a user",
                        description: "Delete a user and all their sessions and accounts. Cannot be undone.",
                        responses: {
                            200: {
                                description: "User removed",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                success: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const session = ctx.context.session;
                if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$has$2d$permission$2d$qCjQqGds$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                    userId: ctx.context.session.user.id,
                    role: session.user.role,
                    options: opts,
                    permissions: {
                        user: [
                            "delete"
                        ]
                    }
                })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("FORBIDDEN", {
                    message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_DELETE_USERS
                });
                if (ctx.body.userId === ctx.context.session.user.id) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: ADMIN_ERROR_CODES.YOU_CANNOT_REMOVE_YOURSELF
                });
                if (!await ctx.context.internalAdapter.findUserById(ctx.body.userId)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("NOT_FOUND", {
                    message: "User not found"
                });
                await ctx.context.internalAdapter.deleteUser(ctx.body.userId);
                return ctx.json({
                    success: true
                });
            }),
            setUserPassword: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/admin/set-user-password", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    newPassword: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().nonempty("newPassword cannot be empty").meta({
                        description: "The new password"
                    }),
                    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].string().nonempty("userId cannot be empty").meta({
                        description: "The user id"
                    })
                }),
                use: [
                    adminMiddleware
                ],
                metadata: {
                    openapi: {
                        operationId: "setUserPassword",
                        summary: "Set a user's password",
                        description: "Set a user's password",
                        responses: {
                            200: {
                                description: "Password set",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                status: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$has$2d$permission$2d$qCjQqGds$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                    userId: ctx.context.session.user.id,
                    role: ctx.context.session.user.role,
                    options: opts,
                    permissions: {
                        user: [
                            "set-password"
                        ]
                    }
                })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("FORBIDDEN", {
                    message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_SET_USERS_PASSWORD
                });
                const { newPassword, userId } = ctx.body;
                const minPasswordLength = ctx.context.password.config.minPasswordLength;
                if (newPassword.length < minPasswordLength) {
                    ctx.context.logger.error("Password is too short");
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].PASSWORD_TOO_SHORT
                    });
                }
                const maxPasswordLength = ctx.context.password.config.maxPasswordLength;
                if (newPassword.length > maxPasswordLength) {
                    ctx.context.logger.error("Password is too long");
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].PASSWORD_TOO_LONG
                    });
                }
                const hashedPassword = await ctx.context.password.hash(newPassword);
                await ctx.context.internalAdapter.updatePassword(userId, hashedPassword);
                return ctx.json({
                    status: true
                });
            }),
            userHasPermission: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/admin/has-permission", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].string().optional().meta({
                        description: `The user id. Eg: "user-id"`
                    }),
                    role: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional().meta({
                        description: `The role to check permission for. Eg: "admin"`
                    })
                }).and(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["union"]([
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                        permission: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]())),
                        permissions: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["undefined"]()
                    }),
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                        permission: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["undefined"](),
                        permissions: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]()))
                    })
                ])),
                metadata: {
                    openapi: {
                        description: "Check if the user has permission",
                        requestBody: {
                            content: {
                                "application/json": {
                                    schema: {
                                        type: "object",
                                        properties: {
                                            permission: {
                                                type: "object",
                                                description: "The permission to check",
                                                deprecated: true
                                            },
                                            permissions: {
                                                type: "object",
                                                description: "The permission to check"
                                            }
                                        },
                                        required: [
                                            "permissions"
                                        ]
                                    }
                                }
                            }
                        },
                        responses: {
                            "200": {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                error: {
                                                    type: "string"
                                                },
                                                success: {
                                                    type: "boolean"
                                                }
                                            },
                                            required: [
                                                "success"
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    },
                    $Infer: {
                        body: {}
                    }
                }
            }, async (ctx)=>{
                if (!ctx.body?.permission && !ctx.body?.permissions) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: "invalid permission check. no permission(s) were passed."
                });
                const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(ctx);
                if (!session && (ctx.request || ctx.headers)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED");
                if (!session && !ctx.body.userId && !ctx.body.role) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: "user id or role is required"
                });
                const user = session?.user || (ctx.body.role ? {
                    id: ctx.body.userId || "",
                    role: ctx.body.role
                } : null) || await ctx.context.internalAdapter.findUserById(ctx.body.userId);
                if (!user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: "user not found"
                });
                const result = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$has$2d$permission$2d$qCjQqGds$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                    userId: user.id,
                    role: user.role,
                    options,
                    permissions: ctx.body.permissions ?? ctx.body.permission
                });
                return ctx.json({
                    error: null,
                    success: result
                });
            })
        },
        $ERROR_CODES: ADMIN_ERROR_CODES,
        schema: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(schema, opts.schema),
        options
    };
};
;
}),
"[project]/node_modules/better-auth/dist/anonymous-DxoIOUPc.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>anonymous
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2d$db7gNqd$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/utils-db7gNqd-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/schema-Bb7wzeK_.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api-CkmycQ2x.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript) <export APIError as t>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/session-AaRl3_x-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils-C5EN75oV.mjs [app-route] (ecmascript) <export t as defineErrorCodes>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
//#region src/plugins/anonymous/error-codes.ts
const ANONYMOUS_ERROR_CODES = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__["defineErrorCodes"])({
    INVALID_EMAIL_FORMAT: "Email was not generated in a valid format",
    FAILED_TO_CREATE_USER: "Failed to create user",
    COULD_NOT_CREATE_SESSION: "Could not create session",
    ANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY: "Anonymous users cannot sign in again anonymously"
});
//#endregion
//#region src/plugins/anonymous/schema.ts
const schema = {
    user: {
        fields: {
            isAnonymous: {
                type: "boolean",
                required: false,
                input: false,
                defaultValue: false
            }
        }
    }
};
//#endregion
//#region src/plugins/anonymous/index.ts
async function getAnonUserEmail(options) {
    const customEmail = await options?.generateRandomEmail?.();
    if (customEmail) {
        if (!__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["email"]().safeParse(customEmail).success) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
            message: ANONYMOUS_ERROR_CODES.INVALID_EMAIL_FORMAT
        });
        return customEmail;
    }
    const id = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2d$db7gNqd$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])();
    if (options?.emailDomainName) return `temp-${id}@${options.emailDomainName}`;
    return `temp@${id}.com`;
}
const anonymous = (options)=>{
    return {
        id: "anonymous",
        endpoints: {
            signInAnonymous: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/sign-in/anonymous", {
                method: "POST",
                metadata: {
                    openapi: {
                        description: "Sign in anonymously",
                        responses: {
                            200: {
                                description: "Sign in anonymously",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                },
                                                session: {
                                                    $ref: "#/components/schemas/Session"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                if ((await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(ctx, {
                    disableRefresh: true
                }))?.user.isAnonymous) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: ANONYMOUS_ERROR_CODES.ANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY
                });
                const email = await getAnonUserEmail(options);
                const name = await options?.generateName?.(ctx) || "Anonymous";
                const newUser = await ctx.context.internalAdapter.createUser({
                    email,
                    emailVerified: false,
                    isAnonymous: true,
                    name,
                    createdAt: /* @__PURE__ */ new Date(),
                    updatedAt: /* @__PURE__ */ new Date()
                });
                if (!newUser) throw ctx.error("INTERNAL_SERVER_ERROR", {
                    message: ANONYMOUS_ERROR_CODES.FAILED_TO_CREATE_USER
                });
                const session = await ctx.context.internalAdapter.createSession(newUser.id);
                if (!session) return ctx.json(null, {
                    status: 400,
                    body: {
                        message: ANONYMOUS_ERROR_CODES.COULD_NOT_CREATE_SESSION
                    }
                });
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, {
                    session,
                    user: newUser
                });
                return ctx.json({
                    token: session.token,
                    user: {
                        id: newUser.id,
                        email: newUser.email,
                        emailVerified: newUser.emailVerified,
                        name: newUser.name,
                        createdAt: newUser.createdAt,
                        updatedAt: newUser.updatedAt
                    }
                });
            })
        },
        hooks: {
            after: [
                {
                    matcher (ctx) {
                        return ctx.path.startsWith("/sign-in") || ctx.path.startsWith("/sign-up") || ctx.path.startsWith("/callback") || ctx.path.startsWith("/oauth2/callback") || ctx.path.startsWith("/magic-link/verify") || ctx.path.startsWith("/email-otp/verify-email") || ctx.path.startsWith("/one-tap/callback") || ctx.path.startsWith("/passkey/verify-authentication") || ctx.path.startsWith("/phone-number/verify");
                    },
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        const setCookie = ctx.context.responseHeaders?.get("set-cookie");
                        /**
				* We can consider the user is about to sign in or sign up
				* if the response contains a session token.
				*/ const sessionTokenName = ctx.context.authCookies.sessionToken.name;
                        if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["l"])(setCookie || "").get(sessionTokenName)?.value.split(".")[0]) return;
                        /**
				* Make sure the user had an anonymous session.
				*/ const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(ctx, {
                            disableRefresh: true
                        });
                        if (!session || !session.user.isAnonymous) return;
                        if (ctx.path === "/sign-in/anonymous" && !ctx.context.newSession) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                            message: ANONYMOUS_ERROR_CODES.ANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY
                        });
                        const newSession = ctx.context.newSession;
                        if (!newSession) return;
                        if (options?.onLinkAccount) await options?.onLinkAccount?.({
                            anonymousUser: session,
                            newUser: newSession,
                            ctx
                        });
                        if (!options?.disableDeleteAnonymousUser) await ctx.context.internalAdapter.deleteUser(session.user.id);
                    })
                }
            ]
        },
        schema: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(schema, options?.schema),
        $ERROR_CODES: ANONYMOUS_ERROR_CODES
    };
};
;
}),
"[project]/node_modules/better-auth/dist/jwt-Ar1sciI2.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "a",
    ()=>generateExportedKeyPair,
    "i",
    ()=>createJwk,
    "n",
    ()=>verifyJWT,
    "r",
    ()=>getJwtToken,
    "t",
    ()=>jwt
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/crypto-CFUhAR9W.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/schema-Bb7wzeK_.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api-CkmycQ2x.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript) <export APIError as t>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/session-AaRl3_x-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/context/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__u__as__getCurrentAuthContext$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/context-DgQ9XGBl.mjs [app-route] (ecmascript) <export u as getCurrentAuthContext>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error-BhAKg8LX.mjs [app-route] (ecmascript) <export t as BetterAuthError>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$sign$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/jwt/sign.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$key$2f$export$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/key/export.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$key$2f$generate_key_pair$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/key/generate_key_pair.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$key$2f$import$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/key/import.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$verify$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/jwt/verify.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/base64.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
//#region src/plugins/jwt/adapter.ts
const getJwksAdapter = (adapter, options)=>{
    return {
        getAllKeys: async (ctx)=>{
            if (options?.adapter?.getJwks) return await options.adapter.getJwks(ctx);
            return await adapter.findMany({
                model: "jwks"
            });
        },
        getLatestKey: async (ctx)=>{
            if (options?.adapter?.getJwks) return (await options.adapter.getJwks(ctx))?.sort((a, b)=>b.createdAt.getTime() - a.createdAt.getTime())[0];
            return (await adapter.findMany({
                model: "jwks"
            }))?.sort((a, b)=>b.createdAt.getTime() - a.createdAt.getTime())[0];
        },
        createJwk: async (ctx, webKey)=>{
            if (options?.adapter?.createJwk) return await options.adapter.createJwk(webKey, ctx);
            return await adapter.create({
                model: "jwks",
                data: {
                    ...webKey,
                    createdAt: /* @__PURE__ */ new Date()
                }
            });
        }
    };
};
//#endregion
//#region src/plugins/jwt/schema.ts
const schema = {
    jwks: {
        fields: {
            publicKey: {
                type: "string",
                required: true
            },
            privateKey: {
                type: "string",
                required: true
            },
            createdAt: {
                type: "date",
                required: true
            },
            expiresAt: {
                type: "date",
                required: false
            }
        }
    }
};
//#endregion
//#region src/utils/time.ts
const minute = 60;
const hour = minute * 60;
const day = hour * 24;
const week = day * 7;
const year = day * 365.25;
const REGEX = /^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;
/**
* https://github.com/panva/jose/blob/723ee6152d7ee2fc81852d2d26777e86df6fce01/src/lib/secs.ts
*/ function joseSecs(str) {
    const matched = REGEX.exec(str);
    if (!matched || matched[4] && matched[1]) throw new TypeError("Invalid time period format");
    const value = parseFloat(matched[2]);
    const unit = matched[3].toLowerCase();
    let numericDate;
    switch(unit){
        case "sec":
        case "secs":
        case "second":
        case "seconds":
        case "s":
            numericDate = Math.round(value);
            break;
        case "minute":
        case "minutes":
        case "min":
        case "mins":
        case "m":
            numericDate = Math.round(value * minute);
            break;
        case "hour":
        case "hours":
        case "hr":
        case "hrs":
        case "h":
            numericDate = Math.round(value * hour);
            break;
        case "day":
        case "days":
        case "d":
            numericDate = Math.round(value * day);
            break;
        case "week":
        case "weeks":
        case "w":
            numericDate = Math.round(value * week);
            break;
        default:
            numericDate = Math.round(value * year);
            break;
    }
    if (matched[1] === "-" || matched[4] === "ago") return -numericDate;
    return numericDate;
}
//#endregion
//#region src/plugins/jwt/utils.ts
/**
* Converts an expirationTime to ISO seconds expiration time (the format of JWT exp)
*
* See https://github.com/panva/jose/blob/main/src/lib/jwt_claims_set.ts#L245
*
* @param expirationTime - see options.jwt.expirationTime
* @param iat - the iat time to consolidate on
* @returns
*/ function toExpJWT(expirationTime, iat) {
    if (typeof expirationTime === "number") return expirationTime;
    else if (expirationTime instanceof Date) return Math.floor(expirationTime.getTime() / 1e3);
    else return iat + joseSecs(expirationTime);
}
async function generateExportedKeyPair(options) {
    const { alg, ...cfg } = options?.jwks?.keyPairConfig ?? {
        alg: "EdDSA",
        crv: "Ed25519"
    };
    const { publicKey, privateKey } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$key$2f$generate_key_pair$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateKeyPair"])(alg, {
        ...cfg,
        extractable: true
    });
    return {
        publicWebKey: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$key$2f$export$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["exportJWK"])(publicKey),
        privateWebKey: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$key$2f$export$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["exportJWK"])(privateKey),
        alg,
        cfg
    };
}
/**
* Creates a Jwk on the database
*
* @param ctx
* @param options
* @returns
*/ async function createJwk(ctx, options) {
    const { publicWebKey, privateWebKey, alg, cfg } = await generateExportedKeyPair(options);
    const stringifiedPrivateWebKey = JSON.stringify(privateWebKey);
    const privateKeyEncryptionEnabled = !options?.jwks?.disablePrivateKeyEncryption;
    let jwk = {
        alg,
        ...cfg && "crv" in cfg ? {
            crv: cfg.crv
        } : {},
        publicKey: JSON.stringify(publicWebKey),
        privateKey: privateKeyEncryptionEnabled ? JSON.stringify(await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])({
            key: ctx.context.secret,
            data: stringifiedPrivateWebKey
        })) : stringifiedPrivateWebKey,
        createdAt: /* @__PURE__ */ new Date(),
        ...options?.jwks?.rotationInterval ? {
            expiresAt: new Date(Date.now() + options.jwks.rotationInterval * 1e3)
        } : {}
    };
    return await getJwksAdapter(ctx.context.adapter, options).createJwk(ctx, jwk);
}
//#endregion
//#region src/plugins/jwt/sign.ts
async function signJWT(ctx, config) {
    const { options, payload } = config;
    const nowSeconds = Math.floor(Date.now() / 1e3);
    const iat = payload.iat;
    let exp = payload.exp;
    const defaultExp = toExpJWT(options?.jwt?.expirationTime ?? "15m", iat ?? nowSeconds);
    exp = exp ?? defaultExp;
    const nbf = payload.nbf;
    const iss = payload.iss;
    const defaultIss = options?.jwt?.issuer ?? ctx.context.options.baseURL;
    const aud = payload.aud;
    const defaultAud = options?.jwt?.audience ?? ctx.context.options.baseURL;
    if (options?.jwt?.sign) {
        const jwtPayload = {
            ...payload,
            iat,
            exp,
            nbf,
            iss: iss ?? defaultIss,
            aud: aud ?? defaultAud
        };
        return options.jwt.sign(jwtPayload);
    }
    let key = await getJwksAdapter(ctx.context.adapter, options).getLatestKey(ctx);
    if (!key || key.expiresAt && key.expiresAt < /* @__PURE__ */ new Date()) key = await createJwk(ctx, options);
    let privateWebKey = !options?.jwks?.disablePrivateKeyEncryption ? await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
        key: ctx.context.secret,
        data: JSON.parse(key.privateKey)
    }).catch(()=>{
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("Failed to decrypt private key. Make sure the secret currently in use is the same as the one used to encrypt the private key. If you are using a different secret, either clean up your JWKS or disable private key encryption.");
    }) : key.privateKey;
    const alg = key.alg ?? options?.jwks?.keyPairConfig?.alg ?? "EdDSA";
    const privateKey = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$key$2f$import$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["importJWK"])(JSON.parse(privateWebKey), alg);
    const jwt$1 = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$sign$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["SignJWT"](payload).setProtectedHeader({
        alg,
        kid: key.id
    }).setExpirationTime(exp).setIssuer(iss ?? defaultIss).setAudience(aud ?? defaultAud);
    if (iat) jwt$1.setIssuedAt(iat);
    if (payload.sub) jwt$1.setSubject(payload.sub);
    if (payload.nbf) jwt$1.setNotBefore(payload.nbf);
    if (payload.jti) jwt$1.setJti(payload.jti);
    return await jwt$1.sign(privateKey);
}
async function getJwtToken(ctx, options) {
    const payload = !options?.jwt?.definePayload ? ctx.context.session.user : await options?.jwt.definePayload(ctx.context.session);
    return await signJWT(ctx, {
        options,
        payload: {
            iat: Math.floor(Date.now() / 1e3),
            ...payload,
            sub: await options?.jwt?.getSubject?.(ctx.context.session) ?? ctx.context.session.user.id
        }
    });
}
//#endregion
//#region src/plugins/jwt/verify.ts
/**
* Verify a JWT token using the JWKS public keys
* Returns the payload if valid, null otherwise
*/ async function verifyJWT(token, options) {
    const ctx = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__u__as__getCurrentAuthContext$3e$__["getCurrentAuthContext"])();
    try {
        const parts = token.split(".");
        if (parts.length !== 3) return null;
        const headerStr = new TextDecoder().decode(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["base64"].decode(parts[0]));
        const kid = JSON.parse(headerStr).kid;
        if (!kid) {
            ctx.context.logger.debug("JWT missing kid in header");
            return null;
        }
        const keys = await getJwksAdapter(ctx.context.adapter, options).getAllKeys(ctx);
        if (!keys || keys.length === 0) {
            ctx.context.logger.debug("No JWKS keys available");
            return null;
        }
        const key = keys.find((k)=>k.id === kid);
        if (!key) {
            ctx.context.logger.debug(`No JWKS key found for kid: ${kid}`);
            return null;
        }
        const { payload } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$verify$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["jwtVerify"])(token, await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$key$2f$import$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["importJWK"])(JSON.parse(key.publicKey), key.alg ?? options?.jwks?.keyPairConfig?.alg ?? "EdDSA"), {
            issuer: options?.jwt?.issuer ?? ctx.context.options.baseURL
        });
        if (!payload.sub || !payload.aud) return null;
        return payload;
    } catch (error) {
        ctx.context.logger.debug("JWT verification failed", error);
        return null;
    }
}
//#endregion
//#region src/plugins/jwt/index.ts
const jwt = (options)=>{
    if (options?.jwt?.sign && !options.jwks?.remoteUrl) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("jwks_config", "jwks.remoteUrl must be set when using jwt.sign");
    if (options?.jwks?.remoteUrl && !options.jwks?.keyPairConfig?.alg) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("jwks_config", "must specify alg when using the oidc plugin and jwks.remoteUrl");
    const jwksPath = options?.jwks?.jwksPath ?? "/jwks";
    if (typeof jwksPath !== "string" || jwksPath.length === 0 || !jwksPath.startsWith("/") || jwksPath.includes("..")) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("jwks_config", "jwksPath must be a non-empty string starting with '/' and not contain '..'");
    return {
        id: "jwt",
        options,
        endpoints: {
            getJwks: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])(jwksPath, {
                method: "GET",
                metadata: {
                    openapi: {
                        operationId: "getJSONWebKeySet",
                        description: "Get the JSON Web Key Set",
                        responses: {
                            "200": {
                                description: "JSON Web Key Set retrieved successfully",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                keys: {
                                                    type: "array",
                                                    description: "Array of public JSON Web Keys",
                                                    items: {
                                                        type: "object",
                                                        properties: {
                                                            kid: {
                                                                type: "string",
                                                                description: "Key ID uniquely identifying the key, corresponds to the 'id' from the stored Jwk"
                                                            },
                                                            kty: {
                                                                type: "string",
                                                                description: "Key type (e.g., 'RSA', 'EC', 'OKP')"
                                                            },
                                                            alg: {
                                                                type: "string",
                                                                description: "Algorithm intended for use with the key (e.g., 'EdDSA', 'RS256')"
                                                            },
                                                            use: {
                                                                type: "string",
                                                                description: "Intended use of the public key (e.g., 'sig' for signature)",
                                                                enum: [
                                                                    "sig"
                                                                ],
                                                                nullable: true
                                                            },
                                                            n: {
                                                                type: "string",
                                                                description: "Modulus for RSA keys (base64url-encoded)",
                                                                nullable: true
                                                            },
                                                            e: {
                                                                type: "string",
                                                                description: "Exponent for RSA keys (base64url-encoded)",
                                                                nullable: true
                                                            },
                                                            crv: {
                                                                type: "string",
                                                                description: "Curve name for elliptic curve keys (e.g., 'Ed25519', 'P-256')",
                                                                nullable: true
                                                            },
                                                            x: {
                                                                type: "string",
                                                                description: "X coordinate for elliptic curve keys (base64url-encoded)",
                                                                nullable: true
                                                            },
                                                            y: {
                                                                type: "string",
                                                                description: "Y coordinate for elliptic curve keys (base64url-encoded)",
                                                                nullable: true
                                                            }
                                                        },
                                                        required: [
                                                            "kid",
                                                            "kty",
                                                            "alg"
                                                        ]
                                                    }
                                                }
                                            },
                                            required: [
                                                "keys"
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                if (options?.jwks?.remoteUrl) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("NOT_FOUND");
                const adapter = getJwksAdapter(ctx.context.adapter, options);
                let keySets = await adapter.getAllKeys(ctx);
                if (!keySets || keySets?.length === 0) {
                    await createJwk(ctx, options);
                    keySets = await adapter.getAllKeys(ctx);
                }
                if (!keySets?.length) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__BetterAuthError$3e$__["BetterAuthError"]("No key sets found. Make sure you have a key in your database.");
                const now = Date.now();
                const gracePeriod = (options?.jwks?.gracePeriod ?? 3600 * 24 * 30) * 1e3;
                const keys = keySets.filter((key)=>{
                    if (!key.expiresAt) return true;
                    return key.expiresAt.getTime() + gracePeriod > now;
                });
                const keyPairConfig = options?.jwks?.keyPairConfig;
                const defaultCrv = keyPairConfig ? "crv" in keyPairConfig ? keyPairConfig.crv : void 0 : void 0;
                return ctx.json({
                    keys: keys.map((keySet)=>{
                        return {
                            alg: keySet.alg ?? options?.jwks?.keyPairConfig?.alg ?? "EdDSA",
                            crv: keySet.crv ?? defaultCrv,
                            ...JSON.parse(keySet.publicKey),
                            kid: keySet.id
                        };
                    })
                });
            }),
            getToken: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/token", {
                method: "GET",
                requireHeaders: true,
                use: [
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"]
                ],
                metadata: {
                    openapi: {
                        operationId: "getJSONWebToken",
                        description: "Get a JWT token",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                token: {
                                                    type: "string"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const jwt$1 = await getJwtToken(ctx, options);
                return ctx.json({
                    token: jwt$1
                });
            }),
            signJWT: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/sign-jwt", {
                method: "POST",
                metadata: {
                    SERVER_ONLY: true,
                    $Infer: {
                        body: {}
                    }
                },
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    payload: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["any"]()),
                    overrideOptions: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["any"]()).optional()
                })
            }, async (c)=>{
                const jwt$1 = await signJWT(c, {
                    options: {
                        ...options,
                        ...c.body.overrideOptions
                    },
                    payload: c.body.payload
                });
                return c.json({
                    token: jwt$1
                });
            }),
            verifyJWT: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/verify-jwt", {
                method: "POST",
                metadata: {
                    SERVER_ONLY: true,
                    $Infer: {
                        body: {},
                        response: {}
                    }
                },
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
                    issuer: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional()
                })
            }, async (ctx)=>{
                const overrideOptions = ctx.body.issuer ? {
                    ...options,
                    jwt: {
                        ...options?.jwt,
                        issuer: ctx.body.issuer
                    }
                } : options;
                const payload = await verifyJWT(ctx.body.token, overrideOptions);
                return ctx.json({
                    payload
                });
            })
        },
        hooks: {
            after: [
                {
                    matcher (context) {
                        return context.path === "/get-session";
                    },
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        if (options?.disableSettingJwtHeader) return;
                        const session = ctx.context.session || ctx.context.newSession;
                        if (session && session.session) {
                            const jwt$1 = await getJwtToken(ctx, options);
                            const exposedHeaders = ctx.context.responseHeaders?.get("access-control-expose-headers") || "";
                            const headersSet = new Set(exposedHeaders.split(",").map((header)=>header.trim()).filter(Boolean));
                            headersSet.add("set-auth-jwt");
                            ctx.setHeader("set-auth-jwt", jwt$1);
                            ctx.setHeader("Access-Control-Expose-Headers", Array.from(headersSet).join(", "));
                        }
                    })
                }
            ]
        },
        schema: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(schema, options?.schema)
    };
};
;
}),
"[project]/node_modules/better-auth/dist/oidc-provider-B9SsN23J.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "a",
    ()=>parsePrompt,
    "i",
    ()=>schema,
    "n",
    ()=>getMetadata,
    "r",
    ()=>oidcProvider,
    "t",
    ()=>getClient
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/crypto-CFUhAR9W.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/schema-Bb7wzeK_.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api-CkmycQ2x.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript) <export APIError as t>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/session-AaRl3_x-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$jwt$2d$Ar1sciI2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/jwt-Ar1sciI2.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/context/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__u__as__getCurrentAuthContext$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/context-DgQ9XGBl.mjs [app-route] (ecmascript) <export u as getCurrentAuthContext>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/hash.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$sign$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/jwt/sign.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$verify$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/jwt/verify.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/base64.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
;
;
//#region src/plugins/oidc-provider/error.ts
var OIDCProviderError = class extends __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"] {
};
var InvalidRequest = class extends OIDCProviderError {
    constructor(error_description, error_detail){
        super("BAD_REQUEST", {
            message: "invalid_request",
            error_description,
            error_detail
        });
    }
};
//#endregion
//#region src/plugins/oidc-provider/utils/prompt.ts
/**
* Parse space-separated prompt string into a set of prompts
*
* @param prompt
*/ function parsePrompt(prompt) {
    const prompts = prompt.split(" ").map((p)=>p.trim());
    const set = /* @__PURE__ */ new Set();
    for (const p of prompts)if (p === "login" || p === "consent" || p === "select_account" || p === "none") set.add(p);
    if (set.has("none") && set.size > 1) throw new InvalidRequest("prompt none must only be used alone");
    return new Set(set);
}
//#endregion
//#region src/plugins/oidc-provider/authorize.ts
function formatErrorURL(url, error, description) {
    return `${url.includes("?") ? "&" : "?"}error=${error}&error_description=${description}`;
}
function getErrorURL(ctx, error, description) {
    return formatErrorURL(ctx.context.options.onAPIError?.errorURL || `${ctx.context.baseURL}/error`, error, description);
}
async function authorize(ctx, options) {
    const handleRedirect = (url)=>{
        if (ctx.request?.headers.get("sec-fetch-mode") === "cors") return ctx.json({
            redirect: true,
            url
        });
        else throw ctx.redirect(url);
    };
    const opts = {
        codeExpiresIn: 600,
        defaultScope: "openid",
        ...options,
        scopes: [
            "openid",
            "profile",
            "email",
            "offline_access",
            ...options?.scopes || []
        ]
    };
    if (!ctx.request) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
        error_description: "request not found",
        error: "invalid_request"
    });
    const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(ctx);
    if (!session) {
        const query$1 = ctx.query;
        if (parsePrompt(query$1.prompt ?? "").has("none") && query$1.redirect_uri) return handleRedirect(formatErrorURL(query$1.redirect_uri, "login_required", "Authentication required but prompt is none"));
        /**
		* If the user is not logged in, we need to redirect them to the
		* login page.
		*/ await ctx.setSignedCookie("oidc_login_prompt", JSON.stringify(ctx.query), ctx.context.secret, {
            maxAge: 600,
            path: "/",
            sameSite: "lax"
        });
        const queryFromURL = ctx.request.url?.split("?")[1];
        return handleRedirect(`${options.loginPage}?${queryFromURL}`);
    }
    const query = ctx.query;
    if (!query.client_id) {
        const errorURL = getErrorURL(ctx, "invalid_client", "client_id is required");
        throw ctx.redirect(errorURL);
    }
    if (!query.response_type) {
        const errorURL = getErrorURL(ctx, "invalid_request", "response_type is required");
        throw ctx.redirect(errorURL);
    }
    const client = await getClient(ctx.query.client_id, options.trustedClients || []);
    if (!client) {
        const errorURL = getErrorURL(ctx, "invalid_client", "client_id is required");
        throw ctx.redirect(errorURL);
    }
    const redirectURI = client.redirectUrls.find((url)=>url === ctx.query.redirect_uri);
    if (!redirectURI || !query.redirect_uri) /**
	* show UI error here warning the user that the redirect URI is invalid
	*/ throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Invalid redirect URI"
    });
    if (client.disabled) {
        const errorURL = getErrorURL(ctx, "client_disabled", "client is disabled");
        throw ctx.redirect(errorURL);
    }
    if (query.response_type !== "code") {
        const errorURL = getErrorURL(ctx, "unsupported_response_type", "unsupported response type");
        throw ctx.redirect(errorURL);
    }
    const requestScope = query.scope?.split(" ").filter((s)=>s) || opts.defaultScope.split(" ");
    const invalidScopes = requestScope.filter((scope)=>{
        return !opts.scopes.includes(scope);
    });
    if (invalidScopes.length) return handleRedirect(formatErrorURL(query.redirect_uri, "invalid_scope", `The following scopes are invalid: ${invalidScopes.join(", ")}`));
    if ((!query.code_challenge || !query.code_challenge_method) && options.requirePKCE) return handleRedirect(formatErrorURL(query.redirect_uri, "invalid_request", "pkce is required"));
    if (!query.code_challenge_method) query.code_challenge_method = "plain";
    if (![
        "s256",
        options.allowPlainCodeChallengeMethod ? "plain" : "s256"
    ].includes(query.code_challenge_method?.toLowerCase() || "")) return handleRedirect(formatErrorURL(query.redirect_uri, "invalid_request", "invalid code_challenge method"));
    const code = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(32, "a-z", "A-Z", "0-9");
    const codeExpiresInMs = opts.codeExpiresIn * 1e3;
    const expiresAt = new Date(Date.now() + codeExpiresInMs);
    const skipConsentForTrustedClient = client.skipConsent;
    const hasAlreadyConsented = await ctx.context.adapter.findOne({
        model: "oauthConsent",
        where: [
            {
                field: "clientId",
                value: client.clientId
            },
            {
                field: "userId",
                value: session.user.id
            }
        ]
    }).then((res)=>{
        if (!res?.consentGiven) return false;
        const consentedScopes = res.scopes ? res.scopes.split(" ") : [];
        return requestScope.every((scope)=>consentedScopes.includes(scope));
    });
    const promptSet = parsePrompt(query.prompt ?? "");
    if (promptSet.has("none")) {
        if (!skipConsentForTrustedClient && !hasAlreadyConsented) return handleRedirect(formatErrorURL(query.redirect_uri, "consent_required", "Consent required but prompt is none"));
    }
    let requireLogin = promptSet.has("login");
    if (query.max_age !== void 0) {
        const maxAge = Number(query.max_age);
        if (Number.isInteger(maxAge) && maxAge >= 0) {
            if ((Date.now() - new Date(session.session.createdAt).getTime()) / 1e3 > maxAge) requireLogin = true;
        }
    }
    const requireConsent = !skipConsentForTrustedClient && (!hasAlreadyConsented || promptSet.has("consent"));
    try {
        /**
		* Save the code in the database
		*/ await ctx.context.internalAdapter.createVerificationValue({
            value: JSON.stringify({
                clientId: client.clientId,
                redirectURI: query.redirect_uri,
                scope: requestScope,
                userId: session.user.id,
                authTime: new Date(session.session.createdAt).getTime(),
                requireConsent,
                state: requireConsent ? query.state : null,
                codeChallenge: query.code_challenge,
                codeChallengeMethod: query.code_challenge_method,
                nonce: query.nonce
            }),
            identifier: code,
            expiresAt
        });
    } catch (e) {
        return handleRedirect(formatErrorURL(query.redirect_uri, "server_error", "An error occurred while processing the request"));
    }
    if (requireLogin) {
        await ctx.setSignedCookie("oidc_login_prompt", JSON.stringify(ctx.query), ctx.context.secret, {
            maxAge: 600,
            path: "/",
            sameSite: "lax"
        });
        await ctx.setSignedCookie("oidc_consent_prompt", code, ctx.context.secret, {
            maxAge: 600,
            path: "/",
            sameSite: "lax"
        });
        return handleRedirect(`${options.loginPage}?${new URLSearchParams({
            client_id: client.clientId,
            code,
            state: query.state
        }).toString()}`);
    }
    if (!requireConsent) {
        const redirectURIWithCode = new URL(redirectURI);
        redirectURIWithCode.searchParams.set("code", code);
        redirectURIWithCode.searchParams.set("state", ctx.query.state);
        return handleRedirect(redirectURIWithCode.toString());
    }
    if (options?.consentPage) {
        await ctx.setSignedCookie("oidc_consent_prompt", code, ctx.context.secret, {
            maxAge: 600,
            path: "/",
            sameSite: "lax"
        });
        const urlParams = new URLSearchParams();
        urlParams.set("consent_code", code);
        urlParams.set("client_id", client.clientId);
        urlParams.set("scope", requestScope.join(" "));
        return handleRedirect(`${options.consentPage}?${urlParams.toString()}`);
    }
    const htmlFn = options?.getConsentHTML;
    if (!htmlFn) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
        message: "No consent page provided"
    });
    return new Response(htmlFn({
        scopes: requestScope,
        clientMetadata: client.metadata,
        clientIcon: client?.icon,
        clientId: client.clientId,
        clientName: client.name,
        code
    }), {
        headers: {
            "content-type": "text/html"
        }
    });
}
//#endregion
//#region src/plugins/oidc-provider/schema.ts
const oAuthApplicationSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    clientId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
    clientSecret: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional(),
    type: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"]([
        "web",
        "native",
        "user-agent-based",
        "public"
    ]),
    name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
    icon: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional(),
    metadata: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional(),
    disabled: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().optional().default(false),
    redirectUrls: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional(),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["date"](),
    updatedAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["date"]()
});
const schema = {
    oauthApplication: {
        modelName: "oauthApplication",
        fields: {
            name: {
                type: "string"
            },
            icon: {
                type: "string",
                required: false
            },
            metadata: {
                type: "string",
                required: false
            },
            clientId: {
                type: "string",
                unique: true
            },
            clientSecret: {
                type: "string",
                required: false
            },
            redirectUrls: {
                type: "string"
            },
            type: {
                type: "string"
            },
            disabled: {
                type: "boolean",
                required: false,
                defaultValue: false
            },
            userId: {
                type: "string",
                required: false,
                references: {
                    model: "user",
                    field: "id",
                    onDelete: "cascade"
                },
                index: true
            },
            createdAt: {
                type: "date"
            },
            updatedAt: {
                type: "date"
            }
        }
    },
    oauthAccessToken: {
        modelName: "oauthAccessToken",
        fields: {
            accessToken: {
                type: "string",
                unique: true
            },
            refreshToken: {
                type: "string",
                unique: true
            },
            accessTokenExpiresAt: {
                type: "date"
            },
            refreshTokenExpiresAt: {
                type: "date"
            },
            clientId: {
                type: "string",
                references: {
                    model: "oauthApplication",
                    field: "clientId",
                    onDelete: "cascade"
                },
                index: true
            },
            userId: {
                type: "string",
                required: false,
                references: {
                    model: "user",
                    field: "id",
                    onDelete: "cascade"
                },
                index: true
            },
            scopes: {
                type: "string"
            },
            createdAt: {
                type: "date"
            },
            updatedAt: {
                type: "date"
            }
        }
    },
    oauthConsent: {
        modelName: "oauthConsent",
        fields: {
            clientId: {
                type: "string",
                references: {
                    model: "oauthApplication",
                    field: "clientId",
                    onDelete: "cascade"
                },
                index: true
            },
            userId: {
                type: "string",
                references: {
                    model: "user",
                    field: "id",
                    onDelete: "cascade"
                },
                index: true
            },
            scopes: {
                type: "string"
            },
            createdAt: {
                type: "date"
            },
            updatedAt: {
                type: "date"
            },
            consentGiven: {
                type: "boolean"
            }
        }
    }
};
//#endregion
//#region src/plugins/oidc-provider/utils.ts
/**
* Default client secret hasher using SHA-256
*/ const defaultClientSecretHasher = async (clientSecret)=>{
    const hash = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createHash"])("SHA-256").digest(new TextEncoder().encode(clientSecret));
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["base64Url"].encode(new Uint8Array(hash), {
        padding: false
    });
};
//#endregion
//#region src/plugins/oidc-provider/index.ts
const getJwtPlugin = (ctx)=>{
    return ctx.context.options.plugins?.find((plugin)=>plugin.id === "jwt");
};
/**
* Get a client by ID, checking trusted clients first, then database
*/ async function getClient(clientId, trustedClients = []) {
    const { context: { adapter } } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__u__as__getCurrentAuthContext$3e$__["getCurrentAuthContext"])();
    const trustedClient = trustedClients.find((client)=>client.clientId === clientId);
    if (trustedClient) return trustedClient;
    return adapter.findOne({
        model: "oauthApplication",
        where: [
            {
                field: "clientId",
                value: clientId
            }
        ]
    }).then((res)=>{
        if (!res) return null;
        return {
            clientId: res.clientId,
            clientSecret: res.clientSecret,
            type: res.type,
            name: res.name,
            icon: res.icon,
            disabled: res.disabled,
            redirectUrls: (res.redirectUrls ?? "").split(","),
            metadata: res.metadata ? JSON.parse(res.metadata) : {}
        };
    });
}
const getMetadata = (ctx, options)=>{
    const jwtPlugin = getJwtPlugin(ctx);
    const issuer = jwtPlugin && jwtPlugin.options?.jwt && jwtPlugin.options.jwt.issuer ? jwtPlugin.options.jwt.issuer : ctx.context.options.baseURL;
    const baseURL = ctx.context.baseURL;
    const supportedAlgs = options?.useJWTPlugin ? [
        "RS256",
        "EdDSA",
        "none"
    ] : [
        "HS256",
        "none"
    ];
    return {
        issuer,
        authorization_endpoint: `${baseURL}/oauth2/authorize`,
        token_endpoint: `${baseURL}/oauth2/token`,
        userinfo_endpoint: `${baseURL}/oauth2/userinfo`,
        jwks_uri: `${baseURL}/jwks`,
        registration_endpoint: `${baseURL}/oauth2/register`,
        end_session_endpoint: `${baseURL}/oauth2/endsession`,
        scopes_supported: [
            "openid",
            "profile",
            "email",
            "offline_access"
        ],
        response_types_supported: [
            "code"
        ],
        response_modes_supported: [
            "query"
        ],
        grant_types_supported: [
            "authorization_code",
            "refresh_token"
        ],
        acr_values_supported: [
            "urn:mace:incommon:iap:silver",
            "urn:mace:incommon:iap:bronze"
        ],
        subject_types_supported: [
            "public"
        ],
        id_token_signing_alg_values_supported: supportedAlgs,
        token_endpoint_auth_methods_supported: [
            "client_secret_basic",
            "client_secret_post",
            "none"
        ],
        code_challenge_methods_supported: [
            "S256"
        ],
        claims_supported: [
            "sub",
            "iss",
            "aud",
            "exp",
            "nbf",
            "iat",
            "jti",
            "email",
            "email_verified",
            "name"
        ],
        ...options?.metadata
    };
};
/**
* OpenID Connect (OIDC) plugin for Better Auth. This plugin implements the
* authorization code flow and the token exchange flow. It also implements the
* userinfo endpoint.
*
* @param options - The options for the OIDC plugin.
* @returns A Better Auth plugin.
*/ const oidcProvider = (options)=>{
    const modelName = {
        oauthClient: "oauthApplication",
        oauthAccessToken: "oauthAccessToken",
        oauthConsent: "oauthConsent"
    };
    const opts = {
        codeExpiresIn: 600,
        defaultScope: "openid",
        accessTokenExpiresIn: 3600,
        refreshTokenExpiresIn: 604800,
        allowPlainCodeChallengeMethod: true,
        storeClientSecret: "plain",
        ...options,
        scopes: [
            "openid",
            "profile",
            "email",
            "offline_access",
            ...options?.scopes || []
        ]
    };
    const trustedClients = options.trustedClients || [];
    /**
	* Store client secret according to the configured storage method
	*/ async function storeClientSecret(ctx, clientSecret) {
        if (opts.storeClientSecret === "encrypted") return await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])({
            key: ctx.context.secret,
            data: clientSecret
        });
        if (opts.storeClientSecret === "hashed") return await defaultClientSecretHasher(clientSecret);
        if (typeof opts.storeClientSecret === "object" && "hash" in opts.storeClientSecret) return await opts.storeClientSecret.hash(clientSecret);
        if (typeof opts.storeClientSecret === "object" && "encrypt" in opts.storeClientSecret) return await opts.storeClientSecret.encrypt(clientSecret);
        return clientSecret;
    }
    /**
	* Verify stored client secret against provided client secret
	*/ async function verifyStoredClientSecret(ctx, storedClientSecret, clientSecret) {
        if (opts.storeClientSecret === "encrypted") return await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
            key: ctx.context.secret,
            data: storedClientSecret
        }) === clientSecret;
        if (opts.storeClientSecret === "hashed") return await defaultClientSecretHasher(clientSecret) === storedClientSecret;
        if (typeof opts.storeClientSecret === "object" && "hash" in opts.storeClientSecret) return await opts.storeClientSecret.hash(clientSecret) === storedClientSecret;
        if (typeof opts.storeClientSecret === "object" && "decrypt" in opts.storeClientSecret) return await opts.storeClientSecret.decrypt(storedClientSecret) === clientSecret;
        return clientSecret === storedClientSecret;
    }
    return {
        id: "oidc",
        hooks: {
            after: [
                {
                    matcher () {
                        return true;
                    },
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        const loginPromptCookie = await ctx.getSignedCookie("oidc_login_prompt", ctx.context.secret);
                        const cookieName = ctx.context.authCookies.sessionToken.name;
                        const parsedSetCookieHeader = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["l"])(ctx.context.responseHeaders?.get("set-cookie") || "");
                        const hasSessionToken = parsedSetCookieHeader.has(cookieName);
                        if (!loginPromptCookie || !hasSessionToken) return;
                        ctx.setCookie("oidc_login_prompt", "", {
                            maxAge: 0
                        });
                        const sessionToken = parsedSetCookieHeader.get(cookieName)?.value?.split(".")[0];
                        if (!sessionToken) return;
                        const session = await ctx.context.internalAdapter.findSession(sessionToken) || ctx.context.newSession;
                        if (!session) return;
                        ctx.query = JSON.parse(loginPromptCookie);
                        const promptSet = parsePrompt(String(ctx.query?.prompt));
                        if (promptSet.has("login")) {
                            const newPromptSet = new Set(promptSet);
                            newPromptSet.delete("login");
                            ctx.query = {
                                ...ctx.query,
                                prompt: Array.from(newPromptSet).join(" ")
                            };
                        }
                        ctx.context.session = session;
                        return await authorize(ctx, opts);
                    })
                }
            ]
        },
        endpoints: {
            getOpenIdConfig: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/.well-known/openid-configuration", {
                method: "GET",
                operationId: "getOpenIdConfig",
                metadata: {
                    isAction: false
                }
            }, async (ctx)=>{
                const metadata = getMetadata(ctx, options);
                return ctx.json(metadata);
            }),
            oAuth2authorize: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/oauth2/authorize", {
                method: "GET",
                operationId: "oauth2Authorize",
                query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["any"]()),
                metadata: {
                    openapi: {
                        description: "Authorize an OAuth2 request",
                        responses: {
                            "200": {
                                description: "Authorization response generated successfully",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            additionalProperties: true,
                                            description: "Authorization response, contents depend on the authorize function implementation"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                return authorize(ctx, opts);
            }),
            oAuthConsent: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/oauth2/consent", {
                method: "POST",
                operationId: "oauth2Consent",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    accept: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"](),
                    consent_code: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional().nullish()
                }),
                use: [
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"]
                ],
                metadata: {
                    openapi: {
                        description: "Handle OAuth2 consent. Supports both URL parameter-based flows (consent_code in body) and cookie-based flows (signed cookie).",
                        requestBody: {
                            required: true,
                            content: {
                                "application/json": {
                                    schema: {
                                        type: "object",
                                        properties: {
                                            accept: {
                                                type: "boolean",
                                                description: "Whether the user accepts or denies the consent request"
                                            },
                                            consent_code: {
                                                type: "string",
                                                description: "The consent code from the authorization request. Optional if using cookie-based flow."
                                            }
                                        },
                                        required: [
                                            "accept"
                                        ]
                                    }
                                }
                            }
                        },
                        responses: {
                            "200": {
                                description: "Consent processed successfully",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                redirectURI: {
                                                    type: "string",
                                                    format: "uri",
                                                    description: "The URI to redirect to, either with an authorization code or an error"
                                                }
                                            },
                                            required: [
                                                "redirectURI"
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                let consentCode = ctx.body.consent_code || null;
                if (!consentCode) {
                    const cookieValue = await ctx.getSignedCookie("oidc_consent_prompt", ctx.context.secret);
                    if (cookieValue) consentCode = cookieValue;
                }
                if (!consentCode) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error_description: "consent_code is required (either in body or cookie)",
                    error: "invalid_request"
                });
                const verification = await ctx.context.internalAdapter.findVerificationValue(consentCode);
                if (!verification) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error_description: "Invalid code",
                    error: "invalid_request"
                });
                if (verification.expiresAt < /* @__PURE__ */ new Date()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error_description: "Code expired",
                    error: "invalid_request"
                });
                ctx.setCookie("oidc_consent_prompt", "", {
                    maxAge: 0
                });
                const value = JSON.parse(verification.value);
                if (!value.requireConsent) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error_description: "Consent not required",
                    error: "invalid_request"
                });
                if (!ctx.body.accept) {
                    await ctx.context.internalAdapter.deleteVerificationValue(verification.id);
                    return ctx.json({
                        redirectURI: `${value.redirectURI}?error=access_denied&error_description=User denied access`
                    });
                }
                const code = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(32, "a-z", "A-Z", "0-9");
                const codeExpiresInMs = opts.codeExpiresIn * 1e3;
                const expiresAt = new Date(Date.now() + codeExpiresInMs);
                await ctx.context.internalAdapter.updateVerificationValue(verification.id, {
                    value: JSON.stringify({
                        ...value,
                        requireConsent: false
                    }),
                    identifier: code,
                    expiresAt
                });
                await ctx.context.adapter.create({
                    model: modelName.oauthConsent,
                    data: {
                        clientId: value.clientId,
                        userId: value.userId,
                        scopes: value.scope.join(" "),
                        consentGiven: true,
                        createdAt: /* @__PURE__ */ new Date(),
                        updatedAt: /* @__PURE__ */ new Date()
                    }
                });
                const redirectURI = new URL(value.redirectURI);
                redirectURI.searchParams.set("code", code);
                if (value.state) redirectURI.searchParams.set("state", value.state);
                return ctx.json({
                    redirectURI: redirectURI.toString()
                });
            }),
            oAuth2token: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/oauth2/token", {
                method: "POST",
                operationId: "oauth2Token",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["any"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["any"]()),
                metadata: {
                    isAction: false,
                    allowedMediaTypes: [
                        "application/x-www-form-urlencoded",
                        "application/json"
                    ]
                }
            }, async (ctx)=>{
                let { body } = ctx;
                if (!body) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    error_description: "request body not found",
                    error: "invalid_request"
                });
                if (body instanceof FormData) body = Object.fromEntries(body.entries());
                if (!(body instanceof Object)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    error_description: "request body is not an object",
                    error: "invalid_request"
                });
                let { client_id, client_secret } = body;
                const authorization = ctx.request?.headers.get("authorization") || null;
                if (authorization && !client_id && !client_secret && authorization.startsWith("Basic ")) try {
                    const encoded = authorization.replace("Basic ", "");
                    const decoded = new TextDecoder().decode(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["base64"].decode(encoded));
                    if (!decoded.includes(":")) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                        error_description: "invalid authorization header format",
                        error: "invalid_client"
                    });
                    const [id, secret] = decoded.split(":");
                    if (!id || !secret) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                        error_description: "invalid authorization header format",
                        error: "invalid_client"
                    });
                    client_id = id;
                    client_secret = secret;
                } catch (error) {
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                        error_description: "invalid authorization header format",
                        error: "invalid_client"
                    });
                }
                const now = Date.now();
                const iat = Math.floor(now / 1e3);
                const exp = iat + (opts.accessTokenExpiresIn ?? 3600);
                const accessTokenExpiresAt = /* @__PURE__ */ new Date(exp * 1e3);
                const refreshTokenExpiresAt = /* @__PURE__ */ new Date((iat + (opts.refreshTokenExpiresIn ?? 604800)) * 1e3);
                const { grant_type, code, redirect_uri, refresh_token, code_verifier } = body;
                if (grant_type === "refresh_token") {
                    if (!refresh_token) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        error_description: "refresh_token is required",
                        error: "invalid_request"
                    });
                    const token = await ctx.context.adapter.findOne({
                        model: modelName.oauthAccessToken,
                        where: [
                            {
                                field: "refreshToken",
                                value: refresh_token.toString()
                            }
                        ]
                    });
                    if (!token) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                        error_description: "invalid refresh token",
                        error: "invalid_grant"
                    });
                    if (token.clientId !== client_id?.toString()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                        error_description: "invalid client_id",
                        error: "invalid_client"
                    });
                    if (token.refreshTokenExpiresAt < /* @__PURE__ */ new Date()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                        error_description: "refresh token expired",
                        error: "invalid_grant"
                    });
                    const accessToken$1 = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(32, "a-z", "A-Z");
                    const newRefreshToken = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(32, "a-z", "A-Z");
                    await ctx.context.adapter.create({
                        model: modelName.oauthAccessToken,
                        data: {
                            accessToken: accessToken$1,
                            refreshToken: newRefreshToken,
                            accessTokenExpiresAt,
                            refreshTokenExpiresAt,
                            clientId: client_id.toString(),
                            userId: token.userId,
                            scopes: token.scopes,
                            createdAt: /* @__PURE__ */ new Date(iat * 1e3),
                            updatedAt: /* @__PURE__ */ new Date(iat * 1e3)
                        }
                    });
                    return ctx.json({
                        access_token: accessToken$1,
                        token_type: "Bearer",
                        expires_in: opts.accessTokenExpiresIn,
                        refresh_token: newRefreshToken,
                        scope: token.scopes
                    });
                }
                if (!code) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    error_description: "code is required",
                    error: "invalid_request"
                });
                if (options.requirePKCE && !code_verifier) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    error_description: "code verifier is missing",
                    error: "invalid_request"
                });
                /**
				* We need to check if the code is valid before we can proceed
				* with the rest of the request.
				*/ const verificationValue = await ctx.context.internalAdapter.findVerificationValue(code.toString());
                if (!verificationValue) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error_description: "invalid code",
                    error: "invalid_grant"
                });
                if (verificationValue.expiresAt < /* @__PURE__ */ new Date()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error_description: "code expired",
                    error: "invalid_grant"
                });
                await ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);
                if (!client_id) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error_description: "client_id is required",
                    error: "invalid_client"
                });
                if (!grant_type) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    error_description: "grant_type is required",
                    error: "invalid_request"
                });
                if (grant_type !== "authorization_code") throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    error_description: "grant_type must be 'authorization_code'",
                    error: "unsupported_grant_type"
                });
                if (!redirect_uri) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    error_description: "redirect_uri is required",
                    error: "invalid_request"
                });
                const client = await getClient(client_id.toString(), trustedClients);
                if (!client) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error_description: "invalid client_id",
                    error: "invalid_client"
                });
                if (client.disabled) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error_description: "client is disabled",
                    error: "invalid_client"
                });
                const value = JSON.parse(verificationValue.value);
                if (value.clientId !== client_id.toString()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error_description: "invalid client_id",
                    error: "invalid_client"
                });
                if (value.redirectURI !== redirect_uri.toString()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error_description: "invalid redirect_uri",
                    error: "invalid_client"
                });
                if (value.codeChallenge && !code_verifier) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    error_description: "code verifier is missing",
                    error: "invalid_request"
                });
                if (client.type === "public") {
                    if (!code_verifier) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        error_description: "code verifier is required for public clients",
                        error: "invalid_request"
                    });
                } else {
                    if (!client.clientSecret || !client_secret) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                        error_description: "client_secret is required for confidential clients",
                        error: "invalid_client"
                    });
                    if (!await verifyStoredClientSecret(ctx, client.clientSecret, client_secret.toString())) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                        error_description: "invalid client_secret",
                        error: "invalid_client"
                    });
                }
                if ((value.codeChallengeMethod === "plain" ? code_verifier : await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createHash"])("SHA-256", "base64urlnopad").digest(code_verifier)) !== value.codeChallenge) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error_description: "code verification failed",
                    error: "invalid_request"
                });
                const requestedScopes = value.scope;
                await ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);
                const accessToken = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(32, "a-z", "A-Z");
                const refreshToken = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(32, "A-Z", "a-z");
                await ctx.context.adapter.create({
                    model: modelName.oauthAccessToken,
                    data: {
                        accessToken,
                        refreshToken,
                        accessTokenExpiresAt,
                        refreshTokenExpiresAt,
                        clientId: client_id.toString(),
                        userId: value.userId,
                        scopes: requestedScopes.join(" "),
                        createdAt: /* @__PURE__ */ new Date(iat * 1e3),
                        updatedAt: /* @__PURE__ */ new Date(iat * 1e3)
                    }
                });
                const user = await ctx.context.internalAdapter.findUserById(value.userId);
                if (!user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error_description: "user not found",
                    error: "invalid_grant"
                });
                const profile = {
                    given_name: user.name.split(" ")[0],
                    family_name: user.name.split(" ")[1],
                    name: user.name,
                    profile: user.image,
                    updated_at: new Date(user.updatedAt).toISOString()
                };
                const email = {
                    email: user.email,
                    email_verified: user.emailVerified
                };
                const userClaims = {
                    ...requestedScopes.includes("profile") ? profile : {},
                    ...requestedScopes.includes("email") ? email : {}
                };
                const additionalUserClaims = options.getAdditionalUserInfoClaim ? await options.getAdditionalUserInfoClaim(user, requestedScopes, client) : {};
                const payload = {
                    sub: user.id,
                    aud: client_id.toString(),
                    iat,
                    auth_time: ctx.context.session ? new Date(ctx.context.session.session.createdAt).getTime() : void 0,
                    nonce: value.nonce,
                    acr: "urn:mace:incommon:iap:silver",
                    ...userClaims,
                    ...additionalUserClaims
                };
                const expirationTime = Math.floor(Date.now() / 1e3) + opts.accessTokenExpiresIn;
                let idToken;
                if (options.useJWTPlugin) {
                    const jwtPlugin = getJwtPlugin(ctx);
                    if (!jwtPlugin) {
                        ctx.context.logger.error("OIDC: `useJWTPlugin` is enabled but the JWT plugin is not available. Make sure you have the JWT Plugin in your plugins array or set `useJWTPlugin` to false.");
                        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("INTERNAL_SERVER_ERROR", {
                            error_description: "JWT plugin is not enabled",
                            error: "internal_server_error"
                        });
                    }
                    idToken = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$jwt$2d$Ar1sciI2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])({
                        ...ctx,
                        context: {
                            ...ctx.context,
                            session: {
                                session: {
                                    id: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(32, "a-z", "A-Z"),
                                    createdAt: /* @__PURE__ */ new Date(iat * 1e3),
                                    updatedAt: /* @__PURE__ */ new Date(iat * 1e3),
                                    userId: user.id,
                                    expiresAt: accessTokenExpiresAt,
                                    token: accessToken,
                                    ipAddress: ctx.request?.headers.get("x-forwarded-for")
                                },
                                user
                            }
                        }
                    }, {
                        ...jwtPlugin.options,
                        jwt: {
                            ...jwtPlugin.options?.jwt,
                            getSubject: ()=>user.id,
                            audience: client_id.toString(),
                            issuer: jwtPlugin.options?.jwt?.issuer ?? ctx.context.options.baseURL,
                            expirationTime,
                            definePayload: ()=>payload
                        }
                    });
                } else idToken = await new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$sign$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["SignJWT"](payload).setProtectedHeader({
                    alg: "HS256"
                }).setIssuedAt(iat).setExpirationTime(accessTokenExpiresAt).sign(new TextEncoder().encode(client.clientSecret));
                return ctx.json({
                    access_token: accessToken,
                    token_type: "Bearer",
                    expires_in: opts.accessTokenExpiresIn,
                    refresh_token: requestedScopes.includes("offline_access") ? refreshToken : void 0,
                    scope: requestedScopes.join(" "),
                    id_token: requestedScopes.includes("openid") ? idToken : void 0
                }, {
                    headers: {
                        "Cache-Control": "no-store",
                        Pragma: "no-cache"
                    }
                });
            }),
            oAuth2userInfo: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/oauth2/userinfo", {
                method: "GET",
                operationId: "oauth2Userinfo",
                metadata: {
                    isAction: false,
                    openapi: {
                        description: "Get OAuth2 user information",
                        responses: {
                            "200": {
                                description: "User information retrieved successfully",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                sub: {
                                                    type: "string",
                                                    description: "Subject identifier (user ID)"
                                                },
                                                email: {
                                                    type: "string",
                                                    format: "email",
                                                    nullable: true,
                                                    description: "User's email address, included if 'email' scope is granted"
                                                },
                                                name: {
                                                    type: "string",
                                                    nullable: true,
                                                    description: "User's full name, included if 'profile' scope is granted"
                                                },
                                                picture: {
                                                    type: "string",
                                                    format: "uri",
                                                    nullable: true,
                                                    description: "User's profile picture URL, included if 'profile' scope is granted"
                                                },
                                                given_name: {
                                                    type: "string",
                                                    nullable: true,
                                                    description: "User's given name, included if 'profile' scope is granted"
                                                },
                                                family_name: {
                                                    type: "string",
                                                    nullable: true,
                                                    description: "User's family name, included if 'profile' scope is granted"
                                                },
                                                email_verified: {
                                                    type: "boolean",
                                                    nullable: true,
                                                    description: "Whether the email is verified, included if 'email' scope is granted"
                                                }
                                            },
                                            required: [
                                                "sub"
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                if (!ctx.request) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error_description: "request not found",
                    error: "invalid_request"
                });
                const authorization = ctx.request.headers.get("authorization");
                if (!authorization) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error_description: "authorization header not found",
                    error: "invalid_request"
                });
                const token = authorization.replace("Bearer ", "");
                const accessToken = await ctx.context.adapter.findOne({
                    model: modelName.oauthAccessToken,
                    where: [
                        {
                            field: "accessToken",
                            value: token
                        }
                    ]
                });
                if (!accessToken) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error_description: "invalid access token",
                    error: "invalid_token"
                });
                if (accessToken.accessTokenExpiresAt < /* @__PURE__ */ new Date()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error_description: "The Access Token expired",
                    error: "invalid_token"
                });
                const client = await getClient(accessToken.clientId, trustedClients);
                if (!client) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error_description: "client not found",
                    error: "invalid_token"
                });
                const user = await ctx.context.internalAdapter.findUserById(accessToken.userId);
                if (!user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error_description: "user not found",
                    error: "invalid_token"
                });
                const requestedScopes = accessToken.scopes.split(" ");
                const baseUserClaims = {
                    sub: user.id,
                    email: requestedScopes.includes("email") ? user.email : void 0,
                    name: requestedScopes.includes("profile") ? user.name : void 0,
                    picture: requestedScopes.includes("profile") ? user.image : void 0,
                    given_name: requestedScopes.includes("profile") ? user.name.split(" ")[0] : void 0,
                    family_name: requestedScopes.includes("profile") ? user.name.split(" ")[1] : void 0,
                    email_verified: requestedScopes.includes("email") ? user.emailVerified : void 0
                };
                const userClaims = options.getAdditionalUserInfoClaim ? await options.getAdditionalUserInfoClaim(user, requestedScopes, client) : baseUserClaims;
                return ctx.json({
                    ...baseUserClaims,
                    ...userClaims
                });
            }),
            registerOAuthApplication: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/oauth2/register", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    redirect_uris: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]()).meta({
                        description: "A list of redirect URIs. Eg: [\"https://client.example.com/callback\"]"
                    }),
                    token_endpoint_auth_method: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"]([
                        "none",
                        "client_secret_basic",
                        "client_secret_post"
                    ]).meta({
                        description: "The authentication method for the token endpoint. Eg: \"client_secret_basic\""
                    }).default("client_secret_basic").optional(),
                    grant_types: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"]([
                        "authorization_code",
                        "implicit",
                        "password",
                        "client_credentials",
                        "refresh_token",
                        "urn:ietf:params:oauth:grant-type:jwt-bearer",
                        "urn:ietf:params:oauth:grant-type:saml2-bearer"
                    ])).meta({
                        description: "The grant types supported by the application. Eg: [\"authorization_code\"]"
                    }).default([
                        "authorization_code"
                    ]).optional(),
                    response_types: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"]([
                        "code",
                        "token"
                    ])).meta({
                        description: "The response types supported by the application. Eg: [\"code\"]"
                    }).default([
                        "code"
                    ]).optional(),
                    client_name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The name of the application. Eg: \"My App\""
                    }).optional(),
                    client_uri: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The URI of the application. Eg: \"https://client.example.com\""
                    }).optional(),
                    logo_uri: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The URI of the application logo. Eg: \"https://client.example.com/logo.png\""
                    }).optional(),
                    scope: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The scopes supported by the application. Separated by spaces. Eg: \"profile email\""
                    }).optional(),
                    contacts: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]()).meta({
                        description: "The contact information for the application. Eg: [\"admin@example.com\"]"
                    }).optional(),
                    tos_uri: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The URI of the application terms of service. Eg: \"https://client.example.com/tos\""
                    }).optional(),
                    policy_uri: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The URI of the application privacy policy. Eg: \"https://client.example.com/policy\""
                    }).optional(),
                    jwks_uri: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The URI of the application JWKS. Eg: \"https://client.example.com/jwks\""
                    }).optional(),
                    jwks: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["any"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["any"]()).meta({
                        description: "The JWKS of the application. Eg: {\"keys\": [{\"kty\": \"RSA\", \"alg\": \"RS256\", \"use\": \"sig\", \"n\": \"...\", \"e\": \"...\"}]}"
                    }).optional(),
                    metadata: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["any"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["any"]()).meta({
                        description: "The metadata of the application. Eg: {\"key\": \"value\"}"
                    }).optional(),
                    software_id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The software ID of the application. Eg: \"my-software\""
                    }).optional(),
                    software_version: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The software version of the application. Eg: \"1.0.0\""
                    }).optional(),
                    software_statement: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The software statement of the application."
                    }).optional()
                }),
                metadata: {
                    openapi: {
                        description: "Register an OAuth2 application",
                        responses: {
                            "200": {
                                description: "OAuth2 application registered successfully",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                name: {
                                                    type: "string",
                                                    description: "Name of the OAuth2 application"
                                                },
                                                icon: {
                                                    type: "string",
                                                    nullable: true,
                                                    description: "Icon URL for the application"
                                                },
                                                metadata: {
                                                    type: "object",
                                                    additionalProperties: true,
                                                    nullable: true,
                                                    description: "Additional metadata for the application"
                                                },
                                                clientId: {
                                                    type: "string",
                                                    description: "Unique identifier for the client"
                                                },
                                                clientSecret: {
                                                    type: "string",
                                                    description: "Secret key for the client"
                                                },
                                                redirectURLs: {
                                                    type: "array",
                                                    items: {
                                                        type: "string",
                                                        format: "uri"
                                                    },
                                                    description: "List of allowed redirect URLs"
                                                },
                                                type: {
                                                    type: "string",
                                                    description: "Type of the client",
                                                    enum: [
                                                        "web"
                                                    ]
                                                },
                                                authenticationScheme: {
                                                    type: "string",
                                                    description: "Authentication scheme used by the client",
                                                    enum: [
                                                        "client_secret"
                                                    ]
                                                },
                                                disabled: {
                                                    type: "boolean",
                                                    description: "Whether the client is disabled",
                                                    enum: [
                                                        false
                                                    ]
                                                },
                                                userId: {
                                                    type: "string",
                                                    nullable: true,
                                                    description: "ID of the user who registered the client, null if registered anonymously"
                                                },
                                                createdAt: {
                                                    type: "string",
                                                    format: "date-time",
                                                    description: "Creation timestamp"
                                                },
                                                updatedAt: {
                                                    type: "string",
                                                    format: "date-time",
                                                    description: "Last update timestamp"
                                                }
                                            },
                                            required: [
                                                "name",
                                                "clientId",
                                                "clientSecret",
                                                "redirectURLs",
                                                "type",
                                                "authenticationScheme",
                                                "disabled",
                                                "createdAt",
                                                "updatedAt"
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const body = ctx.body;
                const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(ctx);
                if (!session && !options.allowDynamicClientRegistration) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    error: "invalid_token",
                    error_description: "Authentication required for client registration"
                });
                if ((!body.grant_types || body.grant_types.includes("authorization_code") || body.grant_types.includes("implicit")) && (!body.redirect_uris || body.redirect_uris.length === 0)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    error: "invalid_redirect_uri",
                    error_description: "Redirect URIs are required for authorization_code and implicit grant types"
                });
                if (body.grant_types && body.response_types) {
                    if (body.grant_types.includes("authorization_code") && !body.response_types.includes("code")) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        error: "invalid_client_metadata",
                        error_description: "When 'authorization_code' grant type is used, 'code' response type must be included"
                    });
                    if (body.grant_types.includes("implicit") && !body.response_types.includes("token")) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        error: "invalid_client_metadata",
                        error_description: "When 'implicit' grant type is used, 'token' response type must be included"
                    });
                }
                const clientId = options.generateClientId?.() || (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(32, "a-z", "A-Z");
                const clientSecret = options.generateClientSecret?.() || (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(32, "a-z", "A-Z");
                const storedClientSecret = await storeClientSecret(ctx, clientSecret);
                const client = await ctx.context.adapter.create({
                    model: modelName.oauthClient,
                    data: {
                        name: body.client_name,
                        icon: body.logo_uri,
                        metadata: body.metadata ? JSON.stringify(body.metadata) : null,
                        clientId,
                        clientSecret: storedClientSecret,
                        redirectUrls: body.redirect_uris.join(","),
                        type: "web",
                        authenticationScheme: body.token_endpoint_auth_method || "client_secret_basic",
                        disabled: false,
                        userId: session?.session.userId,
                        createdAt: /* @__PURE__ */ new Date(),
                        updatedAt: /* @__PURE__ */ new Date()
                    }
                });
                return ctx.json({
                    client_id: clientId,
                    ...client.type !== "public" ? {
                        client_secret: clientSecret,
                        client_secret_expires_at: 0
                    } : {},
                    client_id_issued_at: Math.floor(Date.now() / 1e3),
                    client_secret_expires_at: 0,
                    redirect_uris: body.redirect_uris,
                    token_endpoint_auth_method: body.token_endpoint_auth_method || "client_secret_basic",
                    grant_types: body.grant_types || [
                        "authorization_code"
                    ],
                    response_types: body.response_types || [
                        "code"
                    ],
                    client_name: body.client_name,
                    client_uri: body.client_uri,
                    logo_uri: body.logo_uri,
                    scope: body.scope,
                    contacts: body.contacts,
                    tos_uri: body.tos_uri,
                    policy_uri: body.policy_uri,
                    jwks_uri: body.jwks_uri,
                    jwks: body.jwks,
                    software_id: body.software_id,
                    software_version: body.software_version,
                    software_statement: body.software_statement,
                    metadata: body.metadata
                }, {
                    status: 201,
                    headers: {
                        "Cache-Control": "no-store",
                        Pragma: "no-cache"
                    }
                });
            }),
            getOAuthClient: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/oauth2/client/:id", {
                method: "GET",
                use: [
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"]
                ],
                metadata: {
                    openapi: {
                        description: "Get OAuth2 client details",
                        responses: {
                            "200": {
                                description: "OAuth2 client retrieved successfully",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                clientId: {
                                                    type: "string",
                                                    description: "Unique identifier for the client"
                                                },
                                                name: {
                                                    type: "string",
                                                    description: "Name of the OAuth2 application"
                                                },
                                                icon: {
                                                    type: "string",
                                                    nullable: true,
                                                    description: "Icon URL for the application"
                                                }
                                            },
                                            required: [
                                                "clientId",
                                                "name"
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const client = await getClient(ctx.params.id, trustedClients);
                if (!client) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("NOT_FOUND", {
                    error_description: "client not found",
                    error: "not_found"
                });
                return ctx.json({
                    clientId: client.clientId,
                    name: client.name,
                    icon: client.icon || null
                });
            }),
            endSession: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/oauth2/endsession", {
                method: [
                    "GET",
                    "POST"
                ],
                operationId: "oauth2EndSession",
                query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    id_token_hint: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional(),
                    logout_hint: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional(),
                    client_id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional(),
                    post_logout_redirect_uri: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional(),
                    state: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional(),
                    ui_locales: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional()
                }).optional(),
                metadata: {
                    isAction: false,
                    openapi: {
                        description: "RP-Initiated Logout endpoint. Logs out the end-user and optionally redirects to a post-logout URI.",
                        parameters: [
                            {
                                name: "id_token_hint",
                                in: "query",
                                description: "Previously issued ID Token passed as a hint about the End-User's current authenticated session",
                                required: false,
                                schema: {
                                    type: "string"
                                }
                            },
                            {
                                name: "logout_hint",
                                in: "query",
                                description: "Hint to the Authorization Server about the End-User that is logging out",
                                required: false,
                                schema: {
                                    type: "string"
                                }
                            },
                            {
                                name: "client_id",
                                in: "query",
                                description: "OAuth 2.0 Client Identifier. Required if post_logout_redirect_uri is used without id_token_hint",
                                required: false,
                                schema: {
                                    type: "string"
                                }
                            },
                            {
                                name: "post_logout_redirect_uri",
                                in: "query",
                                description: "URL to which the RP is requesting that the End-User's User Agent be redirected after a logout has been performed",
                                required: false,
                                schema: {
                                    type: "string",
                                    format: "uri"
                                }
                            },
                            {
                                name: "state",
                                in: "query",
                                description: "Opaque value used by the RP to maintain state between the logout request and the callback",
                                required: false,
                                schema: {
                                    type: "string"
                                }
                            },
                            {
                                name: "ui_locales",
                                in: "query",
                                description: "End-User's preferred languages and scripts for the user interface",
                                required: false,
                                schema: {
                                    type: "string"
                                }
                            }
                        ],
                        responses: {
                            "302": {
                                description: "Redirect to post_logout_redirect_uri or logout confirmation page"
                            },
                            "200": {
                                description: "Logout completed successfully"
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const { id_token_hint, logout_hint, client_id, post_logout_redirect_uri, state, ui_locales } = ctx.query || {};
                let validatedClientId = null;
                let validatedUserId = null;
                if (id_token_hint) try {
                    const jwtPlugin = getJwtPlugin(ctx);
                    if (jwtPlugin && jwtPlugin.options && options?.useJWTPlugin) {
                        const verified = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$jwt$2d$Ar1sciI2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])(id_token_hint, jwtPlugin.options);
                        if (verified) {
                            validatedUserId = verified.sub;
                            validatedClientId = verified.aud ? typeof verified.aud === "string" ? verified.aud : verified.aud[0] : null;
                        }
                    } else if (client_id) {
                        const client = await getClient(client_id, trustedClients);
                        if (client && client.clientSecret) try {
                            const { payload } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$verify$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["jwtVerify"])(id_token_hint, new TextEncoder().encode(client.clientSecret));
                            validatedUserId = payload.sub;
                            validatedClientId = payload.aud;
                        } catch (error) {}
                    }
                } catch (error) {
                    ctx.context.logger.debug("Invalid id_token_hint provided to end_session endpoint");
                }
                if (client_id) {
                    if (!await getClient(client_id, trustedClients)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        error: "invalid_client",
                        error_description: "Invalid client_id"
                    });
                    if (validatedClientId && validatedClientId !== client_id) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        error: "invalid_request",
                        error_description: "client_id does not match the ID Token's audience"
                    });
                    validatedClientId = client_id;
                }
                if (post_logout_redirect_uri) {
                    if (!validatedClientId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        error: "invalid_request",
                        error_description: "client_id is required when using post_logout_redirect_uri without a valid id_token_hint"
                    });
                    const client = await getClient(validatedClientId, trustedClients);
                    if (!client) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        error: "invalid_client",
                        error_description: "Invalid client"
                    });
                    if (!client.redirectUrls.some((registeredUri)=>post_logout_redirect_uri === registeredUri)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        error: "invalid_request",
                        error_description: "post_logout_redirect_uri is not registered for this client"
                    });
                }
                const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(ctx);
                if (validatedUserId || session) {
                    const userId = validatedUserId || session?.user.id;
                    if (userId) await ctx.context.adapter.deleteMany({
                        model: modelName.oauthAccessToken,
                        where: [
                            {
                                field: "userId",
                                value: userId
                            }
                        ]
                    });
                }
                if (session) {
                    await ctx.context.internalAdapter.deleteSession(session.session.token);
                    ctx.setSignedCookie(ctx.context.authCookies.sessionToken.name, "", ctx.context.secret, {
                        maxAge: 0
                    });
                }
                if (post_logout_redirect_uri) try {
                    const redirectUrl = new URL(post_logout_redirect_uri);
                    if (state) redirectUrl.searchParams.set("state", state);
                    return ctx.redirect(redirectUrl.toString());
                } catch (error) {
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        error: "invalid_request",
                        error_description: "Invalid post_logout_redirect_uri format"
                    });
                }
                return ctx.json({
                    success: true,
                    message: "Logout successful"
                });
            })
        },
        schema: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(schema, options?.schema),
        get options () {
            return opts;
        }
    };
};
;
}),
"[project]/node_modules/better-auth/dist/bearer-C6RSCXv_.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>bearer
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/hmac.mjs [app-route] (ecmascript)");
;
;
;
;
//#region src/plugins/bearer/index.ts
/**
* Converts bearer token to session cookie
*/ const bearer = (options)=>{
    return {
        id: "bearer",
        hooks: {
            before: [
                {
                    matcher (context) {
                        return Boolean(context.request?.headers.get("authorization") || context.headers?.get("authorization"));
                    },
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (c)=>{
                        const token = c.request?.headers.get("authorization")?.replace("Bearer ", "") || c.headers?.get("Authorization")?.replace("Bearer ", "");
                        if (!token) return;
                        let signedToken = "";
                        if (token.includes(".")) signedToken = token.replace("=", "");
                        else {
                            if (options?.requireSignature) return;
                            signedToken = (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["serializeSignedCookie"])("", token, c.context.secret)).replace("=", "");
                        }
                        try {
                            const decodedToken = decodeURIComponent(signedToken);
                            if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createHMAC"])("SHA-256", "base64urlnopad").verify(c.context.secret, decodedToken.split(".")[0], decodedToken.split(".")[1])) return;
                        } catch (e) {
                            return;
                        }
                        const existingHeaders = c.request?.headers || c.headers;
                        const headers = new Headers({
                            ...Object.fromEntries(existingHeaders?.entries())
                        });
                        headers.append("cookie", `${c.context.authCookies.sessionToken.name}=${signedToken}`);
                        return {
                            context: {
                                headers
                            }
                        };
                    })
                }
            ],
            after: [
                {
                    matcher (context) {
                        return true;
                    },
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        const setCookie = ctx.context.responseHeaders?.get("set-cookie");
                        if (!setCookie) return;
                        const parsedCookies = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["l"])(setCookie);
                        const cookieName = ctx.context.authCookies.sessionToken.name;
                        const sessionCookie = parsedCookies.get(cookieName);
                        if (!sessionCookie || !sessionCookie.value || sessionCookie["max-age"] === 0) return;
                        const token = sessionCookie.value;
                        const exposedHeaders = ctx.context.responseHeaders?.get("access-control-expose-headers") || "";
                        const headersSet = new Set(exposedHeaders.split(",").map((header)=>header.trim()).filter(Boolean));
                        headersSet.add("set-auth-token");
                        ctx.setHeader("set-auth-token", token);
                        ctx.setHeader("Access-Control-Expose-Headers", Array.from(headersSet).join(", "));
                    })
                }
            ]
        }
    };
};
;
}),
"[project]/node_modules/better-auth/dist/captcha-Dbvurc2Z.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>captcha
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$request$2d$ip$2d$D6st$2d$mto$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/get-request-ip-D6st-mto.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils-C5EN75oV.mjs [app-route] (ecmascript) <export t as defineErrorCodes>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-fetch/fetch/dist/index.js [app-route] (ecmascript)");
;
;
;
//#region src/utils/middleware-response.ts
const middlewareResponse = ({ message, status })=>({
        response: new Response(JSON.stringify({
            message
        }), {
            status
        })
    });
//#endregion
//#region src/plugins/captcha/constants.ts
const defaultEndpoints = [
    "/sign-up/email",
    "/sign-in/email",
    "/request-password-reset"
];
const Providers = {
    CLOUDFLARE_TURNSTILE: "cloudflare-turnstile",
    GOOGLE_RECAPTCHA: "google-recaptcha",
    HCAPTCHA: "hcaptcha",
    CAPTCHAFOX: "captchafox"
};
const siteVerifyMap = {
    [Providers.CLOUDFLARE_TURNSTILE]: "https://challenges.cloudflare.com/turnstile/v0/siteverify",
    [Providers.GOOGLE_RECAPTCHA]: "https://www.google.com/recaptcha/api/siteverify",
    [Providers.HCAPTCHA]: "https://api.hcaptcha.com/siteverify",
    [Providers.CAPTCHAFOX]: "https://api.captchafox.com/siteverify"
};
//#endregion
//#region src/plugins/captcha/error-codes.ts
const EXTERNAL_ERROR_CODES = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__["defineErrorCodes"])({
    VERIFICATION_FAILED: "Captcha verification failed",
    MISSING_RESPONSE: "Missing CAPTCHA response",
    UNKNOWN_ERROR: "Something went wrong"
});
const INTERNAL_ERROR_CODES = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__["defineErrorCodes"])({
    MISSING_SECRET_KEY: "Missing secret key",
    SERVICE_UNAVAILABLE: "CAPTCHA service unavailable"
});
//#endregion
//#region src/plugins/captcha/utils.ts
const encodeToURLParams = (obj)=>{
    if (typeof obj !== "object" || obj === null || Array.isArray(obj)) throw new Error("Input must be a non-null object.");
    const params = new URLSearchParams();
    for (const [key, value] of Object.entries(obj))if (value !== void 0 && value !== null) params.append(key, String(value));
    return params.toString();
};
//#endregion
//#region src/plugins/captcha/verify-handlers/captchafox.ts
const captchaFox = async ({ siteVerifyURL, captchaResponse, secretKey, siteKey, remoteIP })=>{
    const response = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterFetch"])(siteVerifyURL, {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: encodeToURLParams({
            secret: secretKey,
            response: captchaResponse,
            ...siteKey && {
                sitekey: siteKey
            },
            ...remoteIP && {
                remoteIp: remoteIP
            }
        })
    });
    if (!response.data || response.error) throw new Error(INTERNAL_ERROR_CODES.SERVICE_UNAVAILABLE);
    if (!response.data.success) return middlewareResponse({
        message: EXTERNAL_ERROR_CODES.VERIFICATION_FAILED,
        status: 403
    });
};
//#endregion
//#region src/plugins/captcha/verify-handlers/cloudflare-turnstile.ts
const cloudflareTurnstile = async ({ siteVerifyURL, captchaResponse, secretKey, remoteIP })=>{
    const response = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterFetch"])(siteVerifyURL, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            secret: secretKey,
            response: captchaResponse,
            ...remoteIP && {
                remoteip: remoteIP
            }
        })
    });
    if (!response.data || response.error) throw new Error(INTERNAL_ERROR_CODES.SERVICE_UNAVAILABLE);
    if (!response.data.success) return middlewareResponse({
        message: EXTERNAL_ERROR_CODES.VERIFICATION_FAILED,
        status: 403
    });
};
//#endregion
//#region src/plugins/captcha/verify-handlers/google-recaptcha.ts
const isV3 = (response)=>{
    return "score" in response && typeof response.score === "number";
};
const googleRecaptcha = async ({ siteVerifyURL, captchaResponse, secretKey, minScore = .5, remoteIP })=>{
    const response = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterFetch"])(siteVerifyURL, {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: encodeToURLParams({
            secret: secretKey,
            response: captchaResponse,
            ...remoteIP && {
                remoteip: remoteIP
            }
        })
    });
    if (!response.data || response.error) throw new Error(INTERNAL_ERROR_CODES.SERVICE_UNAVAILABLE);
    if (!response.data.success || isV3(response.data) && response.data.score < minScore) return middlewareResponse({
        message: EXTERNAL_ERROR_CODES.VERIFICATION_FAILED,
        status: 403
    });
};
//#endregion
//#region src/plugins/captcha/verify-handlers/h-captcha.ts
const hCaptcha = async ({ siteVerifyURL, captchaResponse, secretKey, siteKey, remoteIP })=>{
    const response = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterFetch"])(siteVerifyURL, {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: encodeToURLParams({
            secret: secretKey,
            response: captchaResponse,
            ...siteKey && {
                sitekey: siteKey
            },
            ...remoteIP && {
                remoteip: remoteIP
            }
        })
    });
    if (!response.data || response.error) throw new Error(INTERNAL_ERROR_CODES.SERVICE_UNAVAILABLE);
    if (!response.data.success) return middlewareResponse({
        message: EXTERNAL_ERROR_CODES.VERIFICATION_FAILED,
        status: 403
    });
};
//#endregion
//#region src/plugins/captcha/index.ts
const captcha = (options)=>({
        id: "captcha",
        onRequest: async (request, ctx)=>{
            try {
                if (!(options.endpoints?.length ? options.endpoints : defaultEndpoints).some((endpoint)=>request.url.includes(endpoint))) return void 0;
                if (!options.secretKey) throw new Error(INTERNAL_ERROR_CODES.MISSING_SECRET_KEY);
                const captchaResponse = request.headers.get("x-captcha-response");
                const remoteUserIP = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$request$2d$ip$2d$D6st$2d$mto$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(request, ctx.options) ?? void 0;
                if (!captchaResponse) return middlewareResponse({
                    message: EXTERNAL_ERROR_CODES.MISSING_RESPONSE,
                    status: 400
                });
                const handlerParams = {
                    siteVerifyURL: options.siteVerifyURLOverride || siteVerifyMap[options.provider],
                    captchaResponse,
                    secretKey: options.secretKey,
                    remoteIP: remoteUserIP
                };
                if (options.provider === Providers.CLOUDFLARE_TURNSTILE) return await cloudflareTurnstile(handlerParams);
                if (options.provider === Providers.GOOGLE_RECAPTCHA) return await googleRecaptcha({
                    ...handlerParams,
                    minScore: options.minScore
                });
                if (options.provider === Providers.HCAPTCHA) return await hCaptcha({
                    ...handlerParams,
                    siteKey: options.siteKey
                });
                if (options.provider === Providers.CAPTCHAFOX) return await captchaFox({
                    ...handlerParams,
                    siteKey: options.siteKey
                });
            } catch (_error) {
                const errorMessage = _error instanceof Error ? _error.message : void 0;
                ctx.logger.error(errorMessage ?? "Unknown error", {
                    endpoint: request.url,
                    message: _error
                });
                return middlewareResponse({
                    message: EXTERNAL_ERROR_CODES.UNKNOWN_ERROR,
                    status: 500
                });
            }
        }
    });
;
}),
"[project]/node_modules/better-auth/dist/custom-session-CaUbM_of.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>customSession
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/session-AaRl3_x-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugin$2d$helper$2d$zFdFWLgL$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugin-helper-zFdFWLgL.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
//#region src/plugins/custom-session/index.ts
const getSessionQuerySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["optional"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    disableCookieCache: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().meta({
        description: "Disable cookie cache and fetch session from database"
    }).or(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().transform((v)=>v === "true")).optional(),
    disableRefresh: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().meta({
        description: "Disable session refresh. Useful for checking session status, without updating the session"
    }).optional()
}));
const customSession = (fn, options, pluginOptions)=>{
    return {
        id: "custom-session",
        hooks: {
            after: [
                {
                    matcher: (ctx)=>ctx.path === "/multi-session/list-device-sessions" && (pluginOptions?.shouldMutateListDeviceSessionsEndpoint ?? false),
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        const response = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugin$2d$helper$2d$zFdFWLgL$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(ctx);
                        if (!response) return;
                        const newResponse = await Promise.all(response.map(async (v)=>await fn(v, ctx)));
                        return ctx.json(newResponse);
                    })
                }
            ]
        },
        endpoints: {
            getSession: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/get-session", {
                method: "GET",
                query: getSessionQuerySchema,
                metadata: {
                    CUSTOM_SESSION: true,
                    openapi: {
                        description: "Get custom session data",
                        responses: {
                            "200": {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "array",
                                            nullable: true,
                                            items: {
                                                $ref: "#/components/schemas/Session"
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                requireHeaders: true
            }, async (ctx)=>{
                const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])()({
                    ...ctx,
                    asResponse: false,
                    headers: ctx.headers,
                    returnHeaders: true
                }).catch((e)=>{
                    return null;
                });
                if (!session?.response) return ctx.json(null);
                const fnResult = await fn(session.response, ctx);
                const setCookie = session.headers.get("set-cookie");
                if (setCookie) {
                    ctx.setHeader("set-cookie", setCookie);
                    session.headers.delete("set-cookie");
                }
                session.headers.forEach((value, key)=>{
                    ctx.setHeader(key, value);
                });
                return ctx.json(fnResult);
            })
        },
        $Infer: {
            Session: {}
        }
    };
};
;
}),
"[project]/node_modules/better-auth/dist/device-authorization-9_f1Up5D.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "n",
    ()=>deviceAuthorizationOptionsSchema,
    "t",
    ()=>deviceAuthorization
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/crypto-CFUhAR9W.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/schema-Bb7wzeK_.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/session-AaRl3_x-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils-C5EN75oV.mjs [app-route] (ecmascript) <export t as defineErrorCodes>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$node_modules$2f$ms$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/node_modules/ms/dist/index.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
//#region src/plugins/device-authorization/error-codes.ts
const DEVICE_AUTHORIZATION_ERROR_CODES = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__["defineErrorCodes"])({
    INVALID_DEVICE_CODE: "Invalid device code",
    EXPIRED_DEVICE_CODE: "Device code has expired",
    EXPIRED_USER_CODE: "User code has expired",
    AUTHORIZATION_PENDING: "Authorization pending",
    ACCESS_DENIED: "Access denied",
    INVALID_USER_CODE: "Invalid user code",
    DEVICE_CODE_ALREADY_PROCESSED: "Device code already processed",
    POLLING_TOO_FREQUENTLY: "Polling too frequently",
    USER_NOT_FOUND: "User not found",
    FAILED_TO_CREATE_SESSION: "Failed to create session",
    INVALID_DEVICE_CODE_STATUS: "Invalid device code status",
    AUTHENTICATION_REQUIRED: "Authentication required"
});
//#endregion
//#region src/plugins/device-authorization/schema.ts
const schema = {
    deviceCode: {
        fields: {
            deviceCode: {
                type: "string",
                required: true
            },
            userCode: {
                type: "string",
                required: true
            },
            userId: {
                type: "string",
                required: false
            },
            expiresAt: {
                type: "date",
                required: true
            },
            status: {
                type: "string",
                required: true
            },
            lastPolledAt: {
                type: "date",
                required: false
            },
            pollingInterval: {
                type: "number",
                required: false
            },
            clientId: {
                type: "string",
                required: false
            },
            scope: {
                type: "string",
                required: false
            }
        }
    }
};
const deviceCode = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
    deviceCode: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
    userCode: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional(),
    expiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["date"](),
    status: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
    lastPolledAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["date"]().optional(),
    pollingInterval: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]().optional(),
    clientId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional(),
    scope: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional()
});
//#endregion
//#region src/plugins/device-authorization/index.ts
const msStringValueSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["custom"]((val)=>{
    try {
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$node_modules$2f$ms$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ms"])(val);
    } catch (e) {
        return false;
    }
    return true;
}, {
    message: "Invalid time string format. Use formats like '30m', '5s', '1h', etc."
});
const deviceAuthorizationOptionsSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    expiresIn: msStringValueSchema.default("30m").describe("Time in seconds until the device code expires. Use formats like '30m', '5s', '1h', etc."),
    interval: msStringValueSchema.default("5s").describe("Time in seconds between polling attempts. Use formats like '30m', '5s', '1h', etc."),
    deviceCodeLength: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]().int().positive().default(40).describe("Length of the device code to be generated. Default is 40 characters."),
    userCodeLength: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]().int().positive().default(8).describe("Length of the user code to be generated. Default is 8 characters."),
    generateDeviceCode: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["custom"]((val)=>typeof val === "function", {
        message: "generateDeviceCode must be a function that returns a string or a promise that resolves to a string."
    }).optional().describe("Function to generate a device code. If not provided, a default random string generator will be used."),
    generateUserCode: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["custom"]((val)=>typeof val === "function", {
        message: "generateUserCode must be a function that returns a string or a promise that resolves to a string."
    }).optional().describe("Function to generate a user code. If not provided, a default random string generator will be used."),
    validateClient: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["custom"]((val)=>typeof val === "function", {
        message: "validateClient must be a function that returns a boolean or a promise that resolves to a boolean."
    }).optional().describe("Function to validate the client ID. If not provided, no validation will be performed."),
    onDeviceAuthRequest: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["custom"]((val)=>typeof val === "function", {
        message: "onDeviceAuthRequest must be a function that returns void or a promise that resolves to void."
    }).optional().describe("Function to handle device authorization requests. If not provided, no additional actions will be taken."),
    verificationUri: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional().describe("The URI where users verify their device code. Can be an absolute URL (https://example.com/device) or relative path (/custom-path). This will be returned as verification_uri in the device code response. If not provided, defaults to /device."),
    schema: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["custom"](()=>true)
});
const defaultCharset = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
/**
* @internal
*/ const defaultGenerateDeviceCode = (length)=>{
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(length, "a-z", "A-Z", "0-9");
};
/**
* @internal
*/ const defaultGenerateUserCode = (length)=>{
    const chars = new Uint8Array(length);
    return Array.from(crypto.getRandomValues(chars)).map((byte)=>defaultCharset[byte % 32]).join("");
};
/**
* @internal
*/ const buildVerificationUris = (verificationUri, baseURL, userCode)=>{
    const uri = verificationUri || "/device";
    let verificationUrl;
    try {
        verificationUrl = new URL(uri);
    } catch  {
        verificationUrl = new URL(uri, baseURL);
    }
    const verificationUriCompleteUrl = new URL(verificationUrl);
    verificationUriCompleteUrl.searchParams.set("user_code", userCode);
    return {
        verificationUri: verificationUrl.toString(),
        verificationUriComplete: verificationUriCompleteUrl.toString()
    };
};
const deviceAuthorization = (options = {})=>{
    const opts = deviceAuthorizationOptionsSchema.parse(options);
    const generateDeviceCode = async ()=>{
        if (opts.generateDeviceCode) return opts.generateDeviceCode();
        return defaultGenerateDeviceCode(opts.deviceCodeLength);
    };
    const generateUserCode = async ()=>{
        if (opts.generateUserCode) return opts.generateUserCode();
        return defaultGenerateUserCode(opts.userCodeLength);
    };
    return {
        id: "device-authorization",
        schema: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(schema, options?.schema),
        endpoints: {
            deviceCode: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/device/code", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    client_id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The client ID of the application"
                    }),
                    scope: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "Space-separated list of scopes"
                    }).optional()
                }),
                error: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    error: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"]([
                        "invalid_request",
                        "invalid_client"
                    ]).meta({
                        description: "Error code"
                    }),
                    error_description: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "Detailed error description"
                    })
                }),
                metadata: {
                    openapi: {
                        description: `Request a device and user code

Follow [rfc8628#section-3.2](https://datatracker.ietf.org/doc/html/rfc8628#section-3.2)`,
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                device_code: {
                                                    type: "string",
                                                    description: "The device verification code"
                                                },
                                                user_code: {
                                                    type: "string",
                                                    description: "The user code to display"
                                                },
                                                verification_uri: {
                                                    type: "string",
                                                    format: "uri",
                                                    description: "The URL for user verification. Defaults to /device if not configured."
                                                },
                                                verification_uri_complete: {
                                                    type: "string",
                                                    format: "uri",
                                                    description: "The complete URL with user code as query parameter."
                                                },
                                                expires_in: {
                                                    type: "number",
                                                    description: "Lifetime in seconds of the device code"
                                                },
                                                interval: {
                                                    type: "number",
                                                    description: "Minimum polling interval in seconds"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            400: {
                                description: "Error response",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                error: {
                                                    type: "string",
                                                    enum: [
                                                        "invalid_request",
                                                        "invalid_client"
                                                    ]
                                                },
                                                error_description: {
                                                    type: "string"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                if (opts.validateClient) {
                    if (!await opts.validateClient(ctx.body.client_id)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        error: "invalid_client",
                        error_description: "Invalid client ID"
                    });
                }
                if (opts.onDeviceAuthRequest) await opts.onDeviceAuthRequest(ctx.body.client_id, ctx.body.scope);
                const deviceCode$1 = await generateDeviceCode();
                const userCode = await generateUserCode();
                const expiresIn = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$node_modules$2f$ms$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ms"])(opts.expiresIn);
                const expiresAt = new Date(Date.now() + expiresIn);
                await ctx.context.adapter.create({
                    model: "deviceCode",
                    data: {
                        deviceCode: deviceCode$1,
                        userCode,
                        expiresAt,
                        status: "pending",
                        pollingInterval: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$node_modules$2f$ms$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ms"])(opts.interval),
                        clientId: ctx.body.client_id,
                        scope: ctx.body.scope
                    }
                });
                const { verificationUri, verificationUriComplete } = buildVerificationUris(opts.verificationUri, ctx.context.baseURL, userCode);
                return ctx.json({
                    device_code: deviceCode$1,
                    user_code: userCode,
                    verification_uri: verificationUri,
                    verification_uri_complete: verificationUriComplete,
                    expires_in: Math.floor(expiresIn / 1e3),
                    interval: Math.floor((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$node_modules$2f$ms$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ms"])(opts.interval) / 1e3)
                }, {
                    headers: {
                        "Cache-Control": "no-store"
                    }
                });
            }),
            deviceToken: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/device/token", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    grant_type: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["literal"]("urn:ietf:params:oauth:grant-type:device_code").meta({
                        description: "The grant type for device flow"
                    }),
                    device_code: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The device verification code"
                    }),
                    client_id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The client ID of the application"
                    })
                }),
                error: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    error: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"]([
                        "authorization_pending",
                        "slow_down",
                        "expired_token",
                        "access_denied",
                        "invalid_request",
                        "invalid_grant"
                    ]).meta({
                        description: "Error code"
                    }),
                    error_description: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "Detailed error description"
                    })
                }),
                metadata: {
                    openapi: {
                        description: `Exchange device code for access token

Follow [rfc8628#section-3.4](https://datatracker.ietf.org/doc/html/rfc8628#section-3.4)`,
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                session: {
                                                    $ref: "#/components/schemas/Session"
                                                },
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            400: {
                                description: "Error response",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                error: {
                                                    type: "string",
                                                    enum: [
                                                        "authorization_pending",
                                                        "slow_down",
                                                        "expired_token",
                                                        "access_denied",
                                                        "invalid_request",
                                                        "invalid_grant"
                                                    ]
                                                },
                                                error_description: {
                                                    type: "string"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const { device_code, client_id } = ctx.body;
                if (opts.validateClient) {
                    if (!await opts.validateClient(client_id)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        error: "invalid_grant",
                        error_description: "Invalid client ID"
                    });
                }
                const deviceCodeRecord = await ctx.context.adapter.findOne({
                    model: "deviceCode",
                    where: [
                        {
                            field: "deviceCode",
                            value: device_code
                        }
                    ]
                });
                if (!deviceCodeRecord) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    error: "invalid_grant",
                    error_description: DEVICE_AUTHORIZATION_ERROR_CODES.INVALID_DEVICE_CODE
                });
                if (deviceCodeRecord.clientId && deviceCodeRecord.clientId !== client_id) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    error: "invalid_grant",
                    error_description: "Client ID mismatch"
                });
                if (deviceCodeRecord.lastPolledAt && deviceCodeRecord.pollingInterval) {
                    if (Date.now() - new Date(deviceCodeRecord.lastPolledAt).getTime() < deviceCodeRecord.pollingInterval) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        error: "slow_down",
                        error_description: DEVICE_AUTHORIZATION_ERROR_CODES.POLLING_TOO_FREQUENTLY
                    });
                }
                await ctx.context.adapter.update({
                    model: "deviceCode",
                    where: [
                        {
                            field: "id",
                            value: deviceCodeRecord.id
                        }
                    ],
                    update: {
                        lastPolledAt: /* @__PURE__ */ new Date()
                    }
                });
                if (deviceCodeRecord.expiresAt < /* @__PURE__ */ new Date()) {
                    await ctx.context.adapter.delete({
                        model: "deviceCode",
                        where: [
                            {
                                field: "id",
                                value: deviceCodeRecord.id
                            }
                        ]
                    });
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        error: "expired_token",
                        error_description: DEVICE_AUTHORIZATION_ERROR_CODES.EXPIRED_DEVICE_CODE
                    });
                }
                if (deviceCodeRecord.status === "pending") throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    error: "authorization_pending",
                    error_description: DEVICE_AUTHORIZATION_ERROR_CODES.AUTHORIZATION_PENDING
                });
                if (deviceCodeRecord.status === "denied") {
                    await ctx.context.adapter.delete({
                        model: "deviceCode",
                        where: [
                            {
                                field: "id",
                                value: deviceCodeRecord.id
                            }
                        ]
                    });
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        error: "access_denied",
                        error_description: DEVICE_AUTHORIZATION_ERROR_CODES.ACCESS_DENIED
                    });
                }
                if (deviceCodeRecord.status === "approved" && deviceCodeRecord.userId) {
                    const user = await ctx.context.internalAdapter.findUserById(deviceCodeRecord.userId);
                    if (!user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                        error: "server_error",
                        error_description: DEVICE_AUTHORIZATION_ERROR_CODES.USER_NOT_FOUND
                    });
                    const session = await ctx.context.internalAdapter.createSession(user.id);
                    if (!session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                        error: "server_error",
                        error_description: DEVICE_AUTHORIZATION_ERROR_CODES.FAILED_TO_CREATE_SESSION
                    });
                    ctx.context.setNewSession({
                        session,
                        user
                    });
                    if (ctx.context.options.secondaryStorage) await ctx.context.secondaryStorage?.set(session.token, JSON.stringify({
                        user,
                        session
                    }), Math.floor((new Date(session.expiresAt).getTime() - Date.now()) / 1e3));
                    await ctx.context.adapter.delete({
                        model: "deviceCode",
                        where: [
                            {
                                field: "id",
                                value: deviceCodeRecord.id
                            }
                        ]
                    });
                    return ctx.json({
                        access_token: session.token,
                        token_type: "Bearer",
                        expires_in: Math.floor((new Date(session.expiresAt).getTime() - Date.now()) / 1e3),
                        scope: deviceCodeRecord.scope || ""
                    }, {
                        headers: {
                            "Cache-Control": "no-store",
                            Pragma: "no-cache"
                        }
                    });
                }
                throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                    error: "server_error",
                    error_description: DEVICE_AUTHORIZATION_ERROR_CODES.INVALID_DEVICE_CODE_STATUS
                });
            }),
            deviceVerify: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/device", {
                method: "GET",
                query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    user_code: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The user code to verify"
                    })
                }),
                error: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    error: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"]([
                        "invalid_request"
                    ]).meta({
                        description: "Error code"
                    }),
                    error_description: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "Detailed error description"
                    })
                }),
                metadata: {
                    openapi: {
                        description: "Verify user code and get device authorization status",
                        responses: {
                            200: {
                                description: "Device authorization status",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user_code: {
                                                    type: "string",
                                                    description: "The user code to verify"
                                                },
                                                status: {
                                                    type: "string",
                                                    enum: [
                                                        "pending",
                                                        "approved",
                                                        "denied"
                                                    ],
                                                    description: "Current status of the device authorization"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const { user_code } = ctx.query;
                const cleanUserCode = user_code.replace(/-/g, "");
                const deviceCodeRecord = await ctx.context.adapter.findOne({
                    model: "deviceCode",
                    where: [
                        {
                            field: "userCode",
                            value: cleanUserCode
                        }
                    ]
                });
                if (!deviceCodeRecord) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    error: "invalid_request",
                    error_description: DEVICE_AUTHORIZATION_ERROR_CODES.INVALID_USER_CODE
                });
                if (deviceCodeRecord.expiresAt < /* @__PURE__ */ new Date()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    error: "expired_token",
                    error_description: DEVICE_AUTHORIZATION_ERROR_CODES.EXPIRED_USER_CODE
                });
                return ctx.json({
                    user_code,
                    status: deviceCodeRecord.status
                });
            }),
            deviceApprove: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/device/approve", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    userCode: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The user code to approve"
                    })
                }),
                error: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    error: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"]([
                        "invalid_request",
                        "expired_token",
                        "device_code_already_processed"
                    ]).meta({
                        description: "Error code"
                    }),
                    error_description: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "Detailed error description"
                    })
                }),
                requireHeaders: true,
                metadata: {
                    openapi: {
                        description: "Approve device authorization",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                success: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(ctx);
                if (!session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error: "unauthorized",
                    error_description: DEVICE_AUTHORIZATION_ERROR_CODES.AUTHENTICATION_REQUIRED
                });
                const { userCode } = ctx.body;
                const cleanUserCode = userCode.replace(/-/g, "");
                const deviceCodeRecord = await ctx.context.adapter.findOne({
                    model: "deviceCode",
                    where: [
                        {
                            field: "userCode",
                            value: cleanUserCode
                        }
                    ]
                });
                if (!deviceCodeRecord) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    error: "invalid_request",
                    error_description: DEVICE_AUTHORIZATION_ERROR_CODES.INVALID_USER_CODE
                });
                if (deviceCodeRecord.expiresAt < /* @__PURE__ */ new Date()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    error: "expired_token",
                    error_description: DEVICE_AUTHORIZATION_ERROR_CODES.EXPIRED_USER_CODE
                });
                if (deviceCodeRecord.status !== "pending") throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    error: "invalid_request",
                    error_description: DEVICE_AUTHORIZATION_ERROR_CODES.DEVICE_CODE_ALREADY_PROCESSED
                });
                await ctx.context.adapter.update({
                    model: "deviceCode",
                    where: [
                        {
                            field: "id",
                            value: deviceCodeRecord.id
                        }
                    ],
                    update: {
                        status: "approved",
                        userId: session.user.id
                    }
                });
                return ctx.json({
                    success: true
                });
            }),
            deviceDeny: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/device/deny", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    userCode: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The user code to deny"
                    })
                }),
                error: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    error: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"]([
                        "invalid_request",
                        "expired_token"
                    ]).meta({
                        description: "Error code"
                    }),
                    error_description: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "Detailed error description"
                    })
                }),
                metadata: {
                    openapi: {
                        description: "Deny device authorization",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                success: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const { userCode } = ctx.body;
                const cleanUserCode = userCode.replace(/-/g, "");
                const deviceCodeRecord = await ctx.context.adapter.findOne({
                    model: "deviceCode",
                    where: [
                        {
                            field: "userCode",
                            value: cleanUserCode
                        }
                    ]
                });
                if (!deviceCodeRecord) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    error: "invalid_request",
                    error_description: DEVICE_AUTHORIZATION_ERROR_CODES.INVALID_USER_CODE
                });
                if (deviceCodeRecord.expiresAt < /* @__PURE__ */ new Date()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    error: "expired_token",
                    error_description: DEVICE_AUTHORIZATION_ERROR_CODES.EXPIRED_USER_CODE
                });
                if (deviceCodeRecord.status !== "pending") throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    error: "invalid_request",
                    error_description: DEVICE_AUTHORIZATION_ERROR_CODES.DEVICE_CODE_ALREADY_PROCESSED
                });
                await ctx.context.adapter.update({
                    model: "deviceCode",
                    where: [
                        {
                            field: "id",
                            value: deviceCodeRecord.id
                        }
                    ],
                    update: {
                        status: "denied"
                    }
                });
                return ctx.json({
                    success: true
                });
            })
        },
        $ERROR_CODES: DEVICE_AUTHORIZATION_ERROR_CODES
    };
};
;
}),
"[project]/node_modules/better-auth/dist/email-otp-CiznqFUN.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>emailOTP
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/crypto-CFUhAR9W.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/schema-Bb7wzeK_.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api-CkmycQ2x.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript) <export APIError as t>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/session-AaRl3_x-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugin$2d$helper$2d$zFdFWLgL$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugin-helper-zFdFWLgL.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error-BhAKg8LX.mjs [app-route] (ecmascript) <export n as BASE_ERROR_CODES>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils-C5EN75oV.mjs [app-route] (ecmascript) <export t as defineErrorCodes>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/hash.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/base64.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
;
//#region src/plugins/email-otp/utils.ts
const defaultKeyHasher = async (otp)=>{
    const hash = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createHash"])("SHA-256").digest(new TextEncoder().encode(otp));
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["base64Url"].encode(new Uint8Array(hash), {
        padding: false
    });
};
function splitAtLastColon(input) {
    const idx = input.lastIndexOf(":");
    if (idx === -1) return [
        input,
        ""
    ];
    return [
        input.slice(0, idx),
        input.slice(idx + 1)
    ];
}
//#endregion
//#region src/plugins/email-otp/index.ts
const types = [
    "email-verification",
    "sign-in",
    "forget-password"
];
const defaultOTPGenerator = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(options.otpLength ?? 6, "0-9");
const ERROR_CODES = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__["defineErrorCodes"])({
    OTP_EXPIRED: "OTP expired",
    INVALID_OTP: "Invalid OTP",
    TOO_MANY_ATTEMPTS: "Too many attempts"
});
const emailOTP = (options)=>{
    const opts = {
        expiresIn: 300,
        generateOTP: ()=>defaultOTPGenerator(options),
        storeOTP: "plain",
        ...options
    };
    async function storeOTP(ctx, otp) {
        if (opts.storeOTP === "encrypted") return await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])({
            key: ctx.context.secret,
            data: otp
        });
        if (opts.storeOTP === "hashed") return await defaultKeyHasher(otp);
        if (typeof opts.storeOTP === "object" && "hash" in opts.storeOTP) return await opts.storeOTP.hash(otp);
        if (typeof opts.storeOTP === "object" && "encrypt" in opts.storeOTP) return await opts.storeOTP.encrypt(otp);
        return otp;
    }
    async function verifyStoredOTP(ctx, storedOtp, otp) {
        if (opts.storeOTP === "encrypted") return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
            key: ctx.context.secret,
            data: storedOtp
        }), otp);
        if (opts.storeOTP === "hashed") return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(await defaultKeyHasher(otp), storedOtp);
        if (typeof opts.storeOTP === "object" && "hash" in opts.storeOTP) return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(await opts.storeOTP.hash(otp), storedOtp);
        if (typeof opts.storeOTP === "object" && "decrypt" in opts.storeOTP) return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(await opts.storeOTP.decrypt(storedOtp), otp);
        return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(otp, storedOtp);
    }
    const endpoints = {
        sendVerificationOTP: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/email-otp/send-verification-otp", {
            method: "POST",
            body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]({}).meta({
                    description: "Email address to send the OTP"
                }),
                type: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"](types).meta({
                    description: "Type of the OTP"
                })
            }),
            metadata: {
                openapi: {
                    operationId: "sendEmailVerificationOTP",
                    description: "Send a verification OTP to an email",
                    responses: {
                        200: {
                            description: "Success",
                            content: {
                                "application/json": {
                                    schema: {
                                        type: "object",
                                        properties: {
                                            success: {
                                                type: "boolean"
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }, async (ctx)=>{
            if (!options?.sendVerificationOTP) {
                ctx.context.logger.error("send email verification is not implemented");
                throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: "send email verification is not implemented"
                });
            }
            const email = ctx.body.email.toLowerCase();
            if (!__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["email"]().safeParse(email).success) throw ctx.error("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].INVALID_EMAIL
            });
            let otp = opts.generateOTP({
                email,
                type: ctx.body.type
            }, ctx) || defaultOTPGenerator(opts);
            let storedOTP = await storeOTP(ctx, otp);
            await ctx.context.internalAdapter.createVerificationValue({
                value: `${storedOTP}:0`,
                identifier: `${ctx.body.type}-otp-${email}`,
                expiresAt: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(opts.expiresIn, "sec")
            }).catch(async (error)=>{
                await ctx.context.internalAdapter.deleteVerificationByIdentifier(`${ctx.body.type}-otp-${email}`);
                await ctx.context.internalAdapter.createVerificationValue({
                    value: `${storedOTP}:0`,
                    identifier: `${ctx.body.type}-otp-${email}`,
                    expiresAt: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(opts.expiresIn, "sec")
                });
            });
            if (!await ctx.context.internalAdapter.findUserByEmail(email)) if (ctx.body.type === "sign-in" && !opts.disableSignUp) {} else {
                await ctx.context.internalAdapter.deleteVerificationByIdentifier(`${ctx.body.type}-otp-${email}`);
                return ctx.json({
                    success: true
                });
            }
            await options.sendVerificationOTP({
                email,
                otp,
                type: ctx.body.type
            }, ctx);
            return ctx.json({
                success: true
            });
        })
    };
    return {
        id: "email-otp",
        init (ctx) {
            if (!opts.overrideDefaultEmailVerification) return;
            return {
                options: {
                    emailVerification: {
                        async sendVerificationEmail (data, request) {
                            await endpoints.sendVerificationOTP({
                                context: ctx,
                                request,
                                body: {
                                    email: data.user.email,
                                    type: "email-verification"
                                },
                                ctx
                            });
                        }
                    }
                }
            };
        },
        endpoints: {
            ...endpoints,
            createVerificationOTP: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/email-otp/create-verification-otp", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]({}).meta({
                        description: "Email address to send the OTP"
                    }),
                    type: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"](types).meta({
                        required: true,
                        description: "Type of the OTP"
                    })
                }),
                metadata: {
                    SERVER_ONLY: true,
                    openapi: {
                        operationId: "createEmailVerificationOTP",
                        description: "Create a verification OTP for an email",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "string"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const email = ctx.body.email.toLowerCase();
                const otp = opts.generateOTP({
                    email,
                    type: ctx.body.type
                }, ctx) || defaultOTPGenerator(opts);
                let storedOTP = await storeOTP(ctx, otp);
                await ctx.context.internalAdapter.createVerificationValue({
                    value: `${storedOTP}:0`,
                    identifier: `${ctx.body.type}-otp-${email}`,
                    expiresAt: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(opts.expiresIn, "sec")
                });
                return otp;
            }),
            getVerificationOTP: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/email-otp/get-verification-otp", {
                method: "GET",
                query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]({}).meta({
                        description: "Email address the OTP was sent to"
                    }),
                    type: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"](types).meta({
                        required: true,
                        description: "Type of the OTP"
                    })
                }),
                metadata: {
                    SERVER_ONLY: true,
                    openapi: {
                        operationId: "getEmailVerificationOTP",
                        description: "Get a verification OTP for an email",
                        responses: {
                            "200": {
                                description: "OTP retrieved successfully or not found/expired",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                otp: {
                                                    type: "string",
                                                    nullable: true,
                                                    description: "The stored OTP, or null if not found or expired"
                                                }
                                            },
                                            required: [
                                                "otp"
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const email = ctx.query.email.toLowerCase();
                const verificationValue = await ctx.context.internalAdapter.findVerificationValue(`${ctx.query.type}-otp-${email}`);
                if (!verificationValue || verificationValue.expiresAt < /* @__PURE__ */ new Date()) return ctx.json({
                    otp: null
                });
                if (opts.storeOTP === "hashed" || typeof opts.storeOTP === "object" && "hash" in opts.storeOTP) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: "OTP is hashed, cannot return the plain text OTP"
                });
                let [storedOtp, _attempts] = splitAtLastColon(verificationValue.value);
                let otp = storedOtp;
                if (opts.storeOTP === "encrypted") otp = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                    key: ctx.context.secret,
                    data: storedOtp
                });
                if (typeof opts.storeOTP === "object" && "decrypt" in opts.storeOTP) otp = await opts.storeOTP.decrypt(storedOtp);
                return ctx.json({
                    otp
                });
            }),
            checkVerificationOTP: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/email-otp/check-verification-otp", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "Email address the OTP was sent to"
                    }),
                    type: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"](types).meta({
                        required: true,
                        description: "Type of the OTP"
                    }),
                    otp: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        required: true,
                        description: "OTP to verify"
                    })
                }),
                metadata: {
                    openapi: {
                        operationId: "verifyEmailWithOTP",
                        description: "Verify an email with an OTP",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                success: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const email = ctx.body.email.toLowerCase();
                if (!__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["email"]().safeParse(email).success) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].INVALID_EMAIL
                });
                if (!await ctx.context.internalAdapter.findUserByEmail(email)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].USER_NOT_FOUND
                });
                const verificationValue = await ctx.context.internalAdapter.findVerificationValue(`${ctx.body.type}-otp-${email}`);
                if (!verificationValue) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: ERROR_CODES.INVALID_OTP
                });
                if (verificationValue.expiresAt < /* @__PURE__ */ new Date()) {
                    await ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        message: ERROR_CODES.OTP_EXPIRED
                    });
                }
                const [otpValue, attempts] = splitAtLastColon(verificationValue.value);
                const allowedAttempts = options?.allowedAttempts || 3;
                if (attempts && parseInt(attempts) >= allowedAttempts) {
                    await ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("FORBIDDEN", {
                        message: ERROR_CODES.TOO_MANY_ATTEMPTS
                    });
                }
                if (!await verifyStoredOTP(ctx, otpValue, ctx.body.otp)) {
                    await ctx.context.internalAdapter.updateVerificationValue(verificationValue.id, {
                        value: `${otpValue}:${parseInt(attempts || "0") + 1}`
                    });
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        message: ERROR_CODES.INVALID_OTP
                    });
                }
                return ctx.json({
                    success: true
                });
            }),
            verifyEmailOTP: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/email-otp/verify-email", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]({}).meta({
                        description: "Email address to verify"
                    }),
                    otp: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        required: true,
                        description: "OTP to verify"
                    })
                }),
                metadata: {
                    openapi: {
                        description: "Verify email with OTP",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                status: {
                                                    type: "boolean",
                                                    description: "Indicates if the verification was successful",
                                                    enum: [
                                                        true
                                                    ]
                                                },
                                                token: {
                                                    type: "string",
                                                    nullable: true,
                                                    description: "Session token if autoSignInAfterVerification is enabled, otherwise null"
                                                },
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            },
                                            required: [
                                                "status",
                                                "token",
                                                "user"
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const email = ctx.body.email.toLowerCase();
                if (!__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["email"]().safeParse(email).success) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].INVALID_EMAIL
                });
                const verificationValue = await ctx.context.internalAdapter.findVerificationValue(`email-verification-otp-${email}`);
                if (!verificationValue) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: ERROR_CODES.INVALID_OTP
                });
                if (verificationValue.expiresAt < /* @__PURE__ */ new Date()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: ERROR_CODES.OTP_EXPIRED
                });
                const [otpValue, attempts] = splitAtLastColon(verificationValue.value);
                const allowedAttempts = options?.allowedAttempts || 3;
                if (attempts && parseInt(attempts) >= allowedAttempts) {
                    await ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("FORBIDDEN", {
                        message: ERROR_CODES.TOO_MANY_ATTEMPTS
                    });
                }
                if (!await verifyStoredOTP(ctx, otpValue, ctx.body.otp)) {
                    await ctx.context.internalAdapter.updateVerificationValue(verificationValue.id, {
                        value: `${otpValue}:${parseInt(attempts || "0") + 1}`
                    });
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        message: ERROR_CODES.INVALID_OTP
                    });
                }
                await ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);
                const user = await ctx.context.internalAdapter.findUserByEmail(email);
                if (!user) /**
				* safe to leak the existence of a user, given the user has already the OTP from the
				* email
				*/ throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].USER_NOT_FOUND
                });
                const updatedUser = await ctx.context.internalAdapter.updateUser(user.user.id, {
                    email,
                    emailVerified: true
                });
                await ctx.context.options.emailVerification?.onEmailVerification?.(updatedUser, ctx.request);
                if (ctx.context.options.emailVerification?.autoSignInAfterVerification) {
                    const session = await ctx.context.internalAdapter.createSession(updatedUser.id);
                    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, {
                        session,
                        user: updatedUser
                    });
                    return ctx.json({
                        status: true,
                        token: session.token,
                        user: {
                            id: updatedUser.id,
                            email: updatedUser.email,
                            emailVerified: updatedUser.emailVerified,
                            name: updatedUser.name,
                            image: updatedUser.image,
                            createdAt: updatedUser.createdAt,
                            updatedAt: updatedUser.updatedAt
                        }
                    });
                }
                const currentSession = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(ctx);
                if (currentSession && updatedUser.emailVerified) {
                    const dontRememberMeCookie = await ctx.getSignedCookie(ctx.context.authCookies.dontRememberToken.name, ctx.context.secret);
                    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["s"])(ctx, {
                        session: currentSession.session,
                        user: {
                            ...currentSession.user,
                            emailVerified: true
                        }
                    }, !!dontRememberMeCookie);
                }
                return ctx.json({
                    status: true,
                    token: null,
                    user: {
                        id: updatedUser.id,
                        email: updatedUser.email,
                        emailVerified: updatedUser.emailVerified,
                        name: updatedUser.name,
                        image: updatedUser.image,
                        createdAt: updatedUser.createdAt,
                        updatedAt: updatedUser.updatedAt
                    }
                });
            }),
            signInEmailOTP: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/sign-in/email-otp", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]({}).meta({
                        description: "Email address to sign in"
                    }),
                    otp: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        required: true,
                        description: "OTP sent to the email"
                    })
                }),
                metadata: {
                    openapi: {
                        operationId: "signInWithEmailOTP",
                        description: "Sign in with email and OTP",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                token: {
                                                    type: "string",
                                                    description: "Session token for the authenticated session"
                                                },
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            },
                                            required: [
                                                "token",
                                                "user"
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const email = ctx.body.email.toLowerCase();
                const verificationValue = await ctx.context.internalAdapter.findVerificationValue(`sign-in-otp-${email}`);
                if (!verificationValue) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: ERROR_CODES.INVALID_OTP
                });
                if (verificationValue.expiresAt < /* @__PURE__ */ new Date()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: ERROR_CODES.OTP_EXPIRED
                });
                const [otpValue, attempts] = splitAtLastColon(verificationValue.value);
                const allowedAttempts = options?.allowedAttempts || 3;
                if (attempts && parseInt(attempts) >= allowedAttempts) {
                    await ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("FORBIDDEN", {
                        message: ERROR_CODES.TOO_MANY_ATTEMPTS
                    });
                }
                if (!await verifyStoredOTP(ctx, otpValue, ctx.body.otp)) {
                    await ctx.context.internalAdapter.updateVerificationValue(verificationValue.id, {
                        value: `${otpValue}:${parseInt(attempts || "0") + 1}`
                    });
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        message: ERROR_CODES.INVALID_OTP
                    });
                }
                await ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);
                const user = await ctx.context.internalAdapter.findUserByEmail(email);
                if (!user) {
                    if (opts.disableSignUp) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].USER_NOT_FOUND
                    });
                    const newUser = await ctx.context.internalAdapter.createUser({
                        email,
                        emailVerified: true,
                        name: ""
                    });
                    const session$1 = await ctx.context.internalAdapter.createSession(newUser.id);
                    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, {
                        session: session$1,
                        user: newUser
                    });
                    return ctx.json({
                        token: session$1.token,
                        user: {
                            id: newUser.id,
                            email: newUser.email,
                            emailVerified: newUser.emailVerified,
                            name: newUser.name,
                            image: newUser.image,
                            createdAt: newUser.createdAt,
                            updatedAt: newUser.updatedAt
                        }
                    });
                }
                if (!user.user.emailVerified) await ctx.context.internalAdapter.updateUser(user.user.id, {
                    emailVerified: true
                });
                const session = await ctx.context.internalAdapter.createSession(user.user.id);
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, {
                    session,
                    user: user.user
                });
                return ctx.json({
                    token: session.token,
                    user: {
                        id: user.user.id,
                        email: user.user.email,
                        emailVerified: user.user.emailVerified,
                        name: user.user.name,
                        image: user.user.image,
                        createdAt: user.user.createdAt,
                        updatedAt: user.user.updatedAt
                    }
                });
            }),
            forgetPasswordEmailOTP: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/forget-password/email-otp", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "Email address to send the OTP"
                    })
                }),
                metadata: {
                    openapi: {
                        operationId: "forgetPasswordWithEmailOTP",
                        description: "Forget password with email and OTP",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                success: {
                                                    type: "boolean",
                                                    description: "Indicates if the OTP was sent successfully"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const email = ctx.body.email;
                const otp = opts.generateOTP({
                    email,
                    type: "forget-password"
                }, ctx) || defaultOTPGenerator(opts);
                let storedOTP = await storeOTP(ctx, otp);
                await ctx.context.internalAdapter.createVerificationValue({
                    value: `${storedOTP}:0`,
                    identifier: `forget-password-otp-${email}`,
                    expiresAt: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(opts.expiresIn, "sec")
                });
                if (!await ctx.context.internalAdapter.findUserByEmail(email)) {
                    await ctx.context.internalAdapter.deleteVerificationByIdentifier(`forget-password-otp-${email}`);
                    return ctx.json({
                        success: true
                    });
                }
                await options.sendVerificationOTP({
                    email,
                    otp,
                    type: "forget-password"
                }, ctx).catch((e)=>{
                    ctx.context.logger.error("Failed to send OTP", e);
                });
                return ctx.json({
                    success: true
                });
            }),
            resetPasswordEmailOTP: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/email-otp/reset-password", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "Email address to reset the password"
                    }),
                    otp: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "OTP sent to the email"
                    }),
                    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "New password"
                    })
                }),
                metadata: {
                    openapi: {
                        operationId: "resetPasswordWithEmailOTP",
                        description: "Reset password with email and OTP",
                        responses: {
                            200: {
                                description: "Success",
                                contnt: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                success: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const email = ctx.body.email;
                const verificationValue = await ctx.context.internalAdapter.findVerificationValue(`forget-password-otp-${email}`);
                if (!verificationValue) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: ERROR_CODES.INVALID_OTP
                });
                if (verificationValue.expiresAt < /* @__PURE__ */ new Date()) {
                    await ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        message: ERROR_CODES.OTP_EXPIRED
                    });
                }
                const [otpValue, attempts] = splitAtLastColon(verificationValue.value);
                const allowedAttempts = options?.allowedAttempts || 3;
                if (attempts && parseInt(attempts) >= allowedAttempts) {
                    await ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("FORBIDDEN", {
                        message: ERROR_CODES.TOO_MANY_ATTEMPTS
                    });
                }
                if (!await verifyStoredOTP(ctx, otpValue, ctx.body.otp)) {
                    await ctx.context.internalAdapter.updateVerificationValue(verificationValue.id, {
                        value: `${otpValue}:${parseInt(attempts || "0") + 1}`
                    });
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        message: ERROR_CODES.INVALID_OTP
                    });
                }
                await ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);
                const user = await ctx.context.internalAdapter.findUserByEmail(email, {
                    includeAccounts: true
                });
                if (!user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].USER_NOT_FOUND
                });
                const minPasswordLength = ctx.context.password.config.minPasswordLength;
                if (ctx.body.password.length < minPasswordLength) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].PASSWORD_TOO_SHORT
                });
                const maxPasswordLength = ctx.context.password.config.maxPasswordLength;
                if (ctx.body.password.length > maxPasswordLength) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].PASSWORD_TOO_LONG
                });
                const passwordHash = await ctx.context.password.hash(ctx.body.password);
                if (!user.accounts?.find((account)=>account.providerId === "credential")) await ctx.context.internalAdapter.createAccount({
                    userId: user.user.id,
                    providerId: "credential",
                    accountId: user.user.id,
                    password: passwordHash
                });
                else await ctx.context.internalAdapter.updatePassword(user.user.id, passwordHash);
                if (ctx.context.options.emailAndPassword?.onPasswordReset) await ctx.context.options.emailAndPassword.onPasswordReset({
                    user: user.user
                }, ctx.request);
                if (!user.user.emailVerified) await ctx.context.internalAdapter.updateUser(user.user.id, {
                    emailVerified: true
                });
                if (ctx.context.options.emailAndPassword?.revokeSessionsOnPasswordReset) await ctx.context.internalAdapter.deleteSessions(user.user.id);
                return ctx.json({
                    success: true
                });
            })
        },
        hooks: {
            after: [
                {
                    matcher (context) {
                        return !!(context.path?.startsWith("/sign-up") && opts.sendVerificationOnSignUp && !opts.overrideDefaultEmailVerification);
                    },
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        const email = (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugin$2d$helper$2d$zFdFWLgL$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(ctx))?.user.email;
                        if (email) {
                            const otp = opts.generateOTP({
                                email,
                                type: ctx.body.type
                            }, ctx) || defaultOTPGenerator(opts);
                            let storedOTP = await storeOTP(ctx, otp);
                            await ctx.context.internalAdapter.createVerificationValue({
                                value: `${storedOTP}:0`,
                                identifier: `email-verification-otp-${email}`,
                                expiresAt: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(opts.expiresIn, "sec")
                            });
                            await options.sendVerificationOTP({
                                email,
                                otp,
                                type: "email-verification"
                            }, ctx);
                        }
                    })
                }
            ]
        },
        $ERROR_CODES: ERROR_CODES,
        rateLimit: [
            {
                pathMatcher (path) {
                    return path === "/email-otp/send-verification-otp";
                },
                window: 60,
                max: 3
            },
            {
                pathMatcher (path) {
                    return path === "/email-otp/check-verification-otp";
                },
                window: 60,
                max: 3
            },
            {
                pathMatcher (path) {
                    return path === "/email-otp/verify-email";
                },
                window: 60,
                max: 3
            },
            {
                pathMatcher (path) {
                    return path === "/sign-in/email-otp";
                },
                window: 60,
                max: 3
            }
        ]
    };
};
;
}),
"[project]/node_modules/better-auth/dist/generic-oauth-BGbWWUh9.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "a",
    ()=>line,
    "c",
    ()=>auth0,
    "i",
    ()=>microsoftEntraId,
    "n",
    ()=>slack,
    "o",
    ()=>keycloak,
    "r",
    ()=>okta,
    "s",
    ()=>hubspot,
    "t",
    ()=>genericOAuth
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2d$db7gNqd$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/utils-db7gNqd-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api-CkmycQ2x.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/session-AaRl3_x-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error-BhAKg8LX.mjs [app-route] (ecmascript) <export n as BASE_ERROR_CODES>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$oauth2$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/oauth2/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$oauth2$2d$B2XPHgx5$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__o__as__createAuthorizationURL$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/oauth2-B2XPHgx5.mjs [app-route] (ecmascript) <export o as createAuthorizationURL>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$oauth2$2d$B2XPHgx5$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__a__as__refreshAccessToken$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/oauth2-B2XPHgx5.mjs [app-route] (ecmascript) <export a as refreshAccessToken>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$oauth2$2d$B2XPHgx5$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__validateAuthorizationCode$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/oauth2-B2XPHgx5.mjs [app-route] (ecmascript) <export n as validateAuthorizationCode>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils-C5EN75oV.mjs [app-route] (ecmascript) <export t as defineErrorCodes>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$util$2f$decode_jwt$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/util/decode_jwt.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-fetch/fetch/dist/index.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
;
//#region src/plugins/generic-oauth/error-codes.ts
const GENERIC_OAUTH_ERROR_CODES = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__["defineErrorCodes"])({
    INVALID_OAUTH_CONFIGURATION: "Invalid OAuth configuration",
    TOKEN_URL_NOT_FOUND: "Invalid OAuth configuration. Token URL not found.",
    PROVIDER_CONFIG_NOT_FOUND: "No config found for provider",
    PROVIDER_ID_REQUIRED: "Provider ID is required",
    INVALID_OAUTH_CONFIG: "Invalid OAuth configuration.",
    SESSION_REQUIRED: "Session is required"
});
//#endregion
//#region src/plugins/generic-oauth/providers/auth0.ts
/**
* Auth0 OAuth provider helper
*
* @example
* ```ts
* import { genericOAuth, auth0 } from "better-auth/plugins/generic-oauth";
*
* export const auth = betterAuth({
*   plugins: [
*     genericOAuth({
*       config: [
*         auth0({
*           clientId: process.env.AUTH0_CLIENT_ID,
*           clientSecret: process.env.AUTH0_CLIENT_SECRET,
*           domain: process.env.AUTH0_DOMAIN,
*         }),
*       ],
*     }),
*   ],
* });
* ```
*/ function auth0(options) {
    const defaultScopes = [
        "openid",
        "profile",
        "email"
    ];
    const domain = options.domain.replace(/^https?:\/\//, "");
    const discoveryUrl = `https://${domain}/.well-known/openid-configuration`;
    const getUserInfo$1 = async (tokens)=>{
        const { data: profile, error } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterFetch"])(`https://${domain}/userinfo`, {
            headers: {
                Authorization: `Bearer ${tokens.accessToken}`
            }
        });
        if (error || !profile) return null;
        return {
            id: profile.sub,
            name: profile.name ?? profile.nickname ?? void 0,
            email: profile.email ?? void 0,
            image: profile.picture,
            emailVerified: profile.email_verified ?? false
        };
    };
    return {
        providerId: "auth0",
        discoveryUrl,
        clientId: options.clientId,
        clientSecret: options.clientSecret,
        scopes: options.scopes ?? defaultScopes,
        redirectURI: options.redirectURI,
        pkce: options.pkce,
        disableImplicitSignUp: options.disableImplicitSignUp,
        disableSignUp: options.disableSignUp,
        overrideUserInfo: options.overrideUserInfo,
        getUserInfo: getUserInfo$1
    };
}
//#endregion
//#region src/plugins/generic-oauth/providers/hubspot.ts
/**
* HubSpot OAuth provider helper
*
* @example
* ```ts
* import { genericOAuth, hubspot } from "better-auth/plugins/generic-oauth";
*
* export const auth = betterAuth({
*   plugins: [
*     genericOAuth({
*       config: [
*         hubspot({
*           clientId: process.env.HUBSPOT_CLIENT_ID,
*           clientSecret: process.env.HUBSPOT_CLIENT_SECRET,
*           scopes: ["oauth", "contacts"],
*         }),
*       ],
*     }),
*   ],
* });
* ```
*/ function hubspot(options) {
    const defaultScopes = [
        "oauth"
    ];
    const getUserInfo$1 = async (tokens)=>{
        const { data: profile, error } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterFetch"])(`https://api.hubapi.com/oauth/v1/access-tokens/${tokens.accessToken}`, {
            headers: {
                "Content-Type": "application/json"
            }
        });
        if (error || !profile) return null;
        const id = profile.user_id ?? profile.signed_access_token?.userId;
        if (!id) return null;
        return {
            id,
            name: profile.user,
            email: profile.user,
            image: void 0,
            emailVerified: false
        };
    };
    return {
        providerId: "hubspot",
        authorizationUrl: "https://app.hubspot.com/oauth/authorize",
        tokenUrl: "https://api.hubapi.com/oauth/v1/token",
        clientId: options.clientId,
        clientSecret: options.clientSecret,
        scopes: options.scopes ?? defaultScopes,
        redirectURI: options.redirectURI,
        authentication: "post",
        pkce: options.pkce,
        disableImplicitSignUp: options.disableImplicitSignUp,
        disableSignUp: options.disableSignUp,
        overrideUserInfo: options.overrideUserInfo,
        getUserInfo: getUserInfo$1
    };
}
//#endregion
//#region src/plugins/generic-oauth/providers/keycloak.ts
/**
* Keycloak OAuth provider helper
*
* @example
* ```ts
* import { genericOAuth, keycloak } from "better-auth/plugins/generic-oauth";
*
* export const auth = betterAuth({
*   plugins: [
*     genericOAuth({
*       config: [
*         keycloak({
*           clientId: process.env.KEYCLOAK_CLIENT_ID,
*           clientSecret: process.env.KEYCLOAK_CLIENT_SECRET,
*           issuer: process.env.KEYCLOAK_ISSUER,
*         }),
*       ],
*     }),
*   ],
* });
* ```
*/ function keycloak(options) {
    const defaultScopes = [
        "openid",
        "profile",
        "email"
    ];
    const issuer = options.issuer.replace(/\/$/, "");
    const discoveryUrl = `${issuer}/.well-known/openid-configuration`;
    const getUserInfo$1 = async (tokens)=>{
        const { data: profile, error } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterFetch"])(`${issuer}/protocol/openid-connect/userinfo`, {
            headers: {
                Authorization: `Bearer ${tokens.accessToken}`
            }
        });
        if (error || !profile) return null;
        return {
            id: profile.sub,
            name: profile.name ?? profile.preferred_username ?? void 0,
            email: profile.email ?? void 0,
            image: profile.picture,
            emailVerified: profile.email_verified ?? false
        };
    };
    return {
        providerId: "keycloak",
        discoveryUrl,
        clientId: options.clientId,
        clientSecret: options.clientSecret,
        scopes: options.scopes ?? defaultScopes,
        redirectURI: options.redirectURI,
        pkce: options.pkce,
        disableImplicitSignUp: options.disableImplicitSignUp,
        disableSignUp: options.disableSignUp,
        overrideUserInfo: options.overrideUserInfo,
        getUserInfo: getUserInfo$1
    };
}
//#endregion
//#region src/plugins/generic-oauth/providers/line.ts
/**
* LINE OAuth provider helper
*
* LINE requires separate channels for different countries (Japan, Thailand, Taiwan, etc.).
* Each channel has its own clientId and clientSecret. To support multiple countries,
* call this function multiple times with different providerIds and credentials.
*
* @example
* ```ts
* import { genericOAuth, line } from "better-auth/plugins/generic-oauth";
*
* export const auth = betterAuth({
*   plugins: [
*     genericOAuth({
*       config: [
*         // Japan channel
*         line({
*           providerId: "line-jp",
*           clientId: process.env.LINE_JP_CLIENT_ID,
*           clientSecret: process.env.LINE_JP_CLIENT_SECRET,
*         }),
*         // Thailand channel
*         line({
*           providerId: "line-th",
*           clientId: process.env.LINE_TH_CLIENT_ID,
*           clientSecret: process.env.LINE_TH_CLIENT_SECRET,
*         }),
*         // Taiwan channel
*         line({
*           providerId: "line-tw",
*           clientId: process.env.LINE_TW_CLIENT_ID,
*           clientSecret: process.env.LINE_TW_CLIENT_SECRET,
*         }),
*       ],
*     }),
*   ],
* });
* ```
*/ function line(options) {
    const defaultScopes = [
        "openid",
        "profile",
        "email"
    ];
    const authorizationUrl = "https://access.line.me/oauth2/v2.1/authorize";
    const tokenUrl = "https://api.line.me/oauth2/v2.1/token";
    const userInfoUrl = "https://api.line.me/oauth2/v2.1/userinfo";
    const getUserInfo$1 = async (tokens)=>{
        let profile = null;
        if (tokens.idToken) try {
            profile = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$util$2f$decode_jwt$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["decodeJwt"])(tokens.idToken);
        } catch  {}
        if (!profile) {
            const { data, error } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterFetch"])(userInfoUrl, {
                headers: {
                    Authorization: `Bearer ${tokens.accessToken}`
                }
            });
            if (error || !data) return null;
            profile = data;
        }
        if (!profile) return null;
        return {
            id: profile.sub,
            name: profile.name,
            email: profile.email,
            image: profile.picture,
            emailVerified: false
        };
    };
    return {
        providerId: options.providerId ?? "line",
        authorizationUrl,
        tokenUrl,
        userInfoUrl,
        clientId: options.clientId,
        clientSecret: options.clientSecret,
        scopes: options.scopes ?? defaultScopes,
        redirectURI: options.redirectURI,
        pkce: options.pkce,
        disableImplicitSignUp: options.disableImplicitSignUp,
        disableSignUp: options.disableSignUp,
        overrideUserInfo: options.overrideUserInfo,
        getUserInfo: getUserInfo$1
    };
}
//#endregion
//#region src/plugins/generic-oauth/providers/microsoft-entra-id.ts
/**
* Microsoft Entra ID (Azure AD) OAuth provider helper
*
* @example
* ```ts
* import { genericOAuth, microsoftEntraId } from "better-auth/plugins/generic-oauth";
*
* export const auth = betterAuth({
*   plugins: [
*     genericOAuth({
*       config: [
*         microsoftEntraId({
*           clientId: process.env.MS_APP_ID,
*           clientSecret: process.env.MS_CLIENT_SECRET,
*           tenantId: process.env.MS_TENANT_ID,
*         }),
*       ],
*     }),
*   ],
* });
* ```
*/ function microsoftEntraId(options) {
    const defaultScopes = [
        "openid",
        "profile",
        "email"
    ];
    const tenantId = options.tenantId;
    const authorizationUrl = `https://login.microsoftonline.com/${tenantId}/oauth2/v2.0/authorize`;
    const tokenUrl = `https://login.microsoftonline.com/${tenantId}/oauth2/v2.0/token`;
    const userInfoUrl = "https://graph.microsoft.com/oidc/userinfo";
    const getUserInfo$1 = async (tokens)=>{
        const { data: profile, error } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterFetch"])(userInfoUrl, {
            headers: {
                Authorization: `Bearer ${tokens.accessToken}`
            }
        });
        if (error || !profile) return null;
        return {
            id: profile.sub,
            name: profile.name ?? (`${profile.given_name ?? ""} ${profile.family_name ?? ""}`.trim() || void 0),
            email: profile.email ?? profile.preferred_username ?? void 0,
            image: profile.picture,
            emailVerified: profile.email_verified ?? false
        };
    };
    return {
        providerId: "microsoft-entra-id",
        authorizationUrl,
        tokenUrl,
        userInfoUrl,
        clientId: options.clientId,
        clientSecret: options.clientSecret,
        scopes: options.scopes ?? defaultScopes,
        redirectURI: options.redirectURI,
        pkce: options.pkce,
        disableImplicitSignUp: options.disableImplicitSignUp,
        disableSignUp: options.disableSignUp,
        overrideUserInfo: options.overrideUserInfo,
        getUserInfo: getUserInfo$1
    };
}
//#endregion
//#region src/plugins/generic-oauth/providers/okta.ts
/**
* Okta OAuth provider helper
*
* @example
* ```ts
* import { genericOAuth, okta } from "better-auth/plugins/generic-oauth";
*
* export const auth = betterAuth({
*   plugins: [
*     genericOAuth({
*       config: [
*         okta({
*           clientId: process.env.OKTA_CLIENT_ID,
*           clientSecret: process.env.OKTA_CLIENT_SECRET,
*           issuer: process.env.OKTA_ISSUER,
*         }),
*       ],
*     }),
*   ],
* });
* ```
*/ function okta(options) {
    const defaultScopes = [
        "openid",
        "profile",
        "email"
    ];
    const issuer = options.issuer.replace(/\/$/, "");
    const discoveryUrl = `${issuer}/.well-known/openid-configuration`;
    const getUserInfo$1 = async (tokens)=>{
        const { data: profile, error } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterFetch"])(`${issuer}/v1/userinfo`, {
            headers: {
                Authorization: `Bearer ${tokens.accessToken}`
            }
        });
        if (error || !profile) return null;
        return {
            id: profile.sub,
            name: profile.name ?? profile.preferred_username ?? void 0,
            email: profile.email ?? void 0,
            image: profile.picture,
            emailVerified: profile.email_verified ?? false
        };
    };
    return {
        providerId: "okta",
        discoveryUrl,
        clientId: options.clientId,
        clientSecret: options.clientSecret,
        scopes: options.scopes ?? defaultScopes,
        redirectURI: options.redirectURI,
        pkce: options.pkce,
        disableImplicitSignUp: options.disableImplicitSignUp,
        disableSignUp: options.disableSignUp,
        overrideUserInfo: options.overrideUserInfo,
        getUserInfo: getUserInfo$1
    };
}
//#endregion
//#region src/plugins/generic-oauth/providers/slack.ts
/**
* Slack OAuth provider helper
*
* @example
* ```ts
* import { genericOAuth, slack } from "better-auth/plugins/generic-oauth";
*
* export const auth = betterAuth({
*   plugins: [
*     genericOAuth({
*       config: [
*         slack({
*           clientId: process.env.SLACK_CLIENT_ID,
*           clientSecret: process.env.SLACK_CLIENT_SECRET,
*         }),
*       ],
*     }),
*   ],
* });
* ```
*/ function slack(options) {
    const defaultScopes = [
        "openid",
        "profile",
        "email"
    ];
    const getUserInfo$1 = async (tokens)=>{
        const { data: profile, error } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterFetch"])("https://slack.com/api/openid.connect.userInfo", {
            headers: {
                Authorization: `Bearer ${tokens.accessToken}`
            }
        });
        if (error || !profile) return null;
        return {
            id: profile["https://slack.com/user_id"] ?? profile.sub,
            name: profile.name,
            email: profile.email,
            image: profile.picture ?? profile["https://slack.com/user_image_512"],
            emailVerified: profile.email_verified ?? false
        };
    };
    return {
        providerId: "slack",
        authorizationUrl: "https://slack.com/openid/connect/authorize",
        tokenUrl: "https://slack.com/api/openid.connect.token",
        userInfoUrl: "https://slack.com/api/openid.connect.userInfo",
        clientId: options.clientId,
        clientSecret: options.clientSecret,
        scopes: options.scopes ?? defaultScopes,
        redirectURI: options.redirectURI,
        pkce: options.pkce,
        disableImplicitSignUp: options.disableImplicitSignUp,
        disableSignUp: options.disableSignUp,
        overrideUserInfo: options.overrideUserInfo,
        getUserInfo: getUserInfo$1
    };
}
//#endregion
//#region src/plugins/generic-oauth/index.ts
async function getUserInfo(tokens, finalUserInfoUrl) {
    if (tokens.idToken) {
        const decoded = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$util$2f$decode_jwt$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["decodeJwt"])(tokens.idToken);
        if (decoded) {
            if (decoded.sub && decoded.email) return {
                id: decoded.sub,
                emailVerified: decoded.email_verified,
                image: decoded.picture,
                ...decoded
            };
        }
    }
    if (!finalUserInfoUrl) return null;
    const userInfo = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterFetch"])(finalUserInfoUrl, {
        method: "GET",
        headers: {
            Authorization: `Bearer ${tokens.accessToken}`
        }
    });
    return {
        id: userInfo.data?.sub ?? "",
        emailVerified: userInfo.data?.email_verified ?? false,
        email: userInfo.data?.email,
        image: userInfo.data?.picture,
        name: userInfo.data?.name,
        ...userInfo.data
    };
}
/**
* A generic OAuth plugin that can be used to add OAuth support to any provider
*/ const genericOAuth = (options)=>{
    return {
        id: "generic-oauth",
        init: (ctx)=>{
            return {
                context: {
                    socialProviders: options.config.map((c)=>{
                        let finalUserInfoUrl = c.userInfoUrl;
                        return {
                            id: c.providerId,
                            name: c.providerId,
                            async createAuthorizationURL (data) {
                                let finalAuthUrl = c.authorizationUrl;
                                if (!finalAuthUrl && c.discoveryUrl) {
                                    const discovery = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterFetch"])(c.discoveryUrl, {
                                        method: "GET",
                                        headers: c.discoveryHeaders
                                    });
                                    if (discovery.data) {
                                        finalAuthUrl = discovery.data.authorization_endpoint;
                                        finalUserInfoUrl = finalUserInfoUrl ?? discovery.data.userinfo_endpoint;
                                    }
                                }
                                if (!finalAuthUrl) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                                    message: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIGURATION
                                });
                                return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$oauth2$2d$B2XPHgx5$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__o__as__createAuthorizationURL$3e$__["createAuthorizationURL"])({
                                    id: c.providerId,
                                    options: {
                                        clientId: c.clientId,
                                        clientSecret: c.clientSecret,
                                        redirectURI: c.redirectURI
                                    },
                                    authorizationEndpoint: finalAuthUrl,
                                    state: data.state,
                                    codeVerifier: c.pkce ? data.codeVerifier : void 0,
                                    scopes: c.scopes || [],
                                    redirectURI: `${ctx.baseURL}/oauth2/callback/${c.providerId}`
                                });
                            },
                            async validateAuthorizationCode (data) {
                                if (c.getToken) return c.getToken(data);
                                let finalTokenUrl = c.tokenUrl;
                                if (c.discoveryUrl) {
                                    const discovery = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterFetch"])(c.discoveryUrl, {
                                        method: "GET",
                                        headers: c.discoveryHeaders
                                    });
                                    if (discovery.data) {
                                        finalTokenUrl = discovery.data.token_endpoint;
                                        finalUserInfoUrl = discovery.data.userinfo_endpoint;
                                    }
                                }
                                if (!finalTokenUrl) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                                    message: GENERIC_OAUTH_ERROR_CODES.TOKEN_URL_NOT_FOUND
                                });
                                return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$oauth2$2d$B2XPHgx5$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__validateAuthorizationCode$3e$__["validateAuthorizationCode"])({
                                    headers: c.authorizationHeaders,
                                    code: data.code,
                                    codeVerifier: data.codeVerifier,
                                    redirectURI: data.redirectURI,
                                    options: {
                                        clientId: c.clientId,
                                        clientSecret: c.clientSecret,
                                        redirectURI: c.redirectURI
                                    },
                                    tokenEndpoint: finalTokenUrl,
                                    authentication: c.authentication
                                });
                            },
                            async refreshAccessToken (refreshToken) {
                                let finalTokenUrl = c.tokenUrl;
                                if (c.discoveryUrl) {
                                    const discovery = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterFetch"])(c.discoveryUrl, {
                                        method: "GET",
                                        headers: c.discoveryHeaders
                                    });
                                    if (discovery.data) finalTokenUrl = discovery.data.token_endpoint;
                                }
                                if (!finalTokenUrl) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                                    message: GENERIC_OAUTH_ERROR_CODES.TOKEN_URL_NOT_FOUND
                                });
                                return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$oauth2$2d$B2XPHgx5$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__a__as__refreshAccessToken$3e$__["refreshAccessToken"])({
                                    refreshToken,
                                    options: {
                                        clientId: c.clientId,
                                        clientSecret: c.clientSecret
                                    },
                                    authentication: c.authentication,
                                    tokenEndpoint: finalTokenUrl
                                });
                            },
                            async getUserInfo (tokens) {
                                const userInfo = c.getUserInfo ? await c.getUserInfo(tokens) : await getUserInfo(tokens, finalUserInfoUrl);
                                if (!userInfo) return null;
                                const userMap = await c.mapProfileToUser?.(userInfo);
                                return {
                                    user: {
                                        id: userInfo?.id,
                                        email: userInfo?.email,
                                        emailVerified: userInfo?.emailVerified,
                                        image: userInfo?.image,
                                        name: userInfo?.name,
                                        ...userMap
                                    },
                                    data: userInfo
                                };
                            },
                            options: {
                                overrideUserInfoOnSignIn: c.overrideUserInfo
                            }
                        };
                    }).concat(ctx.socialProviders)
                }
            };
        },
        endpoints: {
            signInWithOAuth2: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/sign-in/oauth2", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    providerId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The provider ID for the OAuth provider"
                    }),
                    callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The URL to redirect to after sign in"
                    }).optional(),
                    errorCallbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The URL to redirect to if an error occurs"
                    }).optional(),
                    newUserCallbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The URL to redirect to after login if the user is new. Eg: \"/welcome\""
                    }).optional(),
                    disableRedirect: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().meta({
                        description: "Disable redirect"
                    }).optional(),
                    scopes: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]()).meta({
                        description: "Scopes to be passed to the provider authorization request."
                    }).optional(),
                    requestSignUp: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().meta({
                        description: "Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider. Eg: false"
                    }).optional(),
                    additionalData: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["any"]()).optional()
                }),
                metadata: {
                    openapi: {
                        description: "Sign in with OAuth2",
                        responses: {
                            200: {
                                description: "Sign in with OAuth2",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                url: {
                                                    type: "string"
                                                },
                                                redirect: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const { providerId } = ctx.body;
                const config = options.config.find((c)=>c.providerId === providerId);
                if (!config) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: `${GENERIC_OAUTH_ERROR_CODES.PROVIDER_CONFIG_NOT_FOUND} ${providerId}`
                });
                const { discoveryUrl, authorizationUrl, tokenUrl, clientId, clientSecret, scopes, redirectURI, responseType, pkce, prompt, accessType, authorizationUrlParams, responseMode, authentication } = config;
                let finalAuthUrl = authorizationUrl;
                let finalTokenUrl = tokenUrl;
                if (discoveryUrl) {
                    const discovery = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterFetch"])(discoveryUrl, {
                        method: "GET",
                        headers: config.discoveryHeaders,
                        onError (context) {
                            ctx.context.logger.error(context.error.message, context.error, {
                                discoveryUrl
                            });
                        }
                    });
                    if (discovery.data) {
                        finalAuthUrl = discovery.data.authorization_endpoint;
                        finalTokenUrl = discovery.data.token_endpoint;
                    }
                }
                if (!finalAuthUrl || !finalTokenUrl) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIGURATION
                });
                if (authorizationUrlParams) {
                    const withAdditionalParams = new URL(finalAuthUrl);
                    for (const [paramName, paramValue] of Object.entries(authorizationUrlParams))withAdditionalParams.searchParams.set(paramName, paramValue);
                    finalAuthUrl = withAdditionalParams.toString();
                }
                const additionalParams = typeof authorizationUrlParams === "function" ? authorizationUrlParams(ctx) : authorizationUrlParams;
                const { state, codeVerifier } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2d$db7gNqd$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(ctx, void 0, ctx.body.additionalData);
                const authUrl = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$oauth2$2d$B2XPHgx5$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__o__as__createAuthorizationURL$3e$__["createAuthorizationURL"])({
                    id: providerId,
                    options: {
                        clientId,
                        clientSecret,
                        redirectURI
                    },
                    authorizationEndpoint: finalAuthUrl,
                    state,
                    codeVerifier: pkce ? codeVerifier : void 0,
                    scopes: ctx.body.scopes ? [
                        ...ctx.body.scopes,
                        ...scopes || []
                    ] : scopes || [],
                    redirectURI: `${ctx.context.baseURL}/oauth2/callback/${providerId}`,
                    prompt,
                    accessType,
                    responseType,
                    responseMode,
                    additionalParams
                });
                return ctx.json({
                    url: authUrl.toString(),
                    redirect: !ctx.body.disableRedirect
                });
            }),
            oAuth2Callback: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/oauth2/callback/:providerId", {
                method: "GET",
                query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    code: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The OAuth2 code"
                    }).optional(),
                    error: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The error message, if any"
                    }).optional(),
                    error_description: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The error description, if any"
                    }).optional(),
                    state: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The state parameter from the OAuth2 request"
                    }).optional()
                }),
                metadata: {
                    ...__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2d$db7gNqd$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"],
                    allowedMediaTypes: [
                        "application/x-www-form-urlencoded",
                        "application/json"
                    ],
                    openapi: {
                        description: "OAuth2 callback",
                        responses: {
                            200: {
                                description: "OAuth2 callback",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                url: {
                                                    type: "string"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const defaultErrorURL = ctx.context.options.onAPIError?.errorURL || `${ctx.context.baseURL}/error`;
                if (ctx.query.error || !ctx.query.code) throw ctx.redirect(`${defaultErrorURL}?error=${ctx.query.error || "oAuth_code_missing"}&error_description=${ctx.query.error_description}`);
                const providerId = ctx.params?.providerId;
                if (!providerId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: GENERIC_OAUTH_ERROR_CODES.PROVIDER_ID_REQUIRED
                });
                const providerConfig = options.config.find((p)=>p.providerId === providerId);
                if (!providerConfig) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: `${GENERIC_OAUTH_ERROR_CODES.PROVIDER_CONFIG_NOT_FOUND} ${providerId}`
                });
                let tokens = void 0;
                const { callbackURL, codeVerifier, errorURL, requestSignUp, newUserURL, link } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2d$db7gNqd$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["i"])(ctx);
                const code = ctx.query.code;
                function redirectOnError(error) {
                    const defaultErrorURL$1 = ctx.context.options.onAPIError?.errorURL || `${ctx.context.baseURL}/error`;
                    let url = errorURL || defaultErrorURL$1;
                    if (url.includes("?")) url = `${url}&error=${error}`;
                    else url = `${url}?error=${error}`;
                    throw ctx.redirect(url);
                }
                let finalTokenUrl = providerConfig.tokenUrl;
                let finalUserInfoUrl = providerConfig.userInfoUrl;
                if (providerConfig.discoveryUrl) {
                    const discovery = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterFetch"])(providerConfig.discoveryUrl, {
                        method: "GET",
                        headers: providerConfig.discoveryHeaders
                    });
                    if (discovery.data) {
                        finalTokenUrl = discovery.data.token_endpoint;
                        finalUserInfoUrl = discovery.data.userinfo_endpoint;
                    }
                }
                try {
                    if (providerConfig.getToken) tokens = await providerConfig.getToken({
                        code,
                        redirectURI: `${ctx.context.baseURL}/oauth2/callback/${providerConfig.providerId}`,
                        codeVerifier: providerConfig.pkce ? codeVerifier : void 0
                    });
                    else {
                        if (!finalTokenUrl) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                            message: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIG
                        });
                        const additionalParams = typeof providerConfig.tokenUrlParams === "function" ? providerConfig.tokenUrlParams(ctx) : providerConfig.tokenUrlParams;
                        tokens = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$oauth2$2d$B2XPHgx5$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__validateAuthorizationCode$3e$__["validateAuthorizationCode"])({
                            headers: providerConfig.authorizationHeaders,
                            code,
                            codeVerifier: providerConfig.pkce ? codeVerifier : void 0,
                            redirectURI: `${ctx.context.baseURL}/oauth2/callback/${providerConfig.providerId}`,
                            options: {
                                clientId: providerConfig.clientId,
                                clientSecret: providerConfig.clientSecret,
                                redirectURI: providerConfig.redirectURI
                            },
                            tokenEndpoint: finalTokenUrl,
                            authentication: providerConfig.authentication,
                            additionalParams
                        });
                    }
                } catch (e) {
                    ctx.context.logger.error(e && typeof e === "object" && "name" in e ? e.name : "", e);
                    throw redirectOnError("oauth_code_verification_failed");
                }
                if (!tokens) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIG
                });
                const userInfo = await async function handleUserInfo() {
                    const userInfo$1 = providerConfig.getUserInfo ? await providerConfig.getUserInfo(tokens) : await getUserInfo(tokens, finalUserInfoUrl);
                    if (!userInfo$1) throw redirectOnError("user_info_is_missing");
                    const mapUser = providerConfig.mapProfileToUser ? await providerConfig.mapProfileToUser(userInfo$1) : userInfo$1;
                    const email = mapUser.email ? mapUser.email.toLowerCase() : userInfo$1.email?.toLowerCase();
                    if (!email) {
                        ctx.context.logger.error("Unable to get user info", userInfo$1);
                        throw redirectOnError("email_is_missing");
                    }
                    const id = mapUser.id ? String(mapUser.id) : String(userInfo$1.id);
                    const name = mapUser.name ? mapUser.name : userInfo$1.name;
                    if (!name) {
                        ctx.context.logger.error("Unable to get user info", userInfo$1);
                        throw redirectOnError("name_is_missing");
                    }
                    return {
                        ...userInfo$1,
                        ...mapUser,
                        email,
                        id,
                        name
                    };
                }();
                if (link) {
                    if (ctx.context.options.account?.accountLinking?.allowDifferentEmails !== true && link.email !== userInfo.email) return redirectOnError("email_doesn't_match");
                    const existingAccount = await ctx.context.internalAdapter.findAccountByProviderId(String(userInfo.id), providerConfig.providerId);
                    if (existingAccount) {
                        if (existingAccount.userId !== link.userId) return redirectOnError("account_already_linked_to_different_user");
                        const updateData = Object.fromEntries(Object.entries({
                            accessToken: tokens.accessToken,
                            idToken: tokens.idToken,
                            refreshToken: tokens.refreshToken,
                            accessTokenExpiresAt: tokens.accessTokenExpiresAt,
                            refreshTokenExpiresAt: tokens.refreshTokenExpiresAt,
                            scope: tokens.scopes?.join(",")
                        }).filter(([_, value])=>value !== void 0));
                        await ctx.context.internalAdapter.updateAccount(existingAccount.id, updateData);
                    } else if (!await ctx.context.internalAdapter.createAccount({
                        userId: link.userId,
                        providerId: providerConfig.providerId,
                        accountId: userInfo.id,
                        accessToken: tokens.accessToken,
                        accessTokenExpiresAt: tokens.accessTokenExpiresAt,
                        refreshTokenExpiresAt: tokens.refreshTokenExpiresAt,
                        scope: tokens.scopes?.join(","),
                        refreshToken: tokens.refreshToken,
                        idToken: tokens.idToken
                    })) return redirectOnError("unable_to_link_account");
                    let toRedirectTo$1;
                    try {
                        toRedirectTo$1 = callbackURL.toString();
                    } catch  {
                        toRedirectTo$1 = callbackURL;
                    }
                    throw ctx.redirect(toRedirectTo$1);
                }
                const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["O"])(ctx, {
                    userInfo,
                    account: {
                        providerId: providerConfig.providerId,
                        accountId: userInfo.id,
                        ...tokens,
                        scope: tokens.scopes?.join(",")
                    },
                    callbackURL,
                    disableSignUp: providerConfig.disableImplicitSignUp && !requestSignUp || providerConfig.disableSignUp,
                    overrideUserInfo: providerConfig.overrideUserInfo
                });
                if (result.error) return redirectOnError(result.error.split(" ").join("_"));
                const { session, user } = result.data;
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, {
                    session,
                    user
                });
                let toRedirectTo;
                try {
                    toRedirectTo = (result.isRegister ? newUserURL || callbackURL : callbackURL).toString();
                } catch  {
                    toRedirectTo = result.isRegister ? newUserURL || callbackURL : callbackURL;
                }
                throw ctx.redirect(toRedirectTo);
            }),
            oAuth2LinkAccount: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/oauth2/link", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    providerId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
                    callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
                    scopes: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]()).meta({
                        description: "Additional scopes to request when linking the account"
                    }).optional(),
                    errorCallbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The URL to redirect to if there is an error during the link process"
                    }).optional()
                }),
                use: [
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"]
                ],
                metadata: {
                    openapi: {
                        description: "Link an OAuth2 account to the current user session",
                        responses: {
                            "200": {
                                description: "Authorization URL generated successfully for linking an OAuth2 account",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                url: {
                                                    type: "string",
                                                    format: "uri",
                                                    description: "The authorization URL to redirect the user to for linking the OAuth2 account"
                                                },
                                                redirect: {
                                                    type: "boolean",
                                                    description: "Indicates that the client should redirect to the provided URL",
                                                    enum: [
                                                        true
                                                    ]
                                                }
                                            },
                                            required: [
                                                "url",
                                                "redirect"
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (c)=>{
                const session = c.context.session;
                if (!session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: GENERIC_OAUTH_ERROR_CODES.SESSION_REQUIRED
                });
                const provider = options.config.find((p)=>p.providerId === c.body.providerId);
                if (!provider) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].PROVIDER_NOT_FOUND
                });
                const { providerId, clientId, clientSecret, redirectURI, authorizationUrl, discoveryUrl, pkce, scopes, prompt, accessType, authorizationUrlParams } = provider;
                let finalAuthUrl = authorizationUrl;
                if (!finalAuthUrl) {
                    if (!discoveryUrl) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        message: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIGURATION
                    });
                    const discovery = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterFetch"])(discoveryUrl, {
                        method: "GET",
                        headers: provider.discoveryHeaders,
                        onError (context) {
                            c.context.logger.error(context.error.message, context.error, {
                                discoveryUrl
                            });
                        }
                    });
                    if (discovery.data) finalAuthUrl = discovery.data.authorization_endpoint;
                }
                if (!finalAuthUrl) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIGURATION
                });
                const state = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2d$db7gNqd$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(c, {
                    userId: session.user.id,
                    email: session.user.email
                }, void 0);
                const additionalParams = typeof authorizationUrlParams === "function" ? authorizationUrlParams(c) : authorizationUrlParams;
                const url = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$oauth2$2d$B2XPHgx5$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__o__as__createAuthorizationURL$3e$__["createAuthorizationURL"])({
                    id: providerId,
                    options: {
                        clientId,
                        clientSecret,
                        redirectURI: redirectURI || `${c.context.baseURL}/oauth2/callback/${providerId}`
                    },
                    authorizationEndpoint: finalAuthUrl,
                    state: state.state,
                    codeVerifier: pkce ? state.codeVerifier : void 0,
                    scopes: c.body.scopes || scopes || [],
                    redirectURI: redirectURI || `${c.context.baseURL}/oauth2/callback/${providerId}`,
                    prompt,
                    accessType,
                    additionalParams
                });
                return c.json({
                    url: url.toString(),
                    redirect: true
                });
            })
        },
        $ERROR_CODES: GENERIC_OAUTH_ERROR_CODES
    };
};
;
}),
"[project]/node_modules/better-auth/dist/haveibeenpwned-BSsFUFTi.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>haveIBeenPwned
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api-CkmycQ2x.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript) <export APIError as t>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/context/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__u__as__getCurrentAuthContext$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/context-DgQ9XGBl.mjs [app-route] (ecmascript) <export u as getCurrentAuthContext>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils-C5EN75oV.mjs [app-route] (ecmascript) <export t as defineErrorCodes>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/hash.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-fetch/fetch/dist/index.js [app-route] (ecmascript)");
;
;
;
;
;
//#region src/plugins/haveibeenpwned/index.ts
const ERROR_CODES = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__["defineErrorCodes"])({
    PASSWORD_COMPROMISED: "The password you entered has been compromised. Please choose a different password."
});
async function checkPasswordCompromise(password, customMessage) {
    if (!password) return;
    const sha1Hash = (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createHash"])("SHA-1", "hex").digest(password)).toUpperCase();
    const prefix = sha1Hash.substring(0, 5);
    const suffix = sha1Hash.substring(5);
    try {
        const { data, error } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$fetch$2f$fetch$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterFetch"])(`https://api.pwnedpasswords.com/range/${prefix}`, {
            headers: {
                "Add-Padding": "true",
                "User-Agent": "BetterAuth Password Checker"
            }
        });
        if (error) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("INTERNAL_SERVER_ERROR", {
            message: `Failed to check password. Status: ${error.status}`
        });
        if (data.split("\n").some((line)=>line.split(":")[0].toUpperCase() === suffix.toUpperCase())) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
            message: customMessage || ERROR_CODES.PASSWORD_COMPROMISED,
            code: "PASSWORD_COMPROMISED"
        });
    } catch (error) {
        if (error instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]) throw error;
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("INTERNAL_SERVER_ERROR", {
            message: "Failed to check password. Please try again later."
        });
    }
}
const haveIBeenPwned = (options)=>{
    const paths = options?.paths || [
        "/sign-up/email",
        "/change-password",
        "/reset-password"
    ];
    return {
        id: "haveIBeenPwned",
        init (ctx) {
            return {
                context: {
                    password: {
                        ...ctx.password,
                        async hash (password) {
                            const c = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2d$DgQ9XGBl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__u__as__getCurrentAuthContext$3e$__["getCurrentAuthContext"])();
                            if (!c.path || !paths.includes(c.path)) return ctx.password.hash(password);
                            await checkPasswordCompromise(password, options?.customPasswordCompromisedMessage);
                            return ctx.password.hash(password);
                        }
                    }
                }
            };
        },
        $ERROR_CODES: ERROR_CODES
    };
};
;
}),
"[project]/node_modules/better-auth/dist/magic-link-QdHvtdfs.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>magicLink
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/crypto-CFUhAR9W.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api-CkmycQ2x.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/hash.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/base64.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
//#region src/plugins/magic-link/utils.ts
const defaultKeyHasher = async (otp)=>{
    const hash = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createHash"])("SHA-256").digest(new TextEncoder().encode(otp));
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["base64Url"].encode(new Uint8Array(hash), {
        padding: false
    });
};
//#endregion
//#region src/plugins/magic-link/index.ts
const magicLink = (options)=>{
    const opts = {
        storeToken: "plain",
        ...options
    };
    async function storeToken(ctx, token) {
        if (opts.storeToken === "hashed") return await defaultKeyHasher(token);
        if (typeof opts.storeToken === "object" && "type" in opts.storeToken && opts.storeToken.type === "custom-hasher") return await opts.storeToken.hash(token);
        return token;
    }
    return {
        id: "magic-link",
        endpoints: {
            signInMagicLink: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/sign-in/magic-link", {
                method: "POST",
                requireHeaders: true,
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["email"]().meta({
                        description: "Email address to send the magic link"
                    }),
                    name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "User display name. Only used if the user is registering for the first time. Eg: \"my-name\""
                    }).optional(),
                    callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "URL to redirect after magic link verification"
                    }).optional(),
                    newUserCallbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "URL to redirect after new user signup. Only used if the user is registering for the first time."
                    }).optional(),
                    errorCallbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "URL to redirect after error."
                    }).optional()
                }),
                metadata: {
                    openapi: {
                        operationId: "signInWithMagicLink",
                        description: "Sign in with magic link",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                status: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const { email } = ctx.body;
                const verificationToken = opts?.generateToken ? await opts.generateToken(email) : (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(32, "a-z", "A-Z");
                const storedToken = await storeToken(ctx, verificationToken);
                await ctx.context.internalAdapter.createVerificationValue({
                    identifier: storedToken,
                    value: JSON.stringify({
                        email,
                        name: ctx.body.name
                    }),
                    expiresAt: new Date(Date.now() + (opts.expiresIn || 300) * 1e3)
                });
                const realBaseURL = new URL(ctx.context.baseURL);
                const pathname = realBaseURL.pathname === "/" ? "" : realBaseURL.pathname;
                const basePath = pathname ? "" : ctx.context.options.basePath || "";
                const url = new URL(`${pathname}${basePath}/magic-link/verify`, realBaseURL.origin);
                url.searchParams.set("token", verificationToken);
                url.searchParams.set("callbackURL", ctx.body.callbackURL || "/");
                if (ctx.body.newUserCallbackURL) url.searchParams.set("newUserCallbackURL", ctx.body.newUserCallbackURL);
                if (ctx.body.errorCallbackURL) url.searchParams.set("errorCallbackURL", ctx.body.errorCallbackURL);
                await options.sendMagicLink({
                    email,
                    url: url.toString(),
                    token: verificationToken
                }, ctx);
                return ctx.json({
                    status: true
                });
            }),
            magicLinkVerify: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/magic-link/verify", {
                method: "GET",
                query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "Verification token"
                    }),
                    callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "URL to redirect after magic link verification, if not provided the user will be redirected to the root URL. Eg: \"/dashboard\""
                    }).optional(),
                    errorCallbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "URL to redirect after error."
                    }).optional(),
                    newUserCallbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "URL to redirect after new user signup. Only used if the user is registering for the first time."
                    }).optional()
                }),
                use: [
                    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["L"])((ctx)=>{
                        return ctx.query.callbackURL ? decodeURIComponent(ctx.query.callbackURL) : "/";
                    }),
                    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["L"])((ctx)=>{
                        return ctx.query.newUserCallbackURL ? decodeURIComponent(ctx.query.newUserCallbackURL) : "/";
                    }),
                    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["L"])((ctx)=>{
                        return ctx.query.errorCallbackURL ? decodeURIComponent(ctx.query.errorCallbackURL) : "/";
                    })
                ],
                requireHeaders: true,
                metadata: {
                    openapi: {
                        operationId: "verifyMagicLink",
                        description: "Verify magic link",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                session: {
                                                    $ref: "#/components/schemas/Session"
                                                },
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const token = ctx.query.token;
                const callbackURL = new URL(ctx.query.callbackURL ? decodeURIComponent(ctx.query.callbackURL) : "/", ctx.context.baseURL).toString();
                const errorCallbackURL = new URL(ctx.query.errorCallbackURL ? decodeURIComponent(ctx.query.errorCallbackURL) : callbackURL, ctx.context.baseURL).toString();
                const newUserCallbackURL = new URL(ctx.query.newUserCallbackURL ? decodeURIComponent(ctx.query.newUserCallbackURL) : callbackURL, ctx.context.baseURL).toString();
                callbackURL?.startsWith("http") || (callbackURL ? `${ctx.context.options.baseURL}${callbackURL}` : ctx.context.options.baseURL);
                const storedToken = await storeToken(ctx, token);
                const tokenValue = await ctx.context.internalAdapter.findVerificationValue(storedToken);
                if (!tokenValue) throw ctx.redirect(`${errorCallbackURL}?error=INVALID_TOKEN`);
                if (tokenValue.expiresAt < /* @__PURE__ */ new Date()) {
                    await ctx.context.internalAdapter.deleteVerificationValue(tokenValue.id);
                    throw ctx.redirect(`${errorCallbackURL}?error=EXPIRED_TOKEN`);
                }
                await ctx.context.internalAdapter.deleteVerificationValue(tokenValue.id);
                const { email, name } = JSON.parse(tokenValue.value);
                let isNewUser = false;
                let user = await ctx.context.internalAdapter.findUserByEmail(email).then((res)=>res?.user);
                if (!user) if (!opts.disableSignUp) {
                    const newUser = await ctx.context.internalAdapter.createUser({
                        email,
                        emailVerified: true,
                        name: name || ""
                    });
                    isNewUser = true;
                    user = newUser;
                    if (!user) throw ctx.redirect(`${errorCallbackURL}?error=failed_to_create_user`);
                } else throw ctx.redirect(`${errorCallbackURL}?error=new_user_signup_disabled`);
                if (!user.emailVerified) user = await ctx.context.internalAdapter.updateUser(user.id, {
                    emailVerified: true
                });
                const session = await ctx.context.internalAdapter.createSession(user.id);
                if (!session) throw ctx.redirect(`${errorCallbackURL}?error=failed_to_create_session`);
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, {
                    session,
                    user
                });
                if (!ctx.query.callbackURL) return ctx.json({
                    token: session.token,
                    user: {
                        id: user.id,
                        email: user.email,
                        emailVerified: user.emailVerified,
                        name: user.name,
                        image: user.image,
                        createdAt: user.createdAt,
                        updatedAt: user.updatedAt
                    }
                });
                if (isNewUser) throw ctx.redirect(newUserCallbackURL);
                throw ctx.redirect(callbackURL);
            })
        },
        rateLimit: [
            {
                pathMatcher (path) {
                    return path.startsWith("/sign-in/magic-link") || path.startsWith("/magic-link/verify");
                },
                window: opts.rateLimit?.window || 60,
                max: opts.rateLimit?.max || 5
            }
        ]
    };
};
;
}),
"[project]/node_modules/better-auth/dist/multi-session-CbEYz_wJ.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>multiSession
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api-CkmycQ2x.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript) <export APIError as t>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/session-AaRl3_x-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils-C5EN75oV.mjs [app-route] (ecmascript) <export t as defineErrorCodes>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
//#region src/plugins/multi-session/index.ts
const ERROR_CODES = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__["defineErrorCodes"])({
    INVALID_SESSION_TOKEN: "Invalid session token"
});
const multiSession = (options)=>{
    const opts = {
        maximumSessions: 5,
        ...options
    };
    const isMultiSessionCookie = (key)=>key.includes("_multi-");
    return {
        id: "multi-session",
        endpoints: {
            listDeviceSessions: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/multi-session/list-device-sessions", {
                method: "GET",
                requireHeaders: true
            }, async (ctx)=>{
                const cookieHeader = ctx.headers?.get("cookie");
                if (!cookieHeader) return ctx.json([]);
                const cookies = Object.fromEntries((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["o"])(cookieHeader));
                const sessionTokens = (await Promise.all(Object.entries(cookies).filter(([key])=>isMultiSessionCookie(key)).map(async ([key])=>await ctx.getSignedCookie(key, ctx.context.secret)))).filter((v)=>typeof v === "string");
                if (!sessionTokens.length) return ctx.json([]);
                const uniqueUserSessions = (await ctx.context.internalAdapter.findSessions(sessionTokens)).filter((session)=>session && session.session.expiresAt > /* @__PURE__ */ new Date()).reduce((acc, session)=>{
                    if (!acc.find((s)=>s.user.id === session.user.id)) acc.push(session);
                    return acc;
                }, []);
                return ctx.json(uniqueUserSessions);
            }),
            setActiveSession: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/multi-session/set-active", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    sessionToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The session token to set as active"
                    })
                }),
                requireHeaders: true,
                use: [
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"]
                ],
                metadata: {
                    openapi: {
                        description: "Set the active session",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                session: {
                                                    $ref: "#/components/schemas/Session"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const sessionToken = ctx.body.sessionToken;
                const multiSessionCookieName = `${ctx.context.authCookies.sessionToken.name}_multi-${sessionToken.toLowerCase()}`;
                if (!await ctx.getSignedCookie(multiSessionCookieName, ctx.context.secret)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    message: ERROR_CODES.INVALID_SESSION_TOKEN
                });
                const session = await ctx.context.internalAdapter.findSession(sessionToken);
                if (!session || session.session.expiresAt < /* @__PURE__ */ new Date()) {
                    ctx.setCookie(multiSessionCookieName, "", {
                        ...ctx.context.authCookies.sessionToken.options,
                        maxAge: 0
                    });
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                        message: ERROR_CODES.INVALID_SESSION_TOKEN
                    });
                }
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, session);
                return ctx.json(session);
            }),
            revokeDeviceSession: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/multi-session/revoke", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    sessionToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The session token to revoke"
                    })
                }),
                requireHeaders: true,
                use: [
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"]
                ],
                metadata: {
                    openapi: {
                        description: "Revoke a device session",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                status: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const sessionToken = ctx.body.sessionToken;
                const multiSessionCookieName = `${ctx.context.authCookies.sessionToken.name}_multi-${sessionToken.toLowerCase()}`;
                if (!await ctx.getSignedCookie(multiSessionCookieName, ctx.context.secret)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                    message: ERROR_CODES.INVALID_SESSION_TOKEN
                });
                await ctx.context.internalAdapter.deleteSession(sessionToken);
                ctx.setCookie(multiSessionCookieName, "", {
                    ...ctx.context.authCookies.sessionToken.options,
                    maxAge: 0
                });
                if (!(ctx.context.session?.session.token === sessionToken)) return ctx.json({
                    status: true
                });
                const cookieHeader = ctx.headers?.get("cookie");
                if (cookieHeader) {
                    const cookies = Object.fromEntries((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["o"])(cookieHeader));
                    const sessionTokens = (await Promise.all(Object.entries(cookies).filter(([key])=>isMultiSessionCookie(key)).map(async ([key])=>await ctx.getSignedCookie(key, ctx.context.secret)))).filter((v)=>typeof v === "string");
                    const internalAdapter = ctx.context.internalAdapter;
                    if (sessionTokens.length > 0) {
                        const validSessions = (await internalAdapter.findSessions(sessionTokens)).filter((session)=>session && session.session.expiresAt > /* @__PURE__ */ new Date());
                        if (validSessions.length > 0) {
                            const nextSession = validSessions[0];
                            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, nextSession);
                        } else (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])(ctx);
                    } else (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])(ctx);
                } else (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])(ctx);
                return ctx.json({
                    status: true
                });
            })
        },
        hooks: {
            after: [
                {
                    matcher: ()=>true,
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        const cookieString = ctx.context.responseHeaders?.get("set-cookie");
                        if (!cookieString) return;
                        const setCookies = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["l"])(cookieString);
                        const sessionCookieConfig = ctx.context.authCookies.sessionToken;
                        const sessionToken = ctx.context.newSession?.session.token;
                        if (!sessionToken) return;
                        const cookies = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["o"])(ctx.headers?.get("cookie") || "");
                        const cookieName = `${sessionCookieConfig.name}_multi-${sessionToken.toLowerCase()}`;
                        if (setCookies.get(cookieName) || cookies.get(cookieName)) return;
                        if (Object.keys(Object.fromEntries(cookies)).filter(isMultiSessionCookie).length + (cookieString.includes("session_token") ? 1 : 0) >= opts.maximumSessions) return;
                        await ctx.setSignedCookie(cookieName, sessionToken, ctx.context.secret, sessionCookieConfig.options);
                    })
                },
                {
                    matcher: (context)=>context.path === "/sign-out",
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        const cookieHeader = ctx.headers?.get("cookie");
                        if (!cookieHeader) return;
                        const cookies = Object.fromEntries((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["o"])(cookieHeader));
                        const multiSessionKeys = Object.keys(cookies).filter((key)=>isMultiSessionCookie(key));
                        const verifiedTokens = (await Promise.all(multiSessionKeys.map(async (key)=>{
                            const verifiedToken = await ctx.getSignedCookie(key, ctx.context.secret);
                            if (verifiedToken) {
                                ctx.setCookie(key.toLowerCase().replace("__secure-", "__Secure-"), "", {
                                    ...ctx.context.authCookies.sessionToken.options,
                                    maxAge: 0
                                });
                                return verifiedToken;
                            }
                            return null;
                        }))).filter((v)=>typeof v === "string");
                        if (verifiedTokens.length > 0) await ctx.context.internalAdapter.deleteSessions(verifiedTokens);
                    })
                }
            ]
        },
        $ERROR_CODES: ERROR_CODES
    };
};
;
}),
"[project]/node_modules/better-auth/dist/oauth-proxy-Dz1E1SVN.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>oAuthProxy
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/crypto-CFUhAR9W.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$url$2d$CB8xCwz$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/url-CB8xCwz-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api-CkmycQ2x.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$parser$2d$pHp5yoAv$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/parser-pHp5yoAv.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/env-8yWFh7b8.mjs [app-route] (ecmascript) <export c as env>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
//#region src/plugins/oauth-proxy/utils.ts
/**
* Get base URL from vendor-specific environment variables
*/ function getVendorBaseURL() {
    const vercel = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__["env"].VERCEL_URL ? `https://${__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__["env"].VERCEL_URL}` : void 0;
    const netlify = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__["env"].NETLIFY_URL;
    const render = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__["env"].RENDER_URL;
    const aws = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__["env"].AWS_LAMBDA_FUNCTION_NAME;
    const google = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__["env"].GOOGLE_CLOUD_FUNCTION_NAME;
    const azure = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__["env"].AZURE_FUNCTION_NAME;
    return vercel || netlify || render || aws || google || azure;
}
/**
* Resolve the current URL from various sources
*/ function resolveCurrentURL(ctx, opts) {
    return new URL(opts?.currentURL || ctx.request?.url || getVendorBaseURL() || ctx.context.baseURL);
}
/**
* Check if the proxy should be skipped for this request
*/ function checkSkipProxy(ctx, opts) {
    if (ctx.request?.headers.get("x-skip-oauth-proxy")) return true;
    const productionURL = opts?.productionURL || __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$env$2d$8yWFh7b8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__c__as__env$3e$__["env"].BETTER_AUTH_URL;
    if (!productionURL) return false;
    const currentURL = ctx.request?.url || getVendorBaseURL();
    if (!currentURL) return false;
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$url$2d$CB8xCwz$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(productionURL) === (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$url$2d$CB8xCwz$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(currentURL);
}
//#endregion
//#region src/plugins/oauth-proxy/index.ts
const oAuthProxy = (opts)=>{
    return {
        id: "oauth-proxy",
        options: opts,
        endpoints: {
            oAuthProxy: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/oauth-proxy-callback", {
                method: "GET",
                operationId: "oauthProxyCallback",
                query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The URL to redirect to after the proxy"
                    }),
                    cookies: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The cookies to set after the proxy"
                    })
                }),
                use: [
                    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["L"])((ctx)=>ctx.query.callbackURL)
                ],
                metadata: {
                    openapi: {
                        operationId: "oauthProxyCallback",
                        description: "OAuth Proxy Callback",
                        parameters: [
                            {
                                in: "query",
                                name: "callbackURL",
                                required: true,
                                description: "The URL to redirect to after the proxy"
                            },
                            {
                                in: "query",
                                name: "cookies",
                                required: true,
                                description: "The cookies to set after the proxy"
                            }
                        ],
                        responses: {
                            302: {
                                description: "Redirect",
                                headers: {
                                    Location: {
                                        description: "The URL to redirect to",
                                        schema: {
                                            type: "string"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const decryptedCookies = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                    key: ctx.context.secret,
                    data: ctx.query.cookies
                }).catch((e)=>{
                    ctx.context.logger.error("Failed to decrypt OAuth proxy cookies:", e);
                    return null;
                });
                if (!decryptedCookies) {
                    const errorURL = ctx.context.options.onAPIError?.errorURL || `${ctx.context.options.baseURL}/api/auth/error`;
                    throw ctx.redirect(`${errorURL}?error=OAuthProxy - Invalid cookies or secret`);
                }
                const isSecureContext = resolveCurrentURL(ctx, opts).protocol === "https:";
                const parsedCookies = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["l"])(decryptedCookies);
                const processedCookies = Array.from(parsedCookies.entries()).map(([name, attrs])=>{
                    const options = {};
                    if (attrs.path) options.path = attrs.path;
                    if (attrs.expires) options.expires = attrs.expires;
                    if (attrs.samesite) options.sameSite = attrs.samesite;
                    if (attrs.httponly) options.httpOnly = true;
                    if (attrs["max-age"] !== void 0) options.maxAge = attrs["max-age"];
                    if (isSecureContext) options.secure = true;
                    return {
                        name,
                        options,
                        value: decodeURIComponent(attrs.value)
                    };
                });
                for (const cookie of processedCookies)ctx.setCookie(cookie.name, cookie.value, cookie.options);
                throw ctx.redirect(ctx.query.callbackURL);
            })
        },
        hooks: {
            before: [
                {
                    matcher (context) {
                        return !!(context.path?.startsWith("/sign-in/social") || context.path?.startsWith("/sign-in/oauth2"));
                    },
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        if (checkSkipProxy(ctx, opts)) return;
                        const currentURL = resolveCurrentURL(ctx, opts);
                        const originalCallbackURL = ctx.body?.callbackURL || ctx.context.baseURL;
                        const newCallbackURL = `${currentURL.origin}${ctx.context.options.basePath || "/api/auth"}/oauth-proxy-callback?callbackURL=${encodeURIComponent(originalCallbackURL)}`;
                        if (!ctx.body) return;
                        ctx.body.callbackURL = newCallbackURL;
                    })
                },
                {
                    matcher (context) {
                        return !!(context.path?.startsWith("/callback") || context.path?.startsWith("/oauth2/callback"));
                    },
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        const state = ctx.query?.state || ctx.body?.state;
                        if (!state || typeof state !== "string") return;
                        let statePackage;
                        try {
                            statePackage = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$parser$2d$pHp5yoAv$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                                key: ctx.context.secret,
                                data: state
                            }));
                        } catch (e) {
                            return;
                        }
                        if (!statePackage.isOAuthProxy || !statePackage.state || !statePackage.stateCookie) return;
                        let stateCookieValue;
                        try {
                            stateCookieValue = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                                key: ctx.context.secret,
                                data: statePackage.stateCookie
                            });
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$parser$2d$pHp5yoAv$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(stateCookieValue);
                        } catch (e) {
                            ctx.context.logger.error("Failed to decrypt OAuth proxy state cookie:", e);
                            return;
                        }
                        ctx.context._oauthProxySnapshot = {
                            storeStateStrategy: ctx.context.oauthConfig.storeStateStrategy,
                            skipStateCookieCheck: ctx.context.oauthConfig.skipStateCookieCheck,
                            internalAdapter: ctx.context.internalAdapter
                        };
                        const originalAdapter = ctx.context.internalAdapter;
                        const capturedStatePackage = statePackage;
                        ctx.context.oauthConfig.storeStateStrategy = "database";
                        ctx.context.internalAdapter = {
                            ...ctx.context.internalAdapter,
                            findVerificationValue: async (identifier)=>{
                                if (identifier === capturedStatePackage.state) return {
                                    id: `oauth-proxy-${capturedStatePackage.state}`,
                                    identifier: capturedStatePackage.state,
                                    value: stateCookieValue,
                                    createdAt: /* @__PURE__ */ new Date(),
                                    updatedAt: /* @__PURE__ */ new Date(),
                                    expiresAt: new Date(Date.now() + 600 * 1e3)
                                };
                                return originalAdapter.findVerificationValue(identifier);
                            }
                        };
                        if (ctx.query?.state) ctx.query.state = statePackage.state;
                        if (ctx.body?.state) ctx.body.state = statePackage.state;
                        ctx.context.oauthConfig.skipStateCookieCheck = true;
                    })
                },
                {
                    matcher () {
                        return true;
                    },
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        if (ctx.path !== "/callback/:id") return;
                        if (ctx.context.oauthConfig.storeStateStrategy === "cookie") return;
                        if (ctx.context._oauthProxySnapshot) return;
                        const state = ctx.query?.state || ctx.body?.state;
                        if (!state) return;
                        const data = await ctx.context.internalAdapter.findVerificationValue(state);
                        if (!data) return;
                        let parsedState;
                        try {
                            parsedState = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$parser$2d$pHp5yoAv$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(data.value);
                        } catch  {
                            parsedState = void 0;
                        }
                        if (!parsedState?.callbackURL?.includes("/oauth-proxy-callback")) return;
                        ctx.context._oauthProxySnapshot = {
                            storeStateStrategy: ctx.context.oauthConfig.storeStateStrategy,
                            skipStateCookieCheck: ctx.context.oauthConfig.skipStateCookieCheck,
                            internalAdapter: ctx.context.internalAdapter
                        };
                        ctx.context.oauthConfig.skipStateCookieCheck = true;
                    })
                }
            ],
            after: [
                {
                    matcher (context) {
                        return !!(context.path?.startsWith("/sign-in/social") || context.path?.startsWith("/sign-in/oauth2"));
                    },
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        if (checkSkipProxy(ctx, opts)) return;
                        if (ctx.context.oauthConfig.storeStateStrategy !== "cookie") return;
                        const signInResponse = ctx.context.returned;
                        if (!signInResponse || typeof signInResponse !== "object" || !("url" in signInResponse)) return;
                        const { url: providerURL } = signInResponse;
                        if (typeof providerURL !== "string") return;
                        const oauthURL = new URL(providerURL);
                        const originalState = oauthURL.searchParams.get("state");
                        if (!originalState) return;
                        const setCookieHeader = ctx.context.responseHeaders?.get("set-cookie");
                        if (!setCookieHeader) return;
                        const stateCookie = ctx.context.createAuthCookie("oauth_state");
                        const stateCookieAttrs = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["l"])(setCookieHeader).get(stateCookie.name);
                        if (!stateCookieAttrs?.value) return;
                        const stateCookieValue = stateCookieAttrs.value;
                        try {
                            const statePackage = {
                                state: originalState,
                                stateCookie: stateCookieValue,
                                isOAuthProxy: true
                            };
                            const encryptedPackage = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])({
                                key: ctx.context.secret,
                                data: JSON.stringify(statePackage)
                            });
                            oauthURL.searchParams.set("state", encryptedPackage);
                            ctx.context.returned = {
                                ...signInResponse,
                                url: oauthURL.toString()
                            };
                        } catch (e) {
                            ctx.context.logger.error("Failed to encrypt OAuth proxy state package:", e);
                        }
                    })
                },
                {
                    matcher (context) {
                        return !!(context.path?.startsWith("/callback") || context.path?.startsWith("/oauth2/callback"));
                    },
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        const headers = ctx.context.responseHeaders;
                        const location = headers?.get("location");
                        if (!location?.includes("/oauth-proxy-callback?callbackURL") || !location.startsWith("http")) return;
                        const productionOrigin = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$url$2d$CB8xCwz$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(opts?.productionURL || ctx.context.options.baseURL || ctx.context.baseURL);
                        const locationURL = new URL(location);
                        if (locationURL.origin === productionOrigin) {
                            const newLocation = locationURL.searchParams.get("callbackURL");
                            if (!newLocation) return;
                            ctx.setHeader("location", newLocation);
                            return;
                        }
                        const setCookies = headers?.get("set-cookie");
                        if (!setCookies) return;
                        const encryptedCookies = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])({
                            key: ctx.context.secret,
                            data: setCookies
                        });
                        const locationWithCookies = `${location}&cookies=${encodeURIComponent(encryptedCookies)}`;
                        ctx.setHeader("location", locationWithCookies);
                    })
                },
                {
                    matcher (context) {
                        return !!(context.path?.startsWith("/callback") || context.path?.startsWith("/oauth2/callback"));
                    },
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        const contextWithSnapshot = ctx.context;
                        const snapshot = contextWithSnapshot._oauthProxySnapshot;
                        if (snapshot) {
                            ctx.context.oauthConfig.storeStateStrategy = snapshot.storeStateStrategy;
                            ctx.context.oauthConfig.skipStateCookieCheck = snapshot.skipStateCookieCheck;
                            ctx.context.internalAdapter = snapshot.internalAdapter;
                            contextWithSnapshot._oauthProxySnapshot = void 0;
                        }
                    })
                }
            ]
        }
    };
};
;
}),
"[project]/node_modules/better-auth/dist/one-tap-Bz8Q39Od.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>oneTap
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api-CkmycQ2x.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript) <export APIError as t>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwks$2f$remote$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/jwks/remote.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$verify$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/jwt/verify.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
//#region src/utils/boolean.ts
function toBoolean(value) {
    return value === "true" || value === true;
}
//#endregion
//#region src/plugins/one-tap/index.ts
const oneTap = (options)=>({
        id: "one-tap",
        endpoints: {
            oneTapCallback: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/one-tap/callback", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    idToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "Google ID token, which the client obtains from the One Tap API"
                    })
                }),
                metadata: {
                    openapi: {
                        summary: "One tap callback",
                        description: "Use this endpoint to authenticate with Google One Tap",
                        responses: {
                            200: {
                                description: "Successful response",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                session: {
                                                    $ref: "#/components/schemas/Session"
                                                },
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            400: {
                                description: "Invalid token"
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const { idToken } = ctx.body;
                let payload;
                try {
                    const { payload: verifiedPayload } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$verify$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["jwtVerify"])(idToken, (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwks$2f$remote$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createRemoteJWKSet"])(new URL("https://www.googleapis.com/oauth2/v3/certs")), {
                        issuer: [
                            "https://accounts.google.com",
                            "accounts.google.com"
                        ],
                        audience: options?.clientId || ctx.context.options.socialProviders?.google?.clientId
                    });
                    payload = verifiedPayload;
                } catch (error) {
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                        message: "invalid id token"
                    });
                }
                const { email, email_verified, name, picture, sub } = payload;
                if (!email) return ctx.json({
                    error: "Email not available in token"
                });
                const user = await ctx.context.internalAdapter.findUserByEmail(email);
                if (!user) {
                    if (options?.disableSignup) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_GATEWAY", {
                        message: "User not found"
                    });
                    const newUser = await ctx.context.internalAdapter.createOAuthUser({
                        email,
                        emailVerified: typeof email_verified === "boolean" ? email_verified : toBoolean(email_verified),
                        name,
                        image: picture
                    }, {
                        providerId: "google",
                        accountId: sub
                    });
                    if (!newUser) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("INTERNAL_SERVER_ERROR", {
                        message: "Could not create user"
                    });
                    const session$1 = await ctx.context.internalAdapter.createSession(newUser.user.id);
                    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, {
                        user: newUser.user,
                        session: session$1
                    });
                    return ctx.json({
                        token: session$1.token,
                        user: {
                            id: newUser.user.id,
                            email: newUser.user.email,
                            emailVerified: newUser.user.emailVerified,
                            name: newUser.user.name,
                            image: newUser.user.image,
                            createdAt: newUser.user.createdAt,
                            updatedAt: newUser.user.updatedAt
                        }
                    });
                }
                if (!await ctx.context.internalAdapter.findAccount(sub)) {
                    const accountLinking = ctx.context.options.account?.accountLinking;
                    if (accountLinking?.enabled && (accountLinking.trustedProviders?.includes("google") || email_verified)) await ctx.context.internalAdapter.linkAccount({
                        userId: user.user.id,
                        providerId: "google",
                        accountId: sub,
                        scope: "openid,profile,email",
                        idToken
                    });
                    else throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                        message: "Google sub doesn't match"
                    });
                }
                const session = await ctx.context.internalAdapter.createSession(user.user.id);
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, {
                    user: user.user,
                    session
                });
                return ctx.json({
                    token: session.token,
                    user: {
                        id: user.user.id,
                        email: user.user.email,
                        emailVerified: user.user.emailVerified,
                        name: user.user.name,
                        image: user.user.image,
                        createdAt: user.user.createdAt,
                        updatedAt: user.user.updatedAt
                    }
                });
            })
        }
    });
;
}),
"[project]/node_modules/better-auth/dist/one-time-token-C8YQxf38.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>oneTimeToken
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/crypto-CFUhAR9W.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/session-AaRl3_x-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/hash.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/base64.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
//#region src/plugins/one-time-token/utils.ts
const defaultKeyHasher = async (token)=>{
    const hash = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createHash"])("SHA-256").digest(new TextEncoder().encode(token));
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["base64Url"].encode(new Uint8Array(hash), {
        padding: false
    });
};
//#endregion
//#region src/plugins/one-time-token/index.ts
const oneTimeToken = (options)=>{
    const opts = {
        storeToken: "plain",
        ...options
    };
    async function storeToken(ctx, token) {
        if (opts.storeToken === "hashed") return await defaultKeyHasher(token);
        if (typeof opts.storeToken === "object" && "type" in opts.storeToken && opts.storeToken.type === "custom-hasher") return await opts.storeToken.hash(token);
        return token;
    }
    return {
        id: "one-time-token",
        endpoints: {
            generateOneTimeToken: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/one-time-token/generate", {
                method: "GET",
                use: [
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"]
                ]
            }, async (c)=>{
                if (opts?.disableClientRequest && c.request) throw c.error("BAD_REQUEST", {
                    message: "Client requests are disabled"
                });
                const session = c.context.session;
                const token = opts?.generateToken ? await opts.generateToken(session, c) : (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(32);
                const expiresAt = new Date(Date.now() + (opts?.expiresIn ?? 3) * 60 * 1e3);
                const storedToken = await storeToken(c, token);
                await c.context.internalAdapter.createVerificationValue({
                    value: session.session.token,
                    identifier: `one-time-token:${storedToken}`,
                    expiresAt
                });
                return c.json({
                    token
                });
            }),
            verifyOneTimeToken: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/one-time-token/verify", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The token to verify. Eg: \"some-token\""
                    })
                })
            }, async (c)=>{
                const { token } = c.body;
                const storedToken = await storeToken(c, token);
                const verificationValue = await c.context.internalAdapter.findVerificationValue(`one-time-token:${storedToken}`);
                if (!verificationValue) throw c.error("BAD_REQUEST", {
                    message: "Invalid token"
                });
                await c.context.internalAdapter.deleteVerificationValue(verificationValue.id);
                if (verificationValue.expiresAt < /* @__PURE__ */ new Date()) throw c.error("BAD_REQUEST", {
                    message: "Token expired"
                });
                const session = await c.context.internalAdapter.findSession(verificationValue.value);
                if (!session) throw c.error("BAD_REQUEST", {
                    message: "Session not found"
                });
                return c.json(session);
            })
        }
    };
};
;
}),
"[project]/node_modules/better-auth/dist/open-api-DZG02vyi.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>openAPI
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/get-model-name-D4DUV7S2.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api-CkmycQ2x.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript) <export APIError as t>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
//#region src/plugins/open-api/generator.ts
const allowedType = new Set([
    "string",
    "number",
    "boolean",
    "array",
    "object"
]);
function getTypeFromZodType(zodType) {
    const type = zodType.type;
    return allowedType.has(type) ? type : "string";
}
function getFieldSchema(field) {
    const schema = {
        type: field.type === "date" ? "string" : field.type,
        ...field.type === "date" && {
            format: "date-time"
        }
    };
    if (field.defaultValue !== void 0) schema.default = typeof field.defaultValue === "function" ? "Generated at runtime" : field.defaultValue;
    if (field.input === false) schema.readOnly = true;
    return schema;
}
function getParameters(options) {
    const parameters = [];
    if (options.metadata?.openapi?.parameters) {
        parameters.push(...options.metadata.openapi.parameters);
        return parameters;
    }
    if (options.query instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ZodObject"]) Object.entries(options.query.shape).forEach(([key, value])=>{
        if (value instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ZodType"]) parameters.push({
            name: key,
            in: "query",
            schema: {
                ...processZodType(value),
                ..."minLength" in value && value.minLength ? {
                    minLength: value.minLength
                } : {}
            }
        });
    });
    return parameters;
}
function getRequestBody(options) {
    if (options.metadata?.openapi?.requestBody) return options.metadata.openapi.requestBody;
    if (!options.body) return void 0;
    if (options.body instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ZodObject"] || options.body instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ZodOptional"]) {
        const shape = options.body.shape;
        if (!shape) return void 0;
        const properties = {};
        const required = [];
        Object.entries(shape).forEach(([key, value])=>{
            if (value instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ZodType"]) {
                properties[key] = processZodType(value);
                if (!(value instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ZodOptional"])) required.push(key);
            }
        });
        return {
            required: options.body instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ZodOptional"] ? false : options.body ? true : false,
            content: {
                "application/json": {
                    schema: {
                        type: "object",
                        properties,
                        required
                    }
                }
            }
        };
    }
}
function processZodType(zodType) {
    if (zodType instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ZodOptional"]) {
        const innerType = zodType._def.innerType;
        return {
            ...processZodType(innerType),
            nullable: true
        };
    }
    if (zodType instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ZodObject"]) {
        const shape = zodType.shape;
        if (shape) {
            const properties = {};
            const required = [];
            Object.entries(shape).forEach(([key, value])=>{
                if (value instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ZodType"]) {
                    properties[key] = processZodType(value);
                    if (!(value instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ZodOptional"])) required.push(key);
                }
            });
            return {
                type: "object",
                properties,
                ...required.length > 0 ? {
                    required
                } : {},
                description: zodType.description
            };
        }
    }
    return {
        type: getTypeFromZodType(zodType),
        description: zodType.description
    };
}
function getResponse(responses) {
    return {
        "400": {
            content: {
                "application/json": {
                    schema: {
                        type: "object",
                        properties: {
                            message: {
                                type: "string"
                            }
                        },
                        required: [
                            "message"
                        ]
                    }
                }
            },
            description: "Bad Request. Usually due to missing parameters, or invalid parameters."
        },
        "401": {
            content: {
                "application/json": {
                    schema: {
                        type: "object",
                        properties: {
                            message: {
                                type: "string"
                            }
                        },
                        required: [
                            "message"
                        ]
                    }
                }
            },
            description: "Unauthorized. Due to missing or invalid authentication."
        },
        "403": {
            content: {
                "application/json": {
                    schema: {
                        type: "object",
                        properties: {
                            message: {
                                type: "string"
                            }
                        }
                    }
                }
            },
            description: "Forbidden. You do not have permission to access this resource or to perform this action."
        },
        "404": {
            content: {
                "application/json": {
                    schema: {
                        type: "object",
                        properties: {
                            message: {
                                type: "string"
                            }
                        }
                    }
                }
            },
            description: "Not Found. The requested resource was not found."
        },
        "429": {
            content: {
                "application/json": {
                    schema: {
                        type: "object",
                        properties: {
                            message: {
                                type: "string"
                            }
                        }
                    }
                }
            },
            description: "Too Many Requests. You have exceeded the rate limit. Try again later."
        },
        "500": {
            content: {
                "application/json": {
                    schema: {
                        type: "object",
                        properties: {
                            message: {
                                type: "string"
                            }
                        }
                    }
                }
            },
            description: "Internal Server Error. This is a problem with the server that you cannot fix."
        },
        ...responses
    };
}
function toOpenApiPath(path) {
    return path.split("/").map((part)=>part.startsWith(":") ? `{${part.slice(1)}}` : part).join("/");
}
async function generator(ctx, options) {
    const baseEndpoints = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["a"])(ctx, {
        ...options,
        plugins: []
    });
    const tables = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["a"])({
        ...options,
        session: {
            ...options.session,
            storeSessionInDatabase: true
        }
    });
    const components = {
        schemas: {
            ...Object.entries(tables).reduce((acc, [key, value])=>{
                const modelName = key.charAt(0).toUpperCase() + key.slice(1);
                const fields = value.fields;
                const required = [];
                const properties = {
                    id: {
                        type: "string"
                    }
                };
                Object.entries(fields).forEach(([fieldKey, fieldValue])=>{
                    if (!fieldValue) return;
                    properties[fieldKey] = getFieldSchema(fieldValue);
                    if (fieldValue.required && fieldValue.input !== false) required.push(fieldKey);
                });
                Object.entries(properties).forEach(([key$1, prop])=>{
                    const field = value.fields[key$1];
                    if (field && field.type === "date" && prop.type === "string") prop.format = "date-time";
                });
                acc[modelName] = {
                    type: "object",
                    properties,
                    required
                };
                return acc;
            }, {})
        }
    };
    const paths = {};
    Object.entries(baseEndpoints.api).forEach(([_, value])=>{
        if (ctx.options.disabledPaths?.includes(value.path)) return;
        const options$1 = value.options;
        if (options$1.metadata?.SERVER_ONLY) return;
        const path = toOpenApiPath(value.path);
        if (options$1.method === "GET" || options$1.method === "DELETE") paths[path] = {
            ...paths[path],
            [options$1.method.toLowerCase()]: {
                tags: [
                    "Default",
                    ...options$1.metadata?.openapi?.tags || []
                ],
                description: options$1.metadata?.openapi?.description,
                operationId: options$1.metadata?.openapi?.operationId,
                security: [
                    {
                        bearerAuth: []
                    }
                ],
                parameters: getParameters(options$1),
                responses: getResponse(options$1.metadata?.openapi?.responses)
            }
        };
        if (options$1.method === "POST" || options$1.method === "PATCH" || options$1.method === "PUT") {
            const body = getRequestBody(options$1);
            paths[path] = {
                ...paths[path],
                [options$1.method.toLowerCase()]: {
                    tags: [
                        "Default",
                        ...options$1.metadata?.openapi?.tags || []
                    ],
                    description: options$1.metadata?.openapi?.description,
                    operationId: options$1.metadata?.openapi?.operationId,
                    security: [
                        {
                            bearerAuth: []
                        }
                    ],
                    parameters: getParameters(options$1),
                    ...body ? {
                        requestBody: body
                    } : {
                        requestBody: {
                            content: {
                                "application/json": {
                                    schema: {
                                        type: "object",
                                        properties: {}
                                    }
                                }
                            }
                        }
                    },
                    responses: getResponse(options$1.metadata?.openapi?.responses)
                }
            };
        }
    });
    for (const plugin of options.plugins || []){
        if (plugin.id === "open-api") continue;
        const pluginEndpoints = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["a"])(ctx, {
            ...options,
            plugins: [
                plugin
            ]
        });
        const api = Object.keys(pluginEndpoints.api).map((key)=>{
            if (baseEndpoints.api[key] === void 0) return pluginEndpoints.api[key];
            return null;
        }).filter((x)=>x !== null);
        Object.entries(api).forEach(([key, value])=>{
            if (ctx.options.disabledPaths?.includes(value.path)) return;
            const options$1 = value.options;
            if (options$1.metadata?.SERVER_ONLY) return;
            const path = toOpenApiPath(value.path);
            if (options$1.method === "GET" || options$1.method === "DELETE") paths[path] = {
                ...paths[path],
                [options$1.method.toLowerCase()]: {
                    tags: options$1.metadata?.openapi?.tags || [
                        plugin.id.charAt(0).toUpperCase() + plugin.id.slice(1)
                    ],
                    description: options$1.metadata?.openapi?.description,
                    operationId: options$1.metadata?.openapi?.operationId,
                    security: [
                        {
                            bearerAuth: []
                        }
                    ],
                    parameters: getParameters(options$1),
                    responses: getResponse(options$1.metadata?.openapi?.responses)
                }
            };
            if (options$1.method === "POST" || options$1.method === "PATCH" || options$1.method === "PUT") paths[path] = {
                ...paths[path],
                [options$1.method.toLowerCase()]: {
                    tags: options$1.metadata?.openapi?.tags || [
                        plugin.id.charAt(0).toUpperCase() + plugin.id.slice(1)
                    ],
                    description: options$1.metadata?.openapi?.description,
                    operationId: options$1.metadata?.openapi?.operationId,
                    security: [
                        {
                            bearerAuth: []
                        }
                    ],
                    parameters: getParameters(options$1),
                    requestBody: getRequestBody(options$1),
                    responses: getResponse(options$1.metadata?.openapi?.responses)
                }
            };
        });
    }
    return {
        openapi: "3.1.1",
        info: {
            title: "Better Auth",
            description: "API Reference for your Better Auth Instance",
            version: "1.1.0"
        },
        components: {
            ...components,
            securitySchemes: {
                apiKeyCookie: {
                    type: "apiKey",
                    in: "cookie",
                    name: "apiKeyCookie",
                    description: "API Key authentication via cookie"
                },
                bearerAuth: {
                    type: "http",
                    scheme: "bearer",
                    description: "Bearer token authentication"
                }
            }
        },
        security: [
            {
                apiKeyCookie: [],
                bearerAuth: []
            }
        ],
        servers: [
            {
                url: ctx.baseURL
            }
        ],
        tags: [
            {
                name: "Default",
                description: "Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin."
            }
        ],
        paths
    };
}
//#endregion
//#region src/plugins/open-api/logo.ts
const logo = `<svg width="75" height="75" viewBox="0 0 75 75" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect width="75" height="75" fill="url(#pattern0_21_12)"/>
<defs>
<pattern id="pattern0_21_12" patternContentUnits="objectBoundingBox" width="1" height="1">
<use xlink:href="#image0_21_12" transform="scale(0.00094697)"/>
</pattern>
<image id="image0_21_12" width="1056" height="1056" xlink:href="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/4QBARXhpZgAATU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAEIKADAAQAAAABAAAEIAAAAAD/7QA4UGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAAA4QklNBCUAAAAAABDUHYzZjwCyBOmACZjs+EJ+/+ICKElDQ19QUk9GSUxFAAEBAAACGGFwcGwEAAAAbW50clJHQiBYWVogB+YAAQABAAAAAAAAYWNzcEFQUEwAAAAAQVBQTAAAAAAAAAAAAAAAAAAAAAAAAPbWAAEAAAAA0y1hcHBs7P2jjjiFR8NttL1PetoYLwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKZGVzYwAAAPwAAAAwY3BydAAAASwAAABQd3RwdAAAAXwAAAAUclhZWgAAAZAAAAAUZ1hZWgAAAaQAAAAUYlhZWgAAAbgAAAAUclRSQwAAAcwAAAAgY2hhZAAAAewAAAAsYlRSQwAAAcwAAAAgZ1RSQwAAAcwAAAAgbWx1YwAAAAAAAAABAAAADGVuVVMAAAAUAAAAHABEAGkAcwBwAGwAYQB5ACAAUAAzbWx1YwAAAAAAAAABAAAADGVuVVMAAAA0AAAAHABDAG8AcAB5AHIAaQBnAGgAdAAgAEEAcABwAGwAZQAgAEkAbgBjAC4ALAAgADIAMAAyADJYWVogAAAAAAAA9tUAAQAAAADTLFhZWiAAAAAAAACD3wAAPb////+7WFlaIAAAAAAAAEq/AACxNwAACrlYWVogAAAAAAAAKDgAABELAADIuXBhcmEAAAAAAAMAAAACZmYAAPKnAAANWQAAE9AAAApbc2YzMgAAAAAAAQxCAAAF3v//8yYAAAeTAAD9kP//+6L///2jAAAD3AAAwG7/wAARCAQgBCADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9sAQwACAgICAgIDAgIDBAMDAwQFBAQEBAUHBQUFBQUHCAcHBwcHBwgICAgICAgICgoKCgoKCwsLCwsNDQ0NDQ0NDQ0N/9sAQwECAgIDAwMGAwMGDQkHCQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0N/90ABABC/9oADAMBAAIRAxEAPwD9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//Q/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9L9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//T/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9b9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9H9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9T9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//V/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Ln/gq38a/in8Dvgp4T8R/CfxFdeG9SvvFMdlcXFoELyW5srqQxnzEcY3op4Gciv1Gr8Z/+C2X/JvXgj/sc4v/AE33lAH4z/8ADwv9tD/oq2tf9823/wAZo/4eF/tof9FW1r/vm2/+M18Z0UAfZn/Dwv8AbQ/6KtrX/fNt/wDGaP8Ah4X+2h/0VbWv++bb/wCM18Z0UAfZn/Dwv9tD/oq2tf8AfNt/8Zo/4eF/tof9FW1r/vm2/wDjNfGdFAH2Z/w8L/bQ/wCira1/3zbf/GaP+Hhf7aH/AEVbWv8Avm2/+M18Z0UAfZn/AA8L/bQ/6KtrX/fNt/8AGaP+Hhf7aH/RVta/75tv/jNfGdFAH2Z/w8L/AG0P+ira1/3zbf8Axmj/AIeF/tof9FW1r/vm2/8AjNfGdFAH63/sVftq/tTfEb9qb4deCfG3xF1TVtD1bVGgvbKdYBHPGIJW2ttiVsblB4I6V/UbX8Z//BPT/k9D4U/9hpv/AEmmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+M/wD4eF/tof8ARVta/wC+bb/4zR/w8L/bQ/6KtrX/AHzbf/Ga+M6KAPsz/h4X+2h/0VbWv++bb/4zR/w8L/bQ/wCira1/3zbf/Ga+M6KAPsz/AIeF/tof9FW1r/vm2/8AjNH/AA8L/bQ/6KtrX/fNt/8AGa+M6KAPsz/h4X+2h/0VbWv++bb/AOM0f8PC/wBtD/oq2tf9823/AMZr4zooA+zP+Hhf7aH/AEVbWv8Avm2/+M0f8PC/20P+ira1/wB823/xmvjOigD7M/4eF/tof9FW1r/vm2/+M0f8PC/20P8Aoq2tf9823/xmvjOigD7M/wCHhf7aH/RVta/75tv/AIzR/wAPC/20P+ira1/3zbf/ABmvjOigD7M/4eF/tof9FW1r/vm2/wDjNH/Dwv8AbQ/6KtrX/fNt/wDGa+M6KAPsz/h4X+2h/wBFW1r/AL5tv/jNH/Dwv9tD/oq2tf8AfNt/8Zr4zooA+zP+Hhf7aH/RVta/75tv/jNH/Dwv9tD/AKKtrX/fNt/8Zr4zooA+zP8Ah4X+2h/0VbWv++bb/wCM0f8ADwv9tD/oq2tf9823/wAZr4zooA+zP+Hhf7aH/RVta/75tv8A4zR/w8L/AG0P+ira1/3zbf8AxmvjOigD7M/4eF/tof8ARVta/wC+bb/4zR/w8L/bQ/6KtrX/AHzbf/Ga+M6KAP6tv+CUnxr+Kfxx+CnizxH8WPEV14k1Kx8UyWVvcXYQPHbiytZBGPLRBje7HkZya/Uavxn/AOCJv/JvXjf/ALHOX/032dfsxQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfxn/APBPT/k9D4U/9hpv/Saav7MKACiiigAooooAKKKKACiiigAooooAKKKKAP4A6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfwq/BT4r638Dvin4d+LHhy0tb7UvDd0bu3t70ObeRzG0eJBGyPjDnowOa/Ub/h9l+0L/ANCR4M/79ah/8m0Af0yUV/M3/wAPsv2hf+hI8Gf9+tQ/+TaP+H2X7Qv/AEJHgz/v1qH/AMm0Af0yUV/M3/w+y/aF/wChI8Gf9+tQ/wDk2j/h9l+0L/0JHgz/AL9ah/8AJtAH9MlFfzN/8Psv2hf+hI8Gf9+tQ/8Ak2j/AIfZftC/9CR4M/79ah/8m0Af0yUV/M3/AMPsv2hf+hI8Gf8AfrUP/k2j/h9l+0L/ANCR4M/79ah/8m0Af0yUV/M3/wAPsv2hf+hI8Gf9+tQ/+TaP+H2X7Qv/AEJHgz/v1qH/AMm0Af0yUV/M3/w+y/aF/wChI8Gf9+tQ/wDk2j/h9l+0L/0JHgz/AL9ah/8AJtAH4z0V/TJ/w5N/Z6/6Hfxn/wB/dP8A/kKj/hyb+z1/0O/jP/v7p/8A8hUAfzN0V/TJ/wAOTf2ev+h38Z/9/dP/APkKj/hyb+z1/wBDv4z/AO/un/8AyFQB/M3RX9Mn/Dk39nr/AKHfxn/390//AOQqP+HJv7PX/Q7+M/8Av7p//wAhUAfzN0V/TJ/w5N/Z6/6Hfxn/AN/dP/8AkKj/AIcm/s9f9Dv4z/7+6f8A/IVAH8zdFf0yf8OTf2ev+h38Z/8Af3T/AP5Co/4cm/s9f9Dv4z/7+6f/APIVAH8zdFf0yf8ADk39nr/od/Gf/f3T/wD5Co/4cm/s9f8AQ7+M/wDv7p//AMhUAfzN0V/TJ/w5N/Z6/wCh38Z/9/dP/wDkKvwV/ag+FGifA74++M/hP4cu7q+03w3fi0t7i9KG4kQxRyZkMaomcueigYoA8FooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/AOxzl/8ATfZ1+zFfjP8A8ETf+TevG/8A2Ocv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/v8ooooAKKKKACiiigAooooAKKKKACiiigAr+M//goX/wAnofFb/sNL/wCk0Nf2YV/Gf/wUL/5PQ+K3/YaX/wBJoaAPjOiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP7/KKKKACiiigAooooAKKKKACiiigAooooAK/jP/4KF/8AJ6HxW/7DS/8ApNDX9mFfxn/8FC/+T0Pit/2Gl/8ASaGgD4zooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+/yiiigAooooAKKKKACiiigAooooAKKKKACv4z/+Chf/ACeh8Vv+w0v/AKTQ1/ZhX8Z//BQv/k9D4rf9hpf/AEmhoA+M6KKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/v8ooooAKKKKACiiigAooooAKKKKACiiigAr+M//goX/wAnofFb/sNL/wCk0Nf2YV/Gf/wUL/5PQ+K3/YaX/wBJoaAPjOiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP7/KKKKACiiigAooooAKKKKACiiigAooooAK/jP/4KF/8AJ6HxW/7DS/8ApNDX9mFfxn/8FC/+T0Pit/2Gl/8ASaGgD4zooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+/yiiigAooooAKKKKACiiigAooooAKKKKACv4z/+Chf/ACeh8Vv+w0v/AKTQ1/ZhX8Z//BQv/k9D4rf9hpf/AEmhoA+M6KKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD1L4KfCjW/jj8U/Dvwn8OXdrY6l4kujaW9xelxbxuI2kzIY1d8YQ9FJzX6jf8OTf2hf8Aod/Bn/f3UP8A5Cr4z/4J6f8AJ6Hwp/7DTf8ApNNX9mFAH8zf/Dk39oX/AKHfwZ/391D/AOQqP+HJv7Qv/Q7+DP8Av7qH/wAhV/TJRQB/M3/w5N/aF/6HfwZ/391D/wCQqP8Ahyb+0L/0O/gz/v7qH/yFX9MlFAH8zf8Aw5N/aF/6HfwZ/wB/dQ/+QqP+HJv7Qv8A0O/gz/v7qH/yFX9MlFAH8zf/AA5N/aF/6HfwZ/391D/5Co/4cm/tC/8AQ7+DP+/uof8AyFX9MlFAH8zf/Dk39oX/AKHfwZ/391D/AOQqP+HJv7Qv/Q7+DP8Av7qH/wAhV/TJRQB/M3/w5N/aF/6HfwZ/391D/wCQqP8Ahyb+0L/0O/gz/v7qH/yFX9MlFAH4z/8AD7L9nr/oSPGf/frT/wD5No/4fZfs9f8AQkeM/wDv1p//AMm1/M3RQB/TJ/w+y/Z6/wChI8Z/9+tP/wDk2j/h9l+z1/0JHjP/AL9af/8AJtfzN0UAf0yf8Psv2ev+hI8Z/wDfrT//AJNo/wCH2X7PX/QkeM/+/Wn/APybX8zdFAH9Mn/D7L9nr/oSPGf/AH60/wD+TaP+H2X7PX/QkeM/+/Wn/wDybX8zdFAH9Mn/AA+y/Z6/6Ejxn/360/8A+TaP+H2X7PX/AEJHjP8A79af/wDJtfzN0UAf0yf8Psv2ev8AoSPGf/frT/8A5No/4fZfs9f9CR4z/wC/Wn//ACbX8zdFAH9Mn/D7L9nr/oSPGf8A360//wCTa/BX9qD4r6J8cfj74z+LHhy0urHTfEl+Lu3t70ILiNBFHHiQRs6Zyh6MRivBaKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/ACb143/7HOX/ANN9nX7MV+M//BE3/k3rxv8A9jnL/wCm+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfxn/APBPT/k9D4U/9hpv/Saav7MKACiiigAooooAKKKKACiiigAooooAKKKKAP4A6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+XP/BVv4KfFP44/BTwn4c+E/h268SalY+KY724t7QoHjtxZXUZkPmOgxvdRwc5NAH8pNFfZn/DvT9tD/olOtf99W3/AMeo/wCHen7aH/RKda/76tv/AI9QB8Z0V9mf8O9P20P+iU61/wB9W3/x6j/h3p+2h/0SnWv++rb/AOPUAfGdFfZn/DvT9tD/AKJTrX/fVt/8eo/4d6ftof8ARKda/wC+rb/49QB8Z0V9mf8ADvT9tD/olOtf99W3/wAeo/4d6ftof9Ep1r/vq2/+PUAfGdFfZn/DvT9tD/olOtf99W3/AMeo/wCHen7aH/RKda/76tv/AI9QB8Z0V9mf8O9P20P+iU61/wB9W3/x6j/h3p+2h/0SnWv++rb/AOPUAH/BPT/k9D4U/wDYab/0mmr+zCv5cv2Kv2Kv2pvhz+1N8OvG3jb4dappOh6TqjT3t7O0BjgjMEq7m2ys2NzAcA9a/qNoAKKKKACiiigAooooAKKKKACiiigAooooA/gDor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD9mP+CJv/JvXjf8A7HOX/wBN9nX7MV+XP/BKT4KfFP4HfBTxZ4c+LHh268N6lfeKZL23t7soXktzZWsYkHlu4xvRhyc5FfqNQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf/9L9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//T/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9b9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9H9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9T9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//V/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9f9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//Q/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/2Q=="/>
</defs>
</svg>
`;
//#endregion
//#region src/plugins/open-api/index.ts
const getHTML = (apiReference, theme, nonce)=>{
    const nonceAttr = nonce ? `nonce="${nonce}"` : "";
    return `<!doctype html>
<html>
  <head>
    <title>Scalar API Reference</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <script
      id="api-reference"
      type="application/json">
    ${JSON.stringify(apiReference)}
    <\/script>
	 <script ${nonceAttr}>
      var configuration = {
	  	favicon: "data:image/svg+xml;utf8,${encodeURIComponent(logo)}",
	   	theme: "${theme || "default"}",
        metaData: {
			title: "Better Auth API",
			description: "API Reference for your Better Auth Instance",
		}
      }

      document.getElementById('api-reference').dataset.configuration =
        JSON.stringify(configuration)
    <\/script>
	  <script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference" ${nonceAttr}><\/script>
  </body>
</html>`;
};
const openAPI = (options)=>{
    const path = options?.path ?? "/reference";
    return {
        id: "open-api",
        endpoints: {
            generateOpenAPISchema: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/open-api/generate-schema", {
                method: "GET"
            }, async (ctx)=>{
                const schema = await generator(ctx.context, ctx.context.options);
                return ctx.json(schema);
            }),
            openAPIReference: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])(path, {
                method: "GET",
                metadata: {
                    isAction: false
                }
            }, async (ctx)=>{
                if (options?.disableDefaultReference) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("NOT_FOUND");
                const schema = await generator(ctx.context, ctx.context.options);
                return new Response(getHTML(schema, options?.theme, options?.nonce), {
                    headers: {
                        "Content-Type": "text/html"
                    }
                });
            })
        }
    };
};
;
}),
"[project]/node_modules/better-auth/dist/phone-number-wU9XYnr8.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>phoneNumber
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/crypto-CFUhAR9W.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/schema-Bb7wzeK_.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/session-AaRl3_x-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error-BhAKg8LX.mjs [app-route] (ecmascript) <export n as BASE_ERROR_CODES>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils-C5EN75oV.mjs [app-route] (ecmascript) <export t as defineErrorCodes>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
//#region src/plugins/phone-number/error-codes.ts
const PHONE_NUMBER_ERROR_CODES = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__["defineErrorCodes"])({
    INVALID_PHONE_NUMBER: "Invalid phone number",
    PHONE_NUMBER_EXIST: "Phone number already exists",
    PHONE_NUMBER_NOT_EXIST: "phone number isn't registered",
    INVALID_PHONE_NUMBER_OR_PASSWORD: "Invalid phone number or password",
    UNEXPECTED_ERROR: "Unexpected error",
    OTP_NOT_FOUND: "OTP not found",
    OTP_EXPIRED: "OTP expired",
    INVALID_OTP: "Invalid OTP",
    PHONE_NUMBER_NOT_VERIFIED: "Phone number not verified",
    PHONE_NUMBER_CANNOT_BE_UPDATED: "Phone number cannot be updated",
    SEND_OTP_NOT_IMPLEMENTED: "sendOTP not implemented",
    TOO_MANY_ATTEMPTS: "Too many attempts"
});
//#endregion
//#region src/plugins/phone-number/schema.ts
const schema = {
    user: {
        fields: {
            phoneNumber: {
                type: "string",
                required: false,
                unique: true,
                sortable: true,
                returned: true
            },
            phoneNumberVerified: {
                type: "boolean",
                required: false,
                returned: true,
                input: false
            }
        }
    }
};
//#endregion
//#region src/plugins/phone-number/index.ts
function generateOTP(size) {
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(size, "0-9");
}
const phoneNumber = (options)=>{
    const opts = {
        expiresIn: options?.expiresIn || 300,
        otpLength: options?.otpLength || 6,
        ...options,
        phoneNumber: "phoneNumber",
        phoneNumberVerified: "phoneNumberVerified",
        code: "code",
        createdAt: "createdAt"
    };
    return {
        id: "phone-number",
        hooks: {
            before: [
                {
                    matcher: (ctx)=>ctx.path === "/update-user" && "phoneNumber" in ctx.body,
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (_ctx)=>{
                        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                            message: PHONE_NUMBER_ERROR_CODES.PHONE_NUMBER_CANNOT_BE_UPDATED
                        });
                    })
                }
            ]
        },
        endpoints: {
            signInPhoneNumber: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/sign-in/phone-number", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    phoneNumber: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "Phone number to sign in. Eg: \"+1234567890\""
                    }),
                    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "Password to use for sign in."
                    }),
                    rememberMe: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().meta({
                        description: "Remember the session. Eg: true"
                    }).optional()
                }),
                metadata: {
                    openapi: {
                        summary: "Sign in with phone number",
                        description: "Use this endpoint to sign in with phone number",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                },
                                                session: {
                                                    $ref: "#/components/schemas/Session"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            400: {
                                description: "Invalid phone number or password"
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const { password, phoneNumber: phoneNumber$1 } = ctx.body;
                if (opts.phoneNumberValidator) {
                    if (!await opts.phoneNumberValidator(ctx.body.phoneNumber)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        message: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER
                    });
                }
                const user = await ctx.context.adapter.findOne({
                    model: "user",
                    where: [
                        {
                            field: "phoneNumber",
                            value: phoneNumber$1
                        }
                    ]
                });
                if (!user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER_OR_PASSWORD
                });
                if (opts.requireVerification) {
                    if (!user.phoneNumberVerified) {
                        const otp = generateOTP(opts.otpLength);
                        await ctx.context.internalAdapter.createVerificationValue({
                            value: otp,
                            identifier: phoneNumber$1,
                            expiresAt: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(opts.expiresIn, "sec")
                        });
                        await opts.sendOTP?.({
                            phoneNumber: phoneNumber$1,
                            code: otp
                        }, ctx);
                        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                            message: PHONE_NUMBER_ERROR_CODES.PHONE_NUMBER_NOT_VERIFIED
                        });
                    }
                }
                const credentialAccount = (await ctx.context.internalAdapter.findAccountByUserId(user.id)).find((a)=>a.providerId === "credential");
                if (!credentialAccount) {
                    ctx.context.logger.error("Credential account not found", {
                        phoneNumber: phoneNumber$1
                    });
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                        message: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER_OR_PASSWORD
                    });
                }
                const currentPassword = credentialAccount?.password;
                if (!currentPassword) {
                    ctx.context.logger.error("Password not found", {
                        phoneNumber: phoneNumber$1
                    });
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                        message: PHONE_NUMBER_ERROR_CODES.UNEXPECTED_ERROR
                    });
                }
                if (!await ctx.context.password.verify({
                    hash: currentPassword,
                    password
                })) {
                    ctx.context.logger.error("Invalid password");
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                        message: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER_OR_PASSWORD
                    });
                }
                const session = await ctx.context.internalAdapter.createSession(user.id, ctx.body.rememberMe === false);
                if (!session) {
                    ctx.context.logger.error("Failed to create session");
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                        message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].FAILED_TO_CREATE_SESSION
                    });
                }
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, {
                    session,
                    user
                }, ctx.body.rememberMe === false);
                return ctx.json({
                    token: session.token,
                    user: {
                        id: user.id,
                        email: user.email,
                        emailVerified: user.emailVerified,
                        name: user.name,
                        image: user.image,
                        phoneNumber: user.phoneNumber,
                        phoneNumberVerified: user.phoneNumberVerified,
                        createdAt: user.createdAt,
                        updatedAt: user.updatedAt
                    }
                });
            }),
            sendPhoneNumberOTP: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/phone-number/send-otp", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    phoneNumber: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "Phone number to send OTP. Eg: \"+1234567890\""
                    })
                }),
                metadata: {
                    openapi: {
                        summary: "Send OTP to phone number",
                        description: "Use this endpoint to send OTP to phone number",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                message: {
                                                    type: "string"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                if (!options?.sendOTP) {
                    ctx.context.logger.warn("sendOTP not implemented");
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("NOT_IMPLEMENTED", {
                        message: PHONE_NUMBER_ERROR_CODES.SEND_OTP_NOT_IMPLEMENTED
                    });
                }
                if (opts.phoneNumberValidator) {
                    if (!await opts.phoneNumberValidator(ctx.body.phoneNumber)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        message: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER
                    });
                }
                const code = generateOTP(opts.otpLength);
                await ctx.context.internalAdapter.createVerificationValue({
                    value: `${code}:0`,
                    identifier: ctx.body.phoneNumber,
                    expiresAt: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(opts.expiresIn, "sec")
                });
                await options.sendOTP({
                    phoneNumber: ctx.body.phoneNumber,
                    code
                }, ctx);
                return ctx.json({
                    message: "code sent"
                });
            }),
            verifyPhoneNumber: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/phone-number/verify", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    phoneNumber: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "Phone number to verify. Eg: \"+1234567890\""
                    }),
                    code: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "OTP code. Eg: \"123456\""
                    }),
                    disableSession: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().meta({
                        description: "Disable session creation after verification. Eg: false"
                    }).optional(),
                    updatePhoneNumber: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().meta({
                        description: "Check if there is a session and update the phone number. Eg: true"
                    }).optional()
                }),
                metadata: {
                    openapi: {
                        summary: "Verify phone number",
                        description: "Use this endpoint to verify phone number",
                        responses: {
                            "200": {
                                description: "Phone number verified successfully",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                status: {
                                                    type: "boolean",
                                                    description: "Indicates if the verification was successful",
                                                    enum: [
                                                        true
                                                    ]
                                                },
                                                token: {
                                                    type: "string",
                                                    nullable: true,
                                                    description: "Session token if session is created, null if disableSession is true or no session is created"
                                                },
                                                user: {
                                                    type: "object",
                                                    nullable: true,
                                                    properties: {
                                                        id: {
                                                            type: "string",
                                                            description: "Unique identifier of the user"
                                                        },
                                                        email: {
                                                            type: "string",
                                                            format: "email",
                                                            nullable: true,
                                                            description: "User's email address"
                                                        },
                                                        emailVerified: {
                                                            type: "boolean",
                                                            nullable: true,
                                                            description: "Whether the email is verified"
                                                        },
                                                        name: {
                                                            type: "string",
                                                            nullable: true,
                                                            description: "User's name"
                                                        },
                                                        image: {
                                                            type: "string",
                                                            format: "uri",
                                                            nullable: true,
                                                            description: "User's profile image URL"
                                                        },
                                                        phoneNumber: {
                                                            type: "string",
                                                            description: "User's phone number"
                                                        },
                                                        phoneNumberVerified: {
                                                            type: "boolean",
                                                            description: "Whether the phone number is verified"
                                                        },
                                                        createdAt: {
                                                            type: "string",
                                                            format: "date-time",
                                                            description: "Timestamp when the user was created"
                                                        },
                                                        updatedAt: {
                                                            type: "string",
                                                            format: "date-time",
                                                            description: "Timestamp when the user was last updated"
                                                        }
                                                    },
                                                    required: [
                                                        "id",
                                                        "phoneNumber",
                                                        "phoneNumberVerified",
                                                        "createdAt",
                                                        "updatedAt"
                                                    ],
                                                    description: "User object with phone number details, null if no user is created or found"
                                                }
                                            },
                                            required: [
                                                "status"
                                            ]
                                        }
                                    }
                                }
                            },
                            400: {
                                description: "Invalid OTP"
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                if (options?.verifyOTP) {
                    if (!await options.verifyOTP({
                        phoneNumber: ctx.body.phoneNumber,
                        code: ctx.body.code
                    }, ctx)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        message: PHONE_NUMBER_ERROR_CODES.INVALID_OTP
                    });
                    const otp = await ctx.context.internalAdapter.findVerificationValue(ctx.body.phoneNumber);
                    if (otp) await ctx.context.internalAdapter.deleteVerificationValue(otp.id);
                } else {
                    const otp = await ctx.context.internalAdapter.findVerificationValue(ctx.body.phoneNumber);
                    if (!otp || otp.expiresAt < /* @__PURE__ */ new Date()) {
                        if (otp && otp.expiresAt < /* @__PURE__ */ new Date()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                            message: PHONE_NUMBER_ERROR_CODES.OTP_EXPIRED
                        });
                        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                            message: PHONE_NUMBER_ERROR_CODES.OTP_NOT_FOUND
                        });
                    }
                    const [otpValue, attempts] = otp.value.split(":");
                    const allowedAttempts = options?.allowedAttempts || 3;
                    if (attempts && parseInt(attempts) >= allowedAttempts) {
                        await ctx.context.internalAdapter.deleteVerificationValue(otp.id);
                        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                            message: PHONE_NUMBER_ERROR_CODES.TOO_MANY_ATTEMPTS
                        });
                    }
                    if (otpValue !== ctx.body.code) {
                        await ctx.context.internalAdapter.updateVerificationValue(otp.id, {
                            value: `${otpValue}:${parseInt(attempts || "0") + 1}`
                        });
                        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                            message: PHONE_NUMBER_ERROR_CODES.INVALID_OTP
                        });
                    }
                    await ctx.context.internalAdapter.deleteVerificationValue(otp.id);
                }
                if (ctx.body.updatePhoneNumber) {
                    const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(ctx);
                    if (!session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                        message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].USER_NOT_FOUND
                    });
                    if ((await ctx.context.adapter.findMany({
                        model: "user",
                        where: [
                            {
                                field: "phoneNumber",
                                value: ctx.body.phoneNumber
                            }
                        ]
                    })).length) throw ctx.error("BAD_REQUEST", {
                        message: PHONE_NUMBER_ERROR_CODES.PHONE_NUMBER_EXIST
                    });
                    let user$1 = await ctx.context.internalAdapter.updateUser(session.user.id, {
                        [opts.phoneNumber]: ctx.body.phoneNumber,
                        [opts.phoneNumberVerified]: true
                    });
                    return ctx.json({
                        status: true,
                        token: session.session.token,
                        user: {
                            id: user$1.id,
                            email: user$1.email,
                            emailVerified: user$1.emailVerified,
                            name: user$1.name,
                            image: user$1.image,
                            phoneNumber: user$1.phoneNumber,
                            phoneNumberVerified: user$1.phoneNumberVerified,
                            createdAt: user$1.createdAt,
                            updatedAt: user$1.updatedAt
                        }
                    });
                }
                let user = await ctx.context.adapter.findOne({
                    model: "user",
                    where: [
                        {
                            value: ctx.body.phoneNumber,
                            field: opts.phoneNumber
                        }
                    ]
                });
                if (!user) {
                    if (options?.signUpOnVerification) {
                        user = await ctx.context.internalAdapter.createUser({
                            email: options.signUpOnVerification.getTempEmail(ctx.body.phoneNumber),
                            name: options.signUpOnVerification.getTempName ? options.signUpOnVerification.getTempName(ctx.body.phoneNumber) : ctx.body.phoneNumber,
                            [opts.phoneNumber]: ctx.body.phoneNumber,
                            [opts.phoneNumberVerified]: true
                        });
                        if (!user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].FAILED_TO_CREATE_USER
                        });
                    }
                } else user = await ctx.context.internalAdapter.updateUser(user.id, {
                    [opts.phoneNumberVerified]: true
                });
                if (!user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].FAILED_TO_UPDATE_USER
                });
                await options?.callbackOnVerification?.({
                    phoneNumber: ctx.body.phoneNumber,
                    user
                }, ctx);
                if (!ctx.body.disableSession) {
                    const session = await ctx.context.internalAdapter.createSession(user.id);
                    if (!session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                        message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].FAILED_TO_CREATE_SESSION
                    });
                    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, {
                        session,
                        user
                    });
                    return ctx.json({
                        status: true,
                        token: session.token,
                        user: {
                            id: user.id,
                            email: user.email,
                            emailVerified: user.emailVerified,
                            name: user.name,
                            image: user.image,
                            phoneNumber: user.phoneNumber,
                            phoneNumberVerified: user.phoneNumberVerified,
                            createdAt: user.createdAt,
                            updatedAt: user.updatedAt
                        }
                    });
                }
                return ctx.json({
                    status: true,
                    token: null,
                    user: {
                        id: user.id,
                        email: user.email,
                        emailVerified: user.emailVerified,
                        name: user.name,
                        image: user.image,
                        phoneNumber: user.phoneNumber,
                        phoneNumberVerified: user.phoneNumberVerified,
                        createdAt: user.createdAt,
                        updatedAt: user.updatedAt
                    }
                });
            }),
            requestPasswordResetPhoneNumber: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/phone-number/request-password-reset", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    phoneNumber: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]()
                }),
                metadata: {
                    openapi: {
                        description: "Request OTP for password reset via phone number",
                        responses: {
                            "200": {
                                description: "OTP sent successfully for password reset",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                status: {
                                                    type: "boolean",
                                                    description: "Indicates if the OTP was sent successfully",
                                                    enum: [
                                                        true
                                                    ]
                                                }
                                            },
                                            required: [
                                                "status"
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                if (!await ctx.context.adapter.findOne({
                    model: "user",
                    where: [
                        {
                            value: ctx.body.phoneNumber,
                            field: opts.phoneNumber
                        }
                    ]
                })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: PHONE_NUMBER_ERROR_CODES.PHONE_NUMBER_NOT_EXIST
                });
                const code = generateOTP(opts.otpLength);
                await ctx.context.internalAdapter.createVerificationValue({
                    value: `${code}:0`,
                    identifier: `${ctx.body.phoneNumber}-request-password-reset`,
                    expiresAt: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(opts.expiresIn, "sec")
                });
                await options?.sendPasswordResetOTP?.({
                    phoneNumber: ctx.body.phoneNumber,
                    code
                }, ctx);
                return ctx.json({
                    status: true
                });
            }),
            resetPasswordPhoneNumber: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/phone-number/reset-password", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    otp: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The one time password to reset the password. Eg: \"123456\""
                    }),
                    phoneNumber: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The phone number to the account which intends to reset the password for. Eg: \"+1234567890\""
                    }),
                    newPassword: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: `The new password. Eg: "new-and-secure-password"`
                    })
                }),
                metadata: {
                    openapi: {
                        description: "Reset password using phone number OTP",
                        responses: {
                            "200": {
                                description: "Password reset successfully",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                status: {
                                                    type: "boolean",
                                                    description: "Indicates if the password was reset successfully",
                                                    enum: [
                                                        true
                                                    ]
                                                }
                                            },
                                            required: [
                                                "status"
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const verification = await ctx.context.internalAdapter.findVerificationValue(`${ctx.body.phoneNumber}-request-password-reset`);
                if (!verification) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: PHONE_NUMBER_ERROR_CODES.OTP_NOT_FOUND
                });
                if (verification.expiresAt < /* @__PURE__ */ new Date()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: PHONE_NUMBER_ERROR_CODES.OTP_EXPIRED
                });
                const [otpValue, attempts] = verification.value.split(":");
                const allowedAttempts = options?.allowedAttempts || 3;
                if (attempts && parseInt(attempts) >= allowedAttempts) {
                    await ctx.context.internalAdapter.deleteVerificationValue(verification.id);
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                        message: PHONE_NUMBER_ERROR_CODES.TOO_MANY_ATTEMPTS
                    });
                }
                if (ctx.body.otp !== otpValue) {
                    await ctx.context.internalAdapter.updateVerificationValue(verification.id, {
                        value: `${otpValue}:${parseInt(attempts || "0") + 1}`
                    });
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        message: PHONE_NUMBER_ERROR_CODES.INVALID_OTP
                    });
                }
                const user = await ctx.context.adapter.findOne({
                    model: "user",
                    where: [
                        {
                            field: "phoneNumber",
                            value: ctx.body.phoneNumber
                        }
                    ]
                });
                if (!user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: PHONE_NUMBER_ERROR_CODES.UNEXPECTED_ERROR
                });
                const hashedPassword = await ctx.context.password.hash(ctx.body.newPassword);
                await ctx.context.internalAdapter.updatePassword(user.id, hashedPassword);
                await ctx.context.internalAdapter.deleteVerificationValue(verification.id);
                return ctx.json({
                    status: true
                });
            })
        },
        schema: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(schema, options?.schema),
        rateLimit: [
            {
                pathMatcher (path) {
                    return path.startsWith("/phone-number");
                },
                window: 60 * 1e3,
                max: 10
            }
        ],
        $ERROR_CODES: PHONE_NUMBER_ERROR_CODES
    };
};
;
}),
"[project]/node_modules/better-auth/dist/siwe-D81Y4fkp.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "t",
    ()=>siwe
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/schema-Bb7wzeK_.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$url$2d$CB8xCwz$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/url-CB8xCwz-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api-CkmycQ2x.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript) <export APIError as t>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$hashes$2f$utils$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@noble/hashes/utils.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$hashes$2f$sha3$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@noble/hashes/sha3.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
//#region src/utils/hashing.ts
/**
* TS implementation of ERC-55 ("Mixed-case checksum address encoding") using @noble/hashes
* @param address - The address to convert to a checksum address
* @returns The checksummed address
*/ function toChecksumAddress(address) {
    address = address.toLowerCase().replace("0x", "");
    const hash = [
        ...(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$hashes$2f$sha3$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["keccak_256"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$hashes$2f$utils$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["utf8ToBytes"])(address))
    ].map((v)=>v.toString(16).padStart(2, "0")).join("");
    let ret = "0x";
    for(let i = 0; i < 40; i++)if (parseInt(hash[i], 16) >= 8) ret += address[i].toUpperCase();
    else ret += address[i];
    return ret;
}
//#endregion
//#region src/plugins/siwe/schema.ts
const schema = {
    walletAddress: {
        fields: {
            userId: {
                type: "string",
                references: {
                    model: "user",
                    field: "id"
                },
                required: true,
                index: true
            },
            address: {
                type: "string",
                required: true
            },
            chainId: {
                type: "number",
                required: true
            },
            isPrimary: {
                type: "boolean",
                defaultValue: false
            },
            createdAt: {
                type: "date",
                required: true
            }
        }
    }
};
//#endregion
//#region src/plugins/siwe/index.ts
const siwe = (options)=>({
        id: "siwe",
        schema: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(schema, options?.schema),
        endpoints: {
            getSiweNonce: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/siwe/nonce", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    walletAddress: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().regex(/^0[xX][a-fA-F0-9]{40}$/i).length(42),
                    chainId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]().int().positive().max(2147483647).optional().default(1)
                })
            }, async (ctx)=>{
                const { walletAddress: rawWalletAddress, chainId } = ctx.body;
                const walletAddress = toChecksumAddress(rawWalletAddress);
                const nonce = await options.getNonce();
                await ctx.context.internalAdapter.createVerificationValue({
                    identifier: `siwe:${walletAddress}:${chainId}`,
                    value: nonce,
                    expiresAt: new Date(Date.now() + 900 * 1e3)
                });
                return ctx.json({
                    nonce
                });
            }),
            verifySiweMessage: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/siwe/verify", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().min(1),
                    signature: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().min(1),
                    walletAddress: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().regex(/^0[xX][a-fA-F0-9]{40}$/i).length(42),
                    chainId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]().int().positive().max(2147483647).optional().default(1),
                    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["email"]().optional()
                }).refine((data)=>options.anonymous !== false || !!data.email, {
                    message: "Email is required when the anonymous plugin option is disabled.",
                    path: [
                        "email"
                    ]
                }),
                requireRequest: true
            }, async (ctx)=>{
                const { message, signature, walletAddress: rawWalletAddress, chainId, email } = ctx.body;
                const walletAddress = toChecksumAddress(rawWalletAddress);
                const isAnon = options.anonymous ?? true;
                if (!isAnon && !email) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("BAD_REQUEST", {
                    message: "Email is required when anonymous is disabled.",
                    status: 400
                });
                try {
                    const verification = await ctx.context.internalAdapter.findVerificationValue(`siwe:${walletAddress}:${chainId}`);
                    if (!verification || /* @__PURE__ */ new Date() > verification.expiresAt) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                        message: "Unauthorized: Invalid or expired nonce",
                        status: 401,
                        code: "UNAUTHORIZED_INVALID_OR_EXPIRED_NONCE"
                    });
                    const { value: nonce } = verification;
                    if (!await options.verifyMessage({
                        message,
                        signature,
                        address: walletAddress,
                        chainId,
                        cacao: {
                            h: {
                                t: "caip122"
                            },
                            p: {
                                domain: options.domain,
                                aud: options.domain,
                                nonce,
                                iss: options.domain,
                                version: "1"
                            },
                            s: {
                                t: "eip191",
                                s: signature
                            }
                        }
                    })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                        message: "Unauthorized: Invalid SIWE signature",
                        status: 401
                    });
                    await ctx.context.internalAdapter.deleteVerificationValue(verification.id);
                    let user = null;
                    const existingWalletAddress = await ctx.context.adapter.findOne({
                        model: "walletAddress",
                        where: [
                            {
                                field: "address",
                                operator: "eq",
                                value: walletAddress
                            },
                            {
                                field: "chainId",
                                operator: "eq",
                                value: chainId
                            }
                        ]
                    });
                    if (existingWalletAddress) user = await ctx.context.adapter.findOne({
                        model: "user",
                        where: [
                            {
                                field: "id",
                                operator: "eq",
                                value: existingWalletAddress.userId
                            }
                        ]
                    });
                    else {
                        const anyWalletAddress = await ctx.context.adapter.findOne({
                            model: "walletAddress",
                            where: [
                                {
                                    field: "address",
                                    operator: "eq",
                                    value: walletAddress
                                }
                            ]
                        });
                        if (anyWalletAddress) user = await ctx.context.adapter.findOne({
                            model: "user",
                            where: [
                                {
                                    field: "id",
                                    operator: "eq",
                                    value: anyWalletAddress.userId
                                }
                            ]
                        });
                    }
                    if (!user) {
                        const domain = options.emailDomainName ?? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$url$2d$CB8xCwz$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(ctx.context.baseURL);
                        const userEmail = !isAnon && email ? email : `${walletAddress}@${domain}`;
                        const { name, avatar } = await options.ensLookup?.({
                            walletAddress
                        }) ?? {};
                        user = await ctx.context.internalAdapter.createUser({
                            name: name ?? walletAddress,
                            email: userEmail,
                            image: avatar ?? ""
                        });
                        await ctx.context.adapter.create({
                            model: "walletAddress",
                            data: {
                                userId: user.id,
                                address: walletAddress,
                                chainId,
                                isPrimary: true,
                                createdAt: /* @__PURE__ */ new Date()
                            }
                        });
                        await ctx.context.internalAdapter.createAccount({
                            userId: user.id,
                            providerId: "siwe",
                            accountId: `${walletAddress}:${chainId}`,
                            createdAt: /* @__PURE__ */ new Date(),
                            updatedAt: /* @__PURE__ */ new Date()
                        });
                    } else if (!existingWalletAddress) {
                        await ctx.context.adapter.create({
                            model: "walletAddress",
                            data: {
                                userId: user.id,
                                address: walletAddress,
                                chainId,
                                isPrimary: false,
                                createdAt: /* @__PURE__ */ new Date()
                            }
                        });
                        await ctx.context.internalAdapter.createAccount({
                            userId: user.id,
                            providerId: "siwe",
                            accountId: `${walletAddress}:${chainId}`,
                            createdAt: /* @__PURE__ */ new Date(),
                            updatedAt: /* @__PURE__ */ new Date()
                        });
                    }
                    const session = await ctx.context.internalAdapter.createSession(user.id);
                    if (!session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("INTERNAL_SERVER_ERROR", {
                        message: "Internal Server Error",
                        status: 500
                    });
                    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, {
                        session,
                        user
                    });
                    return ctx.json({
                        token: session.token,
                        success: true,
                        user: {
                            id: user.id,
                            walletAddress,
                            chainId
                        }
                    });
                } catch (error) {
                    if (error instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]) throw error;
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__APIError__as__t$3e$__["t"]("UNAUTHORIZED", {
                        message: "Something went wrong. Please try again later.",
                        error: error instanceof Error ? error.message : "Unknown error",
                        status: 401
                    });
                }
            })
        }
    });
;
}),
"[project]/node_modules/better-auth/dist/two-factor-BDQvVILL.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "n",
    ()=>TWO_FACTOR_ERROR_CODES,
    "t",
    ()=>twoFactor
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/crypto-CFUhAR9W.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/schema-Bb7wzeK_.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/json-CnHxKYpj.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/session-AaRl3_x-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$password$2d$BFQK0cLg$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/password-BFQK0cLg.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error-BhAKg8LX.mjs [app-route] (ecmascript) <export n as BASE_ERROR_CODES>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils-C5EN75oV.mjs [app-route] (ecmascript) <export t as defineErrorCodes>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/external.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/hash.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/base64.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/hmac.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$otp$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/otp.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
//#region src/plugins/two-factor/error-code.ts
const TWO_FACTOR_ERROR_CODES = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__["defineErrorCodes"])({
    OTP_NOT_ENABLED: "OTP not enabled",
    OTP_HAS_EXPIRED: "OTP has expired",
    TOTP_NOT_ENABLED: "TOTP not enabled",
    TWO_FACTOR_NOT_ENABLED: "Two factor isn't enabled",
    BACKUP_CODES_NOT_ENABLED: "Backup codes aren't enabled",
    INVALID_BACKUP_CODE: "Invalid backup code",
    INVALID_CODE: "Invalid code",
    TOO_MANY_ATTEMPTS_REQUEST_NEW_CODE: "Too many attempts. Please request a new code.",
    INVALID_TWO_FACTOR_COOKIE: "Invalid two factor cookie"
});
//#endregion
//#region src/plugins/two-factor/constant.ts
const TWO_FACTOR_COOKIE_NAME = "two_factor";
const TRUST_DEVICE_COOKIE_NAME = "trust_device";
const TRUST_DEVICE_COOKIE_MAX_AGE = 720 * 60 * 60;
//#endregion
//#region src/plugins/two-factor/verify-two-factor.ts
async function verifyTwoFactor(ctx) {
    const invalid = (errorKey)=>{
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: TWO_FACTOR_ERROR_CODES[errorKey]
        });
    };
    const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(ctx);
    if (!session) {
        const cookieName = ctx.context.createAuthCookie(TWO_FACTOR_COOKIE_NAME);
        const twoFactorCookie = await ctx.getSignedCookie(cookieName.name, ctx.context.secret);
        if (!twoFactorCookie) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: TWO_FACTOR_ERROR_CODES.INVALID_TWO_FACTOR_COOKIE
        });
        const verificationToken = await ctx.context.internalAdapter.findVerificationValue(twoFactorCookie);
        if (!verificationToken) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: TWO_FACTOR_ERROR_CODES.INVALID_TWO_FACTOR_COOKIE
        });
        const user = await ctx.context.internalAdapter.findUserById(verificationToken.value);
        if (!user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: TWO_FACTOR_ERROR_CODES.INVALID_TWO_FACTOR_COOKIE
        });
        const dontRememberMe = await ctx.getSignedCookie(ctx.context.authCookies.dontRememberToken.name, ctx.context.secret);
        return {
            valid: async (ctx$1)=>{
                const session$1 = await ctx$1.context.internalAdapter.createSession(verificationToken.value, !!dontRememberMe);
                if (!session$1) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                    message: "failed to create session"
                });
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx$1, {
                    session: session$1,
                    user
                });
                if (ctx$1.body.trustDevice) {
                    const trustDeviceCookie = ctx$1.context.createAuthCookie(TRUST_DEVICE_COOKIE_NAME, {
                        maxAge: TRUST_DEVICE_COOKIE_MAX_AGE
                    });
                    /**
					* create a token that will be used to
					* verify the device
					*/ const token = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createHMAC"])("SHA-256", "base64urlnopad").sign(ctx$1.context.secret, `${user.id}!${session$1.token}`);
                    await ctx$1.setSignedCookie(trustDeviceCookie.name, `${token}!${session$1.token}`, ctx$1.context.secret, trustDeviceCookie.attributes);
                    ctx$1.setCookie(ctx$1.context.authCookies.dontRememberToken.name, "", {
                        maxAge: 0
                    });
                    ctx$1.setCookie(cookieName.name, "", {
                        maxAge: 0
                    });
                }
                return ctx$1.json({
                    token: session$1.token,
                    user: {
                        id: user.id,
                        email: user.email,
                        emailVerified: user.emailVerified,
                        name: user.name,
                        image: user.image,
                        createdAt: user.createdAt,
                        updatedAt: user.updatedAt
                    }
                });
            },
            invalid,
            session: {
                session: null,
                user
            },
            key: twoFactorCookie
        };
    }
    return {
        valid: async (ctx$1)=>{
            return ctx$1.json({
                token: session.session.token,
                user: {
                    id: session.user.id,
                    email: session.user.email,
                    emailVerified: session.user.emailVerified,
                    name: session.user.name,
                    image: session.user.image,
                    createdAt: session.user.createdAt,
                    updatedAt: session.user.updatedAt
                }
            });
        },
        invalid,
        session,
        key: `${session.user.id}!${session.session.id}`
    };
}
//#endregion
//#region src/plugins/two-factor/backup-codes/index.ts
function generateBackupCodesFn(options) {
    return Array.from({
        length: options?.amount ?? 10
    }).fill(null).map(()=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(options?.length ?? 10, "a-z", "0-9", "A-Z")).map((code)=>`${code.slice(0, 5)}-${code.slice(5)}`);
}
async function generateBackupCodes(secret, options) {
    const backupCodes = options?.customBackupCodesGenerate ? options.customBackupCodesGenerate() : generateBackupCodesFn(options);
    if (options?.storeBackupCodes === "encrypted") return {
        backupCodes,
        encryptedBackupCodes: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])({
            data: JSON.stringify(backupCodes),
            key: secret
        })
    };
    if (typeof options?.storeBackupCodes === "object" && "encrypt" in options?.storeBackupCodes) return {
        backupCodes,
        encryptedBackupCodes: await options?.storeBackupCodes.encrypt(JSON.stringify(backupCodes))
    };
    return {
        backupCodes,
        encryptedBackupCodes: JSON.stringify(backupCodes)
    };
}
async function verifyBackupCode(data, key, options) {
    const codes = await getBackupCodes(data.backupCodes, key, options);
    if (!codes) return {
        status: false,
        updated: null
    };
    return {
        status: codes.includes(data.code),
        updated: codes.filter((code)=>code !== data.code)
    };
}
async function getBackupCodes(backupCodes, key, options) {
    if (options?.storeBackupCodes === "encrypted") return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
        key,
        data: backupCodes
    }));
    if (typeof options?.storeBackupCodes === "object" && "decrypt" in options?.storeBackupCodes) return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(await options?.storeBackupCodes.decrypt(backupCodes));
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(backupCodes);
}
const backupCode2fa = (opts)=>{
    const twoFactorTable = "twoFactor";
    return {
        id: "backup_code",
        endpoints: {
            verifyBackupCode: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/two-factor/verify-backup-code", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    code: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: `A backup code to verify. Eg: "123456"`
                    }),
                    disableSession: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().meta({
                        description: "If true, the session cookie will not be set."
                    }).optional(),
                    trustDevice: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().meta({
                        description: "If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true"
                    }).optional()
                }),
                metadata: {
                    openapi: {
                        description: "Verify a backup code for two-factor authentication",
                        responses: {
                            "200": {
                                description: "Backup code verified successfully",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user: {
                                                    type: "object",
                                                    properties: {
                                                        id: {
                                                            type: "string",
                                                            description: "Unique identifier of the user"
                                                        },
                                                        email: {
                                                            type: "string",
                                                            format: "email",
                                                            nullable: true,
                                                            description: "User's email address"
                                                        },
                                                        emailVerified: {
                                                            type: "boolean",
                                                            nullable: true,
                                                            description: "Whether the email is verified"
                                                        },
                                                        name: {
                                                            type: "string",
                                                            nullable: true,
                                                            description: "User's name"
                                                        },
                                                        image: {
                                                            type: "string",
                                                            format: "uri",
                                                            nullable: true,
                                                            description: "User's profile image URL"
                                                        },
                                                        twoFactorEnabled: {
                                                            type: "boolean",
                                                            description: "Whether two-factor authentication is enabled for the user"
                                                        },
                                                        createdAt: {
                                                            type: "string",
                                                            format: "date-time",
                                                            description: "Timestamp when the user was created"
                                                        },
                                                        updatedAt: {
                                                            type: "string",
                                                            format: "date-time",
                                                            description: "Timestamp when the user was last updated"
                                                        }
                                                    },
                                                    required: [
                                                        "id",
                                                        "twoFactorEnabled",
                                                        "createdAt",
                                                        "updatedAt"
                                                    ],
                                                    description: "The authenticated user object with two-factor details"
                                                },
                                                session: {
                                                    type: "object",
                                                    properties: {
                                                        token: {
                                                            type: "string",
                                                            description: "Session token"
                                                        },
                                                        userId: {
                                                            type: "string",
                                                            description: "ID of the user associated with the session"
                                                        },
                                                        createdAt: {
                                                            type: "string",
                                                            format: "date-time",
                                                            description: "Timestamp when the session was created"
                                                        },
                                                        expiresAt: {
                                                            type: "string",
                                                            format: "date-time",
                                                            description: "Timestamp when the session expires"
                                                        }
                                                    },
                                                    required: [
                                                        "token",
                                                        "userId",
                                                        "createdAt",
                                                        "expiresAt"
                                                    ],
                                                    description: "The current session object, included unless disableSession is true"
                                                }
                                            },
                                            required: [
                                                "user",
                                                "session"
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const { session, valid } = await verifyTwoFactor(ctx);
                const user = session.user;
                const twoFactor$1 = await ctx.context.adapter.findOne({
                    model: twoFactorTable,
                    where: [
                        {
                            field: "userId",
                            value: user.id
                        }
                    ]
                });
                if (!twoFactor$1) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: TWO_FACTOR_ERROR_CODES.BACKUP_CODES_NOT_ENABLED
                });
                const validate = await verifyBackupCode({
                    backupCodes: twoFactor$1.backupCodes,
                    code: ctx.body.code
                }, ctx.context.secret, opts);
                if (!validate.status) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: TWO_FACTOR_ERROR_CODES.INVALID_BACKUP_CODE
                });
                const updatedBackupCodes = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])({
                    key: ctx.context.secret,
                    data: JSON.stringify(validate.updated)
                });
                if (!await ctx.context.adapter.updateMany({
                    model: twoFactorTable,
                    update: {
                        backupCodes: updatedBackupCodes
                    },
                    where: [
                        {
                            field: "userId",
                            value: user.id
                        },
                        {
                            field: "backupCodes",
                            value: twoFactor$1.backupCodes
                        }
                    ]
                })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("CONFLICT", {
                    message: "Failed to verify backup code. Please try again."
                });
                if (!ctx.body.disableSession) return valid(ctx);
                return ctx.json({
                    token: session.session?.token,
                    user: {
                        id: session.user?.id,
                        email: session.user.email,
                        emailVerified: session.user.emailVerified,
                        name: session.user.name,
                        image: session.user.image,
                        createdAt: session.user.createdAt,
                        updatedAt: session.user.updatedAt
                    }
                });
            }),
            generateBackupCodes: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/two-factor/generate-backup-codes", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The users password."
                    })
                }),
                use: [
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"]
                ],
                metadata: {
                    openapi: {
                        description: "Generate new backup codes for two-factor authentication",
                        responses: {
                            "200": {
                                description: "Backup codes generated successfully",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                status: {
                                                    type: "boolean",
                                                    description: "Indicates if the backup codes were generated successfully",
                                                    enum: [
                                                        true
                                                    ]
                                                },
                                                backupCodes: {
                                                    type: "array",
                                                    items: {
                                                        type: "string"
                                                    },
                                                    description: "Array of generated backup codes in plain text"
                                                }
                                            },
                                            required: [
                                                "status",
                                                "backupCodes"
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const user = ctx.context.session.user;
                if (!user.twoFactorEnabled) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: TWO_FACTOR_ERROR_CODES.TWO_FACTOR_NOT_ENABLED
                });
                await ctx.context.password.checkPassword(user.id, ctx);
                const backupCodes = await generateBackupCodes(ctx.context.secret, opts);
                await ctx.context.adapter.updateMany({
                    model: twoFactorTable,
                    update: {
                        backupCodes: backupCodes.encryptedBackupCodes
                    },
                    where: [
                        {
                            field: "userId",
                            value: ctx.context.session.user.id
                        }
                    ]
                });
                return ctx.json({
                    status: true,
                    backupCodes: backupCodes.backupCodes
                });
            }),
            viewBackupCodes: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/two-factor/view-backup-codes", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].string().meta({
                        description: `The user ID to view all backup codes. Eg: "user-id"`
                    })
                }),
                metadata: {
                    SERVER_ONLY: true
                }
            }, async (ctx)=>{
                const twoFactor$1 = await ctx.context.adapter.findOne({
                    model: twoFactorTable,
                    where: [
                        {
                            field: "userId",
                            value: ctx.body.userId
                        }
                    ]
                });
                if (!twoFactor$1) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: TWO_FACTOR_ERROR_CODES.BACKUP_CODES_NOT_ENABLED
                });
                const decryptedBackupCodes = await getBackupCodes(twoFactor$1.backupCodes, ctx.context.secret, opts);
                if (!decryptedBackupCodes) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: TWO_FACTOR_ERROR_CODES.INVALID_BACKUP_CODE
                });
                return ctx.json({
                    status: true,
                    backupCodes: decryptedBackupCodes
                });
            })
        }
    };
};
//#endregion
//#region src/plugins/two-factor/utils.ts
const defaultKeyHasher = async (token)=>{
    const hash = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createHash"])("SHA-256").digest(new TextEncoder().encode(token));
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["base64Url"].encode(new Uint8Array(hash), {
        padding: false
    });
};
//#endregion
//#region src/plugins/two-factor/otp/index.ts
/**
* The otp adapter is created from the totp adapter.
*/ const otp2fa = (options)=>{
    const opts = {
        storeOTP: "plain",
        digits: 6,
        ...options,
        period: (options?.period || 3) * 60 * 1e3
    };
    async function storeOTP(ctx, otp) {
        if (opts.storeOTP === "hashed") return await defaultKeyHasher(otp);
        if (typeof opts.storeOTP === "object" && "hash" in opts.storeOTP) return await opts.storeOTP.hash(otp);
        if (typeof opts.storeOTP === "object" && "encrypt" in opts.storeOTP) return await opts.storeOTP.encrypt(otp);
        if (opts.storeOTP === "encrypted") return await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])({
            key: ctx.context.secret,
            data: otp
        });
        return otp;
    }
    async function decryptOTP(ctx, otp) {
        if (opts.storeOTP === "hashed") return await defaultKeyHasher(otp);
        if (opts.storeOTP === "encrypted") return await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
            key: ctx.context.secret,
            data: otp
        });
        if (typeof opts.storeOTP === "object" && "encrypt" in opts.storeOTP) return await opts.storeOTP.decrypt(otp);
        if (typeof opts.storeOTP === "object" && "hash" in opts.storeOTP) return await opts.storeOTP.hash(otp);
        return otp;
    }
    return {
        id: "otp",
        endpoints: {
            sendTwoFactorOTP: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/two-factor/send-otp", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    trustDevice: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().optional().meta({
                        description: "If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true"
                    })
                }).optional(),
                metadata: {
                    openapi: {
                        summary: "Send two factor OTP",
                        description: "Send two factor OTP to the user",
                        responses: {
                            200: {
                                description: "Successful response",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                status: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                if (!options || !options.sendOTP) {
                    ctx.context.logger.error("send otp isn't configured. Please configure the send otp function on otp options.");
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        message: "otp isn't configured"
                    });
                }
                const { session, key } = await verifyTwoFactor(ctx);
                const code = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(opts.digits, "0-9");
                const hashedCode = await storeOTP(ctx, code);
                await ctx.context.internalAdapter.createVerificationValue({
                    value: `${hashedCode}:0`,
                    identifier: `2fa-otp-${key}`,
                    expiresAt: new Date(Date.now() + opts.period)
                });
                await options.sendOTP({
                    user: session.user,
                    otp: code
                }, ctx);
                return ctx.json({
                    status: true
                });
            }),
            verifyTwoFactorOTP: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/two-factor/verify-otp", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    code: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The otp code to verify. Eg: \"012345\""
                    }),
                    trustDevice: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().optional().meta({
                        description: "If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true"
                    })
                }),
                metadata: {
                    openapi: {
                        summary: "Verify two factor OTP",
                        description: "Verify two factor OTP",
                        responses: {
                            "200": {
                                description: "Two-factor OTP verified successfully",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                token: {
                                                    type: "string",
                                                    description: "Session token for the authenticated session"
                                                },
                                                user: {
                                                    type: "object",
                                                    properties: {
                                                        id: {
                                                            type: "string",
                                                            description: "Unique identifier of the user"
                                                        },
                                                        email: {
                                                            type: "string",
                                                            format: "email",
                                                            nullable: true,
                                                            description: "User's email address"
                                                        },
                                                        emailVerified: {
                                                            type: "boolean",
                                                            nullable: true,
                                                            description: "Whether the email is verified"
                                                        },
                                                        name: {
                                                            type: "string",
                                                            nullable: true,
                                                            description: "User's name"
                                                        },
                                                        image: {
                                                            type: "string",
                                                            format: "uri",
                                                            nullable: true,
                                                            description: "User's profile image URL"
                                                        },
                                                        createdAt: {
                                                            type: "string",
                                                            format: "date-time",
                                                            description: "Timestamp when the user was created"
                                                        },
                                                        updatedAt: {
                                                            type: "string",
                                                            format: "date-time",
                                                            description: "Timestamp when the user was last updated"
                                                        }
                                                    },
                                                    required: [
                                                        "id",
                                                        "createdAt",
                                                        "updatedAt"
                                                    ],
                                                    description: "The authenticated user object"
                                                }
                                            },
                                            required: [
                                                "token",
                                                "user"
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const { session, key, valid, invalid } = await verifyTwoFactor(ctx);
                const toCheckOtp = await ctx.context.internalAdapter.findVerificationValue(`2fa-otp-${key}`);
                const [otp, counter] = toCheckOtp?.value?.split(":") ?? [];
                const decryptedOtp = await decryptOTP(ctx, otp);
                if (!toCheckOtp || toCheckOtp.expiresAt < /* @__PURE__ */ new Date()) {
                    if (toCheckOtp) await ctx.context.internalAdapter.deleteVerificationValue(toCheckOtp.id);
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        message: TWO_FACTOR_ERROR_CODES.OTP_HAS_EXPIRED
                    });
                }
                const allowedAttempts = options?.allowedAttempts || 5;
                if (parseInt(counter) >= allowedAttempts) {
                    await ctx.context.internalAdapter.deleteVerificationValue(toCheckOtp.id);
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        message: TWO_FACTOR_ERROR_CODES.TOO_MANY_ATTEMPTS_REQUEST_NEW_CODE
                    });
                }
                if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"])(new TextEncoder().encode(decryptedOtp), new TextEncoder().encode(ctx.body.code))) {
                    if (!session.user.twoFactorEnabled) {
                        if (!session.session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].FAILED_TO_CREATE_SESSION
                        });
                        const updatedUser = await ctx.context.internalAdapter.updateUser(session.user.id, {
                            twoFactorEnabled: true
                        });
                        const newSession = await ctx.context.internalAdapter.createSession(session.user.id, false, session.session);
                        await ctx.context.internalAdapter.deleteSession(session.session.token);
                        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, {
                            session: newSession,
                            user: updatedUser
                        });
                        return ctx.json({
                            token: newSession.token,
                            user: {
                                id: updatedUser.id,
                                email: updatedUser.email,
                                emailVerified: updatedUser.emailVerified,
                                name: updatedUser.name,
                                image: updatedUser.image,
                                createdAt: updatedUser.createdAt,
                                updatedAt: updatedUser.updatedAt
                            }
                        });
                    }
                    return valid(ctx);
                } else {
                    await ctx.context.internalAdapter.updateVerificationValue(toCheckOtp.id, {
                        value: `${otp}:${(parseInt(counter, 10) || 0) + 1}`
                    });
                    return invalid("INVALID_CODE");
                }
            })
        }
    };
};
//#endregion
//#region src/plugins/two-factor/schema.ts
const schema = {
    user: {
        fields: {
            twoFactorEnabled: {
                type: "boolean",
                required: false,
                defaultValue: false,
                input: false
            }
        }
    },
    twoFactor: {
        fields: {
            secret: {
                type: "string",
                required: true,
                returned: false,
                index: true
            },
            backupCodes: {
                type: "string",
                required: true,
                returned: false
            },
            userId: {
                type: "string",
                required: true,
                returned: false,
                references: {
                    model: "user",
                    field: "id"
                },
                index: true
            }
        }
    }
};
//#endregion
//#region src/plugins/two-factor/totp/index.ts
const totp2fa = (options)=>{
    const opts = {
        ...options,
        digits: options?.digits || 6,
        period: options?.period || 30
    };
    const twoFactorTable = "twoFactor";
    return {
        id: "totp",
        endpoints: {
            generateTOTP: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/totp/generate", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    secret: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The secret to generate the TOTP code"
                    })
                }),
                metadata: {
                    openapi: {
                        summary: "Generate TOTP code",
                        description: "Use this endpoint to generate a TOTP code",
                        responses: {
                            200: {
                                description: "Successful response",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                code: {
                                                    type: "string"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    SERVER_ONLY: true
                }
            }, async (ctx)=>{
                if (options?.disable) {
                    ctx.context.logger.error("totp isn't configured. please pass totp option on two factor plugin to enable totp");
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        message: "totp isn't configured"
                    });
                }
                return {
                    code: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$otp$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createOTP"])(ctx.body.secret, {
                        period: opts.period,
                        digits: opts.digits
                    }).totp()
                };
            }),
            getTOTPURI: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/two-factor/get-totp-uri", {
                method: "POST",
                use: [
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"]
                ],
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "User password"
                    })
                }),
                metadata: {
                    openapi: {
                        summary: "Get TOTP URI",
                        description: "Use this endpoint to get the TOTP URI",
                        responses: {
                            200: {
                                description: "Successful response",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                totpURI: {
                                                    type: "string"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                if (options?.disable) {
                    ctx.context.logger.error("totp isn't configured. please pass totp option on two factor plugin to enable totp");
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        message: "totp isn't configured"
                    });
                }
                const user = ctx.context.session.user;
                const twoFactor$1 = await ctx.context.adapter.findOne({
                    model: twoFactorTable,
                    where: [
                        {
                            field: "userId",
                            value: user.id
                        }
                    ]
                });
                if (!twoFactor$1) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: TWO_FACTOR_ERROR_CODES.TOTP_NOT_ENABLED
                });
                const secret = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                    key: ctx.context.secret,
                    data: twoFactor$1.secret
                });
                await ctx.context.password.checkPassword(user.id, ctx);
                return {
                    totpURI: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$otp$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createOTP"])(secret, {
                        digits: opts.digits,
                        period: opts.period
                    }).url(options?.issuer || ctx.context.appName, user.email)
                };
            }),
            verifyTOTP: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/two-factor/verify-totp", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    code: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The otp code to verify. Eg: \"012345\""
                    }),
                    trustDevice: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().meta({
                        description: "If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true"
                    }).optional()
                }),
                metadata: {
                    openapi: {
                        summary: "Verify two factor TOTP",
                        description: "Verify two factor TOTP",
                        responses: {
                            200: {
                                description: "Successful response",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                status: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                if (options?.disable) {
                    ctx.context.logger.error("totp isn't configured. please pass totp option on two factor plugin to enable totp");
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        message: "totp isn't configured"
                    });
                }
                const { session, valid, invalid } = await verifyTwoFactor(ctx);
                const user = session.user;
                const twoFactor$1 = await ctx.context.adapter.findOne({
                    model: twoFactorTable,
                    where: [
                        {
                            field: "userId",
                            value: user.id
                        }
                    ]
                });
                if (!twoFactor$1) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: TWO_FACTOR_ERROR_CODES.TOTP_NOT_ENABLED
                });
                if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$otp$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createOTP"])(await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])({
                    key: ctx.context.secret,
                    data: twoFactor$1.secret
                }), {
                    period: opts.period,
                    digits: opts.digits
                }).verify(ctx.body.code)) return invalid("INVALID_CODE");
                if (!user.twoFactorEnabled) {
                    if (!session.session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].FAILED_TO_CREATE_SESSION
                    });
                    const updatedUser = await ctx.context.internalAdapter.updateUser(user.id, {
                        twoFactorEnabled: true
                    });
                    const newSession = await ctx.context.internalAdapter.createSession(user.id, false, session.session).catch((e)=>{
                        throw e;
                    });
                    await ctx.context.internalAdapter.deleteSession(session.session.token);
                    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, {
                        session: newSession,
                        user: updatedUser
                    });
                }
                return valid(ctx);
            })
        }
    };
};
//#endregion
//#region src/plugins/two-factor/index.ts
const twoFactor = (options)=>{
    const opts = {
        twoFactorTable: "twoFactor"
    };
    const backupCodeOptions = {
        storeBackupCodes: "encrypted",
        ...options?.backupCodeOptions
    };
    const totp = totp2fa(options?.totpOptions);
    const backupCode = backupCode2fa(backupCodeOptions);
    const otp = otp2fa(options?.otpOptions);
    return {
        id: "two-factor",
        endpoints: {
            ...totp.endpoints,
            ...otp.endpoints,
            ...backupCode.endpoints,
            enableTwoFactor: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/two-factor/enable", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "User password"
                    }),
                    issuer: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "Custom issuer for the TOTP URI"
                    }).optional()
                }),
                use: [
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"]
                ],
                metadata: {
                    openapi: {
                        summary: "Enable two factor authentication",
                        description: "Use this endpoint to enable two factor authentication. This will generate a TOTP URI and backup codes. Once the user verifies the TOTP URI, the two factor authentication will be enabled.",
                        responses: {
                            200: {
                                description: "Successful response",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                totpURI: {
                                                    type: "string",
                                                    description: "TOTP URI"
                                                },
                                                backupCodes: {
                                                    type: "array",
                                                    items: {
                                                        type: "string"
                                                    },
                                                    description: "Backup codes"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const user = ctx.context.session.user;
                const { password, issuer } = ctx.body;
                if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$password$2d$BFQK0cLg$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])(ctx, {
                    password,
                    userId: user.id
                })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].INVALID_PASSWORD
                });
                const secret = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(32);
                const encryptedSecret = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])({
                    key: ctx.context.secret,
                    data: secret
                });
                const backupCodes = await generateBackupCodes(ctx.context.secret, backupCodeOptions);
                if (options?.skipVerificationOnEnable) {
                    const updatedUser = await ctx.context.internalAdapter.updateUser(user.id, {
                        twoFactorEnabled: true
                    });
                    /**
					* Update the session cookie with the new user data
					*/ await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, {
                        session: await ctx.context.internalAdapter.createSession(updatedUser.id, false, ctx.context.session.session),
                        user: updatedUser
                    });
                    await ctx.context.internalAdapter.deleteSession(ctx.context.session.session.token);
                }
                await ctx.context.adapter.deleteMany({
                    model: opts.twoFactorTable,
                    where: [
                        {
                            field: "userId",
                            value: user.id
                        }
                    ]
                });
                await ctx.context.adapter.create({
                    model: opts.twoFactorTable,
                    data: {
                        secret: encryptedSecret,
                        backupCodes: backupCodes.encryptedBackupCodes,
                        userId: user.id
                    }
                });
                const totpURI = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$otp$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createOTP"])(secret, {
                    digits: options?.totpOptions?.digits || 6,
                    period: options?.totpOptions?.period
                }).url(issuer || options?.issuer || ctx.context.appName, user.email);
                return ctx.json({
                    totpURI,
                    backupCodes: backupCodes.backupCodes
                });
            }),
            disableTwoFactor: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/two-factor/disable", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "User password"
                    })
                }),
                use: [
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["u"]
                ],
                metadata: {
                    openapi: {
                        summary: "Disable two factor authentication",
                        description: "Use this endpoint to disable two factor authentication.",
                        responses: {
                            200: {
                                description: "Successful response",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                status: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                const user = ctx.context.session.user;
                const { password } = ctx.body;
                if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$password$2d$BFQK0cLg$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])(ctx, {
                    password,
                    userId: user.id
                })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].INVALID_PASSWORD
                });
                const updatedUser = await ctx.context.internalAdapter.updateUser(user.id, {
                    twoFactorEnabled: false
                });
                await ctx.context.adapter.delete({
                    model: opts.twoFactorTable,
                    where: [
                        {
                            field: "userId",
                            value: updatedUser.id
                        }
                    ]
                });
                /**
				* Update the session cookie with the new user data
				*/ await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, {
                    session: await ctx.context.internalAdapter.createSession(updatedUser.id, false, ctx.context.session.session),
                    user: updatedUser
                });
                await ctx.context.internalAdapter.deleteSession(ctx.context.session.session.token);
                return ctx.json({
                    status: true
                });
            })
        },
        options,
        hooks: {
            after: [
                {
                    matcher (context) {
                        return context.path === "/sign-in/email" || context.path === "/sign-in/username" || context.path === "/sign-in/phone-number";
                    },
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        const data = ctx.context.newSession;
                        if (!data) return;
                        if (!data?.user.twoFactorEnabled) return;
                        const trustDeviceCookieAttrs = ctx.context.createAuthCookie(TRUST_DEVICE_COOKIE_NAME, {
                            maxAge: TRUST_DEVICE_COOKIE_MAX_AGE
                        });
                        const trustDeviceCookie = await ctx.getSignedCookie(trustDeviceCookieAttrs.name, ctx.context.secret);
                        if (trustDeviceCookie) {
                            const [token, sessionToken] = trustDeviceCookie.split("!");
                            if (token === await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createHMAC"])("SHA-256", "base64urlnopad").sign(ctx.context.secret, `${data.user.id}!${sessionToken}`)) {
                                const newTrustDeviceCookie = ctx.context.createAuthCookie(TRUST_DEVICE_COOKIE_NAME, {
                                    maxAge: TRUST_DEVICE_COOKIE_MAX_AGE
                                });
                                const newToken = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createHMAC"])("SHA-256", "base64urlnopad").sign(ctx.context.secret, `${data.user.id}!${data.session.token}`);
                                await ctx.setSignedCookie(newTrustDeviceCookie.name, `${newToken}!${data.session.token}`, ctx.context.secret, trustDeviceCookieAttrs.attributes);
                                return;
                            }
                        }
                        /**
				* remove the session cookie. It's set by the sign in credential
				*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["n"])(ctx, true);
                        await ctx.context.internalAdapter.deleteSession(data.session.token);
                        const maxAge = (options?.otpOptions?.period ?? 3) * 60;
                        const twoFactorCookie = ctx.context.createAuthCookie(TWO_FACTOR_COOKIE_NAME, {
                            maxAge
                        });
                        const identifier = `2fa-${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["r"])(20)}`;
                        await ctx.context.internalAdapter.createVerificationValue({
                            value: data.user.id,
                            identifier,
                            expiresAt: new Date(Date.now() + maxAge * 1e3)
                        });
                        await ctx.setSignedCookie(twoFactorCookie.name, identifier, ctx.context.secret, twoFactorCookie.attributes);
                        return ctx.json({
                            twoFactorRedirect: true
                        });
                    })
                }
            ]
        },
        schema: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(schema, options?.schema),
        rateLimit: [
            {
                pathMatcher (path) {
                    return path.startsWith("/two-factor/");
                },
                window: 10,
                max: 3
            }
        ],
        $ERROR_CODES: TWO_FACTOR_ERROR_CODES
    };
};
;
}),
"[project]/node_modules/better-auth/dist/username-C_wmkXwt.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "n",
    ()=>USERNAME_ERROR_CODES,
    "t",
    ()=>username
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/schema-Bb7wzeK_.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api-CkmycQ2x.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error-BhAKg8LX.mjs [app-route] (ecmascript) <export n as BASE_ERROR_CODES>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils-C5EN75oV.mjs [app-route] (ecmascript) <export t as defineErrorCodes>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
//#region src/plugins/username/error-codes.ts
const USERNAME_ERROR_CODES = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2d$C5EN75oV$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__t__as__defineErrorCodes$3e$__["defineErrorCodes"])({
    INVALID_USERNAME_OR_PASSWORD: "Invalid username or password",
    EMAIL_NOT_VERIFIED: "Email not verified",
    UNEXPECTED_ERROR: "Unexpected error",
    USERNAME_IS_ALREADY_TAKEN: "Username is already taken. Please try another.",
    USERNAME_TOO_SHORT: "Username is too short",
    USERNAME_TOO_LONG: "Username is too long",
    INVALID_USERNAME: "Username is invalid",
    INVALID_DISPLAY_USERNAME: "Display username is invalid"
});
//#endregion
//#region src/plugins/username/schema.ts
const getSchema = (normalizer)=>{
    return {
        user: {
            fields: {
                username: {
                    type: "string",
                    required: false,
                    sortable: true,
                    unique: true,
                    returned: true,
                    transform: {
                        input (value) {
                            return typeof value !== "string" ? value : normalizer.username(value);
                        }
                    }
                },
                displayUsername: {
                    type: "string",
                    required: false,
                    transform: {
                        input (value) {
                            return typeof value !== "string" ? value : normalizer.displayUsername(value);
                        }
                    }
                }
            }
        }
    };
};
//#endregion
//#region src/plugins/username/index.ts
function defaultUsernameValidator(username$1) {
    return /^[a-zA-Z0-9_.]+$/.test(username$1);
}
const username = (options)=>{
    const normalizer = (username$1)=>{
        if (options?.usernameNormalization === false) return username$1;
        if (options?.usernameNormalization) return options.usernameNormalization(username$1);
        return username$1.toLowerCase();
    };
    const displayUsernameNormalizer = (displayUsername)=>{
        return options?.displayUsernameNormalization ? options.displayUsernameNormalization(displayUsername) : displayUsername;
    };
    return {
        id: "username",
        init (ctx) {
            return {
                options: {
                    databaseHooks: {
                        user: {
                            create: {
                                async before (user, context) {
                                    const username$1 = "username" in user ? user.username : null;
                                    const displayUsername = "displayUsername" in user ? user.displayUsername : null;
                                    return {
                                        data: {
                                            ...user,
                                            ...username$1 ? {
                                                username: normalizer(username$1)
                                            } : {},
                                            ...displayUsername ? {
                                                displayUsername: displayUsernameNormalizer(displayUsername)
                                            } : {}
                                        }
                                    };
                                }
                            },
                            update: {
                                async before (user, context) {
                                    const username$1 = "username" in user ? user.username : null;
                                    const displayUsername = "displayUsername" in user ? user.displayUsername : null;
                                    return {
                                        data: {
                                            ...user,
                                            ...username$1 ? {
                                                username: normalizer(username$1)
                                            } : {},
                                            ...displayUsername ? {
                                                displayUsername: displayUsernameNormalizer(displayUsername)
                                            } : {}
                                        }
                                    };
                                }
                            }
                        }
                    }
                }
            };
        },
        endpoints: {
            signInUsername: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/sign-in/username", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    username: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The username of the user"
                    }),
                    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The password of the user"
                    }),
                    rememberMe: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().meta({
                        description: "Remember the user session"
                    }).optional(),
                    callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The URL to redirect to after email verification"
                    }).optional()
                }),
                metadata: {
                    openapi: {
                        summary: "Sign in with username",
                        description: "Sign in with username",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                token: {
                                                    type: "string",
                                                    description: "Session token for the authenticated session"
                                                },
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            },
                                            required: [
                                                "token",
                                                "user"
                                            ]
                                        }
                                    }
                                }
                            },
                            422: {
                                description: "Unprocessable Entity. Validation error",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                message: {
                                                    type: "string"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (ctx)=>{
                if (!ctx.body.username || !ctx.body.password) {
                    ctx.context.logger.error("Username or password not found");
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                        message: USERNAME_ERROR_CODES.INVALID_USERNAME_OR_PASSWORD
                    });
                }
                const username$1 = options?.validationOrder?.username === "pre-normalization" ? normalizer(ctx.body.username) : ctx.body.username;
                const minUsernameLength = options?.minUsernameLength || 3;
                const maxUsernameLength = options?.maxUsernameLength || 30;
                if (username$1.length < minUsernameLength) {
                    ctx.context.logger.error("Username too short", {
                        username: username$1
                    });
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNPROCESSABLE_ENTITY", {
                        code: "USERNAME_TOO_SHORT",
                        message: USERNAME_ERROR_CODES.USERNAME_TOO_SHORT
                    });
                }
                if (username$1.length > maxUsernameLength) {
                    ctx.context.logger.error("Username too long", {
                        username: username$1
                    });
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNPROCESSABLE_ENTITY", {
                        message: USERNAME_ERROR_CODES.USERNAME_TOO_LONG
                    });
                }
                if (!(options?.usernameValidator || defaultUsernameValidator)(username$1)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNPROCESSABLE_ENTITY", {
                    message: USERNAME_ERROR_CODES.INVALID_USERNAME
                });
                const user = await ctx.context.adapter.findOne({
                    model: "user",
                    where: [
                        {
                            field: "username",
                            value: normalizer(username$1)
                        }
                    ]
                });
                if (!user) {
                    await ctx.context.password.hash(ctx.body.password);
                    ctx.context.logger.error("User not found", {
                        username: username$1
                    });
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                        message: USERNAME_ERROR_CODES.INVALID_USERNAME_OR_PASSWORD
                    });
                }
                const account = await ctx.context.adapter.findOne({
                    model: "account",
                    where: [
                        {
                            field: "userId",
                            value: user.id
                        },
                        {
                            field: "providerId",
                            value: "credential"
                        }
                    ]
                });
                if (!account) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: USERNAME_ERROR_CODES.INVALID_USERNAME_OR_PASSWORD
                });
                const currentPassword = account?.password;
                if (!currentPassword) {
                    ctx.context.logger.error("Password not found", {
                        username: username$1
                    });
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                        message: USERNAME_ERROR_CODES.INVALID_USERNAME_OR_PASSWORD
                    });
                }
                if (!await ctx.context.password.verify({
                    hash: currentPassword,
                    password: ctx.body.password
                })) {
                    ctx.context.logger.error("Invalid password");
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                        message: USERNAME_ERROR_CODES.INVALID_USERNAME_OR_PASSWORD
                    });
                }
                if (ctx.context.options?.emailAndPassword?.requireEmailVerification && !user.emailVerified) {
                    if (!ctx.context.options?.emailVerification?.sendVerificationEmail) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                        message: USERNAME_ERROR_CODES.EMAIL_NOT_VERIFIED
                    });
                    if (ctx.context.options?.emailVerification?.sendOnSignIn) {
                        const token = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["C"])(ctx.context.secret, user.email, void 0, ctx.context.options.emailVerification?.expiresIn);
                        const url = `${ctx.context.baseURL}/verify-email?token=${token}&callbackURL=${ctx.body.callbackURL || "/"}`;
                        await ctx.context.options.emailVerification.sendVerificationEmail({
                            user,
                            url,
                            token
                        }, ctx.request);
                    }
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                        message: USERNAME_ERROR_CODES.EMAIL_NOT_VERIFIED
                    });
                }
                const session = await ctx.context.internalAdapter.createSession(user.id, ctx.body.rememberMe === false);
                if (!session) return ctx.json(null, {
                    status: 500,
                    body: {
                        message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2d$BhAKg8LX$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__n__as__BASE_ERROR_CODES$3e$__["BASE_ERROR_CODES"].FAILED_TO_CREATE_SESSION
                    }
                });
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["c"])(ctx, {
                    session,
                    user
                }, ctx.body.rememberMe === false);
                return ctx.json({
                    token: session.token,
                    user: {
                        id: user.id,
                        email: user.email,
                        emailVerified: user.emailVerified,
                        username: user.username,
                        displayUsername: user.displayUsername,
                        name: user.name,
                        image: user.image,
                        createdAt: user.createdAt,
                        updatedAt: user.updatedAt
                    }
                });
            }),
            isUsernameAvailable: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/is-username-available", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                    username: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                        description: "The username to check"
                    })
                })
            }, async (ctx)=>{
                const username$1 = ctx.body.username;
                if (!username$1) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNPROCESSABLE_ENTITY", {
                    message: USERNAME_ERROR_CODES.INVALID_USERNAME
                });
                const minUsernameLength = options?.minUsernameLength || 3;
                const maxUsernameLength = options?.maxUsernameLength || 30;
                if (username$1.length < minUsernameLength) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNPROCESSABLE_ENTITY", {
                    code: "USERNAME_TOO_SHORT",
                    message: USERNAME_ERROR_CODES.USERNAME_TOO_SHORT
                });
                if (username$1.length > maxUsernameLength) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNPROCESSABLE_ENTITY", {
                    message: USERNAME_ERROR_CODES.USERNAME_TOO_LONG
                });
                if (!await (options?.usernameValidator || defaultUsernameValidator)(username$1)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNPROCESSABLE_ENTITY", {
                    message: USERNAME_ERROR_CODES.INVALID_USERNAME
                });
                if (await ctx.context.adapter.findOne({
                    model: "user",
                    where: [
                        {
                            field: "username",
                            value: normalizer(username$1)
                        }
                    ]
                })) return ctx.json({
                    available: false
                });
                return ctx.json({
                    available: true
                });
            })
        },
        schema: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"])(getSchema({
            username: normalizer,
            displayUsername: displayUsernameNormalizer
        }), options?.schema),
        hooks: {
            before: [
                {
                    matcher (context) {
                        return context.path === "/sign-up/email" || context.path === "/update-user";
                    },
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        const username$1 = typeof ctx.body.username === "string" && options?.validationOrder?.username === "post-normalization" ? normalizer(ctx.body.username) : ctx.body.username;
                        if (username$1 !== void 0 && typeof username$1 === "string") {
                            const minUsernameLength = options?.minUsernameLength || 3;
                            const maxUsernameLength = options?.maxUsernameLength || 30;
                            if (username$1.length < minUsernameLength) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                                code: "USERNAME_TOO_SHORT",
                                message: USERNAME_ERROR_CODES.USERNAME_TOO_SHORT
                            });
                            if (username$1.length > maxUsernameLength) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                                message: USERNAME_ERROR_CODES.USERNAME_TOO_LONG
                            });
                            if (!await (options?.usernameValidator || defaultUsernameValidator)(username$1)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                                message: USERNAME_ERROR_CODES.INVALID_USERNAME
                            });
                            const user = await ctx.context.adapter.findOne({
                                model: "user",
                                where: [
                                    {
                                        field: "username",
                                        value: username$1
                                    }
                                ]
                            });
                            const blockChangeSignUp = ctx.path === "/sign-up/email" && user;
                            const blockChangeUpdateUser = ctx.path === "/update-user" && user && ctx.context.session && user.id !== ctx.context.session.session.userId;
                            if (blockChangeSignUp || blockChangeUpdateUser) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                                message: USERNAME_ERROR_CODES.USERNAME_IS_ALREADY_TAKEN
                            });
                        }
                        const displayUsername = typeof ctx.body.displayUsername === "string" && options?.validationOrder?.displayUsername === "post-normalization" ? displayUsernameNormalizer(ctx.body.displayUsername) : ctx.body.displayUsername;
                        if (displayUsername !== void 0 && typeof displayUsername === "string") {
                            if (options?.displayUsernameValidator) {
                                if (!await options.displayUsernameValidator(displayUsername)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                                    message: USERNAME_ERROR_CODES.INVALID_DISPLAY_USERNAME
                                });
                            }
                        }
                    })
                },
                {
                    matcher (context) {
                        return context.path === "/sign-up/email" || context.path === "/update-user";
                    },
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        if (ctx.body.username && !ctx.body.displayUsername) ctx.body.displayUsername = ctx.body.username;
                        if (ctx.body.displayUsername && !ctx.body.username) ctx.body.username = ctx.body.displayUsername;
                    })
                }
            ]
        },
        $ERROR_CODES: USERNAME_ERROR_CODES
    };
};
;
}),
"[project]/node_modules/better-auth/dist/plugins/index.mjs [app-route] (ecmascript) <locals>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$dialect$2d$D9ZUZA4J$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/dialect-D9ZUZA4J.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$model$2d$name$2d$D4DUV7S2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/get-model-name-D4DUV7S2.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$migration$2d$Bf0TuCzm$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/get-migration-Bf0TuCzm.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2d$db7gNqd$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/utils-db7gNqd-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/crypto-CFUhAR9W.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$misc$2d$BwNc0MKr$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/misc-BwNc0MKr.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/schema-Bb7wzeK_.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$get$2d$request$2d$ip$2d$D6st$2d$mto$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/get-request-ip-D6st-mto.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/json-CnHxKYpj.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$url$2d$CB8xCwz$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/url-CB8xCwz-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2d$CkmycQ2x$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api-CkmycQ2x.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$session$2d$AaRl3_x$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/session-AaRl3_x-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$password$2d$BFQK0cLg$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/password-BFQK0cLg.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$parser$2d$pHp5yoAv$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/parser-pHp5yoAv.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$access$2d$Dx8TLKnw$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/access-Dx8TLKnw.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$access$2d$h$2d$uttVNZ$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/access-h-uttVNZ.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$has$2d$permission$2d$qCjQqGds$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/has-permission-qCjQqGds.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$access$2d$vPNO48H4$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/access-vPNO48H4.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$permission$2d$JwliMugl$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/permission-JwliMugl.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$client$2d$CMPEe5$2d$e$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/client-CMPEe5-e.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugin$2d$helper$2d$zFdFWLgL$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugin-helper-zFdFWLgL.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$admin$2d$D$2d$OMdNIc$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/admin-D-OMdNIc.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$anonymous$2d$DxoIOUPc$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/anonymous-DxoIOUPc.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2d$DgSTpOzm$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins-DgSTpOzm.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__createAuthMiddleware__as__n$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript) <export createAuthMiddleware as n>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__optionsMiddleware__as__r$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript) <export optionsMiddleware as r>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__createAuthEndpoint__as__t$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript) <export createAuthEndpoint as t>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$bearer$2d$C6RSCXv_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/bearer-C6RSCXv_.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$captcha$2d$Dbvurc2Z$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/captcha-Dbvurc2Z.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$custom$2d$session$2d$CaUbM_of$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/custom-session-CaUbM_of.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$device$2d$authorization$2d$9_f1Up5D$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/device-authorization-9_f1Up5D.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$email$2d$otp$2d$CiznqFUN$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/email-otp-CiznqFUN.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$generic$2d$oauth$2d$BGbWWUh9$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/generic-oauth-BGbWWUh9.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$haveibeenpwned$2d$BSsFUFTi$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/haveibeenpwned-BSsFUFTi.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$jwt$2d$Ar1sciI2$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/jwt-Ar1sciI2.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$magic$2d$link$2d$QdHvtdfs$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/magic-link-QdHvtdfs.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$oidc$2d$provider$2d$B9SsN23J$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/oidc-provider-B9SsN23J.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$multi$2d$session$2d$CbEYz_wJ$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/multi-session-CbEYz_wJ.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$oauth$2d$proxy$2d$Dz1E1SVN$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/oauth-proxy-Dz1E1SVN.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$one$2d$tap$2d$Bz8Q39Od$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/one-tap-Bz8Q39Od.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$one$2d$time$2d$token$2d$C8YQxf38$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/one-time-token-C8YQxf38.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$open$2d$api$2d$DZG02vyi$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/open-api-DZG02vyi.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$organization$2d$BdJSRNgM$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/organization-BdJSRNgM.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$phone$2d$number$2d$wU9XYnr8$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/phone-number-wU9XYnr8.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$siwe$2d$D81Y4fkp$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/siwe-D81Y4fkp.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$two$2d$factor$2d$BDQvVILL$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/two-factor-BDQvVILL.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$username$2d$C_wmkXwt$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/username-C_wmkXwt.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
}),
"[project]/node_modules/better-auth/dist/username-C_wmkXwt.mjs [app-route] (ecmascript) <export t as username>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "username",
    ()=>__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$username$2d$C_wmkXwt$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["t"]
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$username$2d$C_wmkXwt$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/username-C_wmkXwt.mjs [app-route] (ecmascript)");
}),
"[project]/node_modules/better-auth/dist/integrations/next-js.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "nextCookies",
    ()=>nextCookies,
    "toNextJsHandler",
    ()=>toNextJsHandler
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2d$CFUhAR9W$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/crypto-CFUhAR9W.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$schema$2d$Bb7wzeK_$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/schema-Bb7wzeK_.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$json$2d$CnHxKYpj$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/json-CnHxKYpj.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$url$2d$CB8xCwz$2d2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/url-CB8xCwz-.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies-D72PbWdz.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
//#region src/integrations/next-js.ts
function toNextJsHandler(auth) {
    const handler = async (request)=>{
        return "handler" in auth ? auth.handler(request) : auth(request);
    };
    return {
        GET: handler,
        POST: handler,
        PATCH: handler,
        PUT: handler,
        DELETE: handler
    };
}
const nextCookies = ()=>{
    return {
        id: "next-cookies",
        hooks: {
            after: [
                {
                    matcher (ctx) {
                        return true;
                    },
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        const returned = ctx.context.responseHeaders;
                        if ("_flag" in ctx && ctx._flag === "router") return;
                        if (returned instanceof Headers) {
                            const setCookies = returned?.get("set-cookie");
                            if (!setCookies) return;
                            const parsed = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2d$D72PbWdz$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["l"])(setCookies);
                            const { cookies } = await __turbopack_context__.A("[project]/node_modules/next/headers.js [app-route] (ecmascript, async loader)");
                            let cookieHelper;
                            try {
                                cookieHelper = await cookies();
                            } catch (error) {
                                if (error instanceof Error && error.message.startsWith("`cookies` was called outside a request scope.")) return;
                                throw error;
                            }
                            parsed.forEach((value, key)=>{
                                if (!key) return;
                                const opts = {
                                    sameSite: value.samesite,
                                    secure: value.secure,
                                    maxAge: value["max-age"],
                                    httpOnly: value.httponly,
                                    domain: value.domain,
                                    path: value.path
                                };
                                try {
                                    cookieHelper.set(key, decodeURIComponent(value.value), opts);
                                } catch (e) {}
                            });
                            return;
                        }
                    })
                }
            ]
        }
    };
};
;
}),
];

//# sourceMappingURL=node_modules_better-auth_dist_fc5ac98a._.js.map