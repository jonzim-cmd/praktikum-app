{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/dialect-D9ZUZA4J.mjs"],"sourcesContent":["import { Kysely, MssqlDialect, MysqlDialect, PostgresDialect, SqliteDialect } from \"kysely\";\n\n//#region src/adapters/kysely-adapter/dialect.ts\nfunction getKyselyDatabaseType(db) {\n\tif (!db) return null;\n\tif (\"dialect\" in db) return getKyselyDatabaseType(db.dialect);\n\tif (\"createDriver\" in db) {\n\t\tif (db instanceof SqliteDialect) return \"sqlite\";\n\t\tif (db instanceof MysqlDialect) return \"mysql\";\n\t\tif (db instanceof PostgresDialect) return \"postgres\";\n\t\tif (db instanceof MssqlDialect) return \"mssql\";\n\t}\n\tif (\"aggregate\" in db) return \"sqlite\";\n\tif (\"getConnection\" in db) return \"mysql\";\n\tif (\"connect\" in db) return \"postgres\";\n\tif (\"fileControl\" in db) return \"sqlite\";\n\tif (\"open\" in db && \"close\" in db && \"prepare\" in db) return \"sqlite\";\n\treturn null;\n}\nconst createKyselyAdapter = async (config) => {\n\tconst db = config.database;\n\tif (!db) return {\n\t\tkysely: null,\n\t\tdatabaseType: null,\n\t\ttransaction: void 0\n\t};\n\tif (\"db\" in db) return {\n\t\tkysely: db.db,\n\t\tdatabaseType: db.type,\n\t\ttransaction: db.transaction\n\t};\n\tif (\"dialect\" in db) return {\n\t\tkysely: new Kysely({ dialect: db.dialect }),\n\t\tdatabaseType: db.type,\n\t\ttransaction: db.transaction\n\t};\n\tlet dialect = void 0;\n\tconst databaseType = getKyselyDatabaseType(db);\n\tif (\"createDriver\" in db) dialect = db;\n\tif (\"aggregate\" in db && !(\"createSession\" in db)) dialect = new SqliteDialect({ database: db });\n\tif (\"getConnection\" in db) dialect = new MysqlDialect(db);\n\tif (\"connect\" in db) dialect = new PostgresDialect({ pool: db });\n\tif (\"fileControl\" in db) {\n\t\tconst { BunSqliteDialect } = await import(\"./bun-sqlite-dialect-C3P_ISb5.mjs\");\n\t\tdialect = new BunSqliteDialect({ database: db });\n\t}\n\tif (\"createSession\" in db && typeof window === \"undefined\") {\n\t\tlet DatabaseSync = void 0;\n\t\ttry {\n\t\t\tlet nodeSqlite = \"node:sqlite\";\n\t\t\t({DatabaseSync} = await import(\n\t\t\t\t/* @vite-ignore */\n\t\t\t\t/* webpackIgnore: true */\n\t\t\t\tnodeSqlite\n));\n\t\t} catch (error) {\n\t\t\tif (error !== null && typeof error === \"object\" && \"code\" in error && error.code !== \"ERR_UNKNOWN_BUILTIN_MODULE\") throw error;\n\t\t}\n\t\tif (DatabaseSync && db instanceof DatabaseSync) {\n\t\t\tconst { NodeSqliteDialect } = await import(\"./node-sqlite-dialect-D6w8Ekdz.mjs\");\n\t\t\tdialect = new NodeSqliteDialect({ database: db });\n\t\t}\n\t}\n\treturn {\n\t\tkysely: dialect ? new Kysely({ dialect }) : null,\n\t\tdatabaseType,\n\t\ttransaction: void 0\n\t};\n};\n\n//#endregion\nexport { getKyselyDatabaseType as n, createKyselyAdapter as t };"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAEA,gDAAgD;AAChD,SAAS,sBAAsB,EAAE;IAChC,IAAI,CAAC,IAAI,OAAO;IAChB,IAAI,aAAa,IAAI,OAAO,sBAAsB,GAAG,OAAO;IAC5D,IAAI,kBAAkB,IAAI;QACzB,IAAI,cAAc,kMAAa,EAAE,OAAO;QACxC,IAAI,cAAc,+LAAY,EAAE,OAAO;QACvC,IAAI,cAAc,wMAAe,EAAE,OAAO;QAC1C,IAAI,cAAc,+LAAY,EAAE,OAAO;IACxC;IACA,IAAI,eAAe,IAAI,OAAO;IAC9B,IAAI,mBAAmB,IAAI,OAAO;IAClC,IAAI,aAAa,IAAI,OAAO;IAC5B,IAAI,iBAAiB,IAAI,OAAO;IAChC,IAAI,UAAU,MAAM,WAAW,MAAM,aAAa,IAAI,OAAO;IAC7D,OAAO;AACR;AACA,MAAM,sBAAsB,OAAO;IAClC,MAAM,KAAK,OAAO,QAAQ;IAC1B,IAAI,CAAC,IAAI,OAAO;QACf,QAAQ;QACR,cAAc;QACd,aAAa,KAAK;IACnB;IACA,IAAI,QAAQ,IAAI,OAAO;QACtB,QAAQ,GAAG,EAAE;QACb,cAAc,GAAG,IAAI;QACrB,aAAa,GAAG,WAAW;IAC5B;IACA,IAAI,aAAa,IAAI,OAAO;QAC3B,QAAQ,IAAI,2JAAM,CAAC;YAAE,SAAS,GAAG,OAAO;QAAC;QACzC,cAAc,GAAG,IAAI;QACrB,aAAa,GAAG,WAAW;IAC5B;IACA,IAAI,UAAU,KAAK;IACnB,MAAM,eAAe,sBAAsB;IAC3C,IAAI,kBAAkB,IAAI,UAAU;IACpC,IAAI,eAAe,MAAM,CAAC,CAAC,mBAAmB,EAAE,GAAG,UAAU,IAAI,kMAAa,CAAC;QAAE,UAAU;IAAG;IAC9F,IAAI,mBAAmB,IAAI,UAAU,IAAI,+LAAY,CAAC;IACtD,IAAI,aAAa,IAAI,UAAU,IAAI,wMAAe,CAAC;QAAE,MAAM;IAAG;IAC9D,IAAI,iBAAiB,IAAI;QACxB,MAAM,EAAE,gBAAgB,EAAE,GAAG;QAC7B,UAAU,IAAI,iBAAiB;YAAE,UAAU;QAAG;IAC/C;IACA,IAAI,mBAAmB,MAAM,kDAAkB,aAAa;QAC3D,IAAI,eAAe,KAAK;QACxB,IAAI;YACH,IAAI,aAAa;YACjB,CAAC,EAAC,YAAY,EAAC,GAAG,MAAM,MAAM,CAC7B,gBAAgB,GAChB,uBAAuB,GACvB,WACH;QACC,EAAE,OAAO,OAAO;YACf,IAAI,UAAU,QAAQ,OAAO,UAAU,YAAY,UAAU,SAAS,MAAM,IAAI,KAAK,8BAA8B,MAAM;QAC1H;QACA,IAAI,gBAAgB,cAAc,cAAc;YAC/C,MAAM,EAAE,iBAAiB,EAAE,GAAG;YAC9B,UAAU,IAAI,kBAAkB;gBAAE,UAAU;YAAG;QAChD;IACD;IACA,OAAO;QACN,QAAQ,UAAU,IAAI,2JAAM,CAAC;YAAE;QAAQ,KAAK;QAC5C;QACA,aAAa,KAAK;IACnB;AACD","ignoreList":[0]}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/get-model-name-D4DUV7S2.mjs"],"sourcesContent":["import { BetterAuthError } from \"@better-auth/core/error\";\n\n//#region src/db/get-tables.ts\nconst getAuthTables = (options) => {\n\tconst pluginSchema = (options.plugins ?? []).reduce((acc, plugin) => {\n\t\tconst schema = plugin.schema;\n\t\tif (!schema) return acc;\n\t\tfor (const [key, value] of Object.entries(schema)) acc[key] = {\n\t\t\tfields: {\n\t\t\t\t...acc[key]?.fields,\n\t\t\t\t...value.fields\n\t\t\t},\n\t\t\tmodelName: value.modelName || key\n\t\t};\n\t\treturn acc;\n\t}, {});\n\tconst shouldAddRateLimitTable = options.rateLimit?.storage === \"database\";\n\tconst rateLimitTable = { rateLimit: {\n\t\tmodelName: options.rateLimit?.modelName || \"rateLimit\",\n\t\tfields: {\n\t\t\tkey: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tfieldName: options.rateLimit?.fields?.key || \"key\"\n\t\t\t},\n\t\t\tcount: {\n\t\t\t\ttype: \"number\",\n\t\t\t\tfieldName: options.rateLimit?.fields?.count || \"count\"\n\t\t\t},\n\t\t\tlastRequest: {\n\t\t\t\ttype: \"number\",\n\t\t\t\tbigint: true,\n\t\t\t\tfieldName: options.rateLimit?.fields?.lastRequest || \"lastRequest\"\n\t\t\t}\n\t\t}\n\t} };\n\tconst { user, session, account, ...pluginTables } = pluginSchema;\n\tconst sessionTable = { session: {\n\t\tmodelName: options.session?.modelName || \"session\",\n\t\tfields: {\n\t\t\texpiresAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t\trequired: true,\n\t\t\t\tfieldName: options.session?.fields?.expiresAt || \"expiresAt\"\n\t\t\t},\n\t\t\ttoken: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: true,\n\t\t\t\tfieldName: options.session?.fields?.token || \"token\",\n\t\t\t\tunique: true\n\t\t\t},\n\t\t\tcreatedAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t\trequired: true,\n\t\t\t\tfieldName: options.session?.fields?.createdAt || \"createdAt\",\n\t\t\t\tdefaultValue: () => /* @__PURE__ */ new Date()\n\t\t\t},\n\t\t\tupdatedAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t\trequired: true,\n\t\t\t\tfieldName: options.session?.fields?.updatedAt || \"updatedAt\",\n\t\t\t\tonUpdate: () => /* @__PURE__ */ new Date()\n\t\t\t},\n\t\t\tipAddress: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t\tfieldName: options.session?.fields?.ipAddress || \"ipAddress\"\n\t\t\t},\n\t\t\tuserAgent: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t\tfieldName: options.session?.fields?.userAgent || \"userAgent\"\n\t\t\t},\n\t\t\tuserId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tfieldName: options.session?.fields?.userId || \"userId\",\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: options.user?.modelName || \"user\",\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tonDelete: \"cascade\"\n\t\t\t\t},\n\t\t\t\trequired: true,\n\t\t\t\tindex: true\n\t\t\t},\n\t\t\t...session?.fields,\n\t\t\t...options.session?.additionalFields\n\t\t},\n\t\torder: 2\n\t} };\n\treturn {\n\t\tuser: {\n\t\t\tmodelName: options.user?.modelName || \"user\",\n\t\t\tfields: {\n\t\t\t\tname: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options.user?.fields?.name || \"name\",\n\t\t\t\t\tsortable: true\n\t\t\t\t},\n\t\t\t\temail: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\tunique: true,\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options.user?.fields?.email || \"email\",\n\t\t\t\t\tsortable: true\n\t\t\t\t},\n\t\t\t\temailVerified: {\n\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\tdefaultValue: false,\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options.user?.fields?.emailVerified || \"emailVerified\",\n\t\t\t\t\tinput: false\n\t\t\t\t},\n\t\t\t\timage: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: false,\n\t\t\t\t\tfieldName: options.user?.fields?.image || \"image\"\n\t\t\t\t},\n\t\t\t\tcreatedAt: {\n\t\t\t\t\ttype: \"date\",\n\t\t\t\t\tdefaultValue: () => /* @__PURE__ */ new Date(),\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options.user?.fields?.createdAt || \"createdAt\"\n\t\t\t\t},\n\t\t\t\tupdatedAt: {\n\t\t\t\t\ttype: \"date\",\n\t\t\t\t\tdefaultValue: () => /* @__PURE__ */ new Date(),\n\t\t\t\t\tonUpdate: () => /* @__PURE__ */ new Date(),\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options.user?.fields?.updatedAt || \"updatedAt\"\n\t\t\t\t},\n\t\t\t\t...user?.fields,\n\t\t\t\t...options.user?.additionalFields\n\t\t\t},\n\t\t\torder: 1\n\t\t},\n\t\t...!options.secondaryStorage || options.session?.storeSessionInDatabase ? sessionTable : {},\n\t\taccount: {\n\t\t\tmodelName: options.account?.modelName || \"account\",\n\t\t\tfields: {\n\t\t\t\taccountId: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options.account?.fields?.accountId || \"accountId\"\n\t\t\t\t},\n\t\t\t\tproviderId: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options.account?.fields?.providerId || \"providerId\"\n\t\t\t\t},\n\t\t\t\tuserId: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\treferences: {\n\t\t\t\t\t\tmodel: options.user?.modelName || \"user\",\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tonDelete: \"cascade\"\n\t\t\t\t\t},\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options.account?.fields?.userId || \"userId\",\n\t\t\t\t\tindex: true\n\t\t\t\t},\n\t\t\t\taccessToken: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: false,\n\t\t\t\t\tfieldName: options.account?.fields?.accessToken || \"accessToken\"\n\t\t\t\t},\n\t\t\t\trefreshToken: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: false,\n\t\t\t\t\tfieldName: options.account?.fields?.refreshToken || \"refreshToken\"\n\t\t\t\t},\n\t\t\t\tidToken: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: false,\n\t\t\t\t\tfieldName: options.account?.fields?.idToken || \"idToken\"\n\t\t\t\t},\n\t\t\t\taccessTokenExpiresAt: {\n\t\t\t\t\ttype: \"date\",\n\t\t\t\t\trequired: false,\n\t\t\t\t\tfieldName: options.account?.fields?.accessTokenExpiresAt || \"accessTokenExpiresAt\"\n\t\t\t\t},\n\t\t\t\trefreshTokenExpiresAt: {\n\t\t\t\t\ttype: \"date\",\n\t\t\t\t\trequired: false,\n\t\t\t\t\tfieldName: options.account?.fields?.refreshTokenExpiresAt || \"refreshTokenExpiresAt\"\n\t\t\t\t},\n\t\t\t\tscope: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: false,\n\t\t\t\t\tfieldName: options.account?.fields?.scope || \"scope\"\n\t\t\t\t},\n\t\t\t\tpassword: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: false,\n\t\t\t\t\tfieldName: options.account?.fields?.password || \"password\"\n\t\t\t\t},\n\t\t\t\tcreatedAt: {\n\t\t\t\t\ttype: \"date\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options.account?.fields?.createdAt || \"createdAt\",\n\t\t\t\t\tdefaultValue: () => /* @__PURE__ */ new Date()\n\t\t\t\t},\n\t\t\t\tupdatedAt: {\n\t\t\t\t\ttype: \"date\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options.account?.fields?.updatedAt || \"updatedAt\",\n\t\t\t\t\tonUpdate: () => /* @__PURE__ */ new Date()\n\t\t\t\t},\n\t\t\t\t...account?.fields,\n\t\t\t\t...options.account?.additionalFields\n\t\t\t},\n\t\t\torder: 3\n\t\t},\n\t\tverification: {\n\t\t\tmodelName: options.verification?.modelName || \"verification\",\n\t\t\tfields: {\n\t\t\t\tidentifier: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options.verification?.fields?.identifier || \"identifier\",\n\t\t\t\t\tindex: true\n\t\t\t\t},\n\t\t\t\tvalue: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options.verification?.fields?.value || \"value\"\n\t\t\t\t},\n\t\t\t\texpiresAt: {\n\t\t\t\t\ttype: \"date\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options.verification?.fields?.expiresAt || \"expiresAt\"\n\t\t\t\t},\n\t\t\t\tcreatedAt: {\n\t\t\t\t\ttype: \"date\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tdefaultValue: () => /* @__PURE__ */ new Date(),\n\t\t\t\t\tfieldName: options.verification?.fields?.createdAt || \"createdAt\"\n\t\t\t\t},\n\t\t\t\tupdatedAt: {\n\t\t\t\t\ttype: \"date\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tdefaultValue: () => /* @__PURE__ */ new Date(),\n\t\t\t\t\tonUpdate: () => /* @__PURE__ */ new Date(),\n\t\t\t\t\tfieldName: options.verification?.fields?.updatedAt || \"updatedAt\"\n\t\t\t\t}\n\t\t\t},\n\t\t\torder: 4\n\t\t},\n\t\t...pluginTables,\n\t\t...shouldAddRateLimitTable ? rateLimitTable : {}\n\t};\n};\n\n//#endregion\n//#region src/adapters/adapter-factory/get-default-model-name.ts\nconst initGetDefaultModelName = ({ usePlural, schema }) => {\n\t/**\n\t* This function helps us get the default model name from the schema defined by devs.\n\t* Often times, the user will be using the `modelName` which could had been customized by the users.\n\t* This function helps us get the actual model name useful to match against the schema. (eg: schema[model])\n\t*\n\t* If it's still unclear what this does:\n\t*\n\t* 1. User can define a custom modelName.\n\t* 2. When using a custom modelName, doing something like `schema[model]` will not work.\n\t* 3. Using this function helps us get the actual model name based on the user's defined custom modelName.\n\t*/\n\tconst getDefaultModelName = (model) => {\n\t\tif (usePlural && model.charAt(model.length - 1) === \"s\") {\n\t\t\tlet pluralessModel = model.slice(0, -1);\n\t\t\tlet m$1 = schema[pluralessModel] ? pluralessModel : void 0;\n\t\t\tif (!m$1) m$1 = Object.entries(schema).find(([_, f]) => f.modelName === pluralessModel)?.[0];\n\t\t\tif (m$1) return m$1;\n\t\t}\n\t\tlet m = schema[model] ? model : void 0;\n\t\tif (!m) m = Object.entries(schema).find(([_, f]) => f.modelName === model)?.[0];\n\t\tif (!m) throw new BetterAuthError(`Model \"${model}\" not found in schema`);\n\t\treturn m;\n\t};\n\treturn getDefaultModelName;\n};\n\n//#endregion\n//#region src/adapters/adapter-factory/get-default-field-name.ts\nconst initGetDefaultFieldName = ({ schema, usePlural }) => {\n\tconst getDefaultModelName = initGetDefaultModelName({\n\t\tschema,\n\t\tusePlural\n\t});\n\t/**\n\t* This function helps us get the default field name from the schema defined by devs.\n\t* Often times, the user will be using the `fieldName` which could had been customized by the users.\n\t* This function helps us get the actual field name useful to match against the schema. (eg: schema[model].fields[field])\n\t*\n\t* If it's still unclear what this does:\n\t*\n\t* 1. User can define a custom fieldName.\n\t* 2. When using a custom fieldName, doing something like `schema[model].fields[field]` will not work.\n\t*/\n\tconst getDefaultFieldName = ({ field, model: unsafeModel }) => {\n\t\tif (field === \"id\" || field === \"_id\") return \"id\";\n\t\tconst model = getDefaultModelName(unsafeModel);\n\t\tlet f = schema[model]?.fields[field];\n\t\tif (!f) {\n\t\t\tconst result = Object.entries(schema[model].fields).find(([_, f$1]) => f$1.fieldName === field);\n\t\t\tif (result) {\n\t\t\t\tf = result[1];\n\t\t\t\tfield = result[0];\n\t\t\t}\n\t\t}\n\t\tif (!f) throw new BetterAuthError(`Field ${field} not found in model ${model}`);\n\t\treturn field;\n\t};\n\treturn getDefaultFieldName;\n};\n\n//#endregion\n//#region src/adapters/adapter-factory/get-field-name.ts\nconst initGetFieldName = ({ schema, usePlural }) => {\n\tconst getDefaultModelName = initGetDefaultModelName({\n\t\tschema,\n\t\tusePlural\n\t});\n\tconst getDefaultFieldName = initGetDefaultFieldName({\n\t\tschema,\n\t\tusePlural\n\t});\n\t/**\n\t* Get the field name which is expected to be saved in the database based on the user's schema.\n\t*\n\t* This function is useful if you need to save the field name to the database.\n\t*\n\t* For example, if the user has defined a custom field name for the `user` model, then you can use this function to get the actual field name from the schema.\n\t*/\n\tfunction getFieldName({ model: modelName, field: fieldName }) {\n\t\tconst model = getDefaultModelName(modelName);\n\t\tconst field = getDefaultFieldName({\n\t\t\tmodel,\n\t\t\tfield: fieldName\n\t\t});\n\t\treturn schema[model]?.fields[field]?.fieldName || field;\n\t}\n\treturn getFieldName;\n};\n\n//#endregion\n//#region src/adapters/adapter-factory/get-model-name.ts\nconst initGetModelName = ({ usePlural, schema }) => {\n\tconst getDefaultModelName = initGetDefaultModelName({\n\t\tschema,\n\t\tusePlural\n\t});\n\t/**\n\t* Users can overwrite the default model of some tables. This function helps find the correct model name.\n\t* Furthermore, if the user passes `usePlural` as true in their adapter config,\n\t* then we should return the model name ending with an `s`.\n\t*/\n\tconst getModelName = (model) => {\n\t\tconst defaultModelKey = getDefaultModelName(model);\n\t\tif (schema && schema[defaultModelKey] && schema[defaultModelKey].modelName !== model) return usePlural ? `${schema[defaultModelKey].modelName}s` : schema[defaultModelKey].modelName;\n\t\treturn usePlural ? `${model}s` : model;\n\t};\n\treturn getModelName;\n};\n\n//#endregion\nexport { getAuthTables as a, initGetDefaultModelName as i, initGetFieldName as n, initGetDefaultFieldName as r, initGetModelName as t };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 473, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/crypto-CFUhAR9W.mjs"],"sourcesContent":["import { BetterAuthError } from \"@better-auth/core/error\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport { xchacha20poly1305 } from \"@noble/ciphers/chacha.js\";\nimport { bytesToHex, hexToBytes, managedNonce, utf8ToBytes } from \"@noble/ciphers/utils.js\";\nimport { hkdf } from \"@noble/hashes/hkdf.js\";\nimport { sha256 } from \"@noble/hashes/sha2.js\";\nimport { EncryptJWT, SignJWT, base64url, calculateJwkThumbprint, jwtDecrypt, jwtVerify } from \"jose\";\nimport { hex } from \"@better-auth/utils/hex\";\nimport { scryptAsync } from \"@noble/hashes/scrypt.js\";\nimport { hexToBytes as hexToBytes$1 } from \"@noble/hashes/utils.js\";\nimport { createRandomStringGenerator } from \"@better-auth/utils/random\";\n\n//#region src/crypto/buffer.ts\n/**\n* Compare two buffers in constant time.\n*/\nfunction constantTimeEqual(a, b) {\n\tif (typeof a === \"string\") a = new TextEncoder().encode(a);\n\tif (typeof b === \"string\") b = new TextEncoder().encode(b);\n\tconst aBuffer = new Uint8Array(a);\n\tconst bBuffer = new Uint8Array(b);\n\tlet c = aBuffer.length ^ bBuffer.length;\n\tconst length = Math.max(aBuffer.length, bBuffer.length);\n\tfor (let i = 0; i < length; i++) c |= (i < aBuffer.length ? aBuffer[i] : 0) ^ (i < bBuffer.length ? bBuffer[i] : 0);\n\treturn c === 0;\n}\n\n//#endregion\n//#region src/crypto/jwt.ts\nasync function signJWT(payload, secret, expiresIn = 3600) {\n\treturn await new SignJWT(payload).setProtectedHeader({ alg: \"HS256\" }).setIssuedAt().setExpirationTime(Math.floor(Date.now() / 1e3) + expiresIn).sign(new TextEncoder().encode(secret));\n}\nasync function verifyJWT(token, secret) {\n\ttry {\n\t\treturn (await jwtVerify(token, new TextEncoder().encode(secret))).payload;\n\t} catch (error) {\n\t\treturn null;\n\t}\n}\nconst info = new Uint8Array([\n\t66,\n\t101,\n\t116,\n\t116,\n\t101,\n\t114,\n\t65,\n\t117,\n\t116,\n\t104,\n\t46,\n\t106,\n\t115,\n\t32,\n\t71,\n\t101,\n\t110,\n\t101,\n\t114,\n\t97,\n\t116,\n\t101,\n\t100,\n\t32,\n\t69,\n\t110,\n\t99,\n\t114,\n\t121,\n\t112,\n\t116,\n\t105,\n\t111,\n\t110,\n\t32,\n\t75,\n\t101,\n\t121\n]);\nconst now = () => Date.now() / 1e3 | 0;\nconst alg = \"dir\";\nconst enc = \"A256CBC-HS512\";\nasync function symmetricEncodeJWT(payload, secret, salt, expiresIn = 3600) {\n\tconst encryptionSecret = hkdf(sha256, new TextEncoder().encode(secret), new TextEncoder().encode(salt), info, 64);\n\tconst thumbprint = await calculateJwkThumbprint({\n\t\tkty: \"oct\",\n\t\tk: base64url.encode(encryptionSecret)\n\t}, \"sha256\");\n\treturn await new EncryptJWT(payload).setProtectedHeader({\n\t\talg,\n\t\tenc,\n\t\tkid: thumbprint\n\t}).setIssuedAt().setExpirationTime(now() + expiresIn).setJti(crypto.randomUUID()).encrypt(encryptionSecret);\n}\nasync function symmetricDecodeJWT(token, secret, salt) {\n\tif (!token) return null;\n\ttry {\n\t\tconst { payload } = await jwtDecrypt(token, async ({ kid }) => {\n\t\t\tconst encryptionSecret = hkdf(sha256, new TextEncoder().encode(secret), new TextEncoder().encode(salt), info, 64);\n\t\t\tif (kid === void 0) return encryptionSecret;\n\t\t\tif (kid === await calculateJwkThumbprint({\n\t\t\t\tkty: \"oct\",\n\t\t\t\tk: base64url.encode(encryptionSecret)\n\t\t\t}, \"sha256\")) return encryptionSecret;\n\t\t\tthrow new Error(\"no matching decryption secret\");\n\t\t}, {\n\t\t\tclockTolerance: 15,\n\t\t\tkeyManagementAlgorithms: [alg],\n\t\t\tcontentEncryptionAlgorithms: [enc, \"A256GCM\"]\n\t\t});\n\t\treturn payload;\n\t} catch (error) {\n\t\treturn null;\n\t}\n}\n\n//#endregion\n//#region src/crypto/password.ts\nconst config = {\n\tN: 16384,\n\tr: 16,\n\tp: 1,\n\tdkLen: 64\n};\nasync function generateKey(password, salt) {\n\treturn await scryptAsync(password.normalize(\"NFKC\"), salt, {\n\t\tN: config.N,\n\t\tp: config.p,\n\t\tr: config.r,\n\t\tdkLen: config.dkLen,\n\t\tmaxmem: 128 * config.N * config.r * 2\n\t});\n}\nconst hashPassword = async (password) => {\n\tconst salt = hex.encode(crypto.getRandomValues(new Uint8Array(16)));\n\tconst key = await generateKey(password, salt);\n\treturn `${salt}:${hex.encode(key)}`;\n};\nconst verifyPassword = async ({ hash, password }) => {\n\tconst [salt, key] = hash.split(\":\");\n\tif (!salt || !key) throw new BetterAuthError(\"Invalid password hash\");\n\treturn constantTimeEqual(await generateKey(password, salt), hexToBytes$1(key));\n};\n\n//#endregion\n//#region src/crypto/random.ts\nconst generateRandomString = createRandomStringGenerator(\"a-z\", \"0-9\", \"A-Z\", \"-_\");\n\n//#endregion\n//#region src/crypto/index.ts\nconst symmetricEncrypt = async ({ key, data }) => {\n\tconst keyAsBytes = await createHash(\"SHA-256\").digest(key);\n\tconst dataAsBytes = utf8ToBytes(data);\n\treturn bytesToHex(managedNonce(xchacha20poly1305)(new Uint8Array(keyAsBytes)).encrypt(dataAsBytes));\n};\nconst symmetricDecrypt = async ({ key, data }) => {\n\tconst keyAsBytes = await createHash(\"SHA-256\").digest(key);\n\tconst dataAsBytes = hexToBytes(data);\n\tconst chacha = managedNonce(xchacha20poly1305)(new Uint8Array(keyAsBytes));\n\treturn new TextDecoder().decode(chacha.decrypt(dataAsBytes));\n};\n\n//#endregion\nexport { verifyPassword as a, symmetricEncodeJWT as c, hashPassword as i, verifyJWT as l, symmetricEncrypt as n, signJWT as o, generateRandomString as r, symmetricDecodeJWT as s, symmetricDecrypt as t, constantTimeEqual as u };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 679, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/utils-db7gNqd-.mjs"],"sourcesContent":["import { n as symmetricEncrypt, r as generateRandomString, t as symmetricDecrypt } from \"./crypto-CFUhAR9W.mjs\";\nimport { defineRequestState } from \"@better-auth/core/context\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { createRandomStringGenerator } from \"@better-auth/utils/random\";\n\n//#region src/api/middlewares/oauth.ts\nconst { get: getOAuthState, set: setOAuthState } = defineRequestState(() => null);\n\n//#endregion\n//#region src/oauth2/state.ts\nasync function generateState(c, link, additionalData) {\n\tconst callbackURL = c.body?.callbackURL || c.context.options.baseURL;\n\tif (!callbackURL) throw new APIError(\"BAD_REQUEST\", { message: \"callbackURL is required\" });\n\tconst codeVerifier = generateRandomString(128);\n\tconst state = generateRandomString(32);\n\tconst storeStateStrategy = c.context.oauthConfig?.storeStateStrategy || \"cookie\";\n\tconst stateData = {\n\t\t...additionalData ? additionalData : {},\n\t\tcallbackURL,\n\t\tcodeVerifier,\n\t\terrorURL: c.body?.errorCallbackURL,\n\t\tnewUserURL: c.body?.newUserCallbackURL,\n\t\tlink,\n\t\texpiresAt: Date.now() + 600 * 1e3,\n\t\trequestSignUp: c.body?.requestSignUp\n\t};\n\tawait setOAuthState(stateData);\n\tif (storeStateStrategy === \"cookie\") {\n\t\tconst encryptedData = await symmetricEncrypt({\n\t\t\tkey: c.context.secret,\n\t\t\tdata: JSON.stringify(stateData)\n\t\t});\n\t\tconst stateCookie$1 = c.context.createAuthCookie(\"oauth_state\", { maxAge: 600 * 1e3 });\n\t\tc.setCookie(stateCookie$1.name, encryptedData, stateCookie$1.attributes);\n\t\treturn {\n\t\t\tstate,\n\t\t\tcodeVerifier\n\t\t};\n\t}\n\tconst stateCookie = c.context.createAuthCookie(\"state\", { maxAge: 300 * 1e3 });\n\tawait c.setSignedCookie(stateCookie.name, state, c.context.secret, stateCookie.attributes);\n\tconst expiresAt = /* @__PURE__ */ new Date();\n\texpiresAt.setMinutes(expiresAt.getMinutes() + 10);\n\tconst verification = await c.context.internalAdapter.createVerificationValue({\n\t\tvalue: JSON.stringify(stateData),\n\t\tidentifier: state,\n\t\texpiresAt\n\t});\n\tif (!verification) {\n\t\tc.context.logger.error(\"Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database\");\n\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", { message: \"Unable to create verification\" });\n\t}\n\treturn {\n\t\tstate: verification.identifier,\n\t\tcodeVerifier\n\t};\n}\nasync function parseState(c) {\n\tconst state = c.query.state || c.body.state;\n\tconst storeStateStrategy = c.context.oauthConfig.storeStateStrategy || \"cookie\";\n\tconst stateDataSchema = z.looseObject({\n\t\tcallbackURL: z.string(),\n\t\tcodeVerifier: z.string(),\n\t\terrorURL: z.string().optional(),\n\t\tnewUserURL: z.string().optional(),\n\t\texpiresAt: z.number(),\n\t\tlink: z.object({\n\t\t\temail: z.string(),\n\t\t\tuserId: z.coerce.string()\n\t\t}).optional(),\n\t\trequestSignUp: z.boolean().optional()\n\t});\n\tlet parsedData;\n\tif (storeStateStrategy === \"cookie\") {\n\t\tconst stateCookie = c.context.createAuthCookie(\"oauth_state\");\n\t\tconst encryptedData = c.getCookie(stateCookie.name);\n\t\tif (!encryptedData) {\n\t\t\tc.context.logger.error(\"State Mismatch. OAuth state cookie not found\", { state });\n\t\t\tconst errorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;\n\t\t\tthrow c.redirect(`${errorURL}?error=please_restart_the_process`);\n\t\t}\n\t\ttry {\n\t\t\tconst decryptedData = await symmetricDecrypt({\n\t\t\t\tkey: c.context.secret,\n\t\t\t\tdata: encryptedData\n\t\t\t});\n\t\t\tparsedData = stateDataSchema.parse(JSON.parse(decryptedData));\n\t\t} catch (error) {\n\t\t\tc.context.logger.error(\"Failed to decrypt or parse OAuth state cookie\", { error });\n\t\t\tconst errorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;\n\t\t\tthrow c.redirect(`${errorURL}?error=please_restart_the_process`);\n\t\t}\n\t\tc.setCookie(stateCookie.name, \"\", { maxAge: 0 });\n\t} else {\n\t\tconst data = await c.context.internalAdapter.findVerificationValue(state);\n\t\tif (!data) {\n\t\t\tc.context.logger.error(\"State Mismatch. Verification not found\", { state });\n\t\t\tconst errorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;\n\t\t\tthrow c.redirect(`${errorURL}?error=please_restart_the_process`);\n\t\t}\n\t\tparsedData = stateDataSchema.parse(JSON.parse(data.value));\n\t\tconst stateCookie = c.context.createAuthCookie(\"state\");\n\t\tconst stateCookieValue = await c.getSignedCookie(stateCookie.name, c.context.secret);\n\t\tif (!c.context.oauthConfig?.skipStateCookieCheck && (!stateCookieValue || stateCookieValue !== state)) {\n\t\t\tconst errorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;\n\t\t\tthrow c.redirect(`${errorURL}?error=state_mismatch`);\n\t\t}\n\t\tc.setCookie(stateCookie.name, \"\", { maxAge: 0 });\n\t\tawait c.context.internalAdapter.deleteVerificationValue(data.id);\n\t}\n\tif (!parsedData.errorURL) parsedData.errorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;\n\tif (parsedData.expiresAt < Date.now()) {\n\t\tconst errorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;\n\t\tthrow c.redirect(`${errorURL}?error=please_restart_the_process`);\n\t}\n\tif (parsedData) await setOAuthState(parsedData);\n\treturn parsedData;\n}\n\n//#endregion\n//#region src/utils/hide-metadata.ts\nconst HIDE_METADATA = { isAction: false };\n\n//#endregion\n//#region src/utils/id.ts\nconst generateId = (size) => {\n\treturn createRandomStringGenerator(\"a-z\", \"A-Z\", \"0-9\")(size || 32);\n};\n\n//#endregion\nexport { getOAuthState as a, parseState as i, HIDE_METADATA as n, generateState as r, generateId as t };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 848, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/schema-Bb7wzeK_.mjs"],"sourcesContent":["import { APIError } from \"better-call\";\n\n//#region src/utils/date.ts\nconst getDate = (span, unit = \"ms\") => {\n\treturn new Date(Date.now() + (unit === \"sec\" ? span * 1e3 : span));\n};\n\n//#endregion\n//#region src/db/schema.ts\nconst cache = /* @__PURE__ */ new WeakMap();\nfunction parseOutputData(data, schema) {\n\tconst fields = schema.fields;\n\tconst parsedData = {};\n\tfor (const key in data) {\n\t\tconst field = fields[key];\n\t\tif (!field) {\n\t\t\tparsedData[key] = data[key];\n\t\t\tcontinue;\n\t\t}\n\t\tif (field.returned === false) continue;\n\t\tparsedData[key] = data[key];\n\t}\n\treturn parsedData;\n}\nfunction getAllFields(options, table) {\n\tif (!cache.has(options)) cache.set(options, /* @__PURE__ */ new Map());\n\tconst tableCache = cache.get(options);\n\tif (tableCache.has(table)) return tableCache.get(table);\n\tlet schema = {\n\t\t...table === \"user\" ? options.user?.additionalFields : {},\n\t\t...table === \"session\" ? options.session?.additionalFields : {}\n\t};\n\tfor (const plugin of options.plugins || []) if (plugin.schema && plugin.schema[table]) schema = {\n\t\t...schema,\n\t\t...plugin.schema[table].fields\n\t};\n\tcache.get(options).set(table, schema);\n\treturn schema;\n}\nfunction parseUserOutput(options, user) {\n\treturn {\n\t\t...parseOutputData(user, { fields: getAllFields(options, \"user\") }),\n\t\tid: user.id\n\t};\n}\nfunction parseAccountOutput(options, account) {\n\treturn parseOutputData(account, { fields: getAllFields(options, \"account\") });\n}\nfunction parseSessionOutput(options, session) {\n\treturn parseOutputData(session, { fields: getAllFields(options, \"session\") });\n}\nfunction parseInputData(data, schema) {\n\tconst action = schema.action || \"create\";\n\tconst fields = schema.fields;\n\tconst parsedData = Object.assign(Object.create(null), null);\n\tfor (const key in fields) {\n\t\tif (key in data) {\n\t\t\tif (fields[key].input === false) {\n\t\t\t\tif (fields[key].defaultValue !== void 0) {\n\t\t\t\t\tif (action !== \"update\") {\n\t\t\t\t\t\tparsedData[key] = fields[key].defaultValue;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (data[key]) throw new APIError(\"BAD_REQUEST\", { message: `${key} is not allowed to be set` });\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (fields[key].validator?.input && data[key] !== void 0) {\n\t\t\t\tparsedData[key] = fields[key].validator.input[\"~standard\"].validate(data[key]);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (fields[key].transform?.input && data[key] !== void 0) {\n\t\t\t\tparsedData[key] = fields[key].transform?.input(data[key]);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tparsedData[key] = data[key];\n\t\t\tcontinue;\n\t\t}\n\t\tif (fields[key].defaultValue !== void 0 && action === \"create\") {\n\t\t\tif (typeof fields[key].defaultValue === \"function\") {\n\t\t\t\tparsedData[key] = fields[key].defaultValue();\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tparsedData[key] = fields[key].defaultValue;\n\t\t\tcontinue;\n\t\t}\n\t\tif (fields[key].required && action === \"create\") throw new APIError(\"BAD_REQUEST\", { message: `${key} is required` });\n\t}\n\treturn parsedData;\n}\nfunction parseUserInput(options, user = {}, action) {\n\treturn parseInputData(user, {\n\t\tfields: getAllFields(options, \"user\"),\n\t\taction\n\t});\n}\nfunction parseAdditionalUserInput(options, user) {\n\tconst schema = getAllFields(options, \"user\");\n\treturn parseInputData(user || {}, { fields: schema });\n}\nfunction parseAccountInput(options, account) {\n\treturn parseInputData(account, { fields: getAllFields(options, \"account\") });\n}\nfunction parseSessionInput(options, session) {\n\treturn parseInputData(session, { fields: getAllFields(options, \"session\") });\n}\nfunction mergeSchema(schema, newSchema) {\n\tif (!newSchema) return schema;\n\tfor (const table in newSchema) {\n\t\tconst newModelName = newSchema[table]?.modelName;\n\t\tif (newModelName) schema[table].modelName = newModelName;\n\t\tfor (const field in schema[table].fields) {\n\t\t\tconst newField = newSchema[table]?.fields?.[field];\n\t\t\tif (!newField) continue;\n\t\t\tschema[table].fields[field].fieldName = newField;\n\t\t}\n\t}\n\treturn schema;\n}\n\n//#endregion\nexport { parseInputData as a, parseUserInput as c, parseAdditionalUserInput as i, parseUserOutput as l, parseAccountInput as n, parseSessionInput as o, parseAccountOutput as r, parseSessionOutput as s, mergeSchema as t, getDate as u };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 1009, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/get-request-ip-D6st-mto.mjs"],"sourcesContent":["import { isDevelopment, isTest } from \"@better-auth/core/env\";\nimport * as z from \"zod\";\n\n//#region src/utils/get-request-ip.ts\nconst LOCALHOST_IP = \"127.0.0.1\";\nfunction getIp(req, options) {\n\tif (options.advanced?.ipAddress?.disableIpTracking) return null;\n\tif (isTest() || isDevelopment()) return LOCALHOST_IP;\n\tconst headers = \"headers\" in req ? req.headers : req;\n\tconst ipHeaders = options.advanced?.ipAddress?.ipAddressHeaders || [\"x-forwarded-for\"];\n\tfor (const key of ipHeaders) {\n\t\tconst value = \"get\" in headers ? headers.get(key) : headers[key];\n\t\tif (typeof value === \"string\") {\n\t\t\tconst ip = value.split(\",\")[0].trim();\n\t\t\tif (isValidIP(ip)) return ip;\n\t\t}\n\t}\n\treturn null;\n}\nfunction isValidIP(ip) {\n\tif (z.ipv4().safeParse(ip).success) return true;\n\tif (z.ipv6().safeParse(ip).success) return true;\n\treturn false;\n}\n\n//#endregion\nexport { getIp as t };"],"names":[],"mappings":";;;;AAAA;AAAA;AAAA;AACA;;;AAEA,qCAAqC;AACrC,MAAM,eAAe;AACrB,SAAS,MAAM,GAAG,EAAE,OAAO;IAC1B,IAAI,QAAQ,QAAQ,EAAE,WAAW,mBAAmB,OAAO;IAC3D,IAAI,IAAA,+MAAM,OAAM,IAAA,6NAAa,KAAI,OAAO;IACxC,MAAM,UAAU,aAAa,MAAM,IAAI,OAAO,GAAG;IACjD,MAAM,YAAY,QAAQ,QAAQ,EAAE,WAAW,oBAAoB;QAAC;KAAkB;IACtF,KAAK,MAAM,OAAO,UAAW;QAC5B,MAAM,QAAQ,SAAS,UAAU,QAAQ,GAAG,CAAC,OAAO,OAAO,CAAC,IAAI;QAChE,IAAI,OAAO,UAAU,UAAU;YAC9B,MAAM,KAAK,MAAM,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI;YACnC,IAAI,UAAU,KAAK,OAAO;QAC3B;IACD;IACA,OAAO;AACR;AACA,SAAS,UAAU,EAAE;IACpB,IAAI,yJAAM,GAAG,SAAS,CAAC,IAAI,OAAO,EAAE,OAAO;IAC3C,IAAI,yJAAM,GAAG,SAAS,CAAC,IAAI,OAAO,EAAE,OAAO;IAC3C,OAAO;AACR","ignoreList":[0]}},
    {"offset": {"line": 1047, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/json-CnHxKYpj.mjs"],"sourcesContent":["import { logger } from \"@better-auth/core/env\";\n\n//#region src/utils/json.ts\nfunction safeJSONParse(data) {\n\tfunction reviver(_, value) {\n\t\tif (typeof value === \"string\") {\n\t\t\tif (/^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:\\.\\d+)?Z$/.test(value)) {\n\t\t\t\tconst date = new Date(value);\n\t\t\t\tif (!isNaN(date.getTime())) return date;\n\t\t\t}\n\t\t}\n\t\treturn value;\n\t}\n\ttry {\n\t\tif (typeof data !== \"string\") return data;\n\t\treturn JSON.parse(data, reviver);\n\t} catch (e) {\n\t\tlogger.error(\"Error parsing JSON\", { error: e });\n\t\treturn null;\n\t}\n}\n\n//#endregion\nexport { safeJSONParse as t };"],"names":[],"mappings":";;;;AAAA;AAAA;;AAEA,2BAA2B;AAC3B,SAAS,cAAc,IAAI;IAC1B,SAAS,QAAQ,CAAC,EAAE,KAAK;QACxB,IAAI,OAAO,UAAU,UAAU;YAC9B,IAAI,mDAAmD,IAAI,CAAC,QAAQ;gBACnE,MAAM,OAAO,IAAI,KAAK;gBACtB,IAAI,CAAC,MAAM,KAAK,OAAO,KAAK,OAAO;YACpC;QACD;QACA,OAAO;IACR;IACA,IAAI;QACH,IAAI,OAAO,SAAS,UAAU,OAAO;QACrC,OAAO,KAAK,KAAK,CAAC,MAAM;IACzB,EAAE,OAAO,GAAG;QACX,+MAAM,CAAC,KAAK,CAAC,sBAAsB;YAAE,OAAO;QAAE;QAC9C,OAAO;IACR;AACD","ignoreList":[0]}},
    {"offset": {"line": 1080, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/get-migration-Bf0TuCzm.mjs"],"sourcesContent":["import { t as createKyselyAdapter } from \"./dialect-D9ZUZA4J.mjs\";\nimport { a as getAuthTables, n as initGetFieldName, t as initGetModelName } from \"./get-model-name-D4DUV7S2.mjs\";\nimport { t as generateId } from \"./utils-db7gNqd-.mjs\";\nimport { l as parseUserOutput, o as parseSessionInput, s as parseSessionOutput, u as getDate } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as getIp } from \"./get-request-ip-D6st-mto.mjs\";\nimport { t as safeJSONParse } from \"./json-CnHxKYpj.mjs\";\nimport { getCurrentAdapter, getCurrentAuthContext, runWithTransaction } from \"@better-auth/core/context\";\nimport { createLogger, logger } from \"@better-auth/core/env\";\nimport { BetterAuthError } from \"@better-auth/core/error\";\nimport { sql } from \"kysely\";\nimport * as z from \"zod\";\n\n//#region src/db/adapter-base.ts\nasync function getBaseAdapter(options, handleDirectDatabase) {\n\tlet adapter;\n\tif (!options.database) {\n\t\tconst tables = getAuthTables(options);\n\t\tconst memoryDB = Object.keys(tables).reduce((acc, key) => {\n\t\t\tacc[key] = [];\n\t\t\treturn acc;\n\t\t}, {});\n\t\tconst { memoryAdapter } = await import(\"./adapters/memory-adapter/index.mjs\");\n\t\tadapter = memoryAdapter(memoryDB)(options);\n\t} else if (typeof options.database === \"function\") adapter = options.database(options);\n\telse adapter = await handleDirectDatabase(options);\n\tif (!adapter.transaction) {\n\t\tlogger.warn(\"Adapter does not correctly implement transaction function, patching it automatically. Please update your adapter implementation.\");\n\t\tadapter.transaction = async (cb) => {\n\t\t\treturn cb(adapter);\n\t\t};\n\t}\n\treturn adapter;\n}\n\n//#endregion\n//#region src/db/adapter-kysely.ts\nasync function getAdapter(options) {\n\treturn getBaseAdapter(options, async (opts) => {\n\t\tconst { createKyselyAdapter: createKyselyAdapter$1 } = await import(\"./adapters/kysely-adapter/index.mjs\");\n\t\tconst { kysely, databaseType, transaction } = await createKyselyAdapter$1(opts);\n\t\tif (!kysely) throw new BetterAuthError(\"Failed to initialize database adapter\");\n\t\tconst { kyselyAdapter } = await import(\"./adapters/kysely-adapter/index.mjs\");\n\t\treturn kyselyAdapter(kysely, {\n\t\t\ttype: databaseType || \"sqlite\",\n\t\t\tdebugLogs: opts.database && \"debugLogs\" in opts.database ? opts.database.debugLogs : false,\n\t\t\ttransaction\n\t\t})(opts);\n\t});\n}\n\n//#endregion\n//#region src/db/field.ts\nconst createFieldAttribute = (type, config) => {\n\treturn {\n\t\ttype,\n\t\t...config\n\t};\n};\n\n//#endregion\n//#region src/db/field-converter.ts\nfunction convertToDB(fields, values) {\n\tlet result = values.id ? { id: values.id } : {};\n\tfor (const key in fields) {\n\t\tconst field = fields[key];\n\t\tconst value = values[key];\n\t\tif (value === void 0) continue;\n\t\tresult[field.fieldName || key] = value;\n\t}\n\treturn result;\n}\nfunction convertFromDB(fields, values) {\n\tif (!values) return null;\n\tlet result = { id: values.id };\n\tfor (const [key, value] of Object.entries(fields)) result[key] = values[value.fieldName || key];\n\treturn result;\n}\n\n//#endregion\n//#region src/db/with-hooks.ts\nfunction getWithHooks(adapter, ctx) {\n\tconst hooks = ctx.hooks;\n\tasync function createWithHooks(data, model, customCreateFn) {\n\t\tconst context = await getCurrentAuthContext();\n\t\tlet actualData = data;\n\t\tfor (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.create?.before;\n\t\t\tif (toRun) {\n\t\t\t\tconst result = await toRun(actualData, context);\n\t\t\t\tif (result === false) return null;\n\t\t\t\tif (typeof result === \"object\" && \"data\" in result) actualData = {\n\t\t\t\t\t...actualData,\n\t\t\t\t\t...result.data\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tconst customCreated = customCreateFn ? await customCreateFn.fn(actualData) : null;\n\t\tconst created = !customCreateFn || customCreateFn.executeMainFn ? await (await getCurrentAdapter(adapter)).create({\n\t\t\tmodel,\n\t\t\tdata: actualData,\n\t\t\tforceAllowId: true\n\t\t}) : customCreated;\n\t\tfor (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.create?.after;\n\t\t\tif (toRun) await toRun(created, context);\n\t\t}\n\t\treturn created;\n\t}\n\tasync function updateWithHooks(data, where, model, customUpdateFn) {\n\t\tconst context = await getCurrentAuthContext();\n\t\tlet actualData = data;\n\t\tfor (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.update?.before;\n\t\t\tif (toRun) {\n\t\t\t\tconst result = await toRun(data, context);\n\t\t\t\tif (result === false) return null;\n\t\t\t\tif (typeof result === \"object\" && \"data\" in result) actualData = {\n\t\t\t\t\t...actualData,\n\t\t\t\t\t...result.data\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tconst customUpdated = customUpdateFn ? await customUpdateFn.fn(actualData) : null;\n\t\tconst updated = !customUpdateFn || customUpdateFn.executeMainFn ? await (await getCurrentAdapter(adapter)).update({\n\t\t\tmodel,\n\t\t\tupdate: actualData,\n\t\t\twhere\n\t\t}) : customUpdated;\n\t\tfor (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.update?.after;\n\t\t\tif (toRun) await toRun(updated, context);\n\t\t}\n\t\treturn updated;\n\t}\n\tasync function updateManyWithHooks(data, where, model, customUpdateFn) {\n\t\tconst context = await getCurrentAuthContext();\n\t\tlet actualData = data;\n\t\tfor (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.update?.before;\n\t\t\tif (toRun) {\n\t\t\t\tconst result = await toRun(data, context);\n\t\t\t\tif (result === false) return null;\n\t\t\t\tif (typeof result === \"object\" && \"data\" in result) actualData = {\n\t\t\t\t\t...actualData,\n\t\t\t\t\t...result.data\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tconst customUpdated = customUpdateFn ? await customUpdateFn.fn(actualData) : null;\n\t\tconst updated = !customUpdateFn || customUpdateFn.executeMainFn ? await (await getCurrentAdapter(adapter)).updateMany({\n\t\t\tmodel,\n\t\t\tupdate: actualData,\n\t\t\twhere\n\t\t}) : customUpdated;\n\t\tfor (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.update?.after;\n\t\t\tif (toRun) await toRun(updated, context);\n\t\t}\n\t\treturn updated;\n\t}\n\tasync function deleteWithHooks(where, model, customDeleteFn) {\n\t\tconst context = await getCurrentAuthContext();\n\t\tlet entityToDelete = null;\n\t\ttry {\n\t\t\tentityToDelete = (await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\tmodel,\n\t\t\t\twhere,\n\t\t\t\tlimit: 1\n\t\t\t}))[0] || null;\n\t\t} catch (error) {}\n\t\tif (entityToDelete) for (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.delete?.before;\n\t\t\tif (toRun) {\n\t\t\t\tif (await toRun(entityToDelete, context) === false) return null;\n\t\t\t}\n\t\t}\n\t\tconst customDeleted = customDeleteFn ? await customDeleteFn.fn(where) : null;\n\t\tconst deleted = !customDeleteFn || customDeleteFn.executeMainFn ? await (await getCurrentAdapter(adapter)).delete({\n\t\t\tmodel,\n\t\t\twhere\n\t\t}) : customDeleted;\n\t\tif (entityToDelete) for (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.delete?.after;\n\t\t\tif (toRun) await toRun(entityToDelete, context);\n\t\t}\n\t\treturn deleted;\n\t}\n\tasync function deleteManyWithHooks(where, model, customDeleteFn) {\n\t\tconst context = await getCurrentAuthContext();\n\t\tlet entitiesToDelete = [];\n\t\ttry {\n\t\t\tentitiesToDelete = await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\tmodel,\n\t\t\t\twhere\n\t\t\t});\n\t\t} catch (error) {}\n\t\tfor (const entity of entitiesToDelete) for (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.delete?.before;\n\t\t\tif (toRun) {\n\t\t\t\tif (await toRun(entity, context) === false) return null;\n\t\t\t}\n\t\t}\n\t\tconst customDeleted = customDeleteFn ? await customDeleteFn.fn(where) : null;\n\t\tconst deleted = !customDeleteFn || customDeleteFn.executeMainFn ? await (await getCurrentAdapter(adapter)).deleteMany({\n\t\t\tmodel,\n\t\t\twhere\n\t\t}) : customDeleted;\n\t\tfor (const entity of entitiesToDelete) for (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.delete?.after;\n\t\t\tif (toRun) await toRun(entity, context);\n\t\t}\n\t\treturn deleted;\n\t}\n\treturn {\n\t\tcreateWithHooks,\n\t\tupdateWithHooks,\n\t\tupdateManyWithHooks,\n\t\tdeleteWithHooks,\n\t\tdeleteManyWithHooks\n\t};\n}\n\n//#endregion\n//#region src/db/internal-adapter.ts\nconst createInternalAdapter = (adapter, ctx) => {\n\tconst logger$1 = ctx.logger;\n\tconst options = ctx.options;\n\tconst secondaryStorage = options.secondaryStorage;\n\tconst sessionExpiration = options.session?.expiresIn || 3600 * 24 * 7;\n\tconst { createWithHooks, updateWithHooks, updateManyWithHooks, deleteWithHooks, deleteManyWithHooks } = getWithHooks(adapter, ctx);\n\tasync function refreshUserSessions(user) {\n\t\tif (!secondaryStorage) return;\n\t\tconst listRaw = await secondaryStorage.get(`active-sessions-${user.id}`);\n\t\tif (!listRaw) return;\n\t\tconst now = Date.now();\n\t\tconst validSessions = (safeJSONParse(listRaw) || []).filter((s) => s.expiresAt > now);\n\t\tawait Promise.all(validSessions.map(async ({ token }) => {\n\t\t\tconst cached = await secondaryStorage.get(token);\n\t\t\tif (!cached) return;\n\t\t\tconst parsed = safeJSONParse(cached);\n\t\t\tif (!parsed) return;\n\t\t\tconst sessionTTL = Math.max(Math.floor(new Date(parsed.session.expiresAt).getTime() - now) / 1e3, 0);\n\t\t\tawait secondaryStorage.set(token, JSON.stringify({\n\t\t\t\tsession: parsed.session,\n\t\t\t\tuser\n\t\t\t}), Math.floor(sessionTTL));\n\t\t}));\n\t}\n\treturn {\n\t\tcreateOAuthUser: async (user, account) => {\n\t\t\treturn runWithTransaction(adapter, async () => {\n\t\t\t\tconst createdUser = await createWithHooks({\n\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t...user\n\t\t\t\t}, \"user\", void 0);\n\t\t\t\treturn {\n\t\t\t\t\tuser: createdUser,\n\t\t\t\t\taccount: await createWithHooks({\n\t\t\t\t\t\t...account,\n\t\t\t\t\t\tuserId: createdUser.id,\n\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t}, \"account\", void 0)\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\t\tcreateUser: async (user) => {\n\t\t\treturn await createWithHooks({\n\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t...user,\n\t\t\t\temail: user.email?.toLowerCase()\n\t\t\t}, \"user\", void 0);\n\t\t},\n\t\tcreateAccount: async (account) => {\n\t\t\treturn await createWithHooks({\n\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t...account\n\t\t\t}, \"account\", void 0);\n\t\t},\n\t\tlistSessions: async (userId) => {\n\t\t\tif (secondaryStorage) {\n\t\t\t\tconst currentList = await secondaryStorage.get(`active-sessions-${userId}`);\n\t\t\t\tif (!currentList) return [];\n\t\t\t\tconst list = safeJSONParse(currentList) || [];\n\t\t\t\tconst now = Date.now();\n\t\t\t\tconst validSessions = list.filter((s) => s.expiresAt > now);\n\t\t\t\tconst sessions = [];\n\t\t\t\tfor (const session of validSessions) {\n\t\t\t\t\tconst sessionStringified = await secondaryStorage.get(session.token);\n\t\t\t\t\tif (sessionStringified) {\n\t\t\t\t\t\tconst s = safeJSONParse(sessionStringified);\n\t\t\t\t\t\tif (!s) return [];\n\t\t\t\t\t\tconst parsedSession = parseSessionOutput(ctx.options, {\n\t\t\t\t\t\t\t...s.session,\n\t\t\t\t\t\t\texpiresAt: new Date(s.session.expiresAt)\n\t\t\t\t\t\t});\n\t\t\t\t\t\tsessions.push(parsedSession);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn sessions;\n\t\t\t}\n\t\t\treturn await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\tmodel: \"session\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\tvalue: userId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tlistUsers: async (limit, offset, sortBy, where) => {\n\t\t\treturn await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\tmodel: \"user\",\n\t\t\t\tlimit,\n\t\t\t\toffset,\n\t\t\t\tsortBy,\n\t\t\t\twhere\n\t\t\t});\n\t\t},\n\t\tcountTotalUsers: async (where) => {\n\t\t\tconst total = await (await getCurrentAdapter(adapter)).count({\n\t\t\t\tmodel: \"user\",\n\t\t\t\twhere\n\t\t\t});\n\t\t\tif (typeof total === \"string\") return parseInt(total);\n\t\t\treturn total;\n\t\t},\n\t\tdeleteUser: async (userId) => {\n\t\t\tif (secondaryStorage) await secondaryStorage.delete(`active-sessions-${userId}`);\n\t\t\tif (!secondaryStorage || options.session?.storeSessionInDatabase) await deleteManyWithHooks([{\n\t\t\t\tfield: \"userId\",\n\t\t\t\tvalue: userId\n\t\t\t}], \"session\", void 0);\n\t\t\tawait deleteManyWithHooks([{\n\t\t\t\tfield: \"userId\",\n\t\t\t\tvalue: userId\n\t\t\t}], \"account\", void 0);\n\t\t\tawait deleteWithHooks([{\n\t\t\t\tfield: \"id\",\n\t\t\t\tvalue: userId\n\t\t\t}], \"user\", void 0);\n\t\t},\n\t\tcreateSession: async (userId, dontRememberMe, override, overrideAll) => {\n\t\t\tconst ctx$1 = await getCurrentAuthContext().catch(() => null);\n\t\t\tconst headers = ctx$1?.headers || ctx$1?.request?.headers;\n\t\t\tconst { id: _, ...rest } = override || {};\n\t\t\tconst defaultAdditionalFields = parseSessionInput(ctx$1?.context.options ?? options, {});\n\t\t\tconst data = {\n\t\t\t\tipAddress: ctx$1?.request || ctx$1?.headers ? getIp(ctx$1?.request || ctx$1?.headers, ctx$1?.context.options) || \"\" : \"\",\n\t\t\t\tuserAgent: headers?.get(\"user-agent\") || \"\",\n\t\t\t\t...rest,\n\t\t\t\texpiresAt: dontRememberMe ? getDate(3600 * 24, \"sec\") : getDate(sessionExpiration, \"sec\"),\n\t\t\t\tuserId,\n\t\t\t\ttoken: generateId(32),\n\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t...defaultAdditionalFields,\n\t\t\t\t...overrideAll ? rest : {}\n\t\t\t};\n\t\t\treturn await createWithHooks(data, \"session\", secondaryStorage ? {\n\t\t\t\tfn: async (sessionData) => {\n\t\t\t\t\t/**\n\t\t\t\t\t* store the session token for the user\n\t\t\t\t\t* so we can retrieve it later for listing sessions\n\t\t\t\t\t*/\n\t\t\t\t\tconst currentList = await secondaryStorage.get(`active-sessions-${userId}`);\n\t\t\t\t\tlet list = [];\n\t\t\t\t\tconst now = Date.now();\n\t\t\t\t\tif (currentList) {\n\t\t\t\t\t\tlist = safeJSONParse(currentList) || [];\n\t\t\t\t\t\tlist = list.filter((session) => session.expiresAt > now);\n\t\t\t\t\t}\n\t\t\t\t\tconst sorted = list.sort((a, b) => a.expiresAt - b.expiresAt);\n\t\t\t\t\tlet furthestSessionExp = sorted.at(-1)?.expiresAt;\n\t\t\t\t\tsorted.push({\n\t\t\t\t\t\ttoken: data.token,\n\t\t\t\t\t\texpiresAt: data.expiresAt.getTime()\n\t\t\t\t\t});\n\t\t\t\t\tif (!furthestSessionExp || furthestSessionExp < data.expiresAt.getTime()) furthestSessionExp = data.expiresAt.getTime();\n\t\t\t\t\tconst furthestSessionTTL = Math.max(Math.floor((furthestSessionExp - now) / 1e3), 0);\n\t\t\t\t\tif (furthestSessionTTL > 0) await secondaryStorage.set(`active-sessions-${userId}`, JSON.stringify(sorted), furthestSessionTTL);\n\t\t\t\t\tconst user = await adapter.findOne({\n\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\tvalue: userId\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t\tconst sessionTTL = Math.max(Math.floor((data.expiresAt.getTime() - now) / 1e3), 0);\n\t\t\t\t\tif (sessionTTL > 0) await secondaryStorage.set(data.token, JSON.stringify({\n\t\t\t\t\t\tsession: sessionData,\n\t\t\t\t\t\tuser\n\t\t\t\t\t}), sessionTTL);\n\t\t\t\t\treturn sessionData;\n\t\t\t\t},\n\t\t\t\texecuteMainFn: options.session?.storeSessionInDatabase\n\t\t\t} : void 0);\n\t\t},\n\t\tfindSession: async (token) => {\n\t\t\tif (secondaryStorage) {\n\t\t\t\tconst sessionStringified = await secondaryStorage.get(token);\n\t\t\t\tif (!sessionStringified && !options.session?.storeSessionInDatabase) return null;\n\t\t\t\tif (sessionStringified) {\n\t\t\t\t\tconst s = safeJSONParse(sessionStringified);\n\t\t\t\t\tif (!s) return null;\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsession: parseSessionOutput(ctx.options, {\n\t\t\t\t\t\t\t...s.session,\n\t\t\t\t\t\t\texpiresAt: new Date(s.session.expiresAt),\n\t\t\t\t\t\t\tcreatedAt: new Date(s.session.createdAt),\n\t\t\t\t\t\t\tupdatedAt: new Date(s.session.updatedAt)\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tuser: parseUserOutput(ctx.options, {\n\t\t\t\t\t\t\t...s.user,\n\t\t\t\t\t\t\tcreatedAt: new Date(s.user.createdAt),\n\t\t\t\t\t\t\tupdatedAt: new Date(s.user.updatedAt)\n\t\t\t\t\t\t})\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst result = await (await getCurrentAdapter(adapter)).findOne({\n\t\t\t\tmodel: \"session\",\n\t\t\t\twhere: [{\n\t\t\t\t\tvalue: token,\n\t\t\t\t\tfield: \"token\"\n\t\t\t\t}],\n\t\t\t\tjoin: { user: true }\n\t\t\t});\n\t\t\tif (!result) return null;\n\t\t\tconst { user, ...session } = result;\n\t\t\tif (!user) return null;\n\t\t\treturn {\n\t\t\t\tsession: parseSessionOutput(ctx.options, session),\n\t\t\t\tuser: parseUserOutput(ctx.options, user)\n\t\t\t};\n\t\t},\n\t\tfindSessions: async (sessionTokens) => {\n\t\t\tif (secondaryStorage) {\n\t\t\t\tconst sessions$1 = [];\n\t\t\t\tfor (const sessionToken of sessionTokens) {\n\t\t\t\t\tconst sessionStringified = await secondaryStorage.get(sessionToken);\n\t\t\t\t\tif (sessionStringified) {\n\t\t\t\t\t\tconst s = safeJSONParse(sessionStringified);\n\t\t\t\t\t\tif (!s) return [];\n\t\t\t\t\t\tconst session = {\n\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\t...s.session,\n\t\t\t\t\t\t\t\texpiresAt: new Date(s.session.expiresAt)\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t...s.user,\n\t\t\t\t\t\t\t\tcreatedAt: new Date(s.user.createdAt),\n\t\t\t\t\t\t\t\tupdatedAt: new Date(s.user.updatedAt)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tsessions$1.push(session);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn sessions$1;\n\t\t\t}\n\t\t\tconst sessions = await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\tmodel: \"session\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"token\",\n\t\t\t\t\tvalue: sessionTokens,\n\t\t\t\t\toperator: \"in\"\n\t\t\t\t}],\n\t\t\t\tjoin: { user: true }\n\t\t\t});\n\t\t\tif (!sessions.length) return [];\n\t\t\tif (sessions.some((session) => !session.user)) return [];\n\t\t\treturn sessions.map((_session) => {\n\t\t\t\tconst { user, ...session } = _session;\n\t\t\t\treturn {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\t\tupdateSession: async (sessionToken, session) => {\n\t\t\treturn await updateWithHooks(session, [{\n\t\t\t\tfield: \"token\",\n\t\t\t\tvalue: sessionToken\n\t\t\t}], \"session\", secondaryStorage ? {\n\t\t\t\tasync fn(data) {\n\t\t\t\t\tconst currentSession = await secondaryStorage.get(sessionToken);\n\t\t\t\t\tlet updatedSession = null;\n\t\t\t\t\tif (currentSession) {\n\t\t\t\t\t\tconst parsedSession = safeJSONParse(currentSession);\n\t\t\t\t\t\tif (!parsedSession) return null;\n\t\t\t\t\t\tupdatedSession = {\n\t\t\t\t\t\t\t...parsedSession.session,\n\t\t\t\t\t\t\t...data\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn updatedSession;\n\t\t\t\t\t} else return null;\n\t\t\t\t},\n\t\t\t\texecuteMainFn: options.session?.storeSessionInDatabase\n\t\t\t} : void 0);\n\t\t},\n\t\tdeleteSession: async (token) => {\n\t\t\tif (secondaryStorage) {\n\t\t\t\tconst data = await secondaryStorage.get(token);\n\t\t\t\tif (data) {\n\t\t\t\t\tconst { session } = safeJSONParse(data) ?? {};\n\t\t\t\t\tif (!session) {\n\t\t\t\t\t\tlogger$1.error(\"Session not found in secondary storage\");\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst userId = session.userId;\n\t\t\t\t\tconst currentList = await secondaryStorage.get(`active-sessions-${userId}`);\n\t\t\t\t\tif (currentList) {\n\t\t\t\t\t\tlet list = safeJSONParse(currentList) || [];\n\t\t\t\t\t\tconst now = Date.now();\n\t\t\t\t\t\tconst filtered = list.filter((session$1) => session$1.expiresAt > now && session$1.token !== token);\n\t\t\t\t\t\tconst furthestSessionExp = filtered.sort((a, b) => a.expiresAt - b.expiresAt).at(-1)?.expiresAt;\n\t\t\t\t\t\tif (filtered.length > 0 && furthestSessionExp && furthestSessionExp > Date.now()) await secondaryStorage.set(`active-sessions-${userId}`, JSON.stringify(filtered), Math.floor((furthestSessionExp - now) / 1e3));\n\t\t\t\t\t\telse await secondaryStorage.delete(`active-sessions-${userId}`);\n\t\t\t\t\t} else logger$1.error(\"Active sessions list not found in secondary storage\");\n\t\t\t\t}\n\t\t\t\tawait secondaryStorage.delete(token);\n\t\t\t\tif (!options.session?.storeSessionInDatabase || ctx.options.session?.preserveSessionInDatabase) return;\n\t\t\t}\n\t\t\tawait (await getCurrentAdapter(adapter)).delete({\n\t\t\t\tmodel: \"session\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"token\",\n\t\t\t\t\tvalue: token\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tdeleteAccounts: async (userId) => {\n\t\t\tawait deleteManyWithHooks([{\n\t\t\t\tfield: \"userId\",\n\t\t\t\tvalue: userId\n\t\t\t}], \"account\", void 0);\n\t\t},\n\t\tdeleteAccount: async (accountId) => {\n\t\t\tawait deleteWithHooks([{\n\t\t\t\tfield: \"id\",\n\t\t\t\tvalue: accountId\n\t\t\t}], \"account\", void 0);\n\t\t},\n\t\tdeleteSessions: async (userIdOrSessionTokens) => {\n\t\t\tif (secondaryStorage) {\n\t\t\t\tif (typeof userIdOrSessionTokens === \"string\") {\n\t\t\t\t\tconst activeSession = await secondaryStorage.get(`active-sessions-${userIdOrSessionTokens}`);\n\t\t\t\t\tconst sessions = activeSession ? safeJSONParse(activeSession) : [];\n\t\t\t\t\tif (!sessions) return;\n\t\t\t\t\tfor (const session of sessions) await secondaryStorage.delete(session.token);\n\t\t\t\t} else for (const sessionToken of userIdOrSessionTokens) if (await secondaryStorage.get(sessionToken)) await secondaryStorage.delete(sessionToken);\n\t\t\t\tif (!options.session?.storeSessionInDatabase || ctx.options.session?.preserveSessionInDatabase) return;\n\t\t\t}\n\t\t\tawait deleteManyWithHooks([{\n\t\t\t\tfield: Array.isArray(userIdOrSessionTokens) ? \"token\" : \"userId\",\n\t\t\t\tvalue: userIdOrSessionTokens,\n\t\t\t\toperator: Array.isArray(userIdOrSessionTokens) ? \"in\" : void 0\n\t\t\t}], \"session\", void 0);\n\t\t},\n\t\tfindOAuthUser: async (email, accountId, providerId) => {\n\t\t\tconst account = await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\tmodel: \"account\",\n\t\t\t\twhere: [{\n\t\t\t\t\tvalue: accountId,\n\t\t\t\t\tfield: \"accountId\"\n\t\t\t\t}],\n\t\t\t\tjoin: { user: true }\n\t\t\t}).then((accounts) => {\n\t\t\t\treturn accounts.find((a) => a.providerId === providerId);\n\t\t\t});\n\t\t\tif (account) if (account.user) return {\n\t\t\t\tuser: account.user,\n\t\t\t\taccounts: [account]\n\t\t\t};\n\t\t\telse {\n\t\t\t\tconst user = await (await getCurrentAdapter(adapter)).findOne({\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tvalue: email.toLowerCase(),\n\t\t\t\t\t\tfield: \"email\"\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (user) return {\n\t\t\t\t\tuser,\n\t\t\t\t\taccounts: [account]\n\t\t\t\t};\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconst user = await (await getCurrentAdapter(adapter)).findOne({\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tvalue: email.toLowerCase(),\n\t\t\t\t\t\tfield: \"email\"\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (user) return {\n\t\t\t\t\tuser,\n\t\t\t\t\taccounts: await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\t\t\tmodel: \"account\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t\t\tfield: \"userId\"\n\t\t\t\t\t\t}]\n\t\t\t\t\t}) || []\n\t\t\t\t};\n\t\t\t\telse return null;\n\t\t\t}\n\t\t},\n\t\tfindUserByEmail: async (email, options$1) => {\n\t\t\tconst result = await (await getCurrentAdapter(adapter)).findOne({\n\t\t\t\tmodel: \"user\",\n\t\t\t\twhere: [{\n\t\t\t\t\tvalue: email.toLowerCase(),\n\t\t\t\t\tfield: \"email\"\n\t\t\t\t}],\n\t\t\t\tjoin: { ...options$1?.includeAccounts ? { account: true } : {} }\n\t\t\t});\n\t\t\tif (!result) return null;\n\t\t\tconst { account: accounts, ...user } = result;\n\t\t\treturn {\n\t\t\t\tuser,\n\t\t\t\taccounts: accounts ?? []\n\t\t\t};\n\t\t},\n\t\tfindUserById: async (userId) => {\n\t\t\tif (!userId) return null;\n\t\t\treturn await (await getCurrentAdapter(adapter)).findOne({\n\t\t\t\tmodel: \"user\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: userId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tlinkAccount: async (account) => {\n\t\t\treturn await createWithHooks({\n\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t...account\n\t\t\t}, \"account\", void 0);\n\t\t},\n\t\tupdateUser: async (userId, data) => {\n\t\t\tconst user = await updateWithHooks(data, [{\n\t\t\t\tfield: \"id\",\n\t\t\t\tvalue: userId\n\t\t\t}], \"user\", void 0);\n\t\t\tawait refreshUserSessions(user);\n\t\t\tawait refreshUserSessions(user);\n\t\t\treturn user;\n\t\t},\n\t\tupdateUserByEmail: async (email, data) => {\n\t\t\tconst user = await updateWithHooks(data, [{\n\t\t\t\tfield: \"email\",\n\t\t\t\tvalue: email.toLowerCase()\n\t\t\t}], \"user\", void 0);\n\t\t\tawait refreshUserSessions(user);\n\t\t\tawait refreshUserSessions(user);\n\t\t\treturn user;\n\t\t},\n\t\tupdatePassword: async (userId, password) => {\n\t\t\tawait updateManyWithHooks({ password }, [{\n\t\t\t\tfield: \"userId\",\n\t\t\t\tvalue: userId\n\t\t\t}, {\n\t\t\t\tfield: \"providerId\",\n\t\t\t\tvalue: \"credential\"\n\t\t\t}], \"account\", void 0);\n\t\t},\n\t\tfindAccounts: async (userId) => {\n\t\t\treturn await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\tmodel: \"account\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\tvalue: userId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tfindAccount: async (accountId) => {\n\t\t\treturn await (await getCurrentAdapter(adapter)).findOne({\n\t\t\t\tmodel: \"account\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"accountId\",\n\t\t\t\t\tvalue: accountId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tfindAccountByProviderId: async (accountId, providerId) => {\n\t\t\treturn await (await getCurrentAdapter(adapter)).findOne({\n\t\t\t\tmodel: \"account\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"accountId\",\n\t\t\t\t\tvalue: accountId\n\t\t\t\t}, {\n\t\t\t\t\tfield: \"providerId\",\n\t\t\t\t\tvalue: providerId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tfindAccountByUserId: async (userId) => {\n\t\t\treturn await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\tmodel: \"account\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\tvalue: userId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tupdateAccount: async (id, data) => {\n\t\t\treturn await updateWithHooks(data, [{\n\t\t\t\tfield: \"id\",\n\t\t\t\tvalue: id\n\t\t\t}], \"account\", void 0);\n\t\t},\n\t\tcreateVerificationValue: async (data) => {\n\t\t\treturn await createWithHooks({\n\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t...data\n\t\t\t}, \"verification\", void 0);\n\t\t},\n\t\tfindVerificationValue: async (identifier) => {\n\t\t\tconst verification = await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\tmodel: \"verification\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"identifier\",\n\t\t\t\t\tvalue: identifier\n\t\t\t\t}],\n\t\t\t\tsortBy: {\n\t\t\t\t\tfield: \"createdAt\",\n\t\t\t\t\tdirection: \"desc\"\n\t\t\t\t},\n\t\t\t\tlimit: 1\n\t\t\t});\n\t\t\tif (!options.verification?.disableCleanup) await (await getCurrentAdapter(adapter)).deleteMany({\n\t\t\t\tmodel: \"verification\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"expiresAt\",\n\t\t\t\t\tvalue: /* @__PURE__ */ new Date(),\n\t\t\t\t\toperator: \"lt\"\n\t\t\t\t}]\n\t\t\t});\n\t\t\treturn verification[0];\n\t\t},\n\t\tdeleteVerificationValue: async (id) => {\n\t\t\tawait (await getCurrentAdapter(adapter)).delete({\n\t\t\t\tmodel: \"verification\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: id\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tdeleteVerificationByIdentifier: async (identifier) => {\n\t\t\tawait (await getCurrentAdapter(adapter)).delete({\n\t\t\t\tmodel: \"verification\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"identifier\",\n\t\t\t\t\tvalue: identifier\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tupdateVerificationValue: async (id, data) => {\n\t\t\treturn await updateWithHooks(data, [{\n\t\t\t\tfield: \"id\",\n\t\t\t\tvalue: id\n\t\t\t}], \"verification\", void 0);\n\t\t}\n\t};\n};\n\n//#endregion\n//#region src/db/to-zod.ts\nfunction toZodSchema({ fields, isClientSide }) {\n\tconst zodFields = Object.keys(fields).reduce((acc, key) => {\n\t\tconst field = fields[key];\n\t\tif (!field) return acc;\n\t\tif (isClientSide && field.input === false) return acc;\n\t\tlet schema;\n\t\tif (field.type === \"json\") schema = z.json ? z.json() : z.any();\n\t\telse if (field.type === \"string[]\" || field.type === \"number[]\") schema = z.array(field.type === \"string[]\" ? z.string() : z.number());\n\t\telse if (Array.isArray(field.type)) schema = z.any();\n\t\telse schema = z[field.type]();\n\t\tif (field?.required === false) schema = schema.optional();\n\t\tif (field?.returned === false) return acc;\n\t\treturn {\n\t\t\t...acc,\n\t\t\t[key]: schema\n\t\t};\n\t}, {});\n\treturn z.object(zodFields);\n}\n\n//#endregion\n//#region src/db/get-schema.ts\nfunction getSchema(config) {\n\tconst tables = getAuthTables(config);\n\tlet schema = {};\n\tfor (const key in tables) {\n\t\tconst table = tables[key];\n\t\tconst fields = table.fields;\n\t\tlet actualFields = {};\n\t\tObject.entries(fields).forEach(([key$1, field]) => {\n\t\t\tactualFields[field.fieldName || key$1] = field;\n\t\t\tif (field.references) {\n\t\t\t\tconst refTable = tables[field.references.model];\n\t\t\t\tif (refTable) actualFields[field.fieldName || key$1].references = {\n\t\t\t\t\t...field.references,\n\t\t\t\t\tmodel: refTable.modelName,\n\t\t\t\t\tfield: field.references.field\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\tif (schema[table.modelName]) {\n\t\t\tschema[table.modelName].fields = {\n\t\t\t\t...schema[table.modelName].fields,\n\t\t\t\t...actualFields\n\t\t\t};\n\t\t\tcontinue;\n\t\t}\n\t\tschema[table.modelName] = {\n\t\t\tfields: actualFields,\n\t\t\torder: table.order || Infinity\n\t\t};\n\t}\n\treturn schema;\n}\n\n//#endregion\n//#region src/db/get-migration.ts\nconst map = {\n\tpostgres: {\n\t\tstring: [\n\t\t\t\"character varying\",\n\t\t\t\"varchar\",\n\t\t\t\"text\",\n\t\t\t\"uuid\"\n\t\t],\n\t\tnumber: [\n\t\t\t\"int4\",\n\t\t\t\"integer\",\n\t\t\t\"bigint\",\n\t\t\t\"smallint\",\n\t\t\t\"numeric\",\n\t\t\t\"real\",\n\t\t\t\"double precision\"\n\t\t],\n\t\tboolean: [\"bool\", \"boolean\"],\n\t\tdate: [\n\t\t\t\"timestamptz\",\n\t\t\t\"timestamp\",\n\t\t\t\"date\"\n\t\t],\n\t\tjson: [\"json\", \"jsonb\"]\n\t},\n\tmysql: {\n\t\tstring: [\n\t\t\t\"varchar\",\n\t\t\t\"text\",\n\t\t\t\"uuid\"\n\t\t],\n\t\tnumber: [\n\t\t\t\"integer\",\n\t\t\t\"int\",\n\t\t\t\"bigint\",\n\t\t\t\"smallint\",\n\t\t\t\"decimal\",\n\t\t\t\"float\",\n\t\t\t\"double\"\n\t\t],\n\t\tboolean: [\"boolean\", \"tinyint\"],\n\t\tdate: [\n\t\t\t\"timestamp\",\n\t\t\t\"datetime\",\n\t\t\t\"date\"\n\t\t],\n\t\tjson: [\"json\"]\n\t},\n\tsqlite: {\n\t\tstring: [\"TEXT\"],\n\t\tnumber: [\"INTEGER\", \"REAL\"],\n\t\tboolean: [\"INTEGER\", \"BOOLEAN\"],\n\t\tdate: [\"DATE\", \"INTEGER\"],\n\t\tjson: [\"TEXT\"]\n\t},\n\tmssql: {\n\t\tstring: [\n\t\t\t\"varchar\",\n\t\t\t\"nvarchar\",\n\t\t\t\"uniqueidentifier\"\n\t\t],\n\t\tnumber: [\n\t\t\t\"int\",\n\t\t\t\"bigint\",\n\t\t\t\"smallint\",\n\t\t\t\"decimal\",\n\t\t\t\"float\",\n\t\t\t\"double\"\n\t\t],\n\t\tboolean: [\"bit\", \"smallint\"],\n\t\tdate: [\n\t\t\t\"datetime2\",\n\t\t\t\"date\",\n\t\t\t\"datetime\"\n\t\t],\n\t\tjson: [\"varchar\", \"nvarchar\"]\n\t}\n};\nfunction matchType(columnDataType, fieldType, dbType) {\n\tfunction normalize(type) {\n\t\treturn type.toLowerCase().split(\"(\")[0].trim();\n\t}\n\tif (fieldType === \"string[]\" || fieldType === \"number[]\") return columnDataType.toLowerCase().includes(\"json\");\n\tconst types = map[dbType];\n\treturn (Array.isArray(fieldType) ? types[\"string\"].map((t) => t.toLowerCase()) : types[fieldType].map((t) => t.toLowerCase())).includes(normalize(columnDataType));\n}\n/**\n* Get the current PostgreSQL schema (search_path) for the database connection\n* Returns the first schema in the search_path, defaulting to 'public' if not found\n*/\nasync function getPostgresSchema(db) {\n\ttry {\n\t\tconst result = await sql`SHOW search_path`.execute(db);\n\t\tif (result.rows[0]?.search_path) return result.rows[0].search_path.split(\",\").map((s) => s.trim()).map((s) => s.replace(/^[\"']|[\"']$/g, \"\")).filter((s) => !s.startsWith(\"$\"))[0] || \"public\";\n\t} catch (error) {}\n\treturn \"public\";\n}\nasync function getMigrations(config) {\n\tconst betterAuthSchema = getSchema(config);\n\tconst logger$1 = createLogger(config.logger);\n\tlet { kysely: db, databaseType: dbType } = await createKyselyAdapter(config);\n\tif (!dbType) {\n\t\tlogger$1.warn(\"Could not determine database type, defaulting to sqlite. Please provide a type in the database options to avoid this.\");\n\t\tdbType = \"sqlite\";\n\t}\n\tif (!db) {\n\t\tlogger$1.error(\"Only kysely adapter is supported for migrations. You can use `generate` command to generate the schema, if you're using a different adapter.\");\n\t\tprocess.exit(1);\n\t}\n\tlet currentSchema = \"public\";\n\tif (dbType === \"postgres\") {\n\t\tcurrentSchema = await getPostgresSchema(db);\n\t\tlogger$1.debug(`PostgreSQL migration: Using schema '${currentSchema}' (from search_path)`);\n\t\ttry {\n\t\t\tif (!(await sql`\n\t\t\t\tSELECT schema_name \n\t\t\t\tFROM information_schema.schemata \n\t\t\t\tWHERE schema_name = ${currentSchema}\n\t\t\t`.execute(db)).rows[0]) logger$1.warn(`Schema '${currentSchema}' does not exist. Tables will be inspected from available schemas. Consider creating the schema first or checking your database configuration.`);\n\t\t} catch (error) {\n\t\t\tlogger$1.debug(`Could not verify schema existence: ${error instanceof Error ? error.message : String(error)}`);\n\t\t}\n\t}\n\tconst allTableMetadata = await db.introspection.getTables();\n\tlet tableMetadata = allTableMetadata;\n\tif (dbType === \"postgres\") try {\n\t\tconst tablesInSchema = await sql`\n\t\t\t\tSELECT table_name \n\t\t\t\tFROM information_schema.tables \n\t\t\t\tWHERE table_schema = ${currentSchema}\n\t\t\t\tAND table_type = 'BASE TABLE'\n\t\t\t`.execute(db);\n\t\tconst tableNamesInSchema = new Set(tablesInSchema.rows.map((row) => row.table_name));\n\t\ttableMetadata = allTableMetadata.filter((table) => table.schema === currentSchema && tableNamesInSchema.has(table.name));\n\t\tlogger$1.debug(`Found ${tableMetadata.length} table(s) in schema '${currentSchema}': ${tableMetadata.map((t) => t.name).join(\", \") || \"(none)\"}`);\n\t} catch (error) {\n\t\tlogger$1.warn(`Could not filter tables by schema. Using all discovered tables. Error: ${error instanceof Error ? error.message : String(error)}`);\n\t}\n\tconst toBeCreated = [];\n\tconst toBeAdded = [];\n\tfor (const [key, value] of Object.entries(betterAuthSchema)) {\n\t\tconst table = tableMetadata.find((t) => t.name === key);\n\t\tif (!table) {\n\t\t\tconst tIndex = toBeCreated.findIndex((t) => t.table === key);\n\t\t\tconst tableData = {\n\t\t\t\ttable: key,\n\t\t\t\tfields: value.fields,\n\t\t\t\torder: value.order || Infinity\n\t\t\t};\n\t\t\tconst insertIndex = toBeCreated.findIndex((t) => (t.order || Infinity) > tableData.order);\n\t\t\tif (insertIndex === -1) if (tIndex === -1) toBeCreated.push(tableData);\n\t\t\telse toBeCreated[tIndex].fields = {\n\t\t\t\t...toBeCreated[tIndex].fields,\n\t\t\t\t...value.fields\n\t\t\t};\n\t\t\telse toBeCreated.splice(insertIndex, 0, tableData);\n\t\t\tcontinue;\n\t\t}\n\t\tlet toBeAddedFields = {};\n\t\tfor (const [fieldName, field] of Object.entries(value.fields)) {\n\t\t\tconst column = table.columns.find((c) => c.name === fieldName);\n\t\t\tif (!column) {\n\t\t\t\ttoBeAddedFields[fieldName] = field;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (matchType(column.dataType, field.type, dbType)) continue;\n\t\t\telse logger$1.warn(`Field ${fieldName} in table ${key} has a different type in the database. Expected ${field.type} but got ${column.dataType}.`);\n\t\t}\n\t\tif (Object.keys(toBeAddedFields).length > 0) toBeAdded.push({\n\t\t\ttable: key,\n\t\t\tfields: toBeAddedFields,\n\t\t\torder: value.order || Infinity\n\t\t});\n\t}\n\tconst migrations = [];\n\tconst useUUIDs = config.advanced?.database?.generateId === \"uuid\";\n\tconst useNumberId = config.advanced?.database?.useNumberId || config.advanced?.database?.generateId === \"serial\";\n\tfunction getType(field, fieldName) {\n\t\tconst type = field.type;\n\t\tconst typeMap = {\n\t\t\tstring: {\n\t\t\t\tsqlite: \"text\",\n\t\t\t\tpostgres: \"text\",\n\t\t\t\tmysql: field.unique ? \"varchar(255)\" : field.references ? \"varchar(36)\" : field.sortable ? \"varchar(255)\" : field.index ? \"varchar(255)\" : \"text\",\n\t\t\t\tmssql: field.unique || field.sortable ? \"varchar(255)\" : field.references ? \"varchar(36)\" : \"varchar(8000)\"\n\t\t\t},\n\t\t\tboolean: {\n\t\t\t\tsqlite: \"integer\",\n\t\t\t\tpostgres: \"boolean\",\n\t\t\t\tmysql: \"boolean\",\n\t\t\t\tmssql: \"smallint\"\n\t\t\t},\n\t\t\tnumber: {\n\t\t\t\tsqlite: field.bigint ? \"bigint\" : \"integer\",\n\t\t\t\tpostgres: field.bigint ? \"bigint\" : \"integer\",\n\t\t\t\tmysql: field.bigint ? \"bigint\" : \"integer\",\n\t\t\t\tmssql: field.bigint ? \"bigint\" : \"integer\"\n\t\t\t},\n\t\t\tdate: {\n\t\t\t\tsqlite: \"date\",\n\t\t\t\tpostgres: \"timestamptz\",\n\t\t\t\tmysql: \"timestamp(3)\",\n\t\t\t\tmssql: sql`datetime2(3)`\n\t\t\t},\n\t\t\tjson: {\n\t\t\t\tsqlite: \"text\",\n\t\t\t\tpostgres: \"jsonb\",\n\t\t\t\tmysql: \"json\",\n\t\t\t\tmssql: \"varchar(8000)\"\n\t\t\t},\n\t\t\tid: {\n\t\t\t\tpostgres: useNumberId ? sql`integer GENERATED BY DEFAULT AS IDENTITY` : useUUIDs ? \"uuid\" : \"text\",\n\t\t\t\tmysql: useNumberId ? \"integer\" : useUUIDs ? \"varchar(36)\" : \"varchar(36)\",\n\t\t\t\tmssql: useNumberId ? \"integer\" : useUUIDs ? \"varchar(36)\" : \"varchar(36)\",\n\t\t\t\tsqlite: useNumberId ? \"integer\" : \"text\"\n\t\t\t},\n\t\t\tforeignKeyId: {\n\t\t\t\tpostgres: useNumberId ? \"integer\" : useUUIDs ? \"uuid\" : \"text\",\n\t\t\t\tmysql: useNumberId ? \"integer\" : useUUIDs ? \"varchar(36)\" : \"varchar(36)\",\n\t\t\t\tmssql: useNumberId ? \"integer\" : useUUIDs ? \"varchar(36)\" : \"varchar(36)\",\n\t\t\t\tsqlite: useNumberId ? \"integer\" : \"text\"\n\t\t\t}\n\t\t};\n\t\tif (fieldName === \"id\" || field.references?.field === \"id\") {\n\t\t\tif (fieldName === \"id\") return typeMap.id[dbType];\n\t\t\treturn typeMap.foreignKeyId[dbType];\n\t\t}\n\t\tif (dbType === \"sqlite\" && (type === \"string[]\" || type === \"number[]\")) return \"text\";\n\t\tif (type === \"string[]\" || type === \"number[]\") return \"jsonb\";\n\t\tif (Array.isArray(type)) return \"text\";\n\t\tif (!(type in typeMap)) throw new Error(`Unsupported field type '${String(type)}' for field '${fieldName}'. Allowed types are: string, number, boolean, date, string[], number[]. If you need to store structured data, store it as a JSON string (type: \"string\") or split it into primitive fields. See https://better-auth.com/docs/advanced/schema#additional-fields`);\n\t\treturn typeMap[type][dbType || \"sqlite\"];\n\t}\n\tconst getModelName = initGetModelName({\n\t\tschema: getAuthTables(config),\n\t\tusePlural: false\n\t});\n\tconst getFieldName = initGetFieldName({\n\t\tschema: getAuthTables(config),\n\t\tusePlural: false\n\t});\n\tfunction getReferencePath(model, field) {\n\t\ttry {\n\t\t\treturn `${getModelName(model)}.${getFieldName({\n\t\t\t\tmodel,\n\t\t\t\tfield\n\t\t\t})}`;\n\t\t} catch {\n\t\t\treturn `${model}.${field}`;\n\t\t}\n\t}\n\tif (toBeAdded.length) for (const table of toBeAdded) for (const [fieldName, field] of Object.entries(table.fields)) {\n\t\tconst type = getType(field, fieldName);\n\t\tlet builder = db.schema.alterTable(table.table);\n\t\tif (field.index) {\n\t\t\tconst index = db.schema.alterTable(table.table).addIndex(`${table.table}_${fieldName}_idx`);\n\t\t\tmigrations.push(index);\n\t\t}\n\t\tlet built = builder.addColumn(fieldName, type, (col) => {\n\t\t\tcol = field.required !== false ? col.notNull() : col;\n\t\t\tif (field.references) col = col.references(getReferencePath(field.references.model, field.references.field)).onDelete(field.references.onDelete || \"cascade\");\n\t\t\tif (field.unique) col = col.unique();\n\t\t\tif (field.type === \"date\" && typeof field.defaultValue === \"function\" && (dbType === \"postgres\" || dbType === \"mysql\" || dbType === \"mssql\")) if (dbType === \"mysql\") col = col.defaultTo(sql`CURRENT_TIMESTAMP(3)`);\n\t\t\telse col = col.defaultTo(sql`CURRENT_TIMESTAMP`);\n\t\t\treturn col;\n\t\t});\n\t\tmigrations.push(built);\n\t}\n\tlet toBeIndexed = [];\n\tif (config.advanced?.database?.useNumberId) logger$1.warn(\"`useNumberId` is deprecated. Please use `generateId` with `serial` instead.\");\n\tif (toBeCreated.length) for (const table of toBeCreated) {\n\t\tconst idType = getType({ type: useNumberId ? \"number\" : \"string\" }, \"id\");\n\t\tlet dbT = db.schema.createTable(table.table).addColumn(\"id\", idType, (col) => {\n\t\t\tif (useNumberId) {\n\t\t\t\tif (dbType === \"postgres\") return col.primaryKey().notNull();\n\t\t\t\telse if (dbType === \"sqlite\") return col.primaryKey().notNull();\n\t\t\t\telse if (dbType === \"mssql\") return col.identity().primaryKey().notNull();\n\t\t\t\treturn col.autoIncrement().primaryKey().notNull();\n\t\t\t}\n\t\t\tif (useUUIDs) {\n\t\t\t\tif (dbType === \"postgres\") return col.primaryKey().defaultTo(sql`pg_catalog.gen_random_uuid()`).notNull();\n\t\t\t\treturn col.primaryKey().notNull();\n\t\t\t}\n\t\t\treturn col.primaryKey().notNull();\n\t\t});\n\t\tfor (const [fieldName, field] of Object.entries(table.fields)) {\n\t\t\tconst type = getType(field, fieldName);\n\t\t\tdbT = dbT.addColumn(fieldName, type, (col) => {\n\t\t\t\tcol = field.required !== false ? col.notNull() : col;\n\t\t\t\tif (field.references) col = col.references(getReferencePath(field.references.model, field.references.field)).onDelete(field.references.onDelete || \"cascade\");\n\t\t\t\tif (field.unique) col = col.unique();\n\t\t\t\tif (field.type === \"date\" && typeof field.defaultValue === \"function\" && (dbType === \"postgres\" || dbType === \"mysql\" || dbType === \"mssql\")) if (dbType === \"mysql\") col = col.defaultTo(sql`CURRENT_TIMESTAMP(3)`);\n\t\t\t\telse col = col.defaultTo(sql`CURRENT_TIMESTAMP`);\n\t\t\t\treturn col;\n\t\t\t});\n\t\t\tif (field.index) {\n\t\t\t\tlet builder = db.schema.createIndex(`${table.table}_${fieldName}_${field.unique ? \"uidx\" : \"idx\"}`).on(table.table).columns([fieldName]);\n\t\t\t\ttoBeIndexed.push(field.unique ? builder.unique() : builder);\n\t\t\t}\n\t\t}\n\t\tmigrations.push(dbT);\n\t}\n\tif (toBeIndexed.length) for (const index of toBeIndexed) migrations.push(index);\n\tasync function runMigrations() {\n\t\tfor (const migration of migrations) await migration.execute();\n\t}\n\tasync function compileMigrations() {\n\t\treturn migrations.map((m) => m.compile().sql).join(\";\\n\\n\") + \";\";\n\t}\n\treturn {\n\t\ttoBeCreated,\n\t\ttoBeAdded,\n\t\trunMigrations,\n\t\tcompileMigrations\n\t};\n}\n\n//#endregion\nexport { createInternalAdapter as a, convertToDB as c, getBaseAdapter as d, toZodSchema as i, createFieldAttribute as l, matchType as n, getWithHooks as o, getSchema as r, convertFromDB as s, getMigrations as t, getAdapter as u };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 2381, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/misc-BwNc0MKr.mjs"],"sourcesContent":["//#region src/utils/misc.ts\nfunction capitalizeFirstLetter(str) {\n\treturn str.charAt(0).toUpperCase() + str.slice(1);\n}\n\n//#endregion\nexport { capitalizeFirstLetter as t };"],"names":[],"mappings":"AAAA,2BAA2B;;;;;AAC3B,SAAS,sBAAsB,GAAG;IACjC,OAAO,IAAI,MAAM,CAAC,GAAG,WAAW,KAAK,IAAI,KAAK,CAAC;AAChD","ignoreList":[0]}},
    {"offset": {"line": 2394, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/url-CB8xCwz-.mjs"],"sourcesContent":["import { env } from \"@better-auth/core/env\";\nimport { BetterAuthError } from \"@better-auth/core/error\";\n\n//#region src/utils/url.ts\nfunction checkHasPath(url) {\n\ttry {\n\t\treturn (new URL(url).pathname.replace(/\\/+$/, \"\") || \"/\") !== \"/\";\n\t} catch (error) {\n\t\tthrow new BetterAuthError(`Invalid base URL: ${url}. Please provide a valid base URL.`);\n\t}\n}\nfunction assertHasProtocol(url) {\n\ttry {\n\t\tconst parsedUrl = new URL(url);\n\t\tif (parsedUrl.protocol !== \"http:\" && parsedUrl.protocol !== \"https:\") throw new BetterAuthError(`Invalid base URL: ${url}. URL must include 'http://' or 'https://'`);\n\t} catch (error) {\n\t\tif (error instanceof BetterAuthError) throw error;\n\t\tthrow new BetterAuthError(`Invalid base URL: ${url}. Please provide a valid base URL.`, String(error));\n\t}\n}\nfunction withPath(url, path = \"/api/auth\") {\n\tassertHasProtocol(url);\n\tif (checkHasPath(url)) return url;\n\tconst trimmedUrl = url.replace(/\\/+$/, \"\");\n\tif (!path || path === \"/\") return trimmedUrl;\n\tpath = path.startsWith(\"/\") ? path : `/${path}`;\n\treturn `${trimmedUrl}${path}`;\n}\nfunction getBaseURL(url, path, request, loadEnv, trustedProxyHeaders) {\n\tif (url) return withPath(url, path);\n\tif (loadEnv !== false) {\n\t\tconst fromEnv = env.BETTER_AUTH_URL || env.NEXT_PUBLIC_BETTER_AUTH_URL || env.PUBLIC_BETTER_AUTH_URL || env.NUXT_PUBLIC_BETTER_AUTH_URL || env.NUXT_PUBLIC_AUTH_URL || (env.BASE_URL !== \"/\" ? env.BASE_URL : void 0);\n\t\tif (fromEnv) return withPath(fromEnv, path);\n\t}\n\tconst fromRequest = request?.headers.get(\"x-forwarded-host\");\n\tconst fromRequestProto = request?.headers.get(\"x-forwarded-proto\");\n\tif (fromRequest && fromRequestProto && trustedProxyHeaders) return withPath(`${fromRequestProto}://${fromRequest}`, path);\n\tif (request) {\n\t\tconst url$1 = getOrigin(request.url);\n\t\tif (!url$1) throw new BetterAuthError(\"Could not get origin from request. Please provide a valid base URL.\");\n\t\treturn withPath(url$1, path);\n\t}\n\tif (typeof window !== \"undefined\" && window.location) return withPath(window.location.origin, path);\n}\nfunction getOrigin(url) {\n\ttry {\n\t\tconst parsedUrl = new URL(url);\n\t\treturn parsedUrl.origin === \"null\" ? null : parsedUrl.origin;\n\t} catch (error) {\n\t\treturn null;\n\t}\n}\nfunction getProtocol(url) {\n\ttry {\n\t\treturn new URL(url).protocol;\n\t} catch (error) {\n\t\treturn null;\n\t}\n}\nfunction getHost(url) {\n\ttry {\n\t\treturn new URL(url).host;\n\t} catch (error) {\n\t\treturn null;\n\t}\n}\n\n//#endregion\nexport { getProtocol as i, getHost as n, getOrigin as r, getBaseURL as t };"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AACA;AAAA;;;AAEA,0BAA0B;AAC1B,SAAS,aAAa,GAAG;IACxB,IAAI;QACH,OAAO,CAAC,IAAI,IAAI,KAAK,QAAQ,CAAC,OAAO,CAAC,QAAQ,OAAO,GAAG,MAAM;IAC/D,EAAE,OAAO,OAAO;QACf,MAAM,IAAI,mOAAe,CAAC,CAAC,kBAAkB,EAAE,IAAI,kCAAkC,CAAC;IACvF;AACD;AACA,SAAS,kBAAkB,GAAG;IAC7B,IAAI;QACH,MAAM,YAAY,IAAI,IAAI;QAC1B,IAAI,UAAU,QAAQ,KAAK,WAAW,UAAU,QAAQ,KAAK,UAAU,MAAM,IAAI,mOAAe,CAAC,CAAC,kBAAkB,EAAE,IAAI,0CAA0C,CAAC;IACtK,EAAE,OAAO,OAAO;QACf,IAAI,iBAAiB,mOAAe,EAAE,MAAM;QAC5C,MAAM,IAAI,mOAAe,CAAC,CAAC,kBAAkB,EAAE,IAAI,kCAAkC,CAAC,EAAE,OAAO;IAChG;AACD;AACA,SAAS,SAAS,GAAG,EAAE,OAAO,WAAW;IACxC,kBAAkB;IAClB,IAAI,aAAa,MAAM,OAAO;IAC9B,MAAM,aAAa,IAAI,OAAO,CAAC,QAAQ;IACvC,IAAI,CAAC,QAAQ,SAAS,KAAK,OAAO;IAClC,OAAO,KAAK,UAAU,CAAC,OAAO,OAAO,CAAC,CAAC,EAAE,MAAM;IAC/C,OAAO,GAAG,aAAa,MAAM;AAC9B;AACA,SAAS,WAAW,GAAG,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,mBAAmB;IACnE,IAAI,KAAK,OAAO,SAAS,KAAK;IAC9B,IAAI,YAAY,OAAO;QACtB,MAAM,UAAU,yMAAG,CAAC,eAAe,IAAI,yMAAG,CAAC,2BAA2B,IAAI,yMAAG,CAAC,sBAAsB,IAAI,yMAAG,CAAC,2BAA2B,IAAI,yMAAG,CAAC,oBAAoB,IAAI,CAAC,yMAAG,CAAC,QAAQ,KAAK,MAAM,yMAAG,CAAC,QAAQ,GAAG,KAAK,CAAC;QACpN,IAAI,SAAS,OAAO,SAAS,SAAS;IACvC;IACA,MAAM,cAAc,SAAS,QAAQ,IAAI;IACzC,MAAM,mBAAmB,SAAS,QAAQ,IAAI;IAC9C,IAAI,eAAe,oBAAoB,qBAAqB,OAAO,SAAS,GAAG,iBAAiB,GAAG,EAAE,aAAa,EAAE;IACpH,IAAI,SAAS;QACZ,MAAM,QAAQ,UAAU,QAAQ,GAAG;QACnC,IAAI,CAAC,OAAO,MAAM,IAAI,mOAAe,CAAC;QACtC,OAAO,SAAS,OAAO;IACxB;IACA;;AACD;AACA,SAAS,UAAU,GAAG;IACrB,IAAI;QACH,MAAM,YAAY,IAAI,IAAI;QAC1B,OAAO,UAAU,MAAM,KAAK,SAAS,OAAO,UAAU,MAAM;IAC7D,EAAE,OAAO,OAAO;QACf,OAAO;IACR;AACD;AACA,SAAS,YAAY,GAAG;IACvB,IAAI;QACH,OAAO,IAAI,IAAI,KAAK,QAAQ;IAC7B,EAAE,OAAO,OAAO;QACf,OAAO;IACR;AACD;AACA,SAAS,QAAQ,GAAG;IACnB,IAAI;QACH,OAAO,IAAI,IAAI,KAAK,IAAI;IACzB,EAAE,OAAO,OAAO;QACf,OAAO;IACR;AACD","ignoreList":[0]}},
    {"offset": {"line": 2479, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/cookies-D72PbWdz.mjs"],"sourcesContent":["import { c as symmetricEncodeJWT, l as verifyJWT, o as signJWT, s as symmetricDecodeJWT } from \"./crypto-CFUhAR9W.mjs\";\nimport { l as parseUserOutput, u as getDate } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as safeJSONParse } from \"./json-CnHxKYpj.mjs\";\nimport { t as getBaseURL } from \"./url-CB8xCwz-.mjs\";\nimport { env, isProduction } from \"@better-auth/core/env\";\nimport { BetterAuthError } from \"@better-auth/core/error\";\nimport * as z from \"zod\";\nimport { base64Url } from \"@better-auth/utils/base64\";\nimport { binary } from \"@better-auth/utils/binary\";\nimport { createHMAC } from \"@better-auth/utils/hmac\";\nimport { ms } from \"ms\";\n\n//#region src/cookies/session-store.ts\nconst ALLOWED_COOKIE_SIZE = 4096;\nconst ESTIMATED_EMPTY_COOKIE_SIZE = 200;\nconst CHUNK_SIZE = ALLOWED_COOKIE_SIZE - ESTIMATED_EMPTY_COOKIE_SIZE;\n/**\n* Parse cookies from the request headers\n*/\nfunction parseCookiesFromContext(ctx) {\n\tconst cookieHeader = ctx.headers?.get(\"cookie\");\n\tif (!cookieHeader) return {};\n\tconst cookies = {};\n\tconst pairs = cookieHeader.split(\"; \");\n\tfor (const pair of pairs) {\n\t\tconst [name, ...valueParts] = pair.split(\"=\");\n\t\tif (name && valueParts.length > 0) cookies[name] = valueParts.join(\"=\");\n\t}\n\treturn cookies;\n}\n/**\n* Extract the chunk index from a cookie name\n*/\nfunction getChunkIndex(cookieName) {\n\tconst parts = cookieName.split(\".\");\n\tconst lastPart = parts[parts.length - 1];\n\tconst index = parseInt(lastPart || \"0\", 10);\n\treturn isNaN(index) ? 0 : index;\n}\n/**\n* Read all existing chunks from cookies\n*/\nfunction readExistingChunks(cookieName, ctx) {\n\tconst chunks = {};\n\tconst cookies = parseCookiesFromContext(ctx);\n\tfor (const [name, value] of Object.entries(cookies)) if (name.startsWith(cookieName)) chunks[name] = value;\n\treturn chunks;\n}\n/**\n* Get the full session data by joining all chunks\n*/\nfunction joinChunks(chunks) {\n\treturn Object.keys(chunks).sort((a, b) => {\n\t\treturn getChunkIndex(a) - getChunkIndex(b);\n\t}).map((key) => chunks[key]).join(\"\");\n}\n/**\n* Split a cookie value into chunks if needed\n*/\nfunction chunkCookie(storeName, cookie, chunks, logger$1) {\n\tconst chunkCount = Math.ceil(cookie.value.length / CHUNK_SIZE);\n\tif (chunkCount === 1) {\n\t\tchunks[cookie.name] = cookie.value;\n\t\treturn [cookie];\n\t}\n\tconst cookies = [];\n\tfor (let i = 0; i < chunkCount; i++) {\n\t\tconst name = `${cookie.name}.${i}`;\n\t\tconst start = i * CHUNK_SIZE;\n\t\tconst value = cookie.value.substring(start, start + CHUNK_SIZE);\n\t\tcookies.push({\n\t\t\t...cookie,\n\t\t\tname,\n\t\t\tvalue\n\t\t});\n\t\tchunks[name] = value;\n\t}\n\tlogger$1.debug(`CHUNKING_${storeName.toUpperCase()}_COOKIE`, {\n\t\tmessage: `${storeName} cookie exceeds allowed ${ALLOWED_COOKIE_SIZE} bytes.`,\n\t\temptyCookieSize: ESTIMATED_EMPTY_COOKIE_SIZE,\n\t\tvalueSize: cookie.value.length,\n\t\tchunkCount,\n\t\tchunks: cookies.map((c) => c.value.length + ESTIMATED_EMPTY_COOKIE_SIZE)\n\t});\n\treturn cookies;\n}\n/**\n* Get all cookies that should be cleaned (removed)\n*/\nfunction getCleanCookies(chunks, cookieOptions) {\n\tconst cleanedChunks = {};\n\tfor (const name in chunks) cleanedChunks[name] = {\n\t\tname,\n\t\tvalue: \"\",\n\t\toptions: {\n\t\t\t...cookieOptions,\n\t\t\tmaxAge: 0\n\t\t}\n\t};\n\treturn cleanedChunks;\n}\n/**\n* Create a session store for handling cookie chunking.\n* When session data exceeds 4KB, it automatically splits it into multiple cookies.\n*\n* Based on next-auth's SessionStore implementation.\n* @see https://github.com/nextauthjs/next-auth/blob/27b2519b84b8eb9cf053775dea29d577d2aa0098/packages/next-auth/src/core/lib/cookie.ts\n*/\nconst storeFactory = (storeName) => (cookieName, cookieOptions, ctx) => {\n\tconst chunks = readExistingChunks(cookieName, ctx);\n\tconst logger$1 = ctx.context.logger;\n\treturn {\n\t\tgetValue() {\n\t\t\treturn joinChunks(chunks);\n\t\t},\n\t\thasChunks() {\n\t\t\treturn Object.keys(chunks).length > 0;\n\t\t},\n\t\tchunk(value, options) {\n\t\t\tconst cleanedChunks = getCleanCookies(chunks, cookieOptions);\n\t\t\tfor (const name in chunks) delete chunks[name];\n\t\t\tconst cookies = cleanedChunks;\n\t\t\tconst chunked = chunkCookie(storeName, {\n\t\t\t\tname: cookieName,\n\t\t\t\tvalue,\n\t\t\t\toptions: {\n\t\t\t\t\t...cookieOptions,\n\t\t\t\t\t...options\n\t\t\t\t}\n\t\t\t}, chunks, logger$1);\n\t\t\tfor (const chunk of chunked) cookies[chunk.name] = chunk;\n\t\t\treturn Object.values(cookies);\n\t\t},\n\t\tclean() {\n\t\t\tconst cleanedChunks = getCleanCookies(chunks, cookieOptions);\n\t\t\tfor (const name in chunks) delete chunks[name];\n\t\t\treturn Object.values(cleanedChunks);\n\t\t},\n\t\tsetCookies(cookies) {\n\t\t\tfor (const cookie of cookies) ctx.setCookie(cookie.name, cookie.value, cookie.options);\n\t\t}\n\t};\n};\nconst createSessionStore = storeFactory(\"Session\");\nconst createAccountStore = storeFactory(\"Account\");\nfunction getChunkedCookie(ctx, cookieName) {\n\tconst value = ctx.getCookie(cookieName);\n\tif (value) return value;\n\tconst chunks = [];\n\tconst cookieHeader = ctx.headers?.get(\"cookie\");\n\tif (!cookieHeader) return null;\n\tconst cookies = {};\n\tconst pairs = cookieHeader.split(\"; \");\n\tfor (const pair of pairs) {\n\t\tconst [name, ...valueParts] = pair.split(\"=\");\n\t\tif (name && valueParts.length > 0) cookies[name] = valueParts.join(\"=\");\n\t}\n\tfor (const [name, val] of Object.entries(cookies)) if (name.startsWith(cookieName + \".\")) {\n\t\tconst indexStr = name.split(\".\").at(-1);\n\t\tconst index = parseInt(indexStr || \"0\", 10);\n\t\tif (!isNaN(index)) chunks.push({\n\t\t\tindex,\n\t\t\tvalue: val\n\t\t});\n\t}\n\tif (chunks.length > 0) {\n\t\tchunks.sort((a, b) => a.index - b.index);\n\t\treturn chunks.map((c) => c.value).join(\"\");\n\t}\n\treturn null;\n}\nasync function setAccountCookie(c, accountData) {\n\tconst accountDataCookie = c.context.authCookies.accountData;\n\tconst options = {\n\t\tmaxAge: 300,\n\t\t...accountDataCookie.options\n\t};\n\tconst data = await symmetricEncodeJWT(accountData, c.context.secret, \"better-auth-account\", options.maxAge);\n\tif (data.length > ALLOWED_COOKIE_SIZE) {\n\t\tconst accountStore = createAccountStore(accountDataCookie.name, options, c);\n\t\tconst cookies = accountStore.chunk(data, options);\n\t\taccountStore.setCookies(cookies);\n\t} else {\n\t\tconst accountStore = createAccountStore(accountDataCookie.name, options, c);\n\t\tif (accountStore.hasChunks()) {\n\t\t\tconst cleanCookies = accountStore.clean();\n\t\t\taccountStore.setCookies(cleanCookies);\n\t\t}\n\t\tc.setCookie(accountDataCookie.name, data, options);\n\t}\n}\nasync function getAccountCookie(c) {\n\tconst accountCookie = getChunkedCookie(c, c.context.authCookies.accountData.name);\n\tif (accountCookie) {\n\t\tconst accountData = safeJSONParse(await symmetricDecodeJWT(accountCookie, c.context.secret, \"better-auth-account\"));\n\t\tif (accountData) return accountData;\n\t}\n\treturn null;\n}\nconst getSessionQuerySchema = z.optional(z.object({\n\tdisableCookieCache: z.coerce.boolean().meta({ description: \"Disable cookie cache and fetch session from database\" }).optional(),\n\tdisableRefresh: z.coerce.boolean().meta({ description: \"Disable session refresh. Useful for checking session status, without updating the session\" }).optional()\n}));\n\n//#endregion\n//#region src/cookies/cookie-utils.ts\nfunction parseSetCookieHeader(setCookie) {\n\tconst cookies = /* @__PURE__ */ new Map();\n\tsetCookie.split(\", \").forEach((cookieString) => {\n\t\tconst [nameValue, ...attributes] = cookieString.split(\";\").map((part) => part.trim());\n\t\tconst [name, ...valueParts] = (nameValue || \"\").split(\"=\");\n\t\tconst value = valueParts.join(\"=\");\n\t\tif (!name || value === void 0) return;\n\t\tconst attrObj = { value };\n\t\tattributes.forEach((attribute) => {\n\t\t\tconst [attrName, ...attrValueParts] = attribute.split(\"=\");\n\t\t\tconst attrValue = attrValueParts.join(\"=\");\n\t\t\tconst normalizedAttrName = attrName.trim().toLowerCase();\n\t\t\tswitch (normalizedAttrName) {\n\t\t\t\tcase \"max-age\":\n\t\t\t\t\tattrObj[\"max-age\"] = attrValue ? parseInt(attrValue.trim(), 10) : void 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"expires\":\n\t\t\t\t\tattrObj.expires = attrValue ? new Date(attrValue.trim()) : void 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"domain\":\n\t\t\t\t\tattrObj.domain = attrValue ? attrValue.trim() : void 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"path\":\n\t\t\t\t\tattrObj.path = attrValue ? attrValue.trim() : void 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"secure\":\n\t\t\t\t\tattrObj.secure = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"httponly\":\n\t\t\t\t\tattrObj.httponly = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"samesite\":\n\t\t\t\t\tattrObj.samesite = attrValue ? attrValue.trim().toLowerCase() : void 0;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tattrObj[normalizedAttrName] = attrValue ? attrValue.trim() : true;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t\tcookies.set(name, attrObj);\n\t});\n\treturn cookies;\n}\nfunction setCookieToHeader(headers) {\n\treturn (context) => {\n\t\tconst setCookieHeader = context.response.headers.get(\"set-cookie\");\n\t\tif (!setCookieHeader) return;\n\t\tconst cookieMap = /* @__PURE__ */ new Map();\n\t\t(headers.get(\"cookie\") || \"\").split(\";\").forEach((cookie) => {\n\t\t\tconst [name, ...rest] = cookie.trim().split(\"=\");\n\t\t\tif (name && rest.length > 0) cookieMap.set(name, rest.join(\"=\"));\n\t\t});\n\t\tsetCookieHeader.split(\",\").forEach((header) => {\n\t\t\tparseSetCookieHeader(header).forEach((value, name) => {\n\t\t\t\tcookieMap.set(name, value.value);\n\t\t\t});\n\t\t});\n\t\tconst updatedCookies = Array.from(cookieMap.entries()).map(([name, value]) => `${name}=${value}`).join(\"; \");\n\t\theaders.set(\"cookie\", updatedCookies);\n\t};\n}\n\n//#endregion\n//#region src/cookies/index.ts\nfunction createCookieGetter(options) {\n\tconst secureCookiePrefix = (options.advanced?.useSecureCookies !== void 0 ? options.advanced?.useSecureCookies : options.baseURL !== void 0 ? options.baseURL.startsWith(\"https://\") ? true : false : isProduction) ? \"__Secure-\" : \"\";\n\tconst crossSubdomainEnabled = !!options.advanced?.crossSubDomainCookies?.enabled;\n\tconst domain = crossSubdomainEnabled ? options.advanced?.crossSubDomainCookies?.domain || (options.baseURL ? new URL(options.baseURL).hostname : void 0) : void 0;\n\tif (crossSubdomainEnabled && !domain) throw new BetterAuthError(\"baseURL is required when crossSubdomainCookies are enabled\");\n\tfunction createCookie(cookieName, overrideAttributes = {}) {\n\t\tconst prefix = options.advanced?.cookiePrefix || \"better-auth\";\n\t\tconst name = options.advanced?.cookies?.[cookieName]?.name || `${prefix}.${cookieName}`;\n\t\tconst attributes = options.advanced?.cookies?.[cookieName]?.attributes;\n\t\treturn {\n\t\t\tname: `${secureCookiePrefix}${name}`,\n\t\t\tattributes: {\n\t\t\t\tsecure: !!secureCookiePrefix,\n\t\t\t\tsameSite: \"lax\",\n\t\t\t\tpath: \"/\",\n\t\t\t\thttpOnly: true,\n\t\t\t\t...crossSubdomainEnabled ? { domain } : {},\n\t\t\t\t...options.advanced?.defaultCookieAttributes,\n\t\t\t\t...overrideAttributes,\n\t\t\t\t...attributes\n\t\t\t}\n\t\t};\n\t}\n\treturn createCookie;\n}\nfunction getCookies(options) {\n\tconst createCookie = createCookieGetter(options);\n\tconst sessionToken = createCookie(\"session_token\", { maxAge: options.session?.expiresIn || ms(\"7d\") / 1e3 });\n\tconst sessionData = createCookie(\"session_data\", { maxAge: options.session?.cookieCache?.maxAge || 300 });\n\tconst accountData = createCookie(\"account_data\", { maxAge: options.session?.cookieCache?.maxAge || 300 });\n\tconst dontRememberToken = createCookie(\"dont_remember\");\n\treturn {\n\t\tsessionToken: {\n\t\t\tname: sessionToken.name,\n\t\t\toptions: sessionToken.attributes\n\t\t},\n\t\tsessionData: {\n\t\t\tname: sessionData.name,\n\t\t\toptions: sessionData.attributes\n\t\t},\n\t\tdontRememberToken: {\n\t\t\tname: dontRememberToken.name,\n\t\t\toptions: dontRememberToken.attributes\n\t\t},\n\t\taccountData: {\n\t\t\tname: accountData.name,\n\t\t\toptions: accountData.attributes\n\t\t}\n\t};\n}\nasync function setCookieCache(ctx, session, dontRememberMe) {\n\tif (ctx.context.options.session?.cookieCache?.enabled) {\n\t\tconst filteredSession = Object.entries(session.session).reduce((acc, [key, value]) => {\n\t\t\tconst fieldConfig = ctx.context.options.session?.additionalFields?.[key];\n\t\t\tif (!fieldConfig || fieldConfig.returned !== false) acc[key] = value;\n\t\t\treturn acc;\n\t\t}, {});\n\t\tconst filteredUser = parseUserOutput(ctx.context.options, session.user);\n\t\tconst versionConfig = ctx.context.options.session?.cookieCache?.version;\n\t\tlet version = \"1\";\n\t\tif (versionConfig) {\n\t\t\tif (typeof versionConfig === \"string\") version = versionConfig;\n\t\t\telse if (typeof versionConfig === \"function\") {\n\t\t\t\tconst result = versionConfig(session.session, session.user);\n\t\t\t\tversion = result instanceof Promise ? await result : result;\n\t\t\t}\n\t\t}\n\t\tconst sessionData = {\n\t\t\tsession: filteredSession,\n\t\t\tuser: filteredUser,\n\t\t\tupdatedAt: Date.now(),\n\t\t\tversion\n\t\t};\n\t\tconst options = {\n\t\t\t...ctx.context.authCookies.sessionData.options,\n\t\t\tmaxAge: dontRememberMe ? void 0 : ctx.context.authCookies.sessionData.options.maxAge\n\t\t};\n\t\tconst expiresAtDate = getDate(options.maxAge || 60, \"sec\").getTime();\n\t\tconst strategy = ctx.context.options.session?.cookieCache?.strategy || \"compact\";\n\t\tlet data;\n\t\tif (strategy === \"jwe\") data = await symmetricEncodeJWT(sessionData, ctx.context.secret, \"better-auth-session\", options.maxAge || 300);\n\t\telse if (strategy === \"jwt\") data = await signJWT(sessionData, ctx.context.secret, options.maxAge || 300);\n\t\telse data = base64Url.encode(JSON.stringify({\n\t\t\tsession: sessionData,\n\t\t\texpiresAt: expiresAtDate,\n\t\t\tsignature: await createHMAC(\"SHA-256\", \"base64urlnopad\").sign(ctx.context.secret, JSON.stringify({\n\t\t\t\t...sessionData,\n\t\t\t\texpiresAt: expiresAtDate\n\t\t\t}))\n\t\t}), { padding: false });\n\t\tif (data.length > 4093) {\n\t\t\tconst sessionStore = createSessionStore(ctx.context.authCookies.sessionData.name, options, ctx);\n\t\t\tconst cookies = sessionStore.chunk(data, options);\n\t\t\tsessionStore.setCookies(cookies);\n\t\t} else {\n\t\t\tconst sessionStore = createSessionStore(ctx.context.authCookies.sessionData.name, options, ctx);\n\t\t\tif (sessionStore.hasChunks()) {\n\t\t\t\tconst cleanCookies = sessionStore.clean();\n\t\t\t\tsessionStore.setCookies(cleanCookies);\n\t\t\t}\n\t\t\tctx.setCookie(ctx.context.authCookies.sessionData.name, data, options);\n\t\t}\n\t}\n}\nasync function setSessionCookie(ctx, session, dontRememberMe, overrides) {\n\tconst dontRememberMeCookie = await ctx.getSignedCookie(ctx.context.authCookies.dontRememberToken.name, ctx.context.secret);\n\tdontRememberMe = dontRememberMe !== void 0 ? dontRememberMe : !!dontRememberMeCookie;\n\tconst options = ctx.context.authCookies.sessionToken.options;\n\tconst maxAge = dontRememberMe ? void 0 : ctx.context.sessionConfig.expiresIn;\n\tawait ctx.setSignedCookie(ctx.context.authCookies.sessionToken.name, session.session.token, ctx.context.secret, {\n\t\t...options,\n\t\tmaxAge,\n\t\t...overrides\n\t});\n\tif (dontRememberMe) await ctx.setSignedCookie(ctx.context.authCookies.dontRememberToken.name, \"true\", ctx.context.secret, ctx.context.authCookies.dontRememberToken.options);\n\tawait setCookieCache(ctx, session, dontRememberMe);\n\tctx.context.setNewSession(session);\n\t/**\n\t* If secondary storage is enabled, store the session data in the secondary storage\n\t* This is useful if the session got updated and we want to update the session data in the\n\t* secondary storage\n\t*/\n\tif (ctx.context.options.secondaryStorage) await ctx.context.secondaryStorage?.set(session.session.token, JSON.stringify({\n\t\tuser: session.user,\n\t\tsession: session.session\n\t}), Math.floor((new Date(session.session.expiresAt).getTime() - Date.now()) / 1e3));\n}\nfunction deleteSessionCookie(ctx, skipDontRememberMe) {\n\tctx.setCookie(ctx.context.authCookies.sessionToken.name, \"\", {\n\t\t...ctx.context.authCookies.sessionToken.options,\n\t\tmaxAge: 0\n\t});\n\tconst sessionStore = createSessionStore(ctx.context.authCookies.sessionData.name, ctx.context.authCookies.sessionData.options, ctx);\n\tconst cleanCookies = sessionStore.clean();\n\tsessionStore.setCookies(cleanCookies);\n\tif (!skipDontRememberMe) ctx.setCookie(ctx.context.authCookies.dontRememberToken.name, \"\", {\n\t\t...ctx.context.authCookies.dontRememberToken.options,\n\t\tmaxAge: 0\n\t});\n}\nfunction parseCookies(cookieHeader) {\n\tconst cookies = cookieHeader.split(\"; \");\n\tconst cookieMap = /* @__PURE__ */ new Map();\n\tcookies.forEach((cookie) => {\n\t\tconst [name, value] = cookie.split(\"=\");\n\t\tcookieMap.set(name, value);\n\t});\n\treturn cookieMap;\n}\nconst getSessionCookie = (request, config) => {\n\tif (config?.cookiePrefix) if (config.cookieName) config.cookiePrefix = `${config.cookiePrefix}-`;\n\telse config.cookiePrefix = `${config.cookiePrefix}.`;\n\tconst headers = \"headers\" in request ? request.headers : request;\n\tconst req = request instanceof Request ? request : void 0;\n\tgetBaseURL(req?.url, config?.path, req);\n\tconst cookies = headers.get(\"cookie\");\n\tif (!cookies) return null;\n\tconst { cookieName = \"session_token\", cookiePrefix = \"better-auth.\" } = config || {};\n\tconst name = `${cookiePrefix}${cookieName}`;\n\tconst secureCookieName = `__Secure-${name}`;\n\tconst parsedCookie = parseCookies(cookies);\n\tconst sessionToken = parsedCookie.get(name) || parsedCookie.get(secureCookieName);\n\tif (sessionToken) return sessionToken;\n\treturn null;\n};\nconst getCookieCache = async (request, config) => {\n\tconst cookies = (request instanceof Headers ? request : request.headers).get(\"cookie\");\n\tif (!cookies) return null;\n\tconst { cookieName = \"session_data\", cookiePrefix = \"better-auth\" } = config || {};\n\tconst name = config?.isSecure !== void 0 ? config.isSecure ? `__Secure-${cookiePrefix}.${cookieName}` : `${cookiePrefix}.${cookieName}` : isProduction ? `__Secure-${cookiePrefix}.${cookieName}` : `${cookiePrefix}.${cookieName}`;\n\tconst parsedCookie = parseCookies(cookies);\n\tlet sessionData = parsedCookie.get(name);\n\tif (!sessionData) {\n\t\tconst chunks = [];\n\t\tfor (const [cookieName$1, value] of parsedCookie.entries()) if (cookieName$1.startsWith(name + \".\")) {\n\t\t\tconst parts = cookieName$1.split(\".\");\n\t\t\tconst indexStr = parts[parts.length - 1];\n\t\t\tconst index = parseInt(indexStr || \"0\", 10);\n\t\t\tif (!isNaN(index)) chunks.push({\n\t\t\t\tindex,\n\t\t\t\tvalue\n\t\t\t});\n\t\t}\n\t\tif (chunks.length > 0) {\n\t\t\tchunks.sort((a, b) => a.index - b.index);\n\t\t\tsessionData = chunks.map((c) => c.value).join(\"\");\n\t\t}\n\t}\n\tif (sessionData) {\n\t\tconst secret = config?.secret || env.BETTER_AUTH_SECRET;\n\t\tif (!secret) throw new BetterAuthError(\"getCookieCache requires a secret to be provided. Either pass it as an option or set the BETTER_AUTH_SECRET environment variable\");\n\t\tconst strategy = config?.strategy || \"compact\";\n\t\tif (strategy === \"jwe\") {\n\t\t\tconst payload = await symmetricDecodeJWT(sessionData, secret, \"better-auth-session\");\n\t\t\tif (payload && payload.session && payload.user) {\n\t\t\t\tif (config?.version) {\n\t\t\t\t\tconst cookieVersion = payload.version || \"1\";\n\t\t\t\t\tlet expectedVersion = \"1\";\n\t\t\t\t\tif (typeof config.version === \"string\") expectedVersion = config.version;\n\t\t\t\t\telse if (typeof config.version === \"function\") {\n\t\t\t\t\t\tconst result = config.version(payload.session, payload.user);\n\t\t\t\t\t\texpectedVersion = result instanceof Promise ? await result : result;\n\t\t\t\t\t}\n\t\t\t\t\tif (cookieVersion !== expectedVersion) return null;\n\t\t\t\t}\n\t\t\t\treturn payload;\n\t\t\t}\n\t\t\treturn null;\n\t\t} else if (strategy === \"jwt\") {\n\t\t\tconst payload = await verifyJWT(sessionData, secret);\n\t\t\tif (payload && payload.session && payload.user) {\n\t\t\t\tif (config?.version) {\n\t\t\t\t\tconst cookieVersion = payload.version || \"1\";\n\t\t\t\t\tlet expectedVersion = \"1\";\n\t\t\t\t\tif (typeof config.version === \"string\") expectedVersion = config.version;\n\t\t\t\t\telse if (typeof config.version === \"function\") {\n\t\t\t\t\t\tconst result = config.version(payload.session, payload.user);\n\t\t\t\t\t\texpectedVersion = result instanceof Promise ? await result : result;\n\t\t\t\t\t}\n\t\t\t\t\tif (cookieVersion !== expectedVersion) return null;\n\t\t\t\t}\n\t\t\t\treturn payload;\n\t\t\t}\n\t\t\treturn null;\n\t\t} else {\n\t\t\tconst sessionDataPayload = safeJSONParse(binary.decode(base64Url.decode(sessionData)));\n\t\t\tif (!sessionDataPayload) return null;\n\t\t\tif (!await createHMAC(\"SHA-256\", \"base64urlnopad\").verify(secret, JSON.stringify({\n\t\t\t\t...sessionDataPayload.session,\n\t\t\t\texpiresAt: sessionDataPayload.expiresAt\n\t\t\t}), sessionDataPayload.signature)) return null;\n\t\t\tif (config?.version && sessionDataPayload.session) {\n\t\t\t\tconst cookieVersion = sessionDataPayload.session.version || \"1\";\n\t\t\t\tlet expectedVersion = \"1\";\n\t\t\t\tif (typeof config.version === \"string\") expectedVersion = config.version;\n\t\t\t\telse if (typeof config.version === \"function\") {\n\t\t\t\t\tconst result = config.version(sessionDataPayload.session.session, sessionDataPayload.session.user);\n\t\t\t\t\texpectedVersion = result instanceof Promise ? await result : result;\n\t\t\t\t}\n\t\t\t\tif (cookieVersion !== expectedVersion) return null;\n\t\t\t}\n\t\t\treturn sessionDataPayload.session;\n\t\t}\n\t}\n\treturn null;\n};\n\n//#endregion\nexport { getSessionCookie as a, setSessionCookie as c, createSessionStore as d, getAccountCookie as f, setAccountCookie as h, getCookies as i, parseSetCookieHeader as l, getSessionQuerySchema as m, deleteSessionCookie as n, parseCookies as o, getChunkedCookie as p, getCookieCache as r, setCookieCache as s, createCookieGetter as t, setCookieToHeader as u };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 3054, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/session-AaRl3_x-.mjs"],"sourcesContent":["import { l as verifyJWT, s as symmetricDecodeJWT } from \"./crypto-CFUhAR9W.mjs\";\nimport { l as parseUserOutput, s as parseSessionOutput, u as getDate } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as safeJSONParse } from \"./json-CnHxKYpj.mjs\";\nimport { c as setSessionCookie, m as getSessionQuerySchema, n as deleteSessionCookie, p as getChunkedCookie, s as setCookieCache } from \"./cookies-D72PbWdz.mjs\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\nimport { base64Url } from \"@better-auth/utils/base64\";\nimport { binary } from \"@better-auth/utils/binary\";\nimport { createHMAC } from \"@better-auth/utils/hmac\";\n\n//#region src/api/routes/session.ts\nconst getSession = () => createAuthEndpoint(\"/get-session\", {\n\tmethod: \"GET\",\n\toperationId: \"getSession\",\n\tquery: getSessionQuerySchema,\n\trequireHeaders: true,\n\tmetadata: { openapi: {\n\t\toperationId: \"getSession\",\n\t\tdescription: \"Get the current session\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: {\n\t\t\t\t\tsession: { $ref: \"#/components/schemas/Session\" },\n\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" }\n\t\t\t\t},\n\t\t\t\trequired: [\"session\", \"user\"]\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\ttry {\n\t\tconst sessionCookieToken = await ctx.getSignedCookie(ctx.context.authCookies.sessionToken.name, ctx.context.secret);\n\t\tif (!sessionCookieToken) return null;\n\t\tconst sessionDataCookie = getChunkedCookie(ctx, ctx.context.authCookies.sessionData.name);\n\t\tlet sessionDataPayload = null;\n\t\tif (sessionDataCookie) {\n\t\t\tconst strategy = ctx.context.options.session?.cookieCache?.strategy || \"compact\";\n\t\t\tif (strategy === \"jwe\") {\n\t\t\t\tconst payload = await symmetricDecodeJWT(sessionDataCookie, ctx.context.secret, \"better-auth-session\");\n\t\t\t\tif (payload && payload.session && payload.user) sessionDataPayload = {\n\t\t\t\t\tsession: {\n\t\t\t\t\t\tsession: payload.session,\n\t\t\t\t\t\tuser: payload.user,\n\t\t\t\t\t\tupdatedAt: payload.updatedAt,\n\t\t\t\t\t\tversion: payload.version\n\t\t\t\t\t},\n\t\t\t\t\texpiresAt: payload.exp ? payload.exp * 1e3 : Date.now()\n\t\t\t\t};\n\t\t\t\telse {\n\t\t\t\t\tconst dataCookie = ctx.context.authCookies.sessionData.name;\n\t\t\t\t\tctx.setCookie(dataCookie, \"\", { maxAge: 0 });\n\t\t\t\t\treturn ctx.json(null);\n\t\t\t\t}\n\t\t\t} else if (strategy === \"jwt\") {\n\t\t\t\tconst payload = await verifyJWT(sessionDataCookie, ctx.context.secret);\n\t\t\t\tif (payload && payload.session && payload.user) sessionDataPayload = {\n\t\t\t\t\tsession: {\n\t\t\t\t\t\tsession: payload.session,\n\t\t\t\t\t\tuser: payload.user,\n\t\t\t\t\t\tupdatedAt: payload.updatedAt,\n\t\t\t\t\t\tversion: payload.version\n\t\t\t\t\t},\n\t\t\t\t\texpiresAt: payload.exp ? payload.exp * 1e3 : Date.now()\n\t\t\t\t};\n\t\t\t\telse {\n\t\t\t\t\tconst dataCookie = ctx.context.authCookies.sessionData.name;\n\t\t\t\t\tctx.setCookie(dataCookie, \"\", { maxAge: 0 });\n\t\t\t\t\treturn ctx.json(null);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst parsed = safeJSONParse(binary.decode(base64Url.decode(sessionDataCookie)));\n\t\t\t\tif (parsed) if (await createHMAC(\"SHA-256\", \"base64urlnopad\").verify(ctx.context.secret, JSON.stringify({\n\t\t\t\t\t...parsed.session,\n\t\t\t\t\texpiresAt: parsed.expiresAt\n\t\t\t\t}), parsed.signature)) sessionDataPayload = parsed;\n\t\t\t\telse {\n\t\t\t\t\tconst dataCookie = ctx.context.authCookies.sessionData.name;\n\t\t\t\t\tctx.setCookie(dataCookie, \"\", { maxAge: 0 });\n\t\t\t\t\treturn ctx.json(null);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst dontRememberMe = await ctx.getSignedCookie(ctx.context.authCookies.dontRememberToken.name, ctx.context.secret);\n\t\t/**\n\t\t* If session data is present in the cookie, check if it should be used or refreshed\n\t\t*/\n\t\tif (sessionDataPayload?.session && ctx.context.options.session?.cookieCache?.enabled && !ctx.query?.disableCookieCache) {\n\t\t\tconst session$1 = sessionDataPayload.session;\n\t\t\tconst versionConfig = ctx.context.options.session?.cookieCache?.version;\n\t\t\tlet expectedVersion = \"1\";\n\t\t\tif (versionConfig) {\n\t\t\t\tif (typeof versionConfig === \"string\") expectedVersion = versionConfig;\n\t\t\t\telse if (typeof versionConfig === \"function\") {\n\t\t\t\t\tconst result = versionConfig(session$1.session, session$1.user);\n\t\t\t\t\texpectedVersion = result instanceof Promise ? await result : result;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ((session$1.version || \"1\") !== expectedVersion) {\n\t\t\t\tconst dataCookie = ctx.context.authCookies.sessionData.name;\n\t\t\t\tctx.setCookie(dataCookie, \"\", { maxAge: 0 });\n\t\t\t} else if (sessionDataPayload.expiresAt < Date.now() || session$1.session.expiresAt < /* @__PURE__ */ new Date()) {\n\t\t\t\tconst dataCookie = ctx.context.authCookies.sessionData.name;\n\t\t\t\tctx.setCookie(dataCookie, \"\", { maxAge: 0 });\n\t\t\t} else {\n\t\t\t\tconst cookieRefreshCache = ctx.context.sessionConfig.cookieRefreshCache;\n\t\t\t\tif (cookieRefreshCache === false) {\n\t\t\t\t\tctx.context.session = session$1;\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tsession: session$1.session,\n\t\t\t\t\t\tuser: session$1.user\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (sessionDataPayload.expiresAt - Date.now() < cookieRefreshCache.updateAge * 1e3) {\n\t\t\t\t\tconst newExpiresAt = getDate(ctx.context.options.session?.cookieCache?.maxAge || 300, \"sec\");\n\t\t\t\t\tconst refreshedSession = {\n\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t...session$1.session,\n\t\t\t\t\t\t\texpiresAt: newExpiresAt\n\t\t\t\t\t\t},\n\t\t\t\t\t\tuser: session$1.user,\n\t\t\t\t\t\tupdatedAt: Date.now()\n\t\t\t\t\t};\n\t\t\t\t\tawait setCookieCache(ctx, refreshedSession, false);\n\t\t\t\t\tconst parsedRefreshedSession = parseSessionOutput(ctx.context.options, {\n\t\t\t\t\t\t...refreshedSession.session,\n\t\t\t\t\t\texpiresAt: new Date(refreshedSession.session.expiresAt),\n\t\t\t\t\t\tcreatedAt: new Date(refreshedSession.session.createdAt),\n\t\t\t\t\t\tupdatedAt: new Date(refreshedSession.session.updatedAt)\n\t\t\t\t\t});\n\t\t\t\t\tconst parsedRefreshedUser = parseUserOutput(ctx.context.options, {\n\t\t\t\t\t\t...refreshedSession.user,\n\t\t\t\t\t\tcreatedAt: new Date(refreshedSession.user.createdAt),\n\t\t\t\t\t\tupdatedAt: new Date(refreshedSession.user.updatedAt)\n\t\t\t\t\t});\n\t\t\t\t\tctx.context.session = {\n\t\t\t\t\t\tsession: parsedRefreshedSession,\n\t\t\t\t\t\tuser: parsedRefreshedUser\n\t\t\t\t\t};\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tsession: parsedRefreshedSession,\n\t\t\t\t\t\tuser: parsedRefreshedUser\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst parsedSession = parseSessionOutput(ctx.context.options, {\n\t\t\t\t\t...session$1.session,\n\t\t\t\t\texpiresAt: new Date(session$1.session.expiresAt),\n\t\t\t\t\tcreatedAt: new Date(session$1.session.createdAt),\n\t\t\t\t\tupdatedAt: new Date(session$1.session.updatedAt)\n\t\t\t\t});\n\t\t\t\tconst parsedUser = parseUserOutput(ctx.context.options, {\n\t\t\t\t\t...session$1.user,\n\t\t\t\t\tcreatedAt: new Date(session$1.user.createdAt),\n\t\t\t\t\tupdatedAt: new Date(session$1.user.updatedAt)\n\t\t\t\t});\n\t\t\t\tctx.context.session = {\n\t\t\t\t\tsession: parsedSession,\n\t\t\t\t\tuser: parsedUser\n\t\t\t\t};\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tsession: parsedSession,\n\t\t\t\t\tuser: parsedUser\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tconst session = await ctx.context.internalAdapter.findSession(sessionCookieToken);\n\t\tctx.context.session = session;\n\t\tif (!session || session.session.expiresAt < /* @__PURE__ */ new Date()) {\n\t\t\tdeleteSessionCookie(ctx);\n\t\t\tif (session)\n /**\n\t\t\t* if session expired clean up the session\n\t\t\t*/\n\t\t\tawait ctx.context.internalAdapter.deleteSession(session.session.token);\n\t\t\treturn ctx.json(null);\n\t\t}\n\t\t/**\n\t\t* We don't need to update the session if the user doesn't want to be remembered\n\t\t* or if the session refresh is disabled\n\t\t*/\n\t\tif (dontRememberMe || ctx.query?.disableRefresh) {\n\t\t\tconst parsedSession = parseSessionOutput(ctx.context.options, session.session);\n\t\t\tconst parsedUser = parseUserOutput(ctx.context.options, session.user);\n\t\t\treturn ctx.json({\n\t\t\t\tsession: parsedSession,\n\t\t\t\tuser: parsedUser\n\t\t\t});\n\t\t}\n\t\tconst expiresIn = ctx.context.sessionConfig.expiresIn;\n\t\tconst updateAge = ctx.context.sessionConfig.updateAge;\n\t\tif (session.session.expiresAt.valueOf() - expiresIn * 1e3 + updateAge * 1e3 <= Date.now() && (!ctx.query?.disableRefresh || !ctx.context.options.session?.disableSessionRefresh)) {\n\t\t\tconst updatedSession = await ctx.context.internalAdapter.updateSession(session.session.token, {\n\t\t\t\texpiresAt: getDate(ctx.context.sessionConfig.expiresIn, \"sec\"),\n\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t});\n\t\t\tif (!updatedSession) {\n\t\t\t\t/**\n\t\t\t\t* Handle case where session update fails (e.g., concurrent deletion)\n\t\t\t\t*/\n\t\t\t\tdeleteSessionCookie(ctx);\n\t\t\t\treturn ctx.json(null, { status: 401 });\n\t\t\t}\n\t\t\tconst maxAge = (updatedSession.expiresAt.valueOf() - Date.now()) / 1e3;\n\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\tsession: updatedSession,\n\t\t\t\tuser: session.user\n\t\t\t}, false, { maxAge });\n\t\t\tconst parsedUpdatedSession = parseSessionOutput(ctx.context.options, updatedSession);\n\t\t\tconst parsedUser = parseUserOutput(ctx.context.options, session.user);\n\t\t\treturn ctx.json({\n\t\t\t\tsession: parsedUpdatedSession,\n\t\t\t\tuser: parsedUser\n\t\t\t});\n\t\t}\n\t\tawait setCookieCache(ctx, session, !!dontRememberMe);\n\t\treturn ctx.json(session);\n\t} catch (error) {\n\t\tctx.context.logger.error(\"INTERNAL_SERVER_ERROR\", error);\n\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", { message: BASE_ERROR_CODES.FAILED_TO_GET_SESSION });\n\t}\n});\nconst getSessionFromCtx = async (ctx, config) => {\n\tif (ctx.context.session) return ctx.context.session;\n\tconst session = await getSession()({\n\t\t...ctx,\n\t\tasResponse: false,\n\t\theaders: ctx.headers,\n\t\treturnHeaders: false,\n\t\treturnStatus: false,\n\t\tquery: {\n\t\t\t...config,\n\t\t\t...ctx.query\n\t\t}\n\t}).catch((e) => {\n\t\treturn null;\n\t});\n\tctx.context.session = session;\n\treturn session;\n};\n/**\n* The middleware forces the endpoint to require a valid session.\n*/\nconst sessionMiddleware = createAuthMiddleware(async (ctx) => {\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session?.session) throw new APIError(\"UNAUTHORIZED\");\n\treturn { session };\n});\n/**\n* This middleware forces the endpoint to require a valid session and ignores cookie cache.\n* This should be used for sensitive operations like password changes, account deletion, etc.\n* to ensure that revoked sessions cannot be used even if they're still cached in cookies.\n*/\nconst sensitiveSessionMiddleware = createAuthMiddleware(async (ctx) => {\n\tconst session = await getSessionFromCtx(ctx, { disableCookieCache: true });\n\tif (!session?.session) throw new APIError(\"UNAUTHORIZED\");\n\treturn { session };\n});\n/**\n* This middleware allows you to call the endpoint on the client if session is valid.\n* However, if called on the server, no session is required.\n*/\nconst requestOnlySessionMiddleware = createAuthMiddleware(async (ctx) => {\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session?.session && (ctx.request || ctx.headers)) throw new APIError(\"UNAUTHORIZED\");\n\treturn { session };\n});\n/**\n* This middleware forces the endpoint to require a valid session,\n* as well as making sure the session is fresh before proceeding.\n*\n* Session freshness check will be skipped if the session config's freshAge\n* is set to 0\n*/\nconst freshSessionMiddleware = createAuthMiddleware(async (ctx) => {\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session?.session) throw new APIError(\"UNAUTHORIZED\");\n\tif (ctx.context.sessionConfig.freshAge === 0) return { session };\n\tconst freshAge = ctx.context.sessionConfig.freshAge;\n\tconst lastUpdated = new Date(session.session.updatedAt || session.session.createdAt).getTime();\n\tif (!(Date.now() - lastUpdated < freshAge * 1e3)) throw new APIError(\"FORBIDDEN\", { message: \"Session is not fresh\" });\n\treturn { session };\n});\n/**\n* user active sessions list\n*/\nconst listSessions = () => createAuthEndpoint(\"/list-sessions\", {\n\tmethod: \"GET\",\n\toperationId: \"listUserSessions\",\n\tuse: [sessionMiddleware],\n\trequireHeaders: true,\n\tmetadata: { openapi: {\n\t\toperationId: \"listUserSessions\",\n\t\tdescription: \"List all active sessions for the user\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"array\",\n\t\t\t\titems: { $ref: \"#/components/schemas/Session\" }\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\ttry {\n\t\tconst activeSessions = (await ctx.context.internalAdapter.listSessions(ctx.context.session.user.id)).filter((session) => {\n\t\t\treturn session.expiresAt > /* @__PURE__ */ new Date();\n\t\t});\n\t\treturn ctx.json(activeSessions);\n\t} catch (e) {\n\t\tctx.context.logger.error(e);\n\t\tthrow ctx.error(\"INTERNAL_SERVER_ERROR\");\n\t}\n});\n/**\n* revoke a single session\n*/\nconst revokeSession = createAuthEndpoint(\"/revoke-session\", {\n\tmethod: \"POST\",\n\tbody: z.object({ token: z.string().meta({ description: \"The token to revoke\" }) }),\n\tuse: [sensitiveSessionMiddleware],\n\trequireHeaders: true,\n\tmetadata: { openapi: {\n\t\tdescription: \"Revoke a single session\",\n\t\trequestBody: { content: { \"application/json\": { schema: {\n\t\t\ttype: \"object\",\n\t\t\tproperties: { token: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tdescription: \"The token to revoke\"\n\t\t\t} },\n\t\t\trequired: [\"token\"]\n\t\t} } } },\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { status: {\n\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\tdescription: \"Indicates if the session was revoked successfully\"\n\t\t\t\t} },\n\t\t\t\trequired: [\"status\"]\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tconst token = ctx.body.token;\n\tif ((await ctx.context.internalAdapter.findSession(token))?.session.userId === ctx.context.session.user.id) try {\n\t\tawait ctx.context.internalAdapter.deleteSession(token);\n\t} catch (error) {\n\t\tctx.context.logger.error(error && typeof error === \"object\" && \"name\" in error ? error.name : \"\", error);\n\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\");\n\t}\n\treturn ctx.json({ status: true });\n});\n/**\n* revoke all user sessions\n*/\nconst revokeSessions = createAuthEndpoint(\"/revoke-sessions\", {\n\tmethod: \"POST\",\n\tuse: [sensitiveSessionMiddleware],\n\trequireHeaders: true,\n\tmetadata: { openapi: {\n\t\tdescription: \"Revoke all sessions for the user\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { status: {\n\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\tdescription: \"Indicates if all sessions were revoked successfully\"\n\t\t\t\t} },\n\t\t\t\trequired: [\"status\"]\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\ttry {\n\t\tawait ctx.context.internalAdapter.deleteSessions(ctx.context.session.user.id);\n\t} catch (error) {\n\t\tctx.context.logger.error(error && typeof error === \"object\" && \"name\" in error ? error.name : \"\", error);\n\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\");\n\t}\n\treturn ctx.json({ status: true });\n});\nconst revokeOtherSessions = createAuthEndpoint(\"/revoke-other-sessions\", {\n\tmethod: \"POST\",\n\trequireHeaders: true,\n\tuse: [sensitiveSessionMiddleware],\n\tmetadata: { openapi: {\n\t\tdescription: \"Revoke all other sessions for the user except the current one\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { status: {\n\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\tdescription: \"Indicates if all other sessions were revoked successfully\"\n\t\t\t\t} },\n\t\t\t\trequired: [\"status\"]\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tconst session = ctx.context.session;\n\tif (!session.user) throw new APIError(\"UNAUTHORIZED\");\n\tconst otherSessions = (await ctx.context.internalAdapter.listSessions(session.user.id)).filter((session$1) => {\n\t\treturn session$1.expiresAt > /* @__PURE__ */ new Date();\n\t}).filter((session$1) => session$1.token !== ctx.context.session.session.token);\n\tawait Promise.all(otherSessions.map((session$1) => ctx.context.internalAdapter.deleteSession(session$1.token)));\n\treturn ctx.json({ status: true });\n});\n\n//#endregion\nexport { requestOnlySessionMiddleware as a, revokeSessions as c, listSessions as i, sensitiveSessionMiddleware as l, getSession as n, revokeOtherSessions as o, getSessionFromCtx as r, revokeSession as s, freshSessionMiddleware as t, sessionMiddleware as u };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 3611, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/password-BFQK0cLg.mjs"],"sourcesContent":["import { APIError } from \"better-call\";\n\n//#region src/utils/password.ts\nasync function validatePassword(ctx, data) {\n\tconst credentialAccount = (await ctx.context.internalAdapter.findAccounts(data.userId))?.find((account) => account.providerId === \"credential\");\n\tconst currentPassword = credentialAccount?.password;\n\tif (!credentialAccount || !currentPassword) return false;\n\treturn await ctx.context.password.verify({\n\t\thash: currentPassword,\n\t\tpassword: data.password\n\t});\n}\nasync function checkPassword(userId, c) {\n\tconst credentialAccount = (await c.context.internalAdapter.findAccounts(userId))?.find((account) => account.providerId === \"credential\");\n\tconst currentPassword = credentialAccount?.password;\n\tif (!credentialAccount || !currentPassword || !c.body.password) throw new APIError(\"BAD_REQUEST\", { message: \"No password credential found\" });\n\tif (!await c.context.password.verify({\n\t\thash: currentPassword,\n\t\tpassword: c.body.password\n\t})) throw new APIError(\"BAD_REQUEST\", { message: \"Invalid password\" });\n\treturn true;\n}\n\n//#endregion\nexport { validatePassword as n, checkPassword as t };"],"names":[],"mappings":";;;;;;AAAA;;AAEA,+BAA+B;AAC/B,eAAe,iBAAiB,GAAG,EAAE,IAAI;IACxC,MAAM,oBAAoB,CAAC,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,YAAY,CAAC,KAAK,MAAM,CAAC,GAAG,KAAK,CAAC,UAAY,QAAQ,UAAU,KAAK;IAClI,MAAM,kBAAkB,mBAAmB;IAC3C,IAAI,CAAC,qBAAqB,CAAC,iBAAiB,OAAO;IACnD,OAAO,MAAM,IAAI,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC;QACxC,MAAM;QACN,UAAU,KAAK,QAAQ;IACxB;AACD;AACA,eAAe,cAAc,MAAM,EAAE,CAAC;IACrC,MAAM,oBAAoB,CAAC,MAAM,EAAE,OAAO,CAAC,eAAe,CAAC,YAAY,CAAC,OAAO,GAAG,KAAK,CAAC,UAAY,QAAQ,UAAU,KAAK;IAC3H,MAAM,kBAAkB,mBAAmB;IAC3C,IAAI,CAAC,qBAAqB,CAAC,mBAAmB,CAAC,EAAE,IAAI,CAAC,QAAQ,EAAE,MAAM,IAAI,6JAAQ,CAAC,eAAe;QAAE,SAAS;IAA+B;IAC5I,IAAI,CAAC,MAAM,EAAE,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC;QACpC,MAAM;QACN,UAAU,EAAE,IAAI,CAAC,QAAQ;IAC1B,IAAI,MAAM,IAAI,6JAAQ,CAAC,eAAe;QAAE,SAAS;IAAmB;IACpE,OAAO;AACR","ignoreList":[0]}},
    {"offset": {"line": 3648, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/base-CiRMFqet.mjs"],"sourcesContent":["import { a as getAuthTables } from \"./get-model-name-D4DUV7S2.mjs\";\nimport { a as createInternalAdapter } from \"./get-migration-Bf0TuCzm.mjs\";\nimport { t as generateId } from \"./utils-db7gNqd-.mjs\";\nimport { a as verifyPassword, i as hashPassword } from \"./crypto-CFUhAR9W.mjs\";\nimport { r as getOrigin, t as getBaseURL } from \"./url-CB8xCwz-.mjs\";\nimport { a as getEndpoints, n as checkEndpointConflicts, s as router } from \"./api-CkmycQ2x.mjs\";\nimport { i as getCookies, t as createCookieGetter } from \"./cookies-D72PbWdz.mjs\";\nimport { t as checkPassword } from \"./password-BFQK0cLg.mjs\";\nimport { runWithAdapter } from \"@better-auth/core/context\";\nimport { createLogger, env, isProduction, isTest } from \"@better-auth/core/env\";\nimport { BASE_ERROR_CODES, BetterAuthError } from \"@better-auth/core/error\";\nimport { socialProviders } from \"@better-auth/core/social-providers\";\nimport { createTelemetry } from \"@better-auth/telemetry\";\nimport defu$1, { defu } from \"defu\";\n\n//#region src/utils/constants.ts\nconst DEFAULT_SECRET = \"better-auth-secret-12345678901234567890\";\n\n//#endregion\n//#region src/utils/is-promise.ts\nfunction isPromise(obj) {\n\treturn !!obj && (typeof obj === \"object\" || typeof obj === \"function\") && typeof obj.then === \"function\";\n}\n\n//#endregion\n//#region src/context/helpers.ts\nasync function runPluginInit(ctx) {\n\tlet options = ctx.options;\n\tconst plugins = options.plugins || [];\n\tlet context = ctx;\n\tconst dbHooks = [];\n\tfor (const plugin of plugins) if (plugin.init) {\n\t\tlet initPromise = plugin.init(context);\n\t\tlet result;\n\t\tif (isPromise(initPromise)) result = await initPromise;\n\t\telse result = initPromise;\n\t\tif (typeof result === \"object\") {\n\t\t\tif (result.options) {\n\t\t\t\tconst { databaseHooks, ...restOpts } = result.options;\n\t\t\t\tif (databaseHooks) dbHooks.push(databaseHooks);\n\t\t\t\toptions = defu(options, restOpts);\n\t\t\t}\n\t\t\tif (result.context) context = {\n\t\t\t\t...context,\n\t\t\t\t...result.context\n\t\t\t};\n\t\t}\n\t}\n\tdbHooks.push(options.databaseHooks);\n\tcontext.internalAdapter = createInternalAdapter(context.adapter, {\n\t\toptions,\n\t\tlogger: context.logger,\n\t\thooks: dbHooks.filter((u) => u !== void 0),\n\t\tgenerateId: context.generateId\n\t});\n\tcontext.options = options;\n\treturn { context };\n}\nfunction getInternalPlugins(options) {\n\tconst plugins = [];\n\tif (options.advanced?.crossSubDomainCookies?.enabled) {}\n\treturn plugins;\n}\nfunction getTrustedOrigins(options) {\n\tconst baseURL = getBaseURL(options.baseURL, options.basePath);\n\tif (!baseURL) return [];\n\tconst trustedOrigins = [new URL(baseURL).origin];\n\tif (options.trustedOrigins && Array.isArray(options.trustedOrigins)) trustedOrigins.push(...options.trustedOrigins);\n\tconst envTrustedOrigins = env.BETTER_AUTH_TRUSTED_ORIGINS;\n\tif (envTrustedOrigins) trustedOrigins.push(...envTrustedOrigins.split(\",\"));\n\tif (trustedOrigins.filter((x) => !x).length) throw new BetterAuthError(\"A provided trusted origin is invalid, make sure your trusted origins list is properly defined.\");\n\treturn trustedOrigins;\n}\n\n//#endregion\n//#region src/context/create-context.ts\n/**\n* Estimates the entropy of a string in bits.\n* This is a simple approximation that helps detect low-entropy secrets.\n*/\nfunction estimateEntropy(str) {\n\tconst unique = new Set(str).size;\n\tif (unique === 0) return 0;\n\treturn Math.log2(Math.pow(unique, str.length));\n}\n/**\n* Validates that the secret meets minimum security requirements.\n* Throws BetterAuthError if the secret is invalid.\n* Skips validation for DEFAULT_SECRET in test environments only.\n* Only throws for DEFAULT_SECRET in production environment.\n*/\nfunction validateSecret(secret, logger$1) {\n\tconst isDefaultSecret = secret === DEFAULT_SECRET;\n\tif (isTest()) return;\n\tif (isDefaultSecret && isProduction) throw new BetterAuthError(\"You are using the default secret. Please set `BETTER_AUTH_SECRET` in your environment variables or pass `secret` in your auth config.\");\n\tif (!secret) throw new BetterAuthError(\"BETTER_AUTH_SECRET is missing. Set it in your environment or pass `secret` to betterAuth({ secret }).\");\n\tif (secret.length < 32) throw new BetterAuthError(`Invalid BETTER_AUTH_SECRET: must be at least 32 characters long for adequate security. Generate one with \\`npx @better-auth/cli secret\\` or \\`openssl rand -base64 32\\`.`);\n\tif (estimateEntropy(secret) < 120) logger$1.warn(\"[better-auth] Warning: your BETTER_AUTH_SECRET appears low-entropy. Use a randomly generated secret for production.\");\n}\nasync function createAuthContext(adapter, options, getDatabaseType) {\n\tif (!options.database) options = defu$1(options, {\n\t\tsession: { cookieCache: {\n\t\t\tenabled: true,\n\t\t\tstrategy: \"jwe\",\n\t\t\trefreshCache: true\n\t\t} },\n\t\taccount: {\n\t\t\tstoreStateStrategy: \"cookie\",\n\t\t\tstoreAccountCookie: true\n\t\t}\n\t});\n\tconst plugins = options.plugins || [];\n\tconst internalPlugins = getInternalPlugins(options);\n\tconst logger$1 = createLogger(options.logger);\n\tconst baseURL = getBaseURL(options.baseURL, options.basePath);\n\tconst secret = options.secret || env.BETTER_AUTH_SECRET || env.AUTH_SECRET || DEFAULT_SECRET;\n\tvalidateSecret(secret, logger$1);\n\toptions = {\n\t\t...options,\n\t\tsecret,\n\t\tbaseURL: baseURL ? new URL(baseURL).origin : \"\",\n\t\tbasePath: options.basePath || \"/api/auth\",\n\t\tplugins: plugins.concat(internalPlugins)\n\t};\n\tcheckEndpointConflicts(options, logger$1);\n\tconst cookies = getCookies(options);\n\tconst tables = getAuthTables(options);\n\tconst providers = Object.entries(options.socialProviders || {}).map(([key, config]) => {\n\t\tif (config == null) return null;\n\t\tif (config.enabled === false) return null;\n\t\tif (!config.clientId) logger$1.warn(`Social provider ${key} is missing clientId or clientSecret`);\n\t\tconst provider = socialProviders[key](config);\n\t\tprovider.disableImplicitSignUp = config.disableImplicitSignUp;\n\t\treturn provider;\n\t}).filter((x) => x !== null);\n\tconst generateIdFunc = ({ model, size }) => {\n\t\tif (typeof options.advanced?.generateId === \"function\") return options.advanced.generateId({\n\t\t\tmodel,\n\t\t\tsize\n\t\t});\n\t\tif (typeof options?.advanced?.database?.generateId === \"function\") return options.advanced.database.generateId({\n\t\t\tmodel,\n\t\t\tsize\n\t\t});\n\t\treturn generateId(size);\n\t};\n\tconst { publish } = await createTelemetry(options, {\n\t\tadapter: adapter.id,\n\t\tdatabase: typeof options.database === \"function\" ? \"adapter\" : getDatabaseType(options.database)\n\t});\n\tconst initOrPromise = runPluginInit({\n\t\tappName: options.appName || \"Better Auth\",\n\t\tsocialProviders: providers,\n\t\toptions,\n\t\toauthConfig: {\n\t\t\tstoreStateStrategy: options.account?.storeStateStrategy || \"database\",\n\t\t\tskipStateCookieCheck: !!options.account?.skipStateCookieCheck\n\t\t},\n\t\ttables,\n\t\ttrustedOrigins: getTrustedOrigins(options),\n\t\tbaseURL: baseURL || \"\",\n\t\tsessionConfig: {\n\t\t\tupdateAge: options.session?.updateAge !== void 0 ? options.session.updateAge : 1440 * 60,\n\t\t\texpiresIn: options.session?.expiresIn || 3600 * 24 * 7,\n\t\t\tfreshAge: options.session?.freshAge === void 0 ? 3600 * 24 : options.session.freshAge,\n\t\t\tcookieRefreshCache: (() => {\n\t\t\t\tconst refreshCache = options.session?.cookieCache?.refreshCache;\n\t\t\t\tconst maxAge = options.session?.cookieCache?.maxAge || 300;\n\t\t\t\tif (refreshCache === false || refreshCache === void 0) return false;\n\t\t\t\tif (refreshCache === true) return {\n\t\t\t\t\tenabled: true,\n\t\t\t\t\tupdateAge: Math.floor(maxAge * .2)\n\t\t\t\t};\n\t\t\t\treturn {\n\t\t\t\t\tenabled: true,\n\t\t\t\t\tupdateAge: refreshCache.updateAge !== void 0 ? refreshCache.updateAge : Math.floor(maxAge * .2)\n\t\t\t\t};\n\t\t\t})()\n\t\t},\n\t\tsecret,\n\t\trateLimit: {\n\t\t\t...options.rateLimit,\n\t\t\tenabled: options.rateLimit?.enabled ?? isProduction,\n\t\t\twindow: options.rateLimit?.window || 10,\n\t\t\tmax: options.rateLimit?.max || 100,\n\t\t\tstorage: options.rateLimit?.storage || (options.secondaryStorage ? \"secondary-storage\" : \"memory\")\n\t\t},\n\t\tauthCookies: cookies,\n\t\tlogger: logger$1,\n\t\tgenerateId: generateIdFunc,\n\t\tsession: null,\n\t\tsecondaryStorage: options.secondaryStorage,\n\t\tpassword: {\n\t\t\thash: options.emailAndPassword?.password?.hash || hashPassword,\n\t\t\tverify: options.emailAndPassword?.password?.verify || verifyPassword,\n\t\t\tconfig: {\n\t\t\t\tminPasswordLength: options.emailAndPassword?.minPasswordLength || 8,\n\t\t\t\tmaxPasswordLength: options.emailAndPassword?.maxPasswordLength || 128\n\t\t\t},\n\t\t\tcheckPassword\n\t\t},\n\t\tsetNewSession(session) {\n\t\t\tthis.newSession = session;\n\t\t},\n\t\tnewSession: null,\n\t\tadapter,\n\t\tinternalAdapter: createInternalAdapter(adapter, {\n\t\t\toptions,\n\t\t\tlogger: logger$1,\n\t\t\thooks: options.databaseHooks ? [options.databaseHooks] : [],\n\t\t\tgenerateId: generateIdFunc\n\t\t}),\n\t\tcreateAuthCookie: createCookieGetter(options),\n\t\tasync runMigrations() {\n\t\t\tthrow new BetterAuthError(\"runMigrations will be set by the specific init implementation\");\n\t\t},\n\t\tpublishTelemetry: publish,\n\t\tskipCSRFCheck: !!options.advanced?.disableCSRFCheck,\n\t\tskipOriginCheck: options.advanced?.disableOriginCheck !== void 0 ? options.advanced.disableOriginCheck : isTest() ? true : false\n\t});\n\tlet context;\n\tif (isPromise(initOrPromise)) ({context} = await initOrPromise);\n\telse ({context} = initOrPromise);\n\treturn context;\n}\n\n//#endregion\n//#region src/auth/base.ts\nconst createBetterAuth = (options, initFn) => {\n\tconst authContext = initFn(options);\n\tconst { api } = getEndpoints(authContext, options);\n\treturn {\n\t\thandler: async (request) => {\n\t\t\tconst ctx = await authContext;\n\t\t\tconst basePath = ctx.options.basePath || \"/api/auth\";\n\t\t\tif (!ctx.options.baseURL) {\n\t\t\t\tconst baseURL = getBaseURL(void 0, basePath, request, void 0, ctx.options.advanced?.trustedProxyHeaders);\n\t\t\t\tif (baseURL) {\n\t\t\t\t\tctx.baseURL = baseURL;\n\t\t\t\t\tctx.options.baseURL = getOrigin(ctx.baseURL) || void 0;\n\t\t\t\t} else throw new BetterAuthError(\"Could not get base URL from request. Please provide a valid base URL.\");\n\t\t\t}\n\t\t\tctx.trustedOrigins = [...options.trustedOrigins ? Array.isArray(options.trustedOrigins) ? options.trustedOrigins : await options.trustedOrigins(request) : [], ctx.options.baseURL];\n\t\t\tconst { handler } = router(ctx, options);\n\t\t\treturn runWithAdapter(ctx.adapter, () => handler(request));\n\t\t},\n\t\tapi,\n\t\toptions,\n\t\t$context: authContext,\n\t\t$ERROR_CODES: {\n\t\t\t...options.plugins?.reduce((acc, plugin) => {\n\t\t\t\tif (plugin.$ERROR_CODES) return {\n\t\t\t\t\t...acc,\n\t\t\t\t\t...plugin.$ERROR_CODES\n\t\t\t\t};\n\t\t\t\treturn acc;\n\t\t\t}, {}),\n\t\t\t...BASE_ERROR_CODES\n\t\t}\n\t};\n};\n\n//#endregion\nexport { createAuthContext as n, createBetterAuth as t };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 3945, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/auth-DfR8_5w3.mjs"],"sourcesContent":["import { n as getKyselyDatabaseType } from \"./dialect-D9ZUZA4J.mjs\";\nimport { t as getMigrations, u as getAdapter } from \"./get-migration-Bf0TuCzm.mjs\";\nimport { n as createAuthContext, t as createBetterAuth } from \"./base-CiRMFqet.mjs\";\nimport { BetterAuthError } from \"@better-auth/core/error\";\n\n//#region src/context/init.ts\nconst init = async (options) => {\n\tconst adapter = await getAdapter(options);\n\tconst getDatabaseType = (database) => getKyselyDatabaseType(database) || \"unknown\";\n\tconst ctx = await createAuthContext(adapter, options, getDatabaseType);\n\tctx.runMigrations = async function() {\n\t\tif (!options.database || \"updateMany\" in options.database) throw new BetterAuthError(\"Database is not provided or it's an adapter. Migrations are only supported with a database instance.\");\n\t\tconst { runMigrations } = await getMigrations(options);\n\t\tawait runMigrations();\n\t};\n\treturn ctx;\n};\n\n//#endregion\n//#region src/auth/auth.ts\n/**\n* Better Auth initializer for full mode (with Kysely)\n*\n* Check `minimal.ts` for minimal mode (without Kysely)\n*/\nconst betterAuth = (options) => {\n\treturn createBetterAuth(options, init);\n};\n\n//#endregion\nexport { betterAuth as t };"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AAAA;;;;;AAEA,6BAA6B;AAC7B,MAAM,OAAO,OAAO;IACnB,MAAM,UAAU,MAAM,IAAA,8KAAU,EAAC;IACjC,MAAM,kBAAkB,CAAC,WAAa,IAAA,qKAAqB,EAAC,aAAa;IACzE,MAAM,MAAM,MAAM,IAAA,kKAAiB,EAAC,SAAS,SAAS;IACtD,IAAI,aAAa,GAAG;QACnB,IAAI,CAAC,QAAQ,QAAQ,IAAI,gBAAgB,QAAQ,QAAQ,EAAE,MAAM,IAAI,mOAAe,CAAC;QACrF,MAAM,EAAE,aAAa,EAAE,GAAG,MAAM,IAAA,8KAAa,EAAC;QAC9C,MAAM;IACP;IACA,OAAO;AACR;AAEA,YAAY;AACZ,0BAA0B;AAC1B;;;;AAIA,GACA,MAAM,aAAa,CAAC;IACnB,OAAO,IAAA,kKAAgB,EAAC,SAAS;AAClC","ignoreList":[0]}},
    {"offset": {"line": 3984, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 3990, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/index.mjs"],"sourcesContent":["import \"./dialect-D9ZUZA4J.mjs\";\nimport \"./get-model-name-D4DUV7S2.mjs\";\nimport \"./get-migration-Bf0TuCzm.mjs\";\nimport { i as parseState, n as HIDE_METADATA, r as generateState, t as generateId } from \"./utils-db7gNqd-.mjs\";\nimport \"./crypto-CFUhAR9W.mjs\";\nimport { t as capitalizeFirstLetter } from \"./misc-BwNc0MKr.mjs\";\nimport \"./schema-Bb7wzeK_.mjs\";\nimport \"./get-request-ip-D6st-mto.mjs\";\nimport \"./json-CnHxKYpj.mjs\";\nimport \"./url-CB8xCwz-.mjs\";\nimport { t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport \"./cookies-D72PbWdz.mjs\";\nimport \"./session-AaRl3_x-.mjs\";\nimport \"./base-CiRMFqet.mjs\";\nimport \"./password-BFQK0cLg.mjs\";\nimport { t as betterAuth } from \"./auth-DfR8_5w3.mjs\";\nimport \"./types-BOTDmeLz.mjs\";\nimport { getCurrentAdapter } from \"@better-auth/core/context\";\nimport { createTelemetry, getTelemetryAuthConfig } from \"@better-auth/telemetry\";\n\nexport * from \"@better-auth/core\"\n\nexport * from \"@better-auth/core/db\"\n\nexport * from \"@better-auth/core/env\"\n\nexport * from \"@better-auth/core/error\"\n\nexport * from \"@better-auth/core/oauth2\"\n\nexport * from \"@better-auth/core/utils\"\n\nexport { APIError, HIDE_METADATA, betterAuth, capitalizeFirstLetter, createTelemetry, generateId, generateState, getCurrentAdapter, getTelemetryAuthConfig, parseState };"],"names":[],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AAEA;AAEA;AAEA;AAEA;AAEA","ignoreList":[0]}},
    {"offset": {"line": 4057, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/adapter-factory-HF3JB9cT.mjs"],"sourcesContent":["import { a as getAuthTables, i as initGetDefaultModelName, n as initGetFieldName, r as initGetDefaultFieldName, t as initGetModelName } from \"./get-model-name-D4DUV7S2.mjs\";\nimport { t as generateId } from \"./utils-db7gNqd-.mjs\";\nimport { t as safeJSONParse } from \"./json-CnHxKYpj.mjs\";\nimport { TTY_COLORS, getColorDepth, logger } from \"@better-auth/core/env\";\nimport { BetterAuthError } from \"@better-auth/core/error\";\n\n//#region src/adapters/utils.ts\nfunction withApplyDefault(value, field, action) {\n\tif (action === \"update\") {\n\t\tif (value === void 0 && field.onUpdate !== void 0) {\n\t\t\tif (typeof field.onUpdate === \"function\") return field.onUpdate();\n\t\t\treturn field.onUpdate;\n\t\t}\n\t\treturn value;\n\t}\n\tif (action === \"create\") {\n\t\tif (value === void 0 || field.required === true && value === null) {\n\t\t\tif (field.defaultValue !== void 0) {\n\t\t\t\tif (typeof field.defaultValue === \"function\") return field.defaultValue();\n\t\t\t\treturn field.defaultValue;\n\t\t\t}\n\t\t}\n\t}\n\treturn value;\n}\n\n//#endregion\n//#region src/adapters/adapter-factory/get-id-field.ts\nconst initGetIdField = ({ usePlural, schema, disableIdGeneration, options, customIdGenerator, supportsUUIDs }) => {\n\tconst getDefaultModelName = initGetDefaultModelName({\n\t\tusePlural,\n\t\tschema\n\t});\n\tconst idField = ({ customModelName, forceAllowId }) => {\n\t\tconst useNumberId = options.advanced?.database?.useNumberId || options.advanced?.database?.generateId === \"serial\";\n\t\tconst useUUIDs = options.advanced?.database?.generateId === \"uuid\";\n\t\tlet shouldGenerateId = (() => {\n\t\t\tif (disableIdGeneration) return false;\n\t\t\telse if (useNumberId && !forceAllowId) return false;\n\t\t\telse if (useUUIDs) return !supportsUUIDs;\n\t\t\telse return true;\n\t\t})();\n\t\tconst model = getDefaultModelName(customModelName ?? \"id\");\n\t\treturn {\n\t\t\ttype: useNumberId ? \"number\" : \"string\",\n\t\t\trequired: shouldGenerateId ? true : false,\n\t\t\t...shouldGenerateId ? { defaultValue() {\n\t\t\t\tif (disableIdGeneration) return void 0;\n\t\t\t\tlet generateId$1 = options.advanced?.database?.generateId;\n\t\t\t\tif (generateId$1 === false || useNumberId) return void 0;\n\t\t\t\tif (typeof generateId$1 === \"function\") return generateId$1({ model });\n\t\t\t\tif (customIdGenerator) return customIdGenerator({ model });\n\t\t\t\tif (generateId$1 === \"uuid\") return crypto.randomUUID();\n\t\t\t\treturn generateId();\n\t\t\t} } : {},\n\t\t\ttransform: {\n\t\t\t\tinput: (value) => {\n\t\t\t\t\tif (!value) return void 0;\n\t\t\t\t\tif (useNumberId) {\n\t\t\t\t\t\tconst numberValue = Number(value);\n\t\t\t\t\t\tif (isNaN(numberValue)) return;\n\t\t\t\t\t\treturn numberValue;\n\t\t\t\t\t}\n\t\t\t\t\tif (useUUIDs) {\n\t\t\t\t\t\tif (shouldGenerateId && !forceAllowId) return value;\n\t\t\t\t\t\tif (disableIdGeneration) return void 0;\n\t\t\t\t\t\tif (supportsUUIDs) return void 0;\n\t\t\t\t\t\tif (forceAllowId && typeof value === \"string\") if (/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(value)) return value;\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tconst stack = (/* @__PURE__ */ new Error()).stack?.split(\"\\n\").filter((_, i) => i !== 1).join(\"\\n\").replace(\"Error:\", \"\");\n\t\t\t\t\t\t\tlogger.warn(\"[Adapter Factory] - Invalid UUID value for field `id` provided when `forceAllowId` is true. Generating a new UUID.\", stack);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (typeof value !== \"string\" && !supportsUUIDs) return crypto.randomUUID();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t},\n\t\t\t\toutput: (value) => {\n\t\t\t\t\tif (!value) return void 0;\n\t\t\t\t\treturn String(value);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t};\n\treturn idField;\n};\n\n//#endregion\n//#region src/adapters/adapter-factory/get-field-attributes.ts\nconst initGetFieldAttributes = ({ usePlural, schema, options, customIdGenerator, disableIdGeneration }) => {\n\tconst getDefaultModelName = initGetDefaultModelName({\n\t\tusePlural,\n\t\tschema\n\t});\n\tconst getDefaultFieldName = initGetDefaultFieldName({\n\t\tusePlural,\n\t\tschema\n\t});\n\tconst idField = initGetIdField({\n\t\tusePlural,\n\t\tschema,\n\t\toptions,\n\t\tcustomIdGenerator,\n\t\tdisableIdGeneration\n\t});\n\tconst getFieldAttributes = ({ model, field }) => {\n\t\tconst defaultModelName = getDefaultModelName(model);\n\t\tconst defaultFieldName = getDefaultFieldName({\n\t\t\tfield,\n\t\t\tmodel: defaultModelName\n\t\t});\n\t\tconst fields = schema[defaultModelName].fields;\n\t\tfields.id = idField({ customModelName: defaultModelName });\n\t\tconst fieldAttributes = fields[defaultFieldName];\n\t\tif (!fieldAttributes) throw new BetterAuthError(`Field ${field} not found in model ${model}`);\n\t\treturn fieldAttributes;\n\t};\n\treturn getFieldAttributes;\n};\n\n//#endregion\n//#region src/adapters/adapter-factory/index.ts\nlet debugLogs = [];\nlet transactionId = -1;\nconst createAsIsTransaction = (adapter) => (fn) => fn(adapter);\nconst createAdapterFactory = ({ adapter: customAdapter, config: cfg }) => (options) => {\n\tconst uniqueAdapterFactoryInstanceId = Math.random().toString(36).substring(2, 15);\n\tconst config = {\n\t\t...cfg,\n\t\tsupportsBooleans: cfg.supportsBooleans ?? true,\n\t\tsupportsDates: cfg.supportsDates ?? true,\n\t\tsupportsJSON: cfg.supportsJSON ?? false,\n\t\tadapterName: cfg.adapterName ?? cfg.adapterId,\n\t\tsupportsNumericIds: cfg.supportsNumericIds ?? true,\n\t\tsupportsUUIDs: cfg.supportsUUIDs ?? false,\n\t\ttransaction: cfg.transaction ?? false,\n\t\tdisableTransformInput: cfg.disableTransformInput ?? false,\n\t\tdisableTransformOutput: cfg.disableTransformOutput ?? false,\n\t\tdisableTransformJoin: cfg.disableTransformJoin ?? false\n\t};\n\tif ((options.advanced?.database?.useNumberId === true || options.advanced?.database?.generateId === \"serial\") && config.supportsNumericIds === false) throw new BetterAuthError(`[${config.adapterName}] Your database or database adapter does not support numeric ids. Please disable \"useNumberId\" in your config.`);\n\tconst schema = getAuthTables(options);\n\tconst debugLog = (...args) => {\n\t\tif (config.debugLogs === true || typeof config.debugLogs === \"object\") {\n\t\t\tif (typeof config.debugLogs === \"object\" && \"isRunningAdapterTests\" in config.debugLogs) {\n\t\t\t\tif (config.debugLogs.isRunningAdapterTests) {\n\t\t\t\t\targs.shift();\n\t\t\t\t\tdebugLogs.push({\n\t\t\t\t\t\tinstance: uniqueAdapterFactoryInstanceId,\n\t\t\t\t\t\targs\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (typeof config.debugLogs === \"object\" && config.debugLogs.logCondition && !config.debugLogs.logCondition?.()) return;\n\t\t\tif (typeof args[0] === \"object\" && \"method\" in args[0]) {\n\t\t\t\tconst method = args.shift().method;\n\t\t\t\tif (typeof config.debugLogs === \"object\") {\n\t\t\t\t\tif (method === \"create\" && !config.debugLogs.create) return;\n\t\t\t\t\telse if (method === \"update\" && !config.debugLogs.update) return;\n\t\t\t\t\telse if (method === \"updateMany\" && !config.debugLogs.updateMany) return;\n\t\t\t\t\telse if (method === \"findOne\" && !config.debugLogs.findOne) return;\n\t\t\t\t\telse if (method === \"findMany\" && !config.debugLogs.findMany) return;\n\t\t\t\t\telse if (method === \"delete\" && !config.debugLogs.delete) return;\n\t\t\t\t\telse if (method === \"deleteMany\" && !config.debugLogs.deleteMany) return;\n\t\t\t\t\telse if (method === \"count\" && !config.debugLogs.count) return;\n\t\t\t\t}\n\t\t\t\tlogger.info(`[${config.adapterName}]`, ...args);\n\t\t\t} else logger.info(`[${config.adapterName}]`, ...args);\n\t\t}\n\t};\n\tconst getDefaultModelName = initGetDefaultModelName({\n\t\tusePlural: config.usePlural,\n\t\tschema\n\t});\n\tconst getDefaultFieldName = initGetDefaultFieldName({\n\t\tusePlural: config.usePlural,\n\t\tschema\n\t});\n\tconst getModelName = initGetModelName({\n\t\tusePlural: config.usePlural,\n\t\tschema\n\t});\n\tconst getFieldName = initGetFieldName({\n\t\tschema,\n\t\tusePlural: config.usePlural\n\t});\n\tconst idField = initGetIdField({\n\t\tschema,\n\t\toptions,\n\t\tusePlural: config.usePlural,\n\t\tdisableIdGeneration: config.disableIdGeneration,\n\t\tcustomIdGenerator: config.customIdGenerator,\n\t\tsupportsUUIDs: config.supportsUUIDs\n\t});\n\tconst getFieldAttributes = initGetFieldAttributes({\n\t\tschema,\n\t\toptions,\n\t\tusePlural: config.usePlural,\n\t\tdisableIdGeneration: config.disableIdGeneration,\n\t\tcustomIdGenerator: config.customIdGenerator\n\t});\n\tconst transformInput = async (data, defaultModelName, action, forceAllowId) => {\n\t\tconst transformedData = {};\n\t\tconst fields = schema[defaultModelName].fields;\n\t\tconst newMappedKeys = config.mapKeysTransformInput ?? {};\n\t\tconst useNumberId = options.advanced?.database?.useNumberId || options.advanced?.database?.generateId === \"serial\";\n\t\tfields.id = idField({\n\t\t\tcustomModelName: defaultModelName,\n\t\t\tforceAllowId: forceAllowId && \"id\" in data\n\t\t});\n\t\tfor (const field in fields) {\n\t\t\tlet value = data[field];\n\t\t\tconst fieldAttributes = fields[field];\n\t\t\tlet newFieldName = newMappedKeys[field] || fields[field].fieldName || field;\n\t\t\tif (value === void 0 && (fieldAttributes.defaultValue === void 0 && !fieldAttributes.transform?.input && !(action === \"update\" && fieldAttributes.onUpdate) || action === \"update\" && !fieldAttributes.onUpdate)) continue;\n\t\t\tif (fieldAttributes && fieldAttributes.type === \"date\" && !(value instanceof Date) && typeof value === \"string\") try {\n\t\t\t\tvalue = new Date(value);\n\t\t\t} catch {\n\t\t\t\tlogger.error(\"[Adapter Factory] Failed to convert string to date\", {\n\t\t\t\t\tvalue,\n\t\t\t\t\tfield\n\t\t\t\t});\n\t\t\t}\n\t\t\tlet newValue = withApplyDefault(value, fieldAttributes, action);\n\t\t\tif (fieldAttributes.transform?.input) newValue = await fieldAttributes.transform.input(newValue);\n\t\t\tif (fieldAttributes.references?.field === \"id\" && useNumberId) if (Array.isArray(newValue)) newValue = newValue.map((x) => x !== null ? Number(x) : null);\n\t\t\telse newValue = newValue !== null ? Number(newValue) : null;\n\t\t\telse if (config.supportsJSON === false && typeof newValue === \"object\" && fieldAttributes.type === \"json\") newValue = JSON.stringify(newValue);\n\t\t\telse if (config.supportsJSON === false && Array.isArray(newValue) && (fieldAttributes.type === \"string[]\" || fieldAttributes.type === \"number[]\")) newValue = JSON.stringify(newValue);\n\t\t\telse if (config.supportsDates === false && newValue instanceof Date && fieldAttributes.type === \"date\") newValue = newValue.toISOString();\n\t\t\telse if (config.supportsBooleans === false && typeof newValue === \"boolean\") newValue = newValue ? 1 : 0;\n\t\t\tif (config.customTransformInput) newValue = config.customTransformInput({\n\t\t\t\tdata: newValue,\n\t\t\t\taction,\n\t\t\t\tfield: newFieldName,\n\t\t\t\tfieldAttributes,\n\t\t\t\tmodel: getModelName(defaultModelName),\n\t\t\t\tschema,\n\t\t\t\toptions\n\t\t\t});\n\t\t\tif (newValue !== void 0) transformedData[newFieldName] = newValue;\n\t\t}\n\t\treturn transformedData;\n\t};\n\tconst transformOutput = async (data, unsafe_model, select = [], join) => {\n\t\tconst transformSingleOutput = async (data$1, unsafe_model$1, select$1 = []) => {\n\t\t\tif (!data$1) return null;\n\t\t\tconst newMappedKeys = config.mapKeysTransformOutput ?? {};\n\t\t\tconst transformedData$1 = {};\n\t\t\tconst tableSchema = schema[getDefaultModelName(unsafe_model$1)].fields;\n\t\t\tconst idKey = Object.entries(newMappedKeys).find(([_, v]) => v === \"id\")?.[0];\n\t\t\ttableSchema[idKey ?? \"id\"] = { type: options.advanced?.database?.useNumberId || options.advanced?.database?.generateId === \"serial\" ? \"number\" : \"string\" };\n\t\t\tfor (const key in tableSchema) {\n\t\t\t\tif (select$1.length && !select$1.includes(key)) continue;\n\t\t\t\tconst field = tableSchema[key];\n\t\t\t\tif (field) {\n\t\t\t\t\tconst originalKey = field.fieldName || key;\n\t\t\t\t\tlet newValue = data$1[Object.entries(newMappedKeys).find(([_, v]) => v === originalKey)?.[0] || originalKey];\n\t\t\t\t\tif (field.transform?.output) newValue = await field.transform.output(newValue);\n\t\t\t\t\tlet newFieldName = newMappedKeys[key] || key;\n\t\t\t\t\tif (originalKey === \"id\" || field.references?.field === \"id\") {\n\t\t\t\t\t\tif (typeof newValue !== \"undefined\" && newValue !== null) newValue = String(newValue);\n\t\t\t\t\t} else if (config.supportsJSON === false && typeof newValue === \"string\" && field.type === \"json\") newValue = safeJSONParse(newValue);\n\t\t\t\t\telse if (config.supportsJSON === false && typeof newValue === \"string\" && (field.type === \"string[]\" || field.type === \"number[]\")) newValue = safeJSONParse(newValue);\n\t\t\t\t\telse if (config.supportsDates === false && typeof newValue === \"string\" && field.type === \"date\") newValue = new Date(newValue);\n\t\t\t\t\telse if (config.supportsBooleans === false && typeof newValue === \"number\" && field.type === \"boolean\") newValue = newValue === 1;\n\t\t\t\t\tif (config.customTransformOutput) newValue = config.customTransformOutput({\n\t\t\t\t\t\tdata: newValue,\n\t\t\t\t\t\tfield: newFieldName,\n\t\t\t\t\t\tfieldAttributes: field,\n\t\t\t\t\t\tselect: select$1,\n\t\t\t\t\t\tmodel: getModelName(unsafe_model$1),\n\t\t\t\t\t\tschema,\n\t\t\t\t\t\toptions\n\t\t\t\t\t});\n\t\t\t\t\ttransformedData$1[newFieldName] = newValue;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn transformedData$1;\n\t\t};\n\t\tif (!join || Object.keys(join).length === 0) return await transformSingleOutput(data, unsafe_model, select);\n\t\tunsafe_model = getDefaultModelName(unsafe_model);\n\t\tlet transformedData = await transformSingleOutput(data, unsafe_model, select);\n\t\tconst requiredModels = Object.entries(join).map(([model, joinConfig]) => ({\n\t\t\tmodelName: getModelName(model),\n\t\t\tdefaultModelName: getDefaultModelName(model),\n\t\t\tjoinConfig\n\t\t}));\n\t\tif (!data) return null;\n\t\tfor (const { modelName, defaultModelName, joinConfig } of requiredModels) {\n\t\t\tlet joinedData = await (async () => {\n\t\t\t\tif (options.experimental?.joins) return data[modelName];\n\t\t\t\telse return await handleFallbackJoin({\n\t\t\t\t\tbaseModel: unsafe_model,\n\t\t\t\t\tbaseData: transformedData,\n\t\t\t\t\tjoinModel: modelName,\n\t\t\t\t\tspecificJoinConfig: joinConfig\n\t\t\t\t});\n\t\t\t})();\n\t\t\tif (joinedData === void 0 || joinedData === null) joinedData = joinConfig.relation === \"one-to-one\" ? null : [];\n\t\t\tif (joinConfig.relation === \"one-to-many\" && !Array.isArray(joinedData)) joinedData = [joinedData];\n\t\t\tlet transformed = [];\n\t\t\tif (Array.isArray(joinedData)) for (const item of joinedData) {\n\t\t\t\tconst transformedItem = await transformSingleOutput(item, modelName, []);\n\t\t\t\ttransformed.push(transformedItem);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconst transformedItem = await transformSingleOutput(joinedData, modelName, []);\n\t\t\t\ttransformed.push(transformedItem);\n\t\t\t}\n\t\t\ttransformedData[defaultModelName] = (joinConfig.relation === \"one-to-one\" ? transformed[0] : transformed) ?? null;\n\t\t}\n\t\treturn transformedData;\n\t};\n\tconst transformWhereClause = ({ model, where }) => {\n\t\tif (!where) return void 0;\n\t\tconst newMappedKeys = config.mapKeysTransformInput ?? {};\n\t\treturn where.map((w) => {\n\t\t\tconst { field: unsafe_field, value, operator = \"eq\", connector = \"AND\" } = w;\n\t\t\tif (operator === \"in\") {\n\t\t\t\tif (!Array.isArray(value)) throw new BetterAuthError(\"Value must be an array\");\n\t\t\t}\n\t\t\tlet newValue = value;\n\t\t\tconst defaultModelName = getDefaultModelName(model);\n\t\t\tconst defaultFieldName = getDefaultFieldName({\n\t\t\t\tfield: unsafe_field,\n\t\t\t\tmodel\n\t\t\t});\n\t\t\tconst fieldName = newMappedKeys[defaultFieldName] || getFieldName({\n\t\t\t\tfield: defaultFieldName,\n\t\t\t\tmodel: defaultModelName\n\t\t\t});\n\t\t\tconst fieldAttr = getFieldAttributes({\n\t\t\t\tfield: defaultFieldName,\n\t\t\t\tmodel: defaultModelName\n\t\t\t});\n\t\t\tconst useNumberId = options.advanced?.database?.useNumberId || options.advanced?.database?.generateId === \"serial\";\n\t\t\tif (defaultFieldName === \"id\" || fieldAttr.references?.field === \"id\") {\n\t\t\t\tif (useNumberId) if (Array.isArray(value)) newValue = value.map(Number);\n\t\t\t\telse newValue = Number(value);\n\t\t\t}\n\t\t\tif (fieldAttr.type === \"date\" && value instanceof Date && !config.supportsDates) newValue = value.toISOString();\n\t\t\tif (fieldAttr.type === \"boolean\" && typeof value === \"boolean\" && !config.supportsBooleans) newValue = value ? 1 : 0;\n\t\t\tif (fieldAttr.type === \"json\" && typeof value === \"object\" && !config.supportsJSON) try {\n\t\t\t\tnewValue = JSON.stringify(value);\n\t\t\t} catch (error) {\n\t\t\t\tthrow new Error(`Failed to stringify JSON value for field ${fieldName}`, { cause: error });\n\t\t\t}\n\t\t\treturn {\n\t\t\t\toperator,\n\t\t\t\tconnector,\n\t\t\t\tfield: fieldName,\n\t\t\t\tvalue: newValue\n\t\t\t};\n\t\t});\n\t};\n\tconst transformJoinClause = (baseModel, unsanitizedJoin, select) => {\n\t\tif (!unsanitizedJoin) return void 0;\n\t\tif (Object.keys(unsanitizedJoin).length === 0) return void 0;\n\t\tconst transformedJoin = {};\n\t\tfor (const [model, join] of Object.entries(unsanitizedJoin)) {\n\t\t\tif (!join) continue;\n\t\t\tconst defaultModelName = getDefaultModelName(model);\n\t\t\tconst defaultBaseModelName = getDefaultModelName(baseModel);\n\t\t\tlet foreignKeys = Object.entries(schema[defaultModelName].fields).filter(([field, fieldAttributes]) => fieldAttributes.references && getDefaultModelName(fieldAttributes.references.model) === defaultBaseModelName);\n\t\t\tlet isForwardJoin = true;\n\t\t\tif (!foreignKeys.length) {\n\t\t\t\tforeignKeys = Object.entries(schema[defaultBaseModelName].fields).filter(([field, fieldAttributes]) => fieldAttributes.references && getDefaultModelName(fieldAttributes.references.model) === defaultModelName);\n\t\t\t\tisForwardJoin = false;\n\t\t\t}\n\t\t\tif (!foreignKeys.length) throw new BetterAuthError(`No foreign key found for model ${model} and base model ${baseModel} while performing join operation.`);\n\t\t\telse if (foreignKeys.length > 1) throw new BetterAuthError(`Multiple foreign keys found for model ${model} and base model ${baseModel} while performing join operation. Only one foreign key is supported.`);\n\t\t\tconst [foreignKey, foreignKeyAttributes] = foreignKeys[0];\n\t\t\tif (!foreignKeyAttributes.references) throw new BetterAuthError(`No references found for foreign key ${foreignKey} on model ${model} while performing join operation.`);\n\t\t\tlet from;\n\t\t\tlet to;\n\t\t\tlet requiredSelectField;\n\t\t\tif (isForwardJoin) {\n\t\t\t\trequiredSelectField = foreignKeyAttributes.references.field;\n\t\t\t\tfrom = getFieldName({\n\t\t\t\t\tmodel: baseModel,\n\t\t\t\t\tfield: requiredSelectField\n\t\t\t\t});\n\t\t\t\tto = getFieldName({\n\t\t\t\t\tmodel,\n\t\t\t\t\tfield: foreignKey\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\trequiredSelectField = foreignKey;\n\t\t\t\tfrom = getFieldName({\n\t\t\t\t\tmodel: baseModel,\n\t\t\t\t\tfield: requiredSelectField\n\t\t\t\t});\n\t\t\t\tto = getFieldName({\n\t\t\t\t\tmodel,\n\t\t\t\t\tfield: foreignKeyAttributes.references.field\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (select && !select.includes(requiredSelectField)) select.push(requiredSelectField);\n\t\t\tconst isUnique = to === \"id\" ? true : foreignKeyAttributes.unique ?? false;\n\t\t\tlet limit = options.advanced?.database?.defaultFindManyLimit ?? 100;\n\t\t\tif (isUnique) limit = 1;\n\t\t\telse if (typeof join === \"object\" && typeof join.limit === \"number\") limit = join.limit;\n\t\t\ttransformedJoin[getModelName(model)] = {\n\t\t\t\ton: {\n\t\t\t\t\tfrom,\n\t\t\t\t\tto\n\t\t\t\t},\n\t\t\t\tlimit,\n\t\t\t\trelation: isUnique ? \"one-to-one\" : \"one-to-many\"\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tjoin: transformedJoin,\n\t\t\tselect\n\t\t};\n\t};\n\t/**\n\t* Handle joins by making separate queries and combining results (fallback for adapters that don't support native joins).\n\t*/\n\tconst handleFallbackJoin = async ({ baseModel, baseData, joinModel, specificJoinConfig: joinConfig }) => {\n\t\tif (!baseData) return baseData;\n\t\tconst modelName = getModelName(joinModel);\n\t\tconst field = joinConfig.on.to;\n\t\tconst value = baseData[getDefaultFieldName({\n\t\t\tfield: joinConfig.on.from,\n\t\t\tmodel: baseModel\n\t\t})];\n\t\tif (value === null || value === void 0) return joinConfig.relation === \"one-to-one\" ? null : [];\n\t\tlet result;\n\t\tconst where = transformWhereClause({\n\t\t\tmodel: modelName,\n\t\t\twhere: [{\n\t\t\t\tfield,\n\t\t\t\tvalue,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\"\n\t\t\t}]\n\t\t});\n\t\ttry {\n\t\t\tif (joinConfig.relation === \"one-to-one\") result = await adapterInstance.findOne({\n\t\t\t\tmodel: modelName,\n\t\t\t\twhere\n\t\t\t});\n\t\t\telse {\n\t\t\t\tconst limit = joinConfig.limit ?? options.advanced?.database?.defaultFindManyLimit ?? 100;\n\t\t\t\tresult = await adapterInstance.findMany({\n\t\t\t\t\tmodel: modelName,\n\t\t\t\t\twhere,\n\t\t\t\t\tlimit\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tlogger.error(`Failed to query fallback join for model ${modelName}:`, {\n\t\t\t\twhere,\n\t\t\t\tlimit: joinConfig.limit\n\t\t\t});\n\t\t\tconsole.error(error);\n\t\t\tthrow error;\n\t\t}\n\t\treturn result;\n\t};\n\tconst adapterInstance = customAdapter({\n\t\toptions,\n\t\tschema,\n\t\tdebugLog,\n\t\tgetFieldName,\n\t\tgetModelName,\n\t\tgetDefaultModelName,\n\t\tgetDefaultFieldName,\n\t\tgetFieldAttributes,\n\t\ttransformInput,\n\t\ttransformOutput,\n\t\ttransformWhereClause\n\t});\n\tlet lazyLoadTransaction = null;\n\tconst adapter = {\n\t\ttransaction: async (cb) => {\n\t\t\tif (!lazyLoadTransaction) if (!config.transaction) lazyLoadTransaction = createAsIsTransaction(adapter);\n\t\t\telse {\n\t\t\t\tlogger.debug(`[${config.adapterName}] - Using provided transaction implementation.`);\n\t\t\t\tlazyLoadTransaction = config.transaction;\n\t\t\t}\n\t\t\treturn lazyLoadTransaction(cb);\n\t\t},\n\t\tcreate: async ({ data: unsafeData, model: unsafeModel, select, forceAllowId = false }) => {\n\t\t\ttransactionId++;\n\t\t\tlet thisTransactionId = transactionId;\n\t\t\tconst model = getModelName(unsafeModel);\n\t\t\tunsafeModel = getDefaultModelName(unsafeModel);\n\t\t\tif (\"id\" in unsafeData && typeof unsafeData.id !== \"undefined\" && !forceAllowId) {\n\t\t\t\tlogger.warn(`[${config.adapterName}] - You are trying to create a record with an id. This is not allowed as we handle id generation for you, unless you pass in the \\`forceAllowId\\` parameter. The id will be ignored.`);\n\t\t\t\tconst stack = (/* @__PURE__ */ new Error()).stack?.split(\"\\n\").filter((_, i) => i !== 1).join(\"\\n\").replace(\"Error:\", \"Create method with `id` being called at:\");\n\t\t\t\tconsole.log(stack);\n\t\t\t\tunsafeData.id = void 0;\n\t\t\t}\n\t\t\tdebugLog({ method: \"create\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(1, 4)}`, `${formatMethod(\"create\")} ${formatAction(\"Unsafe Input\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\tdata: unsafeData\n\t\t\t});\n\t\t\tlet data = unsafeData;\n\t\t\tif (!config.disableTransformInput) data = await transformInput(unsafeData, unsafeModel, \"create\", forceAllowId);\n\t\t\tdebugLog({ method: \"create\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(2, 4)}`, `${formatMethod(\"create\")} ${formatAction(\"Parsed Input\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\tdata\n\t\t\t});\n\t\t\tconst res = await adapterInstance.create({\n\t\t\t\tdata,\n\t\t\t\tmodel\n\t\t\t});\n\t\t\tdebugLog({ method: \"create\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(3, 4)}`, `${formatMethod(\"create\")} ${formatAction(\"DB Result\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\tres\n\t\t\t});\n\t\t\tlet transformed = res;\n\t\t\tif (!config.disableTransformOutput) transformed = await transformOutput(res, unsafeModel, select, void 0);\n\t\t\tdebugLog({ method: \"create\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(4, 4)}`, `${formatMethod(\"create\")} ${formatAction(\"Parsed Result\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\tdata: transformed\n\t\t\t});\n\t\t\treturn transformed;\n\t\t},\n\t\tupdate: async ({ model: unsafeModel, where: unsafeWhere, update: unsafeData }) => {\n\t\t\ttransactionId++;\n\t\t\tlet thisTransactionId = transactionId;\n\t\t\tunsafeModel = getDefaultModelName(unsafeModel);\n\t\t\tconst model = getModelName(unsafeModel);\n\t\t\tconst where = transformWhereClause({\n\t\t\t\tmodel: unsafeModel,\n\t\t\t\twhere: unsafeWhere\n\t\t\t});\n\t\t\tdebugLog({ method: \"update\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(1, 4)}`, `${formatMethod(\"update\")} ${formatAction(\"Unsafe Input\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\tdata: unsafeData\n\t\t\t});\n\t\t\tlet data = unsafeData;\n\t\t\tif (!config.disableTransformInput) data = await transformInput(unsafeData, unsafeModel, \"update\");\n\t\t\tdebugLog({ method: \"update\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(2, 4)}`, `${formatMethod(\"update\")} ${formatAction(\"Parsed Input\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\tdata\n\t\t\t});\n\t\t\tconst res = await adapterInstance.update({\n\t\t\t\tmodel,\n\t\t\t\twhere,\n\t\t\t\tupdate: data\n\t\t\t});\n\t\t\tdebugLog({ method: \"update\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(3, 4)}`, `${formatMethod(\"update\")} ${formatAction(\"DB Result\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\tdata: res\n\t\t\t});\n\t\t\tlet transformed = res;\n\t\t\tif (!config.disableTransformOutput) transformed = await transformOutput(res, unsafeModel, void 0, void 0);\n\t\t\tdebugLog({ method: \"update\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(4, 4)}`, `${formatMethod(\"update\")} ${formatAction(\"Parsed Result\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\tdata: transformed\n\t\t\t});\n\t\t\treturn transformed;\n\t\t},\n\t\tupdateMany: async ({ model: unsafeModel, where: unsafeWhere, update: unsafeData }) => {\n\t\t\ttransactionId++;\n\t\t\tlet thisTransactionId = transactionId;\n\t\t\tconst model = getModelName(unsafeModel);\n\t\t\tconst where = transformWhereClause({\n\t\t\t\tmodel: unsafeModel,\n\t\t\t\twhere: unsafeWhere\n\t\t\t});\n\t\t\tunsafeModel = getDefaultModelName(unsafeModel);\n\t\t\tdebugLog({ method: \"updateMany\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(1, 4)}`, `${formatMethod(\"updateMany\")} ${formatAction(\"Unsafe Input\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\tdata: unsafeData\n\t\t\t});\n\t\t\tlet data = unsafeData;\n\t\t\tif (!config.disableTransformInput) data = await transformInput(unsafeData, unsafeModel, \"update\");\n\t\t\tdebugLog({ method: \"updateMany\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(2, 4)}`, `${formatMethod(\"updateMany\")} ${formatAction(\"Parsed Input\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\tdata\n\t\t\t});\n\t\t\tconst updatedCount = await adapterInstance.updateMany({\n\t\t\t\tmodel,\n\t\t\t\twhere,\n\t\t\t\tupdate: data\n\t\t\t});\n\t\t\tdebugLog({ method: \"updateMany\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(3, 4)}`, `${formatMethod(\"updateMany\")} ${formatAction(\"DB Result\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\tdata: updatedCount\n\t\t\t});\n\t\t\tdebugLog({ method: \"updateMany\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(4, 4)}`, `${formatMethod(\"updateMany\")} ${formatAction(\"Parsed Result\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\tdata: updatedCount\n\t\t\t});\n\t\t\treturn updatedCount;\n\t\t},\n\t\tfindOne: async ({ model: unsafeModel, where: unsafeWhere, select, join: unsafeJoin }) => {\n\t\t\ttransactionId++;\n\t\t\tlet thisTransactionId = transactionId;\n\t\t\tconst model = getModelName(unsafeModel);\n\t\t\tconst where = transformWhereClause({\n\t\t\t\tmodel: unsafeModel,\n\t\t\t\twhere: unsafeWhere\n\t\t\t});\n\t\t\tunsafeModel = getDefaultModelName(unsafeModel);\n\t\t\tlet join;\n\t\t\tlet passJoinToAdapter = true;\n\t\t\tif (!config.disableTransformJoin) {\n\t\t\t\tconst result = transformJoinClause(unsafeModel, unsafeJoin, select);\n\t\t\t\tif (result) {\n\t\t\t\t\tjoin = result.join;\n\t\t\t\t\tselect = result.select;\n\t\t\t\t}\n\t\t\t\tif (!options.experimental?.joins && join && Object.keys(join).length > 0) passJoinToAdapter = false;\n\t\t\t} else join = unsafeJoin;\n\t\t\tdebugLog({ method: \"findOne\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(1, 3)}`, `${formatMethod(\"findOne\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\twhere,\n\t\t\t\tselect,\n\t\t\t\tjoin\n\t\t\t});\n\t\t\tconst res = await adapterInstance.findOne({\n\t\t\t\tmodel,\n\t\t\t\twhere,\n\t\t\t\tselect,\n\t\t\t\tjoin: passJoinToAdapter ? join : void 0\n\t\t\t});\n\t\t\tdebugLog({ method: \"findOne\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(2, 3)}`, `${formatMethod(\"findOne\")} ${formatAction(\"DB Result\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\tdata: res\n\t\t\t});\n\t\t\tlet transformed = res;\n\t\t\tif (!config.disableTransformOutput) transformed = await transformOutput(res, unsafeModel, select, join);\n\t\t\tdebugLog({ method: \"findOne\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(3, 3)}`, `${formatMethod(\"findOne\")} ${formatAction(\"Parsed Result\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\tdata: transformed\n\t\t\t});\n\t\t\treturn transformed;\n\t\t},\n\t\tfindMany: async ({ model: unsafeModel, where: unsafeWhere, limit: unsafeLimit, sortBy, offset, join: unsafeJoin }) => {\n\t\t\ttransactionId++;\n\t\t\tlet thisTransactionId = transactionId;\n\t\t\tconst limit = unsafeLimit ?? options.advanced?.database?.defaultFindManyLimit ?? 100;\n\t\t\tconst model = getModelName(unsafeModel);\n\t\t\tconst where = transformWhereClause({\n\t\t\t\tmodel: unsafeModel,\n\t\t\t\twhere: unsafeWhere\n\t\t\t});\n\t\t\tunsafeModel = getDefaultModelName(unsafeModel);\n\t\t\tlet join;\n\t\t\tlet passJoinToAdapter = true;\n\t\t\tif (!config.disableTransformJoin) {\n\t\t\t\tconst result = transformJoinClause(unsafeModel, unsafeJoin, void 0);\n\t\t\t\tif (result) join = result.join;\n\t\t\t\tif (!options.experimental?.joins && join && Object.keys(join).length > 0) passJoinToAdapter = false;\n\t\t\t} else join = unsafeJoin;\n\t\t\tdebugLog({ method: \"findMany\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(1, 3)}`, `${formatMethod(\"findMany\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\twhere,\n\t\t\t\tlimit,\n\t\t\t\tsortBy,\n\t\t\t\toffset,\n\t\t\t\tjoin\n\t\t\t});\n\t\t\tconst res = await adapterInstance.findMany({\n\t\t\t\tmodel,\n\t\t\t\twhere,\n\t\t\t\tlimit,\n\t\t\t\tsortBy,\n\t\t\t\toffset,\n\t\t\t\tjoin: passJoinToAdapter ? join : void 0\n\t\t\t});\n\t\t\tdebugLog({ method: \"findMany\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(2, 3)}`, `${formatMethod(\"findMany\")} ${formatAction(\"DB Result\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\tdata: res\n\t\t\t});\n\t\t\tlet transformed = res;\n\t\t\tif (!config.disableTransformOutput) transformed = await Promise.all(res.map(async (r) => {\n\t\t\t\treturn await transformOutput(r, unsafeModel, void 0, join);\n\t\t\t}));\n\t\t\tdebugLog({ method: \"findMany\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(3, 3)}`, `${formatMethod(\"findMany\")} ${formatAction(\"Parsed Result\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\tdata: transformed\n\t\t\t});\n\t\t\treturn transformed;\n\t\t},\n\t\tdelete: async ({ model: unsafeModel, where: unsafeWhere }) => {\n\t\t\ttransactionId++;\n\t\t\tlet thisTransactionId = transactionId;\n\t\t\tconst model = getModelName(unsafeModel);\n\t\t\tconst where = transformWhereClause({\n\t\t\t\tmodel: unsafeModel,\n\t\t\t\twhere: unsafeWhere\n\t\t\t});\n\t\t\tunsafeModel = getDefaultModelName(unsafeModel);\n\t\t\tdebugLog({ method: \"delete\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(1, 2)}`, `${formatMethod(\"delete\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\twhere\n\t\t\t});\n\t\t\tawait adapterInstance.delete({\n\t\t\t\tmodel,\n\t\t\t\twhere\n\t\t\t});\n\t\t\tdebugLog({ method: \"delete\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(2, 2)}`, `${formatMethod(\"delete\")} ${formatAction(\"DB Result\")}:`, { model });\n\t\t},\n\t\tdeleteMany: async ({ model: unsafeModel, where: unsafeWhere }) => {\n\t\t\ttransactionId++;\n\t\t\tlet thisTransactionId = transactionId;\n\t\t\tconst model = getModelName(unsafeModel);\n\t\t\tconst where = transformWhereClause({\n\t\t\t\tmodel: unsafeModel,\n\t\t\t\twhere: unsafeWhere\n\t\t\t});\n\t\t\tunsafeModel = getDefaultModelName(unsafeModel);\n\t\t\tdebugLog({ method: \"deleteMany\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(1, 2)}`, `${formatMethod(\"deleteMany\")} ${formatAction(\"DeleteMany\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\twhere\n\t\t\t});\n\t\t\tconst res = await adapterInstance.deleteMany({\n\t\t\t\tmodel,\n\t\t\t\twhere\n\t\t\t});\n\t\t\tdebugLog({ method: \"deleteMany\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(2, 2)}`, `${formatMethod(\"deleteMany\")} ${formatAction(\"DB Result\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\tdata: res\n\t\t\t});\n\t\t\treturn res;\n\t\t},\n\t\tcount: async ({ model: unsafeModel, where: unsafeWhere }) => {\n\t\t\ttransactionId++;\n\t\t\tlet thisTransactionId = transactionId;\n\t\t\tconst model = getModelName(unsafeModel);\n\t\t\tconst where = transformWhereClause({\n\t\t\t\tmodel: unsafeModel,\n\t\t\t\twhere: unsafeWhere\n\t\t\t});\n\t\t\tunsafeModel = getDefaultModelName(unsafeModel);\n\t\t\tdebugLog({ method: \"count\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(1, 2)}`, `${formatMethod(\"count\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\twhere\n\t\t\t});\n\t\t\tconst res = await adapterInstance.count({\n\t\t\t\tmodel,\n\t\t\t\twhere\n\t\t\t});\n\t\t\tdebugLog({ method: \"count\" }, `${formatTransactionId(thisTransactionId)} ${formatStep(2, 2)}`, `${formatMethod(\"count\")}:`, {\n\t\t\t\tmodel,\n\t\t\t\tdata: res\n\t\t\t});\n\t\t\treturn res;\n\t\t},\n\t\tcreateSchema: adapterInstance.createSchema ? async (_, file) => {\n\t\t\tconst tables = getAuthTables(options);\n\t\t\tif (options.secondaryStorage && !options.session?.storeSessionInDatabase) delete tables.session;\n\t\t\tif (options.rateLimit && options.rateLimit.storage === \"database\" && (typeof options.rateLimit.enabled === \"undefined\" || options.rateLimit.enabled === true)) tables.ratelimit = {\n\t\t\t\tmodelName: options.rateLimit.modelName ?? \"ratelimit\",\n\t\t\t\tfields: {\n\t\t\t\t\tkey: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tunique: true,\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tfieldName: options.rateLimit.fields?.key ?? \"key\"\n\t\t\t\t\t},\n\t\t\t\t\tcount: {\n\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tfieldName: options.rateLimit.fields?.count ?? \"count\"\n\t\t\t\t\t},\n\t\t\t\t\tlastRequest: {\n\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tbigint: true,\n\t\t\t\t\t\tdefaultValue: () => Date.now(),\n\t\t\t\t\t\tfieldName: options.rateLimit.fields?.lastRequest ?? \"lastRequest\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn adapterInstance.createSchema({\n\t\t\t\tfile,\n\t\t\t\ttables\n\t\t\t});\n\t\t} : void 0,\n\t\toptions: {\n\t\t\tadapterConfig: config,\n\t\t\t...adapterInstance.options ?? {}\n\t\t},\n\t\tid: config.adapterId,\n\t\t...config.debugLogs?.isRunningAdapterTests ? { adapterTestDebugLogs: {\n\t\t\tresetDebugLogs() {\n\t\t\t\tdebugLogs = debugLogs.filter((log) => log.instance !== uniqueAdapterFactoryInstanceId);\n\t\t\t},\n\t\t\tprintDebugLogs() {\n\t\t\t\tconst separator = ``.repeat(80);\n\t\t\t\tconst logs = debugLogs.filter((log$1) => log$1.instance === uniqueAdapterFactoryInstanceId);\n\t\t\t\tif (logs.length === 0) return;\n\t\t\t\tlet log = logs.reverse().map((log$1) => {\n\t\t\t\t\tlog$1.args[0] = `\\n${log$1.args[0]}`;\n\t\t\t\t\treturn [...log$1.args, \"\\n\"];\n\t\t\t\t}).reduce((prev, curr) => {\n\t\t\t\t\treturn [...curr, ...prev];\n\t\t\t\t}, [`\\n${separator}`]);\n\t\t\t\tconsole.log(...log);\n\t\t\t}\n\t\t} } : {}\n\t};\n\treturn adapter;\n};\nfunction formatTransactionId(transactionId$1) {\n\tif (getColorDepth() < 8) return `#${transactionId$1}`;\n\treturn `${TTY_COLORS.fg.magenta}#${transactionId$1}${TTY_COLORS.reset}`;\n}\nfunction formatStep(step, total) {\n\treturn `${TTY_COLORS.bg.black}${TTY_COLORS.fg.yellow}[${step}/${total}]${TTY_COLORS.reset}`;\n}\nfunction formatMethod(method) {\n\treturn `${TTY_COLORS.bright}${method}${TTY_COLORS.reset}`;\n}\nfunction formatAction(action) {\n\treturn `${TTY_COLORS.dim}(${action})${TTY_COLORS.reset}`;\n}\n\n//#endregion\nexport { initGetFieldAttributes as n, initGetIdField as r, createAdapterFactory as t };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 4967, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/adapters/drizzle-adapter/index.mjs"],"sourcesContent":["import \"../../get-model-name-D4DUV7S2.mjs\";\nimport \"../../utils-db7gNqd-.mjs\";\nimport \"../../crypto-CFUhAR9W.mjs\";\nimport \"../../misc-BwNc0MKr.mjs\";\nimport \"../../json-CnHxKYpj.mjs\";\nimport { t as createAdapterFactory } from \"../../adapter-factory-HF3JB9cT.mjs\";\nimport { logger } from \"@better-auth/core/env\";\nimport { BetterAuthError } from \"@better-auth/core/error\";\nimport { and, asc, count, desc, eq, gt, gte, inArray, like, lt, lte, ne, notInArray, or, sql } from \"drizzle-orm\";\n\n//#region src/adapters/drizzle-adapter/drizzle-adapter.ts\nconst drizzleAdapter = (db, config) => {\n\tlet lazyOptions = null;\n\tconst createCustomAdapter = (db$1) => ({ getFieldName, options }) => {\n\t\tfunction getSchema(model) {\n\t\t\tconst schema = config.schema || db$1._.fullSchema;\n\t\t\tif (!schema) throw new BetterAuthError(\"Drizzle adapter failed to initialize. Schema not found. Please provide a schema object in the adapter options object.\");\n\t\t\tconst schemaModel = schema[model];\n\t\t\tif (!schemaModel) throw new BetterAuthError(`[# Drizzle Adapter]: The model \"${model}\" was not found in the schema object. Please pass the schema directly to the adapter options.`);\n\t\t\treturn schemaModel;\n\t\t}\n\t\tconst withReturning = async (model, builder, data, where) => {\n\t\t\tif (config.provider !== \"mysql\") return (await builder.returning())[0];\n\t\t\tawait builder.execute();\n\t\t\tconst schemaModel = getSchema(model);\n\t\t\tconst builderVal = builder.config?.values;\n\t\t\tif (where?.length) {\n\t\t\t\tconst clause = convertWhereClause(where.map((w) => {\n\t\t\t\t\tif (data[w.field] !== void 0) return {\n\t\t\t\t\t\t...w,\n\t\t\t\t\t\tvalue: data[w.field]\n\t\t\t\t\t};\n\t\t\t\t\treturn w;\n\t\t\t\t}), model);\n\t\t\t\treturn (await db$1.select().from(schemaModel).where(...clause))[0];\n\t\t\t} else if (builderVal && builderVal[0]?.id?.value) {\n\t\t\t\tlet tId = builderVal[0]?.id?.value;\n\t\t\t\tif (!tId) tId = (await db$1.select({ id: sql`LAST_INSERT_ID()` }).from(schemaModel).orderBy(desc(schemaModel.id)).limit(1))[0].id;\n\t\t\t\treturn (await db$1.select().from(schemaModel).where(eq(schemaModel.id, tId)).limit(1).execute())[0];\n\t\t\t} else if (data.id) return (await db$1.select().from(schemaModel).where(eq(schemaModel.id, data.id)).limit(1).execute())[0];\n\t\t\telse {\n\t\t\t\tif (!(\"id\" in schemaModel)) throw new BetterAuthError(`The model \"${model}\" does not have an \"id\" field. Please use the \"id\" field as your primary key.`);\n\t\t\t\treturn (await db$1.select().from(schemaModel).orderBy(desc(schemaModel.id)).limit(1).execute())[0];\n\t\t\t}\n\t\t};\n\t\tfunction convertWhereClause(where, model) {\n\t\t\tconst schemaModel = getSchema(model);\n\t\t\tif (!where) return [];\n\t\t\tif (where.length === 1) {\n\t\t\t\tconst w = where[0];\n\t\t\t\tif (!w) return [];\n\t\t\t\tconst field = getFieldName({\n\t\t\t\t\tmodel,\n\t\t\t\t\tfield: w.field\n\t\t\t\t});\n\t\t\t\tif (!schemaModel[field]) throw new BetterAuthError(`The field \"${w.field}\" does not exist in the schema for the model \"${model}\". Please update your schema.`);\n\t\t\t\tif (w.operator === \"in\") {\n\t\t\t\t\tif (!Array.isArray(w.value)) throw new BetterAuthError(`The value for the field \"${w.field}\" must be an array when using the \"in\" operator.`);\n\t\t\t\t\treturn [inArray(schemaModel[field], w.value)];\n\t\t\t\t}\n\t\t\t\tif (w.operator === \"not_in\") {\n\t\t\t\t\tif (!Array.isArray(w.value)) throw new BetterAuthError(`The value for the field \"${w.field}\" must be an array when using the \"not_in\" operator.`);\n\t\t\t\t\treturn [notInArray(schemaModel[field], w.value)];\n\t\t\t\t}\n\t\t\t\tif (w.operator === \"contains\") return [like(schemaModel[field], `%${w.value}%`)];\n\t\t\t\tif (w.operator === \"starts_with\") return [like(schemaModel[field], `${w.value}%`)];\n\t\t\t\tif (w.operator === \"ends_with\") return [like(schemaModel[field], `%${w.value}`)];\n\t\t\t\tif (w.operator === \"lt\") return [lt(schemaModel[field], w.value)];\n\t\t\t\tif (w.operator === \"lte\") return [lte(schemaModel[field], w.value)];\n\t\t\t\tif (w.operator === \"ne\") return [ne(schemaModel[field], w.value)];\n\t\t\t\tif (w.operator === \"gt\") return [gt(schemaModel[field], w.value)];\n\t\t\t\tif (w.operator === \"gte\") return [gte(schemaModel[field], w.value)];\n\t\t\t\treturn [eq(schemaModel[field], w.value)];\n\t\t\t}\n\t\t\tconst andGroup = where.filter((w) => w.connector === \"AND\" || !w.connector);\n\t\t\tconst orGroup = where.filter((w) => w.connector === \"OR\");\n\t\t\tconst andClause = and(...andGroup.map((w) => {\n\t\t\t\tconst field = getFieldName({\n\t\t\t\t\tmodel,\n\t\t\t\t\tfield: w.field\n\t\t\t\t});\n\t\t\t\tif (w.operator === \"in\") {\n\t\t\t\t\tif (!Array.isArray(w.value)) throw new BetterAuthError(`The value for the field \"${w.field}\" must be an array when using the \"in\" operator.`);\n\t\t\t\t\treturn inArray(schemaModel[field], w.value);\n\t\t\t\t}\n\t\t\t\tif (w.operator === \"not_in\") {\n\t\t\t\t\tif (!Array.isArray(w.value)) throw new BetterAuthError(`The value for the field \"${w.field}\" must be an array when using the \"not_in\" operator.`);\n\t\t\t\t\treturn notInArray(schemaModel[field], w.value);\n\t\t\t\t}\n\t\t\t\tif (w.operator === \"contains\") return like(schemaModel[field], `%${w.value}%`);\n\t\t\t\tif (w.operator === \"starts_with\") return like(schemaModel[field], `${w.value}%`);\n\t\t\t\tif (w.operator === \"ends_with\") return like(schemaModel[field], `%${w.value}`);\n\t\t\t\tif (w.operator === \"lt\") return lt(schemaModel[field], w.value);\n\t\t\t\tif (w.operator === \"lte\") return lte(schemaModel[field], w.value);\n\t\t\t\tif (w.operator === \"gt\") return gt(schemaModel[field], w.value);\n\t\t\t\tif (w.operator === \"gte\") return gte(schemaModel[field], w.value);\n\t\t\t\tif (w.operator === \"ne\") return ne(schemaModel[field], w.value);\n\t\t\t\treturn eq(schemaModel[field], w.value);\n\t\t\t}));\n\t\t\tconst orClause = or(...orGroup.map((w) => {\n\t\t\t\tconst field = getFieldName({\n\t\t\t\t\tmodel,\n\t\t\t\t\tfield: w.field\n\t\t\t\t});\n\t\t\t\tif (w.operator === \"in\") {\n\t\t\t\t\tif (!Array.isArray(w.value)) throw new BetterAuthError(`The value for the field \"${w.field}\" must be an array when using the \"in\" operator.`);\n\t\t\t\t\treturn inArray(schemaModel[field], w.value);\n\t\t\t\t}\n\t\t\t\tif (w.operator === \"not_in\") {\n\t\t\t\t\tif (!Array.isArray(w.value)) throw new BetterAuthError(`The value for the field \"${w.field}\" must be an array when using the \"not_in\" operator.`);\n\t\t\t\t\treturn notInArray(schemaModel[field], w.value);\n\t\t\t\t}\n\t\t\t\tif (w.operator === \"contains\") return like(schemaModel[field], `%${w.value}%`);\n\t\t\t\tif (w.operator === \"starts_with\") return like(schemaModel[field], `${w.value}%`);\n\t\t\t\tif (w.operator === \"ends_with\") return like(schemaModel[field], `%${w.value}`);\n\t\t\t\tif (w.operator === \"lt\") return lt(schemaModel[field], w.value);\n\t\t\t\tif (w.operator === \"lte\") return lte(schemaModel[field], w.value);\n\t\t\t\tif (w.operator === \"gt\") return gt(schemaModel[field], w.value);\n\t\t\t\tif (w.operator === \"gte\") return gte(schemaModel[field], w.value);\n\t\t\t\tif (w.operator === \"ne\") return ne(schemaModel[field], w.value);\n\t\t\t\treturn eq(schemaModel[field], w.value);\n\t\t\t}));\n\t\t\tconst clause = [];\n\t\t\tif (andGroup.length) clause.push(andClause);\n\t\t\tif (orGroup.length) clause.push(orClause);\n\t\t\treturn clause;\n\t\t}\n\t\tfunction checkMissingFields(schema, model, values) {\n\t\t\tif (!schema) throw new BetterAuthError(\"Drizzle adapter failed to initialize. Drizzle Schema not found. Please provide a schema object in the adapter options object.\");\n\t\t\tfor (const key in values) if (!schema[key]) throw new BetterAuthError(`The field \"${key}\" does not exist in the \"${model}\" Drizzle schema. Please update your drizzle schema or re-generate using \"npx @better-auth/cli@latest generate\".`);\n\t\t}\n\t\treturn {\n\t\t\tasync create({ model, data: values }) {\n\t\t\t\tconst schemaModel = getSchema(model);\n\t\t\t\tcheckMissingFields(schemaModel, model, values);\n\t\t\t\treturn await withReturning(model, db$1.insert(schemaModel).values(values), values);\n\t\t\t},\n\t\t\tasync findOne({ model, where, join }) {\n\t\t\t\tconst schemaModel = getSchema(model);\n\t\t\t\tconst clause = convertWhereClause(where, model);\n\t\t\t\tif (options.experimental?.joins) if (!db$1.query || !db$1.query[model]) {\n\t\t\t\t\tlogger.error(`[# Drizzle Adapter]: The model \"${model}\" was not found in the query object. Please update your Drizzle schema to include relations or re-generate using \"npx @better-auth/cli@latest generate\".`);\n\t\t\t\t\tlogger.info(\"Falling back to regular query\");\n\t\t\t\t} else {\n\t\t\t\t\tlet includes;\n\t\t\t\t\tconst pluralJoinResults = [];\n\t\t\t\t\tif (join) {\n\t\t\t\t\t\tincludes = {};\n\t\t\t\t\t\tconst joinEntries = Object.entries(join);\n\t\t\t\t\t\tfor (const [model$1, joinAttr] of joinEntries) {\n\t\t\t\t\t\t\tconst limit = joinAttr.limit ?? options.advanced?.database?.defaultFindManyLimit ?? 100;\n\t\t\t\t\t\t\tconst isUnique = joinAttr.relation === \"one-to-one\";\n\t\t\t\t\t\t\tconst pluralSuffix = isUnique || config.usePlural ? \"\" : \"s\";\n\t\t\t\t\t\t\tincludes[`${model$1}${pluralSuffix}`] = isUnique ? true : { limit };\n\t\t\t\t\t\t\tif (!isUnique) pluralJoinResults.push(`${model$1}${pluralSuffix}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconst res$1 = await db$1.query[model].findFirst({\n\t\t\t\t\t\twhere: clause[0],\n\t\t\t\t\t\twith: includes\n\t\t\t\t\t});\n\t\t\t\t\tif (res$1) for (const pluralJoinResult of pluralJoinResults) {\n\t\t\t\t\t\tlet singularKey = !config.usePlural ? pluralJoinResult.slice(0, -1) : pluralJoinResult;\n\t\t\t\t\t\tres$1[singularKey] = res$1[pluralJoinResult];\n\t\t\t\t\t\tif (pluralJoinResult !== singularKey) delete res$1[pluralJoinResult];\n\t\t\t\t\t}\n\t\t\t\t\treturn res$1;\n\t\t\t\t}\n\t\t\t\tconst res = await db$1.select().from(schemaModel).where(...clause);\n\t\t\t\tif (!res.length) return null;\n\t\t\t\treturn res[0];\n\t\t\t},\n\t\t\tasync findMany({ model, where, sortBy, limit, offset, join }) {\n\t\t\t\tconst schemaModel = getSchema(model);\n\t\t\t\tconst clause = where ? convertWhereClause(where, model) : [];\n\t\t\t\tconst sortFn = sortBy?.direction === \"desc\" ? desc : asc;\n\t\t\t\tif (options.experimental?.joins) if (!db$1.query[model]) {\n\t\t\t\t\tlogger.error(`[# Drizzle Adapter]: The model \"${model}\" was not found in the query object. Please update your Drizzle schema to include relations or re-generate using \"npx @better-auth/cli@latest generate\".`);\n\t\t\t\t\tlogger.info(\"Falling back to regular query\");\n\t\t\t\t} else {\n\t\t\t\t\tlet includes;\n\t\t\t\t\tconst pluralJoinResults = [];\n\t\t\t\t\tif (join) {\n\t\t\t\t\t\tincludes = {};\n\t\t\t\t\t\tconst joinEntries = Object.entries(join);\n\t\t\t\t\t\tfor (const [model$1, joinAttr] of joinEntries) {\n\t\t\t\t\t\t\tconst isUnique = joinAttr.relation === \"one-to-one\";\n\t\t\t\t\t\t\tconst limit$1 = joinAttr.limit ?? options.advanced?.database?.defaultFindManyLimit ?? 100;\n\t\t\t\t\t\t\tlet pluralSuffix = isUnique || config.usePlural ? \"\" : \"s\";\n\t\t\t\t\t\t\tincludes[`${model$1}${pluralSuffix}`] = isUnique ? true : { limit: limit$1 };\n\t\t\t\t\t\t\tif (!isUnique) pluralJoinResults.push(`${model$1}${pluralSuffix}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tlet orderBy = void 0;\n\t\t\t\t\tif (sortBy?.field) orderBy = [sortFn(schemaModel[getFieldName({\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\tfield: sortBy?.field\n\t\t\t\t\t})])];\n\t\t\t\t\tlet res = await db$1.query[model].findMany({\n\t\t\t\t\t\twhere: clause[0],\n\t\t\t\t\t\twith: includes,\n\t\t\t\t\t\tlimit: limit ?? 100,\n\t\t\t\t\t\toffset: offset ?? 0,\n\t\t\t\t\t\torderBy\n\t\t\t\t\t});\n\t\t\t\t\tif (res) for (const item of res) for (const pluralJoinResult of pluralJoinResults) {\n\t\t\t\t\t\tconst singularKey = !config.usePlural ? pluralJoinResult.slice(0, -1) : pluralJoinResult;\n\t\t\t\t\t\tif (singularKey === pluralJoinResult) continue;\n\t\t\t\t\t\titem[singularKey] = item[pluralJoinResult];\n\t\t\t\t\t\tdelete item[pluralJoinResult];\n\t\t\t\t\t}\n\t\t\t\t\treturn res;\n\t\t\t\t}\n\t\t\t\tlet builder = db$1.select().from(schemaModel);\n\t\t\t\tconst effectiveLimit = limit;\n\t\t\t\tconst effectiveOffset = offset;\n\t\t\t\tif (typeof effectiveLimit !== \"undefined\") builder = builder.limit(effectiveLimit);\n\t\t\t\tif (typeof effectiveOffset !== \"undefined\") builder = builder.offset(effectiveOffset);\n\t\t\t\tif (sortBy?.field) builder = builder.orderBy(sortFn(schemaModel[getFieldName({\n\t\t\t\t\tmodel,\n\t\t\t\t\tfield: sortBy?.field\n\t\t\t\t})]));\n\t\t\t\treturn await builder.where(...clause);\n\t\t\t},\n\t\t\tasync count({ model, where }) {\n\t\t\t\tconst schemaModel = getSchema(model);\n\t\t\t\tconst clause = where ? convertWhereClause(where, model) : [];\n\t\t\t\treturn (await db$1.select({ count: count() }).from(schemaModel).where(...clause))[0].count;\n\t\t\t},\n\t\t\tasync update({ model, where, update: values }) {\n\t\t\t\tconst schemaModel = getSchema(model);\n\t\t\t\tconst clause = convertWhereClause(where, model);\n\t\t\t\treturn await withReturning(model, db$1.update(schemaModel).set(values).where(...clause), values, where);\n\t\t\t},\n\t\t\tasync updateMany({ model, where, update: values }) {\n\t\t\t\tconst schemaModel = getSchema(model);\n\t\t\t\tconst clause = convertWhereClause(where, model);\n\t\t\t\treturn await db$1.update(schemaModel).set(values).where(...clause);\n\t\t\t},\n\t\t\tasync delete({ model, where }) {\n\t\t\t\tconst schemaModel = getSchema(model);\n\t\t\t\tconst clause = convertWhereClause(where, model);\n\t\t\t\treturn await db$1.delete(schemaModel).where(...clause);\n\t\t\t},\n\t\t\tasync deleteMany({ model, where }) {\n\t\t\t\tconst schemaModel = getSchema(model);\n\t\t\t\tconst clause = convertWhereClause(where, model);\n\t\t\t\tconst res = await db$1.delete(schemaModel).where(...clause);\n\t\t\t\tlet count$1 = 0;\n\t\t\t\tif (res && \"rowCount\" in res) count$1 = res.rowCount;\n\t\t\t\telse if (Array.isArray(res)) count$1 = res.length;\n\t\t\t\telse if (res && (\"affectedRows\" in res || \"rowsAffected\" in res || \"changes\" in res)) count$1 = res.affectedRows ?? res.rowsAffected ?? res.changes;\n\t\t\t\tif (typeof count$1 !== \"number\") logger.error(\"[Drizzle Adapter] The result of the deleteMany operation is not a number. This is likely a bug in the adapter. Please report this issue to the Better Auth team.\", {\n\t\t\t\t\tres,\n\t\t\t\t\tmodel,\n\t\t\t\t\twhere\n\t\t\t\t});\n\t\t\t\treturn count$1;\n\t\t\t},\n\t\t\toptions: config\n\t\t};\n\t};\n\tlet adapterOptions = null;\n\tadapterOptions = {\n\t\tconfig: {\n\t\t\tadapterId: \"drizzle\",\n\t\t\tadapterName: \"Drizzle Adapter\",\n\t\t\tusePlural: config.usePlural ?? false,\n\t\t\tdebugLogs: config.debugLogs ?? false,\n\t\t\tsupportsUUIDs: config.provider === \"pg\" ? true : false,\n\t\t\ttransaction: config.transaction ?? false ? (cb) => db.transaction((tx) => {\n\t\t\t\treturn cb(createAdapterFactory({\n\t\t\t\t\tconfig: adapterOptions.config,\n\t\t\t\t\tadapter: createCustomAdapter(tx)\n\t\t\t\t})(lazyOptions));\n\t\t\t}) : false\n\t\t},\n\t\tadapter: createCustomAdapter(db)\n\t};\n\tconst adapter = createAdapterFactory(adapterOptions);\n\treturn (options) => {\n\t\tlazyOptions = options;\n\t\treturn adapter(options);\n\t};\n};\n\n//#endregion\nexport { drizzleAdapter };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 5306, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/parser-pHp5yoAv.mjs"],"sourcesContent":["//#region src/client/parser.ts\nconst PROTO_POLLUTION_PATTERNS = {\n\tproto: /\"(?:_|\\\\u0{2}5[Ff]){2}(?:p|\\\\u0{2}70)(?:r|\\\\u0{2}72)(?:o|\\\\u0{2}6[Ff])(?:t|\\\\u0{2}74)(?:o|\\\\u0{2}6[Ff])(?:_|\\\\u0{2}5[Ff]){2}\"\\s*:/,\n\tconstructor: /\"(?:c|\\\\u0063)(?:o|\\\\u006[Ff])(?:n|\\\\u006[Ee])(?:s|\\\\u0073)(?:t|\\\\u0074)(?:r|\\\\u0072)(?:u|\\\\u0075)(?:c|\\\\u0063)(?:t|\\\\u0074)(?:o|\\\\u006[Ff])(?:r|\\\\u0072)\"\\s*:/,\n\tprotoShort: /\"__proto__\"\\s*:/,\n\tconstructorShort: /\"constructor\"\\s*:/\n};\nconst JSON_SIGNATURE = /^\\s*[\"[{]|^\\s*-?\\d{1,16}(\\.\\d{1,17})?([Ee][+-]?\\d+)?\\s*$/;\nconst SPECIAL_VALUES = {\n\ttrue: true,\n\tfalse: false,\n\tnull: null,\n\tundefined: void 0,\n\tnan: NaN,\n\tinfinity: Number.POSITIVE_INFINITY,\n\t\"-infinity\": Number.NEGATIVE_INFINITY\n};\nconst ISO_DATE_REGEX = /^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})(?:\\.(\\d{1,7}))?(?:Z|([+-])(\\d{2}):(\\d{2}))$/;\nfunction isValidDate(date) {\n\treturn date instanceof Date && !isNaN(date.getTime());\n}\nfunction parseISODate(value) {\n\tconst match = ISO_DATE_REGEX.exec(value);\n\tif (!match) return null;\n\tconst [, year, month, day, hour, minute, second, ms, offsetSign, offsetHour, offsetMinute] = match;\n\tlet date = new Date(Date.UTC(parseInt(year, 10), parseInt(month, 10) - 1, parseInt(day, 10), parseInt(hour, 10), parseInt(minute, 10), parseInt(second, 10), ms ? parseInt(ms.padEnd(3, \"0\"), 10) : 0));\n\tif (offsetSign) {\n\t\tconst offset = (parseInt(offsetHour, 10) * 60 + parseInt(offsetMinute, 10)) * (offsetSign === \"+\" ? -1 : 1);\n\t\tdate.setUTCMinutes(date.getUTCMinutes() + offset);\n\t}\n\treturn isValidDate(date) ? date : null;\n}\nfunction betterJSONParse(value, options = {}) {\n\tconst { strict = false, warnings = false, reviver, parseDates = true } = options;\n\tif (typeof value !== \"string\") return value;\n\tconst trimmed = value.trim();\n\tif (trimmed.length > 0 && trimmed[0] === \"\\\"\" && trimmed.endsWith(\"\\\"\") && !trimmed.slice(1, -1).includes(\"\\\"\")) return trimmed.slice(1, -1);\n\tconst lowerValue = trimmed.toLowerCase();\n\tif (lowerValue.length <= 9 && lowerValue in SPECIAL_VALUES) return SPECIAL_VALUES[lowerValue];\n\tif (!JSON_SIGNATURE.test(trimmed)) {\n\t\tif (strict) throw new SyntaxError(\"[better-json] Invalid JSON\");\n\t\treturn value;\n\t}\n\tif (Object.entries(PROTO_POLLUTION_PATTERNS).some(([key, pattern]) => {\n\t\tconst matches = pattern.test(trimmed);\n\t\tif (matches && warnings) console.warn(`[better-json] Detected potential prototype pollution attempt using ${key} pattern`);\n\t\treturn matches;\n\t}) && strict) throw new Error(\"[better-json] Potential prototype pollution attempt detected\");\n\ttry {\n\t\tconst secureReviver = (key, value$1) => {\n\t\t\tif (key === \"__proto__\" || key === \"constructor\" && value$1 && typeof value$1 === \"object\" && \"prototype\" in value$1) {\n\t\t\t\tif (warnings) console.warn(`[better-json] Dropping \"${key}\" key to prevent prototype pollution`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (parseDates && typeof value$1 === \"string\") {\n\t\t\t\tconst date = parseISODate(value$1);\n\t\t\t\tif (date) return date;\n\t\t\t}\n\t\t\treturn reviver ? reviver(key, value$1) : value$1;\n\t\t};\n\t\treturn JSON.parse(trimmed, secureReviver);\n\t} catch (error) {\n\t\tif (strict) throw error;\n\t\treturn value;\n\t}\n}\nfunction parseJSON(value, options = { strict: true }) {\n\treturn betterJSONParse(value, options);\n}\nvar parser_default = parseJSON;\n\n//#endregion\nexport { parser_default as n, parseJSON as t };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 5389, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/access-Dx8TLKnw.mjs"],"sourcesContent":["import { BetterAuthError } from \"@better-auth/core/error\";\n\n//#region src/plugins/access/access.ts\nfunction role(statements) {\n\treturn {\n\t\tauthorize(request, connector = \"AND\") {\n\t\t\tlet success = false;\n\t\t\tfor (const [requestedResource, requestedActions] of Object.entries(request)) {\n\t\t\t\tconst allowedActions = statements[requestedResource];\n\t\t\t\tif (!allowedActions) return {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\terror: `You are not allowed to access resource: ${requestedResource}`\n\t\t\t\t};\n\t\t\t\tif (Array.isArray(requestedActions)) success = requestedActions.every((requestedAction) => allowedActions.includes(requestedAction));\n\t\t\t\telse if (typeof requestedActions === \"object\") {\n\t\t\t\t\tconst actions = requestedActions;\n\t\t\t\t\tif (actions.connector === \"OR\") success = actions.actions.some((requestedAction) => allowedActions.includes(requestedAction));\n\t\t\t\t\telse success = actions.actions.every((requestedAction) => allowedActions.includes(requestedAction));\n\t\t\t\t} else throw new BetterAuthError(\"Invalid access control request\");\n\t\t\t\tif (success && connector === \"OR\") return { success };\n\t\t\t\tif (!success && connector === \"AND\") return {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\terror: `unauthorized to access resource \"${requestedResource}\"`\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (success) return { success };\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Not authorized\"\n\t\t\t};\n\t\t},\n\t\tstatements\n\t};\n}\nfunction createAccessControl(s) {\n\treturn {\n\t\tnewRole(statements) {\n\t\t\treturn role(statements);\n\t\t},\n\t\tstatements: s\n\t};\n}\n\n//#endregion\nexport { role as n, createAccessControl as t };"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAEA,sCAAsC;AACtC,SAAS,KAAK,UAAU;IACvB,OAAO;QACN,WAAU,OAAO,EAAE,YAAY,KAAK;YACnC,IAAI,UAAU;YACd,KAAK,MAAM,CAAC,mBAAmB,iBAAiB,IAAI,OAAO,OAAO,CAAC,SAAU;gBAC5E,MAAM,iBAAiB,UAAU,CAAC,kBAAkB;gBACpD,IAAI,CAAC,gBAAgB,OAAO;oBAC3B,SAAS;oBACT,OAAO,CAAC,wCAAwC,EAAE,mBAAmB;gBACtE;gBACA,IAAI,MAAM,OAAO,CAAC,mBAAmB,UAAU,iBAAiB,KAAK,CAAC,CAAC,kBAAoB,eAAe,QAAQ,CAAC;qBAC9G,IAAI,OAAO,qBAAqB,UAAU;oBAC9C,MAAM,UAAU;oBAChB,IAAI,QAAQ,SAAS,KAAK,MAAM,UAAU,QAAQ,OAAO,CAAC,IAAI,CAAC,CAAC,kBAAoB,eAAe,QAAQ,CAAC;yBACvG,UAAU,QAAQ,OAAO,CAAC,KAAK,CAAC,CAAC,kBAAoB,eAAe,QAAQ,CAAC;gBACnF,OAAO,MAAM,IAAI,mOAAe,CAAC;gBACjC,IAAI,WAAW,cAAc,MAAM,OAAO;oBAAE;gBAAQ;gBACpD,IAAI,CAAC,WAAW,cAAc,OAAO,OAAO;oBAC3C,SAAS;oBACT,OAAO,CAAC,iCAAiC,EAAE,kBAAkB,CAAC,CAAC;gBAChE;YACD;YACA,IAAI,SAAS,OAAO;gBAAE;YAAQ;YAC9B,OAAO;gBACN,SAAS;gBACT,OAAO;YACR;QACD;QACA;IACD;AACD;AACA,SAAS,oBAAoB,CAAC;IAC7B,OAAO;QACN,SAAQ,UAAU;YACjB,OAAO,KAAK;QACb;QACA,YAAY;IACb;AACD","ignoreList":[0]}},
    {"offset": {"line": 5447, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/access-h-uttVNZ.mjs"],"sourcesContent":["import { t as createAccessControl } from \"./access-Dx8TLKnw.mjs\";\n\n//#region src/plugins/admin/access/statement.ts\nconst defaultStatements = {\n\tuser: [\n\t\t\"create\",\n\t\t\"list\",\n\t\t\"set-role\",\n\t\t\"ban\",\n\t\t\"impersonate\",\n\t\t\"delete\",\n\t\t\"set-password\",\n\t\t\"get\",\n\t\t\"update\"\n\t],\n\tsession: [\n\t\t\"list\",\n\t\t\"revoke\",\n\t\t\"delete\"\n\t]\n};\nconst defaultAc = createAccessControl(defaultStatements);\nconst adminAc = defaultAc.newRole({\n\tuser: [\n\t\t\"create\",\n\t\t\"list\",\n\t\t\"set-role\",\n\t\t\"ban\",\n\t\t\"impersonate\",\n\t\t\"delete\",\n\t\t\"set-password\",\n\t\t\"get\",\n\t\t\"update\"\n\t],\n\tsession: [\n\t\t\"list\",\n\t\t\"revoke\",\n\t\t\"delete\"\n\t]\n});\nconst userAc = defaultAc.newRole({\n\tuser: [],\n\tsession: []\n});\nconst defaultRoles = {\n\tadmin: adminAc,\n\tuser: userAc\n};\n\n//#endregion\nexport { userAc as a, defaultStatements as i, defaultAc as n, defaultRoles as r, adminAc as t };"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;AAEA,+CAA+C;AAC/C,MAAM,oBAAoB;IACzB,MAAM;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACA;IACD,SAAS;QACR;QACA;QACA;KACA;AACF;AACA,MAAM,YAAY,IAAA,oKAAmB,EAAC;AACtC,MAAM,UAAU,UAAU,OAAO,CAAC;IACjC,MAAM;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACA;IACD,SAAS;QACR;QACA;QACA;KACA;AACF;AACA,MAAM,SAAS,UAAU,OAAO,CAAC;IAChC,MAAM,EAAE;IACR,SAAS,EAAE;AACZ;AACA,MAAM,eAAe;IACpB,OAAO;IACP,MAAM;AACP","ignoreList":[0]}},
    {"offset": {"line": 5512, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/has-permission-qCjQqGds.mjs"],"sourcesContent":["import { r as defaultRoles } from \"./access-h-uttVNZ.mjs\";\n\n//#region src/plugins/admin/has-permission.ts\nconst hasPermission = (input) => {\n\tif (input.userId && input.options?.adminUserIds?.includes(input.userId)) return true;\n\tif (!input.permissions && !input.permission) return false;\n\tconst roles = (input.role || input.options?.defaultRole || \"user\").split(\",\");\n\tconst acRoles = input.options?.roles || defaultRoles;\n\tfor (const role of roles) if ((acRoles[role]?.authorize(input.permission ?? input.permissions))?.success) return true;\n\treturn false;\n};\n\n//#endregion\nexport { hasPermission as t };"],"names":[],"mappings":";;;;AAAA;;AAEA,6CAA6C;AAC7C,MAAM,gBAAgB,CAAC;IACtB,IAAI,MAAM,MAAM,IAAI,MAAM,OAAO,EAAE,cAAc,SAAS,MAAM,MAAM,GAAG,OAAO;IAChF,IAAI,CAAC,MAAM,WAAW,IAAI,CAAC,MAAM,UAAU,EAAE,OAAO;IACpD,MAAM,QAAQ,CAAC,MAAM,IAAI,IAAI,MAAM,OAAO,EAAE,eAAe,MAAM,EAAE,KAAK,CAAC;IACzE,MAAM,UAAU,MAAM,OAAO,EAAE,SAAS,uKAAY;IACpD,KAAK,MAAM,QAAQ,MAAO,IAAK,OAAO,CAAC,KAAK,EAAE,UAAU,MAAM,UAAU,IAAI,MAAM,WAAW,GAAI,SAAS,OAAO;IACjH,OAAO;AACR","ignoreList":[0]}},
    {"offset": {"line": 5532, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/access-vPNO48H4.mjs"],"sourcesContent":["import { t as createAccessControl } from \"./access-Dx8TLKnw.mjs\";\n\n//#region src/plugins/organization/access/statement.ts\nconst defaultStatements = {\n\torganization: [\"update\", \"delete\"],\n\tmember: [\n\t\t\"create\",\n\t\t\"update\",\n\t\t\"delete\"\n\t],\n\tinvitation: [\"create\", \"cancel\"],\n\tteam: [\n\t\t\"create\",\n\t\t\"update\",\n\t\t\"delete\"\n\t],\n\tac: [\n\t\t\"create\",\n\t\t\"read\",\n\t\t\"update\",\n\t\t\"delete\"\n\t]\n};\nconst defaultAc = createAccessControl(defaultStatements);\nconst adminAc = defaultAc.newRole({\n\torganization: [\"update\"],\n\tinvitation: [\"create\", \"cancel\"],\n\tmember: [\n\t\t\"create\",\n\t\t\"update\",\n\t\t\"delete\"\n\t],\n\tteam: [\n\t\t\"create\",\n\t\t\"update\",\n\t\t\"delete\"\n\t],\n\tac: [\n\t\t\"create\",\n\t\t\"read\",\n\t\t\"update\",\n\t\t\"delete\"\n\t]\n});\nconst ownerAc = defaultAc.newRole({\n\torganization: [\"update\", \"delete\"],\n\tmember: [\n\t\t\"create\",\n\t\t\"update\",\n\t\t\"delete\"\n\t],\n\tinvitation: [\"create\", \"cancel\"],\n\tteam: [\n\t\t\"create\",\n\t\t\"update\",\n\t\t\"delete\"\n\t],\n\tac: [\n\t\t\"create\",\n\t\t\"read\",\n\t\t\"update\",\n\t\t\"delete\"\n\t]\n});\nconst memberAc = defaultAc.newRole({\n\torganization: [],\n\tmember: [],\n\tinvitation: [],\n\tteam: [],\n\tac: [\"read\"]\n});\nconst defaultRoles = {\n\tadmin: adminAc,\n\towner: ownerAc,\n\tmember: memberAc\n};\n\n//#endregion\nexport { memberAc as a, defaultStatements as i, defaultAc as n, ownerAc as o, defaultRoles as r, adminAc as t };"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;AAEA,sDAAsD;AACtD,MAAM,oBAAoB;IACzB,cAAc;QAAC;QAAU;KAAS;IAClC,QAAQ;QACP;QACA;QACA;KACA;IACD,YAAY;QAAC;QAAU;KAAS;IAChC,MAAM;QACL;QACA;QACA;KACA;IACD,IAAI;QACH;QACA;QACA;QACA;KACA;AACF;AACA,MAAM,YAAY,IAAA,oKAAmB,EAAC;AACtC,MAAM,UAAU,UAAU,OAAO,CAAC;IACjC,cAAc;QAAC;KAAS;IACxB,YAAY;QAAC;QAAU;KAAS;IAChC,QAAQ;QACP;QACA;QACA;KACA;IACD,MAAM;QACL;QACA;QACA;KACA;IACD,IAAI;QACH;QACA;QACA;QACA;KACA;AACF;AACA,MAAM,UAAU,UAAU,OAAO,CAAC;IACjC,cAAc;QAAC;QAAU;KAAS;IAClC,QAAQ;QACP;QACA;QACA;KACA;IACD,YAAY;QAAC;QAAU;KAAS;IAChC,MAAM;QACL;QACA;QACA;KACA;IACD,IAAI;QACH;QACA;QACA;QACA;KACA;AACF;AACA,MAAM,WAAW,UAAU,OAAO,CAAC;IAClC,cAAc,EAAE;IAChB,QAAQ,EAAE;IACV,YAAY,EAAE;IACd,MAAM,EAAE;IACR,IAAI;QAAC;KAAO;AACb;AACA,MAAM,eAAe;IACpB,OAAO;IACP,OAAO;IACP,QAAQ;AACT","ignoreList":[0]}},
    {"offset": {"line": 5646, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/permission-JwliMugl.mjs"],"sourcesContent":["//#region src/plugins/organization/permission.ts\nconst hasPermissionFn = (input, acRoles) => {\n\tif (!input.permissions && !input.permission) return false;\n\tconst roles = input.role.split(\",\");\n\tconst creatorRole = input.options.creatorRole || \"owner\";\n\tconst isCreator = roles.includes(creatorRole);\n\tconst allowCreatorsAllPermissions = input.allowCreatorAllPermissions || false;\n\tif (isCreator && allowCreatorsAllPermissions) return true;\n\tfor (const role of roles) if ((acRoles[role]?.authorize(input.permissions ?? input.permission))?.success) return true;\n\treturn false;\n};\nlet cacheAllRoles = /* @__PURE__ */ new Map();\n\n//#endregion\nexport { hasPermissionFn as n, cacheAllRoles as t };"],"names":[],"mappings":"AAAA,gDAAgD;;;;;;;AAChD,MAAM,kBAAkB,CAAC,OAAO;IAC/B,IAAI,CAAC,MAAM,WAAW,IAAI,CAAC,MAAM,UAAU,EAAE,OAAO;IACpD,MAAM,QAAQ,MAAM,IAAI,CAAC,KAAK,CAAC;IAC/B,MAAM,cAAc,MAAM,OAAO,CAAC,WAAW,IAAI;IACjD,MAAM,YAAY,MAAM,QAAQ,CAAC;IACjC,MAAM,8BAA8B,MAAM,0BAA0B,IAAI;IACxE,IAAI,aAAa,6BAA6B,OAAO;IACrD,KAAK,MAAM,QAAQ,MAAO,IAAK,OAAO,CAAC,KAAK,EAAE,UAAU,MAAM,WAAW,IAAI,MAAM,UAAU,GAAI,SAAS,OAAO;IACjH,OAAO;AACR;AACA,IAAI,gBAAgB,aAAa,GAAG,IAAI","ignoreList":[0]}},
    {"offset": {"line": 5669, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/client-CMPEe5-e.mjs"],"sourcesContent":["//#region src/plugins/two-factor/client.ts\nconst twoFactorClient = (options) => {\n\treturn {\n\t\tid: \"two-factor\",\n\t\t$InferServerPlugin: {},\n\t\tatomListeners: [{\n\t\t\tmatcher: (path) => path.startsWith(\"/two-factor/\"),\n\t\t\tsignal: \"$sessionSignal\"\n\t\t}],\n\t\tpathMethods: {\n\t\t\t\"/two-factor/disable\": \"POST\",\n\t\t\t\"/two-factor/enable\": \"POST\",\n\t\t\t\"/two-factor/send-otp\": \"POST\",\n\t\t\t\"/two-factor/generate-backup-codes\": \"POST\"\n\t\t},\n\t\tfetchPlugins: [{\n\t\t\tid: \"two-factor\",\n\t\t\tname: \"two-factor\",\n\t\t\thooks: { async onSuccess(context) {\n\t\t\t\tif (context.data?.twoFactorRedirect) {\n\t\t\t\t\tif (options?.onTwoFactorRedirect) await options.onTwoFactorRedirect();\n\t\t\t\t}\n\t\t\t} }\n\t\t}]\n\t};\n};\n\n//#endregion\nexport { twoFactorClient as t };"],"names":[],"mappings":"AAAA,0CAA0C;;;;;AAC1C,MAAM,kBAAkB,CAAC;IACxB,OAAO;QACN,IAAI;QACJ,oBAAoB,CAAC;QACrB,eAAe;YAAC;gBACf,SAAS,CAAC,OAAS,KAAK,UAAU,CAAC;gBACnC,QAAQ;YACT;SAAE;QACF,aAAa;YACZ,uBAAuB;YACvB,sBAAsB;YACtB,wBAAwB;YACxB,qCAAqC;QACtC;QACA,cAAc;YAAC;gBACd,IAAI;gBACJ,MAAM;gBACN,OAAO;oBAAE,MAAM,WAAU,OAAO;wBAC/B,IAAI,QAAQ,IAAI,EAAE,mBAAmB;4BACpC,IAAI,SAAS,qBAAqB,MAAM,QAAQ,mBAAmB;wBACpE;oBACD;gBAAE;YACH;SAAE;IACH;AACD","ignoreList":[0]}},
    {"offset": {"line": 5710, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/plugin-helper-zFdFWLgL.mjs"],"sourcesContent":["import { APIError } from \"better-call\";\n\n//#region src/utils/plugin-helper.ts\nconst getEndpointResponse = async (ctx) => {\n\tconst returned = ctx.context.returned;\n\tif (!returned) return null;\n\tif (returned instanceof Response) {\n\t\tif (returned.status !== 200) return null;\n\t\treturn await returned.clone().json();\n\t}\n\tif (returned instanceof APIError) return null;\n\treturn returned;\n};\n\n//#endregion\nexport { getEndpointResponse as t };"],"names":[],"mappings":";;;;AAAA;;AAEA,oCAAoC;AACpC,MAAM,sBAAsB,OAAO;IAClC,MAAM,WAAW,IAAI,OAAO,CAAC,QAAQ;IACrC,IAAI,CAAC,UAAU,OAAO;IACtB,IAAI,oBAAoB,UAAU;QACjC,IAAI,SAAS,MAAM,KAAK,KAAK,OAAO;QACpC,OAAO,MAAM,SAAS,KAAK,GAAG,IAAI;IACnC;IACA,IAAI,oBAAoB,6JAAQ,EAAE,OAAO;IACzC,OAAO;AACR","ignoreList":[0]}},
    {"offset": {"line": 5732, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/admin-D-OMdNIc.mjs"],"sourcesContent":["import { l as parseUserOutput, t as mergeSchema, u as getDate } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport { c as setSessionCookie, n as deleteSessionCookie } from \"./cookies-D72PbWdz.mjs\";\nimport { r as getSessionFromCtx } from \"./session-AaRl3_x-.mjs\";\nimport { t as hasPermission } from \"./has-permission-qCjQqGds.mjs\";\nimport { t as getEndpointResponse } from \"./plugin-helper-zFdFWLgL.mjs\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\n\n//#region src/plugins/admin/error-codes.ts\nconst ADMIN_ERROR_CODES = defineErrorCodes({\n\tFAILED_TO_CREATE_USER: \"Failed to create user\",\n\tUSER_ALREADY_EXISTS: \"User already exists.\",\n\tUSER_ALREADY_EXISTS_USE_ANOTHER_EMAIL: \"User already exists. Use another email.\",\n\tYOU_CANNOT_BAN_YOURSELF: \"You cannot ban yourself\",\n\tYOU_ARE_NOT_ALLOWED_TO_CHANGE_USERS_ROLE: \"You are not allowed to change users role\",\n\tYOU_ARE_NOT_ALLOWED_TO_CREATE_USERS: \"You are not allowed to create users\",\n\tYOU_ARE_NOT_ALLOWED_TO_LIST_USERS: \"You are not allowed to list users\",\n\tYOU_ARE_NOT_ALLOWED_TO_LIST_USERS_SESSIONS: \"You are not allowed to list users sessions\",\n\tYOU_ARE_NOT_ALLOWED_TO_BAN_USERS: \"You are not allowed to ban users\",\n\tYOU_ARE_NOT_ALLOWED_TO_IMPERSONATE_USERS: \"You are not allowed to impersonate users\",\n\tYOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS: \"You are not allowed to revoke users sessions\",\n\tYOU_ARE_NOT_ALLOWED_TO_DELETE_USERS: \"You are not allowed to delete users\",\n\tYOU_ARE_NOT_ALLOWED_TO_SET_USERS_PASSWORD: \"You are not allowed to set users password\",\n\tBANNED_USER: \"You have been banned from this application\",\n\tYOU_ARE_NOT_ALLOWED_TO_GET_USER: \"You are not allowed to get user\",\n\tNO_DATA_TO_UPDATE: \"No data to update\",\n\tYOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS: \"You are not allowed to update users\",\n\tYOU_CANNOT_REMOVE_YOURSELF: \"You cannot remove yourself\",\n\tYOU_ARE_NOT_ALLOWED_TO_SET_NON_EXISTENT_VALUE: \"You are not allowed to set a non-existent role value\"\n});\n\n//#endregion\n//#region src/plugins/admin/schema.ts\nconst schema = {\n\tuser: { fields: {\n\t\trole: {\n\t\t\ttype: \"string\",\n\t\t\trequired: false,\n\t\t\tinput: false\n\t\t},\n\t\tbanned: {\n\t\t\ttype: \"boolean\",\n\t\t\tdefaultValue: false,\n\t\t\trequired: false,\n\t\t\tinput: false\n\t\t},\n\t\tbanReason: {\n\t\t\ttype: \"string\",\n\t\t\trequired: false,\n\t\t\tinput: false\n\t\t},\n\t\tbanExpires: {\n\t\t\ttype: \"date\",\n\t\t\trequired: false,\n\t\t\tinput: false\n\t\t}\n\t} },\n\tsession: { fields: { impersonatedBy: {\n\t\ttype: \"string\",\n\t\trequired: false\n\t} } }\n};\n\n//#endregion\n//#region src/plugins/admin/admin.ts\nfunction parseRoles(roles) {\n\treturn Array.isArray(roles) ? roles.join(\",\") : roles;\n}\nconst admin = (options) => {\n\tconst opts = {\n\t\tdefaultRole: options?.defaultRole ?? \"user\",\n\t\tadminRoles: options?.adminRoles ?? [\"admin\"],\n\t\tbannedUserMessage: options?.bannedUserMessage ?? \"You have been banned from this application. Please contact support if you believe this is an error.\",\n\t\t...options\n\t};\n\t/**\n\t* Ensures a valid session, if not will throw.\n\t* Will also provide additional types on the user to include role types.\n\t*/\n\tconst adminMiddleware = createAuthMiddleware(async (ctx) => {\n\t\tconst session = await getSessionFromCtx(ctx);\n\t\tif (!session) throw new APIError(\"UNAUTHORIZED\");\n\t\treturn { session };\n\t});\n\treturn {\n\t\tid: \"admin\",\n\t\tinit() {\n\t\t\treturn { options: { databaseHooks: {\n\t\t\t\tuser: { create: { async before(user) {\n\t\t\t\t\treturn { data: {\n\t\t\t\t\t\trole: options?.defaultRole ?? \"user\",\n\t\t\t\t\t\t...user\n\t\t\t\t\t} };\n\t\t\t\t} } },\n\t\t\t\tsession: { create: { async before(session, ctx) {\n\t\t\t\t\tif (!ctx) return;\n\t\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(session.userId);\n\t\t\t\t\tif (user.banned) {\n\t\t\t\t\t\tif (user.banExpires && new Date(user.banExpires).getTime() < Date.now()) {\n\t\t\t\t\t\t\tawait ctx.context.internalAdapter.updateUser(session.userId, {\n\t\t\t\t\t\t\t\tbanned: false,\n\t\t\t\t\t\t\t\tbanReason: null,\n\t\t\t\t\t\t\t\tbanExpires: null\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (ctx && (ctx.path.startsWith(\"/callback\") || ctx.path.startsWith(\"/oauth2/callback\"))) {\n\t\t\t\t\t\t\tconst redirectURI = ctx.context.options.onAPIError?.errorURL || `${ctx.context.baseURL}/error`;\n\t\t\t\t\t\t\tthrow ctx.redirect(`${redirectURI}?error=banned&error_description=${opts.bannedUserMessage}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\t\t\tmessage: opts.bannedUserMessage,\n\t\t\t\t\t\t\tcode: \"BANNED_USER\"\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} } }\n\t\t\t} } };\n\t\t},\n\t\thooks: { after: [{\n\t\t\tmatcher(context) {\n\t\t\t\treturn context.path === \"/list-sessions\";\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst response = await getEndpointResponse(ctx);\n\t\t\t\tif (!response) return;\n\t\t\t\tconst newJson = response.filter((session) => {\n\t\t\t\t\treturn !session.impersonatedBy;\n\t\t\t\t});\n\t\t\t\treturn ctx.json(newJson);\n\t\t\t})\n\t\t}] },\n\t\tendpoints: {\n\t\t\tsetRole: createAuthEndpoint(\"/admin/set-role\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tuserId: z.coerce.string().meta({ description: \"The user id\" }),\n\t\t\t\t\trole: z.union([z.string().meta({ description: \"The role to set. `admin` or `user` by default\" }), z.array(z.string().meta({ description: \"The roles to set. `admin` or `user` by default\" }))]).meta({ description: \"The role to set, this can be a string or an array of strings. Eg: `admin` or `[admin, user]`\" })\n\t\t\t\t}),\n\t\t\t\trequireHeaders: true,\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: {\n\t\t\t\t\topenapi: {\n\t\t\t\t\t\toperationId: \"setUserRole\",\n\t\t\t\t\t\tsummary: \"Set the role of a user\",\n\t\t\t\t\t\tdescription: \"Set the role of a user\",\n\t\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\t\tdescription: \"User role updated\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: { user: { $ref: \"#/components/schemas/User\" } }\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t} }\n\t\t\t\t\t},\n\t\t\t\t\t$Infer: { body: {} }\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: ctx.context.session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { user: [\"set-role\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CHANGE_USERS_ROLE });\n\t\t\t\tconst roles = opts.roles;\n\t\t\t\tif (roles) {\n\t\t\t\t\tconst inputRoles = Array.isArray(ctx.body.role) ? ctx.body.role : [ctx.body.role];\n\t\t\t\t\tfor (const role of inputRoles) if (!roles[role]) throw new APIError(\"BAD_REQUEST\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_SET_NON_EXISTENT_VALUE });\n\t\t\t\t}\n\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(ctx.body.userId, { role: parseRoles(ctx.body.role) });\n\t\t\t\treturn ctx.json({ user: updatedUser });\n\t\t\t}),\n\t\t\tgetUser: createAuthEndpoint(\"/admin/get-user\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tquery: z.object({ id: z.string().meta({ description: \"The id of the User\" }) }),\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"getUser\",\n\t\t\t\t\tsummary: \"Get an existing user\",\n\t\t\t\t\tdescription: \"Get an existing user\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"User\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { user: { $ref: \"#/components/schemas/User\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { id } = ctx.query;\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: ctx.context.session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { user: [\"get\"] }\n\t\t\t\t})) throw ctx.error(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_GET_USER,\n\t\t\t\t\tcode: \"YOU_ARE_NOT_ALLOWED_TO_GET_USER\"\n\t\t\t\t});\n\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(id);\n\t\t\t\tif (!user) throw new APIError(\"NOT_FOUND\", { message: BASE_ERROR_CODES.USER_NOT_FOUND });\n\t\t\t\treturn parseUserOutput(ctx.context.options, user);\n\t\t\t}),\n\t\t\tcreateUser: createAuthEndpoint(\"/admin/create-user\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\temail: z.string().meta({ description: \"The email of the user\" }),\n\t\t\t\t\tpassword: z.string().meta({ description: \"The password of the user\" }),\n\t\t\t\t\tname: z.string().meta({ description: \"The name of the user\" }),\n\t\t\t\t\trole: z.union([z.string().meta({ description: \"The role of the user\" }), z.array(z.string().meta({ description: \"The roles of user\" }))]).optional().meta({ description: `A string or array of strings representing the roles to apply to the new user. Eg: \\\"user\\\"` }),\n\t\t\t\t\tdata: z.record(z.string(), z.any()).optional().meta({ description: \"Extra fields for the user. Including custom additional fields.\" })\n\t\t\t\t}),\n\t\t\t\tmetadata: {\n\t\t\t\t\topenapi: {\n\t\t\t\t\t\toperationId: \"createUser\",\n\t\t\t\t\t\tsummary: \"Create a new user\",\n\t\t\t\t\t\tdescription: \"Create a new user\",\n\t\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\t\tdescription: \"User created\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: { user: { $ref: \"#/components/schemas/User\" } }\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t} }\n\t\t\t\t\t},\n\t\t\t\t\t$Infer: { body: {} }\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\t\tif (!session && (ctx.request || ctx.headers)) throw ctx.error(\"UNAUTHORIZED\");\n\t\t\t\tif (session) {\n\t\t\t\t\tif (!hasPermission({\n\t\t\t\t\t\tuserId: session.user.id,\n\t\t\t\t\t\trole: session.user.role,\n\t\t\t\t\t\toptions: opts,\n\t\t\t\t\t\tpermissions: { user: [\"create\"] }\n\t\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CREATE_USERS });\n\t\t\t\t}\n\t\t\t\tconst email = ctx.body.email.toLowerCase();\n\t\t\t\tif (!z.email().safeParse(email).success) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.INVALID_EMAIL });\n\t\t\t\tif (await ctx.context.internalAdapter.findUserByEmail(email)) throw new APIError(\"BAD_REQUEST\", { message: ADMIN_ERROR_CODES.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL });\n\t\t\t\tconst user = await ctx.context.internalAdapter.createUser({\n\t\t\t\t\temail,\n\t\t\t\t\tname: ctx.body.name,\n\t\t\t\t\trole: (ctx.body.role && parseRoles(ctx.body.role)) ?? options?.defaultRole ?? \"user\",\n\t\t\t\t\t...ctx.body.data\n\t\t\t\t});\n\t\t\t\tif (!user) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: ADMIN_ERROR_CODES.FAILED_TO_CREATE_USER });\n\t\t\t\tconst hashedPassword = await ctx.context.password.hash(ctx.body.password);\n\t\t\t\tawait ctx.context.internalAdapter.linkAccount({\n\t\t\t\t\taccountId: user.id,\n\t\t\t\t\tproviderId: \"credential\",\n\t\t\t\t\tpassword: hashedPassword,\n\t\t\t\t\tuserId: user.id\n\t\t\t\t});\n\t\t\t\treturn ctx.json({ user });\n\t\t\t}),\n\t\t\tadminUpdateUser: createAuthEndpoint(\"/admin/update-user\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tuserId: z.coerce.string().meta({ description: \"The user id\" }),\n\t\t\t\t\tdata: z.record(z.any(), z.any()).meta({ description: \"The user data to update\" })\n\t\t\t\t}),\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"updateUser\",\n\t\t\t\t\tsummary: \"Update a user\",\n\t\t\t\t\tdescription: \"Update a user's details\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"User updated\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { user: { $ref: \"#/components/schemas/User\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: ctx.context.session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { user: [\"update\"] }\n\t\t\t\t})) throw ctx.error(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS,\n\t\t\t\t\tcode: \"YOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS\"\n\t\t\t\t});\n\t\t\t\tif (Object.keys(ctx.body.data).length === 0) throw new APIError(\"BAD_REQUEST\", { message: ADMIN_ERROR_CODES.NO_DATA_TO_UPDATE });\n\t\t\t\tif (ctx.body.data?.role) ctx.body.data.role = parseRoles(ctx.body.data.role);\n\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(ctx.body.userId, ctx.body.data);\n\t\t\t\treturn ctx.json(updatedUser);\n\t\t\t}),\n\t\t\tlistUsers: createAuthEndpoint(\"/admin/list-users\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tquery: z.object({\n\t\t\t\t\tsearchValue: z.string().optional().meta({ description: \"The value to search for. Eg: \\\"some name\\\"\" }),\n\t\t\t\t\tsearchField: z.enum([\"email\", \"name\"]).meta({ description: \"The field to search in, defaults to email. Can be `email` or `name`. Eg: \\\"name\\\"\" }).optional(),\n\t\t\t\t\tsearchOperator: z.enum([\n\t\t\t\t\t\t\"contains\",\n\t\t\t\t\t\t\"starts_with\",\n\t\t\t\t\t\t\"ends_with\"\n\t\t\t\t\t]).meta({ description: \"The operator to use for the search. Can be `contains`, `starts_with` or `ends_with`. Eg: \\\"contains\\\"\" }).optional(),\n\t\t\t\t\tlimit: z.string().meta({ description: \"The number of users to return\" }).or(z.number()).optional(),\n\t\t\t\t\toffset: z.string().meta({ description: \"The offset to start from\" }).or(z.number()).optional(),\n\t\t\t\t\tsortBy: z.string().meta({ description: \"The field to sort by\" }).optional(),\n\t\t\t\t\tsortDirection: z.enum([\"asc\", \"desc\"]).meta({ description: \"The direction to sort by\" }).optional(),\n\t\t\t\t\tfilterField: z.string().meta({ description: \"The field to filter by\" }).optional(),\n\t\t\t\t\tfilterValue: z.string().meta({ description: \"The value to filter by\" }).or(z.number()).or(z.boolean()).optional(),\n\t\t\t\t\tfilterOperator: z.enum([\n\t\t\t\t\t\t\"eq\",\n\t\t\t\t\t\t\"ne\",\n\t\t\t\t\t\t\"lt\",\n\t\t\t\t\t\t\"lte\",\n\t\t\t\t\t\t\"gt\",\n\t\t\t\t\t\t\"gte\",\n\t\t\t\t\t\t\"contains\"\n\t\t\t\t\t]).meta({ description: \"The operator to use for the filter\" }).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"listUsers\",\n\t\t\t\t\tsummary: \"List users\",\n\t\t\t\t\tdescription: \"List users\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"List of users\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tusers: {\n\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\titems: { $ref: \"#/components/schemas/User\" }\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttotal: { type: \"number\" },\n\t\t\t\t\t\t\t\tlimit: { type: \"number\" },\n\t\t\t\t\t\t\t\toffset: { type: \"number\" }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\"users\", \"total\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = ctx.context.session;\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { user: [\"list\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_LIST_USERS });\n\t\t\t\tconst where = [];\n\t\t\t\tif (ctx.query?.searchValue) where.push({\n\t\t\t\t\tfield: ctx.query.searchField || \"email\",\n\t\t\t\t\toperator: ctx.query.searchOperator || \"contains\",\n\t\t\t\t\tvalue: ctx.query.searchValue\n\t\t\t\t});\n\t\t\t\tif (ctx.query?.filterValue) where.push({\n\t\t\t\t\tfield: ctx.query.filterField || \"email\",\n\t\t\t\t\toperator: ctx.query.filterOperator || \"eq\",\n\t\t\t\t\tvalue: ctx.query.filterValue\n\t\t\t\t});\n\t\t\t\ttry {\n\t\t\t\t\tconst users = await ctx.context.internalAdapter.listUsers(Number(ctx.query?.limit) || void 0, Number(ctx.query?.offset) || void 0, ctx.query?.sortBy ? {\n\t\t\t\t\t\tfield: ctx.query.sortBy,\n\t\t\t\t\t\tdirection: ctx.query.sortDirection || \"asc\"\n\t\t\t\t\t} : void 0, where.length ? where : void 0);\n\t\t\t\t\tconst total = await ctx.context.internalAdapter.countTotalUsers(where.length ? where : void 0);\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tusers,\n\t\t\t\t\t\ttotal,\n\t\t\t\t\t\tlimit: Number(ctx.query?.limit) || void 0,\n\t\t\t\t\t\toffset: Number(ctx.query?.offset) || void 0\n\t\t\t\t\t});\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tusers: [],\n\t\t\t\t\t\ttotal: 0\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}),\n\t\t\tlistUserSessions: createAuthEndpoint(\"/admin/list-user-sessions\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tbody: z.object({ userId: z.coerce.string().meta({ description: \"The user id\" }) }),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"listUserSessions\",\n\t\t\t\t\tsummary: \"List user sessions\",\n\t\t\t\t\tdescription: \"List user sessions\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"List of user sessions\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { sessions: {\n\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\titems: { $ref: \"#/components/schemas/Session\" }\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = ctx.context.session;\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { session: [\"list\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_LIST_USERS_SESSIONS });\n\t\t\t\treturn { sessions: await ctx.context.internalAdapter.listSessions(ctx.body.userId) };\n\t\t\t}),\n\t\t\tunbanUser: createAuthEndpoint(\"/admin/unban-user\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ userId: z.coerce.string().meta({ description: \"The user id\" }) }),\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"unbanUser\",\n\t\t\t\t\tsummary: \"Unban a user\",\n\t\t\t\t\tdescription: \"Unban a user\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"User unbanned\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { user: { $ref: \"#/components/schemas/User\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = ctx.context.session;\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { user: [\"ban\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_BAN_USERS });\n\t\t\t\tconst user = await ctx.context.internalAdapter.updateUser(ctx.body.userId, {\n\t\t\t\t\tbanned: false,\n\t\t\t\t\tbanExpires: null,\n\t\t\t\t\tbanReason: null,\n\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t});\n\t\t\t\treturn ctx.json({ user });\n\t\t\t}),\n\t\t\tbanUser: createAuthEndpoint(\"/admin/ban-user\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tuserId: z.coerce.string().meta({ description: \"The user id\" }),\n\t\t\t\t\tbanReason: z.string().meta({ description: \"The reason for the ban\" }).optional(),\n\t\t\t\t\tbanExpiresIn: z.number().meta({ description: \"The number of seconds until the ban expires\" }).optional()\n\t\t\t\t}),\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"banUser\",\n\t\t\t\t\tsummary: \"Ban a user\",\n\t\t\t\t\tdescription: \"Ban a user\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"User banned\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { user: { $ref: \"#/components/schemas/User\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = ctx.context.session;\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { user: [\"ban\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_BAN_USERS });\n\t\t\t\tif (!await ctx.context.internalAdapter.findUserById(ctx.body.userId)) throw new APIError(\"NOT_FOUND\", { message: BASE_ERROR_CODES.USER_NOT_FOUND });\n\t\t\t\tif (ctx.body.userId === ctx.context.session.user.id) throw new APIError(\"BAD_REQUEST\", { message: ADMIN_ERROR_CODES.YOU_CANNOT_BAN_YOURSELF });\n\t\t\t\tconst user = await ctx.context.internalAdapter.updateUser(ctx.body.userId, {\n\t\t\t\t\tbanned: true,\n\t\t\t\t\tbanReason: ctx.body.banReason || options?.defaultBanReason || \"No reason\",\n\t\t\t\t\tbanExpires: ctx.body.banExpiresIn ? getDate(ctx.body.banExpiresIn, \"sec\") : options?.defaultBanExpiresIn ? getDate(options.defaultBanExpiresIn, \"sec\") : void 0,\n\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t});\n\t\t\t\tawait ctx.context.internalAdapter.deleteSessions(ctx.body.userId);\n\t\t\t\treturn ctx.json({ user });\n\t\t\t}),\n\t\t\timpersonateUser: createAuthEndpoint(\"/admin/impersonate-user\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ userId: z.coerce.string().meta({ description: \"The user id\" }) }),\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"impersonateUser\",\n\t\t\t\t\tsummary: \"Impersonate a user\",\n\t\t\t\t\tdescription: \"Impersonate a user\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Impersonation session created\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tsession: { $ref: \"#/components/schemas/Session\" },\n\t\t\t\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: ctx.context.session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { user: [\"impersonate\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_IMPERSONATE_USERS });\n\t\t\t\tconst targetUser = await ctx.context.internalAdapter.findUserById(ctx.body.userId);\n\t\t\t\tif (!targetUser) throw new APIError(\"NOT_FOUND\", { message: \"User not found\" });\n\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(targetUser.id, true, {\n\t\t\t\t\timpersonatedBy: ctx.context.session.user.id,\n\t\t\t\t\texpiresAt: options?.impersonationSessionDuration ? getDate(options.impersonationSessionDuration, \"sec\") : getDate(3600, \"sec\")\n\t\t\t\t}, true);\n\t\t\t\tif (!session) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: ADMIN_ERROR_CODES.FAILED_TO_CREATE_USER });\n\t\t\t\tconst authCookies = ctx.context.authCookies;\n\t\t\t\tdeleteSessionCookie(ctx);\n\t\t\t\tconst dontRememberMeCookie = await ctx.getSignedCookie(ctx.context.authCookies.dontRememberToken.name, ctx.context.secret);\n\t\t\t\tconst adminCookieProp = ctx.context.createAuthCookie(\"admin_session\");\n\t\t\t\tawait ctx.setSignedCookie(adminCookieProp.name, `${ctx.context.session.session.token}:${dontRememberMeCookie || \"\"}`, ctx.context.secret, authCookies.sessionToken.options);\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser: targetUser\n\t\t\t\t}, true);\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tsession,\n\t\t\t\t\tuser: targetUser\n\t\t\t\t});\n\t\t\t}),\n\t\t\tstopImpersonating: createAuthEndpoint(\"/admin/stop-impersonating\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\trequireHeaders: true\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\t\tif (!session) throw new APIError(\"UNAUTHORIZED\");\n\t\t\t\tif (!session.session.impersonatedBy) throw new APIError(\"BAD_REQUEST\", { message: \"You are not impersonating anyone\" });\n\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(session.session.impersonatedBy);\n\t\t\t\tif (!user) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: \"Failed to find user\" });\n\t\t\t\tconst adminCookieName = ctx.context.createAuthCookie(\"admin_session\").name;\n\t\t\t\tconst adminCookie = await ctx.getSignedCookie(adminCookieName, ctx.context.secret);\n\t\t\t\tif (!adminCookie) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: \"Failed to find admin session\" });\n\t\t\t\tconst [adminSessionToken, dontRememberMeCookie] = adminCookie?.split(\":\");\n\t\t\t\tconst adminSession = await ctx.context.internalAdapter.findSession(adminSessionToken);\n\t\t\t\tif (!adminSession || adminSession.session.userId !== user.id) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: \"Failed to find admin session\" });\n\t\t\t\tawait ctx.context.internalAdapter.deleteSession(session.session.token);\n\t\t\t\tawait setSessionCookie(ctx, adminSession, !!dontRememberMeCookie);\n\t\t\t\treturn ctx.json(adminSession);\n\t\t\t}),\n\t\t\trevokeUserSession: createAuthEndpoint(\"/admin/revoke-user-session\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ sessionToken: z.string().meta({ description: \"The session token\" }) }),\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"revokeUserSession\",\n\t\t\t\t\tsummary: \"Revoke a user session\",\n\t\t\t\t\tdescription: \"Revoke a user session\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Session revoked\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { success: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = ctx.context.session;\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { session: [\"revoke\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS });\n\t\t\t\tawait ctx.context.internalAdapter.deleteSession(ctx.body.sessionToken);\n\t\t\t\treturn ctx.json({ success: true });\n\t\t\t}),\n\t\t\trevokeUserSessions: createAuthEndpoint(\"/admin/revoke-user-sessions\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ userId: z.coerce.string().meta({ description: \"The user id\" }) }),\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"revokeUserSessions\",\n\t\t\t\t\tsummary: \"Revoke all user sessions\",\n\t\t\t\t\tdescription: \"Revoke all user sessions\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Sessions revoked\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { success: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = ctx.context.session;\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { session: [\"revoke\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS });\n\t\t\t\tawait ctx.context.internalAdapter.deleteSessions(ctx.body.userId);\n\t\t\t\treturn ctx.json({ success: true });\n\t\t\t}),\n\t\t\tremoveUser: createAuthEndpoint(\"/admin/remove-user\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ userId: z.coerce.string().meta({ description: \"The user id\" }) }),\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"removeUser\",\n\t\t\t\t\tsummary: \"Remove a user\",\n\t\t\t\t\tdescription: \"Delete a user and all their sessions and accounts. Cannot be undone.\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"User removed\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { success: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = ctx.context.session;\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { user: [\"delete\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_DELETE_USERS });\n\t\t\t\tif (ctx.body.userId === ctx.context.session.user.id) throw new APIError(\"BAD_REQUEST\", { message: ADMIN_ERROR_CODES.YOU_CANNOT_REMOVE_YOURSELF });\n\t\t\t\tif (!await ctx.context.internalAdapter.findUserById(ctx.body.userId)) throw new APIError(\"NOT_FOUND\", { message: \"User not found\" });\n\t\t\t\tawait ctx.context.internalAdapter.deleteUser(ctx.body.userId);\n\t\t\t\treturn ctx.json({ success: true });\n\t\t\t}),\n\t\t\tsetUserPassword: createAuthEndpoint(\"/admin/set-user-password\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tnewPassword: z.string().nonempty(\"newPassword cannot be empty\").meta({ description: \"The new password\" }),\n\t\t\t\t\tuserId: z.coerce.string().nonempty(\"userId cannot be empty\").meta({ description: \"The user id\" })\n\t\t\t\t}),\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"setUserPassword\",\n\t\t\t\t\tsummary: \"Set a user's password\",\n\t\t\t\t\tdescription: \"Set a user's password\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Password set\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { status: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: ctx.context.session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { user: [\"set-password\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_SET_USERS_PASSWORD });\n\t\t\t\tconst { newPassword, userId } = ctx.body;\n\t\t\t\tconst minPasswordLength = ctx.context.password.config.minPasswordLength;\n\t\t\t\tif (newPassword.length < minPasswordLength) {\n\t\t\t\t\tctx.context.logger.error(\"Password is too short\");\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.PASSWORD_TOO_SHORT });\n\t\t\t\t}\n\t\t\t\tconst maxPasswordLength = ctx.context.password.config.maxPasswordLength;\n\t\t\t\tif (newPassword.length > maxPasswordLength) {\n\t\t\t\t\tctx.context.logger.error(\"Password is too long\");\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.PASSWORD_TOO_LONG });\n\t\t\t\t}\n\t\t\t\tconst hashedPassword = await ctx.context.password.hash(newPassword);\n\t\t\t\tawait ctx.context.internalAdapter.updatePassword(userId, hashedPassword);\n\t\t\t\treturn ctx.json({ status: true });\n\t\t\t}),\n\t\t\tuserHasPermission: createAuthEndpoint(\"/admin/has-permission\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tuserId: z.coerce.string().optional().meta({ description: `The user id. Eg: \"user-id\"` }),\n\t\t\t\t\trole: z.string().optional().meta({ description: `The role to check permission for. Eg: \"admin\"` })\n\t\t\t\t}).and(z.union([z.object({\n\t\t\t\t\tpermission: z.record(z.string(), z.array(z.string())),\n\t\t\t\t\tpermissions: z.undefined()\n\t\t\t\t}), z.object({\n\t\t\t\t\tpermission: z.undefined(),\n\t\t\t\t\tpermissions: z.record(z.string(), z.array(z.string()))\n\t\t\t\t})])),\n\t\t\t\tmetadata: {\n\t\t\t\t\topenapi: {\n\t\t\t\t\t\tdescription: \"Check if the user has permission\",\n\t\t\t\t\t\trequestBody: { content: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tpermission: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tdescription: \"The permission to check\",\n\t\t\t\t\t\t\t\t\tdeprecated: true\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tdescription: \"The permission to check\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\"permissions\"]\n\t\t\t\t\t\t} } } },\n\t\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\terror: { type: \"string\" },\n\t\t\t\t\t\t\t\t\tsuccess: { type: \"boolean\" }\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\trequired: [\"success\"]\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t} }\n\t\t\t\t\t},\n\t\t\t\t\t$Infer: { body: {} }\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!ctx.body?.permission && !ctx.body?.permissions) throw new APIError(\"BAD_REQUEST\", { message: \"invalid permission check. no permission(s) were passed.\" });\n\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\t\tif (!session && (ctx.request || ctx.headers)) throw new APIError(\"UNAUTHORIZED\");\n\t\t\t\tif (!session && !ctx.body.userId && !ctx.body.role) throw new APIError(\"BAD_REQUEST\", { message: \"user id or role is required\" });\n\t\t\t\tconst user = session?.user || (ctx.body.role ? {\n\t\t\t\t\tid: ctx.body.userId || \"\",\n\t\t\t\t\trole: ctx.body.role\n\t\t\t\t} : null) || await ctx.context.internalAdapter.findUserById(ctx.body.userId);\n\t\t\t\tif (!user) throw new APIError(\"BAD_REQUEST\", { message: \"user not found\" });\n\t\t\t\tconst result = hasPermission({\n\t\t\t\t\tuserId: user.id,\n\t\t\t\t\trole: user.role,\n\t\t\t\t\toptions,\n\t\t\t\t\tpermissions: ctx.body.permissions ?? ctx.body.permission\n\t\t\t\t});\n\t\t\t\treturn ctx.json({\n\t\t\t\t\terror: null,\n\t\t\t\t\tsuccess: result\n\t\t\t\t});\n\t\t\t})\n\t\t},\n\t\t$ERROR_CODES: ADMIN_ERROR_CODES,\n\t\tschema: mergeSchema(schema, opts.schema),\n\t\toptions\n\t};\n};\n\n//#endregion\nexport { admin as t };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 6968, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/anonymous-DxoIOUPc.mjs"],"sourcesContent":["import { t as generateId } from \"./utils-db7gNqd-.mjs\";\nimport { t as mergeSchema } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport { c as setSessionCookie, l as parseSetCookieHeader } from \"./cookies-D72PbWdz.mjs\";\nimport { r as getSessionFromCtx } from \"./session-AaRl3_x-.mjs\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\n\n//#region src/plugins/anonymous/error-codes.ts\nconst ANONYMOUS_ERROR_CODES = defineErrorCodes({\n\tINVALID_EMAIL_FORMAT: \"Email was not generated in a valid format\",\n\tFAILED_TO_CREATE_USER: \"Failed to create user\",\n\tCOULD_NOT_CREATE_SESSION: \"Could not create session\",\n\tANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY: \"Anonymous users cannot sign in again anonymously\"\n});\n\n//#endregion\n//#region src/plugins/anonymous/schema.ts\nconst schema = { user: { fields: { isAnonymous: {\n\ttype: \"boolean\",\n\trequired: false,\n\tinput: false,\n\tdefaultValue: false\n} } } };\n\n//#endregion\n//#region src/plugins/anonymous/index.ts\nasync function getAnonUserEmail(options) {\n\tconst customEmail = await options?.generateRandomEmail?.();\n\tif (customEmail) {\n\t\tif (!z.email().safeParse(customEmail).success) throw new APIError(\"BAD_REQUEST\", { message: ANONYMOUS_ERROR_CODES.INVALID_EMAIL_FORMAT });\n\t\treturn customEmail;\n\t}\n\tconst id = generateId();\n\tif (options?.emailDomainName) return `temp-${id}@${options.emailDomainName}`;\n\treturn `temp@${id}.com`;\n}\nconst anonymous = (options) => {\n\treturn {\n\t\tid: \"anonymous\",\n\t\tendpoints: { signInAnonymous: createAuthEndpoint(\"/sign-in/anonymous\", {\n\t\t\tmethod: \"POST\",\n\t\t\tmetadata: { openapi: {\n\t\t\t\tdescription: \"Sign in anonymously\",\n\t\t\t\tresponses: { 200: {\n\t\t\t\t\tdescription: \"Sign in anonymously\",\n\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" },\n\t\t\t\t\t\t\tsession: { $ref: \"#/components/schemas/Session\" }\n\t\t\t\t\t\t}\n\t\t\t\t\t} } }\n\t\t\t\t} }\n\t\t\t} }\n\t\t}, async (ctx) => {\n\t\t\tif ((await getSessionFromCtx(ctx, { disableRefresh: true }))?.user.isAnonymous) throw new APIError(\"BAD_REQUEST\", { message: ANONYMOUS_ERROR_CODES.ANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY });\n\t\t\tconst email = await getAnonUserEmail(options);\n\t\t\tconst name = await options?.generateName?.(ctx) || \"Anonymous\";\n\t\t\tconst newUser = await ctx.context.internalAdapter.createUser({\n\t\t\t\temail,\n\t\t\t\temailVerified: false,\n\t\t\t\tisAnonymous: true,\n\t\t\t\tname,\n\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t});\n\t\t\tif (!newUser) throw ctx.error(\"INTERNAL_SERVER_ERROR\", { message: ANONYMOUS_ERROR_CODES.FAILED_TO_CREATE_USER });\n\t\t\tconst session = await ctx.context.internalAdapter.createSession(newUser.id);\n\t\t\tif (!session) return ctx.json(null, {\n\t\t\t\tstatus: 400,\n\t\t\t\tbody: { message: ANONYMOUS_ERROR_CODES.COULD_NOT_CREATE_SESSION }\n\t\t\t});\n\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\tsession,\n\t\t\t\tuser: newUser\n\t\t\t});\n\t\t\treturn ctx.json({\n\t\t\t\ttoken: session.token,\n\t\t\t\tuser: {\n\t\t\t\t\tid: newUser.id,\n\t\t\t\t\temail: newUser.email,\n\t\t\t\t\temailVerified: newUser.emailVerified,\n\t\t\t\t\tname: newUser.name,\n\t\t\t\t\tcreatedAt: newUser.createdAt,\n\t\t\t\t\tupdatedAt: newUser.updatedAt\n\t\t\t\t}\n\t\t\t});\n\t\t}) },\n\t\thooks: { after: [{\n\t\t\tmatcher(ctx) {\n\t\t\t\treturn ctx.path.startsWith(\"/sign-in\") || ctx.path.startsWith(\"/sign-up\") || ctx.path.startsWith(\"/callback\") || ctx.path.startsWith(\"/oauth2/callback\") || ctx.path.startsWith(\"/magic-link/verify\") || ctx.path.startsWith(\"/email-otp/verify-email\") || ctx.path.startsWith(\"/one-tap/callback\") || ctx.path.startsWith(\"/passkey/verify-authentication\") || ctx.path.startsWith(\"/phone-number/verify\");\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst setCookie = ctx.context.responseHeaders?.get(\"set-cookie\");\n\t\t\t\t/**\n\t\t\t\t* We can consider the user is about to sign in or sign up\n\t\t\t\t* if the response contains a session token.\n\t\t\t\t*/\n\t\t\t\tconst sessionTokenName = ctx.context.authCookies.sessionToken.name;\n\t\t\t\tif (!parseSetCookieHeader(setCookie || \"\").get(sessionTokenName)?.value.split(\".\")[0]) return;\n\t\t\t\t/**\n\t\t\t\t* Make sure the user had an anonymous session.\n\t\t\t\t*/\n\t\t\t\tconst session = await getSessionFromCtx(ctx, { disableRefresh: true });\n\t\t\t\tif (!session || !session.user.isAnonymous) return;\n\t\t\t\tif (ctx.path === \"/sign-in/anonymous\" && !ctx.context.newSession) throw new APIError(\"BAD_REQUEST\", { message: ANONYMOUS_ERROR_CODES.ANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY });\n\t\t\t\tconst newSession = ctx.context.newSession;\n\t\t\t\tif (!newSession) return;\n\t\t\t\tif (options?.onLinkAccount) await options?.onLinkAccount?.({\n\t\t\t\t\tanonymousUser: session,\n\t\t\t\t\tnewUser: newSession,\n\t\t\t\t\tctx\n\t\t\t\t});\n\t\t\t\tif (!options?.disableDeleteAnonymousUser) await ctx.context.internalAdapter.deleteUser(session.user.id);\n\t\t\t})\n\t\t}] },\n\t\tschema: mergeSchema(schema, options?.schema),\n\t\t$ERROR_CODES: ANONYMOUS_ERROR_CODES\n\t};\n};\n\n//#endregion\nexport { anonymous as t };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 7142, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/jwt-Ar1sciI2.mjs"],"sourcesContent":["import { n as symmetricEncrypt, t as symmetricDecrypt } from \"./crypto-CFUhAR9W.mjs\";\nimport { t as mergeSchema } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport { u as sessionMiddleware } from \"./session-AaRl3_x-.mjs\";\nimport { getCurrentAuthContext } from \"@better-auth/core/context\";\nimport { BetterAuthError } from \"@better-auth/core/error\";\nimport * as z from \"zod\";\nimport { SignJWT, exportJWK, generateKeyPair, importJWK, jwtVerify } from \"jose\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\nimport { base64 } from \"@better-auth/utils/base64\";\nimport { getWebcryptoSubtle } from \"@better-auth/utils\";\n\n//#region src/plugins/jwt/adapter.ts\nconst getJwksAdapter = (adapter, options) => {\n\treturn {\n\t\tgetAllKeys: async (ctx) => {\n\t\t\tif (options?.adapter?.getJwks) return await options.adapter.getJwks(ctx);\n\t\t\treturn await adapter.findMany({ model: \"jwks\" });\n\t\t},\n\t\tgetLatestKey: async (ctx) => {\n\t\t\tif (options?.adapter?.getJwks) return (await options.adapter.getJwks(ctx))?.sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime())[0];\n\t\t\treturn (await adapter.findMany({ model: \"jwks\" }))?.sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime())[0];\n\t\t},\n\t\tcreateJwk: async (ctx, webKey) => {\n\t\t\tif (options?.adapter?.createJwk) return await options.adapter.createJwk(webKey, ctx);\n\t\t\treturn await adapter.create({\n\t\t\t\tmodel: \"jwks\",\n\t\t\t\tdata: {\n\t\t\t\t\t...webKey,\n\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n};\n\n//#endregion\n//#region src/plugins/jwt/schema.ts\nconst schema = { jwks: { fields: {\n\tpublicKey: {\n\t\ttype: \"string\",\n\t\trequired: true\n\t},\n\tprivateKey: {\n\t\ttype: \"string\",\n\t\trequired: true\n\t},\n\tcreatedAt: {\n\t\ttype: \"date\",\n\t\trequired: true\n\t},\n\texpiresAt: {\n\t\ttype: \"date\",\n\t\trequired: false\n\t}\n} } };\n\n//#endregion\n//#region src/utils/time.ts\nconst minute = 60;\nconst hour = minute * 60;\nconst day = hour * 24;\nconst week = day * 7;\nconst year = day * 365.25;\nconst REGEX = /^(\\+|\\-)? ?(\\d+|\\d+\\.\\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;\n/**\n* https://github.com/panva/jose/blob/723ee6152d7ee2fc81852d2d26777e86df6fce01/src/lib/secs.ts\n*/\nfunction joseSecs(str) {\n\tconst matched = REGEX.exec(str);\n\tif (!matched || matched[4] && matched[1]) throw new TypeError(\"Invalid time period format\");\n\tconst value = parseFloat(matched[2]);\n\tconst unit = matched[3].toLowerCase();\n\tlet numericDate;\n\tswitch (unit) {\n\t\tcase \"sec\":\n\t\tcase \"secs\":\n\t\tcase \"second\":\n\t\tcase \"seconds\":\n\t\tcase \"s\":\n\t\t\tnumericDate = Math.round(value);\n\t\t\tbreak;\n\t\tcase \"minute\":\n\t\tcase \"minutes\":\n\t\tcase \"min\":\n\t\tcase \"mins\":\n\t\tcase \"m\":\n\t\t\tnumericDate = Math.round(value * minute);\n\t\t\tbreak;\n\t\tcase \"hour\":\n\t\tcase \"hours\":\n\t\tcase \"hr\":\n\t\tcase \"hrs\":\n\t\tcase \"h\":\n\t\t\tnumericDate = Math.round(value * hour);\n\t\t\tbreak;\n\t\tcase \"day\":\n\t\tcase \"days\":\n\t\tcase \"d\":\n\t\t\tnumericDate = Math.round(value * day);\n\t\t\tbreak;\n\t\tcase \"week\":\n\t\tcase \"weeks\":\n\t\tcase \"w\":\n\t\t\tnumericDate = Math.round(value * week);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tnumericDate = Math.round(value * year);\n\t\t\tbreak;\n\t}\n\tif (matched[1] === \"-\" || matched[4] === \"ago\") return -numericDate;\n\treturn numericDate;\n}\n\n//#endregion\n//#region src/plugins/jwt/utils.ts\n/**\n* Converts an expirationTime to ISO seconds expiration time (the format of JWT exp)\n*\n* See https://github.com/panva/jose/blob/main/src/lib/jwt_claims_set.ts#L245\n*\n* @param expirationTime - see options.jwt.expirationTime\n* @param iat - the iat time to consolidate on\n* @returns\n*/\nfunction toExpJWT(expirationTime, iat) {\n\tif (typeof expirationTime === \"number\") return expirationTime;\n\telse if (expirationTime instanceof Date) return Math.floor(expirationTime.getTime() / 1e3);\n\telse return iat + joseSecs(expirationTime);\n}\nasync function generateExportedKeyPair(options) {\n\tconst { alg, ...cfg } = options?.jwks?.keyPairConfig ?? {\n\t\talg: \"EdDSA\",\n\t\tcrv: \"Ed25519\"\n\t};\n\tconst { publicKey, privateKey } = await generateKeyPair(alg, {\n\t\t...cfg,\n\t\textractable: true\n\t});\n\treturn {\n\t\tpublicWebKey: await exportJWK(publicKey),\n\t\tprivateWebKey: await exportJWK(privateKey),\n\t\talg,\n\t\tcfg\n\t};\n}\n/**\n* Creates a Jwk on the database\n*\n* @param ctx\n* @param options\n* @returns\n*/\nasync function createJwk(ctx, options) {\n\tconst { publicWebKey, privateWebKey, alg, cfg } = await generateExportedKeyPair(options);\n\tconst stringifiedPrivateWebKey = JSON.stringify(privateWebKey);\n\tconst privateKeyEncryptionEnabled = !options?.jwks?.disablePrivateKeyEncryption;\n\tlet jwk = {\n\t\talg,\n\t\t...cfg && \"crv\" in cfg ? { crv: cfg.crv } : {},\n\t\tpublicKey: JSON.stringify(publicWebKey),\n\t\tprivateKey: privateKeyEncryptionEnabled ? JSON.stringify(await symmetricEncrypt({\n\t\t\tkey: ctx.context.secret,\n\t\t\tdata: stringifiedPrivateWebKey\n\t\t})) : stringifiedPrivateWebKey,\n\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t...options?.jwks?.rotationInterval ? { expiresAt: new Date(Date.now() + options.jwks.rotationInterval * 1e3) } : {}\n\t};\n\treturn await getJwksAdapter(ctx.context.adapter, options).createJwk(ctx, jwk);\n}\n\n//#endregion\n//#region src/plugins/jwt/sign.ts\nasync function signJWT(ctx, config) {\n\tconst { options, payload } = config;\n\tconst nowSeconds = Math.floor(Date.now() / 1e3);\n\tconst iat = payload.iat;\n\tlet exp = payload.exp;\n\tconst defaultExp = toExpJWT(options?.jwt?.expirationTime ?? \"15m\", iat ?? nowSeconds);\n\texp = exp ?? defaultExp;\n\tconst nbf = payload.nbf;\n\tconst iss = payload.iss;\n\tconst defaultIss = options?.jwt?.issuer ?? ctx.context.options.baseURL;\n\tconst aud = payload.aud;\n\tconst defaultAud = options?.jwt?.audience ?? ctx.context.options.baseURL;\n\tif (options?.jwt?.sign) {\n\t\tconst jwtPayload = {\n\t\t\t...payload,\n\t\t\tiat,\n\t\t\texp,\n\t\t\tnbf,\n\t\t\tiss: iss ?? defaultIss,\n\t\t\taud: aud ?? defaultAud\n\t\t};\n\t\treturn options.jwt.sign(jwtPayload);\n\t}\n\tlet key = await getJwksAdapter(ctx.context.adapter, options).getLatestKey(ctx);\n\tif (!key || key.expiresAt && key.expiresAt < /* @__PURE__ */ new Date()) key = await createJwk(ctx, options);\n\tlet privateWebKey = !options?.jwks?.disablePrivateKeyEncryption ? await symmetricDecrypt({\n\t\tkey: ctx.context.secret,\n\t\tdata: JSON.parse(key.privateKey)\n\t}).catch(() => {\n\t\tthrow new BetterAuthError(\"Failed to decrypt private key. Make sure the secret currently in use is the same as the one used to encrypt the private key. If you are using a different secret, either clean up your JWKS or disable private key encryption.\");\n\t}) : key.privateKey;\n\tconst alg = key.alg ?? options?.jwks?.keyPairConfig?.alg ?? \"EdDSA\";\n\tconst privateKey = await importJWK(JSON.parse(privateWebKey), alg);\n\tconst jwt$1 = new SignJWT(payload).setProtectedHeader({\n\t\talg,\n\t\tkid: key.id\n\t}).setExpirationTime(exp).setIssuer(iss ?? defaultIss).setAudience(aud ?? defaultAud);\n\tif (iat) jwt$1.setIssuedAt(iat);\n\tif (payload.sub) jwt$1.setSubject(payload.sub);\n\tif (payload.nbf) jwt$1.setNotBefore(payload.nbf);\n\tif (payload.jti) jwt$1.setJti(payload.jti);\n\treturn await jwt$1.sign(privateKey);\n}\nasync function getJwtToken(ctx, options) {\n\tconst payload = !options?.jwt?.definePayload ? ctx.context.session.user : await options?.jwt.definePayload(ctx.context.session);\n\treturn await signJWT(ctx, {\n\t\toptions,\n\t\tpayload: {\n\t\t\tiat: Math.floor(Date.now() / 1e3),\n\t\t\t...payload,\n\t\t\tsub: await options?.jwt?.getSubject?.(ctx.context.session) ?? ctx.context.session.user.id\n\t\t}\n\t});\n}\n\n//#endregion\n//#region src/plugins/jwt/verify.ts\n/**\n* Verify a JWT token using the JWKS public keys\n* Returns the payload if valid, null otherwise\n*/\nasync function verifyJWT(token, options) {\n\tconst ctx = await getCurrentAuthContext();\n\ttry {\n\t\tconst parts = token.split(\".\");\n\t\tif (parts.length !== 3) return null;\n\t\tconst headerStr = new TextDecoder().decode(base64.decode(parts[0]));\n\t\tconst kid = JSON.parse(headerStr).kid;\n\t\tif (!kid) {\n\t\t\tctx.context.logger.debug(\"JWT missing kid in header\");\n\t\t\treturn null;\n\t\t}\n\t\tconst keys = await getJwksAdapter(ctx.context.adapter, options).getAllKeys(ctx);\n\t\tif (!keys || keys.length === 0) {\n\t\t\tctx.context.logger.debug(\"No JWKS keys available\");\n\t\t\treturn null;\n\t\t}\n\t\tconst key = keys.find((k) => k.id === kid);\n\t\tif (!key) {\n\t\t\tctx.context.logger.debug(`No JWKS key found for kid: ${kid}`);\n\t\t\treturn null;\n\t\t}\n\t\tconst { payload } = await jwtVerify(token, await importJWK(JSON.parse(key.publicKey), key.alg ?? options?.jwks?.keyPairConfig?.alg ?? \"EdDSA\"), { issuer: options?.jwt?.issuer ?? ctx.context.options.baseURL });\n\t\tif (!payload.sub || !payload.aud) return null;\n\t\treturn payload;\n\t} catch (error) {\n\t\tctx.context.logger.debug(\"JWT verification failed\", error);\n\t\treturn null;\n\t}\n}\n\n//#endregion\n//#region src/plugins/jwt/index.ts\nconst jwt = (options) => {\n\tif (options?.jwt?.sign && !options.jwks?.remoteUrl) throw new BetterAuthError(\"jwks_config\", \"jwks.remoteUrl must be set when using jwt.sign\");\n\tif (options?.jwks?.remoteUrl && !options.jwks?.keyPairConfig?.alg) throw new BetterAuthError(\"jwks_config\", \"must specify alg when using the oidc plugin and jwks.remoteUrl\");\n\tconst jwksPath = options?.jwks?.jwksPath ?? \"/jwks\";\n\tif (typeof jwksPath !== \"string\" || jwksPath.length === 0 || !jwksPath.startsWith(\"/\") || jwksPath.includes(\"..\")) throw new BetterAuthError(\"jwks_config\", \"jwksPath must be a non-empty string starting with '/' and not contain '..'\");\n\treturn {\n\t\tid: \"jwt\",\n\t\toptions,\n\t\tendpoints: {\n\t\t\tgetJwks: createAuthEndpoint(jwksPath, {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"getJSONWebKeySet\",\n\t\t\t\t\tdescription: \"Get the JSON Web Key Set\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"JSON Web Key Set retrieved successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { keys: {\n\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\tdescription: \"Array of public JSON Web Keys\",\n\t\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\tkid: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Key ID uniquely identifying the key, corresponds to the 'id' from the stored Jwk\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tkty: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Key type (e.g., 'RSA', 'EC', 'OKP')\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\talg: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Algorithm intended for use with the key (e.g., 'EdDSA', 'RS256')\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tuse: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Intended use of the public key (e.g., 'sig' for signature)\",\n\t\t\t\t\t\t\t\t\t\t\tenum: [\"sig\"],\n\t\t\t\t\t\t\t\t\t\t\tnullable: true\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tn: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Modulus for RSA keys (base64url-encoded)\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\te: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Exponent for RSA keys (base64url-encoded)\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tcrv: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Curve name for elliptic curve keys (e.g., 'Ed25519', 'P-256')\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"X coordinate for elliptic curve keys (base64url-encoded)\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\ty: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Y coordinate for elliptic curve keys (base64url-encoded)\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\"kid\",\n\t\t\t\t\t\t\t\t\t\t\"kty\",\n\t\t\t\t\t\t\t\t\t\t\"alg\"\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} },\n\t\t\t\t\t\t\trequired: [\"keys\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (options?.jwks?.remoteUrl) throw new APIError(\"NOT_FOUND\");\n\t\t\t\tconst adapter = getJwksAdapter(ctx.context.adapter, options);\n\t\t\t\tlet keySets = await adapter.getAllKeys(ctx);\n\t\t\t\tif (!keySets || keySets?.length === 0) {\n\t\t\t\t\tawait createJwk(ctx, options);\n\t\t\t\t\tkeySets = await adapter.getAllKeys(ctx);\n\t\t\t\t}\n\t\t\t\tif (!keySets?.length) throw new BetterAuthError(\"No key sets found. Make sure you have a key in your database.\");\n\t\t\t\tconst now = Date.now();\n\t\t\t\tconst gracePeriod = (options?.jwks?.gracePeriod ?? 3600 * 24 * 30) * 1e3;\n\t\t\t\tconst keys = keySets.filter((key) => {\n\t\t\t\t\tif (!key.expiresAt) return true;\n\t\t\t\t\treturn key.expiresAt.getTime() + gracePeriod > now;\n\t\t\t\t});\n\t\t\t\tconst keyPairConfig = options?.jwks?.keyPairConfig;\n\t\t\t\tconst defaultCrv = keyPairConfig ? \"crv\" in keyPairConfig ? keyPairConfig.crv : void 0 : void 0;\n\t\t\t\treturn ctx.json({ keys: keys.map((keySet) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\talg: keySet.alg ?? options?.jwks?.keyPairConfig?.alg ?? \"EdDSA\",\n\t\t\t\t\t\tcrv: keySet.crv ?? defaultCrv,\n\t\t\t\t\t\t...JSON.parse(keySet.publicKey),\n\t\t\t\t\t\tkid: keySet.id\n\t\t\t\t\t};\n\t\t\t\t}) });\n\t\t\t}),\n\t\t\tgetToken: createAuthEndpoint(\"/token\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\trequireHeaders: true,\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"getJSONWebToken\",\n\t\t\t\t\tdescription: \"Get a JWT token\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { token: { type: \"string\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst jwt$1 = await getJwtToken(ctx, options);\n\t\t\t\treturn ctx.json({ token: jwt$1 });\n\t\t\t}),\n\t\t\tsignJWT: createAuthEndpoint(\"/sign-jwt\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tmetadata: {\n\t\t\t\t\tSERVER_ONLY: true,\n\t\t\t\t\t$Infer: { body: {} }\n\t\t\t\t},\n\t\t\t\tbody: z.object({\n\t\t\t\t\tpayload: z.record(z.string(), z.any()),\n\t\t\t\t\toverrideOptions: z.record(z.string(), z.any()).optional()\n\t\t\t\t})\n\t\t\t}, async (c) => {\n\t\t\t\tconst jwt$1 = await signJWT(c, {\n\t\t\t\t\toptions: {\n\t\t\t\t\t\t...options,\n\t\t\t\t\t\t...c.body.overrideOptions\n\t\t\t\t\t},\n\t\t\t\t\tpayload: c.body.payload\n\t\t\t\t});\n\t\t\t\treturn c.json({ token: jwt$1 });\n\t\t\t}),\n\t\t\tverifyJWT: createAuthEndpoint(\"/verify-jwt\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tmetadata: {\n\t\t\t\t\tSERVER_ONLY: true,\n\t\t\t\t\t$Infer: {\n\t\t\t\t\t\tbody: {},\n\t\t\t\t\t\tresponse: {}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tbody: z.object({\n\t\t\t\t\ttoken: z.string(),\n\t\t\t\t\tissuer: z.string().optional()\n\t\t\t\t})\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst overrideOptions = ctx.body.issuer ? {\n\t\t\t\t\t...options,\n\t\t\t\t\tjwt: {\n\t\t\t\t\t\t...options?.jwt,\n\t\t\t\t\t\tissuer: ctx.body.issuer\n\t\t\t\t\t}\n\t\t\t\t} : options;\n\t\t\t\tconst payload = await verifyJWT(ctx.body.token, overrideOptions);\n\t\t\t\treturn ctx.json({ payload });\n\t\t\t})\n\t\t},\n\t\thooks: { after: [{\n\t\t\tmatcher(context) {\n\t\t\t\treturn context.path === \"/get-session\";\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tif (options?.disableSettingJwtHeader) return;\n\t\t\t\tconst session = ctx.context.session || ctx.context.newSession;\n\t\t\t\tif (session && session.session) {\n\t\t\t\t\tconst jwt$1 = await getJwtToken(ctx, options);\n\t\t\t\t\tconst exposedHeaders = ctx.context.responseHeaders?.get(\"access-control-expose-headers\") || \"\";\n\t\t\t\t\tconst headersSet = new Set(exposedHeaders.split(\",\").map((header) => header.trim()).filter(Boolean));\n\t\t\t\t\theadersSet.add(\"set-auth-jwt\");\n\t\t\t\t\tctx.setHeader(\"set-auth-jwt\", jwt$1);\n\t\t\t\t\tctx.setHeader(\"Access-Control-Expose-Headers\", Array.from(headersSet).join(\", \"));\n\t\t\t\t}\n\t\t\t})\n\t\t}] },\n\t\tschema: mergeSchema(schema, options?.schema)\n\t};\n};\n\n//#endregion\nexport { generateExportedKeyPair as a, createJwk as i, verifyJWT as n, getJwtToken as r, jwt as t };"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;AAEA,oCAAoC;AACpC,MAAM,iBAAiB,CAAC,SAAS;IAChC,OAAO;QACN,YAAY,OAAO;YAClB,IAAI,SAAS,SAAS,SAAS,OAAO,MAAM,QAAQ,OAAO,CAAC,OAAO,CAAC;YACpE,OAAO,MAAM,QAAQ,QAAQ,CAAC;gBAAE,OAAO;YAAO;QAC/C;QACA,cAAc,OAAO;YACpB,IAAI,SAAS,SAAS,SAAS,OAAO,CAAC,MAAM,QAAQ,OAAO,CAAC,OAAO,CAAC,IAAI,GAAG,KAAK,CAAC,GAAG,IAAM,EAAE,SAAS,CAAC,OAAO,KAAK,EAAE,SAAS,CAAC,OAAO,GAAG,CAAC,EAAE;YAC5I,OAAO,CAAC,MAAM,QAAQ,QAAQ,CAAC;gBAAE,OAAO;YAAO,EAAE,GAAG,KAAK,CAAC,GAAG,IAAM,EAAE,SAAS,CAAC,OAAO,KAAK,EAAE,SAAS,CAAC,OAAO,GAAG,CAAC,EAAE;QACrH;QACA,WAAW,OAAO,KAAK;YACtB,IAAI,SAAS,SAAS,WAAW,OAAO,MAAM,QAAQ,OAAO,CAAC,SAAS,CAAC,QAAQ;YAChF,OAAO,MAAM,QAAQ,MAAM,CAAC;gBAC3B,OAAO;gBACP,MAAM;oBACL,GAAG,MAAM;oBACT,WAAW,aAAa,GAAG,IAAI;gBAChC;YACD;QACD;IACD;AACD;AAEA,YAAY;AACZ,mCAAmC;AACnC,MAAM,SAAS;IAAE,MAAM;QAAE,QAAQ;YAChC,WAAW;gBACV,MAAM;gBACN,UAAU;YACX;YACA,YAAY;gBACX,MAAM;gBACN,UAAU;YACX;YACA,WAAW;gBACV,MAAM;gBACN,UAAU;YACX;YACA,WAAW;gBACV,MAAM;gBACN,UAAU;YACX;QACD;IAAE;AAAE;AAEJ,YAAY;AACZ,2BAA2B;AAC3B,MAAM,SAAS;AACf,MAAM,OAAO,SAAS;AACtB,MAAM,MAAM,OAAO;AACnB,MAAM,OAAO,MAAM;AACnB,MAAM,OAAO,MAAM;AACnB,MAAM,QAAQ;AACd;;AAEA,GACA,SAAS,SAAS,GAAG;IACpB,MAAM,UAAU,MAAM,IAAI,CAAC;IAC3B,IAAI,CAAC,WAAW,OAAO,CAAC,EAAE,IAAI,OAAO,CAAC,EAAE,EAAE,MAAM,IAAI,UAAU;IAC9D,MAAM,QAAQ,WAAW,OAAO,CAAC,EAAE;IACnC,MAAM,OAAO,OAAO,CAAC,EAAE,CAAC,WAAW;IACnC,IAAI;IACJ,OAAQ;QACP,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACJ,cAAc,KAAK,KAAK,CAAC;YACzB;QACD,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACJ,cAAc,KAAK,KAAK,CAAC,QAAQ;YACjC;QACD,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACJ,cAAc,KAAK,KAAK,CAAC,QAAQ;YACjC;QACD,KAAK;QACL,KAAK;QACL,KAAK;YACJ,cAAc,KAAK,KAAK,CAAC,QAAQ;YACjC;QACD,KAAK;QACL,KAAK;QACL,KAAK;YACJ,cAAc,KAAK,KAAK,CAAC,QAAQ;YACjC;QACD;YACC,cAAc,KAAK,KAAK,CAAC,QAAQ;YACjC;IACF;IACA,IAAI,OAAO,CAAC,EAAE,KAAK,OAAO,OAAO,CAAC,EAAE,KAAK,OAAO,OAAO,CAAC;IACxD,OAAO;AACR;AAEA,YAAY;AACZ,kCAAkC;AAClC;;;;;;;;AAQA,GACA,SAAS,SAAS,cAAc,EAAE,GAAG;IACpC,IAAI,OAAO,mBAAmB,UAAU,OAAO;SAC1C,IAAI,0BAA0B,MAAM,OAAO,KAAK,KAAK,CAAC,eAAe,OAAO,KAAK;SACjF,OAAO,MAAM,SAAS;AAC5B;AACA,eAAe,wBAAwB,OAAO;IAC7C,MAAM,EAAE,GAAG,EAAE,GAAG,KAAK,GAAG,SAAS,MAAM,iBAAiB;QACvD,KAAK;QACL,KAAK;IACN;IACA,MAAM,EAAE,SAAS,EAAE,UAAU,EAAE,GAAG,MAAM,IAAA,uLAAe,EAAC,KAAK;QAC5D,GAAG,GAAG;QACN,aAAa;IACd;IACA,OAAO;QACN,cAAc,MAAM,IAAA,sKAAS,EAAC;QAC9B,eAAe,MAAM,IAAA,sKAAS,EAAC;QAC/B;QACA;IACD;AACD;AACA;;;;;;AAMA,GACA,eAAe,UAAU,GAAG,EAAE,OAAO;IACpC,MAAM,EAAE,YAAY,EAAE,aAAa,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,MAAM,wBAAwB;IAChF,MAAM,2BAA2B,KAAK,SAAS,CAAC;IAChD,MAAM,8BAA8B,CAAC,SAAS,MAAM;IACpD,IAAI,MAAM;QACT;QACA,GAAG,OAAO,SAAS,MAAM;YAAE,KAAK,IAAI,GAAG;QAAC,IAAI,CAAC,CAAC;QAC9C,WAAW,KAAK,SAAS,CAAC;QAC1B,YAAY,8BAA8B,KAAK,SAAS,CAAC,MAAM,IAAA,oKAAgB,EAAC;YAC/E,KAAK,IAAI,OAAO,CAAC,MAAM;YACvB,MAAM;QACP,MAAM;QACN,WAAW,aAAa,GAAG,IAAI;QAC/B,GAAG,SAAS,MAAM,mBAAmB;YAAE,WAAW,IAAI,KAAK,KAAK,GAAG,KAAK,QAAQ,IAAI,CAAC,gBAAgB,GAAG;QAAK,IAAI,CAAC,CAAC;IACpH;IACA,OAAO,MAAM,eAAe,IAAI,OAAO,CAAC,OAAO,EAAE,SAAS,SAAS,CAAC,KAAK;AAC1E;AAEA,YAAY;AACZ,iCAAiC;AACjC,eAAe,QAAQ,GAAG,EAAE,MAAM;IACjC,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,GAAG;IAC7B,MAAM,aAAa,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;IAC3C,MAAM,MAAM,QAAQ,GAAG;IACvB,IAAI,MAAM,QAAQ,GAAG;IACrB,MAAM,aAAa,SAAS,SAAS,KAAK,kBAAkB,OAAO,OAAO;IAC1E,MAAM,OAAO;IACb,MAAM,MAAM,QAAQ,GAAG;IACvB,MAAM,MAAM,QAAQ,GAAG;IACvB,MAAM,aAAa,SAAS,KAAK,UAAU,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO;IACtE,MAAM,MAAM,QAAQ,GAAG;IACvB,MAAM,aAAa,SAAS,KAAK,YAAY,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO;IACxE,IAAI,SAAS,KAAK,MAAM;QACvB,MAAM,aAAa;YAClB,GAAG,OAAO;YACV;YACA;YACA;YACA,KAAK,OAAO;YACZ,KAAK,OAAO;QACb;QACA,OAAO,QAAQ,GAAG,CAAC,IAAI,CAAC;IACzB;IACA,IAAI,MAAM,MAAM,eAAe,IAAI,OAAO,CAAC,OAAO,EAAE,SAAS,YAAY,CAAC;IAC1E,IAAI,CAAC,OAAO,IAAI,SAAS,IAAI,IAAI,SAAS,GAAG,aAAa,GAAG,IAAI,QAAQ,MAAM,MAAM,UAAU,KAAK;IACpG,IAAI,gBAAgB,CAAC,SAAS,MAAM,8BAA8B,MAAM,IAAA,oKAAgB,EAAC;QACxF,KAAK,IAAI,OAAO,CAAC,MAAM;QACvB,MAAM,KAAK,KAAK,CAAC,IAAI,UAAU;IAChC,GAAG,KAAK,CAAC;QACR,MAAM,IAAI,mOAAe,CAAC;IAC3B,KAAK,IAAI,UAAU;IACnB,MAAM,MAAM,IAAI,GAAG,IAAI,SAAS,MAAM,eAAe,OAAO;IAC5D,MAAM,aAAa,MAAM,IAAA,sKAAS,EAAC,KAAK,KAAK,CAAC,gBAAgB;IAC9D,MAAM,QAAQ,IAAI,kKAAO,CAAC,SAAS,kBAAkB,CAAC;QACrD;QACA,KAAK,IAAI,EAAE;IACZ,GAAG,iBAAiB,CAAC,KAAK,SAAS,CAAC,OAAO,YAAY,WAAW,CAAC,OAAO;IAC1E,IAAI,KAAK,MAAM,WAAW,CAAC;IAC3B,IAAI,QAAQ,GAAG,EAAE,MAAM,UAAU,CAAC,QAAQ,GAAG;IAC7C,IAAI,QAAQ,GAAG,EAAE,MAAM,YAAY,CAAC,QAAQ,GAAG;IAC/C,IAAI,QAAQ,GAAG,EAAE,MAAM,MAAM,CAAC,QAAQ,GAAG;IACzC,OAAO,MAAM,MAAM,IAAI,CAAC;AACzB;AACA,eAAe,YAAY,GAAG,EAAE,OAAO;IACtC,MAAM,UAAU,CAAC,SAAS,KAAK,gBAAgB,IAAI,OAAO,CAAC,OAAO,CAAC,IAAI,GAAG,MAAM,SAAS,IAAI,cAAc,IAAI,OAAO,CAAC,OAAO;IAC9H,OAAO,MAAM,QAAQ,KAAK;QACzB;QACA,SAAS;YACR,KAAK,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;YAC7B,GAAG,OAAO;YACV,KAAK,MAAM,SAAS,KAAK,aAAa,IAAI,OAAO,CAAC,OAAO,KAAK,IAAI,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;QAC1F;IACD;AACD;AAEA,YAAY;AACZ,mCAAmC;AACnC;;;AAGA,GACA,eAAe,UAAU,KAAK,EAAE,OAAO;IACtC,MAAM,MAAM,MAAM,IAAA,iPAAqB;IACvC,IAAI;QACH,MAAM,QAAQ,MAAM,KAAK,CAAC;QAC1B,IAAI,MAAM,MAAM,KAAK,GAAG,OAAO;QAC/B,MAAM,YAAY,IAAI,cAAc,MAAM,CAAC,wKAAM,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE;QACjE,MAAM,MAAM,KAAK,KAAK,CAAC,WAAW,GAAG;QACrC,IAAI,CAAC,KAAK;YACT,IAAI,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC;YACzB,OAAO;QACR;QACA,MAAM,OAAO,MAAM,eAAe,IAAI,OAAO,CAAC,OAAO,EAAE,SAAS,UAAU,CAAC;QAC3E,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG;YAC/B,IAAI,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC;YACzB,OAAO;QACR;QACA,MAAM,MAAM,KAAK,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;QACtC,IAAI,CAAC,KAAK;YACT,IAAI,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,2BAA2B,EAAE,KAAK;YAC5D,OAAO;QACR;QACA,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO,MAAM,IAAA,sKAAS,EAAC,KAAK,KAAK,CAAC,IAAI,SAAS,GAAG,IAAI,GAAG,IAAI,SAAS,MAAM,eAAe,OAAO,UAAU;YAAE,QAAQ,SAAS,KAAK,UAAU,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO;QAAC;QAC9M,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,GAAG,EAAE,OAAO;QACzC,OAAO;IACR,EAAE,OAAO,OAAO;QACf,IAAI,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,2BAA2B;QACpD,OAAO;IACR;AACD;AAEA,YAAY;AACZ,kCAAkC;AAClC,MAAM,MAAM,CAAC;IACZ,IAAI,SAAS,KAAK,QAAQ,CAAC,QAAQ,IAAI,EAAE,WAAW,MAAM,IAAI,mOAAe,CAAC,eAAe;IAC7F,IAAI,SAAS,MAAM,aAAa,CAAC,QAAQ,IAAI,EAAE,eAAe,KAAK,MAAM,IAAI,mOAAe,CAAC,eAAe;IAC5G,MAAM,WAAW,SAAS,MAAM,YAAY;IAC5C,IAAI,OAAO,aAAa,YAAY,SAAS,MAAM,KAAK,KAAK,CAAC,SAAS,UAAU,CAAC,QAAQ,SAAS,QAAQ,CAAC,OAAO,MAAM,IAAI,mOAAe,CAAC,eAAe;IAC5J,OAAO;QACN,IAAI;QACJ;QACA,WAAW;YACV,SAAS,IAAA,yLAAkB,EAAC,UAAU;gBACrC,QAAQ;gBACR,UAAU;oBAAE,SAAS;wBACpB,aAAa;wBACb,aAAa;wBACb,WAAW;4BAAE,OAAO;gCACnB,aAAa;gCACb,SAAS;oCAAE,oBAAoB;wCAAE,QAAQ;4CACxC,MAAM;4CACN,YAAY;gDAAE,MAAM;oDACnB,MAAM;oDACN,aAAa;oDACb,OAAO;wDACN,MAAM;wDACN,YAAY;4DACX,KAAK;gEACJ,MAAM;gEACN,aAAa;4DACd;4DACA,KAAK;gEACJ,MAAM;gEACN,aAAa;4DACd;4DACA,KAAK;gEACJ,MAAM;gEACN,aAAa;4DACd;4DACA,KAAK;gEACJ,MAAM;gEACN,aAAa;gEACb,MAAM;oEAAC;iEAAM;gEACb,UAAU;4DACX;4DACA,GAAG;gEACF,MAAM;gEACN,aAAa;gEACb,UAAU;4DACX;4DACA,GAAG;gEACF,MAAM;gEACN,aAAa;gEACb,UAAU;4DACX;4DACA,KAAK;gEACJ,MAAM;gEACN,aAAa;gEACb,UAAU;4DACX;4DACA,GAAG;gEACF,MAAM;gEACN,aAAa;gEACb,UAAU;4DACX;4DACA,GAAG;gEACF,MAAM;gEACN,aAAa;gEACb,UAAU;4DACX;wDACD;wDACA,UAAU;4DACT;4DACA;4DACA;yDACA;oDACF;gDACD;4CAAE;4CACF,UAAU;gDAAC;6CAAO;wCACnB;oCAAE;gCAAE;4BACL;wBAAE;oBACH;gBAAE;YACH,GAAG,OAAO;gBACT,IAAI,SAAS,MAAM,WAAW,MAAM,IAAI,uLAAQ,CAAC;gBACjD,MAAM,UAAU,eAAe,IAAI,OAAO,CAAC,OAAO,EAAE;gBACpD,IAAI,UAAU,MAAM,QAAQ,UAAU,CAAC;gBACvC,IAAI,CAAC,WAAW,SAAS,WAAW,GAAG;oBACtC,MAAM,UAAU,KAAK;oBACrB,UAAU,MAAM,QAAQ,UAAU,CAAC;gBACpC;gBACA,IAAI,CAAC,SAAS,QAAQ,MAAM,IAAI,mOAAe,CAAC;gBAChD,MAAM,MAAM,KAAK,GAAG;gBACpB,MAAM,cAAc,CAAC,SAAS,MAAM,eAAe,OAAO,KAAK,EAAE,IAAI;gBACrE,MAAM,OAAO,QAAQ,MAAM,CAAC,CAAC;oBAC5B,IAAI,CAAC,IAAI,SAAS,EAAE,OAAO;oBAC3B,OAAO,IAAI,SAAS,CAAC,OAAO,KAAK,cAAc;gBAChD;gBACA,MAAM,gBAAgB,SAAS,MAAM;gBACrC,MAAM,aAAa,gBAAgB,SAAS,gBAAgB,cAAc,GAAG,GAAG,KAAK,IAAI,KAAK;gBAC9F,OAAO,IAAI,IAAI,CAAC;oBAAE,MAAM,KAAK,GAAG,CAAC,CAAC;wBACjC,OAAO;4BACN,KAAK,OAAO,GAAG,IAAI,SAAS,MAAM,eAAe,OAAO;4BACxD,KAAK,OAAO,GAAG,IAAI;4BACnB,GAAG,KAAK,KAAK,CAAC,OAAO,SAAS,CAAC;4BAC/B,KAAK,OAAO,EAAE;wBACf;oBACD;gBAAG;YACJ;YACA,UAAU,IAAA,yLAAkB,EAAC,UAAU;gBACtC,QAAQ;gBACR,gBAAgB;gBAChB,KAAK;oBAAC,sKAAiB;iBAAC;gBACxB,UAAU;oBAAE,SAAS;wBACpB,aAAa;wBACb,aAAa;wBACb,WAAW;4BAAE,KAAK;gCACjB,aAAa;gCACb,SAAS;oCAAE,oBAAoB;wCAAE,QAAQ;4CACxC,MAAM;4CACN,YAAY;gDAAE,OAAO;oDAAE,MAAM;gDAAS;4CAAE;wCACzC;oCAAE;gCAAE;4BACL;wBAAE;oBACH;gBAAE;YACH,GAAG,OAAO;gBACT,MAAM,QAAQ,MAAM,YAAY,KAAK;gBACrC,OAAO,IAAI,IAAI,CAAC;oBAAE,OAAO;gBAAM;YAChC;YACA,SAAS,IAAA,yLAAkB,EAAC,aAAa;gBACxC,QAAQ;gBACR,UAAU;oBACT,aAAa;oBACb,QAAQ;wBAAE,MAAM,CAAC;oBAAE;gBACpB;gBACA,MAAM,2JAAQ,CAAC;oBACd,SAAS,2JAAQ,CAAC,2JAAQ,IAAI,wJAAK;oBACnC,iBAAiB,2JAAQ,CAAC,2JAAQ,IAAI,wJAAK,IAAI,QAAQ;gBACxD;YACD,GAAG,OAAO;gBACT,MAAM,QAAQ,MAAM,QAAQ,GAAG;oBAC9B,SAAS;wBACR,GAAG,OAAO;wBACV,GAAG,EAAE,IAAI,CAAC,eAAe;oBAC1B;oBACA,SAAS,EAAE,IAAI,CAAC,OAAO;gBACxB;gBACA,OAAO,EAAE,IAAI,CAAC;oBAAE,OAAO;gBAAM;YAC9B;YACA,WAAW,IAAA,yLAAkB,EAAC,eAAe;gBAC5C,QAAQ;gBACR,UAAU;oBACT,aAAa;oBACb,QAAQ;wBACP,MAAM,CAAC;wBACP,UAAU,CAAC;oBACZ;gBACD;gBACA,MAAM,2JAAQ,CAAC;oBACd,OAAO,2JAAQ;oBACf,QAAQ,2JAAQ,GAAG,QAAQ;gBAC5B;YACD,GAAG,OAAO;gBACT,MAAM,kBAAkB,IAAI,IAAI,CAAC,MAAM,GAAG;oBACzC,GAAG,OAAO;oBACV,KAAK;wBACJ,GAAG,SAAS,GAAG;wBACf,QAAQ,IAAI,IAAI,CAAC,MAAM;oBACxB;gBACD,IAAI;gBACJ,MAAM,UAAU,MAAM,UAAU,IAAI,IAAI,CAAC,KAAK,EAAE;gBAChD,OAAO,IAAI,IAAI,CAAC;oBAAE;gBAAQ;YAC3B;QACD;QACA,OAAO;YAAE,OAAO;gBAAC;oBAChB,SAAQ,OAAO;wBACd,OAAO,QAAQ,IAAI,KAAK;oBACzB;oBACA,SAAS,IAAA,2LAAoB,EAAC,OAAO;wBACpC,IAAI,SAAS,yBAAyB;wBACtC,MAAM,UAAU,IAAI,OAAO,CAAC,OAAO,IAAI,IAAI,OAAO,CAAC,UAAU;wBAC7D,IAAI,WAAW,QAAQ,OAAO,EAAE;4BAC/B,MAAM,QAAQ,MAAM,YAAY,KAAK;4BACrC,MAAM,iBAAiB,IAAI,OAAO,CAAC,eAAe,EAAE,IAAI,oCAAoC;4BAC5F,MAAM,aAAa,IAAI,IAAI,eAAe,KAAK,CAAC,KAAK,GAAG,CAAC,CAAC,SAAW,OAAO,IAAI,IAAI,MAAM,CAAC;4BAC3F,WAAW,GAAG,CAAC;4BACf,IAAI,SAAS,CAAC,gBAAgB;4BAC9B,IAAI,SAAS,CAAC,iCAAiC,MAAM,IAAI,CAAC,YAAY,IAAI,CAAC;wBAC5E;oBACD;gBACD;aAAE;QAAC;QACH,QAAQ,IAAA,oKAAW,EAAC,QAAQ,SAAS;IACtC;AACD","ignoreList":[0]}},
    {"offset": {"line": 7677, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/oidc-provider-B9SsN23J.mjs"],"sourcesContent":["import { n as symmetricEncrypt, r as generateRandomString, t as symmetricDecrypt } from \"./crypto-CFUhAR9W.mjs\";\nimport { t as mergeSchema } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as APIError$1 } from \"./api-CkmycQ2x.mjs\";\nimport { l as parseSetCookieHeader } from \"./cookies-D72PbWdz.mjs\";\nimport { r as getSessionFromCtx, u as sessionMiddleware } from \"./session-AaRl3_x-.mjs\";\nimport { n as verifyJWT, r as getJwtToken } from \"./jwt-Ar1sciI2.mjs\";\nimport { getCurrentAuthContext } from \"@better-auth/core/context\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport { SignJWT, jwtVerify } from \"jose\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\nimport { base64, base64Url } from \"@better-auth/utils/base64\";\n\n//#region src/plugins/oidc-provider/error.ts\nvar OIDCProviderError = class extends APIError {};\nvar InvalidRequest = class extends OIDCProviderError {\n\tconstructor(error_description, error_detail) {\n\t\tsuper(\"BAD_REQUEST\", {\n\t\t\tmessage: \"invalid_request\",\n\t\t\terror_description,\n\t\t\terror_detail\n\t\t});\n\t}\n};\n\n//#endregion\n//#region src/plugins/oidc-provider/utils/prompt.ts\n/**\n* Parse space-separated prompt string into a set of prompts\n*\n* @param prompt\n*/\nfunction parsePrompt(prompt) {\n\tconst prompts = prompt.split(\" \").map((p) => p.trim());\n\tconst set = /* @__PURE__ */ new Set();\n\tfor (const p of prompts) if (p === \"login\" || p === \"consent\" || p === \"select_account\" || p === \"none\") set.add(p);\n\tif (set.has(\"none\") && set.size > 1) throw new InvalidRequest(\"prompt none must only be used alone\");\n\treturn new Set(set);\n}\n\n//#endregion\n//#region src/plugins/oidc-provider/authorize.ts\nfunction formatErrorURL(url, error, description) {\n\treturn `${url.includes(\"?\") ? \"&\" : \"?\"}error=${error}&error_description=${description}`;\n}\nfunction getErrorURL(ctx, error, description) {\n\treturn formatErrorURL(ctx.context.options.onAPIError?.errorURL || `${ctx.context.baseURL}/error`, error, description);\n}\nasync function authorize(ctx, options) {\n\tconst handleRedirect = (url) => {\n\t\tif (ctx.request?.headers.get(\"sec-fetch-mode\") === \"cors\") return ctx.json({\n\t\t\tredirect: true,\n\t\t\turl\n\t\t});\n\t\telse throw ctx.redirect(url);\n\t};\n\tconst opts = {\n\t\tcodeExpiresIn: 600,\n\t\tdefaultScope: \"openid\",\n\t\t...options,\n\t\tscopes: [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\",\n\t\t\t...options?.scopes || []\n\t\t]\n\t};\n\tif (!ctx.request) throw new APIError(\"UNAUTHORIZED\", {\n\t\terror_description: \"request not found\",\n\t\terror: \"invalid_request\"\n\t});\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session) {\n\t\tconst query$1 = ctx.query;\n\t\tif (parsePrompt(query$1.prompt ?? \"\").has(\"none\") && query$1.redirect_uri) return handleRedirect(formatErrorURL(query$1.redirect_uri, \"login_required\", \"Authentication required but prompt is none\"));\n\t\t/**\n\t\t* If the user is not logged in, we need to redirect them to the\n\t\t* login page.\n\t\t*/\n\t\tawait ctx.setSignedCookie(\"oidc_login_prompt\", JSON.stringify(ctx.query), ctx.context.secret, {\n\t\t\tmaxAge: 600,\n\t\t\tpath: \"/\",\n\t\t\tsameSite: \"lax\"\n\t\t});\n\t\tconst queryFromURL = ctx.request.url?.split(\"?\")[1];\n\t\treturn handleRedirect(`${options.loginPage}?${queryFromURL}`);\n\t}\n\tconst query = ctx.query;\n\tif (!query.client_id) {\n\t\tconst errorURL = getErrorURL(ctx, \"invalid_client\", \"client_id is required\");\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\tif (!query.response_type) {\n\t\tconst errorURL = getErrorURL(ctx, \"invalid_request\", \"response_type is required\");\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\tconst client = await getClient(ctx.query.client_id, options.trustedClients || []);\n\tif (!client) {\n\t\tconst errorURL = getErrorURL(ctx, \"invalid_client\", \"client_id is required\");\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\tconst redirectURI = client.redirectUrls.find((url) => url === ctx.query.redirect_uri);\n\tif (!redirectURI || !query.redirect_uri)\n /**\n\t* show UI error here warning the user that the redirect URI is invalid\n\t*/\n\tthrow new APIError(\"BAD_REQUEST\", { message: \"Invalid redirect URI\" });\n\tif (client.disabled) {\n\t\tconst errorURL = getErrorURL(ctx, \"client_disabled\", \"client is disabled\");\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\tif (query.response_type !== \"code\") {\n\t\tconst errorURL = getErrorURL(ctx, \"unsupported_response_type\", \"unsupported response type\");\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\tconst requestScope = query.scope?.split(\" \").filter((s) => s) || opts.defaultScope.split(\" \");\n\tconst invalidScopes = requestScope.filter((scope) => {\n\t\treturn !opts.scopes.includes(scope);\n\t});\n\tif (invalidScopes.length) return handleRedirect(formatErrorURL(query.redirect_uri, \"invalid_scope\", `The following scopes are invalid: ${invalidScopes.join(\", \")}`));\n\tif ((!query.code_challenge || !query.code_challenge_method) && options.requirePKCE) return handleRedirect(formatErrorURL(query.redirect_uri, \"invalid_request\", \"pkce is required\"));\n\tif (!query.code_challenge_method) query.code_challenge_method = \"plain\";\n\tif (![\"s256\", options.allowPlainCodeChallengeMethod ? \"plain\" : \"s256\"].includes(query.code_challenge_method?.toLowerCase() || \"\")) return handleRedirect(formatErrorURL(query.redirect_uri, \"invalid_request\", \"invalid code_challenge method\"));\n\tconst code = generateRandomString(32, \"a-z\", \"A-Z\", \"0-9\");\n\tconst codeExpiresInMs = opts.codeExpiresIn * 1e3;\n\tconst expiresAt = new Date(Date.now() + codeExpiresInMs);\n\tconst skipConsentForTrustedClient = client.skipConsent;\n\tconst hasAlreadyConsented = await ctx.context.adapter.findOne({\n\t\tmodel: \"oauthConsent\",\n\t\twhere: [{\n\t\t\tfield: \"clientId\",\n\t\t\tvalue: client.clientId\n\t\t}, {\n\t\t\tfield: \"userId\",\n\t\t\tvalue: session.user.id\n\t\t}]\n\t}).then((res) => {\n\t\tif (!res?.consentGiven) return false;\n\t\tconst consentedScopes = res.scopes ? res.scopes.split(\" \") : [];\n\t\treturn requestScope.every((scope) => consentedScopes.includes(scope));\n\t});\n\tconst promptSet = parsePrompt(query.prompt ?? \"\");\n\tif (promptSet.has(\"none\")) {\n\t\tif (!skipConsentForTrustedClient && !hasAlreadyConsented) return handleRedirect(formatErrorURL(query.redirect_uri, \"consent_required\", \"Consent required but prompt is none\"));\n\t}\n\tlet requireLogin = promptSet.has(\"login\");\n\tif (query.max_age !== void 0) {\n\t\tconst maxAge = Number(query.max_age);\n\t\tif (Number.isInteger(maxAge) && maxAge >= 0) {\n\t\t\tif ((Date.now() - new Date(session.session.createdAt).getTime()) / 1e3 > maxAge) requireLogin = true;\n\t\t}\n\t}\n\tconst requireConsent = !skipConsentForTrustedClient && (!hasAlreadyConsented || promptSet.has(\"consent\"));\n\ttry {\n\t\t/**\n\t\t* Save the code in the database\n\t\t*/\n\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\tvalue: JSON.stringify({\n\t\t\t\tclientId: client.clientId,\n\t\t\t\tredirectURI: query.redirect_uri,\n\t\t\t\tscope: requestScope,\n\t\t\t\tuserId: session.user.id,\n\t\t\t\tauthTime: new Date(session.session.createdAt).getTime(),\n\t\t\t\trequireConsent,\n\t\t\t\tstate: requireConsent ? query.state : null,\n\t\t\t\tcodeChallenge: query.code_challenge,\n\t\t\t\tcodeChallengeMethod: query.code_challenge_method,\n\t\t\t\tnonce: query.nonce\n\t\t\t}),\n\t\t\tidentifier: code,\n\t\t\texpiresAt\n\t\t});\n\t} catch (e) {\n\t\treturn handleRedirect(formatErrorURL(query.redirect_uri, \"server_error\", \"An error occurred while processing the request\"));\n\t}\n\tif (requireLogin) {\n\t\tawait ctx.setSignedCookie(\"oidc_login_prompt\", JSON.stringify(ctx.query), ctx.context.secret, {\n\t\t\tmaxAge: 600,\n\t\t\tpath: \"/\",\n\t\t\tsameSite: \"lax\"\n\t\t});\n\t\tawait ctx.setSignedCookie(\"oidc_consent_prompt\", code, ctx.context.secret, {\n\t\t\tmaxAge: 600,\n\t\t\tpath: \"/\",\n\t\t\tsameSite: \"lax\"\n\t\t});\n\t\treturn handleRedirect(`${options.loginPage}?${new URLSearchParams({\n\t\t\tclient_id: client.clientId,\n\t\t\tcode,\n\t\t\tstate: query.state\n\t\t}).toString()}`);\n\t}\n\tif (!requireConsent) {\n\t\tconst redirectURIWithCode = new URL(redirectURI);\n\t\tredirectURIWithCode.searchParams.set(\"code\", code);\n\t\tredirectURIWithCode.searchParams.set(\"state\", ctx.query.state);\n\t\treturn handleRedirect(redirectURIWithCode.toString());\n\t}\n\tif (options?.consentPage) {\n\t\tawait ctx.setSignedCookie(\"oidc_consent_prompt\", code, ctx.context.secret, {\n\t\t\tmaxAge: 600,\n\t\t\tpath: \"/\",\n\t\t\tsameSite: \"lax\"\n\t\t});\n\t\tconst urlParams = new URLSearchParams();\n\t\turlParams.set(\"consent_code\", code);\n\t\turlParams.set(\"client_id\", client.clientId);\n\t\turlParams.set(\"scope\", requestScope.join(\" \"));\n\t\treturn handleRedirect(`${options.consentPage}?${urlParams.toString()}`);\n\t}\n\tconst htmlFn = options?.getConsentHTML;\n\tif (!htmlFn) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: \"No consent page provided\" });\n\treturn new Response(htmlFn({\n\t\tscopes: requestScope,\n\t\tclientMetadata: client.metadata,\n\t\tclientIcon: client?.icon,\n\t\tclientId: client.clientId,\n\t\tclientName: client.name,\n\t\tcode\n\t}), { headers: { \"content-type\": \"text/html\" } });\n}\n\n//#endregion\n//#region src/plugins/oidc-provider/schema.ts\nconst oAuthApplicationSchema = z.object({\n\tclientId: z.string(),\n\tclientSecret: z.string().optional(),\n\ttype: z.enum([\n\t\t\"web\",\n\t\t\"native\",\n\t\t\"user-agent-based\",\n\t\t\"public\"\n\t]),\n\tname: z.string(),\n\ticon: z.string().optional(),\n\tmetadata: z.string().optional(),\n\tdisabled: z.boolean().optional().default(false),\n\tredirectUrls: z.string(),\n\tuserId: z.string().optional(),\n\tcreatedAt: z.date(),\n\tupdatedAt: z.date()\n});\nconst schema = {\n\toauthApplication: {\n\t\tmodelName: \"oauthApplication\",\n\t\tfields: {\n\t\t\tname: { type: \"string\" },\n\t\t\ticon: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false\n\t\t\t},\n\t\t\tmetadata: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false\n\t\t\t},\n\t\t\tclientId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tunique: true\n\t\t\t},\n\t\t\tclientSecret: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false\n\t\t\t},\n\t\t\tredirectUrls: { type: \"string\" },\n\t\t\ttype: { type: \"string\" },\n\t\t\tdisabled: {\n\t\t\t\ttype: \"boolean\",\n\t\t\t\trequired: false,\n\t\t\t\tdefaultValue: false\n\t\t\t},\n\t\t\tuserId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tonDelete: \"cascade\"\n\t\t\t\t},\n\t\t\t\tindex: true\n\t\t\t},\n\t\t\tcreatedAt: { type: \"date\" },\n\t\t\tupdatedAt: { type: \"date\" }\n\t\t}\n\t},\n\toauthAccessToken: {\n\t\tmodelName: \"oauthAccessToken\",\n\t\tfields: {\n\t\t\taccessToken: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tunique: true\n\t\t\t},\n\t\t\trefreshToken: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tunique: true\n\t\t\t},\n\t\t\taccessTokenExpiresAt: { type: \"date\" },\n\t\t\trefreshTokenExpiresAt: { type: \"date\" },\n\t\t\tclientId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"oauthApplication\",\n\t\t\t\t\tfield: \"clientId\",\n\t\t\t\t\tonDelete: \"cascade\"\n\t\t\t\t},\n\t\t\t\tindex: true\n\t\t\t},\n\t\t\tuserId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tonDelete: \"cascade\"\n\t\t\t\t},\n\t\t\t\tindex: true\n\t\t\t},\n\t\t\tscopes: { type: \"string\" },\n\t\t\tcreatedAt: { type: \"date\" },\n\t\t\tupdatedAt: { type: \"date\" }\n\t\t}\n\t},\n\toauthConsent: {\n\t\tmodelName: \"oauthConsent\",\n\t\tfields: {\n\t\t\tclientId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"oauthApplication\",\n\t\t\t\t\tfield: \"clientId\",\n\t\t\t\t\tonDelete: \"cascade\"\n\t\t\t\t},\n\t\t\t\tindex: true\n\t\t\t},\n\t\t\tuserId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tonDelete: \"cascade\"\n\t\t\t\t},\n\t\t\t\tindex: true\n\t\t\t},\n\t\t\tscopes: { type: \"string\" },\n\t\t\tcreatedAt: { type: \"date\" },\n\t\t\tupdatedAt: { type: \"date\" },\n\t\t\tconsentGiven: { type: \"boolean\" }\n\t\t}\n\t}\n};\n\n//#endregion\n//#region src/plugins/oidc-provider/utils.ts\n/**\n* Default client secret hasher using SHA-256\n*/\nconst defaultClientSecretHasher = async (clientSecret) => {\n\tconst hash = await createHash(\"SHA-256\").digest(new TextEncoder().encode(clientSecret));\n\treturn base64Url.encode(new Uint8Array(hash), { padding: false });\n};\n\n//#endregion\n//#region src/plugins/oidc-provider/index.ts\nconst getJwtPlugin = (ctx) => {\n\treturn ctx.context.options.plugins?.find((plugin) => plugin.id === \"jwt\");\n};\n/**\n* Get a client by ID, checking trusted clients first, then database\n*/\nasync function getClient(clientId, trustedClients = []) {\n\tconst { context: { adapter } } = await getCurrentAuthContext();\n\tconst trustedClient = trustedClients.find((client) => client.clientId === clientId);\n\tif (trustedClient) return trustedClient;\n\treturn adapter.findOne({\n\t\tmodel: \"oauthApplication\",\n\t\twhere: [{\n\t\t\tfield: \"clientId\",\n\t\t\tvalue: clientId\n\t\t}]\n\t}).then((res) => {\n\t\tif (!res) return null;\n\t\treturn {\n\t\t\tclientId: res.clientId,\n\t\t\tclientSecret: res.clientSecret,\n\t\t\ttype: res.type,\n\t\t\tname: res.name,\n\t\t\ticon: res.icon,\n\t\t\tdisabled: res.disabled,\n\t\t\tredirectUrls: (res.redirectUrls ?? \"\").split(\",\"),\n\t\t\tmetadata: res.metadata ? JSON.parse(res.metadata) : {}\n\t\t};\n\t});\n}\nconst getMetadata = (ctx, options) => {\n\tconst jwtPlugin = getJwtPlugin(ctx);\n\tconst issuer = jwtPlugin && jwtPlugin.options?.jwt && jwtPlugin.options.jwt.issuer ? jwtPlugin.options.jwt.issuer : ctx.context.options.baseURL;\n\tconst baseURL = ctx.context.baseURL;\n\tconst supportedAlgs = options?.useJWTPlugin ? [\n\t\t\"RS256\",\n\t\t\"EdDSA\",\n\t\t\"none\"\n\t] : [\"HS256\", \"none\"];\n\treturn {\n\t\tissuer,\n\t\tauthorization_endpoint: `${baseURL}/oauth2/authorize`,\n\t\ttoken_endpoint: `${baseURL}/oauth2/token`,\n\t\tuserinfo_endpoint: `${baseURL}/oauth2/userinfo`,\n\t\tjwks_uri: `${baseURL}/jwks`,\n\t\tregistration_endpoint: `${baseURL}/oauth2/register`,\n\t\tend_session_endpoint: `${baseURL}/oauth2/endsession`,\n\t\tscopes_supported: [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\"\n\t\t],\n\t\tresponse_types_supported: [\"code\"],\n\t\tresponse_modes_supported: [\"query\"],\n\t\tgrant_types_supported: [\"authorization_code\", \"refresh_token\"],\n\t\tacr_values_supported: [\"urn:mace:incommon:iap:silver\", \"urn:mace:incommon:iap:bronze\"],\n\t\tsubject_types_supported: [\"public\"],\n\t\tid_token_signing_alg_values_supported: supportedAlgs,\n\t\ttoken_endpoint_auth_methods_supported: [\n\t\t\t\"client_secret_basic\",\n\t\t\t\"client_secret_post\",\n\t\t\t\"none\"\n\t\t],\n\t\tcode_challenge_methods_supported: [\"S256\"],\n\t\tclaims_supported: [\n\t\t\t\"sub\",\n\t\t\t\"iss\",\n\t\t\t\"aud\",\n\t\t\t\"exp\",\n\t\t\t\"nbf\",\n\t\t\t\"iat\",\n\t\t\t\"jti\",\n\t\t\t\"email\",\n\t\t\t\"email_verified\",\n\t\t\t\"name\"\n\t\t],\n\t\t...options?.metadata\n\t};\n};\n/**\n* OpenID Connect (OIDC) plugin for Better Auth. This plugin implements the\n* authorization code flow and the token exchange flow. It also implements the\n* userinfo endpoint.\n*\n* @param options - The options for the OIDC plugin.\n* @returns A Better Auth plugin.\n*/\nconst oidcProvider = (options) => {\n\tconst modelName = {\n\t\toauthClient: \"oauthApplication\",\n\t\toauthAccessToken: \"oauthAccessToken\",\n\t\toauthConsent: \"oauthConsent\"\n\t};\n\tconst opts = {\n\t\tcodeExpiresIn: 600,\n\t\tdefaultScope: \"openid\",\n\t\taccessTokenExpiresIn: 3600,\n\t\trefreshTokenExpiresIn: 604800,\n\t\tallowPlainCodeChallengeMethod: true,\n\t\tstoreClientSecret: \"plain\",\n\t\t...options,\n\t\tscopes: [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\",\n\t\t\t...options?.scopes || []\n\t\t]\n\t};\n\tconst trustedClients = options.trustedClients || [];\n\t/**\n\t* Store client secret according to the configured storage method\n\t*/\n\tasync function storeClientSecret(ctx, clientSecret) {\n\t\tif (opts.storeClientSecret === \"encrypted\") return await symmetricEncrypt({\n\t\t\tkey: ctx.context.secret,\n\t\t\tdata: clientSecret\n\t\t});\n\t\tif (opts.storeClientSecret === \"hashed\") return await defaultClientSecretHasher(clientSecret);\n\t\tif (typeof opts.storeClientSecret === \"object\" && \"hash\" in opts.storeClientSecret) return await opts.storeClientSecret.hash(clientSecret);\n\t\tif (typeof opts.storeClientSecret === \"object\" && \"encrypt\" in opts.storeClientSecret) return await opts.storeClientSecret.encrypt(clientSecret);\n\t\treturn clientSecret;\n\t}\n\t/**\n\t* Verify stored client secret against provided client secret\n\t*/\n\tasync function verifyStoredClientSecret(ctx, storedClientSecret, clientSecret) {\n\t\tif (opts.storeClientSecret === \"encrypted\") return await symmetricDecrypt({\n\t\t\tkey: ctx.context.secret,\n\t\t\tdata: storedClientSecret\n\t\t}) === clientSecret;\n\t\tif (opts.storeClientSecret === \"hashed\") return await defaultClientSecretHasher(clientSecret) === storedClientSecret;\n\t\tif (typeof opts.storeClientSecret === \"object\" && \"hash\" in opts.storeClientSecret) return await opts.storeClientSecret.hash(clientSecret) === storedClientSecret;\n\t\tif (typeof opts.storeClientSecret === \"object\" && \"decrypt\" in opts.storeClientSecret) return await opts.storeClientSecret.decrypt(storedClientSecret) === clientSecret;\n\t\treturn clientSecret === storedClientSecret;\n\t}\n\treturn {\n\t\tid: \"oidc\",\n\t\thooks: { after: [{\n\t\t\tmatcher() {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst loginPromptCookie = await ctx.getSignedCookie(\"oidc_login_prompt\", ctx.context.secret);\n\t\t\t\tconst cookieName = ctx.context.authCookies.sessionToken.name;\n\t\t\t\tconst parsedSetCookieHeader = parseSetCookieHeader(ctx.context.responseHeaders?.get(\"set-cookie\") || \"\");\n\t\t\t\tconst hasSessionToken = parsedSetCookieHeader.has(cookieName);\n\t\t\t\tif (!loginPromptCookie || !hasSessionToken) return;\n\t\t\t\tctx.setCookie(\"oidc_login_prompt\", \"\", { maxAge: 0 });\n\t\t\t\tconst sessionToken = (parsedSetCookieHeader.get(cookieName)?.value)?.split(\".\")[0];\n\t\t\t\tif (!sessionToken) return;\n\t\t\t\tconst session = await ctx.context.internalAdapter.findSession(sessionToken) || ctx.context.newSession;\n\t\t\t\tif (!session) return;\n\t\t\t\tctx.query = JSON.parse(loginPromptCookie);\n\t\t\t\tconst promptSet = parsePrompt(String(ctx.query?.prompt));\n\t\t\t\tif (promptSet.has(\"login\")) {\n\t\t\t\t\tconst newPromptSet = new Set(promptSet);\n\t\t\t\t\tnewPromptSet.delete(\"login\");\n\t\t\t\t\tctx.query = {\n\t\t\t\t\t\t...ctx.query,\n\t\t\t\t\t\tprompt: Array.from(newPromptSet).join(\" \")\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tctx.context.session = session;\n\t\t\t\treturn await authorize(ctx, opts);\n\t\t\t})\n\t\t}] },\n\t\tendpoints: {\n\t\t\tgetOpenIdConfig: createAuthEndpoint(\"/.well-known/openid-configuration\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\toperationId: \"getOpenIdConfig\",\n\t\t\t\tmetadata: { isAction: false }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst metadata = getMetadata(ctx, options);\n\t\t\t\treturn ctx.json(metadata);\n\t\t\t}),\n\t\t\toAuth2authorize: createAuthEndpoint(\"/oauth2/authorize\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\toperationId: \"oauth2Authorize\",\n\t\t\t\tquery: z.record(z.string(), z.any()),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Authorize an OAuth2 request\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"Authorization response generated successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\tdescription: \"Authorization response, contents depend on the authorize function implementation\"\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\treturn authorize(ctx, opts);\n\t\t\t}),\n\t\t\toAuthConsent: createAuthEndpoint(\"/oauth2/consent\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\toperationId: \"oauth2Consent\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\taccept: z.boolean(),\n\t\t\t\t\tconsent_code: z.string().optional().nullish()\n\t\t\t\t}),\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Handle OAuth2 consent. Supports both URL parameter-based flows (consent_code in body) and cookie-based flows (signed cookie).\",\n\t\t\t\t\trequestBody: {\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\taccept: {\n\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\tdescription: \"Whether the user accepts or denies the consent request\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tconsent_code: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"The consent code from the authorization request. Optional if using cookie-based flow.\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\"accept\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t},\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"Consent processed successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { redirectURI: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\tdescription: \"The URI to redirect to, either with an authorization code or an error\"\n\t\t\t\t\t\t\t} },\n\t\t\t\t\t\t\trequired: [\"redirectURI\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tlet consentCode = ctx.body.consent_code || null;\n\t\t\t\tif (!consentCode) {\n\t\t\t\t\tconst cookieValue = await ctx.getSignedCookie(\"oidc_consent_prompt\", ctx.context.secret);\n\t\t\t\t\tif (cookieValue) consentCode = cookieValue;\n\t\t\t\t}\n\t\t\t\tif (!consentCode) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"consent_code is required (either in body or cookie)\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tconst verification = await ctx.context.internalAdapter.findVerificationValue(consentCode);\n\t\t\t\tif (!verification) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"Invalid code\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif (verification.expiresAt < /* @__PURE__ */ new Date()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"Code expired\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tctx.setCookie(\"oidc_consent_prompt\", \"\", { maxAge: 0 });\n\t\t\t\tconst value = JSON.parse(verification.value);\n\t\t\t\tif (!value.requireConsent) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"Consent not required\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif (!ctx.body.accept) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verification.id);\n\t\t\t\t\treturn ctx.json({ redirectURI: `${value.redirectURI}?error=access_denied&error_description=User denied access` });\n\t\t\t\t}\n\t\t\t\tconst code = generateRandomString(32, \"a-z\", \"A-Z\", \"0-9\");\n\t\t\t\tconst codeExpiresInMs = opts.codeExpiresIn * 1e3;\n\t\t\t\tconst expiresAt = new Date(Date.now() + codeExpiresInMs);\n\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(verification.id, {\n\t\t\t\t\tvalue: JSON.stringify({\n\t\t\t\t\t\t...value,\n\t\t\t\t\t\trequireConsent: false\n\t\t\t\t\t}),\n\t\t\t\t\tidentifier: code,\n\t\t\t\t\texpiresAt\n\t\t\t\t});\n\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\tmodel: modelName.oauthConsent,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tclientId: value.clientId,\n\t\t\t\t\t\tuserId: value.userId,\n\t\t\t\t\t\tscopes: value.scope.join(\" \"),\n\t\t\t\t\t\tconsentGiven: true,\n\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tconst redirectURI = new URL(value.redirectURI);\n\t\t\t\tredirectURI.searchParams.set(\"code\", code);\n\t\t\t\tif (value.state) redirectURI.searchParams.set(\"state\", value.state);\n\t\t\t\treturn ctx.json({ redirectURI: redirectURI.toString() });\n\t\t\t}),\n\t\t\toAuth2token: createAuthEndpoint(\"/oauth2/token\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\toperationId: \"oauth2Token\",\n\t\t\t\tbody: z.record(z.any(), z.any()),\n\t\t\t\tmetadata: {\n\t\t\t\t\tisAction: false,\n\t\t\t\t\tallowedMediaTypes: [\"application/x-www-form-urlencoded\", \"application/json\"]\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tlet { body } = ctx;\n\t\t\t\tif (!body) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"request body not found\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif (body instanceof FormData) body = Object.fromEntries(body.entries());\n\t\t\t\tif (!(body instanceof Object)) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"request body is not an object\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tlet { client_id, client_secret } = body;\n\t\t\t\tconst authorization = ctx.request?.headers.get(\"authorization\") || null;\n\t\t\t\tif (authorization && !client_id && !client_secret && authorization.startsWith(\"Basic \")) try {\n\t\t\t\t\tconst encoded = authorization.replace(\"Basic \", \"\");\n\t\t\t\t\tconst decoded = new TextDecoder().decode(base64.decode(encoded));\n\t\t\t\t\tif (!decoded.includes(\":\")) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t\tconst [id, secret] = decoded.split(\":\");\n\t\t\t\t\tif (!id || !secret) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t\tclient_id = id;\n\t\t\t\t\tclient_secret = secret;\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthrow new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst now = Date.now();\n\t\t\t\tconst iat = Math.floor(now / 1e3);\n\t\t\t\tconst exp = iat + (opts.accessTokenExpiresIn ?? 3600);\n\t\t\t\tconst accessTokenExpiresAt = /* @__PURE__ */ new Date(exp * 1e3);\n\t\t\t\tconst refreshTokenExpiresAt = /* @__PURE__ */ new Date((iat + (opts.refreshTokenExpiresIn ?? 604800)) * 1e3);\n\t\t\t\tconst { grant_type, code, redirect_uri, refresh_token, code_verifier } = body;\n\t\t\t\tif (grant_type === \"refresh_token\") {\n\t\t\t\t\tif (!refresh_token) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror_description: \"refresh_token is required\",\n\t\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t\t});\n\t\t\t\t\tconst token = await ctx.context.adapter.findOne({\n\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"refreshToken\",\n\t\t\t\t\t\t\tvalue: refresh_token.toString()\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t\tif (!token) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid refresh token\",\n\t\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t\t});\n\t\t\t\t\tif (token.clientId !== client_id?.toString()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t\tif (token.refreshTokenExpiresAt < /* @__PURE__ */ new Date()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"refresh token expired\",\n\t\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t\t});\n\t\t\t\t\tconst accessToken$1 = generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\t\tconst newRefreshToken = generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\taccessToken: accessToken$1,\n\t\t\t\t\t\t\trefreshToken: newRefreshToken,\n\t\t\t\t\t\t\taccessTokenExpiresAt,\n\t\t\t\t\t\t\trefreshTokenExpiresAt,\n\t\t\t\t\t\t\tclientId: client_id.toString(),\n\t\t\t\t\t\t\tuserId: token.userId,\n\t\t\t\t\t\t\tscopes: token.scopes,\n\t\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(iat * 1e3),\n\t\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(iat * 1e3)\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\taccess_token: accessToken$1,\n\t\t\t\t\t\ttoken_type: \"Bearer\",\n\t\t\t\t\t\texpires_in: opts.accessTokenExpiresIn,\n\t\t\t\t\t\trefresh_token: newRefreshToken,\n\t\t\t\t\t\tscope: token.scopes\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (!code) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"code is required\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif (options.requirePKCE && !code_verifier) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"code verifier is missing\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\t/**\n\t\t\t\t* We need to check if the code is valid before we can proceed\n\t\t\t\t* with the rest of the request.\n\t\t\t\t*/\n\t\t\t\tconst verificationValue = await ctx.context.internalAdapter.findVerificationValue(code.toString());\n\t\t\t\tif (!verificationValue) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"invalid code\",\n\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t});\n\t\t\t\tif (verificationValue.expiresAt < /* @__PURE__ */ new Date()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"code expired\",\n\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t});\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\tif (!client_id) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"client_id is required\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tif (!grant_type) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"grant_type is required\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif (grant_type !== \"authorization_code\") throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"grant_type must be 'authorization_code'\",\n\t\t\t\t\terror: \"unsupported_grant_type\"\n\t\t\t\t});\n\t\t\t\tif (!redirect_uri) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"redirect_uri is required\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tconst client = await getClient(client_id.toString(), trustedClients);\n\t\t\t\tif (!client) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tif (client.disabled) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"client is disabled\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tconst value = JSON.parse(verificationValue.value);\n\t\t\t\tif (value.clientId !== client_id.toString()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tif (value.redirectURI !== redirect_uri.toString()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"invalid redirect_uri\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tif (value.codeChallenge && !code_verifier) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"code verifier is missing\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif (client.type === \"public\") {\n\t\t\t\t\tif (!code_verifier) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror_description: \"code verifier is required for public clients\",\n\t\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tif (!client.clientSecret || !client_secret) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"client_secret is required for confidential clients\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t\tif (!await verifyStoredClientSecret(ctx, client.clientSecret, client_secret.toString())) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid client_secret\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif ((value.codeChallengeMethod === \"plain\" ? code_verifier : await createHash(\"SHA-256\", \"base64urlnopad\").digest(code_verifier)) !== value.codeChallenge) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"code verification failed\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tconst requestedScopes = value.scope;\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\tconst accessToken = generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\tconst refreshToken = generateRandomString(32, \"A-Z\", \"a-z\");\n\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\taccessToken,\n\t\t\t\t\t\trefreshToken,\n\t\t\t\t\t\taccessTokenExpiresAt,\n\t\t\t\t\t\trefreshTokenExpiresAt,\n\t\t\t\t\t\tclientId: client_id.toString(),\n\t\t\t\t\t\tuserId: value.userId,\n\t\t\t\t\t\tscopes: requestedScopes.join(\" \"),\n\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(iat * 1e3),\n\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(iat * 1e3)\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(value.userId);\n\t\t\t\tif (!user) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"user not found\",\n\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t});\n\t\t\t\tconst profile = {\n\t\t\t\t\tgiven_name: user.name.split(\" \")[0],\n\t\t\t\t\tfamily_name: user.name.split(\" \")[1],\n\t\t\t\t\tname: user.name,\n\t\t\t\t\tprofile: user.image,\n\t\t\t\t\tupdated_at: new Date(user.updatedAt).toISOString()\n\t\t\t\t};\n\t\t\t\tconst email = {\n\t\t\t\t\temail: user.email,\n\t\t\t\t\temail_verified: user.emailVerified\n\t\t\t\t};\n\t\t\t\tconst userClaims = {\n\t\t\t\t\t...requestedScopes.includes(\"profile\") ? profile : {},\n\t\t\t\t\t...requestedScopes.includes(\"email\") ? email : {}\n\t\t\t\t};\n\t\t\t\tconst additionalUserClaims = options.getAdditionalUserInfoClaim ? await options.getAdditionalUserInfoClaim(user, requestedScopes, client) : {};\n\t\t\t\tconst payload = {\n\t\t\t\t\tsub: user.id,\n\t\t\t\t\taud: client_id.toString(),\n\t\t\t\t\tiat,\n\t\t\t\t\tauth_time: ctx.context.session ? new Date(ctx.context.session.session.createdAt).getTime() : void 0,\n\t\t\t\t\tnonce: value.nonce,\n\t\t\t\t\tacr: \"urn:mace:incommon:iap:silver\",\n\t\t\t\t\t...userClaims,\n\t\t\t\t\t...additionalUserClaims\n\t\t\t\t};\n\t\t\t\tconst expirationTime = Math.floor(Date.now() / 1e3) + opts.accessTokenExpiresIn;\n\t\t\t\tlet idToken;\n\t\t\t\tif (options.useJWTPlugin) {\n\t\t\t\t\tconst jwtPlugin = getJwtPlugin(ctx);\n\t\t\t\t\tif (!jwtPlugin) {\n\t\t\t\t\t\tctx.context.logger.error(\"OIDC: `useJWTPlugin` is enabled but the JWT plugin is not available. Make sure you have the JWT Plugin in your plugins array or set `useJWTPlugin` to false.\");\n\t\t\t\t\t\tthrow new APIError$1(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\t\t\terror_description: \"JWT plugin is not enabled\",\n\t\t\t\t\t\t\terror: \"internal_server_error\"\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tidToken = await getJwtToken({\n\t\t\t\t\t\t...ctx,\n\t\t\t\t\t\tcontext: {\n\t\t\t\t\t\t\t...ctx.context,\n\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\t\tid: generateRandomString(32, \"a-z\", \"A-Z\"),\n\t\t\t\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(iat * 1e3),\n\t\t\t\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(iat * 1e3),\n\t\t\t\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\t\t\t\texpiresAt: accessTokenExpiresAt,\n\t\t\t\t\t\t\t\t\ttoken: accessToken,\n\t\t\t\t\t\t\t\t\tipAddress: ctx.request?.headers.get(\"x-forwarded-for\")\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuser\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\t...jwtPlugin.options,\n\t\t\t\t\t\tjwt: {\n\t\t\t\t\t\t\t...jwtPlugin.options?.jwt,\n\t\t\t\t\t\t\tgetSubject: () => user.id,\n\t\t\t\t\t\t\taudience: client_id.toString(),\n\t\t\t\t\t\t\tissuer: jwtPlugin.options?.jwt?.issuer ?? ctx.context.options.baseURL,\n\t\t\t\t\t\t\texpirationTime,\n\t\t\t\t\t\t\tdefinePayload: () => payload\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else idToken = await new SignJWT(payload).setProtectedHeader({ alg: \"HS256\" }).setIssuedAt(iat).setExpirationTime(accessTokenExpiresAt).sign(new TextEncoder().encode(client.clientSecret));\n\t\t\t\treturn ctx.json({\n\t\t\t\t\taccess_token: accessToken,\n\t\t\t\t\ttoken_type: \"Bearer\",\n\t\t\t\t\texpires_in: opts.accessTokenExpiresIn,\n\t\t\t\t\trefresh_token: requestedScopes.includes(\"offline_access\") ? refreshToken : void 0,\n\t\t\t\t\tscope: requestedScopes.join(\" \"),\n\t\t\t\t\tid_token: requestedScopes.includes(\"openid\") ? idToken : void 0\n\t\t\t\t}, { headers: {\n\t\t\t\t\t\"Cache-Control\": \"no-store\",\n\t\t\t\t\tPragma: \"no-cache\"\n\t\t\t\t} });\n\t\t\t}),\n\t\t\toAuth2userInfo: createAuthEndpoint(\"/oauth2/userinfo\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\toperationId: \"oauth2Userinfo\",\n\t\t\t\tmetadata: {\n\t\t\t\t\tisAction: false,\n\t\t\t\t\topenapi: {\n\t\t\t\t\t\tdescription: \"Get OAuth2 user information\",\n\t\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\t\tdescription: \"User information retrieved successfully\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\tsub: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"Subject identifier (user ID)\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tformat: \"email\",\n\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\tdescription: \"User's email address, included if 'email' scope is granted\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\tdescription: \"User's full name, included if 'profile' scope is granted\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tpicture: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\tdescription: \"User's profile picture URL, included if 'profile' scope is granted\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tgiven_name: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\tdescription: \"User's given name, included if 'profile' scope is granted\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tfamily_name: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\tdescription: \"User's family name, included if 'profile' scope is granted\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\temail_verified: {\n\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the email is verified, included if 'email' scope is granted\"\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\trequired: [\"sub\"]\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t} }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!ctx.request) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"request not found\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tconst authorization = ctx.request.headers.get(\"authorization\");\n\t\t\t\tif (!authorization) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"authorization header not found\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tconst token = authorization.replace(\"Bearer \", \"\");\n\t\t\t\tconst accessToken = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"accessToken\",\n\t\t\t\t\t\tvalue: token\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!accessToken) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"invalid access token\",\n\t\t\t\t\terror: \"invalid_token\"\n\t\t\t\t});\n\t\t\t\tif (accessToken.accessTokenExpiresAt < /* @__PURE__ */ new Date()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"The Access Token expired\",\n\t\t\t\t\terror: \"invalid_token\"\n\t\t\t\t});\n\t\t\t\tconst client = await getClient(accessToken.clientId, trustedClients);\n\t\t\t\tif (!client) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"client not found\",\n\t\t\t\t\terror: \"invalid_token\"\n\t\t\t\t});\n\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(accessToken.userId);\n\t\t\t\tif (!user) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"user not found\",\n\t\t\t\t\terror: \"invalid_token\"\n\t\t\t\t});\n\t\t\t\tconst requestedScopes = accessToken.scopes.split(\" \");\n\t\t\t\tconst baseUserClaims = {\n\t\t\t\t\tsub: user.id,\n\t\t\t\t\temail: requestedScopes.includes(\"email\") ? user.email : void 0,\n\t\t\t\t\tname: requestedScopes.includes(\"profile\") ? user.name : void 0,\n\t\t\t\t\tpicture: requestedScopes.includes(\"profile\") ? user.image : void 0,\n\t\t\t\t\tgiven_name: requestedScopes.includes(\"profile\") ? user.name.split(\" \")[0] : void 0,\n\t\t\t\t\tfamily_name: requestedScopes.includes(\"profile\") ? user.name.split(\" \")[1] : void 0,\n\t\t\t\t\temail_verified: requestedScopes.includes(\"email\") ? user.emailVerified : void 0\n\t\t\t\t};\n\t\t\t\tconst userClaims = options.getAdditionalUserInfoClaim ? await options.getAdditionalUserInfoClaim(user, requestedScopes, client) : baseUserClaims;\n\t\t\t\treturn ctx.json({\n\t\t\t\t\t...baseUserClaims,\n\t\t\t\t\t...userClaims\n\t\t\t\t});\n\t\t\t}),\n\t\t\tregisterOAuthApplication: createAuthEndpoint(\"/oauth2/register\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tredirect_uris: z.array(z.string()).meta({ description: \"A list of redirect URIs. Eg: [\\\"https://client.example.com/callback\\\"]\" }),\n\t\t\t\t\ttoken_endpoint_auth_method: z.enum([\n\t\t\t\t\t\t\"none\",\n\t\t\t\t\t\t\"client_secret_basic\",\n\t\t\t\t\t\t\"client_secret_post\"\n\t\t\t\t\t]).meta({ description: \"The authentication method for the token endpoint. Eg: \\\"client_secret_basic\\\"\" }).default(\"client_secret_basic\").optional(),\n\t\t\t\t\tgrant_types: z.array(z.enum([\n\t\t\t\t\t\t\"authorization_code\",\n\t\t\t\t\t\t\"implicit\",\n\t\t\t\t\t\t\"password\",\n\t\t\t\t\t\t\"client_credentials\",\n\t\t\t\t\t\t\"refresh_token\",\n\t\t\t\t\t\t\"urn:ietf:params:oauth:grant-type:jwt-bearer\",\n\t\t\t\t\t\t\"urn:ietf:params:oauth:grant-type:saml2-bearer\"\n\t\t\t\t\t])).meta({ description: \"The grant types supported by the application. Eg: [\\\"authorization_code\\\"]\" }).default([\"authorization_code\"]).optional(),\n\t\t\t\t\tresponse_types: z.array(z.enum([\"code\", \"token\"])).meta({ description: \"The response types supported by the application. Eg: [\\\"code\\\"]\" }).default([\"code\"]).optional(),\n\t\t\t\t\tclient_name: z.string().meta({ description: \"The name of the application. Eg: \\\"My App\\\"\" }).optional(),\n\t\t\t\t\tclient_uri: z.string().meta({ description: \"The URI of the application. Eg: \\\"https://client.example.com\\\"\" }).optional(),\n\t\t\t\t\tlogo_uri: z.string().meta({ description: \"The URI of the application logo. Eg: \\\"https://client.example.com/logo.png\\\"\" }).optional(),\n\t\t\t\t\tscope: z.string().meta({ description: \"The scopes supported by the application. Separated by spaces. Eg: \\\"profile email\\\"\" }).optional(),\n\t\t\t\t\tcontacts: z.array(z.string()).meta({ description: \"The contact information for the application. Eg: [\\\"admin@example.com\\\"]\" }).optional(),\n\t\t\t\t\ttos_uri: z.string().meta({ description: \"The URI of the application terms of service. Eg: \\\"https://client.example.com/tos\\\"\" }).optional(),\n\t\t\t\t\tpolicy_uri: z.string().meta({ description: \"The URI of the application privacy policy. Eg: \\\"https://client.example.com/policy\\\"\" }).optional(),\n\t\t\t\t\tjwks_uri: z.string().meta({ description: \"The URI of the application JWKS. Eg: \\\"https://client.example.com/jwks\\\"\" }).optional(),\n\t\t\t\t\tjwks: z.record(z.any(), z.any()).meta({ description: \"The JWKS of the application. Eg: {\\\"keys\\\": [{\\\"kty\\\": \\\"RSA\\\", \\\"alg\\\": \\\"RS256\\\", \\\"use\\\": \\\"sig\\\", \\\"n\\\": \\\"...\\\", \\\"e\\\": \\\"...\\\"}]}\" }).optional(),\n\t\t\t\t\tmetadata: z.record(z.any(), z.any()).meta({ description: \"The metadata of the application. Eg: {\\\"key\\\": \\\"value\\\"}\" }).optional(),\n\t\t\t\t\tsoftware_id: z.string().meta({ description: \"The software ID of the application. Eg: \\\"my-software\\\"\" }).optional(),\n\t\t\t\t\tsoftware_version: z.string().meta({ description: \"The software version of the application. Eg: \\\"1.0.0\\\"\" }).optional(),\n\t\t\t\t\tsoftware_statement: z.string().meta({ description: \"The software statement of the application.\" }).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Register an OAuth2 application\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"OAuth2 application registered successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Name of the OAuth2 application\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ticon: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\tdescription: \"Icon URL for the application\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\tdescription: \"Additional metadata for the application\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tclientId: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier for the client\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tclientSecret: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Secret key for the client\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tredirectURLs: {\n\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tformat: \"uri\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdescription: \"List of allowed redirect URLs\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttype: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Type of the client\",\n\t\t\t\t\t\t\t\t\tenum: [\"web\"]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tauthenticationScheme: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Authentication scheme used by the client\",\n\t\t\t\t\t\t\t\t\tenum: [\"client_secret\"]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdisabled: {\n\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\tdescription: \"Whether the client is disabled\",\n\t\t\t\t\t\t\t\t\tenum: [false]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\tdescription: \"ID of the user who registered the client, null if registered anonymously\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\tdescription: \"Creation timestamp\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\tdescription: \"Last update timestamp\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\"name\",\n\t\t\t\t\t\t\t\t\"clientId\",\n\t\t\t\t\t\t\t\t\"clientSecret\",\n\t\t\t\t\t\t\t\t\"redirectURLs\",\n\t\t\t\t\t\t\t\t\"type\",\n\t\t\t\t\t\t\t\t\"authenticationScheme\",\n\t\t\t\t\t\t\t\t\"disabled\",\n\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst body = ctx.body;\n\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\t\tif (!session && !options.allowDynamicClientRegistration) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror: \"invalid_token\",\n\t\t\t\t\terror_description: \"Authentication required for client registration\"\n\t\t\t\t});\n\t\t\t\tif ((!body.grant_types || body.grant_types.includes(\"authorization_code\") || body.grant_types.includes(\"implicit\")) && (!body.redirect_uris || body.redirect_uris.length === 0)) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_redirect_uri\",\n\t\t\t\t\terror_description: \"Redirect URIs are required for authorization_code and implicit grant types\"\n\t\t\t\t});\n\t\t\t\tif (body.grant_types && body.response_types) {\n\t\t\t\t\tif (body.grant_types.includes(\"authorization_code\") && !body.response_types.includes(\"code\")) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_client_metadata\",\n\t\t\t\t\t\terror_description: \"When 'authorization_code' grant type is used, 'code' response type must be included\"\n\t\t\t\t\t});\n\t\t\t\t\tif (body.grant_types.includes(\"implicit\") && !body.response_types.includes(\"token\")) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_client_metadata\",\n\t\t\t\t\t\terror_description: \"When 'implicit' grant type is used, 'token' response type must be included\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst clientId = options.generateClientId?.() || generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\tconst clientSecret = options.generateClientSecret?.() || generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\tconst storedClientSecret = await storeClientSecret(ctx, clientSecret);\n\t\t\t\tconst client = await ctx.context.adapter.create({\n\t\t\t\t\tmodel: modelName.oauthClient,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tname: body.client_name,\n\t\t\t\t\t\ticon: body.logo_uri,\n\t\t\t\t\t\tmetadata: body.metadata ? JSON.stringify(body.metadata) : null,\n\t\t\t\t\t\tclientId,\n\t\t\t\t\t\tclientSecret: storedClientSecret,\n\t\t\t\t\t\tredirectUrls: body.redirect_uris.join(\",\"),\n\t\t\t\t\t\ttype: \"web\",\n\t\t\t\t\t\tauthenticationScheme: body.token_endpoint_auth_method || \"client_secret_basic\",\n\t\t\t\t\t\tdisabled: false,\n\t\t\t\t\t\tuserId: session?.session.userId,\n\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tclient_id: clientId,\n\t\t\t\t\t...client.type !== \"public\" ? {\n\t\t\t\t\t\tclient_secret: clientSecret,\n\t\t\t\t\t\tclient_secret_expires_at: 0\n\t\t\t\t\t} : {},\n\t\t\t\t\tclient_id_issued_at: Math.floor(Date.now() / 1e3),\n\t\t\t\t\tclient_secret_expires_at: 0,\n\t\t\t\t\tredirect_uris: body.redirect_uris,\n\t\t\t\t\ttoken_endpoint_auth_method: body.token_endpoint_auth_method || \"client_secret_basic\",\n\t\t\t\t\tgrant_types: body.grant_types || [\"authorization_code\"],\n\t\t\t\t\tresponse_types: body.response_types || [\"code\"],\n\t\t\t\t\tclient_name: body.client_name,\n\t\t\t\t\tclient_uri: body.client_uri,\n\t\t\t\t\tlogo_uri: body.logo_uri,\n\t\t\t\t\tscope: body.scope,\n\t\t\t\t\tcontacts: body.contacts,\n\t\t\t\t\ttos_uri: body.tos_uri,\n\t\t\t\t\tpolicy_uri: body.policy_uri,\n\t\t\t\t\tjwks_uri: body.jwks_uri,\n\t\t\t\t\tjwks: body.jwks,\n\t\t\t\t\tsoftware_id: body.software_id,\n\t\t\t\t\tsoftware_version: body.software_version,\n\t\t\t\t\tsoftware_statement: body.software_statement,\n\t\t\t\t\tmetadata: body.metadata\n\t\t\t\t}, {\n\t\t\t\t\tstatus: 201,\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"Cache-Control\": \"no-store\",\n\t\t\t\t\t\tPragma: \"no-cache\"\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}),\n\t\t\tgetOAuthClient: createAuthEndpoint(\"/oauth2/client/:id\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Get OAuth2 client details\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"OAuth2 client retrieved successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tclientId: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier for the client\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Name of the OAuth2 application\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ticon: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\tdescription: \"Icon URL for the application\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\"clientId\", \"name\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst client = await getClient(ctx.params.id, trustedClients);\n\t\t\t\tif (!client) throw new APIError$1(\"NOT_FOUND\", {\n\t\t\t\t\terror_description: \"client not found\",\n\t\t\t\t\terror: \"not_found\"\n\t\t\t\t});\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tclientId: client.clientId,\n\t\t\t\t\tname: client.name,\n\t\t\t\t\ticon: client.icon || null\n\t\t\t\t});\n\t\t\t}),\n\t\t\tendSession: createAuthEndpoint(\"/oauth2/endsession\", {\n\t\t\t\tmethod: [\"GET\", \"POST\"],\n\t\t\t\toperationId: \"oauth2EndSession\",\n\t\t\t\tquery: z.object({\n\t\t\t\t\tid_token_hint: z.string().optional(),\n\t\t\t\t\tlogout_hint: z.string().optional(),\n\t\t\t\t\tclient_id: z.string().optional(),\n\t\t\t\t\tpost_logout_redirect_uri: z.string().optional(),\n\t\t\t\t\tstate: z.string().optional(),\n\t\t\t\t\tui_locales: z.string().optional()\n\t\t\t\t}).optional(),\n\t\t\t\tmetadata: {\n\t\t\t\t\tisAction: false,\n\t\t\t\t\topenapi: {\n\t\t\t\t\t\tdescription: \"RP-Initiated Logout endpoint. Logs out the end-user and optionally redirects to a post-logout URI.\",\n\t\t\t\t\t\tparameters: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: \"id_token_hint\",\n\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\tdescription: \"Previously issued ID Token passed as a hint about the End-User's current authenticated session\",\n\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\tschema: { type: \"string\" }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: \"logout_hint\",\n\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\tdescription: \"Hint to the Authorization Server about the End-User that is logging out\",\n\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\tschema: { type: \"string\" }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: \"client_id\",\n\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\tdescription: \"OAuth 2.0 Client Identifier. Required if post_logout_redirect_uri is used without id_token_hint\",\n\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\tschema: { type: \"string\" }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: \"post_logout_redirect_uri\",\n\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\tdescription: \"URL to which the RP is requesting that the End-User's User Agent be redirected after a logout has been performed\",\n\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tformat: \"uri\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: \"state\",\n\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\tdescription: \"Opaque value used by the RP to maintain state between the logout request and the callback\",\n\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\tschema: { type: \"string\" }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: \"ui_locales\",\n\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\tdescription: \"End-User's preferred languages and scripts for the user interface\",\n\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\tschema: { type: \"string\" }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t],\n\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\"302\": { description: \"Redirect to post_logout_redirect_uri or logout confirmation page\" },\n\t\t\t\t\t\t\t\"200\": { description: \"Logout completed successfully\" }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { id_token_hint, logout_hint, client_id, post_logout_redirect_uri, state, ui_locales } = ctx.query || {};\n\t\t\t\tlet validatedClientId = null;\n\t\t\t\tlet validatedUserId = null;\n\t\t\t\tif (id_token_hint) try {\n\t\t\t\t\tconst jwtPlugin = getJwtPlugin(ctx);\n\t\t\t\t\tif (jwtPlugin && jwtPlugin.options && options?.useJWTPlugin) {\n\t\t\t\t\t\tconst verified = await verifyJWT(id_token_hint, jwtPlugin.options);\n\t\t\t\t\t\tif (verified) {\n\t\t\t\t\t\t\tvalidatedUserId = verified.sub;\n\t\t\t\t\t\t\tvalidatedClientId = verified.aud ? typeof verified.aud === \"string\" ? verified.aud : verified.aud[0] : null;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (client_id) {\n\t\t\t\t\t\tconst client = await getClient(client_id, trustedClients);\n\t\t\t\t\t\tif (client && client.clientSecret) try {\n\t\t\t\t\t\t\tconst { payload } = await jwtVerify(id_token_hint, new TextEncoder().encode(client.clientSecret));\n\t\t\t\t\t\t\tvalidatedUserId = payload.sub;\n\t\t\t\t\t\t\tvalidatedClientId = payload.aud;\n\t\t\t\t\t\t} catch (error) {}\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tctx.context.logger.debug(\"Invalid id_token_hint provided to end_session endpoint\");\n\t\t\t\t}\n\t\t\t\tif (client_id) {\n\t\t\t\t\tif (!await getClient(client_id, trustedClients)) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\terror_description: \"Invalid client_id\"\n\t\t\t\t\t});\n\t\t\t\t\tif (validatedClientId && validatedClientId !== client_id) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\terror_description: \"client_id does not match the ID Token's audience\"\n\t\t\t\t\t});\n\t\t\t\t\tvalidatedClientId = client_id;\n\t\t\t\t}\n\t\t\t\tif (post_logout_redirect_uri) {\n\t\t\t\t\tif (!validatedClientId) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\terror_description: \"client_id is required when using post_logout_redirect_uri without a valid id_token_hint\"\n\t\t\t\t\t});\n\t\t\t\t\tconst client = await getClient(validatedClientId, trustedClients);\n\t\t\t\t\tif (!client) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\terror_description: \"Invalid client\"\n\t\t\t\t\t});\n\t\t\t\t\tif (!client.redirectUrls.some((registeredUri) => post_logout_redirect_uri === registeredUri)) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\terror_description: \"post_logout_redirect_uri is not registered for this client\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\t\tif (validatedUserId || session) {\n\t\t\t\t\tconst userId = validatedUserId || session?.user.id;\n\t\t\t\t\tif (userId) await ctx.context.adapter.deleteMany({\n\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\t\tvalue: userId\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (session) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteSession(session.session.token);\n\t\t\t\t\tctx.setSignedCookie(ctx.context.authCookies.sessionToken.name, \"\", ctx.context.secret, { maxAge: 0 });\n\t\t\t\t}\n\t\t\t\tif (post_logout_redirect_uri) try {\n\t\t\t\t\tconst redirectUrl = new URL(post_logout_redirect_uri);\n\t\t\t\t\tif (state) redirectUrl.searchParams.set(\"state\", state);\n\t\t\t\t\treturn ctx.redirect(redirectUrl.toString());\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthrow new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\terror_description: \"Invalid post_logout_redirect_uri format\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tsuccess: true,\n\t\t\t\t\tmessage: \"Logout successful\"\n\t\t\t\t});\n\t\t\t})\n\t\t},\n\t\tschema: mergeSchema(schema, options?.schema),\n\t\tget options() {\n\t\t\treturn opts;\n\t\t}\n\t};\n};\n\n//#endregion\nexport { parsePrompt as a, schema as i, getMetadata as n, oidcProvider as r, getClient as t };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 9332, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/bearer-C6RSCXv_.mjs"],"sourcesContent":["import { l as parseSetCookieHeader } from \"./cookies-D72PbWdz.mjs\";\nimport { serializeSignedCookie } from \"better-call\";\nimport { createAuthMiddleware } from \"@better-auth/core/api\";\nimport { createHMAC } from \"@better-auth/utils/hmac\";\n\n//#region src/plugins/bearer/index.ts\n/**\n* Converts bearer token to session cookie\n*/\nconst bearer = (options) => {\n\treturn {\n\t\tid: \"bearer\",\n\t\thooks: {\n\t\t\tbefore: [{\n\t\t\t\tmatcher(context) {\n\t\t\t\t\treturn Boolean(context.request?.headers.get(\"authorization\") || context.headers?.get(\"authorization\"));\n\t\t\t\t},\n\t\t\t\thandler: createAuthMiddleware(async (c) => {\n\t\t\t\t\tconst token = c.request?.headers.get(\"authorization\")?.replace(\"Bearer \", \"\") || c.headers?.get(\"Authorization\")?.replace(\"Bearer \", \"\");\n\t\t\t\t\tif (!token) return;\n\t\t\t\t\tlet signedToken = \"\";\n\t\t\t\t\tif (token.includes(\".\")) signedToken = token.replace(\"=\", \"\");\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (options?.requireSignature) return;\n\t\t\t\t\t\tsignedToken = (await serializeSignedCookie(\"\", token, c.context.secret)).replace(\"=\", \"\");\n\t\t\t\t\t}\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst decodedToken = decodeURIComponent(signedToken);\n\t\t\t\t\t\tif (!await createHMAC(\"SHA-256\", \"base64urlnopad\").verify(c.context.secret, decodedToken.split(\".\")[0], decodedToken.split(\".\")[1])) return;\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst existingHeaders = c.request?.headers || c.headers;\n\t\t\t\t\tconst headers = new Headers({ ...Object.fromEntries(existingHeaders?.entries()) });\n\t\t\t\t\theaders.append(\"cookie\", `${c.context.authCookies.sessionToken.name}=${signedToken}`);\n\t\t\t\t\treturn { context: { headers } };\n\t\t\t\t})\n\t\t\t}],\n\t\t\tafter: [{\n\t\t\t\tmatcher(context) {\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\tconst setCookie = ctx.context.responseHeaders?.get(\"set-cookie\");\n\t\t\t\t\tif (!setCookie) return;\n\t\t\t\t\tconst parsedCookies = parseSetCookieHeader(setCookie);\n\t\t\t\t\tconst cookieName = ctx.context.authCookies.sessionToken.name;\n\t\t\t\t\tconst sessionCookie = parsedCookies.get(cookieName);\n\t\t\t\t\tif (!sessionCookie || !sessionCookie.value || sessionCookie[\"max-age\"] === 0) return;\n\t\t\t\t\tconst token = sessionCookie.value;\n\t\t\t\t\tconst exposedHeaders = ctx.context.responseHeaders?.get(\"access-control-expose-headers\") || \"\";\n\t\t\t\t\tconst headersSet = new Set(exposedHeaders.split(\",\").map((header) => header.trim()).filter(Boolean));\n\t\t\t\t\theadersSet.add(\"set-auth-token\");\n\t\t\t\t\tctx.setHeader(\"set-auth-token\", token);\n\t\t\t\t\tctx.setHeader(\"Access-Control-Expose-Headers\", Array.from(headersSet).join(\", \"));\n\t\t\t\t})\n\t\t\t}]\n\t\t}\n\t};\n};\n\n//#endregion\nexport { bearer as t };"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEA,qCAAqC;AACrC;;AAEA,GACA,MAAM,SAAS,CAAC;IACf,OAAO;QACN,IAAI;QACJ,OAAO;YACN,QAAQ;gBAAC;oBACR,SAAQ,OAAO;wBACd,OAAO,QAAQ,QAAQ,OAAO,EAAE,QAAQ,IAAI,oBAAoB,QAAQ,OAAO,EAAE,IAAI;oBACtF;oBACA,SAAS,IAAA,2LAAoB,EAAC,OAAO;wBACpC,MAAM,QAAQ,EAAE,OAAO,EAAE,QAAQ,IAAI,kBAAkB,QAAQ,WAAW,OAAO,EAAE,OAAO,EAAE,IAAI,kBAAkB,QAAQ,WAAW;wBACrI,IAAI,CAAC,OAAO;wBACZ,IAAI,cAAc;wBAClB,IAAI,MAAM,QAAQ,CAAC,MAAM,cAAc,MAAM,OAAO,CAAC,KAAK;6BACrD;4BACJ,IAAI,SAAS,kBAAkB;4BAC/B,cAAc,CAAC,MAAM,IAAA,0KAAqB,EAAC,IAAI,OAAO,EAAE,OAAO,CAAC,MAAM,CAAC,EAAE,OAAO,CAAC,KAAK;wBACvF;wBACA,IAAI;4BACH,MAAM,eAAe,mBAAmB;4BACxC,IAAI,CAAC,MAAM,IAAA,0KAAU,EAAC,WAAW,kBAAkB,MAAM,CAAC,EAAE,OAAO,CAAC,MAAM,EAAE,aAAa,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,aAAa,KAAK,CAAC,IAAI,CAAC,EAAE,GAAG;wBACtI,EAAE,OAAO,GAAG;4BACX;wBACD;wBACA,MAAM,kBAAkB,EAAE,OAAO,EAAE,WAAW,EAAE,OAAO;wBACvD,MAAM,UAAU,IAAI,QAAQ;4BAAE,GAAG,OAAO,WAAW,CAAC,iBAAiB,UAAU;wBAAC;wBAChF,QAAQ,MAAM,CAAC,UAAU,GAAG,EAAE,OAAO,CAAC,WAAW,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,EAAE,aAAa;wBACpF,OAAO;4BAAE,SAAS;gCAAE;4BAAQ;wBAAE;oBAC/B;gBACD;aAAE;YACF,OAAO;gBAAC;oBACP,SAAQ,OAAO;wBACd,OAAO;oBACR;oBACA,SAAS,IAAA,2LAAoB,EAAC,OAAO;wBACpC,MAAM,YAAY,IAAI,OAAO,CAAC,eAAe,EAAE,IAAI;wBACnD,IAAI,CAAC,WAAW;wBAChB,MAAM,gBAAgB,IAAA,qKAAoB,EAAC;wBAC3C,MAAM,aAAa,IAAI,OAAO,CAAC,WAAW,CAAC,YAAY,CAAC,IAAI;wBAC5D,MAAM,gBAAgB,cAAc,GAAG,CAAC;wBACxC,IAAI,CAAC,iBAAiB,CAAC,cAAc,KAAK,IAAI,aAAa,CAAC,UAAU,KAAK,GAAG;wBAC9E,MAAM,QAAQ,cAAc,KAAK;wBACjC,MAAM,iBAAiB,IAAI,OAAO,CAAC,eAAe,EAAE,IAAI,oCAAoC;wBAC5F,MAAM,aAAa,IAAI,IAAI,eAAe,KAAK,CAAC,KAAK,GAAG,CAAC,CAAC,SAAW,OAAO,IAAI,IAAI,MAAM,CAAC;wBAC3F,WAAW,GAAG,CAAC;wBACf,IAAI,SAAS,CAAC,kBAAkB;wBAChC,IAAI,SAAS,CAAC,iCAAiC,MAAM,IAAI,CAAC,YAAY,IAAI,CAAC;oBAC5E;gBACD;aAAE;QACH;IACD;AACD","ignoreList":[0]}},
    {"offset": {"line": 9413, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/captcha-Dbvurc2Z.mjs"],"sourcesContent":["import { t as getIp } from \"./get-request-ip-D6st-mto.mjs\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport { betterFetch } from \"@better-fetch/fetch\";\n\n//#region src/utils/middleware-response.ts\nconst middlewareResponse = ({ message, status }) => ({ response: new Response(JSON.stringify({ message }), { status }) });\n\n//#endregion\n//#region src/plugins/captcha/constants.ts\nconst defaultEndpoints = [\n\t\"/sign-up/email\",\n\t\"/sign-in/email\",\n\t\"/request-password-reset\"\n];\nconst Providers = {\n\tCLOUDFLARE_TURNSTILE: \"cloudflare-turnstile\",\n\tGOOGLE_RECAPTCHA: \"google-recaptcha\",\n\tHCAPTCHA: \"hcaptcha\",\n\tCAPTCHAFOX: \"captchafox\"\n};\nconst siteVerifyMap = {\n\t[Providers.CLOUDFLARE_TURNSTILE]: \"https://challenges.cloudflare.com/turnstile/v0/siteverify\",\n\t[Providers.GOOGLE_RECAPTCHA]: \"https://www.google.com/recaptcha/api/siteverify\",\n\t[Providers.HCAPTCHA]: \"https://api.hcaptcha.com/siteverify\",\n\t[Providers.CAPTCHAFOX]: \"https://api.captchafox.com/siteverify\"\n};\n\n//#endregion\n//#region src/plugins/captcha/error-codes.ts\nconst EXTERNAL_ERROR_CODES = defineErrorCodes({\n\tVERIFICATION_FAILED: \"Captcha verification failed\",\n\tMISSING_RESPONSE: \"Missing CAPTCHA response\",\n\tUNKNOWN_ERROR: \"Something went wrong\"\n});\nconst INTERNAL_ERROR_CODES = defineErrorCodes({\n\tMISSING_SECRET_KEY: \"Missing secret key\",\n\tSERVICE_UNAVAILABLE: \"CAPTCHA service unavailable\"\n});\n\n//#endregion\n//#region src/plugins/captcha/utils.ts\nconst encodeToURLParams = (obj) => {\n\tif (typeof obj !== \"object\" || obj === null || Array.isArray(obj)) throw new Error(\"Input must be a non-null object.\");\n\tconst params = new URLSearchParams();\n\tfor (const [key, value] of Object.entries(obj)) if (value !== void 0 && value !== null) params.append(key, String(value));\n\treturn params.toString();\n};\n\n//#endregion\n//#region src/plugins/captcha/verify-handlers/captchafox.ts\nconst captchaFox = async ({ siteVerifyURL, captchaResponse, secretKey, siteKey, remoteIP }) => {\n\tconst response = await betterFetch(siteVerifyURL, {\n\t\tmethod: \"POST\",\n\t\theaders: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n\t\tbody: encodeToURLParams({\n\t\t\tsecret: secretKey,\n\t\t\tresponse: captchaResponse,\n\t\t\t...siteKey && { sitekey: siteKey },\n\t\t\t...remoteIP && { remoteIp: remoteIP }\n\t\t})\n\t});\n\tif (!response.data || response.error) throw new Error(INTERNAL_ERROR_CODES.SERVICE_UNAVAILABLE);\n\tif (!response.data.success) return middlewareResponse({\n\t\tmessage: EXTERNAL_ERROR_CODES.VERIFICATION_FAILED,\n\t\tstatus: 403\n\t});\n};\n\n//#endregion\n//#region src/plugins/captcha/verify-handlers/cloudflare-turnstile.ts\nconst cloudflareTurnstile = async ({ siteVerifyURL, captchaResponse, secretKey, remoteIP }) => {\n\tconst response = await betterFetch(siteVerifyURL, {\n\t\tmethod: \"POST\",\n\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\tbody: JSON.stringify({\n\t\t\tsecret: secretKey,\n\t\t\tresponse: captchaResponse,\n\t\t\t...remoteIP && { remoteip: remoteIP }\n\t\t})\n\t});\n\tif (!response.data || response.error) throw new Error(INTERNAL_ERROR_CODES.SERVICE_UNAVAILABLE);\n\tif (!response.data.success) return middlewareResponse({\n\t\tmessage: EXTERNAL_ERROR_CODES.VERIFICATION_FAILED,\n\t\tstatus: 403\n\t});\n};\n\n//#endregion\n//#region src/plugins/captcha/verify-handlers/google-recaptcha.ts\nconst isV3 = (response) => {\n\treturn \"score\" in response && typeof response.score === \"number\";\n};\nconst googleRecaptcha = async ({ siteVerifyURL, captchaResponse, secretKey, minScore = .5, remoteIP }) => {\n\tconst response = await betterFetch(siteVerifyURL, {\n\t\tmethod: \"POST\",\n\t\theaders: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n\t\tbody: encodeToURLParams({\n\t\t\tsecret: secretKey,\n\t\t\tresponse: captchaResponse,\n\t\t\t...remoteIP && { remoteip: remoteIP }\n\t\t})\n\t});\n\tif (!response.data || response.error) throw new Error(INTERNAL_ERROR_CODES.SERVICE_UNAVAILABLE);\n\tif (!response.data.success || isV3(response.data) && response.data.score < minScore) return middlewareResponse({\n\t\tmessage: EXTERNAL_ERROR_CODES.VERIFICATION_FAILED,\n\t\tstatus: 403\n\t});\n};\n\n//#endregion\n//#region src/plugins/captcha/verify-handlers/h-captcha.ts\nconst hCaptcha = async ({ siteVerifyURL, captchaResponse, secretKey, siteKey, remoteIP }) => {\n\tconst response = await betterFetch(siteVerifyURL, {\n\t\tmethod: \"POST\",\n\t\theaders: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n\t\tbody: encodeToURLParams({\n\t\t\tsecret: secretKey,\n\t\t\tresponse: captchaResponse,\n\t\t\t...siteKey && { sitekey: siteKey },\n\t\t\t...remoteIP && { remoteip: remoteIP }\n\t\t})\n\t});\n\tif (!response.data || response.error) throw new Error(INTERNAL_ERROR_CODES.SERVICE_UNAVAILABLE);\n\tif (!response.data.success) return middlewareResponse({\n\t\tmessage: EXTERNAL_ERROR_CODES.VERIFICATION_FAILED,\n\t\tstatus: 403\n\t});\n};\n\n//#endregion\n//#region src/plugins/captcha/index.ts\nconst captcha = (options) => ({\n\tid: \"captcha\",\n\tonRequest: async (request, ctx) => {\n\t\ttry {\n\t\t\tif (!(options.endpoints?.length ? options.endpoints : defaultEndpoints).some((endpoint) => request.url.includes(endpoint))) return void 0;\n\t\t\tif (!options.secretKey) throw new Error(INTERNAL_ERROR_CODES.MISSING_SECRET_KEY);\n\t\t\tconst captchaResponse = request.headers.get(\"x-captcha-response\");\n\t\t\tconst remoteUserIP = getIp(request, ctx.options) ?? void 0;\n\t\t\tif (!captchaResponse) return middlewareResponse({\n\t\t\t\tmessage: EXTERNAL_ERROR_CODES.MISSING_RESPONSE,\n\t\t\t\tstatus: 400\n\t\t\t});\n\t\t\tconst handlerParams = {\n\t\t\t\tsiteVerifyURL: options.siteVerifyURLOverride || siteVerifyMap[options.provider],\n\t\t\t\tcaptchaResponse,\n\t\t\t\tsecretKey: options.secretKey,\n\t\t\t\tremoteIP: remoteUserIP\n\t\t\t};\n\t\t\tif (options.provider === Providers.CLOUDFLARE_TURNSTILE) return await cloudflareTurnstile(handlerParams);\n\t\t\tif (options.provider === Providers.GOOGLE_RECAPTCHA) return await googleRecaptcha({\n\t\t\t\t...handlerParams,\n\t\t\t\tminScore: options.minScore\n\t\t\t});\n\t\t\tif (options.provider === Providers.HCAPTCHA) return await hCaptcha({\n\t\t\t\t...handlerParams,\n\t\t\t\tsiteKey: options.siteKey\n\t\t\t});\n\t\t\tif (options.provider === Providers.CAPTCHAFOX) return await captchaFox({\n\t\t\t\t...handlerParams,\n\t\t\t\tsiteKey: options.siteKey\n\t\t\t});\n\t\t} catch (_error) {\n\t\t\tconst errorMessage = _error instanceof Error ? _error.message : void 0;\n\t\t\tctx.logger.error(errorMessage ?? \"Unknown error\", {\n\t\t\t\tendpoint: request.url,\n\t\t\t\tmessage: _error\n\t\t\t});\n\t\t\treturn middlewareResponse({\n\t\t\t\tmessage: EXTERNAL_ERROR_CODES.UNKNOWN_ERROR,\n\t\t\t\tstatus: 500\n\t\t\t});\n\t\t}\n\t}\n});\n\n//#endregion\nexport { captcha as t };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 9618, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/custom-session-CaUbM_of.mjs"],"sourcesContent":["import { n as getSession } from \"./session-AaRl3_x-.mjs\";\nimport { t as getEndpointResponse } from \"./plugin-helper-zFdFWLgL.mjs\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\n\n//#region src/plugins/custom-session/index.ts\nconst getSessionQuerySchema = z.optional(z.object({\n\tdisableCookieCache: z.boolean().meta({ description: \"Disable cookie cache and fetch session from database\" }).or(z.string().transform((v) => v === \"true\")).optional(),\n\tdisableRefresh: z.boolean().meta({ description: \"Disable session refresh. Useful for checking session status, without updating the session\" }).optional()\n}));\nconst customSession = (fn, options, pluginOptions) => {\n\treturn {\n\t\tid: \"custom-session\",\n\t\thooks: { after: [{\n\t\t\tmatcher: (ctx) => ctx.path === \"/multi-session/list-device-sessions\" && (pluginOptions?.shouldMutateListDeviceSessionsEndpoint ?? false),\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst response = await getEndpointResponse(ctx);\n\t\t\t\tif (!response) return;\n\t\t\t\tconst newResponse = await Promise.all(response.map(async (v) => await fn(v, ctx)));\n\t\t\t\treturn ctx.json(newResponse);\n\t\t\t})\n\t\t}] },\n\t\tendpoints: { getSession: createAuthEndpoint(\"/get-session\", {\n\t\t\tmethod: \"GET\",\n\t\t\tquery: getSessionQuerySchema,\n\t\t\tmetadata: {\n\t\t\t\tCUSTOM_SESSION: true,\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Get custom session data\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\titems: { $ref: \"#/components/schemas/Session\" }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t}\n\t\t\t},\n\t\t\trequireHeaders: true\n\t\t}, async (ctx) => {\n\t\t\tconst session = await getSession()({\n\t\t\t\t...ctx,\n\t\t\t\tasResponse: false,\n\t\t\t\theaders: ctx.headers,\n\t\t\t\treturnHeaders: true\n\t\t\t}).catch((e) => {\n\t\t\t\treturn null;\n\t\t\t});\n\t\t\tif (!session?.response) return ctx.json(null);\n\t\t\tconst fnResult = await fn(session.response, ctx);\n\t\t\tconst setCookie = session.headers.get(\"set-cookie\");\n\t\t\tif (setCookie) {\n\t\t\t\tctx.setHeader(\"set-cookie\", setCookie);\n\t\t\t\tsession.headers.delete(\"set-cookie\");\n\t\t\t}\n\t\t\tsession.headers.forEach((value, key) => {\n\t\t\t\tctx.setHeader(key, value);\n\t\t\t});\n\t\t\treturn ctx.json(fnResult);\n\t\t}) },\n\t\t$Infer: { Session: {} }\n\t};\n};\n\n//#endregion\nexport { customSession as t };"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEA,6CAA6C;AAC7C,MAAM,wBAAwB,6JAAU,CAAC,2JAAQ,CAAC;IACjD,oBAAoB,4JAAS,GAAG,IAAI,CAAC;QAAE,aAAa;IAAuD,GAAG,EAAE,CAAC,2JAAQ,GAAG,SAAS,CAAC,CAAC,IAAM,MAAM,SAAS,QAAQ;IACpK,gBAAgB,4JAAS,GAAG,IAAI,CAAC;QAAE,aAAa;IAA4F,GAAG,QAAQ;AACxJ;AACA,MAAM,gBAAgB,CAAC,IAAI,SAAS;IACnC,OAAO;QACN,IAAI;QACJ,OAAO;YAAE,OAAO;gBAAC;oBAChB,SAAS,CAAC,MAAQ,IAAI,IAAI,KAAK,yCAAyC,CAAC,eAAe,0CAA0C,KAAK;oBACvI,SAAS,IAAA,2LAAoB,EAAC,OAAO;wBACpC,MAAM,WAAW,MAAM,IAAA,8KAAmB,EAAC;wBAC3C,IAAI,CAAC,UAAU;wBACf,MAAM,cAAc,MAAM,QAAQ,GAAG,CAAC,SAAS,GAAG,CAAC,OAAO,IAAM,MAAM,GAAG,GAAG;wBAC5E,OAAO,IAAI,IAAI,CAAC;oBACjB;gBACD;aAAE;QAAC;QACH,WAAW;YAAE,YAAY,IAAA,yLAAkB,EAAC,gBAAgB;gBAC3D,QAAQ;gBACR,OAAO;gBACP,UAAU;oBACT,gBAAgB;oBAChB,SAAS;wBACR,aAAa;wBACb,WAAW;4BAAE,OAAO;gCACnB,aAAa;gCACb,SAAS;oCAAE,oBAAoB;wCAAE,QAAQ;4CACxC,MAAM;4CACN,UAAU;4CACV,OAAO;gDAAE,MAAM;4CAA+B;wCAC/C;oCAAE;gCAAE;4BACL;wBAAE;oBACH;gBACD;gBACA,gBAAgB;YACjB,GAAG,OAAO;gBACT,MAAM,UAAU,MAAM,IAAA,sKAAU,IAAG;oBAClC,GAAG,GAAG;oBACN,YAAY;oBACZ,SAAS,IAAI,OAAO;oBACpB,eAAe;gBAChB,GAAG,KAAK,CAAC,CAAC;oBACT,OAAO;gBACR;gBACA,IAAI,CAAC,SAAS,UAAU,OAAO,IAAI,IAAI,CAAC;gBACxC,MAAM,WAAW,MAAM,GAAG,QAAQ,QAAQ,EAAE;gBAC5C,MAAM,YAAY,QAAQ,OAAO,CAAC,GAAG,CAAC;gBACtC,IAAI,WAAW;oBACd,IAAI,SAAS,CAAC,cAAc;oBAC5B,QAAQ,OAAO,CAAC,MAAM,CAAC;gBACxB;gBACA,QAAQ,OAAO,CAAC,OAAO,CAAC,CAAC,OAAO;oBAC/B,IAAI,SAAS,CAAC,KAAK;gBACpB;gBACA,OAAO,IAAI,IAAI,CAAC;YACjB;QAAG;QACH,QAAQ;YAAE,SAAS,CAAC;QAAE;IACvB;AACD","ignoreList":[0]}},
    {"offset": {"line": 9714, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/device-authorization-9_f1Up5D.mjs"],"sourcesContent":["import { r as generateRandomString } from \"./crypto-CFUhAR9W.mjs\";\nimport { t as mergeSchema } from \"./schema-Bb7wzeK_.mjs\";\nimport { r as getSessionFromCtx } from \"./session-AaRl3_x-.mjs\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { ms } from \"ms\";\n\n//#region src/plugins/device-authorization/error-codes.ts\nconst DEVICE_AUTHORIZATION_ERROR_CODES = defineErrorCodes({\n\tINVALID_DEVICE_CODE: \"Invalid device code\",\n\tEXPIRED_DEVICE_CODE: \"Device code has expired\",\n\tEXPIRED_USER_CODE: \"User code has expired\",\n\tAUTHORIZATION_PENDING: \"Authorization pending\",\n\tACCESS_DENIED: \"Access denied\",\n\tINVALID_USER_CODE: \"Invalid user code\",\n\tDEVICE_CODE_ALREADY_PROCESSED: \"Device code already processed\",\n\tPOLLING_TOO_FREQUENTLY: \"Polling too frequently\",\n\tUSER_NOT_FOUND: \"User not found\",\n\tFAILED_TO_CREATE_SESSION: \"Failed to create session\",\n\tINVALID_DEVICE_CODE_STATUS: \"Invalid device code status\",\n\tAUTHENTICATION_REQUIRED: \"Authentication required\"\n});\n\n//#endregion\n//#region src/plugins/device-authorization/schema.ts\nconst schema = { deviceCode: { fields: {\n\tdeviceCode: {\n\t\ttype: \"string\",\n\t\trequired: true\n\t},\n\tuserCode: {\n\t\ttype: \"string\",\n\t\trequired: true\n\t},\n\tuserId: {\n\t\ttype: \"string\",\n\t\trequired: false\n\t},\n\texpiresAt: {\n\t\ttype: \"date\",\n\t\trequired: true\n\t},\n\tstatus: {\n\t\ttype: \"string\",\n\t\trequired: true\n\t},\n\tlastPolledAt: {\n\t\ttype: \"date\",\n\t\trequired: false\n\t},\n\tpollingInterval: {\n\t\ttype: \"number\",\n\t\trequired: false\n\t},\n\tclientId: {\n\t\ttype: \"string\",\n\t\trequired: false\n\t},\n\tscope: {\n\t\ttype: \"string\",\n\t\trequired: false\n\t}\n} } };\nconst deviceCode = z.object({\n\tid: z.string(),\n\tdeviceCode: z.string(),\n\tuserCode: z.string(),\n\tuserId: z.string().optional(),\n\texpiresAt: z.date(),\n\tstatus: z.string(),\n\tlastPolledAt: z.date().optional(),\n\tpollingInterval: z.number().optional(),\n\tclientId: z.string().optional(),\n\tscope: z.string().optional()\n});\n\n//#endregion\n//#region src/plugins/device-authorization/index.ts\nconst msStringValueSchema = z.custom((val) => {\n\ttry {\n\t\tms(val);\n\t} catch (e) {\n\t\treturn false;\n\t}\n\treturn true;\n}, { message: \"Invalid time string format. Use formats like '30m', '5s', '1h', etc.\" });\nconst deviceAuthorizationOptionsSchema = z.object({\n\texpiresIn: msStringValueSchema.default(\"30m\").describe(\"Time in seconds until the device code expires. Use formats like '30m', '5s', '1h', etc.\"),\n\tinterval: msStringValueSchema.default(\"5s\").describe(\"Time in seconds between polling attempts. Use formats like '30m', '5s', '1h', etc.\"),\n\tdeviceCodeLength: z.number().int().positive().default(40).describe(\"Length of the device code to be generated. Default is 40 characters.\"),\n\tuserCodeLength: z.number().int().positive().default(8).describe(\"Length of the user code to be generated. Default is 8 characters.\"),\n\tgenerateDeviceCode: z.custom((val) => typeof val === \"function\", { message: \"generateDeviceCode must be a function that returns a string or a promise that resolves to a string.\" }).optional().describe(\"Function to generate a device code. If not provided, a default random string generator will be used.\"),\n\tgenerateUserCode: z.custom((val) => typeof val === \"function\", { message: \"generateUserCode must be a function that returns a string or a promise that resolves to a string.\" }).optional().describe(\"Function to generate a user code. If not provided, a default random string generator will be used.\"),\n\tvalidateClient: z.custom((val) => typeof val === \"function\", { message: \"validateClient must be a function that returns a boolean or a promise that resolves to a boolean.\" }).optional().describe(\"Function to validate the client ID. If not provided, no validation will be performed.\"),\n\tonDeviceAuthRequest: z.custom((val) => typeof val === \"function\", { message: \"onDeviceAuthRequest must be a function that returns void or a promise that resolves to void.\" }).optional().describe(\"Function to handle device authorization requests. If not provided, no additional actions will be taken.\"),\n\tverificationUri: z.string().optional().describe(\"The URI where users verify their device code. Can be an absolute URL (https://example.com/device) or relative path (/custom-path). This will be returned as verification_uri in the device code response. If not provided, defaults to /device.\"),\n\tschema: z.custom(() => true)\n});\nconst defaultCharset = \"ABCDEFGHJKLMNPQRSTUVWXYZ23456789\";\n/**\n* @internal\n*/\nconst defaultGenerateDeviceCode = (length) => {\n\treturn generateRandomString(length, \"a-z\", \"A-Z\", \"0-9\");\n};\n/**\n* @internal\n*/\nconst defaultGenerateUserCode = (length) => {\n\tconst chars = new Uint8Array(length);\n\treturn Array.from(crypto.getRandomValues(chars)).map((byte) => defaultCharset[byte % 32]).join(\"\");\n};\n/**\n* @internal\n*/\nconst buildVerificationUris = (verificationUri, baseURL, userCode) => {\n\tconst uri = verificationUri || \"/device\";\n\tlet verificationUrl;\n\ttry {\n\t\tverificationUrl = new URL(uri);\n\t} catch {\n\t\tverificationUrl = new URL(uri, baseURL);\n\t}\n\tconst verificationUriCompleteUrl = new URL(verificationUrl);\n\tverificationUriCompleteUrl.searchParams.set(\"user_code\", userCode);\n\treturn {\n\t\tverificationUri: verificationUrl.toString(),\n\t\tverificationUriComplete: verificationUriCompleteUrl.toString()\n\t};\n};\nconst deviceAuthorization = (options = {}) => {\n\tconst opts = deviceAuthorizationOptionsSchema.parse(options);\n\tconst generateDeviceCode = async () => {\n\t\tif (opts.generateDeviceCode) return opts.generateDeviceCode();\n\t\treturn defaultGenerateDeviceCode(opts.deviceCodeLength);\n\t};\n\tconst generateUserCode = async () => {\n\t\tif (opts.generateUserCode) return opts.generateUserCode();\n\t\treturn defaultGenerateUserCode(opts.userCodeLength);\n\t};\n\treturn {\n\t\tid: \"device-authorization\",\n\t\tschema: mergeSchema(schema, options?.schema),\n\t\tendpoints: {\n\t\t\tdeviceCode: createAuthEndpoint(\"/device/code\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tclient_id: z.string().meta({ description: \"The client ID of the application\" }),\n\t\t\t\t\tscope: z.string().meta({ description: \"Space-separated list of scopes\" }).optional()\n\t\t\t\t}),\n\t\t\t\terror: z.object({\n\t\t\t\t\terror: z.enum([\"invalid_request\", \"invalid_client\"]).meta({ description: \"Error code\" }),\n\t\t\t\t\terror_description: z.string().meta({ description: \"Detailed error description\" })\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: `Request a device and user code\n\nFollow [rfc8628#section-3.2](https://datatracker.ietf.org/doc/html/rfc8628#section-3.2)`,\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\tdevice_code: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The device verification code\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tuser_code: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The user code to display\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tverification_uri: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The URL for user verification. Defaults to /device if not configured.\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tverification_uri_complete: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The complete URL with user code as query parameter.\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\texpires_in: {\n\t\t\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"Lifetime in seconds of the device code\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tinterval: {\n\t\t\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"Minimum polling interval in seconds\"\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t},\n\t\t\t\t\t\t400: {\n\t\t\t\t\t\t\tdescription: \"Error response\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\terror: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tenum: [\"invalid_request\", \"invalid_client\"]\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\terror_description: { type: \"string\" }\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (opts.validateClient) {\n\t\t\t\t\tif (!await opts.validateClient(ctx.body.client_id)) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\terror_description: \"Invalid client ID\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (opts.onDeviceAuthRequest) await opts.onDeviceAuthRequest(ctx.body.client_id, ctx.body.scope);\n\t\t\t\tconst deviceCode$1 = await generateDeviceCode();\n\t\t\t\tconst userCode = await generateUserCode();\n\t\t\t\tconst expiresIn = ms(opts.expiresIn);\n\t\t\t\tconst expiresAt = new Date(Date.now() + expiresIn);\n\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tdeviceCode: deviceCode$1,\n\t\t\t\t\t\tuserCode,\n\t\t\t\t\t\texpiresAt,\n\t\t\t\t\t\tstatus: \"pending\",\n\t\t\t\t\t\tpollingInterval: ms(opts.interval),\n\t\t\t\t\t\tclientId: ctx.body.client_id,\n\t\t\t\t\t\tscope: ctx.body.scope\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tconst { verificationUri, verificationUriComplete } = buildVerificationUris(opts.verificationUri, ctx.context.baseURL, userCode);\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tdevice_code: deviceCode$1,\n\t\t\t\t\tuser_code: userCode,\n\t\t\t\t\tverification_uri: verificationUri,\n\t\t\t\t\tverification_uri_complete: verificationUriComplete,\n\t\t\t\t\texpires_in: Math.floor(expiresIn / 1e3),\n\t\t\t\t\tinterval: Math.floor(ms(opts.interval) / 1e3)\n\t\t\t\t}, { headers: { \"Cache-Control\": \"no-store\" } });\n\t\t\t}),\n\t\t\tdeviceToken: createAuthEndpoint(\"/device/token\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tgrant_type: z.literal(\"urn:ietf:params:oauth:grant-type:device_code\").meta({ description: \"The grant type for device flow\" }),\n\t\t\t\t\tdevice_code: z.string().meta({ description: \"The device verification code\" }),\n\t\t\t\t\tclient_id: z.string().meta({ description: \"The client ID of the application\" })\n\t\t\t\t}),\n\t\t\t\terror: z.object({\n\t\t\t\t\terror: z.enum([\n\t\t\t\t\t\t\"authorization_pending\",\n\t\t\t\t\t\t\"slow_down\",\n\t\t\t\t\t\t\"expired_token\",\n\t\t\t\t\t\t\"access_denied\",\n\t\t\t\t\t\t\"invalid_request\",\n\t\t\t\t\t\t\"invalid_grant\"\n\t\t\t\t\t]).meta({ description: \"Error code\" }),\n\t\t\t\t\terror_description: z.string().meta({ description: \"Detailed error description\" })\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: `Exchange device code for access token\n\nFollow [rfc8628#section-3.4](https://datatracker.ietf.org/doc/html/rfc8628#section-3.4)`,\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\tsession: { $ref: \"#/components/schemas/Session\" },\n\t\t\t\t\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" }\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t},\n\t\t\t\t\t\t400: {\n\t\t\t\t\t\t\tdescription: \"Error response\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\terror: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tenum: [\n\t\t\t\t\t\t\t\t\t\t\t\"authorization_pending\",\n\t\t\t\t\t\t\t\t\t\t\t\"slow_down\",\n\t\t\t\t\t\t\t\t\t\t\t\"expired_token\",\n\t\t\t\t\t\t\t\t\t\t\t\"access_denied\",\n\t\t\t\t\t\t\t\t\t\t\t\"invalid_request\",\n\t\t\t\t\t\t\t\t\t\t\t\"invalid_grant\"\n\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\terror_description: { type: \"string\" }\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { device_code, client_id } = ctx.body;\n\t\t\t\tif (opts.validateClient) {\n\t\t\t\t\tif (!await opts.validateClient(client_id)) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\t\terror_description: \"Invalid client ID\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst deviceCodeRecord = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"deviceCode\",\n\t\t\t\t\t\tvalue: device_code\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!deviceCodeRecord) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.INVALID_DEVICE_CODE\n\t\t\t\t});\n\t\t\t\tif (deviceCodeRecord.clientId && deviceCodeRecord.clientId !== client_id) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\terror_description: \"Client ID mismatch\"\n\t\t\t\t});\n\t\t\t\tif (deviceCodeRecord.lastPolledAt && deviceCodeRecord.pollingInterval) {\n\t\t\t\t\tif (Date.now() - new Date(deviceCodeRecord.lastPolledAt).getTime() < deviceCodeRecord.pollingInterval) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"slow_down\",\n\t\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.POLLING_TOO_FREQUENTLY\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tawait ctx.context.adapter.update({\n\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: deviceCodeRecord.id\n\t\t\t\t\t}],\n\t\t\t\t\tupdate: { lastPolledAt: /* @__PURE__ */ new Date() }\n\t\t\t\t});\n\t\t\t\tif (deviceCodeRecord.expiresAt < /* @__PURE__ */ new Date()) {\n\t\t\t\t\tawait ctx.context.adapter.delete({\n\t\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\tvalue: deviceCodeRecord.id\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"expired_token\",\n\t\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.EXPIRED_DEVICE_CODE\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (deviceCodeRecord.status === \"pending\") throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"authorization_pending\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.AUTHORIZATION_PENDING\n\t\t\t\t});\n\t\t\t\tif (deviceCodeRecord.status === \"denied\") {\n\t\t\t\t\tawait ctx.context.adapter.delete({\n\t\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\tvalue: deviceCodeRecord.id\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"access_denied\",\n\t\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.ACCESS_DENIED\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (deviceCodeRecord.status === \"approved\" && deviceCodeRecord.userId) {\n\t\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(deviceCodeRecord.userId);\n\t\t\t\t\tif (!user) throw new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\t\terror: \"server_error\",\n\t\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.USER_NOT_FOUND\n\t\t\t\t\t});\n\t\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(user.id);\n\t\t\t\t\tif (!session) throw new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\t\terror: \"server_error\",\n\t\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.FAILED_TO_CREATE_SESSION\n\t\t\t\t\t});\n\t\t\t\t\tctx.context.setNewSession({\n\t\t\t\t\t\tsession,\n\t\t\t\t\t\tuser\n\t\t\t\t\t});\n\t\t\t\t\tif (ctx.context.options.secondaryStorage) await ctx.context.secondaryStorage?.set(session.token, JSON.stringify({\n\t\t\t\t\t\tuser,\n\t\t\t\t\t\tsession\n\t\t\t\t\t}), Math.floor((new Date(session.expiresAt).getTime() - Date.now()) / 1e3));\n\t\t\t\t\tawait ctx.context.adapter.delete({\n\t\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\tvalue: deviceCodeRecord.id\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\taccess_token: session.token,\n\t\t\t\t\t\ttoken_type: \"Bearer\",\n\t\t\t\t\t\texpires_in: Math.floor((new Date(session.expiresAt).getTime() - Date.now()) / 1e3),\n\t\t\t\t\t\tscope: deviceCodeRecord.scope || \"\"\n\t\t\t\t\t}, { headers: {\n\t\t\t\t\t\t\"Cache-Control\": \"no-store\",\n\t\t\t\t\t\tPragma: \"no-cache\"\n\t\t\t\t\t} });\n\t\t\t\t}\n\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\terror: \"server_error\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.INVALID_DEVICE_CODE_STATUS\n\t\t\t\t});\n\t\t\t}),\n\t\t\tdeviceVerify: createAuthEndpoint(\"/device\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tquery: z.object({ user_code: z.string().meta({ description: \"The user code to verify\" }) }),\n\t\t\t\terror: z.object({\n\t\t\t\t\terror: z.enum([\"invalid_request\"]).meta({ description: \"Error code\" }),\n\t\t\t\t\terror_description: z.string().meta({ description: \"Detailed error description\" })\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Verify user code and get device authorization status\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Device authorization status\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tuser_code: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"The user code to verify\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tenum: [\n\t\t\t\t\t\t\t\t\t\t\"pending\",\n\t\t\t\t\t\t\t\t\t\t\"approved\",\n\t\t\t\t\t\t\t\t\t\t\"denied\"\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tdescription: \"Current status of the device authorization\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { user_code } = ctx.query;\n\t\t\t\tconst cleanUserCode = user_code.replace(/-/g, \"\");\n\t\t\t\tconst deviceCodeRecord = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userCode\",\n\t\t\t\t\t\tvalue: cleanUserCode\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!deviceCodeRecord) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.INVALID_USER_CODE\n\t\t\t\t});\n\t\t\t\tif (deviceCodeRecord.expiresAt < /* @__PURE__ */ new Date()) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"expired_token\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.EXPIRED_USER_CODE\n\t\t\t\t});\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tuser_code,\n\t\t\t\t\tstatus: deviceCodeRecord.status\n\t\t\t\t});\n\t\t\t}),\n\t\t\tdeviceApprove: createAuthEndpoint(\"/device/approve\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ userCode: z.string().meta({ description: \"The user code to approve\" }) }),\n\t\t\t\terror: z.object({\n\t\t\t\t\terror: z.enum([\n\t\t\t\t\t\t\"invalid_request\",\n\t\t\t\t\t\t\"expired_token\",\n\t\t\t\t\t\t\"device_code_already_processed\"\n\t\t\t\t\t]).meta({ description: \"Error code\" }),\n\t\t\t\t\terror_description: z.string().meta({ description: \"Detailed error description\" })\n\t\t\t\t}),\n\t\t\t\trequireHeaders: true,\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Approve device authorization\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { success: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\t\tif (!session) throw new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\terror: \"unauthorized\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.AUTHENTICATION_REQUIRED\n\t\t\t\t});\n\t\t\t\tconst { userCode } = ctx.body;\n\t\t\t\tconst cleanUserCode = userCode.replace(/-/g, \"\");\n\t\t\t\tconst deviceCodeRecord = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userCode\",\n\t\t\t\t\t\tvalue: cleanUserCode\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!deviceCodeRecord) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.INVALID_USER_CODE\n\t\t\t\t});\n\t\t\t\tif (deviceCodeRecord.expiresAt < /* @__PURE__ */ new Date()) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"expired_token\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.EXPIRED_USER_CODE\n\t\t\t\t});\n\t\t\t\tif (deviceCodeRecord.status !== \"pending\") throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.DEVICE_CODE_ALREADY_PROCESSED\n\t\t\t\t});\n\t\t\t\tawait ctx.context.adapter.update({\n\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: deviceCodeRecord.id\n\t\t\t\t\t}],\n\t\t\t\t\tupdate: {\n\t\t\t\t\t\tstatus: \"approved\",\n\t\t\t\t\t\tuserId: session.user.id\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn ctx.json({ success: true });\n\t\t\t}),\n\t\t\tdeviceDeny: createAuthEndpoint(\"/device/deny\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ userCode: z.string().meta({ description: \"The user code to deny\" }) }),\n\t\t\t\terror: z.object({\n\t\t\t\t\terror: z.enum([\"invalid_request\", \"expired_token\"]).meta({ description: \"Error code\" }),\n\t\t\t\t\terror_description: z.string().meta({ description: \"Detailed error description\" })\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Deny device authorization\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { success: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { userCode } = ctx.body;\n\t\t\t\tconst cleanUserCode = userCode.replace(/-/g, \"\");\n\t\t\t\tconst deviceCodeRecord = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userCode\",\n\t\t\t\t\t\tvalue: cleanUserCode\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!deviceCodeRecord) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.INVALID_USER_CODE\n\t\t\t\t});\n\t\t\t\tif (deviceCodeRecord.expiresAt < /* @__PURE__ */ new Date()) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"expired_token\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.EXPIRED_USER_CODE\n\t\t\t\t});\n\t\t\t\tif (deviceCodeRecord.status !== \"pending\") throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.DEVICE_CODE_ALREADY_PROCESSED\n\t\t\t\t});\n\t\t\t\tawait ctx.context.adapter.update({\n\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: deviceCodeRecord.id\n\t\t\t\t\t}],\n\t\t\t\t\tupdate: { status: \"denied\" }\n\t\t\t\t});\n\t\t\t\treturn ctx.json({ success: true });\n\t\t\t})\n\t\t},\n\t\t$ERROR_CODES: DEVICE_AUTHORIZATION_ERROR_CODES\n\t};\n};\n\n//#endregion\nexport { deviceAuthorizationOptionsSchema as n, deviceAuthorization as t };"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA,yDAAyD;AACzD,MAAM,mCAAmC,IAAA,qOAAgB,EAAC;IACzD,qBAAqB;IACrB,qBAAqB;IACrB,mBAAmB;IACnB,uBAAuB;IACvB,eAAe;IACf,mBAAmB;IACnB,+BAA+B;IAC/B,wBAAwB;IACxB,gBAAgB;IAChB,0BAA0B;IAC1B,4BAA4B;IAC5B,yBAAyB;AAC1B;AAEA,YAAY;AACZ,oDAAoD;AACpD,MAAM,SAAS;IAAE,YAAY;QAAE,QAAQ;YACtC,YAAY;gBACX,MAAM;gBACN,UAAU;YACX;YACA,UAAU;gBACT,MAAM;gBACN,UAAU;YACX;YACA,QAAQ;gBACP,MAAM;gBACN,UAAU;YACX;YACA,WAAW;gBACV,MAAM;gBACN,UAAU;YACX;YACA,QAAQ;gBACP,MAAM;gBACN,UAAU;YACX;YACA,cAAc;gBACb,MAAM;gBACN,UAAU;YACX;YACA,iBAAiB;gBAChB,MAAM;gBACN,UAAU;YACX;YACA,UAAU;gBACT,MAAM;gBACN,UAAU;YACX;YACA,OAAO;gBACN,MAAM;gBACN,UAAU;YACX;QACD;IAAE;AAAE;AACJ,MAAM,aAAa,2JAAQ,CAAC;IAC3B,IAAI,2JAAQ;IACZ,YAAY,2JAAQ;IACpB,UAAU,2JAAQ;IAClB,QAAQ,2JAAQ,GAAG,QAAQ;IAC3B,WAAW,yJAAM;IACjB,QAAQ,2JAAQ;IAChB,cAAc,yJAAM,GAAG,QAAQ;IAC/B,iBAAiB,2JAAQ,GAAG,QAAQ;IACpC,UAAU,2JAAQ,GAAG,QAAQ;IAC7B,OAAO,2JAAQ,GAAG,QAAQ;AAC3B;AAEA,YAAY;AACZ,mDAAmD;AACnD,MAAM,sBAAsB,2JAAQ,CAAC,CAAC;IACrC,IAAI;QACH,IAAA,6KAAE,EAAC;IACJ,EAAE,OAAO,GAAG;QACX,OAAO;IACR;IACA,OAAO;AACR,GAAG;IAAE,SAAS;AAAuE;AACrF,MAAM,mCAAmC,2JAAQ,CAAC;IACjD,WAAW,oBAAoB,OAAO,CAAC,OAAO,QAAQ,CAAC;IACvD,UAAU,oBAAoB,OAAO,CAAC,MAAM,QAAQ,CAAC;IACrD,kBAAkB,2JAAQ,GAAG,GAAG,GAAG,QAAQ,GAAG,OAAO,CAAC,IAAI,QAAQ,CAAC;IACnE,gBAAgB,2JAAQ,GAAG,GAAG,GAAG,QAAQ,GAAG,OAAO,CAAC,GAAG,QAAQ,CAAC;IAChE,oBAAoB,2JAAQ,CAAC,CAAC,MAAQ,OAAO,QAAQ,YAAY;QAAE,SAAS;IAAsG,GAAG,QAAQ,GAAG,QAAQ,CAAC;IACzM,kBAAkB,2JAAQ,CAAC,CAAC,MAAQ,OAAO,QAAQ,YAAY;QAAE,SAAS;IAAoG,GAAG,QAAQ,GAAG,QAAQ,CAAC;IACrM,gBAAgB,2JAAQ,CAAC,CAAC,MAAQ,OAAO,QAAQ,YAAY;QAAE,SAAS;IAAoG,GAAG,QAAQ,GAAG,QAAQ,CAAC;IACnM,qBAAqB,2JAAQ,CAAC,CAAC,MAAQ,OAAO,QAAQ,YAAY;QAAE,SAAS;IAA+F,GAAG,QAAQ,GAAG,QAAQ,CAAC;IACnM,iBAAiB,2JAAQ,GAAG,QAAQ,GAAG,QAAQ,CAAC;IAChD,QAAQ,2JAAQ,CAAC,IAAM;AACxB;AACA,MAAM,iBAAiB;AACvB;;AAEA,GACA,MAAM,4BAA4B,CAAC;IAClC,OAAO,IAAA,oKAAoB,EAAC,QAAQ,OAAO,OAAO;AACnD;AACA;;AAEA,GACA,MAAM,0BAA0B,CAAC;IAChC,MAAM,QAAQ,IAAI,WAAW;IAC7B,OAAO,MAAM,IAAI,CAAC,OAAO,eAAe,CAAC,QAAQ,GAAG,CAAC,CAAC,OAAS,cAAc,CAAC,OAAO,GAAG,EAAE,IAAI,CAAC;AAChG;AACA;;AAEA,GACA,MAAM,wBAAwB,CAAC,iBAAiB,SAAS;IACxD,MAAM,MAAM,mBAAmB;IAC/B,IAAI;IACJ,IAAI;QACH,kBAAkB,IAAI,IAAI;IAC3B,EAAE,OAAM;QACP,kBAAkB,IAAI,IAAI,KAAK;IAChC;IACA,MAAM,6BAA6B,IAAI,IAAI;IAC3C,2BAA2B,YAAY,CAAC,GAAG,CAAC,aAAa;IACzD,OAAO;QACN,iBAAiB,gBAAgB,QAAQ;QACzC,yBAAyB,2BAA2B,QAAQ;IAC7D;AACD;AACA,MAAM,sBAAsB,CAAC,UAAU,CAAC,CAAC;IACxC,MAAM,OAAO,iCAAiC,KAAK,CAAC;IACpD,MAAM,qBAAqB;QAC1B,IAAI,KAAK,kBAAkB,EAAE,OAAO,KAAK,kBAAkB;QAC3D,OAAO,0BAA0B,KAAK,gBAAgB;IACvD;IACA,MAAM,mBAAmB;QACxB,IAAI,KAAK,gBAAgB,EAAE,OAAO,KAAK,gBAAgB;QACvD,OAAO,wBAAwB,KAAK,cAAc;IACnD;IACA,OAAO;QACN,IAAI;QACJ,QAAQ,IAAA,oKAAW,EAAC,QAAQ,SAAS;QACrC,WAAW;YACV,YAAY,IAAA,yLAAkB,EAAC,gBAAgB;gBAC9C,QAAQ;gBACR,MAAM,2JAAQ,CAAC;oBACd,WAAW,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAAmC;oBAC7E,OAAO,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAAiC,GAAG,QAAQ;gBACnF;gBACA,OAAO,2JAAQ,CAAC;oBACf,OAAO,yJAAM,CAAC;wBAAC;wBAAmB;qBAAiB,EAAE,IAAI,CAAC;wBAAE,aAAa;oBAAa;oBACtF,mBAAmB,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAA6B;gBAChF;gBACA,UAAU;oBAAE,SAAS;wBACpB,aAAa,CAAC;;uFAEoE,CAAC;wBACnF,WAAW;4BACV,KAAK;gCACJ,aAAa;gCACb,SAAS;oCAAE,oBAAoB;wCAAE,QAAQ;4CACxC,MAAM;4CACN,YAAY;gDACX,aAAa;oDACZ,MAAM;oDACN,aAAa;gDACd;gDACA,WAAW;oDACV,MAAM;oDACN,aAAa;gDACd;gDACA,kBAAkB;oDACjB,MAAM;oDACN,QAAQ;oDACR,aAAa;gDACd;gDACA,2BAA2B;oDAC1B,MAAM;oDACN,QAAQ;oDACR,aAAa;gDACd;gDACA,YAAY;oDACX,MAAM;oDACN,aAAa;gDACd;gDACA,UAAU;oDACT,MAAM;oDACN,aAAa;gDACd;4CACD;wCACD;oCAAE;gCAAE;4BACL;4BACA,KAAK;gCACJ,aAAa;gCACb,SAAS;oCAAE,oBAAoB;wCAAE,QAAQ;4CACxC,MAAM;4CACN,YAAY;gDACX,OAAO;oDACN,MAAM;oDACN,MAAM;wDAAC;wDAAmB;qDAAiB;gDAC5C;gDACA,mBAAmB;oDAAE,MAAM;gDAAS;4CACrC;wCACD;oCAAE;gCAAE;4BACL;wBACD;oBACD;gBAAE;YACH,GAAG,OAAO;gBACT,IAAI,KAAK,cAAc,EAAE;oBACxB,IAAI,CAAC,MAAM,KAAK,cAAc,CAAC,IAAI,IAAI,CAAC,SAAS,GAAG,MAAM,IAAI,6JAAQ,CAAC,eAAe;wBACrF,OAAO;wBACP,mBAAmB;oBACpB;gBACD;gBACA,IAAI,KAAK,mBAAmB,EAAE,MAAM,KAAK,mBAAmB,CAAC,IAAI,IAAI,CAAC,SAAS,EAAE,IAAI,IAAI,CAAC,KAAK;gBAC/F,MAAM,eAAe,MAAM;gBAC3B,MAAM,WAAW,MAAM;gBACvB,MAAM,YAAY,IAAA,6KAAE,EAAC,KAAK,SAAS;gBACnC,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK;gBACxC,MAAM,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC;oBAChC,OAAO;oBACP,MAAM;wBACL,YAAY;wBACZ;wBACA;wBACA,QAAQ;wBACR,iBAAiB,IAAA,6KAAE,EAAC,KAAK,QAAQ;wBACjC,UAAU,IAAI,IAAI,CAAC,SAAS;wBAC5B,OAAO,IAAI,IAAI,CAAC,KAAK;oBACtB;gBACD;gBACA,MAAM,EAAE,eAAe,EAAE,uBAAuB,EAAE,GAAG,sBAAsB,KAAK,eAAe,EAAE,IAAI,OAAO,CAAC,OAAO,EAAE;gBACtH,OAAO,IAAI,IAAI,CAAC;oBACf,aAAa;oBACb,WAAW;oBACX,kBAAkB;oBAClB,2BAA2B;oBAC3B,YAAY,KAAK,KAAK,CAAC,YAAY;oBACnC,UAAU,KAAK,KAAK,CAAC,IAAA,6KAAE,EAAC,KAAK,QAAQ,IAAI;gBAC1C,GAAG;oBAAE,SAAS;wBAAE,iBAAiB;oBAAW;gBAAE;YAC/C;YACA,aAAa,IAAA,yLAAkB,EAAC,iBAAiB;gBAChD,QAAQ;gBACR,MAAM,2JAAQ,CAAC;oBACd,YAAY,4JAAS,CAAC,gDAAgD,IAAI,CAAC;wBAAE,aAAa;oBAAiC;oBAC3H,aAAa,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAA+B;oBAC3E,WAAW,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAAmC;gBAC9E;gBACA,OAAO,2JAAQ,CAAC;oBACf,OAAO,yJAAM,CAAC;wBACb;wBACA;wBACA;wBACA;wBACA;wBACA;qBACA,EAAE,IAAI,CAAC;wBAAE,aAAa;oBAAa;oBACpC,mBAAmB,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAA6B;gBAChF;gBACA,UAAU;oBAAE,SAAS;wBACpB,aAAa,CAAC;;uFAEoE,CAAC;wBACnF,WAAW;4BACV,KAAK;gCACJ,aAAa;gCACb,SAAS;oCAAE,oBAAoB;wCAAE,QAAQ;4CACxC,MAAM;4CACN,YAAY;gDACX,SAAS;oDAAE,MAAM;gDAA+B;gDAChD,MAAM;oDAAE,MAAM;gDAA4B;4CAC3C;wCACD;oCAAE;gCAAE;4BACL;4BACA,KAAK;gCACJ,aAAa;gCACb,SAAS;oCAAE,oBAAoB;wCAAE,QAAQ;4CACxC,MAAM;4CACN,YAAY;gDACX,OAAO;oDACN,MAAM;oDACN,MAAM;wDACL;wDACA;wDACA;wDACA;wDACA;wDACA;qDACA;gDACF;gDACA,mBAAmB;oDAAE,MAAM;gDAAS;4CACrC;wCACD;oCAAE;gCAAE;4BACL;wBACD;oBACD;gBAAE;YACH,GAAG,OAAO;gBACT,MAAM,EAAE,WAAW,EAAE,SAAS,EAAE,GAAG,IAAI,IAAI;gBAC3C,IAAI,KAAK,cAAc,EAAE;oBACxB,IAAI,CAAC,MAAM,KAAK,cAAc,CAAC,YAAY,MAAM,IAAI,6JAAQ,CAAC,eAAe;wBAC5E,OAAO;wBACP,mBAAmB;oBACpB;gBACD;gBACA,MAAM,mBAAmB,MAAM,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC;oBAC1D,OAAO;oBACP,OAAO;wBAAC;4BACP,OAAO;4BACP,OAAO;wBACR;qBAAE;gBACH;gBACA,IAAI,CAAC,kBAAkB,MAAM,IAAI,6JAAQ,CAAC,eAAe;oBACxD,OAAO;oBACP,mBAAmB,iCAAiC,mBAAmB;gBACxE;gBACA,IAAI,iBAAiB,QAAQ,IAAI,iBAAiB,QAAQ,KAAK,WAAW,MAAM,IAAI,6JAAQ,CAAC,eAAe;oBAC3G,OAAO;oBACP,mBAAmB;gBACpB;gBACA,IAAI,iBAAiB,YAAY,IAAI,iBAAiB,eAAe,EAAE;oBACtE,IAAI,KAAK,GAAG,KAAK,IAAI,KAAK,iBAAiB,YAAY,EAAE,OAAO,KAAK,iBAAiB,eAAe,EAAE,MAAM,IAAI,6JAAQ,CAAC,eAAe;wBACxI,OAAO;wBACP,mBAAmB,iCAAiC,sBAAsB;oBAC3E;gBACD;gBACA,MAAM,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC;oBAChC,OAAO;oBACP,OAAO;wBAAC;4BACP,OAAO;4BACP,OAAO,iBAAiB,EAAE;wBAC3B;qBAAE;oBACF,QAAQ;wBAAE,cAAc,aAAa,GAAG,IAAI;oBAAO;gBACpD;gBACA,IAAI,iBAAiB,SAAS,GAAG,aAAa,GAAG,IAAI,QAAQ;oBAC5D,MAAM,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC;wBAChC,OAAO;wBACP,OAAO;4BAAC;gCACP,OAAO;gCACP,OAAO,iBAAiB,EAAE;4BAC3B;yBAAE;oBACH;oBACA,MAAM,IAAI,6JAAQ,CAAC,eAAe;wBACjC,OAAO;wBACP,mBAAmB,iCAAiC,mBAAmB;oBACxE;gBACD;gBACA,IAAI,iBAAiB,MAAM,KAAK,WAAW,MAAM,IAAI,6JAAQ,CAAC,eAAe;oBAC5E,OAAO;oBACP,mBAAmB,iCAAiC,qBAAqB;gBAC1E;gBACA,IAAI,iBAAiB,MAAM,KAAK,UAAU;oBACzC,MAAM,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC;wBAChC,OAAO;wBACP,OAAO;4BAAC;gCACP,OAAO;gCACP,OAAO,iBAAiB,EAAE;4BAC3B;yBAAE;oBACH;oBACA,MAAM,IAAI,6JAAQ,CAAC,eAAe;wBACjC,OAAO;wBACP,mBAAmB,iCAAiC,aAAa;oBAClE;gBACD;gBACA,IAAI,iBAAiB,MAAM,KAAK,cAAc,iBAAiB,MAAM,EAAE;oBACtE,MAAM,OAAO,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,YAAY,CAAC,iBAAiB,MAAM;oBACnF,IAAI,CAAC,MAAM,MAAM,IAAI,6JAAQ,CAAC,yBAAyB;wBACtD,OAAO;wBACP,mBAAmB,iCAAiC,cAAc;oBACnE;oBACA,MAAM,UAAU,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,aAAa,CAAC,KAAK,EAAE;oBACvE,IAAI,CAAC,SAAS,MAAM,IAAI,6JAAQ,CAAC,yBAAyB;wBACzD,OAAO;wBACP,mBAAmB,iCAAiC,wBAAwB;oBAC7E;oBACA,IAAI,OAAO,CAAC,aAAa,CAAC;wBACzB;wBACA;oBACD;oBACA,IAAI,IAAI,OAAO,CAAC,OAAO,CAAC,gBAAgB,EAAE,MAAM,IAAI,OAAO,CAAC,gBAAgB,EAAE,IAAI,QAAQ,KAAK,EAAE,KAAK,SAAS,CAAC;wBAC/G;wBACA;oBACD,IAAI,KAAK,KAAK,CAAC,CAAC,IAAI,KAAK,QAAQ,SAAS,EAAE,OAAO,KAAK,KAAK,GAAG,EAAE,IAAI;oBACtE,MAAM,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC;wBAChC,OAAO;wBACP,OAAO;4BAAC;gCACP,OAAO;gCACP,OAAO,iBAAiB,EAAE;4BAC3B;yBAAE;oBACH;oBACA,OAAO,IAAI,IAAI,CAAC;wBACf,cAAc,QAAQ,KAAK;wBAC3B,YAAY;wBACZ,YAAY,KAAK,KAAK,CAAC,CAAC,IAAI,KAAK,QAAQ,SAAS,EAAE,OAAO,KAAK,KAAK,GAAG,EAAE,IAAI;wBAC9E,OAAO,iBAAiB,KAAK,IAAI;oBAClC,GAAG;wBAAE,SAAS;4BACb,iBAAiB;4BACjB,QAAQ;wBACT;oBAAE;gBACH;gBACA,MAAM,IAAI,6JAAQ,CAAC,yBAAyB;oBAC3C,OAAO;oBACP,mBAAmB,iCAAiC,0BAA0B;gBAC/E;YACD;YACA,cAAc,IAAA,yLAAkB,EAAC,WAAW;gBAC3C,QAAQ;gBACR,OAAO,2JAAQ,CAAC;oBAAE,WAAW,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAA0B;gBAAG;gBACzF,OAAO,2JAAQ,CAAC;oBACf,OAAO,yJAAM,CAAC;wBAAC;qBAAkB,EAAE,IAAI,CAAC;wBAAE,aAAa;oBAAa;oBACpE,mBAAmB,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAA6B;gBAChF;gBACA,UAAU;oBAAE,SAAS;wBACpB,aAAa;wBACb,WAAW;4BAAE,KAAK;gCACjB,aAAa;gCACb,SAAS;oCAAE,oBAAoB;wCAAE,QAAQ;4CACxC,MAAM;4CACN,YAAY;gDACX,WAAW;oDACV,MAAM;oDACN,aAAa;gDACd;gDACA,QAAQ;oDACP,MAAM;oDACN,MAAM;wDACL;wDACA;wDACA;qDACA;oDACD,aAAa;gDACd;4CACD;wCACD;oCAAE;gCAAE;4BACL;wBAAE;oBACH;gBAAE;YACH,GAAG,OAAO;gBACT,MAAM,EAAE,SAAS,EAAE,GAAG,IAAI,KAAK;gBAC/B,MAAM,gBAAgB,UAAU,OAAO,CAAC,MAAM;gBAC9C,MAAM,mBAAmB,MAAM,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC;oBAC1D,OAAO;oBACP,OAAO;wBAAC;4BACP,OAAO;4BACP,OAAO;wBACR;qBAAE;gBACH;gBACA,IAAI,CAAC,kBAAkB,MAAM,IAAI,6JAAQ,CAAC,eAAe;oBACxD,OAAO;oBACP,mBAAmB,iCAAiC,iBAAiB;gBACtE;gBACA,IAAI,iBAAiB,SAAS,GAAG,aAAa,GAAG,IAAI,QAAQ,MAAM,IAAI,6JAAQ,CAAC,eAAe;oBAC9F,OAAO;oBACP,mBAAmB,iCAAiC,iBAAiB;gBACtE;gBACA,OAAO,IAAI,IAAI,CAAC;oBACf;oBACA,QAAQ,iBAAiB,MAAM;gBAChC;YACD;YACA,eAAe,IAAA,yLAAkB,EAAC,mBAAmB;gBACpD,QAAQ;gBACR,MAAM,2JAAQ,CAAC;oBAAE,UAAU,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAA2B;gBAAG;gBACxF,OAAO,2JAAQ,CAAC;oBACf,OAAO,yJAAM,CAAC;wBACb;wBACA;wBACA;qBACA,EAAE,IAAI,CAAC;wBAAE,aAAa;oBAAa;oBACpC,mBAAmB,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAA6B;gBAChF;gBACA,gBAAgB;gBAChB,UAAU;oBAAE,SAAS;wBACpB,aAAa;wBACb,WAAW;4BAAE,KAAK;gCACjB,aAAa;gCACb,SAAS;oCAAE,oBAAoB;wCAAE,QAAQ;4CACxC,MAAM;4CACN,YAAY;gDAAE,SAAS;oDAAE,MAAM;gDAAU;4CAAE;wCAC5C;oCAAE;gCAAE;4BACL;wBAAE;oBACH;gBAAE;YACH,GAAG,OAAO;gBACT,MAAM,UAAU,MAAM,IAAA,sKAAiB,EAAC;gBACxC,IAAI,CAAC,SAAS,MAAM,IAAI,6JAAQ,CAAC,gBAAgB;oBAChD,OAAO;oBACP,mBAAmB,iCAAiC,uBAAuB;gBAC5E;gBACA,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,IAAI;gBAC7B,MAAM,gBAAgB,SAAS,OAAO,CAAC,MAAM;gBAC7C,MAAM,mBAAmB,MAAM,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC;oBAC1D,OAAO;oBACP,OAAO;wBAAC;4BACP,OAAO;4BACP,OAAO;wBACR;qBAAE;gBACH;gBACA,IAAI,CAAC,kBAAkB,MAAM,IAAI,6JAAQ,CAAC,eAAe;oBACxD,OAAO;oBACP,mBAAmB,iCAAiC,iBAAiB;gBACtE;gBACA,IAAI,iBAAiB,SAAS,GAAG,aAAa,GAAG,IAAI,QAAQ,MAAM,IAAI,6JAAQ,CAAC,eAAe;oBAC9F,OAAO;oBACP,mBAAmB,iCAAiC,iBAAiB;gBACtE;gBACA,IAAI,iBAAiB,MAAM,KAAK,WAAW,MAAM,IAAI,6JAAQ,CAAC,eAAe;oBAC5E,OAAO;oBACP,mBAAmB,iCAAiC,6BAA6B;gBAClF;gBACA,MAAM,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC;oBAChC,OAAO;oBACP,OAAO;wBAAC;4BACP,OAAO;4BACP,OAAO,iBAAiB,EAAE;wBAC3B;qBAAE;oBACF,QAAQ;wBACP,QAAQ;wBACR,QAAQ,QAAQ,IAAI,CAAC,EAAE;oBACxB;gBACD;gBACA,OAAO,IAAI,IAAI,CAAC;oBAAE,SAAS;gBAAK;YACjC;YACA,YAAY,IAAA,yLAAkB,EAAC,gBAAgB;gBAC9C,QAAQ;gBACR,MAAM,2JAAQ,CAAC;oBAAE,UAAU,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAAwB;gBAAG;gBACrF,OAAO,2JAAQ,CAAC;oBACf,OAAO,yJAAM,CAAC;wBAAC;wBAAmB;qBAAgB,EAAE,IAAI,CAAC;wBAAE,aAAa;oBAAa;oBACrF,mBAAmB,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAA6B;gBAChF;gBACA,UAAU;oBAAE,SAAS;wBACpB,aAAa;wBACb,WAAW;4BAAE,KAAK;gCACjB,aAAa;gCACb,SAAS;oCAAE,oBAAoB;wCAAE,QAAQ;4CACxC,MAAM;4CACN,YAAY;gDAAE,SAAS;oDAAE,MAAM;gDAAU;4CAAE;wCAC5C;oCAAE;gCAAE;4BACL;wBAAE;oBACH;gBAAE;YACH,GAAG,OAAO;gBACT,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,IAAI;gBAC7B,MAAM,gBAAgB,SAAS,OAAO,CAAC,MAAM;gBAC7C,MAAM,mBAAmB,MAAM,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC;oBAC1D,OAAO;oBACP,OAAO;wBAAC;4BACP,OAAO;4BACP,OAAO;wBACR;qBAAE;gBACH;gBACA,IAAI,CAAC,kBAAkB,MAAM,IAAI,6JAAQ,CAAC,eAAe;oBACxD,OAAO;oBACP,mBAAmB,iCAAiC,iBAAiB;gBACtE;gBACA,IAAI,iBAAiB,SAAS,GAAG,aAAa,GAAG,IAAI,QAAQ,MAAM,IAAI,6JAAQ,CAAC,eAAe;oBAC9F,OAAO;oBACP,mBAAmB,iCAAiC,iBAAiB;gBACtE;gBACA,IAAI,iBAAiB,MAAM,KAAK,WAAW,MAAM,IAAI,6JAAQ,CAAC,eAAe;oBAC5E,OAAO;oBACP,mBAAmB,iCAAiC,6BAA6B;gBAClF;gBACA,MAAM,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC;oBAChC,OAAO;oBACP,OAAO;wBAAC;4BACP,OAAO;4BACP,OAAO,iBAAiB,EAAE;wBAC3B;qBAAE;oBACF,QAAQ;wBAAE,QAAQ;oBAAS;gBAC5B;gBACA,OAAO,IAAI,IAAI,CAAC;oBAAE,SAAS;gBAAK;YACjC;QACD;QACA,cAAc;IACf;AACD","ignoreList":[0]}},
    {"offset": {"line": 10465, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/email-otp-CiznqFUN.mjs"],"sourcesContent":["import { n as symmetricEncrypt, r as generateRandomString, t as symmetricDecrypt, u as constantTimeEqual } from \"./crypto-CFUhAR9W.mjs\";\nimport { u as getDate } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport { c as setSessionCookie, s as setCookieCache } from \"./cookies-D72PbWdz.mjs\";\nimport { r as getSessionFromCtx } from \"./session-AaRl3_x-.mjs\";\nimport { t as getEndpointResponse } from \"./plugin-helper-zFdFWLgL.mjs\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport * as z from \"zod\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\nimport { base64Url } from \"@better-auth/utils/base64\";\n\n//#region src/plugins/email-otp/utils.ts\nconst defaultKeyHasher = async (otp) => {\n\tconst hash = await createHash(\"SHA-256\").digest(new TextEncoder().encode(otp));\n\treturn base64Url.encode(new Uint8Array(hash), { padding: false });\n};\nfunction splitAtLastColon(input) {\n\tconst idx = input.lastIndexOf(\":\");\n\tif (idx === -1) return [input, \"\"];\n\treturn [input.slice(0, idx), input.slice(idx + 1)];\n}\n\n//#endregion\n//#region src/plugins/email-otp/index.ts\nconst types = [\n\t\"email-verification\",\n\t\"sign-in\",\n\t\"forget-password\"\n];\nconst defaultOTPGenerator = (options) => generateRandomString(options.otpLength ?? 6, \"0-9\");\nconst ERROR_CODES = defineErrorCodes({\n\tOTP_EXPIRED: \"OTP expired\",\n\tINVALID_OTP: \"Invalid OTP\",\n\tTOO_MANY_ATTEMPTS: \"Too many attempts\"\n});\nconst emailOTP = (options) => {\n\tconst opts = {\n\t\texpiresIn: 300,\n\t\tgenerateOTP: () => defaultOTPGenerator(options),\n\t\tstoreOTP: \"plain\",\n\t\t...options\n\t};\n\tasync function storeOTP(ctx, otp) {\n\t\tif (opts.storeOTP === \"encrypted\") return await symmetricEncrypt({\n\t\t\tkey: ctx.context.secret,\n\t\t\tdata: otp\n\t\t});\n\t\tif (opts.storeOTP === \"hashed\") return await defaultKeyHasher(otp);\n\t\tif (typeof opts.storeOTP === \"object\" && \"hash\" in opts.storeOTP) return await opts.storeOTP.hash(otp);\n\t\tif (typeof opts.storeOTP === \"object\" && \"encrypt\" in opts.storeOTP) return await opts.storeOTP.encrypt(otp);\n\t\treturn otp;\n\t}\n\tasync function verifyStoredOTP(ctx, storedOtp, otp) {\n\t\tif (opts.storeOTP === \"encrypted\") return constantTimeEqual(await symmetricDecrypt({\n\t\t\tkey: ctx.context.secret,\n\t\t\tdata: storedOtp\n\t\t}), otp);\n\t\tif (opts.storeOTP === \"hashed\") return constantTimeEqual(await defaultKeyHasher(otp), storedOtp);\n\t\tif (typeof opts.storeOTP === \"object\" && \"hash\" in opts.storeOTP) return constantTimeEqual(await opts.storeOTP.hash(otp), storedOtp);\n\t\tif (typeof opts.storeOTP === \"object\" && \"decrypt\" in opts.storeOTP) return constantTimeEqual(await opts.storeOTP.decrypt(storedOtp), otp);\n\t\treturn constantTimeEqual(otp, storedOtp);\n\t}\n\tconst endpoints = { sendVerificationOTP: createAuthEndpoint(\"/email-otp/send-verification-otp\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({\n\t\t\temail: z.string({}).meta({ description: \"Email address to send the OTP\" }),\n\t\t\ttype: z.enum(types).meta({ description: \"Type of the OTP\" })\n\t\t}),\n\t\tmetadata: { openapi: {\n\t\t\toperationId: \"sendEmailVerificationOTP\",\n\t\t\tdescription: \"Send a verification OTP to an email\",\n\t\t\tresponses: { 200: {\n\t\t\t\tdescription: \"Success\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: { success: { type: \"boolean\" } }\n\t\t\t\t} } }\n\t\t\t} }\n\t\t} }\n\t}, async (ctx) => {\n\t\tif (!options?.sendVerificationOTP) {\n\t\t\tctx.context.logger.error(\"send email verification is not implemented\");\n\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"send email verification is not implemented\" });\n\t\t}\n\t\tconst email = ctx.body.email.toLowerCase();\n\t\tif (!z.email().safeParse(email).success) throw ctx.error(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.INVALID_EMAIL });\n\t\tlet otp = opts.generateOTP({\n\t\t\temail,\n\t\t\ttype: ctx.body.type\n\t\t}, ctx) || defaultOTPGenerator(opts);\n\t\tlet storedOTP = await storeOTP(ctx, otp);\n\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\tvalue: `${storedOTP}:0`,\n\t\t\tidentifier: `${ctx.body.type}-otp-${email}`,\n\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\")\n\t\t}).catch(async (error) => {\n\t\t\tawait ctx.context.internalAdapter.deleteVerificationByIdentifier(`${ctx.body.type}-otp-${email}`);\n\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\tvalue: `${storedOTP}:0`,\n\t\t\t\tidentifier: `${ctx.body.type}-otp-${email}`,\n\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\")\n\t\t\t});\n\t\t});\n\t\tif (!await ctx.context.internalAdapter.findUserByEmail(email)) if (ctx.body.type === \"sign-in\" && !opts.disableSignUp) {} else {\n\t\t\tawait ctx.context.internalAdapter.deleteVerificationByIdentifier(`${ctx.body.type}-otp-${email}`);\n\t\t\treturn ctx.json({ success: true });\n\t\t}\n\t\tawait options.sendVerificationOTP({\n\t\t\temail,\n\t\t\totp,\n\t\t\ttype: ctx.body.type\n\t\t}, ctx);\n\t\treturn ctx.json({ success: true });\n\t}) };\n\treturn {\n\t\tid: \"email-otp\",\n\t\tinit(ctx) {\n\t\t\tif (!opts.overrideDefaultEmailVerification) return;\n\t\t\treturn { options: { emailVerification: { async sendVerificationEmail(data, request) {\n\t\t\t\tawait endpoints.sendVerificationOTP({\n\t\t\t\t\tcontext: ctx,\n\t\t\t\t\trequest,\n\t\t\t\t\tbody: {\n\t\t\t\t\t\temail: data.user.email,\n\t\t\t\t\t\ttype: \"email-verification\"\n\t\t\t\t\t},\n\t\t\t\t\tctx\n\t\t\t\t});\n\t\t\t} } } };\n\t\t},\n\t\tendpoints: {\n\t\t\t...endpoints,\n\t\t\tcreateVerificationOTP: createAuthEndpoint(\"/email-otp/create-verification-otp\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\temail: z.string({}).meta({ description: \"Email address to send the OTP\" }),\n\t\t\t\t\ttype: z.enum(types).meta({\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tdescription: \"Type of the OTP\"\n\t\t\t\t\t})\n\t\t\t\t}),\n\t\t\t\tmetadata: {\n\t\t\t\t\tSERVER_ONLY: true,\n\t\t\t\t\topenapi: {\n\t\t\t\t\t\toperationId: \"createEmailVerificationOTP\",\n\t\t\t\t\t\tdescription: \"Create a verification OTP for an email\",\n\t\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: { type: \"string\" } } }\n\t\t\t\t\t\t} }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst email = ctx.body.email.toLowerCase();\n\t\t\t\tconst otp = opts.generateOTP({\n\t\t\t\t\temail,\n\t\t\t\t\ttype: ctx.body.type\n\t\t\t\t}, ctx) || defaultOTPGenerator(opts);\n\t\t\t\tlet storedOTP = await storeOTP(ctx, otp);\n\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\tvalue: `${storedOTP}:0`,\n\t\t\t\t\tidentifier: `${ctx.body.type}-otp-${email}`,\n\t\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\")\n\t\t\t\t});\n\t\t\t\treturn otp;\n\t\t\t}),\n\t\t\tgetVerificationOTP: createAuthEndpoint(\"/email-otp/get-verification-otp\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tquery: z.object({\n\t\t\t\t\temail: z.string({}).meta({ description: \"Email address the OTP was sent to\" }),\n\t\t\t\t\ttype: z.enum(types).meta({\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tdescription: \"Type of the OTP\"\n\t\t\t\t\t})\n\t\t\t\t}),\n\t\t\t\tmetadata: {\n\t\t\t\t\tSERVER_ONLY: true,\n\t\t\t\t\topenapi: {\n\t\t\t\t\t\toperationId: \"getEmailVerificationOTP\",\n\t\t\t\t\t\tdescription: \"Get a verification OTP for an email\",\n\t\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\t\tdescription: \"OTP retrieved successfully or not found/expired\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: { otp: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\tdescription: \"The stored OTP, or null if not found or expired\"\n\t\t\t\t\t\t\t\t} },\n\t\t\t\t\t\t\t\trequired: [\"otp\"]\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t} }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst email = ctx.query.email.toLowerCase();\n\t\t\t\tconst verificationValue = await ctx.context.internalAdapter.findVerificationValue(`${ctx.query.type}-otp-${email}`);\n\t\t\t\tif (!verificationValue || verificationValue.expiresAt < /* @__PURE__ */ new Date()) return ctx.json({ otp: null });\n\t\t\t\tif (opts.storeOTP === \"hashed\" || typeof opts.storeOTP === \"object\" && \"hash\" in opts.storeOTP) throw new APIError(\"BAD_REQUEST\", { message: \"OTP is hashed, cannot return the plain text OTP\" });\n\t\t\t\tlet [storedOtp, _attempts] = splitAtLastColon(verificationValue.value);\n\t\t\t\tlet otp = storedOtp;\n\t\t\t\tif (opts.storeOTP === \"encrypted\") otp = await symmetricDecrypt({\n\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\tdata: storedOtp\n\t\t\t\t});\n\t\t\t\tif (typeof opts.storeOTP === \"object\" && \"decrypt\" in opts.storeOTP) otp = await opts.storeOTP.decrypt(storedOtp);\n\t\t\t\treturn ctx.json({ otp });\n\t\t\t}),\n\t\t\tcheckVerificationOTP: createAuthEndpoint(\"/email-otp/check-verification-otp\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\temail: z.string().meta({ description: \"Email address the OTP was sent to\" }),\n\t\t\t\t\ttype: z.enum(types).meta({\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tdescription: \"Type of the OTP\"\n\t\t\t\t\t}),\n\t\t\t\t\totp: z.string().meta({\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tdescription: \"OTP to verify\"\n\t\t\t\t\t})\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"verifyEmailWithOTP\",\n\t\t\t\t\tdescription: \"Verify an email with an OTP\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { success: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst email = ctx.body.email.toLowerCase();\n\t\t\t\tif (!z.email().safeParse(email).success) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.INVALID_EMAIL });\n\t\t\t\tif (!await ctx.context.internalAdapter.findUserByEmail(email)) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.USER_NOT_FOUND });\n\t\t\t\tconst verificationValue = await ctx.context.internalAdapter.findVerificationValue(`${ctx.body.type}-otp-${email}`);\n\t\t\t\tif (!verificationValue) throw new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_OTP });\n\t\t\t\tif (verificationValue.expiresAt < /* @__PURE__ */ new Date()) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.OTP_EXPIRED });\n\t\t\t\t}\n\t\t\t\tconst [otpValue, attempts] = splitAtLastColon(verificationValue.value);\n\t\t\t\tconst allowedAttempts = options?.allowedAttempts || 3;\n\t\t\t\tif (attempts && parseInt(attempts) >= allowedAttempts) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", { message: ERROR_CODES.TOO_MANY_ATTEMPTS });\n\t\t\t\t}\n\t\t\t\tif (!await verifyStoredOTP(ctx, otpValue, ctx.body.otp)) {\n\t\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(verificationValue.id, { value: `${otpValue}:${parseInt(attempts || \"0\") + 1}` });\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_OTP });\n\t\t\t\t}\n\t\t\t\treturn ctx.json({ success: true });\n\t\t\t}),\n\t\t\tverifyEmailOTP: createAuthEndpoint(\"/email-otp/verify-email\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\temail: z.string({}).meta({ description: \"Email address to verify\" }),\n\t\t\t\t\totp: z.string().meta({\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tdescription: \"OTP to verify\"\n\t\t\t\t\t})\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Verify email with OTP\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\tdescription: \"Indicates if the verification was successful\",\n\t\t\t\t\t\t\t\t\tenum: [true]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\tdescription: \"Session token if autoSignInAfterVerification is enabled, otherwise null\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\"status\",\n\t\t\t\t\t\t\t\t\"token\",\n\t\t\t\t\t\t\t\t\"user\"\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst email = ctx.body.email.toLowerCase();\n\t\t\t\tif (!z.email().safeParse(email).success) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.INVALID_EMAIL });\n\t\t\t\tconst verificationValue = await ctx.context.internalAdapter.findVerificationValue(`email-verification-otp-${email}`);\n\t\t\t\tif (!verificationValue) throw new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_OTP });\n\t\t\t\tif (verificationValue.expiresAt < /* @__PURE__ */ new Date()) throw new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.OTP_EXPIRED });\n\t\t\t\tconst [otpValue, attempts] = splitAtLastColon(verificationValue.value);\n\t\t\t\tconst allowedAttempts = options?.allowedAttempts || 3;\n\t\t\t\tif (attempts && parseInt(attempts) >= allowedAttempts) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", { message: ERROR_CODES.TOO_MANY_ATTEMPTS });\n\t\t\t\t}\n\t\t\t\tif (!await verifyStoredOTP(ctx, otpValue, ctx.body.otp)) {\n\t\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(verificationValue.id, { value: `${otpValue}:${parseInt(attempts || \"0\") + 1}` });\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_OTP });\n\t\t\t\t}\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\tconst user = await ctx.context.internalAdapter.findUserByEmail(email);\n\t\t\t\tif (!user)\n /**\n\t\t\t\t* safe to leak the existence of a user, given the user has already the OTP from the\n\t\t\t\t* email\n\t\t\t\t*/\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.USER_NOT_FOUND });\n\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(user.user.id, {\n\t\t\t\t\temail,\n\t\t\t\t\temailVerified: true\n\t\t\t\t});\n\t\t\t\tawait ctx.context.options.emailVerification?.onEmailVerification?.(updatedUser, ctx.request);\n\t\t\t\tif (ctx.context.options.emailVerification?.autoSignInAfterVerification) {\n\t\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(updatedUser.id);\n\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\tsession,\n\t\t\t\t\t\tuser: updatedUser\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\ttoken: session.token,\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tid: updatedUser.id,\n\t\t\t\t\t\t\temail: updatedUser.email,\n\t\t\t\t\t\t\temailVerified: updatedUser.emailVerified,\n\t\t\t\t\t\t\tname: updatedUser.name,\n\t\t\t\t\t\t\timage: updatedUser.image,\n\t\t\t\t\t\t\tcreatedAt: updatedUser.createdAt,\n\t\t\t\t\t\t\tupdatedAt: updatedUser.updatedAt\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst currentSession = await getSessionFromCtx(ctx);\n\t\t\t\tif (currentSession && updatedUser.emailVerified) {\n\t\t\t\t\tconst dontRememberMeCookie = await ctx.getSignedCookie(ctx.context.authCookies.dontRememberToken.name, ctx.context.secret);\n\t\t\t\t\tawait setCookieCache(ctx, {\n\t\t\t\t\t\tsession: currentSession.session,\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t...currentSession.user,\n\t\t\t\t\t\t\temailVerified: true\n\t\t\t\t\t\t}\n\t\t\t\t\t}, !!dontRememberMeCookie);\n\t\t\t\t}\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tstatus: true,\n\t\t\t\t\ttoken: null,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: updatedUser.id,\n\t\t\t\t\t\temail: updatedUser.email,\n\t\t\t\t\t\temailVerified: updatedUser.emailVerified,\n\t\t\t\t\t\tname: updatedUser.name,\n\t\t\t\t\t\timage: updatedUser.image,\n\t\t\t\t\t\tcreatedAt: updatedUser.createdAt,\n\t\t\t\t\t\tupdatedAt: updatedUser.updatedAt\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}),\n\t\t\tsignInEmailOTP: createAuthEndpoint(\"/sign-in/email-otp\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\temail: z.string({}).meta({ description: \"Email address to sign in\" }),\n\t\t\t\t\totp: z.string().meta({\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tdescription: \"OTP sent to the email\"\n\t\t\t\t\t})\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"signInWithEmailOTP\",\n\t\t\t\t\tdescription: \"Sign in with email and OTP\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Session token for the authenticated session\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\"token\", \"user\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst email = ctx.body.email.toLowerCase();\n\t\t\t\tconst verificationValue = await ctx.context.internalAdapter.findVerificationValue(`sign-in-otp-${email}`);\n\t\t\t\tif (!verificationValue) throw new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_OTP });\n\t\t\t\tif (verificationValue.expiresAt < /* @__PURE__ */ new Date()) throw new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.OTP_EXPIRED });\n\t\t\t\tconst [otpValue, attempts] = splitAtLastColon(verificationValue.value);\n\t\t\t\tconst allowedAttempts = options?.allowedAttempts || 3;\n\t\t\t\tif (attempts && parseInt(attempts) >= allowedAttempts) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", { message: ERROR_CODES.TOO_MANY_ATTEMPTS });\n\t\t\t\t}\n\t\t\t\tif (!await verifyStoredOTP(ctx, otpValue, ctx.body.otp)) {\n\t\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(verificationValue.id, { value: `${otpValue}:${parseInt(attempts || \"0\") + 1}` });\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_OTP });\n\t\t\t\t}\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\tconst user = await ctx.context.internalAdapter.findUserByEmail(email);\n\t\t\t\tif (!user) {\n\t\t\t\t\tif (opts.disableSignUp) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.USER_NOT_FOUND });\n\t\t\t\t\tconst newUser = await ctx.context.internalAdapter.createUser({\n\t\t\t\t\t\temail,\n\t\t\t\t\t\temailVerified: true,\n\t\t\t\t\t\tname: \"\"\n\t\t\t\t\t});\n\t\t\t\t\tconst session$1 = await ctx.context.internalAdapter.createSession(newUser.id);\n\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\tsession: session$1,\n\t\t\t\t\t\tuser: newUser\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\ttoken: session$1.token,\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tid: newUser.id,\n\t\t\t\t\t\t\temail: newUser.email,\n\t\t\t\t\t\t\temailVerified: newUser.emailVerified,\n\t\t\t\t\t\t\tname: newUser.name,\n\t\t\t\t\t\t\timage: newUser.image,\n\t\t\t\t\t\t\tcreatedAt: newUser.createdAt,\n\t\t\t\t\t\t\tupdatedAt: newUser.updatedAt\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (!user.user.emailVerified) await ctx.context.internalAdapter.updateUser(user.user.id, { emailVerified: true });\n\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(user.user.id);\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser: user.user\n\t\t\t\t});\n\t\t\t\treturn ctx.json({\n\t\t\t\t\ttoken: session.token,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: user.user.id,\n\t\t\t\t\t\temail: user.user.email,\n\t\t\t\t\t\temailVerified: user.user.emailVerified,\n\t\t\t\t\t\tname: user.user.name,\n\t\t\t\t\t\timage: user.user.image,\n\t\t\t\t\t\tcreatedAt: user.user.createdAt,\n\t\t\t\t\t\tupdatedAt: user.user.updatedAt\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}),\n\t\t\tforgetPasswordEmailOTP: createAuthEndpoint(\"/forget-password/email-otp\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ email: z.string().meta({ description: \"Email address to send the OTP\" }) }),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"forgetPasswordWithEmailOTP\",\n\t\t\t\t\tdescription: \"Forget password with email and OTP\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { success: {\n\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\tdescription: \"Indicates if the OTP was sent successfully\"\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst email = ctx.body.email;\n\t\t\t\tconst otp = opts.generateOTP({\n\t\t\t\t\temail,\n\t\t\t\t\ttype: \"forget-password\"\n\t\t\t\t}, ctx) || defaultOTPGenerator(opts);\n\t\t\t\tlet storedOTP = await storeOTP(ctx, otp);\n\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\tvalue: `${storedOTP}:0`,\n\t\t\t\t\tidentifier: `forget-password-otp-${email}`,\n\t\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\")\n\t\t\t\t});\n\t\t\t\tif (!await ctx.context.internalAdapter.findUserByEmail(email)) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationByIdentifier(`forget-password-otp-${email}`);\n\t\t\t\t\treturn ctx.json({ success: true });\n\t\t\t\t}\n\t\t\t\tawait options.sendVerificationOTP({\n\t\t\t\t\temail,\n\t\t\t\t\totp,\n\t\t\t\t\ttype: \"forget-password\"\n\t\t\t\t}, ctx).catch((e) => {\n\t\t\t\t\tctx.context.logger.error(\"Failed to send OTP\", e);\n\t\t\t\t});\n\t\t\t\treturn ctx.json({ success: true });\n\t\t\t}),\n\t\t\tresetPasswordEmailOTP: createAuthEndpoint(\"/email-otp/reset-password\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\temail: z.string().meta({ description: \"Email address to reset the password\" }),\n\t\t\t\t\totp: z.string().meta({ description: \"OTP sent to the email\" }),\n\t\t\t\t\tpassword: z.string().meta({ description: \"New password\" })\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"resetPasswordWithEmailOTP\",\n\t\t\t\t\tdescription: \"Reset password with email and OTP\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontnt: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { success: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst email = ctx.body.email;\n\t\t\t\tconst verificationValue = await ctx.context.internalAdapter.findVerificationValue(`forget-password-otp-${email}`);\n\t\t\t\tif (!verificationValue) throw new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_OTP });\n\t\t\t\tif (verificationValue.expiresAt < /* @__PURE__ */ new Date()) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.OTP_EXPIRED });\n\t\t\t\t}\n\t\t\t\tconst [otpValue, attempts] = splitAtLastColon(verificationValue.value);\n\t\t\t\tconst allowedAttempts = options?.allowedAttempts || 3;\n\t\t\t\tif (attempts && parseInt(attempts) >= allowedAttempts) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", { message: ERROR_CODES.TOO_MANY_ATTEMPTS });\n\t\t\t\t}\n\t\t\t\tif (!await verifyStoredOTP(ctx, otpValue, ctx.body.otp)) {\n\t\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(verificationValue.id, { value: `${otpValue}:${parseInt(attempts || \"0\") + 1}` });\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_OTP });\n\t\t\t\t}\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\tconst user = await ctx.context.internalAdapter.findUserByEmail(email, { includeAccounts: true });\n\t\t\t\tif (!user) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.USER_NOT_FOUND });\n\t\t\t\tconst minPasswordLength = ctx.context.password.config.minPasswordLength;\n\t\t\t\tif (ctx.body.password.length < minPasswordLength) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.PASSWORD_TOO_SHORT });\n\t\t\t\tconst maxPasswordLength = ctx.context.password.config.maxPasswordLength;\n\t\t\t\tif (ctx.body.password.length > maxPasswordLength) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.PASSWORD_TOO_LONG });\n\t\t\t\tconst passwordHash = await ctx.context.password.hash(ctx.body.password);\n\t\t\t\tif (!user.accounts?.find((account) => account.providerId === \"credential\")) await ctx.context.internalAdapter.createAccount({\n\t\t\t\t\tuserId: user.user.id,\n\t\t\t\t\tproviderId: \"credential\",\n\t\t\t\t\taccountId: user.user.id,\n\t\t\t\t\tpassword: passwordHash\n\t\t\t\t});\n\t\t\t\telse await ctx.context.internalAdapter.updatePassword(user.user.id, passwordHash);\n\t\t\t\tif (ctx.context.options.emailAndPassword?.onPasswordReset) await ctx.context.options.emailAndPassword.onPasswordReset({ user: user.user }, ctx.request);\n\t\t\t\tif (!user.user.emailVerified) await ctx.context.internalAdapter.updateUser(user.user.id, { emailVerified: true });\n\t\t\t\tif (ctx.context.options.emailAndPassword?.revokeSessionsOnPasswordReset) await ctx.context.internalAdapter.deleteSessions(user.user.id);\n\t\t\t\treturn ctx.json({ success: true });\n\t\t\t})\n\t\t},\n\t\thooks: { after: [{\n\t\t\tmatcher(context) {\n\t\t\t\treturn !!(context.path?.startsWith(\"/sign-up\") && opts.sendVerificationOnSignUp && !opts.overrideDefaultEmailVerification);\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst email = (await getEndpointResponse(ctx))?.user.email;\n\t\t\t\tif (email) {\n\t\t\t\t\tconst otp = opts.generateOTP({\n\t\t\t\t\t\temail,\n\t\t\t\t\t\ttype: ctx.body.type\n\t\t\t\t\t}, ctx) || defaultOTPGenerator(opts);\n\t\t\t\t\tlet storedOTP = await storeOTP(ctx, otp);\n\t\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\t\tvalue: `${storedOTP}:0`,\n\t\t\t\t\t\tidentifier: `email-verification-otp-${email}`,\n\t\t\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\")\n\t\t\t\t\t});\n\t\t\t\t\tawait options.sendVerificationOTP({\n\t\t\t\t\t\temail,\n\t\t\t\t\t\totp,\n\t\t\t\t\t\ttype: \"email-verification\"\n\t\t\t\t\t}, ctx);\n\t\t\t\t}\n\t\t\t})\n\t\t}] },\n\t\t$ERROR_CODES: ERROR_CODES,\n\t\trateLimit: [\n\t\t\t{\n\t\t\t\tpathMatcher(path) {\n\t\t\t\t\treturn path === \"/email-otp/send-verification-otp\";\n\t\t\t\t},\n\t\t\t\twindow: 60,\n\t\t\t\tmax: 3\n\t\t\t},\n\t\t\t{\n\t\t\t\tpathMatcher(path) {\n\t\t\t\t\treturn path === \"/email-otp/check-verification-otp\";\n\t\t\t\t},\n\t\t\t\twindow: 60,\n\t\t\t\tmax: 3\n\t\t\t},\n\t\t\t{\n\t\t\t\tpathMatcher(path) {\n\t\t\t\t\treturn path === \"/email-otp/verify-email\";\n\t\t\t\t},\n\t\t\t\twindow: 60,\n\t\t\t\tmax: 3\n\t\t\t},\n\t\t\t{\n\t\t\t\tpathMatcher(path) {\n\t\t\t\t\treturn path === \"/sign-in/email-otp\";\n\t\t\t\t},\n\t\t\t\twindow: 60,\n\t\t\t\tmax: 3\n\t\t\t}\n\t\t]\n\t};\n};\n\n//#endregion\nexport { emailOTP as t };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 11315, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/generic-oauth-BGbWWUh9.mjs"],"sourcesContent":["import { i as parseState, n as HIDE_METADATA, r as generateState } from \"./utils-db7gNqd-.mjs\";\nimport { O as handleOAuthUserInfo } from \"./api-CkmycQ2x.mjs\";\nimport { c as setSessionCookie } from \"./cookies-D72PbWdz.mjs\";\nimport { u as sessionMiddleware } from \"./session-AaRl3_x-.mjs\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { createAuthorizationURL, refreshAccessToken, validateAuthorizationCode } from \"@better-auth/core/oauth2\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { decodeJwt } from \"jose\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { betterFetch } from \"@better-fetch/fetch\";\n\n//#region src/plugins/generic-oauth/error-codes.ts\nconst GENERIC_OAUTH_ERROR_CODES = defineErrorCodes({\n\tINVALID_OAUTH_CONFIGURATION: \"Invalid OAuth configuration\",\n\tTOKEN_URL_NOT_FOUND: \"Invalid OAuth configuration. Token URL not found.\",\n\tPROVIDER_CONFIG_NOT_FOUND: \"No config found for provider\",\n\tPROVIDER_ID_REQUIRED: \"Provider ID is required\",\n\tINVALID_OAUTH_CONFIG: \"Invalid OAuth configuration.\",\n\tSESSION_REQUIRED: \"Session is required\"\n});\n\n//#endregion\n//#region src/plugins/generic-oauth/providers/auth0.ts\n/**\n* Auth0 OAuth provider helper\n*\n* @example\n* ```ts\n* import { genericOAuth, auth0 } from \"better-auth/plugins/generic-oauth\";\n*\n* export const auth = betterAuth({\n*   plugins: [\n*     genericOAuth({\n*       config: [\n*         auth0({\n*           clientId: process.env.AUTH0_CLIENT_ID,\n*           clientSecret: process.env.AUTH0_CLIENT_SECRET,\n*           domain: process.env.AUTH0_DOMAIN,\n*         }),\n*       ],\n*     }),\n*   ],\n* });\n* ```\n*/\nfunction auth0(options) {\n\tconst defaultScopes = [\n\t\t\"openid\",\n\t\t\"profile\",\n\t\t\"email\"\n\t];\n\tconst domain = options.domain.replace(/^https?:\\/\\//, \"\");\n\tconst discoveryUrl = `https://${domain}/.well-known/openid-configuration`;\n\tconst getUserInfo$1 = async (tokens) => {\n\t\tconst { data: profile, error } = await betterFetch(`https://${domain}/userinfo`, { headers: { Authorization: `Bearer ${tokens.accessToken}` } });\n\t\tif (error || !profile) return null;\n\t\treturn {\n\t\t\tid: profile.sub,\n\t\t\tname: profile.name ?? profile.nickname ?? void 0,\n\t\t\temail: profile.email ?? void 0,\n\t\t\timage: profile.picture,\n\t\t\temailVerified: profile.email_verified ?? false\n\t\t};\n\t};\n\treturn {\n\t\tproviderId: \"auth0\",\n\t\tdiscoveryUrl,\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo: getUserInfo$1\n\t};\n}\n\n//#endregion\n//#region src/plugins/generic-oauth/providers/hubspot.ts\n/**\n* HubSpot OAuth provider helper\n*\n* @example\n* ```ts\n* import { genericOAuth, hubspot } from \"better-auth/plugins/generic-oauth\";\n*\n* export const auth = betterAuth({\n*   plugins: [\n*     genericOAuth({\n*       config: [\n*         hubspot({\n*           clientId: process.env.HUBSPOT_CLIENT_ID,\n*           clientSecret: process.env.HUBSPOT_CLIENT_SECRET,\n*           scopes: [\"oauth\", \"contacts\"],\n*         }),\n*       ],\n*     }),\n*   ],\n* });\n* ```\n*/\nfunction hubspot(options) {\n\tconst defaultScopes = [\"oauth\"];\n\tconst getUserInfo$1 = async (tokens) => {\n\t\tconst { data: profile, error } = await betterFetch(`https://api.hubapi.com/oauth/v1/access-tokens/${tokens.accessToken}`, { headers: { \"Content-Type\": \"application/json\" } });\n\t\tif (error || !profile) return null;\n\t\tconst id = profile.user_id ?? profile.signed_access_token?.userId;\n\t\tif (!id) return null;\n\t\treturn {\n\t\t\tid,\n\t\t\tname: profile.user,\n\t\t\temail: profile.user,\n\t\t\timage: void 0,\n\t\t\temailVerified: false\n\t\t};\n\t};\n\treturn {\n\t\tproviderId: \"hubspot\",\n\t\tauthorizationUrl: \"https://app.hubspot.com/oauth/authorize\",\n\t\ttokenUrl: \"https://api.hubapi.com/oauth/v1/token\",\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tauthentication: \"post\",\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo: getUserInfo$1\n\t};\n}\n\n//#endregion\n//#region src/plugins/generic-oauth/providers/keycloak.ts\n/**\n* Keycloak OAuth provider helper\n*\n* @example\n* ```ts\n* import { genericOAuth, keycloak } from \"better-auth/plugins/generic-oauth\";\n*\n* export const auth = betterAuth({\n*   plugins: [\n*     genericOAuth({\n*       config: [\n*         keycloak({\n*           clientId: process.env.KEYCLOAK_CLIENT_ID,\n*           clientSecret: process.env.KEYCLOAK_CLIENT_SECRET,\n*           issuer: process.env.KEYCLOAK_ISSUER,\n*         }),\n*       ],\n*     }),\n*   ],\n* });\n* ```\n*/\nfunction keycloak(options) {\n\tconst defaultScopes = [\n\t\t\"openid\",\n\t\t\"profile\",\n\t\t\"email\"\n\t];\n\tconst issuer = options.issuer.replace(/\\/$/, \"\");\n\tconst discoveryUrl = `${issuer}/.well-known/openid-configuration`;\n\tconst getUserInfo$1 = async (tokens) => {\n\t\tconst { data: profile, error } = await betterFetch(`${issuer}/protocol/openid-connect/userinfo`, { headers: { Authorization: `Bearer ${tokens.accessToken}` } });\n\t\tif (error || !profile) return null;\n\t\treturn {\n\t\t\tid: profile.sub,\n\t\t\tname: profile.name ?? profile.preferred_username ?? void 0,\n\t\t\temail: profile.email ?? void 0,\n\t\t\timage: profile.picture,\n\t\t\temailVerified: profile.email_verified ?? false\n\t\t};\n\t};\n\treturn {\n\t\tproviderId: \"keycloak\",\n\t\tdiscoveryUrl,\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo: getUserInfo$1\n\t};\n}\n\n//#endregion\n//#region src/plugins/generic-oauth/providers/line.ts\n/**\n* LINE OAuth provider helper\n*\n* LINE requires separate channels for different countries (Japan, Thailand, Taiwan, etc.).\n* Each channel has its own clientId and clientSecret. To support multiple countries,\n* call this function multiple times with different providerIds and credentials.\n*\n* @example\n* ```ts\n* import { genericOAuth, line } from \"better-auth/plugins/generic-oauth\";\n*\n* export const auth = betterAuth({\n*   plugins: [\n*     genericOAuth({\n*       config: [\n*         // Japan channel\n*         line({\n*           providerId: \"line-jp\",\n*           clientId: process.env.LINE_JP_CLIENT_ID,\n*           clientSecret: process.env.LINE_JP_CLIENT_SECRET,\n*         }),\n*         // Thailand channel\n*         line({\n*           providerId: \"line-th\",\n*           clientId: process.env.LINE_TH_CLIENT_ID,\n*           clientSecret: process.env.LINE_TH_CLIENT_SECRET,\n*         }),\n*         // Taiwan channel\n*         line({\n*           providerId: \"line-tw\",\n*           clientId: process.env.LINE_TW_CLIENT_ID,\n*           clientSecret: process.env.LINE_TW_CLIENT_SECRET,\n*         }),\n*       ],\n*     }),\n*   ],\n* });\n* ```\n*/\nfunction line(options) {\n\tconst defaultScopes = [\n\t\t\"openid\",\n\t\t\"profile\",\n\t\t\"email\"\n\t];\n\tconst authorizationUrl = \"https://access.line.me/oauth2/v2.1/authorize\";\n\tconst tokenUrl = \"https://api.line.me/oauth2/v2.1/token\";\n\tconst userInfoUrl = \"https://api.line.me/oauth2/v2.1/userinfo\";\n\tconst getUserInfo$1 = async (tokens) => {\n\t\tlet profile = null;\n\t\tif (tokens.idToken) try {\n\t\t\tprofile = decodeJwt(tokens.idToken);\n\t\t} catch {}\n\t\tif (!profile) {\n\t\t\tconst { data, error } = await betterFetch(userInfoUrl, { headers: { Authorization: `Bearer ${tokens.accessToken}` } });\n\t\t\tif (error || !data) return null;\n\t\t\tprofile = data;\n\t\t}\n\t\tif (!profile) return null;\n\t\treturn {\n\t\t\tid: profile.sub,\n\t\t\tname: profile.name,\n\t\t\temail: profile.email,\n\t\t\timage: profile.picture,\n\t\t\temailVerified: false\n\t\t};\n\t};\n\treturn {\n\t\tproviderId: options.providerId ?? \"line\",\n\t\tauthorizationUrl,\n\t\ttokenUrl,\n\t\tuserInfoUrl,\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo: getUserInfo$1\n\t};\n}\n\n//#endregion\n//#region src/plugins/generic-oauth/providers/microsoft-entra-id.ts\n/**\n* Microsoft Entra ID (Azure AD) OAuth provider helper\n*\n* @example\n* ```ts\n* import { genericOAuth, microsoftEntraId } from \"better-auth/plugins/generic-oauth\";\n*\n* export const auth = betterAuth({\n*   plugins: [\n*     genericOAuth({\n*       config: [\n*         microsoftEntraId({\n*           clientId: process.env.MS_APP_ID,\n*           clientSecret: process.env.MS_CLIENT_SECRET,\n*           tenantId: process.env.MS_TENANT_ID,\n*         }),\n*       ],\n*     }),\n*   ],\n* });\n* ```\n*/\nfunction microsoftEntraId(options) {\n\tconst defaultScopes = [\n\t\t\"openid\",\n\t\t\"profile\",\n\t\t\"email\"\n\t];\n\tconst tenantId = options.tenantId;\n\tconst authorizationUrl = `https://login.microsoftonline.com/${tenantId}/oauth2/v2.0/authorize`;\n\tconst tokenUrl = `https://login.microsoftonline.com/${tenantId}/oauth2/v2.0/token`;\n\tconst userInfoUrl = \"https://graph.microsoft.com/oidc/userinfo\";\n\tconst getUserInfo$1 = async (tokens) => {\n\t\tconst { data: profile, error } = await betterFetch(userInfoUrl, { headers: { Authorization: `Bearer ${tokens.accessToken}` } });\n\t\tif (error || !profile) return null;\n\t\treturn {\n\t\t\tid: profile.sub,\n\t\t\tname: profile.name ?? (`${profile.given_name ?? \"\"} ${profile.family_name ?? \"\"}`.trim() || void 0),\n\t\t\temail: profile.email ?? profile.preferred_username ?? void 0,\n\t\t\timage: profile.picture,\n\t\t\temailVerified: profile.email_verified ?? false\n\t\t};\n\t};\n\treturn {\n\t\tproviderId: \"microsoft-entra-id\",\n\t\tauthorizationUrl,\n\t\ttokenUrl,\n\t\tuserInfoUrl,\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo: getUserInfo$1\n\t};\n}\n\n//#endregion\n//#region src/plugins/generic-oauth/providers/okta.ts\n/**\n* Okta OAuth provider helper\n*\n* @example\n* ```ts\n* import { genericOAuth, okta } from \"better-auth/plugins/generic-oauth\";\n*\n* export const auth = betterAuth({\n*   plugins: [\n*     genericOAuth({\n*       config: [\n*         okta({\n*           clientId: process.env.OKTA_CLIENT_ID,\n*           clientSecret: process.env.OKTA_CLIENT_SECRET,\n*           issuer: process.env.OKTA_ISSUER,\n*         }),\n*       ],\n*     }),\n*   ],\n* });\n* ```\n*/\nfunction okta(options) {\n\tconst defaultScopes = [\n\t\t\"openid\",\n\t\t\"profile\",\n\t\t\"email\"\n\t];\n\tconst issuer = options.issuer.replace(/\\/$/, \"\");\n\tconst discoveryUrl = `${issuer}/.well-known/openid-configuration`;\n\tconst getUserInfo$1 = async (tokens) => {\n\t\tconst { data: profile, error } = await betterFetch(`${issuer}/v1/userinfo`, { headers: { Authorization: `Bearer ${tokens.accessToken}` } });\n\t\tif (error || !profile) return null;\n\t\treturn {\n\t\t\tid: profile.sub,\n\t\t\tname: profile.name ?? profile.preferred_username ?? void 0,\n\t\t\temail: profile.email ?? void 0,\n\t\t\timage: profile.picture,\n\t\t\temailVerified: profile.email_verified ?? false\n\t\t};\n\t};\n\treturn {\n\t\tproviderId: \"okta\",\n\t\tdiscoveryUrl,\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo: getUserInfo$1\n\t};\n}\n\n//#endregion\n//#region src/plugins/generic-oauth/providers/slack.ts\n/**\n* Slack OAuth provider helper\n*\n* @example\n* ```ts\n* import { genericOAuth, slack } from \"better-auth/plugins/generic-oauth\";\n*\n* export const auth = betterAuth({\n*   plugins: [\n*     genericOAuth({\n*       config: [\n*         slack({\n*           clientId: process.env.SLACK_CLIENT_ID,\n*           clientSecret: process.env.SLACK_CLIENT_SECRET,\n*         }),\n*       ],\n*     }),\n*   ],\n* });\n* ```\n*/\nfunction slack(options) {\n\tconst defaultScopes = [\n\t\t\"openid\",\n\t\t\"profile\",\n\t\t\"email\"\n\t];\n\tconst getUserInfo$1 = async (tokens) => {\n\t\tconst { data: profile, error } = await betterFetch(\"https://slack.com/api/openid.connect.userInfo\", { headers: { Authorization: `Bearer ${tokens.accessToken}` } });\n\t\tif (error || !profile) return null;\n\t\treturn {\n\t\t\tid: profile[\"https://slack.com/user_id\"] ?? profile.sub,\n\t\t\tname: profile.name,\n\t\t\temail: profile.email,\n\t\t\timage: profile.picture ?? profile[\"https://slack.com/user_image_512\"],\n\t\t\temailVerified: profile.email_verified ?? false\n\t\t};\n\t};\n\treturn {\n\t\tproviderId: \"slack\",\n\t\tauthorizationUrl: \"https://slack.com/openid/connect/authorize\",\n\t\ttokenUrl: \"https://slack.com/api/openid.connect.token\",\n\t\tuserInfoUrl: \"https://slack.com/api/openid.connect.userInfo\",\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo: getUserInfo$1\n\t};\n}\n\n//#endregion\n//#region src/plugins/generic-oauth/index.ts\nasync function getUserInfo(tokens, finalUserInfoUrl) {\n\tif (tokens.idToken) {\n\t\tconst decoded = decodeJwt(tokens.idToken);\n\t\tif (decoded) {\n\t\t\tif (decoded.sub && decoded.email) return {\n\t\t\t\tid: decoded.sub,\n\t\t\t\temailVerified: decoded.email_verified,\n\t\t\t\timage: decoded.picture,\n\t\t\t\t...decoded\n\t\t\t};\n\t\t}\n\t}\n\tif (!finalUserInfoUrl) return null;\n\tconst userInfo = await betterFetch(finalUserInfoUrl, {\n\t\tmethod: \"GET\",\n\t\theaders: { Authorization: `Bearer ${tokens.accessToken}` }\n\t});\n\treturn {\n\t\tid: userInfo.data?.sub ?? \"\",\n\t\temailVerified: userInfo.data?.email_verified ?? false,\n\t\temail: userInfo.data?.email,\n\t\timage: userInfo.data?.picture,\n\t\tname: userInfo.data?.name,\n\t\t...userInfo.data\n\t};\n}\n/**\n* A generic OAuth plugin that can be used to add OAuth support to any provider\n*/\nconst genericOAuth = (options) => {\n\treturn {\n\t\tid: \"generic-oauth\",\n\t\tinit: (ctx) => {\n\t\t\treturn { context: { socialProviders: options.config.map((c) => {\n\t\t\t\tlet finalUserInfoUrl = c.userInfoUrl;\n\t\t\t\treturn {\n\t\t\t\t\tid: c.providerId,\n\t\t\t\t\tname: c.providerId,\n\t\t\t\t\tasync createAuthorizationURL(data) {\n\t\t\t\t\t\tlet finalAuthUrl = c.authorizationUrl;\n\t\t\t\t\t\tif (!finalAuthUrl && c.discoveryUrl) {\n\t\t\t\t\t\t\tconst discovery = await betterFetch(c.discoveryUrl, {\n\t\t\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\t\t\theaders: c.discoveryHeaders\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (discovery.data) {\n\t\t\t\t\t\t\t\tfinalAuthUrl = discovery.data.authorization_endpoint;\n\t\t\t\t\t\t\t\tfinalUserInfoUrl = finalUserInfoUrl ?? discovery.data.userinfo_endpoint;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!finalAuthUrl) throw new APIError(\"BAD_REQUEST\", { message: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIGURATION });\n\t\t\t\t\t\treturn createAuthorizationURL({\n\t\t\t\t\t\t\tid: c.providerId,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tclientId: c.clientId,\n\t\t\t\t\t\t\t\tclientSecret: c.clientSecret,\n\t\t\t\t\t\t\t\tredirectURI: c.redirectURI\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tauthorizationEndpoint: finalAuthUrl,\n\t\t\t\t\t\t\tstate: data.state,\n\t\t\t\t\t\t\tcodeVerifier: c.pkce ? data.codeVerifier : void 0,\n\t\t\t\t\t\t\tscopes: c.scopes || [],\n\t\t\t\t\t\t\tredirectURI: `${ctx.baseURL}/oauth2/callback/${c.providerId}`\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tasync validateAuthorizationCode(data) {\n\t\t\t\t\t\tif (c.getToken) return c.getToken(data);\n\t\t\t\t\t\tlet finalTokenUrl = c.tokenUrl;\n\t\t\t\t\t\tif (c.discoveryUrl) {\n\t\t\t\t\t\t\tconst discovery = await betterFetch(c.discoveryUrl, {\n\t\t\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\t\t\theaders: c.discoveryHeaders\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (discovery.data) {\n\t\t\t\t\t\t\t\tfinalTokenUrl = discovery.data.token_endpoint;\n\t\t\t\t\t\t\t\tfinalUserInfoUrl = discovery.data.userinfo_endpoint;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!finalTokenUrl) throw new APIError(\"BAD_REQUEST\", { message: GENERIC_OAUTH_ERROR_CODES.TOKEN_URL_NOT_FOUND });\n\t\t\t\t\t\treturn validateAuthorizationCode({\n\t\t\t\t\t\t\theaders: c.authorizationHeaders,\n\t\t\t\t\t\t\tcode: data.code,\n\t\t\t\t\t\t\tcodeVerifier: data.codeVerifier,\n\t\t\t\t\t\t\tredirectURI: data.redirectURI,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tclientId: c.clientId,\n\t\t\t\t\t\t\t\tclientSecret: c.clientSecret,\n\t\t\t\t\t\t\t\tredirectURI: c.redirectURI\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttokenEndpoint: finalTokenUrl,\n\t\t\t\t\t\t\tauthentication: c.authentication\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tasync refreshAccessToken(refreshToken) {\n\t\t\t\t\t\tlet finalTokenUrl = c.tokenUrl;\n\t\t\t\t\t\tif (c.discoveryUrl) {\n\t\t\t\t\t\t\tconst discovery = await betterFetch(c.discoveryUrl, {\n\t\t\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\t\t\theaders: c.discoveryHeaders\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (discovery.data) finalTokenUrl = discovery.data.token_endpoint;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!finalTokenUrl) throw new APIError(\"BAD_REQUEST\", { message: GENERIC_OAUTH_ERROR_CODES.TOKEN_URL_NOT_FOUND });\n\t\t\t\t\t\treturn refreshAccessToken({\n\t\t\t\t\t\t\trefreshToken,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tclientId: c.clientId,\n\t\t\t\t\t\t\t\tclientSecret: c.clientSecret\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tauthentication: c.authentication,\n\t\t\t\t\t\t\ttokenEndpoint: finalTokenUrl\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tasync getUserInfo(tokens) {\n\t\t\t\t\t\tconst userInfo = c.getUserInfo ? await c.getUserInfo(tokens) : await getUserInfo(tokens, finalUserInfoUrl);\n\t\t\t\t\t\tif (!userInfo) return null;\n\t\t\t\t\t\tconst userMap = await c.mapProfileToUser?.(userInfo);\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\tid: userInfo?.id,\n\t\t\t\t\t\t\t\temail: userInfo?.email,\n\t\t\t\t\t\t\t\temailVerified: userInfo?.emailVerified,\n\t\t\t\t\t\t\t\timage: userInfo?.image,\n\t\t\t\t\t\t\t\tname: userInfo?.name,\n\t\t\t\t\t\t\t\t...userMap\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdata: userInfo\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t\toptions: { overrideUserInfoOnSignIn: c.overrideUserInfo }\n\t\t\t\t};\n\t\t\t}).concat(ctx.socialProviders) } };\n\t\t},\n\t\tendpoints: {\n\t\t\tsignInWithOAuth2: createAuthEndpoint(\"/sign-in/oauth2\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tproviderId: z.string().meta({ description: \"The provider ID for the OAuth provider\" }),\n\t\t\t\t\tcallbackURL: z.string().meta({ description: \"The URL to redirect to after sign in\" }).optional(),\n\t\t\t\t\terrorCallbackURL: z.string().meta({ description: \"The URL to redirect to if an error occurs\" }).optional(),\n\t\t\t\t\tnewUserCallbackURL: z.string().meta({ description: \"The URL to redirect to after login if the user is new. Eg: \\\"/welcome\\\"\" }).optional(),\n\t\t\t\t\tdisableRedirect: z.boolean().meta({ description: \"Disable redirect\" }).optional(),\n\t\t\t\t\tscopes: z.array(z.string()).meta({ description: \"Scopes to be passed to the provider authorization request.\" }).optional(),\n\t\t\t\t\trequestSignUp: z.boolean().meta({ description: \"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider. Eg: false\" }).optional(),\n\t\t\t\t\tadditionalData: z.record(z.string(), z.any()).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Sign in with OAuth2\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Sign in with OAuth2\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\turl: { type: \"string\" },\n\t\t\t\t\t\t\t\tredirect: { type: \"boolean\" }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { providerId } = ctx.body;\n\t\t\t\tconst config = options.config.find((c) => c.providerId === providerId);\n\t\t\t\tif (!config) throw new APIError(\"BAD_REQUEST\", { message: `${GENERIC_OAUTH_ERROR_CODES.PROVIDER_CONFIG_NOT_FOUND} ${providerId}` });\n\t\t\t\tconst { discoveryUrl, authorizationUrl, tokenUrl, clientId, clientSecret, scopes, redirectURI, responseType, pkce, prompt, accessType, authorizationUrlParams, responseMode, authentication } = config;\n\t\t\t\tlet finalAuthUrl = authorizationUrl;\n\t\t\t\tlet finalTokenUrl = tokenUrl;\n\t\t\t\tif (discoveryUrl) {\n\t\t\t\t\tconst discovery = await betterFetch(discoveryUrl, {\n\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\theaders: config.discoveryHeaders,\n\t\t\t\t\t\tonError(context) {\n\t\t\t\t\t\t\tctx.context.logger.error(context.error.message, context.error, { discoveryUrl });\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (discovery.data) {\n\t\t\t\t\t\tfinalAuthUrl = discovery.data.authorization_endpoint;\n\t\t\t\t\t\tfinalTokenUrl = discovery.data.token_endpoint;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!finalAuthUrl || !finalTokenUrl) throw new APIError(\"BAD_REQUEST\", { message: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIGURATION });\n\t\t\t\tif (authorizationUrlParams) {\n\t\t\t\t\tconst withAdditionalParams = new URL(finalAuthUrl);\n\t\t\t\t\tfor (const [paramName, paramValue] of Object.entries(authorizationUrlParams)) withAdditionalParams.searchParams.set(paramName, paramValue);\n\t\t\t\t\tfinalAuthUrl = withAdditionalParams.toString();\n\t\t\t\t}\n\t\t\t\tconst additionalParams = typeof authorizationUrlParams === \"function\" ? authorizationUrlParams(ctx) : authorizationUrlParams;\n\t\t\t\tconst { state, codeVerifier } = await generateState(ctx, void 0, ctx.body.additionalData);\n\t\t\t\tconst authUrl = await createAuthorizationURL({\n\t\t\t\t\tid: providerId,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tclientId,\n\t\t\t\t\t\tclientSecret,\n\t\t\t\t\t\tredirectURI\n\t\t\t\t\t},\n\t\t\t\t\tauthorizationEndpoint: finalAuthUrl,\n\t\t\t\t\tstate,\n\t\t\t\t\tcodeVerifier: pkce ? codeVerifier : void 0,\n\t\t\t\t\tscopes: ctx.body.scopes ? [...ctx.body.scopes, ...scopes || []] : scopes || [],\n\t\t\t\t\tredirectURI: `${ctx.context.baseURL}/oauth2/callback/${providerId}`,\n\t\t\t\t\tprompt,\n\t\t\t\t\taccessType,\n\t\t\t\t\tresponseType,\n\t\t\t\t\tresponseMode,\n\t\t\t\t\tadditionalParams\n\t\t\t\t});\n\t\t\t\treturn ctx.json({\n\t\t\t\t\turl: authUrl.toString(),\n\t\t\t\t\tredirect: !ctx.body.disableRedirect\n\t\t\t\t});\n\t\t\t}),\n\t\t\toAuth2Callback: createAuthEndpoint(\"/oauth2/callback/:providerId\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tquery: z.object({\n\t\t\t\t\tcode: z.string().meta({ description: \"The OAuth2 code\" }).optional(),\n\t\t\t\t\terror: z.string().meta({ description: \"The error message, if any\" }).optional(),\n\t\t\t\t\terror_description: z.string().meta({ description: \"The error description, if any\" }).optional(),\n\t\t\t\t\tstate: z.string().meta({ description: \"The state parameter from the OAuth2 request\" }).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: {\n\t\t\t\t\t...HIDE_METADATA,\n\t\t\t\t\tallowedMediaTypes: [\"application/x-www-form-urlencoded\", \"application/json\"],\n\t\t\t\t\topenapi: {\n\t\t\t\t\t\tdescription: \"OAuth2 callback\",\n\t\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\t\tdescription: \"OAuth2 callback\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: { url: { type: \"string\" } }\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t} }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst defaultErrorURL = ctx.context.options.onAPIError?.errorURL || `${ctx.context.baseURL}/error`;\n\t\t\t\tif (ctx.query.error || !ctx.query.code) throw ctx.redirect(`${defaultErrorURL}?error=${ctx.query.error || \"oAuth_code_missing\"}&error_description=${ctx.query.error_description}`);\n\t\t\t\tconst providerId = ctx.params?.providerId;\n\t\t\t\tif (!providerId) throw new APIError(\"BAD_REQUEST\", { message: GENERIC_OAUTH_ERROR_CODES.PROVIDER_ID_REQUIRED });\n\t\t\t\tconst providerConfig = options.config.find((p) => p.providerId === providerId);\n\t\t\t\tif (!providerConfig) throw new APIError(\"BAD_REQUEST\", { message: `${GENERIC_OAUTH_ERROR_CODES.PROVIDER_CONFIG_NOT_FOUND} ${providerId}` });\n\t\t\t\tlet tokens = void 0;\n\t\t\t\tconst { callbackURL, codeVerifier, errorURL, requestSignUp, newUserURL, link } = await parseState(ctx);\n\t\t\t\tconst code = ctx.query.code;\n\t\t\t\tfunction redirectOnError(error) {\n\t\t\t\t\tconst defaultErrorURL$1 = ctx.context.options.onAPIError?.errorURL || `${ctx.context.baseURL}/error`;\n\t\t\t\t\tlet url = errorURL || defaultErrorURL$1;\n\t\t\t\t\tif (url.includes(\"?\")) url = `${url}&error=${error}`;\n\t\t\t\t\telse url = `${url}?error=${error}`;\n\t\t\t\t\tthrow ctx.redirect(url);\n\t\t\t\t}\n\t\t\t\tlet finalTokenUrl = providerConfig.tokenUrl;\n\t\t\t\tlet finalUserInfoUrl = providerConfig.userInfoUrl;\n\t\t\t\tif (providerConfig.discoveryUrl) {\n\t\t\t\t\tconst discovery = await betterFetch(providerConfig.discoveryUrl, {\n\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\theaders: providerConfig.discoveryHeaders\n\t\t\t\t\t});\n\t\t\t\t\tif (discovery.data) {\n\t\t\t\t\t\tfinalTokenUrl = discovery.data.token_endpoint;\n\t\t\t\t\t\tfinalUserInfoUrl = discovery.data.userinfo_endpoint;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ttry {\n\t\t\t\t\tif (providerConfig.getToken) tokens = await providerConfig.getToken({\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tredirectURI: `${ctx.context.baseURL}/oauth2/callback/${providerConfig.providerId}`,\n\t\t\t\t\t\tcodeVerifier: providerConfig.pkce ? codeVerifier : void 0\n\t\t\t\t\t});\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (!finalTokenUrl) throw new APIError(\"BAD_REQUEST\", { message: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIG });\n\t\t\t\t\t\tconst additionalParams = typeof providerConfig.tokenUrlParams === \"function\" ? providerConfig.tokenUrlParams(ctx) : providerConfig.tokenUrlParams;\n\t\t\t\t\t\ttokens = await validateAuthorizationCode({\n\t\t\t\t\t\t\theaders: providerConfig.authorizationHeaders,\n\t\t\t\t\t\t\tcode,\n\t\t\t\t\t\t\tcodeVerifier: providerConfig.pkce ? codeVerifier : void 0,\n\t\t\t\t\t\t\tredirectURI: `${ctx.context.baseURL}/oauth2/callback/${providerConfig.providerId}`,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tclientId: providerConfig.clientId,\n\t\t\t\t\t\t\t\tclientSecret: providerConfig.clientSecret,\n\t\t\t\t\t\t\t\tredirectURI: providerConfig.redirectURI\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttokenEndpoint: finalTokenUrl,\n\t\t\t\t\t\t\tauthentication: providerConfig.authentication,\n\t\t\t\t\t\t\tadditionalParams\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tctx.context.logger.error(e && typeof e === \"object\" && \"name\" in e ? e.name : \"\", e);\n\t\t\t\t\tthrow redirectOnError(\"oauth_code_verification_failed\");\n\t\t\t\t}\n\t\t\t\tif (!tokens) throw new APIError(\"BAD_REQUEST\", { message: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIG });\n\t\t\t\tconst userInfo = await (async function handleUserInfo() {\n\t\t\t\t\tconst userInfo$1 = providerConfig.getUserInfo ? await providerConfig.getUserInfo(tokens) : await getUserInfo(tokens, finalUserInfoUrl);\n\t\t\t\t\tif (!userInfo$1) throw redirectOnError(\"user_info_is_missing\");\n\t\t\t\t\tconst mapUser = providerConfig.mapProfileToUser ? await providerConfig.mapProfileToUser(userInfo$1) : userInfo$1;\n\t\t\t\t\tconst email = mapUser.email ? mapUser.email.toLowerCase() : userInfo$1.email?.toLowerCase();\n\t\t\t\t\tif (!email) {\n\t\t\t\t\t\tctx.context.logger.error(\"Unable to get user info\", userInfo$1);\n\t\t\t\t\t\tthrow redirectOnError(\"email_is_missing\");\n\t\t\t\t\t}\n\t\t\t\t\tconst id = mapUser.id ? String(mapUser.id) : String(userInfo$1.id);\n\t\t\t\t\tconst name = mapUser.name ? mapUser.name : userInfo$1.name;\n\t\t\t\t\tif (!name) {\n\t\t\t\t\t\tctx.context.logger.error(\"Unable to get user info\", userInfo$1);\n\t\t\t\t\t\tthrow redirectOnError(\"name_is_missing\");\n\t\t\t\t\t}\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...userInfo$1,\n\t\t\t\t\t\t...mapUser,\n\t\t\t\t\t\temail,\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tname\n\t\t\t\t\t};\n\t\t\t\t})();\n\t\t\t\tif (link) {\n\t\t\t\t\tif (ctx.context.options.account?.accountLinking?.allowDifferentEmails !== true && link.email !== userInfo.email) return redirectOnError(\"email_doesn't_match\");\n\t\t\t\t\tconst existingAccount = await ctx.context.internalAdapter.findAccountByProviderId(String(userInfo.id), providerConfig.providerId);\n\t\t\t\t\tif (existingAccount) {\n\t\t\t\t\t\tif (existingAccount.userId !== link.userId) return redirectOnError(\"account_already_linked_to_different_user\");\n\t\t\t\t\t\tconst updateData = Object.fromEntries(Object.entries({\n\t\t\t\t\t\t\taccessToken: tokens.accessToken,\n\t\t\t\t\t\t\tidToken: tokens.idToken,\n\t\t\t\t\t\t\trefreshToken: tokens.refreshToken,\n\t\t\t\t\t\t\taccessTokenExpiresAt: tokens.accessTokenExpiresAt,\n\t\t\t\t\t\t\trefreshTokenExpiresAt: tokens.refreshTokenExpiresAt,\n\t\t\t\t\t\t\tscope: tokens.scopes?.join(\",\")\n\t\t\t\t\t\t}).filter(([_, value]) => value !== void 0));\n\t\t\t\t\t\tawait ctx.context.internalAdapter.updateAccount(existingAccount.id, updateData);\n\t\t\t\t\t} else if (!await ctx.context.internalAdapter.createAccount({\n\t\t\t\t\t\tuserId: link.userId,\n\t\t\t\t\t\tproviderId: providerConfig.providerId,\n\t\t\t\t\t\taccountId: userInfo.id,\n\t\t\t\t\t\taccessToken: tokens.accessToken,\n\t\t\t\t\t\taccessTokenExpiresAt: tokens.accessTokenExpiresAt,\n\t\t\t\t\t\trefreshTokenExpiresAt: tokens.refreshTokenExpiresAt,\n\t\t\t\t\t\tscope: tokens.scopes?.join(\",\"),\n\t\t\t\t\t\trefreshToken: tokens.refreshToken,\n\t\t\t\t\t\tidToken: tokens.idToken\n\t\t\t\t\t})) return redirectOnError(\"unable_to_link_account\");\n\t\t\t\t\tlet toRedirectTo$1;\n\t\t\t\t\ttry {\n\t\t\t\t\t\ttoRedirectTo$1 = callbackURL.toString();\n\t\t\t\t\t} catch {\n\t\t\t\t\t\ttoRedirectTo$1 = callbackURL;\n\t\t\t\t\t}\n\t\t\t\t\tthrow ctx.redirect(toRedirectTo$1);\n\t\t\t\t}\n\t\t\t\tconst result = await handleOAuthUserInfo(ctx, {\n\t\t\t\t\tuserInfo,\n\t\t\t\t\taccount: {\n\t\t\t\t\t\tproviderId: providerConfig.providerId,\n\t\t\t\t\t\taccountId: userInfo.id,\n\t\t\t\t\t\t...tokens,\n\t\t\t\t\t\tscope: tokens.scopes?.join(\",\")\n\t\t\t\t\t},\n\t\t\t\t\tcallbackURL,\n\t\t\t\t\tdisableSignUp: providerConfig.disableImplicitSignUp && !requestSignUp || providerConfig.disableSignUp,\n\t\t\t\t\toverrideUserInfo: providerConfig.overrideUserInfo\n\t\t\t\t});\n\t\t\t\tif (result.error) return redirectOnError(result.error.split(\" \").join(\"_\"));\n\t\t\t\tconst { session, user } = result.data;\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser\n\t\t\t\t});\n\t\t\t\tlet toRedirectTo;\n\t\t\t\ttry {\n\t\t\t\t\ttoRedirectTo = (result.isRegister ? newUserURL || callbackURL : callbackURL).toString();\n\t\t\t\t} catch {\n\t\t\t\t\ttoRedirectTo = result.isRegister ? newUserURL || callbackURL : callbackURL;\n\t\t\t\t}\n\t\t\t\tthrow ctx.redirect(toRedirectTo);\n\t\t\t}),\n\t\t\toAuth2LinkAccount: createAuthEndpoint(\"/oauth2/link\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tproviderId: z.string(),\n\t\t\t\t\tcallbackURL: z.string(),\n\t\t\t\t\tscopes: z.array(z.string()).meta({ description: \"Additional scopes to request when linking the account\" }).optional(),\n\t\t\t\t\terrorCallbackURL: z.string().meta({ description: \"The URL to redirect to if there is an error during the link process\" }).optional()\n\t\t\t\t}),\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Link an OAuth2 account to the current user session\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"Authorization URL generated successfully for linking an OAuth2 account\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\turl: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\tdescription: \"The authorization URL to redirect the user to for linking the OAuth2 account\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tredirect: {\n\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\tdescription: \"Indicates that the client should redirect to the provided URL\",\n\t\t\t\t\t\t\t\t\tenum: [true]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\"url\", \"redirect\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (c) => {\n\t\t\t\tconst session = c.context.session;\n\t\t\t\tif (!session) throw new APIError(\"UNAUTHORIZED\", { message: GENERIC_OAUTH_ERROR_CODES.SESSION_REQUIRED });\n\t\t\t\tconst provider = options.config.find((p) => p.providerId === c.body.providerId);\n\t\t\t\tif (!provider) throw new APIError(\"NOT_FOUND\", { message: BASE_ERROR_CODES.PROVIDER_NOT_FOUND });\n\t\t\t\tconst { providerId, clientId, clientSecret, redirectURI, authorizationUrl, discoveryUrl, pkce, scopes, prompt, accessType, authorizationUrlParams } = provider;\n\t\t\t\tlet finalAuthUrl = authorizationUrl;\n\t\t\t\tif (!finalAuthUrl) {\n\t\t\t\t\tif (!discoveryUrl) throw new APIError(\"BAD_REQUEST\", { message: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIGURATION });\n\t\t\t\t\tconst discovery = await betterFetch(discoveryUrl, {\n\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\theaders: provider.discoveryHeaders,\n\t\t\t\t\t\tonError(context) {\n\t\t\t\t\t\t\tc.context.logger.error(context.error.message, context.error, { discoveryUrl });\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (discovery.data) finalAuthUrl = discovery.data.authorization_endpoint;\n\t\t\t\t}\n\t\t\t\tif (!finalAuthUrl) throw new APIError(\"BAD_REQUEST\", { message: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIGURATION });\n\t\t\t\tconst state = await generateState(c, {\n\t\t\t\t\tuserId: session.user.id,\n\t\t\t\t\temail: session.user.email\n\t\t\t\t}, void 0);\n\t\t\t\tconst additionalParams = typeof authorizationUrlParams === \"function\" ? authorizationUrlParams(c) : authorizationUrlParams;\n\t\t\t\tconst url = await createAuthorizationURL({\n\t\t\t\t\tid: providerId,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tclientId,\n\t\t\t\t\t\tclientSecret,\n\t\t\t\t\t\tredirectURI: redirectURI || `${c.context.baseURL}/oauth2/callback/${providerId}`\n\t\t\t\t\t},\n\t\t\t\t\tauthorizationEndpoint: finalAuthUrl,\n\t\t\t\t\tstate: state.state,\n\t\t\t\t\tcodeVerifier: pkce ? state.codeVerifier : void 0,\n\t\t\t\t\tscopes: c.body.scopes || scopes || [],\n\t\t\t\t\tredirectURI: redirectURI || `${c.context.baseURL}/oauth2/callback/${providerId}`,\n\t\t\t\t\tprompt,\n\t\t\t\t\taccessType,\n\t\t\t\t\tadditionalParams\n\t\t\t\t});\n\t\t\t\treturn c.json({\n\t\t\t\t\turl: url.toString(),\n\t\t\t\t\tredirect: true\n\t\t\t\t});\n\t\t\t})\n\t\t},\n\t\t$ERROR_CODES: GENERIC_OAUTH_ERROR_CODES\n\t};\n};\n\n//#endregion\nexport { line as a, auth0 as c, microsoftEntraId as i, slack as n, keycloak as o, okta as r, hubspot as s, genericOAuth as t };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 12387, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/haveibeenpwned-BSsFUFTi.mjs"],"sourcesContent":["import { t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport { getCurrentAuthContext } from \"@better-auth/core/context\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport { betterFetch } from \"@better-fetch/fetch\";\n\n//#region src/plugins/haveibeenpwned/index.ts\nconst ERROR_CODES = defineErrorCodes({ PASSWORD_COMPROMISED: \"The password you entered has been compromised. Please choose a different password.\" });\nasync function checkPasswordCompromise(password, customMessage) {\n\tif (!password) return;\n\tconst sha1Hash = (await createHash(\"SHA-1\", \"hex\").digest(password)).toUpperCase();\n\tconst prefix = sha1Hash.substring(0, 5);\n\tconst suffix = sha1Hash.substring(5);\n\ttry {\n\t\tconst { data, error } = await betterFetch(`https://api.pwnedpasswords.com/range/${prefix}`, { headers: {\n\t\t\t\"Add-Padding\": \"true\",\n\t\t\t\"User-Agent\": \"BetterAuth Password Checker\"\n\t\t} });\n\t\tif (error) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: `Failed to check password. Status: ${error.status}` });\n\t\tif (data.split(\"\\n\").some((line) => line.split(\":\")[0].toUpperCase() === suffix.toUpperCase())) throw new APIError(\"BAD_REQUEST\", {\n\t\t\tmessage: customMessage || ERROR_CODES.PASSWORD_COMPROMISED,\n\t\t\tcode: \"PASSWORD_COMPROMISED\"\n\t\t});\n\t} catch (error) {\n\t\tif (error instanceof APIError) throw error;\n\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", { message: \"Failed to check password. Please try again later.\" });\n\t}\n}\nconst haveIBeenPwned = (options) => {\n\tconst paths = options?.paths || [\n\t\t\"/sign-up/email\",\n\t\t\"/change-password\",\n\t\t\"/reset-password\"\n\t];\n\treturn {\n\t\tid: \"haveIBeenPwned\",\n\t\tinit(ctx) {\n\t\t\treturn { context: { password: {\n\t\t\t\t...ctx.password,\n\t\t\t\tasync hash(password) {\n\t\t\t\t\tconst c = await getCurrentAuthContext();\n\t\t\t\t\tif (!c.path || !paths.includes(c.path)) return ctx.password.hash(password);\n\t\t\t\t\tawait checkPasswordCompromise(password, options?.customPasswordCompromisedMessage);\n\t\t\t\t\treturn ctx.password.hash(password);\n\t\t\t\t}\n\t\t\t} } };\n\t\t},\n\t\t$ERROR_CODES: ERROR_CODES\n\t};\n};\n\n//#endregion\nexport { haveIBeenPwned as t };"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;;;;;;AAEA,6CAA6C;AAC7C,MAAM,cAAc,IAAA,qOAAgB,EAAC;IAAE,sBAAsB;AAAqF;AAClJ,eAAe,wBAAwB,QAAQ,EAAE,aAAa;IAC7D,IAAI,CAAC,UAAU;IACf,MAAM,WAAW,CAAC,MAAM,IAAA,0KAAU,EAAC,SAAS,OAAO,MAAM,CAAC,SAAS,EAAE,WAAW;IAChF,MAAM,SAAS,SAAS,SAAS,CAAC,GAAG;IACrC,MAAM,SAAS,SAAS,SAAS,CAAC;IAClC,IAAI;QACH,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,IAAA,4KAAW,EAAC,CAAC,qCAAqC,EAAE,QAAQ,EAAE;YAAE,SAAS;gBACtG,eAAe;gBACf,cAAc;YACf;QAAE;QACF,IAAI,OAAO,MAAM,IAAI,uLAAQ,CAAC,yBAAyB;YAAE,SAAS,CAAC,kCAAkC,EAAE,MAAM,MAAM,EAAE;QAAC;QACtH,IAAI,KAAK,KAAK,CAAC,MAAM,IAAI,CAAC,CAAC,OAAS,KAAK,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,WAAW,OAAO,OAAO,WAAW,KAAK,MAAM,IAAI,uLAAQ,CAAC,eAAe;YACjI,SAAS,iBAAiB,YAAY,oBAAoB;YAC1D,MAAM;QACP;IACD,EAAE,OAAO,OAAO;QACf,IAAI,iBAAiB,uLAAQ,EAAE,MAAM;QACrC,MAAM,IAAI,uLAAQ,CAAC,yBAAyB;YAAE,SAAS;QAAoD;IAC5G;AACD;AACA,MAAM,iBAAiB,CAAC;IACvB,MAAM,QAAQ,SAAS,SAAS;QAC/B;QACA;QACA;KACA;IACD,OAAO;QACN,IAAI;QACJ,MAAK,GAAG;YACP,OAAO;gBAAE,SAAS;oBAAE,UAAU;wBAC7B,GAAG,IAAI,QAAQ;wBACf,MAAM,MAAK,QAAQ;4BAClB,MAAM,IAAI,MAAM,IAAA,iPAAqB;4BACrC,IAAI,CAAC,EAAE,IAAI,IAAI,CAAC,MAAM,QAAQ,CAAC,EAAE,IAAI,GAAG,OAAO,IAAI,QAAQ,CAAC,IAAI,CAAC;4BACjE,MAAM,wBAAwB,UAAU,SAAS;4BACjD,OAAO,IAAI,QAAQ,CAAC,IAAI,CAAC;wBAC1B;oBACD;gBAAE;YAAE;QACL;QACA,cAAc;IACf;AACD","ignoreList":[0]}},
    {"offset": {"line": 12465, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/magic-link-QdHvtdfs.mjs"],"sourcesContent":["import { r as generateRandomString } from \"./crypto-CFUhAR9W.mjs\";\nimport { L as originCheck } from \"./api-CkmycQ2x.mjs\";\nimport { c as setSessionCookie } from \"./cookies-D72PbWdz.mjs\";\nimport * as z from \"zod\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { base64Url } from \"@better-auth/utils/base64\";\n\n//#region src/plugins/magic-link/utils.ts\nconst defaultKeyHasher = async (otp) => {\n\tconst hash = await createHash(\"SHA-256\").digest(new TextEncoder().encode(otp));\n\treturn base64Url.encode(new Uint8Array(hash), { padding: false });\n};\n\n//#endregion\n//#region src/plugins/magic-link/index.ts\nconst magicLink = (options) => {\n\tconst opts = {\n\t\tstoreToken: \"plain\",\n\t\t...options\n\t};\n\tasync function storeToken(ctx, token) {\n\t\tif (opts.storeToken === \"hashed\") return await defaultKeyHasher(token);\n\t\tif (typeof opts.storeToken === \"object\" && \"type\" in opts.storeToken && opts.storeToken.type === \"custom-hasher\") return await opts.storeToken.hash(token);\n\t\treturn token;\n\t}\n\treturn {\n\t\tid: \"magic-link\",\n\t\tendpoints: {\n\t\t\tsignInMagicLink: createAuthEndpoint(\"/sign-in/magic-link\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\trequireHeaders: true,\n\t\t\t\tbody: z.object({\n\t\t\t\t\temail: z.email().meta({ description: \"Email address to send the magic link\" }),\n\t\t\t\t\tname: z.string().meta({ description: \"User display name. Only used if the user is registering for the first time. Eg: \\\"my-name\\\"\" }).optional(),\n\t\t\t\t\tcallbackURL: z.string().meta({ description: \"URL to redirect after magic link verification\" }).optional(),\n\t\t\t\t\tnewUserCallbackURL: z.string().meta({ description: \"URL to redirect after new user signup. Only used if the user is registering for the first time.\" }).optional(),\n\t\t\t\t\terrorCallbackURL: z.string().meta({ description: \"URL to redirect after error.\" }).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"signInWithMagicLink\",\n\t\t\t\t\tdescription: \"Sign in with magic link\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { status: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { email } = ctx.body;\n\t\t\t\tconst verificationToken = opts?.generateToken ? await opts.generateToken(email) : generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\tconst storedToken = await storeToken(ctx, verificationToken);\n\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\tidentifier: storedToken,\n\t\t\t\t\tvalue: JSON.stringify({\n\t\t\t\t\t\temail,\n\t\t\t\t\t\tname: ctx.body.name\n\t\t\t\t\t}),\n\t\t\t\t\texpiresAt: new Date(Date.now() + (opts.expiresIn || 300) * 1e3)\n\t\t\t\t});\n\t\t\t\tconst realBaseURL = new URL(ctx.context.baseURL);\n\t\t\t\tconst pathname = realBaseURL.pathname === \"/\" ? \"\" : realBaseURL.pathname;\n\t\t\t\tconst basePath = pathname ? \"\" : ctx.context.options.basePath || \"\";\n\t\t\t\tconst url = new URL(`${pathname}${basePath}/magic-link/verify`, realBaseURL.origin);\n\t\t\t\turl.searchParams.set(\"token\", verificationToken);\n\t\t\t\turl.searchParams.set(\"callbackURL\", ctx.body.callbackURL || \"/\");\n\t\t\t\tif (ctx.body.newUserCallbackURL) url.searchParams.set(\"newUserCallbackURL\", ctx.body.newUserCallbackURL);\n\t\t\t\tif (ctx.body.errorCallbackURL) url.searchParams.set(\"errorCallbackURL\", ctx.body.errorCallbackURL);\n\t\t\t\tawait options.sendMagicLink({\n\t\t\t\t\temail,\n\t\t\t\t\turl: url.toString(),\n\t\t\t\t\ttoken: verificationToken\n\t\t\t\t}, ctx);\n\t\t\t\treturn ctx.json({ status: true });\n\t\t\t}),\n\t\t\tmagicLinkVerify: createAuthEndpoint(\"/magic-link/verify\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tquery: z.object({\n\t\t\t\t\ttoken: z.string().meta({ description: \"Verification token\" }),\n\t\t\t\t\tcallbackURL: z.string().meta({ description: \"URL to redirect after magic link verification, if not provided the user will be redirected to the root URL. Eg: \\\"/dashboard\\\"\" }).optional(),\n\t\t\t\t\terrorCallbackURL: z.string().meta({ description: \"URL to redirect after error.\" }).optional(),\n\t\t\t\t\tnewUserCallbackURL: z.string().meta({ description: \"URL to redirect after new user signup. Only used if the user is registering for the first time.\" }).optional()\n\t\t\t\t}),\n\t\t\t\tuse: [\n\t\t\t\t\toriginCheck((ctx) => {\n\t\t\t\t\t\treturn ctx.query.callbackURL ? decodeURIComponent(ctx.query.callbackURL) : \"/\";\n\t\t\t\t\t}),\n\t\t\t\t\toriginCheck((ctx) => {\n\t\t\t\t\t\treturn ctx.query.newUserCallbackURL ? decodeURIComponent(ctx.query.newUserCallbackURL) : \"/\";\n\t\t\t\t\t}),\n\t\t\t\t\toriginCheck((ctx) => {\n\t\t\t\t\t\treturn ctx.query.errorCallbackURL ? decodeURIComponent(ctx.query.errorCallbackURL) : \"/\";\n\t\t\t\t\t})\n\t\t\t\t],\n\t\t\t\trequireHeaders: true,\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"verifyMagicLink\",\n\t\t\t\t\tdescription: \"Verify magic link\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tsession: { $ref: \"#/components/schemas/Session\" },\n\t\t\t\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst token = ctx.query.token;\n\t\t\t\tconst callbackURL = new URL(ctx.query.callbackURL ? decodeURIComponent(ctx.query.callbackURL) : \"/\", ctx.context.baseURL).toString();\n\t\t\t\tconst errorCallbackURL = new URL(ctx.query.errorCallbackURL ? decodeURIComponent(ctx.query.errorCallbackURL) : callbackURL, ctx.context.baseURL).toString();\n\t\t\t\tconst newUserCallbackURL = new URL(ctx.query.newUserCallbackURL ? decodeURIComponent(ctx.query.newUserCallbackURL) : callbackURL, ctx.context.baseURL).toString();\n\t\t\t\tcallbackURL?.startsWith(\"http\") || (callbackURL ? `${ctx.context.options.baseURL}${callbackURL}` : ctx.context.options.baseURL);\n\t\t\t\tconst storedToken = await storeToken(ctx, token);\n\t\t\t\tconst tokenValue = await ctx.context.internalAdapter.findVerificationValue(storedToken);\n\t\t\t\tif (!tokenValue) throw ctx.redirect(`${errorCallbackURL}?error=INVALID_TOKEN`);\n\t\t\t\tif (tokenValue.expiresAt < /* @__PURE__ */ new Date()) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(tokenValue.id);\n\t\t\t\t\tthrow ctx.redirect(`${errorCallbackURL}?error=EXPIRED_TOKEN`);\n\t\t\t\t}\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(tokenValue.id);\n\t\t\t\tconst { email, name } = JSON.parse(tokenValue.value);\n\t\t\t\tlet isNewUser = false;\n\t\t\t\tlet user = await ctx.context.internalAdapter.findUserByEmail(email).then((res) => res?.user);\n\t\t\t\tif (!user) if (!opts.disableSignUp) {\n\t\t\t\t\tconst newUser = await ctx.context.internalAdapter.createUser({\n\t\t\t\t\t\temail,\n\t\t\t\t\t\temailVerified: true,\n\t\t\t\t\t\tname: name || \"\"\n\t\t\t\t\t});\n\t\t\t\t\tisNewUser = true;\n\t\t\t\t\tuser = newUser;\n\t\t\t\t\tif (!user) throw ctx.redirect(`${errorCallbackURL}?error=failed_to_create_user`);\n\t\t\t\t} else throw ctx.redirect(`${errorCallbackURL}?error=new_user_signup_disabled`);\n\t\t\t\tif (!user.emailVerified) user = await ctx.context.internalAdapter.updateUser(user.id, { emailVerified: true });\n\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(user.id);\n\t\t\t\tif (!session) throw ctx.redirect(`${errorCallbackURL}?error=failed_to_create_session`);\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser\n\t\t\t\t});\n\t\t\t\tif (!ctx.query.callbackURL) return ctx.json({\n\t\t\t\t\ttoken: session.token,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\temailVerified: user.emailVerified,\n\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\timage: user.image,\n\t\t\t\t\t\tcreatedAt: user.createdAt,\n\t\t\t\t\t\tupdatedAt: user.updatedAt\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (isNewUser) throw ctx.redirect(newUserCallbackURL);\n\t\t\t\tthrow ctx.redirect(callbackURL);\n\t\t\t})\n\t\t},\n\t\trateLimit: [{\n\t\t\tpathMatcher(path) {\n\t\t\t\treturn path.startsWith(\"/sign-in/magic-link\") || path.startsWith(\"/magic-link/verify\");\n\t\t\t},\n\t\t\twindow: opts.rateLimit?.window || 60,\n\t\t\tmax: opts.rateLimit?.max || 5\n\t\t}]\n\t};\n};\n\n//#endregion\nexport { magicLink as t };"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AAEA,yCAAyC;AACzC,MAAM,mBAAmB,OAAO;IAC/B,MAAM,OAAO,MAAM,IAAA,0KAAU,EAAC,WAAW,MAAM,CAAC,IAAI,cAAc,MAAM,CAAC;IACzE,OAAO,2KAAS,CAAC,MAAM,CAAC,IAAI,WAAW,OAAO;QAAE,SAAS;IAAM;AAChE;AAEA,YAAY;AACZ,yCAAyC;AACzC,MAAM,YAAY,CAAC;IAClB,MAAM,OAAO;QACZ,YAAY;QACZ,GAAG,OAAO;IACX;IACA,eAAe,WAAW,GAAG,EAAE,KAAK;QACnC,IAAI,KAAK,UAAU,KAAK,UAAU,OAAO,MAAM,iBAAiB;QAChE,IAAI,OAAO,KAAK,UAAU,KAAK,YAAY,UAAU,KAAK,UAAU,IAAI,KAAK,UAAU,CAAC,IAAI,KAAK,iBAAiB,OAAO,MAAM,KAAK,UAAU,CAAC,IAAI,CAAC;QACpJ,OAAO;IACR;IACA,OAAO;QACN,IAAI;QACJ,WAAW;YACV,iBAAiB,IAAA,yLAAkB,EAAC,uBAAuB;gBAC1D,QAAQ;gBACR,gBAAgB;gBAChB,MAAM,2JAAQ,CAAC;oBACd,OAAO,0JAAO,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAAuC;oBAC5E,MAAM,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAA8F,GAAG,QAAQ;oBAC9I,aAAa,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAAgD,GAAG,QAAQ;oBACvG,oBAAoB,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAAkG,GAAG,QAAQ;oBAChK,kBAAkB,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAA+B,GAAG,QAAQ;gBAC5F;gBACA,UAAU;oBAAE,SAAS;wBACpB,aAAa;wBACb,aAAa;wBACb,WAAW;4BAAE,KAAK;gCACjB,aAAa;gCACb,SAAS;oCAAE,oBAAoB;wCAAE,QAAQ;4CACxC,MAAM;4CACN,YAAY;gDAAE,QAAQ;oDAAE,MAAM;gDAAU;4CAAE;wCAC3C;oCAAE;gCAAE;4BACL;wBAAE;oBACH;gBAAE;YACH,GAAG,OAAO;gBACT,MAAM,EAAE,KAAK,EAAE,GAAG,IAAI,IAAI;gBAC1B,MAAM,oBAAoB,MAAM,gBAAgB,MAAM,KAAK,aAAa,CAAC,SAAS,IAAA,oKAAoB,EAAC,IAAI,OAAO;gBAClH,MAAM,cAAc,MAAM,WAAW,KAAK;gBAC1C,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,uBAAuB,CAAC;oBACzD,YAAY;oBACZ,OAAO,KAAK,SAAS,CAAC;wBACrB;wBACA,MAAM,IAAI,IAAI,CAAC,IAAI;oBACpB;oBACA,WAAW,IAAI,KAAK,KAAK,GAAG,KAAK,CAAC,KAAK,SAAS,IAAI,GAAG,IAAI;gBAC5D;gBACA,MAAM,cAAc,IAAI,IAAI,IAAI,OAAO,CAAC,OAAO;gBAC/C,MAAM,WAAW,YAAY,QAAQ,KAAK,MAAM,KAAK,YAAY,QAAQ;gBACzE,MAAM,WAAW,WAAW,KAAK,IAAI,OAAO,CAAC,OAAO,CAAC,QAAQ,IAAI;gBACjE,MAAM,MAAM,IAAI,IAAI,GAAG,WAAW,SAAS,kBAAkB,CAAC,EAAE,YAAY,MAAM;gBAClF,IAAI,YAAY,CAAC,GAAG,CAAC,SAAS;gBAC9B,IAAI,YAAY,CAAC,GAAG,CAAC,eAAe,IAAI,IAAI,CAAC,WAAW,IAAI;gBAC5D,IAAI,IAAI,IAAI,CAAC,kBAAkB,EAAE,IAAI,YAAY,CAAC,GAAG,CAAC,sBAAsB,IAAI,IAAI,CAAC,kBAAkB;gBACvG,IAAI,IAAI,IAAI,CAAC,gBAAgB,EAAE,IAAI,YAAY,CAAC,GAAG,CAAC,oBAAoB,IAAI,IAAI,CAAC,gBAAgB;gBACjG,MAAM,QAAQ,aAAa,CAAC;oBAC3B;oBACA,KAAK,IAAI,QAAQ;oBACjB,OAAO;gBACR,GAAG;gBACH,OAAO,IAAI,IAAI,CAAC;oBAAE,QAAQ;gBAAK;YAChC;YACA,iBAAiB,IAAA,yLAAkB,EAAC,sBAAsB;gBACzD,QAAQ;gBACR,OAAO,2JAAQ,CAAC;oBACf,OAAO,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAAqB;oBAC3D,aAAa,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAAiI,GAAG,QAAQ;oBACxL,kBAAkB,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAA+B,GAAG,QAAQ;oBAC3F,oBAAoB,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAAkG,GAAG,QAAQ;gBACjK;gBACA,KAAK;oBACJ,IAAA,iLAAW,EAAC,CAAC;wBACZ,OAAO,IAAI,KAAK,CAAC,WAAW,GAAG,mBAAmB,IAAI,KAAK,CAAC,WAAW,IAAI;oBAC5E;oBACA,IAAA,iLAAW,EAAC,CAAC;wBACZ,OAAO,IAAI,KAAK,CAAC,kBAAkB,GAAG,mBAAmB,IAAI,KAAK,CAAC,kBAAkB,IAAI;oBAC1F;oBACA,IAAA,iLAAW,EAAC,CAAC;wBACZ,OAAO,IAAI,KAAK,CAAC,gBAAgB,GAAG,mBAAmB,IAAI,KAAK,CAAC,gBAAgB,IAAI;oBACtF;iBACA;gBACD,gBAAgB;gBAChB,UAAU;oBAAE,SAAS;wBACpB,aAAa;wBACb,aAAa;wBACb,WAAW;4BAAE,KAAK;gCACjB,aAAa;gCACb,SAAS;oCAAE,oBAAoB;wCAAE,QAAQ;4CACxC,MAAM;4CACN,YAAY;gDACX,SAAS;oDAAE,MAAM;gDAA+B;gDAChD,MAAM;oDAAE,MAAM;gDAA4B;4CAC3C;wCACD;oCAAE;gCAAE;4BACL;wBAAE;oBACH;gBAAE;YACH,GAAG,OAAO;gBACT,MAAM,QAAQ,IAAI,KAAK,CAAC,KAAK;gBAC7B,MAAM,cAAc,IAAI,IAAI,IAAI,KAAK,CAAC,WAAW,GAAG,mBAAmB,IAAI,KAAK,CAAC,WAAW,IAAI,KAAK,IAAI,OAAO,CAAC,OAAO,EAAE,QAAQ;gBAClI,MAAM,mBAAmB,IAAI,IAAI,IAAI,KAAK,CAAC,gBAAgB,GAAG,mBAAmB,IAAI,KAAK,CAAC,gBAAgB,IAAI,aAAa,IAAI,OAAO,CAAC,OAAO,EAAE,QAAQ;gBACzJ,MAAM,qBAAqB,IAAI,IAAI,IAAI,KAAK,CAAC,kBAAkB,GAAG,mBAAmB,IAAI,KAAK,CAAC,kBAAkB,IAAI,aAAa,IAAI,OAAO,CAAC,OAAO,EAAE,QAAQ;gBAC/J,aAAa,WAAW,WAAW,CAAC,cAAc,GAAG,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO,GAAG,aAAa,GAAG,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO;gBAC9H,MAAM,cAAc,MAAM,WAAW,KAAK;gBAC1C,MAAM,aAAa,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,qBAAqB,CAAC;gBAC3E,IAAI,CAAC,YAAY,MAAM,IAAI,QAAQ,CAAC,GAAG,iBAAiB,oBAAoB,CAAC;gBAC7E,IAAI,WAAW,SAAS,GAAG,aAAa,GAAG,IAAI,QAAQ;oBACtD,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,uBAAuB,CAAC,WAAW,EAAE;oBACvE,MAAM,IAAI,QAAQ,CAAC,GAAG,iBAAiB,oBAAoB,CAAC;gBAC7D;gBACA,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,uBAAuB,CAAC,WAAW,EAAE;gBACvE,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,KAAK,KAAK,CAAC,WAAW,KAAK;gBACnD,IAAI,YAAY;gBAChB,IAAI,OAAO,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,eAAe,CAAC,OAAO,IAAI,CAAC,CAAC,MAAQ,KAAK;gBACvF,IAAI,CAAC,MAAM,IAAI,CAAC,KAAK,aAAa,EAAE;oBACnC,MAAM,UAAU,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,UAAU,CAAC;wBAC5D;wBACA,eAAe;wBACf,MAAM,QAAQ;oBACf;oBACA,YAAY;oBACZ,OAAO;oBACP,IAAI,CAAC,MAAM,MAAM,IAAI,QAAQ,CAAC,GAAG,iBAAiB,4BAA4B,CAAC;gBAChF,OAAO,MAAM,IAAI,QAAQ,CAAC,GAAG,iBAAiB,+BAA+B,CAAC;gBAC9E,IAAI,CAAC,KAAK,aAAa,EAAE,OAAO,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,UAAU,CAAC,KAAK,EAAE,EAAE;oBAAE,eAAe;gBAAK;gBAC5G,MAAM,UAAU,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,aAAa,CAAC,KAAK,EAAE;gBACvE,IAAI,CAAC,SAAS,MAAM,IAAI,QAAQ,CAAC,GAAG,iBAAiB,+BAA+B,CAAC;gBACrF,MAAM,IAAA,qKAAgB,EAAC,KAAK;oBAC3B;oBACA;gBACD;gBACA,IAAI,CAAC,IAAI,KAAK,CAAC,WAAW,EAAE,OAAO,IAAI,IAAI,CAAC;oBAC3C,OAAO,QAAQ,KAAK;oBACpB,MAAM;wBACL,IAAI,KAAK,EAAE;wBACX,OAAO,KAAK,KAAK;wBACjB,eAAe,KAAK,aAAa;wBACjC,MAAM,KAAK,IAAI;wBACf,OAAO,KAAK,KAAK;wBACjB,WAAW,KAAK,SAAS;wBACzB,WAAW,KAAK,SAAS;oBAC1B;gBACD;gBACA,IAAI,WAAW,MAAM,IAAI,QAAQ,CAAC;gBAClC,MAAM,IAAI,QAAQ,CAAC;YACpB;QACD;QACA,WAAW;YAAC;gBACX,aAAY,IAAI;oBACf,OAAO,KAAK,UAAU,CAAC,0BAA0B,KAAK,UAAU,CAAC;gBAClE;gBACA,QAAQ,KAAK,SAAS,EAAE,UAAU;gBAClC,KAAK,KAAK,SAAS,EAAE,OAAO;YAC7B;SAAE;IACH;AACD","ignoreList":[0]}},
    {"offset": {"line": 12699, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/multi-session-CbEYz_wJ.mjs"],"sourcesContent":["import { t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport { c as setSessionCookie, l as parseSetCookieHeader, n as deleteSessionCookie, o as parseCookies } from \"./cookies-D72PbWdz.mjs\";\nimport { u as sessionMiddleware } from \"./session-AaRl3_x-.mjs\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\n\n//#region src/plugins/multi-session/index.ts\nconst ERROR_CODES = defineErrorCodes({ INVALID_SESSION_TOKEN: \"Invalid session token\" });\nconst multiSession = (options) => {\n\tconst opts = {\n\t\tmaximumSessions: 5,\n\t\t...options\n\t};\n\tconst isMultiSessionCookie = (key) => key.includes(\"_multi-\");\n\treturn {\n\t\tid: \"multi-session\",\n\t\tendpoints: {\n\t\t\tlistDeviceSessions: createAuthEndpoint(\"/multi-session/list-device-sessions\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\trequireHeaders: true\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst cookieHeader = ctx.headers?.get(\"cookie\");\n\t\t\t\tif (!cookieHeader) return ctx.json([]);\n\t\t\t\tconst cookies = Object.fromEntries(parseCookies(cookieHeader));\n\t\t\t\tconst sessionTokens = (await Promise.all(Object.entries(cookies).filter(([key]) => isMultiSessionCookie(key)).map(async ([key]) => await ctx.getSignedCookie(key, ctx.context.secret)))).filter((v) => typeof v === \"string\");\n\t\t\t\tif (!sessionTokens.length) return ctx.json([]);\n\t\t\t\tconst uniqueUserSessions = (await ctx.context.internalAdapter.findSessions(sessionTokens)).filter((session) => session && session.session.expiresAt > /* @__PURE__ */ new Date()).reduce((acc, session) => {\n\t\t\t\t\tif (!acc.find((s) => s.user.id === session.user.id)) acc.push(session);\n\t\t\t\t\treturn acc;\n\t\t\t\t}, []);\n\t\t\t\treturn ctx.json(uniqueUserSessions);\n\t\t\t}),\n\t\t\tsetActiveSession: createAuthEndpoint(\"/multi-session/set-active\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ sessionToken: z.string().meta({ description: \"The session token to set as active\" }) }),\n\t\t\t\trequireHeaders: true,\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Set the active session\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { session: { $ref: \"#/components/schemas/Session\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst sessionToken = ctx.body.sessionToken;\n\t\t\t\tconst multiSessionCookieName = `${ctx.context.authCookies.sessionToken.name}_multi-${sessionToken.toLowerCase()}`;\n\t\t\t\tif (!await ctx.getSignedCookie(multiSessionCookieName, ctx.context.secret)) throw new APIError(\"UNAUTHORIZED\", { message: ERROR_CODES.INVALID_SESSION_TOKEN });\n\t\t\t\tconst session = await ctx.context.internalAdapter.findSession(sessionToken);\n\t\t\t\tif (!session || session.session.expiresAt < /* @__PURE__ */ new Date()) {\n\t\t\t\t\tctx.setCookie(multiSessionCookieName, \"\", {\n\t\t\t\t\t\t...ctx.context.authCookies.sessionToken.options,\n\t\t\t\t\t\tmaxAge: 0\n\t\t\t\t\t});\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: ERROR_CODES.INVALID_SESSION_TOKEN });\n\t\t\t\t}\n\t\t\t\tawait setSessionCookie(ctx, session);\n\t\t\t\treturn ctx.json(session);\n\t\t\t}),\n\t\t\trevokeDeviceSession: createAuthEndpoint(\"/multi-session/revoke\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ sessionToken: z.string().meta({ description: \"The session token to revoke\" }) }),\n\t\t\t\trequireHeaders: true,\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Revoke a device session\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { status: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst sessionToken = ctx.body.sessionToken;\n\t\t\t\tconst multiSessionCookieName = `${ctx.context.authCookies.sessionToken.name}_multi-${sessionToken.toLowerCase()}`;\n\t\t\t\tif (!await ctx.getSignedCookie(multiSessionCookieName, ctx.context.secret)) throw new APIError(\"UNAUTHORIZED\", { message: ERROR_CODES.INVALID_SESSION_TOKEN });\n\t\t\t\tawait ctx.context.internalAdapter.deleteSession(sessionToken);\n\t\t\t\tctx.setCookie(multiSessionCookieName, \"\", {\n\t\t\t\t\t...ctx.context.authCookies.sessionToken.options,\n\t\t\t\t\tmaxAge: 0\n\t\t\t\t});\n\t\t\t\tif (!(ctx.context.session?.session.token === sessionToken)) return ctx.json({ status: true });\n\t\t\t\tconst cookieHeader = ctx.headers?.get(\"cookie\");\n\t\t\t\tif (cookieHeader) {\n\t\t\t\t\tconst cookies = Object.fromEntries(parseCookies(cookieHeader));\n\t\t\t\t\tconst sessionTokens = (await Promise.all(Object.entries(cookies).filter(([key]) => isMultiSessionCookie(key)).map(async ([key]) => await ctx.getSignedCookie(key, ctx.context.secret)))).filter((v) => typeof v === \"string\");\n\t\t\t\t\tconst internalAdapter = ctx.context.internalAdapter;\n\t\t\t\t\tif (sessionTokens.length > 0) {\n\t\t\t\t\t\tconst validSessions = (await internalAdapter.findSessions(sessionTokens)).filter((session) => session && session.session.expiresAt > /* @__PURE__ */ new Date());\n\t\t\t\t\t\tif (validSessions.length > 0) {\n\t\t\t\t\t\t\tconst nextSession = validSessions[0];\n\t\t\t\t\t\t\tawait setSessionCookie(ctx, nextSession);\n\t\t\t\t\t\t} else deleteSessionCookie(ctx);\n\t\t\t\t\t} else deleteSessionCookie(ctx);\n\t\t\t\t} else deleteSessionCookie(ctx);\n\t\t\t\treturn ctx.json({ status: true });\n\t\t\t})\n\t\t},\n\t\thooks: { after: [{\n\t\t\tmatcher: () => true,\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst cookieString = ctx.context.responseHeaders?.get(\"set-cookie\");\n\t\t\t\tif (!cookieString) return;\n\t\t\t\tconst setCookies = parseSetCookieHeader(cookieString);\n\t\t\t\tconst sessionCookieConfig = ctx.context.authCookies.sessionToken;\n\t\t\t\tconst sessionToken = ctx.context.newSession?.session.token;\n\t\t\t\tif (!sessionToken) return;\n\t\t\t\tconst cookies = parseCookies(ctx.headers?.get(\"cookie\") || \"\");\n\t\t\t\tconst cookieName = `${sessionCookieConfig.name}_multi-${sessionToken.toLowerCase()}`;\n\t\t\t\tif (setCookies.get(cookieName) || cookies.get(cookieName)) return;\n\t\t\t\tif (Object.keys(Object.fromEntries(cookies)).filter(isMultiSessionCookie).length + (cookieString.includes(\"session_token\") ? 1 : 0) >= opts.maximumSessions) return;\n\t\t\t\tawait ctx.setSignedCookie(cookieName, sessionToken, ctx.context.secret, sessionCookieConfig.options);\n\t\t\t})\n\t\t}, {\n\t\t\tmatcher: (context) => context.path === \"/sign-out\",\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst cookieHeader = ctx.headers?.get(\"cookie\");\n\t\t\t\tif (!cookieHeader) return;\n\t\t\t\tconst cookies = Object.fromEntries(parseCookies(cookieHeader));\n\t\t\t\tconst multiSessionKeys = Object.keys(cookies).filter((key) => isMultiSessionCookie(key));\n\t\t\t\tconst verifiedTokens = (await Promise.all(multiSessionKeys.map(async (key) => {\n\t\t\t\t\tconst verifiedToken = await ctx.getSignedCookie(key, ctx.context.secret);\n\t\t\t\t\tif (verifiedToken) {\n\t\t\t\t\t\tctx.setCookie(key.toLowerCase().replace(\"__secure-\", \"__Secure-\"), \"\", {\n\t\t\t\t\t\t\t...ctx.context.authCookies.sessionToken.options,\n\t\t\t\t\t\t\tmaxAge: 0\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn verifiedToken;\n\t\t\t\t\t}\n\t\t\t\t\treturn null;\n\t\t\t\t}))).filter((v) => typeof v === \"string\");\n\t\t\t\tif (verifiedTokens.length > 0) await ctx.context.internalAdapter.deleteSessions(verifiedTokens);\n\t\t\t})\n\t\t}] },\n\t\t$ERROR_CODES: ERROR_CODES\n\t};\n};\n\n//#endregion\nexport { multiSession as t };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 12911, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/oauth-proxy-Dz1E1SVN.mjs"],"sourcesContent":["import { n as symmetricEncrypt, t as symmetricDecrypt } from \"./crypto-CFUhAR9W.mjs\";\nimport { r as getOrigin } from \"./url-CB8xCwz-.mjs\";\nimport { L as originCheck } from \"./api-CkmycQ2x.mjs\";\nimport { l as parseSetCookieHeader } from \"./cookies-D72PbWdz.mjs\";\nimport { t as parseJSON } from \"./parser-pHp5yoAv.mjs\";\nimport { env } from \"@better-auth/core/env\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\n\n//#region src/plugins/oauth-proxy/utils.ts\n/**\n* Get base URL from vendor-specific environment variables\n*/\nfunction getVendorBaseURL() {\n\tconst vercel = env.VERCEL_URL ? `https://${env.VERCEL_URL}` : void 0;\n\tconst netlify = env.NETLIFY_URL;\n\tconst render = env.RENDER_URL;\n\tconst aws = env.AWS_LAMBDA_FUNCTION_NAME;\n\tconst google = env.GOOGLE_CLOUD_FUNCTION_NAME;\n\tconst azure = env.AZURE_FUNCTION_NAME;\n\treturn vercel || netlify || render || aws || google || azure;\n}\n/**\n* Resolve the current URL from various sources\n*/\nfunction resolveCurrentURL(ctx, opts) {\n\treturn new URL(opts?.currentURL || ctx.request?.url || getVendorBaseURL() || ctx.context.baseURL);\n}\n/**\n* Check if the proxy should be skipped for this request\n*/\nfunction checkSkipProxy(ctx, opts) {\n\tif (ctx.request?.headers.get(\"x-skip-oauth-proxy\")) return true;\n\tconst productionURL = opts?.productionURL || env.BETTER_AUTH_URL;\n\tif (!productionURL) return false;\n\tconst currentURL = ctx.request?.url || getVendorBaseURL();\n\tif (!currentURL) return false;\n\treturn getOrigin(productionURL) === getOrigin(currentURL);\n}\n\n//#endregion\n//#region src/plugins/oauth-proxy/index.ts\nconst oAuthProxy = (opts) => {\n\treturn {\n\t\tid: \"oauth-proxy\",\n\t\toptions: opts,\n\t\tendpoints: { oAuthProxy: createAuthEndpoint(\"/oauth-proxy-callback\", {\n\t\t\tmethod: \"GET\",\n\t\t\toperationId: \"oauthProxyCallback\",\n\t\t\tquery: z.object({\n\t\t\t\tcallbackURL: z.string().meta({ description: \"The URL to redirect to after the proxy\" }),\n\t\t\t\tcookies: z.string().meta({ description: \"The cookies to set after the proxy\" })\n\t\t\t}),\n\t\t\tuse: [originCheck((ctx) => ctx.query.callbackURL)],\n\t\t\tmetadata: { openapi: {\n\t\t\t\toperationId: \"oauthProxyCallback\",\n\t\t\t\tdescription: \"OAuth Proxy Callback\",\n\t\t\t\tparameters: [{\n\t\t\t\t\tin: \"query\",\n\t\t\t\t\tname: \"callbackURL\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tdescription: \"The URL to redirect to after the proxy\"\n\t\t\t\t}, {\n\t\t\t\t\tin: \"query\",\n\t\t\t\t\tname: \"cookies\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tdescription: \"The cookies to set after the proxy\"\n\t\t\t\t}],\n\t\t\t\tresponses: { 302: {\n\t\t\t\t\tdescription: \"Redirect\",\n\t\t\t\t\theaders: { Location: {\n\t\t\t\t\t\tdescription: \"The URL to redirect to\",\n\t\t\t\t\t\tschema: { type: \"string\" }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t} }\n\t\t}, async (ctx) => {\n\t\t\tconst decryptedCookies = await symmetricDecrypt({\n\t\t\t\tkey: ctx.context.secret,\n\t\t\t\tdata: ctx.query.cookies\n\t\t\t}).catch((e) => {\n\t\t\t\tctx.context.logger.error(\"Failed to decrypt OAuth proxy cookies:\", e);\n\t\t\t\treturn null;\n\t\t\t});\n\t\t\tif (!decryptedCookies) {\n\t\t\t\tconst errorURL = ctx.context.options.onAPIError?.errorURL || `${ctx.context.options.baseURL}/api/auth/error`;\n\t\t\t\tthrow ctx.redirect(`${errorURL}?error=OAuthProxy - Invalid cookies or secret`);\n\t\t\t}\n\t\t\tconst isSecureContext = resolveCurrentURL(ctx, opts).protocol === \"https:\";\n\t\t\tconst parsedCookies = parseSetCookieHeader(decryptedCookies);\n\t\t\tconst processedCookies = Array.from(parsedCookies.entries()).map(([name, attrs]) => {\n\t\t\t\tconst options = {};\n\t\t\t\tif (attrs.path) options.path = attrs.path;\n\t\t\t\tif (attrs.expires) options.expires = attrs.expires;\n\t\t\t\tif (attrs.samesite) options.sameSite = attrs.samesite;\n\t\t\t\tif (attrs.httponly) options.httpOnly = true;\n\t\t\t\tif (attrs[\"max-age\"] !== void 0) options.maxAge = attrs[\"max-age\"];\n\t\t\t\tif (isSecureContext) options.secure = true;\n\t\t\t\treturn {\n\t\t\t\t\tname,\n\t\t\t\t\toptions,\n\t\t\t\t\tvalue: decodeURIComponent(attrs.value)\n\t\t\t\t};\n\t\t\t});\n\t\t\tfor (const cookie of processedCookies) ctx.setCookie(cookie.name, cookie.value, cookie.options);\n\t\t\tthrow ctx.redirect(ctx.query.callbackURL);\n\t\t}) },\n\t\thooks: {\n\t\t\tbefore: [\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn !!(context.path?.startsWith(\"/sign-in/social\") || context.path?.startsWith(\"/sign-in/oauth2\"));\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tif (checkSkipProxy(ctx, opts)) return;\n\t\t\t\t\t\tconst currentURL = resolveCurrentURL(ctx, opts);\n\t\t\t\t\t\tconst originalCallbackURL = ctx.body?.callbackURL || ctx.context.baseURL;\n\t\t\t\t\t\tconst newCallbackURL = `${currentURL.origin}${ctx.context.options.basePath || \"/api/auth\"}/oauth-proxy-callback?callbackURL=${encodeURIComponent(originalCallbackURL)}`;\n\t\t\t\t\t\tif (!ctx.body) return;\n\t\t\t\t\t\tctx.body.callbackURL = newCallbackURL;\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn !!(context.path?.startsWith(\"/callback\") || context.path?.startsWith(\"/oauth2/callback\"));\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst state = ctx.query?.state || ctx.body?.state;\n\t\t\t\t\t\tif (!state || typeof state !== \"string\") return;\n\t\t\t\t\t\tlet statePackage;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tstatePackage = parseJSON(await symmetricDecrypt({\n\t\t\t\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\t\t\t\tdata: state\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!statePackage.isOAuthProxy || !statePackage.state || !statePackage.stateCookie) return;\n\t\t\t\t\t\tlet stateCookieValue;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tstateCookieValue = await symmetricDecrypt({\n\t\t\t\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\t\t\t\tdata: statePackage.stateCookie\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tparseJSON(stateCookieValue);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tctx.context.logger.error(\"Failed to decrypt OAuth proxy state cookie:\", e);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tctx.context._oauthProxySnapshot = {\n\t\t\t\t\t\t\tstoreStateStrategy: ctx.context.oauthConfig.storeStateStrategy,\n\t\t\t\t\t\t\tskipStateCookieCheck: ctx.context.oauthConfig.skipStateCookieCheck,\n\t\t\t\t\t\t\tinternalAdapter: ctx.context.internalAdapter\n\t\t\t\t\t\t};\n\t\t\t\t\t\tconst originalAdapter = ctx.context.internalAdapter;\n\t\t\t\t\t\tconst capturedStatePackage = statePackage;\n\t\t\t\t\t\tctx.context.oauthConfig.storeStateStrategy = \"database\";\n\t\t\t\t\t\tctx.context.internalAdapter = {\n\t\t\t\t\t\t\t...ctx.context.internalAdapter,\n\t\t\t\t\t\t\tfindVerificationValue: async (identifier) => {\n\t\t\t\t\t\t\t\tif (identifier === capturedStatePackage.state) return {\n\t\t\t\t\t\t\t\t\tid: `oauth-proxy-${capturedStatePackage.state}`,\n\t\t\t\t\t\t\t\t\tidentifier: capturedStatePackage.state,\n\t\t\t\t\t\t\t\t\tvalue: stateCookieValue,\n\t\t\t\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\t\t\t\texpiresAt: new Date(Date.now() + 600 * 1e3)\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\treturn originalAdapter.findVerificationValue(identifier);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (ctx.query?.state) ctx.query.state = statePackage.state;\n\t\t\t\t\t\tif (ctx.body?.state) ctx.body.state = statePackage.state;\n\t\t\t\t\t\tctx.context.oauthConfig.skipStateCookieCheck = true;\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tmatcher() {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tif (ctx.path !== \"/callback/:id\") return;\n\t\t\t\t\t\tif (ctx.context.oauthConfig.storeStateStrategy === \"cookie\") return;\n\t\t\t\t\t\tif (ctx.context._oauthProxySnapshot) return;\n\t\t\t\t\t\tconst state = ctx.query?.state || ctx.body?.state;\n\t\t\t\t\t\tif (!state) return;\n\t\t\t\t\t\tconst data = await ctx.context.internalAdapter.findVerificationValue(state);\n\t\t\t\t\t\tif (!data) return;\n\t\t\t\t\t\tlet parsedState;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tparsedState = parseJSON(data.value);\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\tparsedState = void 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!parsedState?.callbackURL?.includes(\"/oauth-proxy-callback\")) return;\n\t\t\t\t\t\tctx.context._oauthProxySnapshot = {\n\t\t\t\t\t\t\tstoreStateStrategy: ctx.context.oauthConfig.storeStateStrategy,\n\t\t\t\t\t\t\tskipStateCookieCheck: ctx.context.oauthConfig.skipStateCookieCheck,\n\t\t\t\t\t\t\tinternalAdapter: ctx.context.internalAdapter\n\t\t\t\t\t\t};\n\t\t\t\t\t\tctx.context.oauthConfig.skipStateCookieCheck = true;\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t],\n\t\t\tafter: [\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn !!(context.path?.startsWith(\"/sign-in/social\") || context.path?.startsWith(\"/sign-in/oauth2\"));\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tif (checkSkipProxy(ctx, opts)) return;\n\t\t\t\t\t\tif (ctx.context.oauthConfig.storeStateStrategy !== \"cookie\") return;\n\t\t\t\t\t\tconst signInResponse = ctx.context.returned;\n\t\t\t\t\t\tif (!signInResponse || typeof signInResponse !== \"object\" || !(\"url\" in signInResponse)) return;\n\t\t\t\t\t\tconst { url: providerURL } = signInResponse;\n\t\t\t\t\t\tif (typeof providerURL !== \"string\") return;\n\t\t\t\t\t\tconst oauthURL = new URL(providerURL);\n\t\t\t\t\t\tconst originalState = oauthURL.searchParams.get(\"state\");\n\t\t\t\t\t\tif (!originalState) return;\n\t\t\t\t\t\tconst setCookieHeader = ctx.context.responseHeaders?.get(\"set-cookie\");\n\t\t\t\t\t\tif (!setCookieHeader) return;\n\t\t\t\t\t\tconst stateCookie = ctx.context.createAuthCookie(\"oauth_state\");\n\t\t\t\t\t\tconst stateCookieAttrs = parseSetCookieHeader(setCookieHeader).get(stateCookie.name);\n\t\t\t\t\t\tif (!stateCookieAttrs?.value) return;\n\t\t\t\t\t\tconst stateCookieValue = stateCookieAttrs.value;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst statePackage = {\n\t\t\t\t\t\t\t\tstate: originalState,\n\t\t\t\t\t\t\t\tstateCookie: stateCookieValue,\n\t\t\t\t\t\t\t\tisOAuthProxy: true\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tconst encryptedPackage = await symmetricEncrypt({\n\t\t\t\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\t\t\t\tdata: JSON.stringify(statePackage)\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\toauthURL.searchParams.set(\"state\", encryptedPackage);\n\t\t\t\t\t\t\tctx.context.returned = {\n\t\t\t\t\t\t\t\t...signInResponse,\n\t\t\t\t\t\t\t\turl: oauthURL.toString()\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tctx.context.logger.error(\"Failed to encrypt OAuth proxy state package:\", e);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn !!(context.path?.startsWith(\"/callback\") || context.path?.startsWith(\"/oauth2/callback\"));\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst headers = ctx.context.responseHeaders;\n\t\t\t\t\t\tconst location = headers?.get(\"location\");\n\t\t\t\t\t\tif (!location?.includes(\"/oauth-proxy-callback?callbackURL\") || !location.startsWith(\"http\")) return;\n\t\t\t\t\t\tconst productionOrigin = getOrigin(opts?.productionURL || ctx.context.options.baseURL || ctx.context.baseURL);\n\t\t\t\t\t\tconst locationURL = new URL(location);\n\t\t\t\t\t\tif (locationURL.origin === productionOrigin) {\n\t\t\t\t\t\t\tconst newLocation = locationURL.searchParams.get(\"callbackURL\");\n\t\t\t\t\t\t\tif (!newLocation) return;\n\t\t\t\t\t\t\tctx.setHeader(\"location\", newLocation);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst setCookies = headers?.get(\"set-cookie\");\n\t\t\t\t\t\tif (!setCookies) return;\n\t\t\t\t\t\tconst encryptedCookies = await symmetricEncrypt({\n\t\t\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\t\t\tdata: setCookies\n\t\t\t\t\t\t});\n\t\t\t\t\t\tconst locationWithCookies = `${location}&cookies=${encodeURIComponent(encryptedCookies)}`;\n\t\t\t\t\t\tctx.setHeader(\"location\", locationWithCookies);\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn !!(context.path?.startsWith(\"/callback\") || context.path?.startsWith(\"/oauth2/callback\"));\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst contextWithSnapshot = ctx.context;\n\t\t\t\t\t\tconst snapshot = contextWithSnapshot._oauthProxySnapshot;\n\t\t\t\t\t\tif (snapshot) {\n\t\t\t\t\t\t\tctx.context.oauthConfig.storeStateStrategy = snapshot.storeStateStrategy;\n\t\t\t\t\t\t\tctx.context.oauthConfig.skipStateCookieCheck = snapshot.skipStateCookieCheck;\n\t\t\t\t\t\t\tctx.context.internalAdapter = snapshot.internalAdapter;\n\t\t\t\t\t\t\tcontextWithSnapshot._oauthProxySnapshot = void 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t};\n};\n\n//#endregion\nexport { oAuthProxy as t };"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;;;;;;;;;AAEA,0CAA0C;AAC1C;;AAEA,GACA,SAAS;IACR,MAAM,SAAS,yMAAG,CAAC,UAAU,GAAG,CAAC,QAAQ,EAAE,yMAAG,CAAC,UAAU,EAAE,GAAG,KAAK;IACnE,MAAM,UAAU,yMAAG,CAAC,WAAW;IAC/B,MAAM,SAAS,yMAAG,CAAC,UAAU;IAC7B,MAAM,MAAM,yMAAG,CAAC,wBAAwB;IACxC,MAAM,SAAS,yMAAG,CAAC,0BAA0B;IAC7C,MAAM,QAAQ,yMAAG,CAAC,mBAAmB;IACrC,OAAO,UAAU,WAAW,UAAU,OAAO,UAAU;AACxD;AACA;;AAEA,GACA,SAAS,kBAAkB,GAAG,EAAE,IAAI;IACnC,OAAO,IAAI,IAAI,MAAM,cAAc,IAAI,OAAO,EAAE,OAAO,sBAAsB,IAAI,OAAO,CAAC,OAAO;AACjG;AACA;;AAEA,GACA,SAAS,eAAe,GAAG,EAAE,IAAI;IAChC,IAAI,IAAI,OAAO,EAAE,QAAQ,IAAI,uBAAuB,OAAO;IAC3D,MAAM,gBAAgB,MAAM,iBAAiB,yMAAG,CAAC,eAAe;IAChE,IAAI,CAAC,eAAe,OAAO;IAC3B,MAAM,aAAa,IAAI,OAAO,EAAE,OAAO;IACvC,IAAI,CAAC,YAAY,OAAO;IACxB,OAAO,IAAA,kKAAS,EAAC,mBAAmB,IAAA,kKAAS,EAAC;AAC/C;AAEA,YAAY;AACZ,0CAA0C;AAC1C,MAAM,aAAa,CAAC;IACnB,OAAO;QACN,IAAI;QACJ,SAAS;QACT,WAAW;YAAE,YAAY,IAAA,yLAAkB,EAAC,yBAAyB;gBACpE,QAAQ;gBACR,aAAa;gBACb,OAAO,2JAAQ,CAAC;oBACf,aAAa,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAAyC;oBACrF,SAAS,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAAqC;gBAC9E;gBACA,KAAK;oBAAC,IAAA,iLAAW,EAAC,CAAC,MAAQ,IAAI,KAAK,CAAC,WAAW;iBAAE;gBAClD,UAAU;oBAAE,SAAS;wBACpB,aAAa;wBACb,aAAa;wBACb,YAAY;4BAAC;gCACZ,IAAI;gCACJ,MAAM;gCACN,UAAU;gCACV,aAAa;4BACd;4BAAG;gCACF,IAAI;gCACJ,MAAM;gCACN,UAAU;gCACV,aAAa;4BACd;yBAAE;wBACF,WAAW;4BAAE,KAAK;gCACjB,aAAa;gCACb,SAAS;oCAAE,UAAU;wCACpB,aAAa;wCACb,QAAQ;4CAAE,MAAM;wCAAS;oCAC1B;gCAAE;4BACH;wBAAE;oBACH;gBAAE;YACH,GAAG,OAAO;gBACT,MAAM,mBAAmB,MAAM,IAAA,oKAAgB,EAAC;oBAC/C,KAAK,IAAI,OAAO,CAAC,MAAM;oBACvB,MAAM,IAAI,KAAK,CAAC,OAAO;gBACxB,GAAG,KAAK,CAAC,CAAC;oBACT,IAAI,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,0CAA0C;oBACnE,OAAO;gBACR;gBACA,IAAI,CAAC,kBAAkB;oBACtB,MAAM,WAAW,IAAI,OAAO,CAAC,OAAO,CAAC,UAAU,EAAE,YAAY,GAAG,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,eAAe,CAAC;oBAC5G,MAAM,IAAI,QAAQ,CAAC,GAAG,SAAS,6CAA6C,CAAC;gBAC9E;gBACA,MAAM,kBAAkB,kBAAkB,KAAK,MAAM,QAAQ,KAAK;gBAClE,MAAM,gBAAgB,IAAA,qKAAoB,EAAC;gBAC3C,MAAM,mBAAmB,MAAM,IAAI,CAAC,cAAc,OAAO,IAAI,GAAG,CAAC,CAAC,CAAC,MAAM,MAAM;oBAC9E,MAAM,UAAU,CAAC;oBACjB,IAAI,MAAM,IAAI,EAAE,QAAQ,IAAI,GAAG,MAAM,IAAI;oBACzC,IAAI,MAAM,OAAO,EAAE,QAAQ,OAAO,GAAG,MAAM,OAAO;oBAClD,IAAI,MAAM,QAAQ,EAAE,QAAQ,QAAQ,GAAG,MAAM,QAAQ;oBACrD,IAAI,MAAM,QAAQ,EAAE,QAAQ,QAAQ,GAAG;oBACvC,IAAI,KAAK,CAAC,UAAU,KAAK,KAAK,GAAG,QAAQ,MAAM,GAAG,KAAK,CAAC,UAAU;oBAClE,IAAI,iBAAiB,QAAQ,MAAM,GAAG;oBACtC,OAAO;wBACN;wBACA;wBACA,OAAO,mBAAmB,MAAM,KAAK;oBACtC;gBACD;gBACA,KAAK,MAAM,UAAU,iBAAkB,IAAI,SAAS,CAAC,OAAO,IAAI,EAAE,OAAO,KAAK,EAAE,OAAO,OAAO;gBAC9F,MAAM,IAAI,QAAQ,CAAC,IAAI,KAAK,CAAC,WAAW;YACzC;QAAG;QACH,OAAO;YACN,QAAQ;gBACP;oBACC,SAAQ,OAAO;wBACd,OAAO,CAAC,CAAC,CAAC,QAAQ,IAAI,EAAE,WAAW,sBAAsB,QAAQ,IAAI,EAAE,WAAW,kBAAkB;oBACrG;oBACA,SAAS,IAAA,2LAAoB,EAAC,OAAO;wBACpC,IAAI,eAAe,KAAK,OAAO;wBAC/B,MAAM,aAAa,kBAAkB,KAAK;wBAC1C,MAAM,sBAAsB,IAAI,IAAI,EAAE,eAAe,IAAI,OAAO,CAAC,OAAO;wBACxE,MAAM,iBAAiB,GAAG,WAAW,MAAM,GAAG,IAAI,OAAO,CAAC,OAAO,CAAC,QAAQ,IAAI,YAAY,kCAAkC,EAAE,mBAAmB,sBAAsB;wBACvK,IAAI,CAAC,IAAI,IAAI,EAAE;wBACf,IAAI,IAAI,CAAC,WAAW,GAAG;oBACxB;gBACD;gBACA;oBACC,SAAQ,OAAO;wBACd,OAAO,CAAC,CAAC,CAAC,QAAQ,IAAI,EAAE,WAAW,gBAAgB,QAAQ,IAAI,EAAE,WAAW,mBAAmB;oBAChG;oBACA,SAAS,IAAA,2LAAoB,EAAC,OAAO;wBACpC,MAAM,QAAQ,IAAI,KAAK,EAAE,SAAS,IAAI,IAAI,EAAE;wBAC5C,IAAI,CAAC,SAAS,OAAO,UAAU,UAAU;wBACzC,IAAI;wBACJ,IAAI;4BACH,eAAe,IAAA,oKAAS,EAAC,MAAM,IAAA,oKAAgB,EAAC;gCAC/C,KAAK,IAAI,OAAO,CAAC,MAAM;gCACvB,MAAM;4BACP;wBACD,EAAE,OAAO,GAAG;4BACX;wBACD;wBACA,IAAI,CAAC,aAAa,YAAY,IAAI,CAAC,aAAa,KAAK,IAAI,CAAC,aAAa,WAAW,EAAE;wBACpF,IAAI;wBACJ,IAAI;4BACH,mBAAmB,MAAM,IAAA,oKAAgB,EAAC;gCACzC,KAAK,IAAI,OAAO,CAAC,MAAM;gCACvB,MAAM,aAAa,WAAW;4BAC/B;4BACA,IAAA,oKAAS,EAAC;wBACX,EAAE,OAAO,GAAG;4BACX,IAAI,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,+CAA+C;4BACxE;wBACD;wBACA,IAAI,OAAO,CAAC,mBAAmB,GAAG;4BACjC,oBAAoB,IAAI,OAAO,CAAC,WAAW,CAAC,kBAAkB;4BAC9D,sBAAsB,IAAI,OAAO,CAAC,WAAW,CAAC,oBAAoB;4BAClE,iBAAiB,IAAI,OAAO,CAAC,eAAe;wBAC7C;wBACA,MAAM,kBAAkB,IAAI,OAAO,CAAC,eAAe;wBACnD,MAAM,uBAAuB;wBAC7B,IAAI,OAAO,CAAC,WAAW,CAAC,kBAAkB,GAAG;wBAC7C,IAAI,OAAO,CAAC,eAAe,GAAG;4BAC7B,GAAG,IAAI,OAAO,CAAC,eAAe;4BAC9B,uBAAuB,OAAO;gCAC7B,IAAI,eAAe,qBAAqB,KAAK,EAAE,OAAO;oCACrD,IAAI,CAAC,YAAY,EAAE,qBAAqB,KAAK,EAAE;oCAC/C,YAAY,qBAAqB,KAAK;oCACtC,OAAO;oCACP,WAAW,aAAa,GAAG,IAAI;oCAC/B,WAAW,aAAa,GAAG,IAAI;oCAC/B,WAAW,IAAI,KAAK,KAAK,GAAG,KAAK,MAAM;gCACxC;gCACA,OAAO,gBAAgB,qBAAqB,CAAC;4BAC9C;wBACD;wBACA,IAAI,IAAI,KAAK,EAAE,OAAO,IAAI,KAAK,CAAC,KAAK,GAAG,aAAa,KAAK;wBAC1D,IAAI,IAAI,IAAI,EAAE,OAAO,IAAI,IAAI,CAAC,KAAK,GAAG,aAAa,KAAK;wBACxD,IAAI,OAAO,CAAC,WAAW,CAAC,oBAAoB,GAAG;oBAChD;gBACD;gBACA;oBACC;wBACC,OAAO;oBACR;oBACA,SAAS,IAAA,2LAAoB,EAAC,OAAO;wBACpC,IAAI,IAAI,IAAI,KAAK,iBAAiB;wBAClC,IAAI,IAAI,OAAO,CAAC,WAAW,CAAC,kBAAkB,KAAK,UAAU;wBAC7D,IAAI,IAAI,OAAO,CAAC,mBAAmB,EAAE;wBACrC,MAAM,QAAQ,IAAI,KAAK,EAAE,SAAS,IAAI,IAAI,EAAE;wBAC5C,IAAI,CAAC,OAAO;wBACZ,MAAM,OAAO,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,qBAAqB,CAAC;wBACrE,IAAI,CAAC,MAAM;wBACX,IAAI;wBACJ,IAAI;4BACH,cAAc,IAAA,oKAAS,EAAC,KAAK,KAAK;wBACnC,EAAE,OAAM;4BACP,cAAc,KAAK;wBACpB;wBACA,IAAI,CAAC,aAAa,aAAa,SAAS,0BAA0B;wBAClE,IAAI,OAAO,CAAC,mBAAmB,GAAG;4BACjC,oBAAoB,IAAI,OAAO,CAAC,WAAW,CAAC,kBAAkB;4BAC9D,sBAAsB,IAAI,OAAO,CAAC,WAAW,CAAC,oBAAoB;4BAClE,iBAAiB,IAAI,OAAO,CAAC,eAAe;wBAC7C;wBACA,IAAI,OAAO,CAAC,WAAW,CAAC,oBAAoB,GAAG;oBAChD;gBACD;aACA;YACD,OAAO;gBACN;oBACC,SAAQ,OAAO;wBACd,OAAO,CAAC,CAAC,CAAC,QAAQ,IAAI,EAAE,WAAW,sBAAsB,QAAQ,IAAI,EAAE,WAAW,kBAAkB;oBACrG;oBACA,SAAS,IAAA,2LAAoB,EAAC,OAAO;wBACpC,IAAI,eAAe,KAAK,OAAO;wBAC/B,IAAI,IAAI,OAAO,CAAC,WAAW,CAAC,kBAAkB,KAAK,UAAU;wBAC7D,MAAM,iBAAiB,IAAI,OAAO,CAAC,QAAQ;wBAC3C,IAAI,CAAC,kBAAkB,OAAO,mBAAmB,YAAY,CAAC,CAAC,SAAS,cAAc,GAAG;wBACzF,MAAM,EAAE,KAAK,WAAW,EAAE,GAAG;wBAC7B,IAAI,OAAO,gBAAgB,UAAU;wBACrC,MAAM,WAAW,IAAI,IAAI;wBACzB,MAAM,gBAAgB,SAAS,YAAY,CAAC,GAAG,CAAC;wBAChD,IAAI,CAAC,eAAe;wBACpB,MAAM,kBAAkB,IAAI,OAAO,CAAC,eAAe,EAAE,IAAI;wBACzD,IAAI,CAAC,iBAAiB;wBACtB,MAAM,cAAc,IAAI,OAAO,CAAC,gBAAgB,CAAC;wBACjD,MAAM,mBAAmB,IAAA,qKAAoB,EAAC,iBAAiB,GAAG,CAAC,YAAY,IAAI;wBACnF,IAAI,CAAC,kBAAkB,OAAO;wBAC9B,MAAM,mBAAmB,iBAAiB,KAAK;wBAC/C,IAAI;4BACH,MAAM,eAAe;gCACpB,OAAO;gCACP,aAAa;gCACb,cAAc;4BACf;4BACA,MAAM,mBAAmB,MAAM,IAAA,oKAAgB,EAAC;gCAC/C,KAAK,IAAI,OAAO,CAAC,MAAM;gCACvB,MAAM,KAAK,SAAS,CAAC;4BACtB;4BACA,SAAS,YAAY,CAAC,GAAG,CAAC,SAAS;4BACnC,IAAI,OAAO,CAAC,QAAQ,GAAG;gCACtB,GAAG,cAAc;gCACjB,KAAK,SAAS,QAAQ;4BACvB;wBACD,EAAE,OAAO,GAAG;4BACX,IAAI,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,gDAAgD;wBAC1E;oBACD;gBACD;gBACA;oBACC,SAAQ,OAAO;wBACd,OAAO,CAAC,CAAC,CAAC,QAAQ,IAAI,EAAE,WAAW,gBAAgB,QAAQ,IAAI,EAAE,WAAW,mBAAmB;oBAChG;oBACA,SAAS,IAAA,2LAAoB,EAAC,OAAO;wBACpC,MAAM,UAAU,IAAI,OAAO,CAAC,eAAe;wBAC3C,MAAM,WAAW,SAAS,IAAI;wBAC9B,IAAI,CAAC,UAAU,SAAS,wCAAwC,CAAC,SAAS,UAAU,CAAC,SAAS;wBAC9F,MAAM,mBAAmB,IAAA,kKAAS,EAAC,MAAM,iBAAiB,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO,IAAI,IAAI,OAAO,CAAC,OAAO;wBAC5G,MAAM,cAAc,IAAI,IAAI;wBAC5B,IAAI,YAAY,MAAM,KAAK,kBAAkB;4BAC5C,MAAM,cAAc,YAAY,YAAY,CAAC,GAAG,CAAC;4BACjD,IAAI,CAAC,aAAa;4BAClB,IAAI,SAAS,CAAC,YAAY;4BAC1B;wBACD;wBACA,MAAM,aAAa,SAAS,IAAI;wBAChC,IAAI,CAAC,YAAY;wBACjB,MAAM,mBAAmB,MAAM,IAAA,oKAAgB,EAAC;4BAC/C,KAAK,IAAI,OAAO,CAAC,MAAM;4BACvB,MAAM;wBACP;wBACA,MAAM,sBAAsB,GAAG,SAAS,SAAS,EAAE,mBAAmB,mBAAmB;wBACzF,IAAI,SAAS,CAAC,YAAY;oBAC3B;gBACD;gBACA;oBACC,SAAQ,OAAO;wBACd,OAAO,CAAC,CAAC,CAAC,QAAQ,IAAI,EAAE,WAAW,gBAAgB,QAAQ,IAAI,EAAE,WAAW,mBAAmB;oBAChG;oBACA,SAAS,IAAA,2LAAoB,EAAC,OAAO;wBACpC,MAAM,sBAAsB,IAAI,OAAO;wBACvC,MAAM,WAAW,oBAAoB,mBAAmB;wBACxD,IAAI,UAAU;4BACb,IAAI,OAAO,CAAC,WAAW,CAAC,kBAAkB,GAAG,SAAS,kBAAkB;4BACxE,IAAI,OAAO,CAAC,WAAW,CAAC,oBAAoB,GAAG,SAAS,oBAAoB;4BAC5E,IAAI,OAAO,CAAC,eAAe,GAAG,SAAS,eAAe;4BACtD,oBAAoB,mBAAmB,GAAG,KAAK;wBAChD;oBACD;gBACD;aACA;QACF;IACD;AACD","ignoreList":[0]}},
    {"offset": {"line": 13234, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/one-tap-Bz8Q39Od.mjs"],"sourcesContent":["import { t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport { c as setSessionCookie } from \"./cookies-D72PbWdz.mjs\";\nimport * as z from \"zod\";\nimport { createRemoteJWKSet, jwtVerify } from \"jose\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\n\n//#region src/utils/boolean.ts\nfunction toBoolean(value) {\n\treturn value === \"true\" || value === true;\n}\n\n//#endregion\n//#region src/plugins/one-tap/index.ts\nconst oneTap = (options) => ({\n\tid: \"one-tap\",\n\tendpoints: { oneTapCallback: createAuthEndpoint(\"/one-tap/callback\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({ idToken: z.string().meta({ description: \"Google ID token, which the client obtains from the One Tap API\" }) }),\n\t\tmetadata: { openapi: {\n\t\t\tsummary: \"One tap callback\",\n\t\t\tdescription: \"Use this endpoint to authenticate with Google One Tap\",\n\t\t\tresponses: {\n\t\t\t\t200: {\n\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tsession: { $ref: \"#/components/schemas/Session\" },\n\t\t\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" }\n\t\t\t\t\t\t}\n\t\t\t\t\t} } }\n\t\t\t\t},\n\t\t\t\t400: { description: \"Invalid token\" }\n\t\t\t}\n\t\t} }\n\t}, async (ctx) => {\n\t\tconst { idToken } = ctx.body;\n\t\tlet payload;\n\t\ttry {\n\t\t\tconst { payload: verifiedPayload } = await jwtVerify(idToken, createRemoteJWKSet(new URL(\"https://www.googleapis.com/oauth2/v3/certs\")), {\n\t\t\t\tissuer: [\"https://accounts.google.com\", \"accounts.google.com\"],\n\t\t\t\taudience: options?.clientId || ctx.context.options.socialProviders?.google?.clientId\n\t\t\t});\n\t\t\tpayload = verifiedPayload;\n\t\t} catch (error) {\n\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"invalid id token\" });\n\t\t}\n\t\tconst { email, email_verified, name, picture, sub } = payload;\n\t\tif (!email) return ctx.json({ error: \"Email not available in token\" });\n\t\tconst user = await ctx.context.internalAdapter.findUserByEmail(email);\n\t\tif (!user) {\n\t\t\tif (options?.disableSignup) throw new APIError(\"BAD_GATEWAY\", { message: \"User not found\" });\n\t\t\tconst newUser = await ctx.context.internalAdapter.createOAuthUser({\n\t\t\t\temail,\n\t\t\t\temailVerified: typeof email_verified === \"boolean\" ? email_verified : toBoolean(email_verified),\n\t\t\t\tname,\n\t\t\t\timage: picture\n\t\t\t}, {\n\t\t\t\tproviderId: \"google\",\n\t\t\t\taccountId: sub\n\t\t\t});\n\t\t\tif (!newUser) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: \"Could not create user\" });\n\t\t\tconst session$1 = await ctx.context.internalAdapter.createSession(newUser.user.id);\n\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\tuser: newUser.user,\n\t\t\t\tsession: session$1\n\t\t\t});\n\t\t\treturn ctx.json({\n\t\t\t\ttoken: session$1.token,\n\t\t\t\tuser: {\n\t\t\t\t\tid: newUser.user.id,\n\t\t\t\t\temail: newUser.user.email,\n\t\t\t\t\temailVerified: newUser.user.emailVerified,\n\t\t\t\t\tname: newUser.user.name,\n\t\t\t\t\timage: newUser.user.image,\n\t\t\t\t\tcreatedAt: newUser.user.createdAt,\n\t\t\t\t\tupdatedAt: newUser.user.updatedAt\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (!await ctx.context.internalAdapter.findAccount(sub)) {\n\t\t\tconst accountLinking = ctx.context.options.account?.accountLinking;\n\t\t\tif (accountLinking?.enabled && (accountLinking.trustedProviders?.includes(\"google\") || email_verified)) await ctx.context.internalAdapter.linkAccount({\n\t\t\t\tuserId: user.user.id,\n\t\t\t\tproviderId: \"google\",\n\t\t\t\taccountId: sub,\n\t\t\t\tscope: \"openid,profile,email\",\n\t\t\t\tidToken\n\t\t\t});\n\t\t\telse throw new APIError(\"UNAUTHORIZED\", { message: \"Google sub doesn't match\" });\n\t\t}\n\t\tconst session = await ctx.context.internalAdapter.createSession(user.user.id);\n\t\tawait setSessionCookie(ctx, {\n\t\t\tuser: user.user,\n\t\t\tsession\n\t\t});\n\t\treturn ctx.json({\n\t\t\ttoken: session.token,\n\t\t\tuser: {\n\t\t\t\tid: user.user.id,\n\t\t\t\temail: user.user.email,\n\t\t\t\temailVerified: user.user.emailVerified,\n\t\t\t\tname: user.user.name,\n\t\t\t\timage: user.user.image,\n\t\t\t\tcreatedAt: user.user.createdAt,\n\t\t\t\tupdatedAt: user.user.updatedAt\n\t\t\t}\n\t\t});\n\t}) }\n});\n\n//#endregion\nexport { oneTap as t };"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;;;;;;AAEA,8BAA8B;AAC9B,SAAS,UAAU,KAAK;IACvB,OAAO,UAAU,UAAU,UAAU;AACtC;AAEA,YAAY;AACZ,sCAAsC;AACtC,MAAM,SAAS,CAAC,UAAY,CAAC;QAC5B,IAAI;QACJ,WAAW;YAAE,gBAAgB,IAAA,yLAAkB,EAAC,qBAAqB;gBACpE,QAAQ;gBACR,MAAM,2JAAQ,CAAC;oBAAE,SAAS,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAAiE;gBAAG;gBAC7H,UAAU;oBAAE,SAAS;wBACpB,SAAS;wBACT,aAAa;wBACb,WAAW;4BACV,KAAK;gCACJ,aAAa;gCACb,SAAS;oCAAE,oBAAoB;wCAAE,QAAQ;4CACxC,MAAM;4CACN,YAAY;gDACX,SAAS;oDAAE,MAAM;gDAA+B;gDAChD,MAAM;oDAAE,MAAM;gDAA4B;4CAC3C;wCACD;oCAAE;gCAAE;4BACL;4BACA,KAAK;gCAAE,aAAa;4BAAgB;wBACrC;oBACD;gBAAE;YACH,GAAG,OAAO;gBACT,MAAM,EAAE,OAAO,EAAE,GAAG,IAAI,IAAI;gBAC5B,IAAI;gBACJ,IAAI;oBACH,MAAM,EAAE,SAAS,eAAe,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,SAAS,IAAA,gLAAkB,EAAC,IAAI,IAAI,gDAAgD;wBACxI,QAAQ;4BAAC;4BAA+B;yBAAsB;wBAC9D,UAAU,SAAS,YAAY,IAAI,OAAO,CAAC,OAAO,CAAC,eAAe,EAAE,QAAQ;oBAC7E;oBACA,UAAU;gBACX,EAAE,OAAO,OAAO;oBACf,MAAM,IAAI,uLAAQ,CAAC,eAAe;wBAAE,SAAS;oBAAmB;gBACjE;gBACA,MAAM,EAAE,KAAK,EAAE,cAAc,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,EAAE,GAAG;gBACtD,IAAI,CAAC,OAAO,OAAO,IAAI,IAAI,CAAC;oBAAE,OAAO;gBAA+B;gBACpE,MAAM,OAAO,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,eAAe,CAAC;gBAC/D,IAAI,CAAC,MAAM;oBACV,IAAI,SAAS,eAAe,MAAM,IAAI,uLAAQ,CAAC,eAAe;wBAAE,SAAS;oBAAiB;oBAC1F,MAAM,UAAU,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,eAAe,CAAC;wBACjE;wBACA,eAAe,OAAO,mBAAmB,YAAY,iBAAiB,UAAU;wBAChF;wBACA,OAAO;oBACR,GAAG;wBACF,YAAY;wBACZ,WAAW;oBACZ;oBACA,IAAI,CAAC,SAAS,MAAM,IAAI,uLAAQ,CAAC,yBAAyB;wBAAE,SAAS;oBAAwB;oBAC7F,MAAM,YAAY,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,aAAa,CAAC,QAAQ,IAAI,CAAC,EAAE;oBACjF,MAAM,IAAA,qKAAgB,EAAC,KAAK;wBAC3B,MAAM,QAAQ,IAAI;wBAClB,SAAS;oBACV;oBACA,OAAO,IAAI,IAAI,CAAC;wBACf,OAAO,UAAU,KAAK;wBACtB,MAAM;4BACL,IAAI,QAAQ,IAAI,CAAC,EAAE;4BACnB,OAAO,QAAQ,IAAI,CAAC,KAAK;4BACzB,eAAe,QAAQ,IAAI,CAAC,aAAa;4BACzC,MAAM,QAAQ,IAAI,CAAC,IAAI;4BACvB,OAAO,QAAQ,IAAI,CAAC,KAAK;4BACzB,WAAW,QAAQ,IAAI,CAAC,SAAS;4BACjC,WAAW,QAAQ,IAAI,CAAC,SAAS;wBAClC;oBACD;gBACD;gBACA,IAAI,CAAC,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,WAAW,CAAC,MAAM;oBACxD,MAAM,iBAAiB,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO,EAAE;oBACpD,IAAI,gBAAgB,WAAW,CAAC,eAAe,gBAAgB,EAAE,SAAS,aAAa,cAAc,GAAG,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,WAAW,CAAC;wBACrJ,QAAQ,KAAK,IAAI,CAAC,EAAE;wBACpB,YAAY;wBACZ,WAAW;wBACX,OAAO;wBACP;oBACD;yBACK,MAAM,IAAI,uLAAQ,CAAC,gBAAgB;wBAAE,SAAS;oBAA2B;gBAC/E;gBACA,MAAM,UAAU,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,aAAa,CAAC,KAAK,IAAI,CAAC,EAAE;gBAC5E,MAAM,IAAA,qKAAgB,EAAC,KAAK;oBAC3B,MAAM,KAAK,IAAI;oBACf;gBACD;gBACA,OAAO,IAAI,IAAI,CAAC;oBACf,OAAO,QAAQ,KAAK;oBACpB,MAAM;wBACL,IAAI,KAAK,IAAI,CAAC,EAAE;wBAChB,OAAO,KAAK,IAAI,CAAC,KAAK;wBACtB,eAAe,KAAK,IAAI,CAAC,aAAa;wBACtC,MAAM,KAAK,IAAI,CAAC,IAAI;wBACpB,OAAO,KAAK,IAAI,CAAC,KAAK;wBACtB,WAAW,KAAK,IAAI,CAAC,SAAS;wBAC9B,WAAW,KAAK,IAAI,CAAC,SAAS;oBAC/B;gBACD;YACD;QAAG;IACJ,CAAC","ignoreList":[0]}},
    {"offset": {"line": 13389, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/one-time-token-C8YQxf38.mjs"],"sourcesContent":["import { r as generateRandomString } from \"./crypto-CFUhAR9W.mjs\";\nimport { u as sessionMiddleware } from \"./session-AaRl3_x-.mjs\";\nimport * as z from \"zod\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { base64Url } from \"@better-auth/utils/base64\";\n\n//#region src/plugins/one-time-token/utils.ts\nconst defaultKeyHasher = async (token) => {\n\tconst hash = await createHash(\"SHA-256\").digest(new TextEncoder().encode(token));\n\treturn base64Url.encode(new Uint8Array(hash), { padding: false });\n};\n\n//#endregion\n//#region src/plugins/one-time-token/index.ts\nconst oneTimeToken = (options) => {\n\tconst opts = {\n\t\tstoreToken: \"plain\",\n\t\t...options\n\t};\n\tasync function storeToken(ctx, token) {\n\t\tif (opts.storeToken === \"hashed\") return await defaultKeyHasher(token);\n\t\tif (typeof opts.storeToken === \"object\" && \"type\" in opts.storeToken && opts.storeToken.type === \"custom-hasher\") return await opts.storeToken.hash(token);\n\t\treturn token;\n\t}\n\treturn {\n\t\tid: \"one-time-token\",\n\t\tendpoints: {\n\t\t\tgenerateOneTimeToken: createAuthEndpoint(\"/one-time-token/generate\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tuse: [sessionMiddleware]\n\t\t\t}, async (c) => {\n\t\t\t\tif (opts?.disableClientRequest && c.request) throw c.error(\"BAD_REQUEST\", { message: \"Client requests are disabled\" });\n\t\t\t\tconst session = c.context.session;\n\t\t\t\tconst token = opts?.generateToken ? await opts.generateToken(session, c) : generateRandomString(32);\n\t\t\t\tconst expiresAt = new Date(Date.now() + (opts?.expiresIn ?? 3) * 60 * 1e3);\n\t\t\t\tconst storedToken = await storeToken(c, token);\n\t\t\t\tawait c.context.internalAdapter.createVerificationValue({\n\t\t\t\t\tvalue: session.session.token,\n\t\t\t\t\tidentifier: `one-time-token:${storedToken}`,\n\t\t\t\t\texpiresAt\n\t\t\t\t});\n\t\t\t\treturn c.json({ token });\n\t\t\t}),\n\t\t\tverifyOneTimeToken: createAuthEndpoint(\"/one-time-token/verify\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ token: z.string().meta({ description: \"The token to verify. Eg: \\\"some-token\\\"\" }) })\n\t\t\t}, async (c) => {\n\t\t\t\tconst { token } = c.body;\n\t\t\t\tconst storedToken = await storeToken(c, token);\n\t\t\t\tconst verificationValue = await c.context.internalAdapter.findVerificationValue(`one-time-token:${storedToken}`);\n\t\t\t\tif (!verificationValue) throw c.error(\"BAD_REQUEST\", { message: \"Invalid token\" });\n\t\t\t\tawait c.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\tif (verificationValue.expiresAt < /* @__PURE__ */ new Date()) throw c.error(\"BAD_REQUEST\", { message: \"Token expired\" });\n\t\t\t\tconst session = await c.context.internalAdapter.findSession(verificationValue.value);\n\t\t\t\tif (!session) throw c.error(\"BAD_REQUEST\", { message: \"Session not found\" });\n\t\t\t\treturn c.json(session);\n\t\t\t})\n\t\t}\n\t};\n};\n\n//#endregion\nexport { oneTimeToken as t };"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAEA,6CAA6C;AAC7C,MAAM,mBAAmB,OAAO;IAC/B,MAAM,OAAO,MAAM,IAAA,0KAAU,EAAC,WAAW,MAAM,CAAC,IAAI,cAAc,MAAM,CAAC;IACzE,OAAO,2KAAS,CAAC,MAAM,CAAC,IAAI,WAAW,OAAO;QAAE,SAAS;IAAM;AAChE;AAEA,YAAY;AACZ,6CAA6C;AAC7C,MAAM,eAAe,CAAC;IACrB,MAAM,OAAO;QACZ,YAAY;QACZ,GAAG,OAAO;IACX;IACA,eAAe,WAAW,GAAG,EAAE,KAAK;QACnC,IAAI,KAAK,UAAU,KAAK,UAAU,OAAO,MAAM,iBAAiB;QAChE,IAAI,OAAO,KAAK,UAAU,KAAK,YAAY,UAAU,KAAK,UAAU,IAAI,KAAK,UAAU,CAAC,IAAI,KAAK,iBAAiB,OAAO,MAAM,KAAK,UAAU,CAAC,IAAI,CAAC;QACpJ,OAAO;IACR;IACA,OAAO;QACN,IAAI;QACJ,WAAW;YACV,sBAAsB,IAAA,yLAAkB,EAAC,4BAA4B;gBACpE,QAAQ;gBACR,KAAK;oBAAC,sKAAiB;iBAAC;YACzB,GAAG,OAAO;gBACT,IAAI,MAAM,wBAAwB,EAAE,OAAO,EAAE,MAAM,EAAE,KAAK,CAAC,eAAe;oBAAE,SAAS;gBAA+B;gBACpH,MAAM,UAAU,EAAE,OAAO,CAAC,OAAO;gBACjC,MAAM,QAAQ,MAAM,gBAAgB,MAAM,KAAK,aAAa,CAAC,SAAS,KAAK,IAAA,oKAAoB,EAAC;gBAChG,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK,CAAC,MAAM,aAAa,CAAC,IAAI,KAAK;gBACtE,MAAM,cAAc,MAAM,WAAW,GAAG;gBACxC,MAAM,EAAE,OAAO,CAAC,eAAe,CAAC,uBAAuB,CAAC;oBACvD,OAAO,QAAQ,OAAO,CAAC,KAAK;oBAC5B,YAAY,CAAC,eAAe,EAAE,aAAa;oBAC3C;gBACD;gBACA,OAAO,EAAE,IAAI,CAAC;oBAAE;gBAAM;YACvB;YACA,oBAAoB,IAAA,yLAAkB,EAAC,0BAA0B;gBAChE,QAAQ;gBACR,MAAM,2JAAQ,CAAC;oBAAE,OAAO,2JAAQ,GAAG,IAAI,CAAC;wBAAE,aAAa;oBAA0C;gBAAG;YACrG,GAAG,OAAO;gBACT,MAAM,EAAE,KAAK,EAAE,GAAG,EAAE,IAAI;gBACxB,MAAM,cAAc,MAAM,WAAW,GAAG;gBACxC,MAAM,oBAAoB,MAAM,EAAE,OAAO,CAAC,eAAe,CAAC,qBAAqB,CAAC,CAAC,eAAe,EAAE,aAAa;gBAC/G,IAAI,CAAC,mBAAmB,MAAM,EAAE,KAAK,CAAC,eAAe;oBAAE,SAAS;gBAAgB;gBAChF,MAAM,EAAE,OAAO,CAAC,eAAe,CAAC,uBAAuB,CAAC,kBAAkB,EAAE;gBAC5E,IAAI,kBAAkB,SAAS,GAAG,aAAa,GAAG,IAAI,QAAQ,MAAM,EAAE,KAAK,CAAC,eAAe;oBAAE,SAAS;gBAAgB;gBACtH,MAAM,UAAU,MAAM,EAAE,OAAO,CAAC,eAAe,CAAC,WAAW,CAAC,kBAAkB,KAAK;gBACnF,IAAI,CAAC,SAAS,MAAM,EAAE,KAAK,CAAC,eAAe;oBAAE,SAAS;gBAAoB;gBAC1E,OAAO,EAAE,IAAI,CAAC;YACf;QACD;IACD;AACD","ignoreList":[0]}},
    {"offset": {"line": 13481, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/open-api-DZG02vyi.mjs"],"sourcesContent":["import { a as getAuthTables } from \"./get-model-name-D4DUV7S2.mjs\";\nimport { a as getEndpoints, t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\n\n//#region src/plugins/open-api/generator.ts\nconst allowedType = new Set([\n\t\"string\",\n\t\"number\",\n\t\"boolean\",\n\t\"array\",\n\t\"object\"\n]);\nfunction getTypeFromZodType(zodType) {\n\tconst type = zodType.type;\n\treturn allowedType.has(type) ? type : \"string\";\n}\nfunction getFieldSchema(field) {\n\tconst schema = {\n\t\ttype: field.type === \"date\" ? \"string\" : field.type,\n\t\t...field.type === \"date\" && { format: \"date-time\" }\n\t};\n\tif (field.defaultValue !== void 0) schema.default = typeof field.defaultValue === \"function\" ? \"Generated at runtime\" : field.defaultValue;\n\tif (field.input === false) schema.readOnly = true;\n\treturn schema;\n}\nfunction getParameters(options) {\n\tconst parameters = [];\n\tif (options.metadata?.openapi?.parameters) {\n\t\tparameters.push(...options.metadata.openapi.parameters);\n\t\treturn parameters;\n\t}\n\tif (options.query instanceof z.ZodObject) Object.entries(options.query.shape).forEach(([key, value]) => {\n\t\tif (value instanceof z.ZodType) parameters.push({\n\t\t\tname: key,\n\t\t\tin: \"query\",\n\t\t\tschema: {\n\t\t\t\t...processZodType(value),\n\t\t\t\t...\"minLength\" in value && value.minLength ? { minLength: value.minLength } : {}\n\t\t\t}\n\t\t});\n\t});\n\treturn parameters;\n}\nfunction getRequestBody(options) {\n\tif (options.metadata?.openapi?.requestBody) return options.metadata.openapi.requestBody;\n\tif (!options.body) return void 0;\n\tif (options.body instanceof z.ZodObject || options.body instanceof z.ZodOptional) {\n\t\tconst shape = options.body.shape;\n\t\tif (!shape) return void 0;\n\t\tconst properties = {};\n\t\tconst required = [];\n\t\tObject.entries(shape).forEach(([key, value]) => {\n\t\t\tif (value instanceof z.ZodType) {\n\t\t\t\tproperties[key] = processZodType(value);\n\t\t\t\tif (!(value instanceof z.ZodOptional)) required.push(key);\n\t\t\t}\n\t\t});\n\t\treturn {\n\t\t\trequired: options.body instanceof z.ZodOptional ? false : options.body ? true : false,\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties,\n\t\t\t\trequired\n\t\t\t} } }\n\t\t};\n\t}\n}\nfunction processZodType(zodType) {\n\tif (zodType instanceof z.ZodOptional) {\n\t\tconst innerType = zodType._def.innerType;\n\t\treturn {\n\t\t\t...processZodType(innerType),\n\t\t\tnullable: true\n\t\t};\n\t}\n\tif (zodType instanceof z.ZodObject) {\n\t\tconst shape = zodType.shape;\n\t\tif (shape) {\n\t\t\tconst properties = {};\n\t\t\tconst required = [];\n\t\t\tObject.entries(shape).forEach(([key, value]) => {\n\t\t\t\tif (value instanceof z.ZodType) {\n\t\t\t\t\tproperties[key] = processZodType(value);\n\t\t\t\t\tif (!(value instanceof z.ZodOptional)) required.push(key);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties,\n\t\t\t\t...required.length > 0 ? { required } : {},\n\t\t\t\tdescription: zodType.description\n\t\t\t};\n\t\t}\n\t}\n\treturn {\n\t\ttype: getTypeFromZodType(zodType),\n\t\tdescription: zodType.description\n\t};\n}\nfunction getResponse(responses) {\n\treturn {\n\t\t\"400\": {\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { message: { type: \"string\" } },\n\t\t\t\trequired: [\"message\"]\n\t\t\t} } },\n\t\t\tdescription: \"Bad Request. Usually due to missing parameters, or invalid parameters.\"\n\t\t},\n\t\t\"401\": {\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { message: { type: \"string\" } },\n\t\t\t\trequired: [\"message\"]\n\t\t\t} } },\n\t\t\tdescription: \"Unauthorized. Due to missing or invalid authentication.\"\n\t\t},\n\t\t\"403\": {\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { message: { type: \"string\" } }\n\t\t\t} } },\n\t\t\tdescription: \"Forbidden. You do not have permission to access this resource or to perform this action.\"\n\t\t},\n\t\t\"404\": {\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { message: { type: \"string\" } }\n\t\t\t} } },\n\t\t\tdescription: \"Not Found. The requested resource was not found.\"\n\t\t},\n\t\t\"429\": {\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { message: { type: \"string\" } }\n\t\t\t} } },\n\t\t\tdescription: \"Too Many Requests. You have exceeded the rate limit. Try again later.\"\n\t\t},\n\t\t\"500\": {\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { message: { type: \"string\" } }\n\t\t\t} } },\n\t\t\tdescription: \"Internal Server Error. This is a problem with the server that you cannot fix.\"\n\t\t},\n\t\t...responses\n\t};\n}\nfunction toOpenApiPath(path) {\n\treturn path.split(\"/\").map((part) => part.startsWith(\":\") ? `{${part.slice(1)}}` : part).join(\"/\");\n}\nasync function generator(ctx, options) {\n\tconst baseEndpoints = getEndpoints(ctx, {\n\t\t...options,\n\t\tplugins: []\n\t});\n\tconst tables = getAuthTables({\n\t\t...options,\n\t\tsession: {\n\t\t\t...options.session,\n\t\t\tstoreSessionInDatabase: true\n\t\t}\n\t});\n\tconst components = { schemas: { ...Object.entries(tables).reduce((acc, [key, value]) => {\n\t\tconst modelName = key.charAt(0).toUpperCase() + key.slice(1);\n\t\tconst fields = value.fields;\n\t\tconst required = [];\n\t\tconst properties = { id: { type: \"string\" } };\n\t\tObject.entries(fields).forEach(([fieldKey, fieldValue]) => {\n\t\t\tif (!fieldValue) return;\n\t\t\tproperties[fieldKey] = getFieldSchema(fieldValue);\n\t\t\tif (fieldValue.required && fieldValue.input !== false) required.push(fieldKey);\n\t\t});\n\t\tObject.entries(properties).forEach(([key$1, prop]) => {\n\t\t\tconst field = value.fields[key$1];\n\t\t\tif (field && field.type === \"date\" && prop.type === \"string\") prop.format = \"date-time\";\n\t\t});\n\t\tacc[modelName] = {\n\t\t\ttype: \"object\",\n\t\t\tproperties,\n\t\t\trequired\n\t\t};\n\t\treturn acc;\n\t}, {}) } };\n\tconst paths = {};\n\tObject.entries(baseEndpoints.api).forEach(([_, value]) => {\n\t\tif (ctx.options.disabledPaths?.includes(value.path)) return;\n\t\tconst options$1 = value.options;\n\t\tif (options$1.metadata?.SERVER_ONLY) return;\n\t\tconst path = toOpenApiPath(value.path);\n\t\tif (options$1.method === \"GET\" || options$1.method === \"DELETE\") paths[path] = {\n\t\t\t...paths[path],\n\t\t\t[options$1.method.toLowerCase()]: {\n\t\t\t\ttags: [\"Default\", ...options$1.metadata?.openapi?.tags || []],\n\t\t\t\tdescription: options$1.metadata?.openapi?.description,\n\t\t\t\toperationId: options$1.metadata?.openapi?.operationId,\n\t\t\t\tsecurity: [{ bearerAuth: [] }],\n\t\t\t\tparameters: getParameters(options$1),\n\t\t\t\tresponses: getResponse(options$1.metadata?.openapi?.responses)\n\t\t\t}\n\t\t};\n\t\tif (options$1.method === \"POST\" || options$1.method === \"PATCH\" || options$1.method === \"PUT\") {\n\t\t\tconst body = getRequestBody(options$1);\n\t\t\tpaths[path] = {\n\t\t\t\t...paths[path],\n\t\t\t\t[options$1.method.toLowerCase()]: {\n\t\t\t\t\ttags: [\"Default\", ...options$1.metadata?.openapi?.tags || []],\n\t\t\t\t\tdescription: options$1.metadata?.openapi?.description,\n\t\t\t\t\toperationId: options$1.metadata?.openapi?.operationId,\n\t\t\t\t\tsecurity: [{ bearerAuth: [] }],\n\t\t\t\t\tparameters: getParameters(options$1),\n\t\t\t\t\t...body ? { requestBody: body } : { requestBody: { content: { \"application/json\": { schema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {}\n\t\t\t\t\t} } } } },\n\t\t\t\t\tresponses: getResponse(options$1.metadata?.openapi?.responses)\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t});\n\tfor (const plugin of options.plugins || []) {\n\t\tif (plugin.id === \"open-api\") continue;\n\t\tconst pluginEndpoints = getEndpoints(ctx, {\n\t\t\t...options,\n\t\t\tplugins: [plugin]\n\t\t});\n\t\tconst api = Object.keys(pluginEndpoints.api).map((key) => {\n\t\t\tif (baseEndpoints.api[key] === void 0) return pluginEndpoints.api[key];\n\t\t\treturn null;\n\t\t}).filter((x) => x !== null);\n\t\tObject.entries(api).forEach(([key, value]) => {\n\t\t\tif (ctx.options.disabledPaths?.includes(value.path)) return;\n\t\t\tconst options$1 = value.options;\n\t\t\tif (options$1.metadata?.SERVER_ONLY) return;\n\t\t\tconst path = toOpenApiPath(value.path);\n\t\t\tif (options$1.method === \"GET\" || options$1.method === \"DELETE\") paths[path] = {\n\t\t\t\t...paths[path],\n\t\t\t\t[options$1.method.toLowerCase()]: {\n\t\t\t\t\ttags: options$1.metadata?.openapi?.tags || [plugin.id.charAt(0).toUpperCase() + plugin.id.slice(1)],\n\t\t\t\t\tdescription: options$1.metadata?.openapi?.description,\n\t\t\t\t\toperationId: options$1.metadata?.openapi?.operationId,\n\t\t\t\t\tsecurity: [{ bearerAuth: [] }],\n\t\t\t\t\tparameters: getParameters(options$1),\n\t\t\t\t\tresponses: getResponse(options$1.metadata?.openapi?.responses)\n\t\t\t\t}\n\t\t\t};\n\t\t\tif (options$1.method === \"POST\" || options$1.method === \"PATCH\" || options$1.method === \"PUT\") paths[path] = {\n\t\t\t\t...paths[path],\n\t\t\t\t[options$1.method.toLowerCase()]: {\n\t\t\t\t\ttags: options$1.metadata?.openapi?.tags || [plugin.id.charAt(0).toUpperCase() + plugin.id.slice(1)],\n\t\t\t\t\tdescription: options$1.metadata?.openapi?.description,\n\t\t\t\t\toperationId: options$1.metadata?.openapi?.operationId,\n\t\t\t\t\tsecurity: [{ bearerAuth: [] }],\n\t\t\t\t\tparameters: getParameters(options$1),\n\t\t\t\t\trequestBody: getRequestBody(options$1),\n\t\t\t\t\tresponses: getResponse(options$1.metadata?.openapi?.responses)\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t}\n\treturn {\n\t\topenapi: \"3.1.1\",\n\t\tinfo: {\n\t\t\ttitle: \"Better Auth\",\n\t\t\tdescription: \"API Reference for your Better Auth Instance\",\n\t\t\tversion: \"1.1.0\"\n\t\t},\n\t\tcomponents: {\n\t\t\t...components,\n\t\t\tsecuritySchemes: {\n\t\t\t\tapiKeyCookie: {\n\t\t\t\t\ttype: \"apiKey\",\n\t\t\t\t\tin: \"cookie\",\n\t\t\t\t\tname: \"apiKeyCookie\",\n\t\t\t\t\tdescription: \"API Key authentication via cookie\"\n\t\t\t\t},\n\t\t\t\tbearerAuth: {\n\t\t\t\t\ttype: \"http\",\n\t\t\t\t\tscheme: \"bearer\",\n\t\t\t\t\tdescription: \"Bearer token authentication\"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tsecurity: [{\n\t\t\tapiKeyCookie: [],\n\t\t\tbearerAuth: []\n\t\t}],\n\t\tservers: [{ url: ctx.baseURL }],\n\t\ttags: [{\n\t\t\tname: \"Default\",\n\t\t\tdescription: \"Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin.\"\n\t\t}],\n\t\tpaths\n\t};\n}\n\n//#endregion\n//#region src/plugins/open-api/logo.ts\nconst logo = `<svg width=\"75\" height=\"75\" viewBox=\"0 0 75 75\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n<rect width=\"75\" height=\"75\" fill=\"url(#pattern0_21_12)\"/>\n<defs>\n<pattern id=\"pattern0_21_12\" patternContentUnits=\"objectBoundingBox\" width=\"1\" height=\"1\">\n<use xlink:href=\"#image0_21_12\" transform=\"scale(0.00094697)\"/>\n</pattern>\n<image id=\"image0_21_12\" width=\"1056\" height=\"1056\" xlink:href=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/4QBARXhpZgAATU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAEIKADAAQAAAABAAAEIAAAAAD/7QA4UGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAAA4QklNBCUAAAAAABDUHYzZjwCyBOmACZjs+EJ+/+ICKElDQ19QUk9GSUxFAAEBAAACGGFwcGwEAAAAbW50clJHQiBYWVogB+YAAQABAAAAAAAAYWNzcEFQUEwAAAAAQVBQTAAAAAAAAAAAAAAAAAAAAAAAAPbWAAEAAAAA0y1hcHBs7P2jjjiFR8NttL1PetoYLwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKZGVzYwAAAPwAAAAwY3BydAAAASwAAABQd3RwdAAAAXwAAAAUclhZWgAAAZAAAAAUZ1hZWgAAAaQAAAAUYlhZWgAAAbgAAAAUclRSQwAAAcwAAAAgY2hhZAAAAewAAAAsYlRSQwAAAcwAAAAgZ1RSQwAAAcwAAAAgbWx1YwAAAAAAAAABAAAADGVuVVMAAAAUAAAAHABEAGkAcwBwAGwAYQB5ACAAUAAzbWx1YwAAAAAAAAABAAAADGVuVVMAAAA0AAAAHABDAG8AcAB5AHIAaQBnAGgAdAAgAEEAcABwAGwAZQAgAEkAbgBjAC4ALAAgADIAMAAyADJYWVogAAAAAAAA9tUAAQAAAADTLFhZWiAAAAAAAACD3wAAPb////+7WFlaIAAAAAAAAEq/AACxNwAACrlYWVogAAAAAAAAKDgAABELAADIuXBhcmEAAAAAAAMAAAACZmYAAPKnAAANWQAAE9AAAApbc2YzMgAAAAAAAQxCAAAF3v//8yYAAAeTAAD9kP//+6L///2jAAAD3AAAwG7/wAARCAQgBCADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9sAQwACAgICAgIDAgIDBAMDAwQFBAQEBAUHBQUFBQUHCAcHBwcHBwgICAgICAgICgoKCgoKCwsLCwsNDQ0NDQ0NDQ0N/9sAQwECAgIDAwMGAwMGDQkHCQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0N/90ABABC/9oADAMBAAIRAxEAPwD9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//Q/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9L9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//T/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9b9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9H9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9T9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//V/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Ln/gq38a/in8Dvgp4T8R/CfxFdeG9SvvFMdlcXFoELyW5srqQxnzEcY3op4Gciv1Gr8Z/+C2X/JvXgj/sc4v/AE33lAH4z/8ADwv9tD/oq2tf9823/wAZo/4eF/tof9FW1r/vm2/+M18Z0UAfZn/Dwv8AbQ/6KtrX/fNt/wDGaP8Ah4X+2h/0VbWv++bb/wCM18Z0UAfZn/Dwv9tD/oq2tf8AfNt/8Zo/4eF/tof9FW1r/vm2/wDjNfGdFAH2Z/w8L/bQ/wCira1/3zbf/GaP+Hhf7aH/AEVbWv8Avm2/+M18Z0UAfZn/AA8L/bQ/6KtrX/fNt/8AGaP+Hhf7aH/RVta/75tv/jNfGdFAH2Z/w8L/AG0P+ira1/3zbf8Axmj/AIeF/tof9FW1r/vm2/8AjNfGdFAH63/sVftq/tTfEb9qb4deCfG3xF1TVtD1bVGgvbKdYBHPGIJW2ttiVsblB4I6V/UbX8Z//BPT/k9D4U/9hpv/AEmmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+M/wD4eF/tof8ARVta/wC+bb/4zR/w8L/bQ/6KtrX/AHzbf/Ga+M6KAPsz/h4X+2h/0VbWv++bb/4zR/w8L/bQ/wCira1/3zbf/Ga+M6KAPsz/AIeF/tof9FW1r/vm2/8AjNH/AA8L/bQ/6KtrX/fNt/8AGa+M6KAPsz/h4X+2h/0VbWv++bb/AOM0f8PC/wBtD/oq2tf9823/AMZr4zooA+zP+Hhf7aH/AEVbWv8Avm2/+M0f8PC/20P+ira1/wB823/xmvjOigD7M/4eF/tof9FW1r/vm2/+M0f8PC/20P8Aoq2tf9823/xmvjOigD7M/wCHhf7aH/RVta/75tv/AIzR/wAPC/20P+ira1/3zbf/ABmvjOigD7M/4eF/tof9FW1r/vm2/wDjNH/Dwv8AbQ/6KtrX/fNt/wDGa+M6KAPsz/h4X+2h/wBFW1r/AL5tv/jNH/Dwv9tD/oq2tf8AfNt/8Zr4zooA+zP+Hhf7aH/RVta/75tv/jNH/Dwv9tD/AKKtrX/fNt/8Zr4zooA+zP8Ah4X+2h/0VbWv++bb/wCM0f8ADwv9tD/oq2tf9823/wAZr4zooA+zP+Hhf7aH/RVta/75tv8A4zR/w8L/AG0P+ira1/3zbf8AxmvjOigD7M/4eF/tof8ARVta/wC+bb/4zR/w8L/bQ/6KtrX/AHzbf/Ga+M6KAP6tv+CUnxr+Kfxx+CnizxH8WPEV14k1Kx8UyWVvcXYQPHbiytZBGPLRBje7HkZya/Uavxn/AOCJv/JvXjf/ALHOX/032dfsxQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfxn/APBPT/k9D4U/9hpv/Saav7MKACiiigAooooAKKKKACiiigAooooAKKKKAP4A6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfwq/BT4r638Dvin4d+LHhy0tb7UvDd0bu3t70ObeRzG0eJBGyPjDnowOa/Ub/h9l+0L/ANCR4M/79ah/8m0Af0yUV/M3/wAPsv2hf+hI8Gf9+tQ/+TaP+H2X7Qv/AEJHgz/v1qH/AMm0Af0yUV/M3/w+y/aF/wChI8Gf9+tQ/wDk2j/h9l+0L/0JHgz/AL9ah/8AJtAH9MlFfzN/8Psv2hf+hI8Gf9+tQ/8Ak2j/AIfZftC/9CR4M/79ah/8m0Af0yUV/M3/AMPsv2hf+hI8Gf8AfrUP/k2j/h9l+0L/ANCR4M/79ah/8m0Af0yUV/M3/wAPsv2hf+hI8Gf9+tQ/+TaP+H2X7Qv/AEJHgz/v1qH/AMm0Af0yUV/M3/w+y/aF/wChI8Gf9+tQ/wDk2j/h9l+0L/0JHgz/AL9ah/8AJtAH4z0V/TJ/w5N/Z6/6Hfxn/wB/dP8A/kKj/hyb+z1/0O/jP/v7p/8A8hUAfzN0V/TJ/wAOTf2ev+h38Z/9/dP/APkKj/hyb+z1/wBDv4z/AO/un/8AyFQB/M3RX9Mn/Dk39nr/AKHfxn/390//AOQqP+HJv7PX/Q7+M/8Av7p//wAhUAfzN0V/TJ/w5N/Z6/6Hfxn/AN/dP/8AkKj/AIcm/s9f9Dv4z/7+6f8A/IVAH8zdFf0yf8OTf2ev+h38Z/8Af3T/AP5Co/4cm/s9f9Dv4z/7+6f/APIVAH8zdFf0yf8ADk39nr/od/Gf/f3T/wD5Co/4cm/s9f8AQ7+M/wDv7p//AMhUAfzN0V/TJ/w5N/Z6/wCh38Z/9/dP/wDkKvwV/ag+FGifA74++M/hP4cu7q+03w3fi0t7i9KG4kQxRyZkMaomcueigYoA8FooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/AOxzl/8ATfZ1+zFfjP8A8ETf+TevG/8A2Ocv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/v8ooooAKKKKACiiigAooooAKKKKACiiigAr+M//goX/wAnofFb/sNL/wCk0Nf2YV/Gf/wUL/5PQ+K3/YaX/wBJoaAPjOiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP7/KKKKACiiigAooooAKKKKACiiigAooooAK/jP/4KF/8AJ6HxW/7DS/8ApNDX9mFfxn/8FC/+T0Pit/2Gl/8ASaGgD4zooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+/yiiigAooooAKKKKACiiigAooooAKKKKACv4z/+Chf/ACeh8Vv+w0v/AKTQ1/ZhX8Z//BQv/k9D4rf9hpf/AEmhoA+M6KKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/v8ooooAKKKKACiiigAooooAKKKKACiiigAr+M//goX/wAnofFb/sNL/wCk0Nf2YV/Gf/wUL/5PQ+K3/YaX/wBJoaAPjOiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP7/KKKKACiiigAooooAKKKKACiiigAooooAK/jP/4KF/8AJ6HxW/7DS/8ApNDX9mFfxn/8FC/+T0Pit/2Gl/8ASaGgD4zooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+/yiiigAooooAKKKKACiiigAooooAKKKKACv4z/+Chf/ACeh8Vv+w0v/AKTQ1/ZhX8Z//BQv/k9D4rf9hpf/AEmhoA+M6KKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD1L4KfCjW/jj8U/Dvwn8OXdrY6l4kujaW9xelxbxuI2kzIY1d8YQ9FJzX6jf8OTf2hf8Aod/Bn/f3UP8A5Cr4z/4J6f8AJ6Hwp/7DTf8ApNNX9mFAH8zf/Dk39oX/AKHfwZ/391D/AOQqP+HJv7Qv/Q7+DP8Av7qH/wAhV/TJRQB/M3/w5N/aF/6HfwZ/391D/wCQqP8Ahyb+0L/0O/gz/v7qH/yFX9MlFAH8zf8Aw5N/aF/6HfwZ/wB/dQ/+QqP+HJv7Qv8A0O/gz/v7qH/yFX9MlFAH8zf/AA5N/aF/6HfwZ/391D/5Co/4cm/tC/8AQ7+DP+/uof8AyFX9MlFAH8zf/Dk39oX/AKHfwZ/391D/AOQqP+HJv7Qv/Q7+DP8Av7qH/wAhV/TJRQB/M3/w5N/aF/6HfwZ/391D/wCQqP8Ahyb+0L/0O/gz/v7qH/yFX9MlFAH4z/8AD7L9nr/oSPGf/frT/wD5No/4fZfs9f8AQkeM/wDv1p//AMm1/M3RQB/TJ/w+y/Z6/wChI8Z/9+tP/wDk2j/h9l+z1/0JHjP/AL9af/8AJtfzN0UAf0yf8Psv2ev+hI8Z/wDfrT//AJNo/wCH2X7PX/QkeM/+/Wn/APybX8zdFAH9Mn/D7L9nr/oSPGf/AH60/wD+TaP+H2X7PX/QkeM/+/Wn/wDybX8zdFAH9Mn/AA+y/Z6/6Ejxn/360/8A+TaP+H2X7PX/AEJHjP8A79af/wDJtfzN0UAf0yf8Psv2ev8AoSPGf/frT/8A5No/4fZfs9f9CR4z/wC/Wn//ACbX8zdFAH9Mn/D7L9nr/oSPGf8A360//wCTa/BX9qD4r6J8cfj74z+LHhy0urHTfEl+Lu3t70ILiNBFHHiQRs6Zyh6MRivBaKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/ACb143/7HOX/ANN9nX7MV+M//BE3/k3rxv8A9jnL/wCm+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfxn/APBPT/k9D4U/9hpv/Saav7MKACiiigAooooAKKKKACiiigAooooAKKKKAP4A6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+XP/BVv4KfFP44/BTwn4c+E/h268SalY+KY724t7QoHjtxZXUZkPmOgxvdRwc5NAH8pNFfZn/DvT9tD/olOtf99W3/AMeo/wCHen7aH/RKda/76tv/AI9QB8Z0V9mf8O9P20P+iU61/wB9W3/x6j/h3p+2h/0SnWv++rb/AOPUAfGdFfZn/DvT9tD/AKJTrX/fVt/8eo/4d6ftof8ARKda/wC+rb/49QB8Z0V9mf8ADvT9tD/olOtf99W3/wAeo/4d6ftof9Ep1r/vq2/+PUAfGdFfZn/DvT9tD/olOtf99W3/AMeo/wCHen7aH/RKda/76tv/AI9QB8Z0V9mf8O9P20P+iU61/wB9W3/x6j/h3p+2h/0SnWv++rb/AOPUAH/BPT/k9D4U/wDYab/0mmr+zCv5cv2Kv2Kv2pvhz+1N8OvG3jb4dappOh6TqjT3t7O0BjgjMEq7m2ys2NzAcA9a/qNoAKKKKACiiigAooooAKKKKACiiigAooooA/gDor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD9mP+CJv/JvXjf8A7HOX/wBN9nX7MV+XP/BKT4KfFP4HfBTxZ4c+LHh268N6lfeKZL23t7soXktzZWsYkHlu4xvRhyc5FfqNQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf/9L9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//T/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9b9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9H9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9T9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//V/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9f9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//Q/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/2Q==\"/>\n</defs>\n</svg>\n`;\n\n//#endregion\n//#region src/plugins/open-api/index.ts\nconst getHTML = (apiReference, theme, nonce) => {\n\tconst nonceAttr = nonce ? `nonce=\"${nonce}\"` : \"\";\n\treturn `<!doctype html>\n<html>\n  <head>\n    <title>Scalar API Reference</title>\n    <meta charset=\"utf-8\" />\n    <meta\n      name=\"viewport\"\n      content=\"width=device-width, initial-scale=1\" />\n  </head>\n  <body>\n    <script\n      id=\"api-reference\"\n      type=\"application/json\">\n    ${JSON.stringify(apiReference)}\n    <\\/script>\n\t <script ${nonceAttr}>\n      var configuration = {\n\t  \tfavicon: \"data:image/svg+xml;utf8,${encodeURIComponent(logo)}\",\n\t   \ttheme: \"${theme || \"default\"}\",\n        metaData: {\n\t\t\ttitle: \"Better Auth API\",\n\t\t\tdescription: \"API Reference for your Better Auth Instance\",\n\t\t}\n      }\n\n      document.getElementById('api-reference').dataset.configuration =\n        JSON.stringify(configuration)\n    <\\/script>\n\t  <script src=\"https://cdn.jsdelivr.net/npm/@scalar/api-reference\" ${nonceAttr}><\\/script>\n  </body>\n</html>`;\n};\nconst openAPI = (options) => {\n\tconst path = options?.path ?? \"/reference\";\n\treturn {\n\t\tid: \"open-api\",\n\t\tendpoints: {\n\t\t\tgenerateOpenAPISchema: createAuthEndpoint(\"/open-api/generate-schema\", { method: \"GET\" }, async (ctx) => {\n\t\t\t\tconst schema = await generator(ctx.context, ctx.context.options);\n\t\t\t\treturn ctx.json(schema);\n\t\t\t}),\n\t\t\topenAPIReference: createAuthEndpoint(path, {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tmetadata: { isAction: false }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (options?.disableDefaultReference) throw new APIError(\"NOT_FOUND\");\n\t\t\t\tconst schema = await generator(ctx.context, ctx.context.options);\n\t\t\t\treturn new Response(getHTML(schema, options?.theme, options?.nonce), { headers: { \"Content-Type\": \"text/html\" } });\n\t\t\t})\n\t\t}\n\t};\n};\n\n//#endregion\nexport { openAPI as t };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 13982, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/phone-number-wU9XYnr8.mjs"],"sourcesContent":["import { r as generateRandomString } from \"./crypto-CFUhAR9W.mjs\";\nimport { t as mergeSchema, u as getDate } from \"./schema-Bb7wzeK_.mjs\";\nimport { c as setSessionCookie } from \"./cookies-D72PbWdz.mjs\";\nimport { r as getSessionFromCtx } from \"./session-AaRl3_x-.mjs\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\n\n//#region src/plugins/phone-number/error-codes.ts\nconst PHONE_NUMBER_ERROR_CODES = defineErrorCodes({\n\tINVALID_PHONE_NUMBER: \"Invalid phone number\",\n\tPHONE_NUMBER_EXIST: \"Phone number already exists\",\n\tPHONE_NUMBER_NOT_EXIST: \"phone number isn't registered\",\n\tINVALID_PHONE_NUMBER_OR_PASSWORD: \"Invalid phone number or password\",\n\tUNEXPECTED_ERROR: \"Unexpected error\",\n\tOTP_NOT_FOUND: \"OTP not found\",\n\tOTP_EXPIRED: \"OTP expired\",\n\tINVALID_OTP: \"Invalid OTP\",\n\tPHONE_NUMBER_NOT_VERIFIED: \"Phone number not verified\",\n\tPHONE_NUMBER_CANNOT_BE_UPDATED: \"Phone number cannot be updated\",\n\tSEND_OTP_NOT_IMPLEMENTED: \"sendOTP not implemented\",\n\tTOO_MANY_ATTEMPTS: \"Too many attempts\"\n});\n\n//#endregion\n//#region src/plugins/phone-number/schema.ts\nconst schema = { user: { fields: {\n\tphoneNumber: {\n\t\ttype: \"string\",\n\t\trequired: false,\n\t\tunique: true,\n\t\tsortable: true,\n\t\treturned: true\n\t},\n\tphoneNumberVerified: {\n\t\ttype: \"boolean\",\n\t\trequired: false,\n\t\treturned: true,\n\t\tinput: false\n\t}\n} } };\n\n//#endregion\n//#region src/plugins/phone-number/index.ts\nfunction generateOTP(size) {\n\treturn generateRandomString(size, \"0-9\");\n}\nconst phoneNumber = (options) => {\n\tconst opts = {\n\t\texpiresIn: options?.expiresIn || 300,\n\t\totpLength: options?.otpLength || 6,\n\t\t...options,\n\t\tphoneNumber: \"phoneNumber\",\n\t\tphoneNumberVerified: \"phoneNumberVerified\",\n\t\tcode: \"code\",\n\t\tcreatedAt: \"createdAt\"\n\t};\n\treturn {\n\t\tid: \"phone-number\",\n\t\thooks: { before: [{\n\t\t\tmatcher: (ctx) => ctx.path === \"/update-user\" && \"phoneNumber\" in ctx.body,\n\t\t\thandler: createAuthMiddleware(async (_ctx) => {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.PHONE_NUMBER_CANNOT_BE_UPDATED });\n\t\t\t})\n\t\t}] },\n\t\tendpoints: {\n\t\t\tsignInPhoneNumber: createAuthEndpoint(\"/sign-in/phone-number\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tphoneNumber: z.string().meta({ description: \"Phone number to sign in. Eg: \\\"+1234567890\\\"\" }),\n\t\t\t\t\tpassword: z.string().meta({ description: \"Password to use for sign in.\" }),\n\t\t\t\t\trememberMe: z.boolean().meta({ description: \"Remember the session. Eg: true\" }).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Sign in with phone number\",\n\t\t\t\t\tdescription: \"Use this endpoint to sign in with phone number\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" },\n\t\t\t\t\t\t\t\t\tsession: { $ref: \"#/components/schemas/Session\" }\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t},\n\t\t\t\t\t\t400: { description: \"Invalid phone number or password\" }\n\t\t\t\t\t}\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { password, phoneNumber: phoneNumber$1 } = ctx.body;\n\t\t\t\tif (opts.phoneNumberValidator) {\n\t\t\t\t\tif (!await opts.phoneNumberValidator(ctx.body.phoneNumber)) throw new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER });\n\t\t\t\t}\n\t\t\t\tconst user = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"phoneNumber\",\n\t\t\t\t\t\tvalue: phoneNumber$1\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!user) throw new APIError(\"UNAUTHORIZED\", { message: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER_OR_PASSWORD });\n\t\t\t\tif (opts.requireVerification) {\n\t\t\t\t\tif (!user.phoneNumberVerified) {\n\t\t\t\t\t\tconst otp = generateOTP(opts.otpLength);\n\t\t\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\t\t\tvalue: otp,\n\t\t\t\t\t\t\tidentifier: phoneNumber$1,\n\t\t\t\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\")\n\t\t\t\t\t\t});\n\t\t\t\t\t\tawait opts.sendOTP?.({\n\t\t\t\t\t\t\tphoneNumber: phoneNumber$1,\n\t\t\t\t\t\t\tcode: otp\n\t\t\t\t\t\t}, ctx);\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: PHONE_NUMBER_ERROR_CODES.PHONE_NUMBER_NOT_VERIFIED });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst credentialAccount = (await ctx.context.internalAdapter.findAccountByUserId(user.id)).find((a) => a.providerId === \"credential\");\n\t\t\t\tif (!credentialAccount) {\n\t\t\t\t\tctx.context.logger.error(\"Credential account not found\", { phoneNumber: phoneNumber$1 });\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER_OR_PASSWORD });\n\t\t\t\t}\n\t\t\t\tconst currentPassword = credentialAccount?.password;\n\t\t\t\tif (!currentPassword) {\n\t\t\t\t\tctx.context.logger.error(\"Password not found\", { phoneNumber: phoneNumber$1 });\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: PHONE_NUMBER_ERROR_CODES.UNEXPECTED_ERROR });\n\t\t\t\t}\n\t\t\t\tif (!await ctx.context.password.verify({\n\t\t\t\t\thash: currentPassword,\n\t\t\t\t\tpassword\n\t\t\t\t})) {\n\t\t\t\t\tctx.context.logger.error(\"Invalid password\");\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER_OR_PASSWORD });\n\t\t\t\t}\n\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(user.id, ctx.body.rememberMe === false);\n\t\t\t\tif (!session) {\n\t\t\t\t\tctx.context.logger.error(\"Failed to create session\");\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION });\n\t\t\t\t}\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser\n\t\t\t\t}, ctx.body.rememberMe === false);\n\t\t\t\treturn ctx.json({\n\t\t\t\t\ttoken: session.token,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\temailVerified: user.emailVerified,\n\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\timage: user.image,\n\t\t\t\t\t\tphoneNumber: user.phoneNumber,\n\t\t\t\t\t\tphoneNumberVerified: user.phoneNumberVerified,\n\t\t\t\t\t\tcreatedAt: user.createdAt,\n\t\t\t\t\t\tupdatedAt: user.updatedAt\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}),\n\t\t\tsendPhoneNumberOTP: createAuthEndpoint(\"/phone-number/send-otp\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ phoneNumber: z.string().meta({ description: \"Phone number to send OTP. Eg: \\\"+1234567890\\\"\" }) }),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Send OTP to phone number\",\n\t\t\t\t\tdescription: \"Use this endpoint to send OTP to phone number\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { message: { type: \"string\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!options?.sendOTP) {\n\t\t\t\t\tctx.context.logger.warn(\"sendOTP not implemented\");\n\t\t\t\t\tthrow new APIError(\"NOT_IMPLEMENTED\", { message: PHONE_NUMBER_ERROR_CODES.SEND_OTP_NOT_IMPLEMENTED });\n\t\t\t\t}\n\t\t\t\tif (opts.phoneNumberValidator) {\n\t\t\t\t\tif (!await opts.phoneNumberValidator(ctx.body.phoneNumber)) throw new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER });\n\t\t\t\t}\n\t\t\t\tconst code = generateOTP(opts.otpLength);\n\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\tvalue: `${code}:0`,\n\t\t\t\t\tidentifier: ctx.body.phoneNumber,\n\t\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\")\n\t\t\t\t});\n\t\t\t\tawait options.sendOTP({\n\t\t\t\t\tphoneNumber: ctx.body.phoneNumber,\n\t\t\t\t\tcode\n\t\t\t\t}, ctx);\n\t\t\t\treturn ctx.json({ message: \"code sent\" });\n\t\t\t}),\n\t\t\tverifyPhoneNumber: createAuthEndpoint(\"/phone-number/verify\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tphoneNumber: z.string().meta({ description: \"Phone number to verify. Eg: \\\"+1234567890\\\"\" }),\n\t\t\t\t\tcode: z.string().meta({ description: \"OTP code. Eg: \\\"123456\\\"\" }),\n\t\t\t\t\tdisableSession: z.boolean().meta({ description: \"Disable session creation after verification. Eg: false\" }).optional(),\n\t\t\t\t\tupdatePhoneNumber: z.boolean().meta({ description: \"Check if there is a session and update the phone number. Eg: true\" }).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Verify phone number\",\n\t\t\t\t\tdescription: \"Use this endpoint to verify phone number\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Phone number verified successfully\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"Indicates if the verification was successful\",\n\t\t\t\t\t\t\t\t\t\tenum: [true]\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\tdescription: \"Session token if session is created, null if disableSession is true or no session is created\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier of the user\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tformat: \"email\",\n\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's email address\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\temailVerified: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the email is verified\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's name\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\timage: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's profile image URL\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tphoneNumber: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's phone number\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tphoneNumberVerified: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the phone number is verified\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the user was created\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the user was last updated\"\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\t\t\t\t\"phoneNumber\",\n\t\t\t\t\t\t\t\t\t\t\t\"phoneNumberVerified\",\n\t\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\tdescription: \"User object with phone number details, null if no user is created or found\"\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\trequired: [\"status\"]\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t},\n\t\t\t\t\t\t400: { description: \"Invalid OTP\" }\n\t\t\t\t\t}\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (options?.verifyOTP) {\n\t\t\t\t\tif (!await options.verifyOTP({\n\t\t\t\t\t\tphoneNumber: ctx.body.phoneNumber,\n\t\t\t\t\t\tcode: ctx.body.code\n\t\t\t\t\t}, ctx)) throw new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.INVALID_OTP });\n\t\t\t\t\tconst otp = await ctx.context.internalAdapter.findVerificationValue(ctx.body.phoneNumber);\n\t\t\t\t\tif (otp) await ctx.context.internalAdapter.deleteVerificationValue(otp.id);\n\t\t\t\t} else {\n\t\t\t\t\tconst otp = await ctx.context.internalAdapter.findVerificationValue(ctx.body.phoneNumber);\n\t\t\t\t\tif (!otp || otp.expiresAt < /* @__PURE__ */ new Date()) {\n\t\t\t\t\t\tif (otp && otp.expiresAt < /* @__PURE__ */ new Date()) throw new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.OTP_EXPIRED });\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.OTP_NOT_FOUND });\n\t\t\t\t\t}\n\t\t\t\t\tconst [otpValue, attempts] = otp.value.split(\":\");\n\t\t\t\t\tconst allowedAttempts = options?.allowedAttempts || 3;\n\t\t\t\t\tif (attempts && parseInt(attempts) >= allowedAttempts) {\n\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(otp.id);\n\t\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", { message: PHONE_NUMBER_ERROR_CODES.TOO_MANY_ATTEMPTS });\n\t\t\t\t\t}\n\t\t\t\t\tif (otpValue !== ctx.body.code) {\n\t\t\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(otp.id, { value: `${otpValue}:${parseInt(attempts || \"0\") + 1}` });\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.INVALID_OTP });\n\t\t\t\t\t}\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(otp.id);\n\t\t\t\t}\n\t\t\t\tif (ctx.body.updatePhoneNumber) {\n\t\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\t\t\tif (!session) throw new APIError(\"UNAUTHORIZED\", { message: BASE_ERROR_CODES.USER_NOT_FOUND });\n\t\t\t\t\tif ((await ctx.context.adapter.findMany({\n\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"phoneNumber\",\n\t\t\t\t\t\t\tvalue: ctx.body.phoneNumber\n\t\t\t\t\t\t}]\n\t\t\t\t\t})).length) throw ctx.error(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.PHONE_NUMBER_EXIST });\n\t\t\t\t\tlet user$1 = await ctx.context.internalAdapter.updateUser(session.user.id, {\n\t\t\t\t\t\t[opts.phoneNumber]: ctx.body.phoneNumber,\n\t\t\t\t\t\t[opts.phoneNumberVerified]: true\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\ttoken: session.session.token,\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tid: user$1.id,\n\t\t\t\t\t\t\temail: user$1.email,\n\t\t\t\t\t\t\temailVerified: user$1.emailVerified,\n\t\t\t\t\t\t\tname: user$1.name,\n\t\t\t\t\t\t\timage: user$1.image,\n\t\t\t\t\t\t\tphoneNumber: user$1.phoneNumber,\n\t\t\t\t\t\t\tphoneNumberVerified: user$1.phoneNumberVerified,\n\t\t\t\t\t\t\tcreatedAt: user$1.createdAt,\n\t\t\t\t\t\t\tupdatedAt: user$1.updatedAt\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tlet user = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tvalue: ctx.body.phoneNumber,\n\t\t\t\t\t\tfield: opts.phoneNumber\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!user) {\n\t\t\t\t\tif (options?.signUpOnVerification) {\n\t\t\t\t\t\tuser = await ctx.context.internalAdapter.createUser({\n\t\t\t\t\t\t\temail: options.signUpOnVerification.getTempEmail(ctx.body.phoneNumber),\n\t\t\t\t\t\t\tname: options.signUpOnVerification.getTempName ? options.signUpOnVerification.getTempName(ctx.body.phoneNumber) : ctx.body.phoneNumber,\n\t\t\t\t\t\t\t[opts.phoneNumber]: ctx.body.phoneNumber,\n\t\t\t\t\t\t\t[opts.phoneNumberVerified]: true\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (!user) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: BASE_ERROR_CODES.FAILED_TO_CREATE_USER });\n\t\t\t\t\t}\n\t\t\t\t} else user = await ctx.context.internalAdapter.updateUser(user.id, { [opts.phoneNumberVerified]: true });\n\t\t\t\tif (!user) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: BASE_ERROR_CODES.FAILED_TO_UPDATE_USER });\n\t\t\t\tawait options?.callbackOnVerification?.({\n\t\t\t\t\tphoneNumber: ctx.body.phoneNumber,\n\t\t\t\t\tuser\n\t\t\t\t}, ctx);\n\t\t\t\tif (!ctx.body.disableSession) {\n\t\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(user.id);\n\t\t\t\t\tif (!session) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION });\n\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\tsession,\n\t\t\t\t\t\tuser\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\ttoken: session.token,\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\t\temailVerified: user.emailVerified,\n\t\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\t\timage: user.image,\n\t\t\t\t\t\t\tphoneNumber: user.phoneNumber,\n\t\t\t\t\t\t\tphoneNumberVerified: user.phoneNumberVerified,\n\t\t\t\t\t\t\tcreatedAt: user.createdAt,\n\t\t\t\t\t\t\tupdatedAt: user.updatedAt\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tstatus: true,\n\t\t\t\t\ttoken: null,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\temailVerified: user.emailVerified,\n\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\timage: user.image,\n\t\t\t\t\t\tphoneNumber: user.phoneNumber,\n\t\t\t\t\t\tphoneNumberVerified: user.phoneNumberVerified,\n\t\t\t\t\t\tcreatedAt: user.createdAt,\n\t\t\t\t\t\tupdatedAt: user.updatedAt\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}),\n\t\t\trequestPasswordResetPhoneNumber: createAuthEndpoint(\"/phone-number/request-password-reset\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ phoneNumber: z.string() }),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Request OTP for password reset via phone number\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"OTP sent successfully for password reset\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { status: {\n\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\tdescription: \"Indicates if the OTP was sent successfully\",\n\t\t\t\t\t\t\t\tenum: [true]\n\t\t\t\t\t\t\t} },\n\t\t\t\t\t\t\trequired: [\"status\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tvalue: ctx.body.phoneNumber,\n\t\t\t\t\t\tfield: opts.phoneNumber\n\t\t\t\t\t}]\n\t\t\t\t})) throw new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.PHONE_NUMBER_NOT_EXIST });\n\t\t\t\tconst code = generateOTP(opts.otpLength);\n\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\tvalue: `${code}:0`,\n\t\t\t\t\tidentifier: `${ctx.body.phoneNumber}-request-password-reset`,\n\t\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\")\n\t\t\t\t});\n\t\t\t\tawait options?.sendPasswordResetOTP?.({\n\t\t\t\t\tphoneNumber: ctx.body.phoneNumber,\n\t\t\t\t\tcode\n\t\t\t\t}, ctx);\n\t\t\t\treturn ctx.json({ status: true });\n\t\t\t}),\n\t\t\tresetPasswordPhoneNumber: createAuthEndpoint(\"/phone-number/reset-password\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\totp: z.string().meta({ description: \"The one time password to reset the password. Eg: \\\"123456\\\"\" }),\n\t\t\t\t\tphoneNumber: z.string().meta({ description: \"The phone number to the account which intends to reset the password for. Eg: \\\"+1234567890\\\"\" }),\n\t\t\t\t\tnewPassword: z.string().meta({ description: `The new password. Eg: \"new-and-secure-password\"` })\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Reset password using phone number OTP\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"Password reset successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { status: {\n\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\tdescription: \"Indicates if the password was reset successfully\",\n\t\t\t\t\t\t\t\tenum: [true]\n\t\t\t\t\t\t\t} },\n\t\t\t\t\t\t\trequired: [\"status\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst verification = await ctx.context.internalAdapter.findVerificationValue(`${ctx.body.phoneNumber}-request-password-reset`);\n\t\t\t\tif (!verification) throw new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.OTP_NOT_FOUND });\n\t\t\t\tif (verification.expiresAt < /* @__PURE__ */ new Date()) throw new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.OTP_EXPIRED });\n\t\t\t\tconst [otpValue, attempts] = verification.value.split(\":\");\n\t\t\t\tconst allowedAttempts = options?.allowedAttempts || 3;\n\t\t\t\tif (attempts && parseInt(attempts) >= allowedAttempts) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verification.id);\n\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", { message: PHONE_NUMBER_ERROR_CODES.TOO_MANY_ATTEMPTS });\n\t\t\t\t}\n\t\t\t\tif (ctx.body.otp !== otpValue) {\n\t\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(verification.id, { value: `${otpValue}:${parseInt(attempts || \"0\") + 1}` });\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.INVALID_OTP });\n\t\t\t\t}\n\t\t\t\tconst user = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"phoneNumber\",\n\t\t\t\t\t\tvalue: ctx.body.phoneNumber\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!user) throw new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.UNEXPECTED_ERROR });\n\t\t\t\tconst hashedPassword = await ctx.context.password.hash(ctx.body.newPassword);\n\t\t\t\tawait ctx.context.internalAdapter.updatePassword(user.id, hashedPassword);\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verification.id);\n\t\t\t\treturn ctx.json({ status: true });\n\t\t\t})\n\t\t},\n\t\tschema: mergeSchema(schema, options?.schema),\n\t\trateLimit: [{\n\t\t\tpathMatcher(path) {\n\t\t\t\treturn path.startsWith(\"/phone-number\");\n\t\t\t},\n\t\t\twindow: 60 * 1e3,\n\t\t\tmax: 10\n\t\t}],\n\t\t$ERROR_CODES: PHONE_NUMBER_ERROR_CODES\n\t};\n};\n\n//#endregion\nexport { phoneNumber as t };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 14681, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/siwe-D81Y4fkp.mjs"],"sourcesContent":["import { t as mergeSchema } from \"./schema-Bb7wzeK_.mjs\";\nimport { r as getOrigin } from \"./url-CB8xCwz-.mjs\";\nimport { t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport { c as setSessionCookie } from \"./cookies-D72PbWdz.mjs\";\nimport * as z from \"zod\";\nimport { utf8ToBytes } from \"@noble/hashes/utils.js\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { keccak_256 } from \"@noble/hashes/sha3.js\";\n\n//#region src/utils/hashing.ts\n/**\n* TS implementation of ERC-55 (\"Mixed-case checksum address encoding\") using @noble/hashes\n* @param address - The address to convert to a checksum address\n* @returns The checksummed address\n*/\nfunction toChecksumAddress(address) {\n\taddress = address.toLowerCase().replace(\"0x\", \"\");\n\tconst hash = [...keccak_256(utf8ToBytes(address))].map((v) => v.toString(16).padStart(2, \"0\")).join(\"\");\n\tlet ret = \"0x\";\n\tfor (let i = 0; i < 40; i++) if (parseInt(hash[i], 16) >= 8) ret += address[i].toUpperCase();\n\telse ret += address[i];\n\treturn ret;\n}\n\n//#endregion\n//#region src/plugins/siwe/schema.ts\nconst schema = { walletAddress: { fields: {\n\tuserId: {\n\t\ttype: \"string\",\n\t\treferences: {\n\t\t\tmodel: \"user\",\n\t\t\tfield: \"id\"\n\t\t},\n\t\trequired: true,\n\t\tindex: true\n\t},\n\taddress: {\n\t\ttype: \"string\",\n\t\trequired: true\n\t},\n\tchainId: {\n\t\ttype: \"number\",\n\t\trequired: true\n\t},\n\tisPrimary: {\n\t\ttype: \"boolean\",\n\t\tdefaultValue: false\n\t},\n\tcreatedAt: {\n\t\ttype: \"date\",\n\t\trequired: true\n\t}\n} } };\n\n//#endregion\n//#region src/plugins/siwe/index.ts\nconst siwe = (options) => ({\n\tid: \"siwe\",\n\tschema: mergeSchema(schema, options?.schema),\n\tendpoints: {\n\t\tgetSiweNonce: createAuthEndpoint(\"/siwe/nonce\", {\n\t\t\tmethod: \"POST\",\n\t\t\tbody: z.object({\n\t\t\t\twalletAddress: z.string().regex(/^0[xX][a-fA-F0-9]{40}$/i).length(42),\n\t\t\t\tchainId: z.number().int().positive().max(2147483647).optional().default(1)\n\t\t\t})\n\t\t}, async (ctx) => {\n\t\t\tconst { walletAddress: rawWalletAddress, chainId } = ctx.body;\n\t\t\tconst walletAddress = toChecksumAddress(rawWalletAddress);\n\t\t\tconst nonce = await options.getNonce();\n\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\tidentifier: `siwe:${walletAddress}:${chainId}`,\n\t\t\t\tvalue: nonce,\n\t\t\t\texpiresAt: new Date(Date.now() + 900 * 1e3)\n\t\t\t});\n\t\t\treturn ctx.json({ nonce });\n\t\t}),\n\t\tverifySiweMessage: createAuthEndpoint(\"/siwe/verify\", {\n\t\t\tmethod: \"POST\",\n\t\t\tbody: z.object({\n\t\t\t\tmessage: z.string().min(1),\n\t\t\t\tsignature: z.string().min(1),\n\t\t\t\twalletAddress: z.string().regex(/^0[xX][a-fA-F0-9]{40}$/i).length(42),\n\t\t\t\tchainId: z.number().int().positive().max(2147483647).optional().default(1),\n\t\t\t\temail: z.email().optional()\n\t\t\t}).refine((data) => options.anonymous !== false || !!data.email, {\n\t\t\t\tmessage: \"Email is required when the anonymous plugin option is disabled.\",\n\t\t\t\tpath: [\"email\"]\n\t\t\t}),\n\t\t\trequireRequest: true\n\t\t}, async (ctx) => {\n\t\t\tconst { message, signature, walletAddress: rawWalletAddress, chainId, email } = ctx.body;\n\t\t\tconst walletAddress = toChecksumAddress(rawWalletAddress);\n\t\t\tconst isAnon = options.anonymous ?? true;\n\t\t\tif (!isAnon && !email) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\tmessage: \"Email is required when anonymous is disabled.\",\n\t\t\t\tstatus: 400\n\t\t\t});\n\t\t\ttry {\n\t\t\t\tconst verification = await ctx.context.internalAdapter.findVerificationValue(`siwe:${walletAddress}:${chainId}`);\n\t\t\t\tif (!verification || /* @__PURE__ */ new Date() > verification.expiresAt) throw new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\tmessage: \"Unauthorized: Invalid or expired nonce\",\n\t\t\t\t\tstatus: 401,\n\t\t\t\t\tcode: \"UNAUTHORIZED_INVALID_OR_EXPIRED_NONCE\"\n\t\t\t\t});\n\t\t\t\tconst { value: nonce } = verification;\n\t\t\t\tif (!await options.verifyMessage({\n\t\t\t\t\tmessage,\n\t\t\t\t\tsignature,\n\t\t\t\t\taddress: walletAddress,\n\t\t\t\t\tchainId,\n\t\t\t\t\tcacao: {\n\t\t\t\t\t\th: { t: \"caip122\" },\n\t\t\t\t\t\tp: {\n\t\t\t\t\t\t\tdomain: options.domain,\n\t\t\t\t\t\t\taud: options.domain,\n\t\t\t\t\t\t\tnonce,\n\t\t\t\t\t\t\tiss: options.domain,\n\t\t\t\t\t\t\tversion: \"1\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\ts: {\n\t\t\t\t\t\t\tt: \"eip191\",\n\t\t\t\t\t\t\ts: signature\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})) throw new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\tmessage: \"Unauthorized: Invalid SIWE signature\",\n\t\t\t\t\tstatus: 401\n\t\t\t\t});\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verification.id);\n\t\t\t\tlet user = null;\n\t\t\t\tconst existingWalletAddress = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"walletAddress\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"address\",\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tvalue: walletAddress\n\t\t\t\t\t}, {\n\t\t\t\t\t\tfield: \"chainId\",\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tvalue: chainId\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (existingWalletAddress) user = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tvalue: existingWalletAddress.userId\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\telse {\n\t\t\t\t\tconst anyWalletAddress = await ctx.context.adapter.findOne({\n\t\t\t\t\t\tmodel: \"walletAddress\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"address\",\n\t\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\t\tvalue: walletAddress\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t\tif (anyWalletAddress) user = await ctx.context.adapter.findOne({\n\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\t\tvalue: anyWalletAddress.userId\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (!user) {\n\t\t\t\t\tconst domain = options.emailDomainName ?? getOrigin(ctx.context.baseURL);\n\t\t\t\t\tconst userEmail = !isAnon && email ? email : `${walletAddress}@${domain}`;\n\t\t\t\t\tconst { name, avatar } = await options.ensLookup?.({ walletAddress }) ?? {};\n\t\t\t\t\tuser = await ctx.context.internalAdapter.createUser({\n\t\t\t\t\t\tname: name ?? walletAddress,\n\t\t\t\t\t\temail: userEmail,\n\t\t\t\t\t\timage: avatar ?? \"\"\n\t\t\t\t\t});\n\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\tmodel: \"walletAddress\",\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\t\taddress: walletAddress,\n\t\t\t\t\t\t\tchainId,\n\t\t\t\t\t\t\tisPrimary: true,\n\t\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tawait ctx.context.internalAdapter.createAccount({\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\tproviderId: \"siwe\",\n\t\t\t\t\t\taccountId: `${walletAddress}:${chainId}`,\n\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t});\n\t\t\t\t} else if (!existingWalletAddress) {\n\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\tmodel: \"walletAddress\",\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\t\taddress: walletAddress,\n\t\t\t\t\t\t\tchainId,\n\t\t\t\t\t\t\tisPrimary: false,\n\t\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tawait ctx.context.internalAdapter.createAccount({\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\tproviderId: \"siwe\",\n\t\t\t\t\t\taccountId: `${walletAddress}:${chainId}`,\n\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(user.id);\n\t\t\t\tif (!session) throw new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\tmessage: \"Internal Server Error\",\n\t\t\t\t\tstatus: 500\n\t\t\t\t});\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser\n\t\t\t\t});\n\t\t\t\treturn ctx.json({\n\t\t\t\t\ttoken: session.token,\n\t\t\t\t\tsuccess: true,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\twalletAddress,\n\t\t\t\t\t\tchainId\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\tif (error instanceof APIError) throw error;\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\tmessage: \"Something went wrong. Please try again later.\",\n\t\t\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\t\t\tstatus: 401\n\t\t\t\t});\n\t\t\t}\n\t\t})\n\t}\n});\n\n//#endregion\nexport { siwe as t };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 14961, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/two-factor-BDQvVILL.mjs"],"sourcesContent":["import { n as symmetricEncrypt, r as generateRandomString, t as symmetricDecrypt, u as constantTimeEqual } from \"./crypto-CFUhAR9W.mjs\";\nimport { t as mergeSchema } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as safeJSONParse } from \"./json-CnHxKYpj.mjs\";\nimport { c as setSessionCookie, n as deleteSessionCookie } from \"./cookies-D72PbWdz.mjs\";\nimport { r as getSessionFromCtx, u as sessionMiddleware } from \"./session-AaRl3_x-.mjs\";\nimport { n as validatePassword } from \"./password-BFQK0cLg.mjs\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\nimport { base64Url } from \"@better-auth/utils/base64\";\nimport { createHMAC } from \"@better-auth/utils/hmac\";\nimport { createOTP } from \"@better-auth/utils/otp\";\n\n//#region src/plugins/two-factor/error-code.ts\nconst TWO_FACTOR_ERROR_CODES = defineErrorCodes({\n\tOTP_NOT_ENABLED: \"OTP not enabled\",\n\tOTP_HAS_EXPIRED: \"OTP has expired\",\n\tTOTP_NOT_ENABLED: \"TOTP not enabled\",\n\tTWO_FACTOR_NOT_ENABLED: \"Two factor isn't enabled\",\n\tBACKUP_CODES_NOT_ENABLED: \"Backup codes aren't enabled\",\n\tINVALID_BACKUP_CODE: \"Invalid backup code\",\n\tINVALID_CODE: \"Invalid code\",\n\tTOO_MANY_ATTEMPTS_REQUEST_NEW_CODE: \"Too many attempts. Please request a new code.\",\n\tINVALID_TWO_FACTOR_COOKIE: \"Invalid two factor cookie\"\n});\n\n//#endregion\n//#region src/plugins/two-factor/constant.ts\nconst TWO_FACTOR_COOKIE_NAME = \"two_factor\";\nconst TRUST_DEVICE_COOKIE_NAME = \"trust_device\";\nconst TRUST_DEVICE_COOKIE_MAX_AGE = 720 * 60 * 60;\n\n//#endregion\n//#region src/plugins/two-factor/verify-two-factor.ts\nasync function verifyTwoFactor(ctx) {\n\tconst invalid = (errorKey) => {\n\t\tthrow new APIError(\"UNAUTHORIZED\", { message: TWO_FACTOR_ERROR_CODES[errorKey] });\n\t};\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session) {\n\t\tconst cookieName = ctx.context.createAuthCookie(TWO_FACTOR_COOKIE_NAME);\n\t\tconst twoFactorCookie = await ctx.getSignedCookie(cookieName.name, ctx.context.secret);\n\t\tif (!twoFactorCookie) throw new APIError(\"UNAUTHORIZED\", { message: TWO_FACTOR_ERROR_CODES.INVALID_TWO_FACTOR_COOKIE });\n\t\tconst verificationToken = await ctx.context.internalAdapter.findVerificationValue(twoFactorCookie);\n\t\tif (!verificationToken) throw new APIError(\"UNAUTHORIZED\", { message: TWO_FACTOR_ERROR_CODES.INVALID_TWO_FACTOR_COOKIE });\n\t\tconst user = await ctx.context.internalAdapter.findUserById(verificationToken.value);\n\t\tif (!user) throw new APIError(\"UNAUTHORIZED\", { message: TWO_FACTOR_ERROR_CODES.INVALID_TWO_FACTOR_COOKIE });\n\t\tconst dontRememberMe = await ctx.getSignedCookie(ctx.context.authCookies.dontRememberToken.name, ctx.context.secret);\n\t\treturn {\n\t\t\tvalid: async (ctx$1) => {\n\t\t\t\tconst session$1 = await ctx$1.context.internalAdapter.createSession(verificationToken.value, !!dontRememberMe);\n\t\t\t\tif (!session$1) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: \"failed to create session\" });\n\t\t\t\tawait setSessionCookie(ctx$1, {\n\t\t\t\t\tsession: session$1,\n\t\t\t\t\tuser\n\t\t\t\t});\n\t\t\t\tif (ctx$1.body.trustDevice) {\n\t\t\t\t\tconst trustDeviceCookie = ctx$1.context.createAuthCookie(TRUST_DEVICE_COOKIE_NAME, { maxAge: TRUST_DEVICE_COOKIE_MAX_AGE });\n\t\t\t\t\t/**\n\t\t\t\t\t* create a token that will be used to\n\t\t\t\t\t* verify the device\n\t\t\t\t\t*/\n\t\t\t\t\tconst token = await createHMAC(\"SHA-256\", \"base64urlnopad\").sign(ctx$1.context.secret, `${user.id}!${session$1.token}`);\n\t\t\t\t\tawait ctx$1.setSignedCookie(trustDeviceCookie.name, `${token}!${session$1.token}`, ctx$1.context.secret, trustDeviceCookie.attributes);\n\t\t\t\t\tctx$1.setCookie(ctx$1.context.authCookies.dontRememberToken.name, \"\", { maxAge: 0 });\n\t\t\t\t\tctx$1.setCookie(cookieName.name, \"\", { maxAge: 0 });\n\t\t\t\t}\n\t\t\t\treturn ctx$1.json({\n\t\t\t\t\ttoken: session$1.token,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\temailVerified: user.emailVerified,\n\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\timage: user.image,\n\t\t\t\t\t\tcreatedAt: user.createdAt,\n\t\t\t\t\t\tupdatedAt: user.updatedAt\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tinvalid,\n\t\t\tsession: {\n\t\t\t\tsession: null,\n\t\t\t\tuser\n\t\t\t},\n\t\t\tkey: twoFactorCookie\n\t\t};\n\t}\n\treturn {\n\t\tvalid: async (ctx$1) => {\n\t\t\treturn ctx$1.json({\n\t\t\t\ttoken: session.session.token,\n\t\t\t\tuser: {\n\t\t\t\t\tid: session.user.id,\n\t\t\t\t\temail: session.user.email,\n\t\t\t\t\temailVerified: session.user.emailVerified,\n\t\t\t\t\tname: session.user.name,\n\t\t\t\t\timage: session.user.image,\n\t\t\t\t\tcreatedAt: session.user.createdAt,\n\t\t\t\t\tupdatedAt: session.user.updatedAt\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tinvalid,\n\t\tsession,\n\t\tkey: `${session.user.id}!${session.session.id}`\n\t};\n}\n\n//#endregion\n//#region src/plugins/two-factor/backup-codes/index.ts\nfunction generateBackupCodesFn(options) {\n\treturn Array.from({ length: options?.amount ?? 10 }).fill(null).map(() => generateRandomString(options?.length ?? 10, \"a-z\", \"0-9\", \"A-Z\")).map((code) => `${code.slice(0, 5)}-${code.slice(5)}`);\n}\nasync function generateBackupCodes(secret, options) {\n\tconst backupCodes = options?.customBackupCodesGenerate ? options.customBackupCodesGenerate() : generateBackupCodesFn(options);\n\tif (options?.storeBackupCodes === \"encrypted\") return {\n\t\tbackupCodes,\n\t\tencryptedBackupCodes: await symmetricEncrypt({\n\t\t\tdata: JSON.stringify(backupCodes),\n\t\t\tkey: secret\n\t\t})\n\t};\n\tif (typeof options?.storeBackupCodes === \"object\" && \"encrypt\" in options?.storeBackupCodes) return {\n\t\tbackupCodes,\n\t\tencryptedBackupCodes: await options?.storeBackupCodes.encrypt(JSON.stringify(backupCodes))\n\t};\n\treturn {\n\t\tbackupCodes,\n\t\tencryptedBackupCodes: JSON.stringify(backupCodes)\n\t};\n}\nasync function verifyBackupCode(data, key, options) {\n\tconst codes = await getBackupCodes(data.backupCodes, key, options);\n\tif (!codes) return {\n\t\tstatus: false,\n\t\tupdated: null\n\t};\n\treturn {\n\t\tstatus: codes.includes(data.code),\n\t\tupdated: codes.filter((code) => code !== data.code)\n\t};\n}\nasync function getBackupCodes(backupCodes, key, options) {\n\tif (options?.storeBackupCodes === \"encrypted\") return safeJSONParse(await symmetricDecrypt({\n\t\tkey,\n\t\tdata: backupCodes\n\t}));\n\tif (typeof options?.storeBackupCodes === \"object\" && \"decrypt\" in options?.storeBackupCodes) return safeJSONParse(await options?.storeBackupCodes.decrypt(backupCodes));\n\treturn safeJSONParse(backupCodes);\n}\nconst backupCode2fa = (opts) => {\n\tconst twoFactorTable = \"twoFactor\";\n\treturn {\n\t\tid: \"backup_code\",\n\t\tendpoints: {\n\t\t\tverifyBackupCode: createAuthEndpoint(\"/two-factor/verify-backup-code\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tcode: z.string().meta({ description: `A backup code to verify. Eg: \"123456\"` }),\n\t\t\t\t\tdisableSession: z.boolean().meta({ description: \"If true, the session cookie will not be set.\" }).optional(),\n\t\t\t\t\ttrustDevice: z.boolean().meta({ description: \"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true\" }).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Verify a backup code for two-factor authentication\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"Backup code verified successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier of the user\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"email\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's email address\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\temailVerified: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the email is verified\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's name\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\timage: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's profile image URL\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\ttwoFactorEnabled: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Whether two-factor authentication is enabled for the user\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the user was created\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the user was last updated\"\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\t\t\t\"twoFactorEnabled\",\n\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tdescription: \"The authenticated user object with two-factor details\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Session token\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"ID of the user associated with the session\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the session was created\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\texpiresAt: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the session expires\"\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\"token\",\n\t\t\t\t\t\t\t\t\t\t\"userId\",\n\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\"expiresAt\"\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tdescription: \"The current session object, included unless disableSession is true\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\"user\", \"session\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { session, valid } = await verifyTwoFactor(ctx);\n\t\t\t\tconst user = session.user;\n\t\t\t\tconst twoFactor$1 = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!twoFactor$1) throw new APIError(\"BAD_REQUEST\", { message: TWO_FACTOR_ERROR_CODES.BACKUP_CODES_NOT_ENABLED });\n\t\t\t\tconst validate = await verifyBackupCode({\n\t\t\t\t\tbackupCodes: twoFactor$1.backupCodes,\n\t\t\t\t\tcode: ctx.body.code\n\t\t\t\t}, ctx.context.secret, opts);\n\t\t\t\tif (!validate.status) throw new APIError(\"UNAUTHORIZED\", { message: TWO_FACTOR_ERROR_CODES.INVALID_BACKUP_CODE });\n\t\t\t\tconst updatedBackupCodes = await symmetricEncrypt({\n\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\tdata: JSON.stringify(validate.updated)\n\t\t\t\t});\n\t\t\t\tif (!await ctx.context.adapter.updateMany({\n\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\tupdate: { backupCodes: updatedBackupCodes },\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id\n\t\t\t\t\t}, {\n\t\t\t\t\t\tfield: \"backupCodes\",\n\t\t\t\t\t\tvalue: twoFactor$1.backupCodes\n\t\t\t\t\t}]\n\t\t\t\t})) throw new APIError(\"CONFLICT\", { message: \"Failed to verify backup code. Please try again.\" });\n\t\t\t\tif (!ctx.body.disableSession) return valid(ctx);\n\t\t\t\treturn ctx.json({\n\t\t\t\t\ttoken: session.session?.token,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: session.user?.id,\n\t\t\t\t\t\temail: session.user.email,\n\t\t\t\t\t\temailVerified: session.user.emailVerified,\n\t\t\t\t\t\tname: session.user.name,\n\t\t\t\t\t\timage: session.user.image,\n\t\t\t\t\t\tcreatedAt: session.user.createdAt,\n\t\t\t\t\t\tupdatedAt: session.user.updatedAt\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}),\n\t\t\tgenerateBackupCodes: createAuthEndpoint(\"/two-factor/generate-backup-codes\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ password: z.string().meta({ description: \"The users password.\" }) }),\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Generate new backup codes for two-factor authentication\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"Backup codes generated successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\tdescription: \"Indicates if the backup codes were generated successfully\",\n\t\t\t\t\t\t\t\t\tenum: [true]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbackupCodes: {\n\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\titems: { type: \"string\" },\n\t\t\t\t\t\t\t\t\tdescription: \"Array of generated backup codes in plain text\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\"status\", \"backupCodes\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst user = ctx.context.session.user;\n\t\t\t\tif (!user.twoFactorEnabled) throw new APIError(\"BAD_REQUEST\", { message: TWO_FACTOR_ERROR_CODES.TWO_FACTOR_NOT_ENABLED });\n\t\t\t\tawait ctx.context.password.checkPassword(user.id, ctx);\n\t\t\t\tconst backupCodes = await generateBackupCodes(ctx.context.secret, opts);\n\t\t\t\tawait ctx.context.adapter.updateMany({\n\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\tupdate: { backupCodes: backupCodes.encryptedBackupCodes },\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: ctx.context.session.user.id\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tstatus: true,\n\t\t\t\t\tbackupCodes: backupCodes.backupCodes\n\t\t\t\t});\n\t\t\t}),\n\t\t\tviewBackupCodes: createAuthEndpoint(\"/two-factor/view-backup-codes\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ userId: z.coerce.string().meta({ description: `The user ID to view all backup codes. Eg: \"user-id\"` }) }),\n\t\t\t\tmetadata: { SERVER_ONLY: true }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst twoFactor$1 = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: ctx.body.userId\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!twoFactor$1) throw new APIError(\"BAD_REQUEST\", { message: TWO_FACTOR_ERROR_CODES.BACKUP_CODES_NOT_ENABLED });\n\t\t\t\tconst decryptedBackupCodes = await getBackupCodes(twoFactor$1.backupCodes, ctx.context.secret, opts);\n\t\t\t\tif (!decryptedBackupCodes) throw new APIError(\"BAD_REQUEST\", { message: TWO_FACTOR_ERROR_CODES.INVALID_BACKUP_CODE });\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tstatus: true,\n\t\t\t\t\tbackupCodes: decryptedBackupCodes\n\t\t\t\t});\n\t\t\t})\n\t\t}\n\t};\n};\n\n//#endregion\n//#region src/plugins/two-factor/utils.ts\nconst defaultKeyHasher = async (token) => {\n\tconst hash = await createHash(\"SHA-256\").digest(new TextEncoder().encode(token));\n\treturn base64Url.encode(new Uint8Array(hash), { padding: false });\n};\n\n//#endregion\n//#region src/plugins/two-factor/otp/index.ts\n/**\n* The otp adapter is created from the totp adapter.\n*/\nconst otp2fa = (options) => {\n\tconst opts = {\n\t\tstoreOTP: \"plain\",\n\t\tdigits: 6,\n\t\t...options,\n\t\tperiod: (options?.period || 3) * 60 * 1e3\n\t};\n\tasync function storeOTP(ctx, otp) {\n\t\tif (opts.storeOTP === \"hashed\") return await defaultKeyHasher(otp);\n\t\tif (typeof opts.storeOTP === \"object\" && \"hash\" in opts.storeOTP) return await opts.storeOTP.hash(otp);\n\t\tif (typeof opts.storeOTP === \"object\" && \"encrypt\" in opts.storeOTP) return await opts.storeOTP.encrypt(otp);\n\t\tif (opts.storeOTP === \"encrypted\") return await symmetricEncrypt({\n\t\t\tkey: ctx.context.secret,\n\t\t\tdata: otp\n\t\t});\n\t\treturn otp;\n\t}\n\tasync function decryptOTP(ctx, otp) {\n\t\tif (opts.storeOTP === \"hashed\") return await defaultKeyHasher(otp);\n\t\tif (opts.storeOTP === \"encrypted\") return await symmetricDecrypt({\n\t\t\tkey: ctx.context.secret,\n\t\t\tdata: otp\n\t\t});\n\t\tif (typeof opts.storeOTP === \"object\" && \"encrypt\" in opts.storeOTP) return await opts.storeOTP.decrypt(otp);\n\t\tif (typeof opts.storeOTP === \"object\" && \"hash\" in opts.storeOTP) return await opts.storeOTP.hash(otp);\n\t\treturn otp;\n\t}\n\treturn {\n\t\tid: \"otp\",\n\t\tendpoints: {\n\t\t\tsendTwoFactorOTP: createAuthEndpoint(\"/two-factor/send-otp\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ trustDevice: z.boolean().optional().meta({ description: \"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true\" }) }).optional(),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Send two factor OTP\",\n\t\t\t\t\tdescription: \"Send two factor OTP to the user\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { status: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!options || !options.sendOTP) {\n\t\t\t\t\tctx.context.logger.error(\"send otp isn't configured. Please configure the send otp function on otp options.\");\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"otp isn't configured\" });\n\t\t\t\t}\n\t\t\t\tconst { session, key } = await verifyTwoFactor(ctx);\n\t\t\t\tconst code = generateRandomString(opts.digits, \"0-9\");\n\t\t\t\tconst hashedCode = await storeOTP(ctx, code);\n\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\tvalue: `${hashedCode}:0`,\n\t\t\t\t\tidentifier: `2fa-otp-${key}`,\n\t\t\t\t\texpiresAt: new Date(Date.now() + opts.period)\n\t\t\t\t});\n\t\t\t\tawait options.sendOTP({\n\t\t\t\t\tuser: session.user,\n\t\t\t\t\totp: code\n\t\t\t\t}, ctx);\n\t\t\t\treturn ctx.json({ status: true });\n\t\t\t}),\n\t\t\tverifyTwoFactorOTP: createAuthEndpoint(\"/two-factor/verify-otp\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tcode: z.string().meta({ description: \"The otp code to verify. Eg: \\\"012345\\\"\" }),\n\t\t\t\t\ttrustDevice: z.boolean().optional().meta({ description: \"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true\" })\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Verify two factor OTP\",\n\t\t\t\t\tdescription: \"Verify two factor OTP\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"Two-factor OTP verified successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Session token for the authenticated session\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier of the user\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"email\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's email address\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\temailVerified: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the email is verified\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's name\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\timage: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's profile image URL\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the user was created\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the user was last updated\"\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tdescription: \"The authenticated user object\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\"token\", \"user\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { session, key, valid, invalid } = await verifyTwoFactor(ctx);\n\t\t\t\tconst toCheckOtp = await ctx.context.internalAdapter.findVerificationValue(`2fa-otp-${key}`);\n\t\t\t\tconst [otp, counter] = toCheckOtp?.value?.split(\":\") ?? [];\n\t\t\t\tconst decryptedOtp = await decryptOTP(ctx, otp);\n\t\t\t\tif (!toCheckOtp || toCheckOtp.expiresAt < /* @__PURE__ */ new Date()) {\n\t\t\t\t\tif (toCheckOtp) await ctx.context.internalAdapter.deleteVerificationValue(toCheckOtp.id);\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: TWO_FACTOR_ERROR_CODES.OTP_HAS_EXPIRED });\n\t\t\t\t}\n\t\t\t\tconst allowedAttempts = options?.allowedAttempts || 5;\n\t\t\t\tif (parseInt(counter) >= allowedAttempts) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(toCheckOtp.id);\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: TWO_FACTOR_ERROR_CODES.TOO_MANY_ATTEMPTS_REQUEST_NEW_CODE });\n\t\t\t\t}\n\t\t\t\tif (constantTimeEqual(new TextEncoder().encode(decryptedOtp), new TextEncoder().encode(ctx.body.code))) {\n\t\t\t\t\tif (!session.user.twoFactorEnabled) {\n\t\t\t\t\t\tif (!session.session) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION });\n\t\t\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(session.user.id, { twoFactorEnabled: true });\n\t\t\t\t\t\tconst newSession = await ctx.context.internalAdapter.createSession(session.user.id, false, session.session);\n\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteSession(session.session.token);\n\t\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\t\tsession: newSession,\n\t\t\t\t\t\t\tuser: updatedUser\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\t\ttoken: newSession.token,\n\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\tid: updatedUser.id,\n\t\t\t\t\t\t\t\temail: updatedUser.email,\n\t\t\t\t\t\t\t\temailVerified: updatedUser.emailVerified,\n\t\t\t\t\t\t\t\tname: updatedUser.name,\n\t\t\t\t\t\t\t\timage: updatedUser.image,\n\t\t\t\t\t\t\t\tcreatedAt: updatedUser.createdAt,\n\t\t\t\t\t\t\t\tupdatedAt: updatedUser.updatedAt\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn valid(ctx);\n\t\t\t\t} else {\n\t\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(toCheckOtp.id, { value: `${otp}:${(parseInt(counter, 10) || 0) + 1}` });\n\t\t\t\t\treturn invalid(\"INVALID_CODE\");\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t};\n};\n\n//#endregion\n//#region src/plugins/two-factor/schema.ts\nconst schema = {\n\tuser: { fields: { twoFactorEnabled: {\n\t\ttype: \"boolean\",\n\t\trequired: false,\n\t\tdefaultValue: false,\n\t\tinput: false\n\t} } },\n\ttwoFactor: { fields: {\n\t\tsecret: {\n\t\t\ttype: \"string\",\n\t\t\trequired: true,\n\t\t\treturned: false,\n\t\t\tindex: true\n\t\t},\n\t\tbackupCodes: {\n\t\t\ttype: \"string\",\n\t\t\trequired: true,\n\t\t\treturned: false\n\t\t},\n\t\tuserId: {\n\t\t\ttype: \"string\",\n\t\t\trequired: true,\n\t\t\treturned: false,\n\t\t\treferences: {\n\t\t\t\tmodel: \"user\",\n\t\t\t\tfield: \"id\"\n\t\t\t},\n\t\t\tindex: true\n\t\t}\n\t} }\n};\n\n//#endregion\n//#region src/plugins/two-factor/totp/index.ts\nconst totp2fa = (options) => {\n\tconst opts = {\n\t\t...options,\n\t\tdigits: options?.digits || 6,\n\t\tperiod: options?.period || 30\n\t};\n\tconst twoFactorTable = \"twoFactor\";\n\treturn {\n\t\tid: \"totp\",\n\t\tendpoints: {\n\t\t\tgenerateTOTP: createAuthEndpoint(\"/totp/generate\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ secret: z.string().meta({ description: \"The secret to generate the TOTP code\" }) }),\n\t\t\t\tmetadata: {\n\t\t\t\t\topenapi: {\n\t\t\t\t\t\tsummary: \"Generate TOTP code\",\n\t\t\t\t\t\tdescription: \"Use this endpoint to generate a TOTP code\",\n\t\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: { code: { type: \"string\" } }\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t} }\n\t\t\t\t\t},\n\t\t\t\t\tSERVER_ONLY: true\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (options?.disable) {\n\t\t\t\t\tctx.context.logger.error(\"totp isn't configured. please pass totp option on two factor plugin to enable totp\");\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"totp isn't configured\" });\n\t\t\t\t}\n\t\t\t\treturn { code: await createOTP(ctx.body.secret, {\n\t\t\t\t\tperiod: opts.period,\n\t\t\t\t\tdigits: opts.digits\n\t\t\t\t}).totp() };\n\t\t\t}),\n\t\t\tgetTOTPURI: createAuthEndpoint(\"/two-factor/get-totp-uri\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tbody: z.object({ password: z.string().meta({ description: \"User password\" }) }),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Get TOTP URI\",\n\t\t\t\t\tdescription: \"Use this endpoint to get the TOTP URI\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { totpURI: { type: \"string\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (options?.disable) {\n\t\t\t\t\tctx.context.logger.error(\"totp isn't configured. please pass totp option on two factor plugin to enable totp\");\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"totp isn't configured\" });\n\t\t\t\t}\n\t\t\t\tconst user = ctx.context.session.user;\n\t\t\t\tconst twoFactor$1 = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!twoFactor$1) throw new APIError(\"BAD_REQUEST\", { message: TWO_FACTOR_ERROR_CODES.TOTP_NOT_ENABLED });\n\t\t\t\tconst secret = await symmetricDecrypt({\n\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\tdata: twoFactor$1.secret\n\t\t\t\t});\n\t\t\t\tawait ctx.context.password.checkPassword(user.id, ctx);\n\t\t\t\treturn { totpURI: createOTP(secret, {\n\t\t\t\t\tdigits: opts.digits,\n\t\t\t\t\tperiod: opts.period\n\t\t\t\t}).url(options?.issuer || ctx.context.appName, user.email) };\n\t\t\t}),\n\t\t\tverifyTOTP: createAuthEndpoint(\"/two-factor/verify-totp\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tcode: z.string().meta({ description: \"The otp code to verify. Eg: \\\"012345\\\"\" }),\n\t\t\t\t\ttrustDevice: z.boolean().meta({ description: \"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true\" }).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Verify two factor TOTP\",\n\t\t\t\t\tdescription: \"Verify two factor TOTP\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { status: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (options?.disable) {\n\t\t\t\t\tctx.context.logger.error(\"totp isn't configured. please pass totp option on two factor plugin to enable totp\");\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"totp isn't configured\" });\n\t\t\t\t}\n\t\t\t\tconst { session, valid, invalid } = await verifyTwoFactor(ctx);\n\t\t\t\tconst user = session.user;\n\t\t\t\tconst twoFactor$1 = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!twoFactor$1) throw new APIError(\"BAD_REQUEST\", { message: TWO_FACTOR_ERROR_CODES.TOTP_NOT_ENABLED });\n\t\t\t\tif (!await createOTP(await symmetricDecrypt({\n\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\tdata: twoFactor$1.secret\n\t\t\t\t}), {\n\t\t\t\t\tperiod: opts.period,\n\t\t\t\t\tdigits: opts.digits\n\t\t\t\t}).verify(ctx.body.code)) return invalid(\"INVALID_CODE\");\n\t\t\t\tif (!user.twoFactorEnabled) {\n\t\t\t\t\tif (!session.session) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION });\n\t\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(user.id, { twoFactorEnabled: true });\n\t\t\t\t\tconst newSession = await ctx.context.internalAdapter.createSession(user.id, false, session.session).catch((e) => {\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t});\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteSession(session.session.token);\n\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\tsession: newSession,\n\t\t\t\t\t\tuser: updatedUser\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn valid(ctx);\n\t\t\t})\n\t\t}\n\t};\n};\n\n//#endregion\n//#region src/plugins/two-factor/index.ts\nconst twoFactor = (options) => {\n\tconst opts = { twoFactorTable: \"twoFactor\" };\n\tconst backupCodeOptions = {\n\t\tstoreBackupCodes: \"encrypted\",\n\t\t...options?.backupCodeOptions\n\t};\n\tconst totp = totp2fa(options?.totpOptions);\n\tconst backupCode = backupCode2fa(backupCodeOptions);\n\tconst otp = otp2fa(options?.otpOptions);\n\treturn {\n\t\tid: \"two-factor\",\n\t\tendpoints: {\n\t\t\t...totp.endpoints,\n\t\t\t...otp.endpoints,\n\t\t\t...backupCode.endpoints,\n\t\t\tenableTwoFactor: createAuthEndpoint(\"/two-factor/enable\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tpassword: z.string().meta({ description: \"User password\" }),\n\t\t\t\t\tissuer: z.string().meta({ description: \"Custom issuer for the TOTP URI\" }).optional()\n\t\t\t\t}),\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Enable two factor authentication\",\n\t\t\t\t\tdescription: \"Use this endpoint to enable two factor authentication. This will generate a TOTP URI and backup codes. Once the user verifies the TOTP URI, the two factor authentication will be enabled.\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\ttotpURI: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"TOTP URI\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbackupCodes: {\n\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\titems: { type: \"string\" },\n\t\t\t\t\t\t\t\t\tdescription: \"Backup codes\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst user = ctx.context.session.user;\n\t\t\t\tconst { password, issuer } = ctx.body;\n\t\t\t\tif (!await validatePassword(ctx, {\n\t\t\t\t\tpassword,\n\t\t\t\t\tuserId: user.id\n\t\t\t\t})) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.INVALID_PASSWORD });\n\t\t\t\tconst secret = generateRandomString(32);\n\t\t\t\tconst encryptedSecret = await symmetricEncrypt({\n\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\tdata: secret\n\t\t\t\t});\n\t\t\t\tconst backupCodes = await generateBackupCodes(ctx.context.secret, backupCodeOptions);\n\t\t\t\tif (options?.skipVerificationOnEnable) {\n\t\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(user.id, { twoFactorEnabled: true });\n\t\t\t\t\t/**\n\t\t\t\t\t* Update the session cookie with the new user data\n\t\t\t\t\t*/\n\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\tsession: await ctx.context.internalAdapter.createSession(updatedUser.id, false, ctx.context.session.session),\n\t\t\t\t\t\tuser: updatedUser\n\t\t\t\t\t});\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteSession(ctx.context.session.session.token);\n\t\t\t\t}\n\t\t\t\tawait ctx.context.adapter.deleteMany({\n\t\t\t\t\tmodel: opts.twoFactorTable,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\tmodel: opts.twoFactorTable,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tsecret: encryptedSecret,\n\t\t\t\t\t\tbackupCodes: backupCodes.encryptedBackupCodes,\n\t\t\t\t\t\tuserId: user.id\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tconst totpURI = createOTP(secret, {\n\t\t\t\t\tdigits: options?.totpOptions?.digits || 6,\n\t\t\t\t\tperiod: options?.totpOptions?.period\n\t\t\t\t}).url(issuer || options?.issuer || ctx.context.appName, user.email);\n\t\t\t\treturn ctx.json({\n\t\t\t\t\ttotpURI,\n\t\t\t\t\tbackupCodes: backupCodes.backupCodes\n\t\t\t\t});\n\t\t\t}),\n\t\t\tdisableTwoFactor: createAuthEndpoint(\"/two-factor/disable\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ password: z.string().meta({ description: \"User password\" }) }),\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Disable two factor authentication\",\n\t\t\t\t\tdescription: \"Use this endpoint to disable two factor authentication.\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { status: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst user = ctx.context.session.user;\n\t\t\t\tconst { password } = ctx.body;\n\t\t\t\tif (!await validatePassword(ctx, {\n\t\t\t\t\tpassword,\n\t\t\t\t\tuserId: user.id\n\t\t\t\t})) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.INVALID_PASSWORD });\n\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(user.id, { twoFactorEnabled: false });\n\t\t\t\tawait ctx.context.adapter.delete({\n\t\t\t\t\tmodel: opts.twoFactorTable,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: updatedUser.id\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\t/**\n\t\t\t\t* Update the session cookie with the new user data\n\t\t\t\t*/\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession: await ctx.context.internalAdapter.createSession(updatedUser.id, false, ctx.context.session.session),\n\t\t\t\t\tuser: updatedUser\n\t\t\t\t});\n\t\t\t\tawait ctx.context.internalAdapter.deleteSession(ctx.context.session.session.token);\n\t\t\t\treturn ctx.json({ status: true });\n\t\t\t})\n\t\t},\n\t\toptions,\n\t\thooks: { after: [{\n\t\t\tmatcher(context) {\n\t\t\t\treturn context.path === \"/sign-in/email\" || context.path === \"/sign-in/username\" || context.path === \"/sign-in/phone-number\";\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst data = ctx.context.newSession;\n\t\t\t\tif (!data) return;\n\t\t\t\tif (!data?.user.twoFactorEnabled) return;\n\t\t\t\tconst trustDeviceCookieAttrs = ctx.context.createAuthCookie(TRUST_DEVICE_COOKIE_NAME, { maxAge: TRUST_DEVICE_COOKIE_MAX_AGE });\n\t\t\t\tconst trustDeviceCookie = await ctx.getSignedCookie(trustDeviceCookieAttrs.name, ctx.context.secret);\n\t\t\t\tif (trustDeviceCookie) {\n\t\t\t\t\tconst [token, sessionToken] = trustDeviceCookie.split(\"!\");\n\t\t\t\t\tif (token === await createHMAC(\"SHA-256\", \"base64urlnopad\").sign(ctx.context.secret, `${data.user.id}!${sessionToken}`)) {\n\t\t\t\t\t\tconst newTrustDeviceCookie = ctx.context.createAuthCookie(TRUST_DEVICE_COOKIE_NAME, { maxAge: TRUST_DEVICE_COOKIE_MAX_AGE });\n\t\t\t\t\t\tconst newToken = await createHMAC(\"SHA-256\", \"base64urlnopad\").sign(ctx.context.secret, `${data.user.id}!${data.session.token}`);\n\t\t\t\t\t\tawait ctx.setSignedCookie(newTrustDeviceCookie.name, `${newToken}!${data.session.token}`, ctx.context.secret, trustDeviceCookieAttrs.attributes);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t/**\n\t\t\t\t* remove the session cookie. It's set by the sign in credential\n\t\t\t\t*/\n\t\t\t\tdeleteSessionCookie(ctx, true);\n\t\t\t\tawait ctx.context.internalAdapter.deleteSession(data.session.token);\n\t\t\t\tconst maxAge = (options?.otpOptions?.period ?? 3) * 60;\n\t\t\t\tconst twoFactorCookie = ctx.context.createAuthCookie(TWO_FACTOR_COOKIE_NAME, { maxAge });\n\t\t\t\tconst identifier = `2fa-${generateRandomString(20)}`;\n\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\tvalue: data.user.id,\n\t\t\t\t\tidentifier,\n\t\t\t\t\texpiresAt: new Date(Date.now() + maxAge * 1e3)\n\t\t\t\t});\n\t\t\t\tawait ctx.setSignedCookie(twoFactorCookie.name, identifier, ctx.context.secret, twoFactorCookie.attributes);\n\t\t\t\treturn ctx.json({ twoFactorRedirect: true });\n\t\t\t})\n\t\t}] },\n\t\tschema: mergeSchema(schema, options?.schema),\n\t\trateLimit: [{\n\t\t\tpathMatcher(path) {\n\t\t\t\treturn path.startsWith(\"/two-factor/\");\n\t\t\t},\n\t\t\twindow: 10,\n\t\t\tmax: 3\n\t\t}],\n\t\t$ERROR_CODES: TWO_FACTOR_ERROR_CODES\n\t};\n};\n\n//#endregion\nexport { TWO_FACTOR_ERROR_CODES as n, twoFactor as t };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 16166, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/username-C_wmkXwt.mjs"],"sourcesContent":["import { t as mergeSchema } from \"./schema-Bb7wzeK_.mjs\";\nimport { C as createEmailVerificationToken } from \"./api-CkmycQ2x.mjs\";\nimport { c as setSessionCookie } from \"./cookies-D72PbWdz.mjs\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\n\n//#region src/plugins/username/error-codes.ts\nconst USERNAME_ERROR_CODES = defineErrorCodes({\n\tINVALID_USERNAME_OR_PASSWORD: \"Invalid username or password\",\n\tEMAIL_NOT_VERIFIED: \"Email not verified\",\n\tUNEXPECTED_ERROR: \"Unexpected error\",\n\tUSERNAME_IS_ALREADY_TAKEN: \"Username is already taken. Please try another.\",\n\tUSERNAME_TOO_SHORT: \"Username is too short\",\n\tUSERNAME_TOO_LONG: \"Username is too long\",\n\tINVALID_USERNAME: \"Username is invalid\",\n\tINVALID_DISPLAY_USERNAME: \"Display username is invalid\"\n});\n\n//#endregion\n//#region src/plugins/username/schema.ts\nconst getSchema = (normalizer) => {\n\treturn { user: { fields: {\n\t\tusername: {\n\t\t\ttype: \"string\",\n\t\t\trequired: false,\n\t\t\tsortable: true,\n\t\t\tunique: true,\n\t\t\treturned: true,\n\t\t\ttransform: { input(value) {\n\t\t\t\treturn typeof value !== \"string\" ? value : normalizer.username(value);\n\t\t\t} }\n\t\t},\n\t\tdisplayUsername: {\n\t\t\ttype: \"string\",\n\t\t\trequired: false,\n\t\t\ttransform: { input(value) {\n\t\t\t\treturn typeof value !== \"string\" ? value : normalizer.displayUsername(value);\n\t\t\t} }\n\t\t}\n\t} } };\n};\n\n//#endregion\n//#region src/plugins/username/index.ts\nfunction defaultUsernameValidator(username$1) {\n\treturn /^[a-zA-Z0-9_.]+$/.test(username$1);\n}\nconst username = (options) => {\n\tconst normalizer = (username$1) => {\n\t\tif (options?.usernameNormalization === false) return username$1;\n\t\tif (options?.usernameNormalization) return options.usernameNormalization(username$1);\n\t\treturn username$1.toLowerCase();\n\t};\n\tconst displayUsernameNormalizer = (displayUsername) => {\n\t\treturn options?.displayUsernameNormalization ? options.displayUsernameNormalization(displayUsername) : displayUsername;\n\t};\n\treturn {\n\t\tid: \"username\",\n\t\tinit(ctx) {\n\t\t\treturn { options: { databaseHooks: { user: {\n\t\t\t\tcreate: { async before(user, context) {\n\t\t\t\t\tconst username$1 = \"username\" in user ? user.username : null;\n\t\t\t\t\tconst displayUsername = \"displayUsername\" in user ? user.displayUsername : null;\n\t\t\t\t\treturn { data: {\n\t\t\t\t\t\t...user,\n\t\t\t\t\t\t...username$1 ? { username: normalizer(username$1) } : {},\n\t\t\t\t\t\t...displayUsername ? { displayUsername: displayUsernameNormalizer(displayUsername) } : {}\n\t\t\t\t\t} };\n\t\t\t\t} },\n\t\t\t\tupdate: { async before(user, context) {\n\t\t\t\t\tconst username$1 = \"username\" in user ? user.username : null;\n\t\t\t\t\tconst displayUsername = \"displayUsername\" in user ? user.displayUsername : null;\n\t\t\t\t\treturn { data: {\n\t\t\t\t\t\t...user,\n\t\t\t\t\t\t...username$1 ? { username: normalizer(username$1) } : {},\n\t\t\t\t\t\t...displayUsername ? { displayUsername: displayUsernameNormalizer(displayUsername) } : {}\n\t\t\t\t\t} };\n\t\t\t\t} }\n\t\t\t} } } };\n\t\t},\n\t\tendpoints: {\n\t\t\tsignInUsername: createAuthEndpoint(\"/sign-in/username\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tusername: z.string().meta({ description: \"The username of the user\" }),\n\t\t\t\t\tpassword: z.string().meta({ description: \"The password of the user\" }),\n\t\t\t\t\trememberMe: z.boolean().meta({ description: \"Remember the user session\" }).optional(),\n\t\t\t\t\tcallbackURL: z.string().meta({ description: \"The URL to redirect to after email verification\" }).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Sign in with username\",\n\t\t\t\t\tdescription: \"Sign in with username\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"Session token for the authenticated session\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" }\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\trequired: [\"token\", \"user\"]\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t},\n\t\t\t\t\t\t422: {\n\t\t\t\t\t\t\tdescription: \"Unprocessable Entity. Validation error\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: { message: { type: \"string\" } }\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!ctx.body.username || !ctx.body.password) {\n\t\t\t\t\tctx.context.logger.error(\"Username or password not found\");\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: USERNAME_ERROR_CODES.INVALID_USERNAME_OR_PASSWORD });\n\t\t\t\t}\n\t\t\t\tconst username$1 = options?.validationOrder?.username === \"pre-normalization\" ? normalizer(ctx.body.username) : ctx.body.username;\n\t\t\t\tconst minUsernameLength = options?.minUsernameLength || 3;\n\t\t\t\tconst maxUsernameLength = options?.maxUsernameLength || 30;\n\t\t\t\tif (username$1.length < minUsernameLength) {\n\t\t\t\t\tctx.context.logger.error(\"Username too short\", { username: username$1 });\n\t\t\t\t\tthrow new APIError(\"UNPROCESSABLE_ENTITY\", {\n\t\t\t\t\t\tcode: \"USERNAME_TOO_SHORT\",\n\t\t\t\t\t\tmessage: USERNAME_ERROR_CODES.USERNAME_TOO_SHORT\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (username$1.length > maxUsernameLength) {\n\t\t\t\t\tctx.context.logger.error(\"Username too long\", { username: username$1 });\n\t\t\t\t\tthrow new APIError(\"UNPROCESSABLE_ENTITY\", { message: USERNAME_ERROR_CODES.USERNAME_TOO_LONG });\n\t\t\t\t}\n\t\t\t\tif (!(options?.usernameValidator || defaultUsernameValidator)(username$1)) throw new APIError(\"UNPROCESSABLE_ENTITY\", { message: USERNAME_ERROR_CODES.INVALID_USERNAME });\n\t\t\t\tconst user = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"username\",\n\t\t\t\t\t\tvalue: normalizer(username$1)\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!user) {\n\t\t\t\t\tawait ctx.context.password.hash(ctx.body.password);\n\t\t\t\t\tctx.context.logger.error(\"User not found\", { username: username$1 });\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: USERNAME_ERROR_CODES.INVALID_USERNAME_OR_PASSWORD });\n\t\t\t\t}\n\t\t\t\tconst account = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"account\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id\n\t\t\t\t\t}, {\n\t\t\t\t\t\tfield: \"providerId\",\n\t\t\t\t\t\tvalue: \"credential\"\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!account) throw new APIError(\"UNAUTHORIZED\", { message: USERNAME_ERROR_CODES.INVALID_USERNAME_OR_PASSWORD });\n\t\t\t\tconst currentPassword = account?.password;\n\t\t\t\tif (!currentPassword) {\n\t\t\t\t\tctx.context.logger.error(\"Password not found\", { username: username$1 });\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: USERNAME_ERROR_CODES.INVALID_USERNAME_OR_PASSWORD });\n\t\t\t\t}\n\t\t\t\tif (!await ctx.context.password.verify({\n\t\t\t\t\thash: currentPassword,\n\t\t\t\t\tpassword: ctx.body.password\n\t\t\t\t})) {\n\t\t\t\t\tctx.context.logger.error(\"Invalid password\");\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: USERNAME_ERROR_CODES.INVALID_USERNAME_OR_PASSWORD });\n\t\t\t\t}\n\t\t\t\tif (ctx.context.options?.emailAndPassword?.requireEmailVerification && !user.emailVerified) {\n\t\t\t\t\tif (!ctx.context.options?.emailVerification?.sendVerificationEmail) throw new APIError(\"FORBIDDEN\", { message: USERNAME_ERROR_CODES.EMAIL_NOT_VERIFIED });\n\t\t\t\t\tif (ctx.context.options?.emailVerification?.sendOnSignIn) {\n\t\t\t\t\t\tconst token = await createEmailVerificationToken(ctx.context.secret, user.email, void 0, ctx.context.options.emailVerification?.expiresIn);\n\t\t\t\t\t\tconst url = `${ctx.context.baseURL}/verify-email?token=${token}&callbackURL=${ctx.body.callbackURL || \"/\"}`;\n\t\t\t\t\t\tawait ctx.context.options.emailVerification.sendVerificationEmail({\n\t\t\t\t\t\t\tuser,\n\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t\ttoken\n\t\t\t\t\t\t}, ctx.request);\n\t\t\t\t\t}\n\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", { message: USERNAME_ERROR_CODES.EMAIL_NOT_VERIFIED });\n\t\t\t\t}\n\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(user.id, ctx.body.rememberMe === false);\n\t\t\t\tif (!session) return ctx.json(null, {\n\t\t\t\t\tstatus: 500,\n\t\t\t\t\tbody: { message: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION }\n\t\t\t\t});\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser\n\t\t\t\t}, ctx.body.rememberMe === false);\n\t\t\t\treturn ctx.json({\n\t\t\t\t\ttoken: session.token,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\temailVerified: user.emailVerified,\n\t\t\t\t\t\tusername: user.username,\n\t\t\t\t\t\tdisplayUsername: user.displayUsername,\n\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\timage: user.image,\n\t\t\t\t\t\tcreatedAt: user.createdAt,\n\t\t\t\t\t\tupdatedAt: user.updatedAt\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}),\n\t\t\tisUsernameAvailable: createAuthEndpoint(\"/is-username-available\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ username: z.string().meta({ description: \"The username to check\" }) })\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst username$1 = ctx.body.username;\n\t\t\t\tif (!username$1) throw new APIError(\"UNPROCESSABLE_ENTITY\", { message: USERNAME_ERROR_CODES.INVALID_USERNAME });\n\t\t\t\tconst minUsernameLength = options?.minUsernameLength || 3;\n\t\t\t\tconst maxUsernameLength = options?.maxUsernameLength || 30;\n\t\t\t\tif (username$1.length < minUsernameLength) throw new APIError(\"UNPROCESSABLE_ENTITY\", {\n\t\t\t\t\tcode: \"USERNAME_TOO_SHORT\",\n\t\t\t\t\tmessage: USERNAME_ERROR_CODES.USERNAME_TOO_SHORT\n\t\t\t\t});\n\t\t\t\tif (username$1.length > maxUsernameLength) throw new APIError(\"UNPROCESSABLE_ENTITY\", { message: USERNAME_ERROR_CODES.USERNAME_TOO_LONG });\n\t\t\t\tif (!await (options?.usernameValidator || defaultUsernameValidator)(username$1)) throw new APIError(\"UNPROCESSABLE_ENTITY\", { message: USERNAME_ERROR_CODES.INVALID_USERNAME });\n\t\t\t\tif (await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"username\",\n\t\t\t\t\t\tvalue: normalizer(username$1)\n\t\t\t\t\t}]\n\t\t\t\t})) return ctx.json({ available: false });\n\t\t\t\treturn ctx.json({ available: true });\n\t\t\t})\n\t\t},\n\t\tschema: mergeSchema(getSchema({\n\t\t\tusername: normalizer,\n\t\t\tdisplayUsername: displayUsernameNormalizer\n\t\t}), options?.schema),\n\t\thooks: { before: [{\n\t\t\tmatcher(context) {\n\t\t\t\treturn context.path === \"/sign-up/email\" || context.path === \"/update-user\";\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst username$1 = typeof ctx.body.username === \"string\" && options?.validationOrder?.username === \"post-normalization\" ? normalizer(ctx.body.username) : ctx.body.username;\n\t\t\t\tif (username$1 !== void 0 && typeof username$1 === \"string\") {\n\t\t\t\t\tconst minUsernameLength = options?.minUsernameLength || 3;\n\t\t\t\t\tconst maxUsernameLength = options?.maxUsernameLength || 30;\n\t\t\t\t\tif (username$1.length < minUsernameLength) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tcode: \"USERNAME_TOO_SHORT\",\n\t\t\t\t\t\tmessage: USERNAME_ERROR_CODES.USERNAME_TOO_SHORT\n\t\t\t\t\t});\n\t\t\t\t\tif (username$1.length > maxUsernameLength) throw new APIError(\"BAD_REQUEST\", { message: USERNAME_ERROR_CODES.USERNAME_TOO_LONG });\n\t\t\t\t\tif (!await (options?.usernameValidator || defaultUsernameValidator)(username$1)) throw new APIError(\"BAD_REQUEST\", { message: USERNAME_ERROR_CODES.INVALID_USERNAME });\n\t\t\t\t\tconst user = await ctx.context.adapter.findOne({\n\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"username\",\n\t\t\t\t\t\t\tvalue: username$1\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t\tconst blockChangeSignUp = ctx.path === \"/sign-up/email\" && user;\n\t\t\t\t\tconst blockChangeUpdateUser = ctx.path === \"/update-user\" && user && ctx.context.session && user.id !== ctx.context.session.session.userId;\n\t\t\t\t\tif (blockChangeSignUp || blockChangeUpdateUser) throw new APIError(\"BAD_REQUEST\", { message: USERNAME_ERROR_CODES.USERNAME_IS_ALREADY_TAKEN });\n\t\t\t\t}\n\t\t\t\tconst displayUsername = typeof ctx.body.displayUsername === \"string\" && options?.validationOrder?.displayUsername === \"post-normalization\" ? displayUsernameNormalizer(ctx.body.displayUsername) : ctx.body.displayUsername;\n\t\t\t\tif (displayUsername !== void 0 && typeof displayUsername === \"string\") {\n\t\t\t\t\tif (options?.displayUsernameValidator) {\n\t\t\t\t\t\tif (!await options.displayUsernameValidator(displayUsername)) throw new APIError(\"BAD_REQUEST\", { message: USERNAME_ERROR_CODES.INVALID_DISPLAY_USERNAME });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}, {\n\t\t\tmatcher(context) {\n\t\t\t\treturn context.path === \"/sign-up/email\" || context.path === \"/update-user\";\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tif (ctx.body.username && !ctx.body.displayUsername) ctx.body.displayUsername = ctx.body.username;\n\t\t\t\tif (ctx.body.displayUsername && !ctx.body.username) ctx.body.username = ctx.body.displayUsername;\n\t\t\t})\n\t\t}] },\n\t\t$ERROR_CODES: USERNAME_ERROR_CODES\n\t};\n};\n\n//#endregion\nexport { USERNAME_ERROR_CODES as n, username as t };"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 16589, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/plugins/index.mjs"],"sourcesContent":["import \"../dialect-D9ZUZA4J.mjs\";\nimport \"../get-model-name-D4DUV7S2.mjs\";\nimport \"../get-migration-Bf0TuCzm.mjs\";\nimport { n as HIDE_METADATA } from \"../utils-db7gNqd-.mjs\";\nimport \"../crypto-CFUhAR9W.mjs\";\nimport \"../misc-BwNc0MKr.mjs\";\nimport \"../schema-Bb7wzeK_.mjs\";\nimport \"../get-request-ip-D6st-mto.mjs\";\nimport \"../json-CnHxKYpj.mjs\";\nimport \"../url-CB8xCwz-.mjs\";\nimport \"../api-CkmycQ2x.mjs\";\nimport \"../cookies-D72PbWdz.mjs\";\nimport \"../session-AaRl3_x-.mjs\";\nimport \"../password-BFQK0cLg.mjs\";\nimport \"../parser-pHp5yoAv.mjs\";\nimport { n as role, t as createAccessControl } from \"../access-Dx8TLKnw.mjs\";\nimport \"../access-h-uttVNZ.mjs\";\nimport \"../has-permission-qCjQqGds.mjs\";\nimport \"../access-vPNO48H4.mjs\";\nimport \"../permission-JwliMugl.mjs\";\nimport { t as twoFactorClient } from \"../client-CMPEe5-e.mjs\";\nimport \"../plugin-helper-zFdFWLgL.mjs\";\nimport { t as admin } from \"../admin-D-OMdNIc.mjs\";\nimport { t as anonymous } from \"../anonymous-DxoIOUPc.mjs\";\nimport { a as getMCPProviderMetadata, c as oAuthProtectedResourceMetadata, d as API_KEY_TABLE_NAME, f as ERROR_CODES, i as getMCPProtectedResourceMetadata, l as withMcpAuth, m as defaultKeyHasher, n as createAuthMiddleware, o as mcp, p as apiKey, r as optionsMiddleware, s as oAuthDiscoveryMetadata, t as createAuthEndpoint, u as lastLoginMethod } from \"../plugins-DgSTpOzm.mjs\";\nimport { t as bearer } from \"../bearer-C6RSCXv_.mjs\";\nimport { t as captcha } from \"../captcha-Dbvurc2Z.mjs\";\nimport { t as customSession } from \"../custom-session-CaUbM_of.mjs\";\nimport { n as deviceAuthorizationOptionsSchema, t as deviceAuthorization } from \"../device-authorization-9_f1Up5D.mjs\";\nimport { t as emailOTP } from \"../email-otp-CiznqFUN.mjs\";\nimport { a as line, c as auth0, i as microsoftEntraId, n as slack, o as keycloak, r as okta, s as hubspot, t as genericOAuth } from \"../generic-oauth-BGbWWUh9.mjs\";\nimport { t as haveIBeenPwned } from \"../haveibeenpwned-BSsFUFTi.mjs\";\nimport { a as generateExportedKeyPair, i as createJwk, n as verifyJWT, r as getJwtToken, t as jwt } from \"../jwt-Ar1sciI2.mjs\";\nimport { t as magicLink } from \"../magic-link-QdHvtdfs.mjs\";\nimport { n as getMetadata, r as oidcProvider, t as getClient } from \"../oidc-provider-B9SsN23J.mjs\";\nimport { t as multiSession } from \"../multi-session-CbEYz_wJ.mjs\";\nimport { t as oAuthProxy } from \"../oauth-proxy-Dz1E1SVN.mjs\";\nimport { t as oneTap } from \"../one-tap-Bz8Q39Od.mjs\";\nimport { t as oneTimeToken } from \"../one-time-token-C8YQxf38.mjs\";\nimport { t as openAPI } from \"../open-api-DZG02vyi.mjs\";\nimport { n as parseRoles, t as organization } from \"../organization-BdJSRNgM.mjs\";\nimport { t as phoneNumber } from \"../phone-number-wU9XYnr8.mjs\";\nimport { t as siwe } from \"../siwe-D81Y4fkp.mjs\";\nimport { n as TWO_FACTOR_ERROR_CODES, t as twoFactor } from \"../two-factor-BDQvVILL.mjs\";\nimport { n as USERNAME_ERROR_CODES, t as username } from \"../username-C_wmkXwt.mjs\";\n\nexport { API_KEY_TABLE_NAME, ERROR_CODES, HIDE_METADATA, TWO_FACTOR_ERROR_CODES, USERNAME_ERROR_CODES, admin, anonymous, apiKey, auth0, bearer, captcha, createAccessControl, createAuthEndpoint, createAuthMiddleware, createJwk, customSession, defaultKeyHasher, deviceAuthorization, deviceAuthorizationOptionsSchema, emailOTP, generateExportedKeyPair, genericOAuth, getClient, getJwtToken, getMCPProtectedResourceMetadata, getMCPProviderMetadata, getMetadata, haveIBeenPwned, hubspot, jwt, keycloak, lastLoginMethod, line, magicLink, mcp, microsoftEntraId, multiSession, oAuthDiscoveryMetadata, oAuthProtectedResourceMetadata, oAuthProxy, oidcProvider, okta, oneTap, oneTimeToken, openAPI, optionsMiddleware, organization, parseRoles, phoneNumber, role, siwe, slack, twoFactor, twoFactorClient, username, verifyJWT, withMcpAuth };"],"names":[],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","ignoreList":[0]}},
    {"offset": {"line": 16697, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/integrations/next-js.mjs"],"sourcesContent":["import \"../crypto-CFUhAR9W.mjs\";\nimport \"../schema-Bb7wzeK_.mjs\";\nimport \"../json-CnHxKYpj.mjs\";\nimport \"../url-CB8xCwz-.mjs\";\nimport { l as parseSetCookieHeader } from \"../cookies-D72PbWdz.mjs\";\nimport { createAuthMiddleware } from \"@better-auth/core/api\";\n\n//#region src/integrations/next-js.ts\nfunction toNextJsHandler(auth) {\n\tconst handler = async (request) => {\n\t\treturn \"handler\" in auth ? auth.handler(request) : auth(request);\n\t};\n\treturn {\n\t\tGET: handler,\n\t\tPOST: handler,\n\t\tPATCH: handler,\n\t\tPUT: handler,\n\t\tDELETE: handler\n\t};\n}\nconst nextCookies = () => {\n\treturn {\n\t\tid: \"next-cookies\",\n\t\thooks: { after: [{\n\t\t\tmatcher(ctx) {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst returned = ctx.context.responseHeaders;\n\t\t\t\tif (\"_flag\" in ctx && ctx._flag === \"router\") return;\n\t\t\t\tif (returned instanceof Headers) {\n\t\t\t\t\tconst setCookies = returned?.get(\"set-cookie\");\n\t\t\t\t\tif (!setCookies) return;\n\t\t\t\t\tconst parsed = parseSetCookieHeader(setCookies);\n\t\t\t\t\tconst { cookies } = await import(\"next/headers\");\n\t\t\t\t\tlet cookieHelper;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tcookieHelper = await cookies();\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tif (error instanceof Error && error.message.startsWith(\"`cookies` was called outside a request scope.\")) return;\n\t\t\t\t\t\tthrow error;\n\t\t\t\t\t}\n\t\t\t\t\tparsed.forEach((value, key) => {\n\t\t\t\t\t\tif (!key) return;\n\t\t\t\t\t\tconst opts = {\n\t\t\t\t\t\t\tsameSite: value.samesite,\n\t\t\t\t\t\t\tsecure: value.secure,\n\t\t\t\t\t\t\tmaxAge: value[\"max-age\"],\n\t\t\t\t\t\t\thttpOnly: value.httponly,\n\t\t\t\t\t\t\tdomain: value.domain,\n\t\t\t\t\t\t\tpath: value.path\n\t\t\t\t\t\t};\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcookieHelper.set(key, decodeURIComponent(value.value), opts);\n\t\t\t\t\t\t} catch (e) {}\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t})\n\t\t}] }\n\t};\n};\n\n//#endregion\nexport { nextCookies, toNextJsHandler };"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAEA,qCAAqC;AACrC,SAAS,gBAAgB,IAAI;IAC5B,MAAM,UAAU,OAAO;QACtB,OAAO,aAAa,OAAO,KAAK,OAAO,CAAC,WAAW,KAAK;IACzD;IACA,OAAO;QACN,KAAK;QACL,MAAM;QACN,OAAO;QACP,KAAK;QACL,QAAQ;IACT;AACD;AACA,MAAM,cAAc;IACnB,OAAO;QACN,IAAI;QACJ,OAAO;YAAE,OAAO;gBAAC;oBAChB,SAAQ,GAAG;wBACV,OAAO;oBACR;oBACA,SAAS,IAAA,2LAAoB,EAAC,OAAO;wBACpC,MAAM,WAAW,IAAI,OAAO,CAAC,eAAe;wBAC5C,IAAI,WAAW,OAAO,IAAI,KAAK,KAAK,UAAU;wBAC9C,IAAI,oBAAoB,SAAS;4BAChC,MAAM,aAAa,UAAU,IAAI;4BACjC,IAAI,CAAC,YAAY;4BACjB,MAAM,SAAS,IAAA,qKAAoB,EAAC;4BACpC,MAAM,EAAE,OAAO,EAAE,GAAG;4BACpB,IAAI;4BACJ,IAAI;gCACH,eAAe,MAAM;4BACtB,EAAE,OAAO,OAAO;gCACf,IAAI,iBAAiB,SAAS,MAAM,OAAO,CAAC,UAAU,CAAC,kDAAkD;gCACzG,MAAM;4BACP;4BACA,OAAO,OAAO,CAAC,CAAC,OAAO;gCACtB,IAAI,CAAC,KAAK;gCACV,MAAM,OAAO;oCACZ,UAAU,MAAM,QAAQ;oCACxB,QAAQ,MAAM,MAAM;oCACpB,QAAQ,KAAK,CAAC,UAAU;oCACxB,UAAU,MAAM,QAAQ;oCACxB,QAAQ,MAAM,MAAM;oCACpB,MAAM,MAAM,IAAI;gCACjB;gCACA,IAAI;oCACH,aAAa,GAAG,CAAC,KAAK,mBAAmB,MAAM,KAAK,GAAG;gCACxD,EAAE,OAAO,GAAG,CAAC;4BACd;4BACA;wBACD;oBACD;gBACD;aAAE;QAAC;IACJ;AACD","ignoreList":[0]}}]
}