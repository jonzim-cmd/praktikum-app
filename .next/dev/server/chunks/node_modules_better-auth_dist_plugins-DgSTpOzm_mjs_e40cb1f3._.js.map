{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/jz/Projekte/Schule/praktikum-app/node_modules/better-auth/dist/plugins-DgSTpOzm.mjs"],"sourcesContent":["import { n as HIDE_METADATA, t as generateId } from \"./utils-db7gNqd-.mjs\";\nimport { r as generateRandomString } from \"./crypto-CFUhAR9W.mjs\";\nimport { t as mergeSchema, u as getDate } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as getIp } from \"./get-request-ip-D6st-mto.mjs\";\nimport { t as safeJSONParse } from \"./json-CnHxKYpj.mjs\";\nimport { t as getBaseURL } from \"./url-CB8xCwz-.mjs\";\nimport { t as APIError$1 } from \"./api-CkmycQ2x.mjs\";\nimport { l as parseSetCookieHeader } from \"./cookies-D72PbWdz.mjs\";\nimport { r as getSessionFromCtx, u as sessionMiddleware } from \"./session-AaRl3_x-.mjs\";\nimport { n as parser_default } from \"./parser-pHp5yoAv.mjs\";\nimport { n as role } from \"./access-Dx8TLKnw.mjs\";\nimport { a as parsePrompt, i as schema, r as oidcProvider } from \"./oidc-provider-B9SsN23J.mjs\";\nimport { isProduction, logger } from \"@better-auth/core/env\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport { SignJWT } from \"jose\";\nimport { createAuthEndpoint, createAuthEndpoint as createAuthEndpoint$1, createAuthMiddleware, createAuthMiddleware as createAuthMiddleware$1, optionsMiddleware } from \"@better-auth/core/api\";\nimport { base64, base64Url } from \"@better-auth/utils/base64\";\nimport { getWebcryptoSubtle } from \"@better-auth/utils\";\n\n//#region src/plugins/api-key/adapter.ts\n/**\n* Generate storage key for API key by hashed key\n*/\nfunction getStorageKeyByHashedKey(hashedKey) {\n\treturn `api-key:${hashedKey}`;\n}\n/**\n* Generate storage key for API key by ID\n*/\nfunction getStorageKeyById(id) {\n\treturn `api-key:by-id:${id}`;\n}\n/**\n* Generate storage key for user's API key list\n*/\nfunction getStorageKeyByUserId(userId) {\n\treturn `api-key:by-user:${userId}`;\n}\n/**\n* Serialize API key for storage\n*/\nfunction serializeApiKey(apiKey$1) {\n\treturn JSON.stringify({\n\t\t...apiKey$1,\n\t\tcreatedAt: apiKey$1.createdAt.toISOString(),\n\t\tupdatedAt: apiKey$1.updatedAt.toISOString(),\n\t\texpiresAt: apiKey$1.expiresAt?.toISOString() ?? null,\n\t\tlastRefillAt: apiKey$1.lastRefillAt?.toISOString() ?? null,\n\t\tlastRequest: apiKey$1.lastRequest?.toISOString() ?? null\n\t});\n}\n/**\n* Deserialize API key from storage\n*/\nfunction deserializeApiKey(data) {\n\tif (!data || typeof data !== \"string\") return null;\n\ttry {\n\t\tconst parsed = JSON.parse(data);\n\t\treturn {\n\t\t\t...parsed,\n\t\t\tcreatedAt: new Date(parsed.createdAt),\n\t\t\tupdatedAt: new Date(parsed.updatedAt),\n\t\t\texpiresAt: parsed.expiresAt ? new Date(parsed.expiresAt) : null,\n\t\t\tlastRefillAt: parsed.lastRefillAt ? new Date(parsed.lastRefillAt) : null,\n\t\t\tlastRequest: parsed.lastRequest ? new Date(parsed.lastRequest) : null\n\t\t};\n\t} catch {\n\t\treturn null;\n\t}\n}\n/**\n* Get the storage instance to use (custom methods take precedence)\n*/\nfunction getStorageInstance(ctx, opts) {\n\tif (opts.customStorage) return opts.customStorage;\n\treturn ctx.context.secondaryStorage || null;\n}\n/**\n* Calculate TTL in seconds for an API key\n*/\nfunction calculateTTL(apiKey$1) {\n\tif (apiKey$1.expiresAt) {\n\t\tconst now = Date.now();\n\t\tconst expiresAt = new Date(apiKey$1.expiresAt).getTime();\n\t\tconst ttlSeconds = Math.floor((expiresAt - now) / 1e3);\n\t\tif (ttlSeconds > 0) return ttlSeconds;\n\t}\n}\n/**\n* Get API key from secondary storage by hashed key\n*/\nasync function getApiKeyFromStorage(ctx, hashedKey, storage) {\n\tconst key = getStorageKeyByHashedKey(hashedKey);\n\treturn deserializeApiKey(await storage.get(key));\n}\n/**\n* Get API key from secondary storage by ID\n*/\nasync function getApiKeyByIdFromStorage(ctx, id, storage) {\n\tconst key = getStorageKeyById(id);\n\treturn deserializeApiKey(await storage.get(key));\n}\n/**\n* Store API key in secondary storage\n*/\nasync function setApiKeyInStorage(ctx, apiKey$1, storage, ttl) {\n\tconst serialized = serializeApiKey(apiKey$1);\n\tconst hashedKey = apiKey$1.key;\n\tconst id = apiKey$1.id;\n\tawait storage.set(getStorageKeyByHashedKey(hashedKey), serialized, ttl);\n\tawait storage.set(getStorageKeyById(id), serialized, ttl);\n\tconst userKey = getStorageKeyByUserId(apiKey$1.userId);\n\tconst userListData = await storage.get(userKey);\n\tlet userIds = [];\n\tif (userListData && typeof userListData === \"string\") try {\n\t\tuserIds = JSON.parse(userListData);\n\t} catch {\n\t\tuserIds = [];\n\t}\n\telse if (Array.isArray(userListData)) userIds = userListData;\n\tif (!userIds.includes(id)) {\n\t\tuserIds.push(id);\n\t\tawait storage.set(userKey, JSON.stringify(userIds));\n\t}\n}\n/**\n* Delete API key from secondary storage\n*/\nasync function deleteApiKeyFromStorage(ctx, apiKey$1, storage) {\n\tconst hashedKey = apiKey$1.key;\n\tconst id = apiKey$1.id;\n\tconst userId = apiKey$1.userId;\n\tawait storage.delete(getStorageKeyByHashedKey(hashedKey));\n\tawait storage.delete(getStorageKeyById(id));\n\tconst userKey = getStorageKeyByUserId(userId);\n\tconst userListData = await storage.get(userKey);\n\tlet userIds = [];\n\tif (userListData && typeof userListData === \"string\") try {\n\t\tuserIds = JSON.parse(userListData);\n\t} catch {\n\t\tuserIds = [];\n\t}\n\telse if (Array.isArray(userListData)) userIds = userListData;\n\tconst filteredIds = userIds.filter((keyId) => keyId !== id);\n\tif (filteredIds.length === 0) await storage.delete(userKey);\n\telse await storage.set(userKey, JSON.stringify(filteredIds));\n}\n/**\n* Unified getter for API keys with support for all storage modes\n*/\nasync function getApiKey$1(ctx, hashedKey, opts) {\n\tconst storage = getStorageInstance(ctx, opts);\n\tif (opts.storage === \"database\") return await ctx.context.adapter.findOne({\n\t\tmodel: \"apikey\",\n\t\twhere: [{\n\t\t\tfield: \"key\",\n\t\t\tvalue: hashedKey\n\t\t}]\n\t});\n\tif (opts.storage === \"secondary-storage\" && opts.fallbackToDatabase) {\n\t\tif (storage) {\n\t\t\tconst cached = await getApiKeyFromStorage(ctx, hashedKey, storage);\n\t\t\tif (cached) return cached;\n\t\t}\n\t\tconst dbKey = await ctx.context.adapter.findOne({\n\t\t\tmodel: \"apikey\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"key\",\n\t\t\t\tvalue: hashedKey\n\t\t\t}]\n\t\t});\n\t\tif (dbKey && storage) await setApiKeyInStorage(ctx, dbKey, storage, calculateTTL(dbKey));\n\t\treturn dbKey;\n\t}\n\tif (opts.storage === \"secondary-storage\") {\n\t\tif (!storage) return null;\n\t\treturn await getApiKeyFromStorage(ctx, hashedKey, storage);\n\t}\n\treturn await ctx.context.adapter.findOne({\n\t\tmodel: \"apikey\",\n\t\twhere: [{\n\t\t\tfield: \"key\",\n\t\t\tvalue: hashedKey\n\t\t}]\n\t});\n}\n/**\n* Unified getter for API keys by ID\n*/\nasync function getApiKeyById(ctx, id, opts) {\n\tconst storage = getStorageInstance(ctx, opts);\n\tif (opts.storage === \"database\") return await ctx.context.adapter.findOne({\n\t\tmodel: \"apikey\",\n\t\twhere: [{\n\t\t\tfield: \"id\",\n\t\t\tvalue: id\n\t\t}]\n\t});\n\tif (opts.storage === \"secondary-storage\" && opts.fallbackToDatabase) {\n\t\tif (storage) {\n\t\t\tconst cached = await getApiKeyByIdFromStorage(ctx, id, storage);\n\t\t\tif (cached) return cached;\n\t\t}\n\t\tconst dbKey = await ctx.context.adapter.findOne({\n\t\t\tmodel: \"apikey\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"id\",\n\t\t\t\tvalue: id\n\t\t\t}]\n\t\t});\n\t\tif (dbKey && storage) await setApiKeyInStorage(ctx, dbKey, storage, calculateTTL(dbKey));\n\t\treturn dbKey;\n\t}\n\tif (opts.storage === \"secondary-storage\") {\n\t\tif (!storage) return null;\n\t\treturn await getApiKeyByIdFromStorage(ctx, id, storage);\n\t}\n\treturn await ctx.context.adapter.findOne({\n\t\tmodel: \"apikey\",\n\t\twhere: [{\n\t\t\tfield: \"id\",\n\t\t\tvalue: id\n\t\t}]\n\t});\n}\n/**\n* Unified setter for API keys with support for all storage modes\n*/\nasync function setApiKey(ctx, apiKey$1, opts) {\n\tconst storage = getStorageInstance(ctx, opts);\n\tconst ttl = calculateTTL(apiKey$1);\n\tif (opts.storage === \"database\") return;\n\tif (opts.storage === \"secondary-storage\") {\n\t\tif (!storage) throw new Error(\"Secondary storage is required when storage mode is 'secondary-storage'\");\n\t\tawait setApiKeyInStorage(ctx, apiKey$1, storage, ttl);\n\t\treturn;\n\t}\n}\n/**\n* Unified deleter for API keys with support for all storage modes\n*/\nasync function deleteApiKey$1(ctx, apiKey$1, opts) {\n\tconst storage = getStorageInstance(ctx, opts);\n\tif (opts.storage === \"database\") return;\n\tif (opts.storage === \"secondary-storage\") {\n\t\tif (!storage) throw new Error(\"Secondary storage is required when storage mode is 'secondary-storage'\");\n\t\tawait deleteApiKeyFromStorage(ctx, apiKey$1, storage);\n\t\treturn;\n\t}\n}\n/**\n* List API keys for a user with support for all storage modes\n*/\nasync function listApiKeys$1(ctx, userId, opts) {\n\tconst storage = getStorageInstance(ctx, opts);\n\tif (opts.storage === \"database\") return await ctx.context.adapter.findMany({\n\t\tmodel: \"apikey\",\n\t\twhere: [{\n\t\t\tfield: \"userId\",\n\t\t\tvalue: userId\n\t\t}]\n\t});\n\tif (opts.storage === \"secondary-storage\" && opts.fallbackToDatabase) {\n\t\tconst userKey = getStorageKeyByUserId(userId);\n\t\tif (storage) {\n\t\t\tconst userListData = await storage.get(userKey);\n\t\t\tlet userIds = [];\n\t\t\tif (userListData && typeof userListData === \"string\") try {\n\t\t\t\tuserIds = JSON.parse(userListData);\n\t\t\t} catch {\n\t\t\t\tuserIds = [];\n\t\t\t}\n\t\t\telse if (Array.isArray(userListData)) userIds = userListData;\n\t\t\tif (userIds.length > 0) {\n\t\t\t\tconst apiKeys = [];\n\t\t\t\tfor (const id of userIds) {\n\t\t\t\t\tconst apiKey$1 = await getApiKeyByIdFromStorage(ctx, id, storage);\n\t\t\t\t\tif (apiKey$1) apiKeys.push(apiKey$1);\n\t\t\t\t}\n\t\t\t\treturn apiKeys;\n\t\t\t}\n\t\t}\n\t\tconst dbKeys = await ctx.context.adapter.findMany({\n\t\t\tmodel: \"apikey\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"userId\",\n\t\t\t\tvalue: userId\n\t\t\t}]\n\t\t});\n\t\tif (storage && dbKeys.length > 0) {\n\t\t\tconst userIds = [];\n\t\t\tfor (const apiKey$1 of dbKeys) {\n\t\t\t\tawait setApiKeyInStorage(ctx, apiKey$1, storage, calculateTTL(apiKey$1));\n\t\t\t\tuserIds.push(apiKey$1.id);\n\t\t\t}\n\t\t\tawait storage.set(userKey, JSON.stringify(userIds));\n\t\t}\n\t\treturn dbKeys;\n\t}\n\tif (opts.storage === \"secondary-storage\") {\n\t\tif (!storage) return [];\n\t\tconst userKey = getStorageKeyByUserId(userId);\n\t\tconst userListData = await storage.get(userKey);\n\t\tlet userIds = [];\n\t\tif (userListData && typeof userListData === \"string\") try {\n\t\t\tuserIds = JSON.parse(userListData);\n\t\t} catch {\n\t\t\treturn [];\n\t\t}\n\t\telse if (Array.isArray(userListData)) userIds = userListData;\n\t\telse return [];\n\t\tconst apiKeys = [];\n\t\tfor (const id of userIds) {\n\t\t\tconst apiKey$1 = await getApiKeyByIdFromStorage(ctx, id, storage);\n\t\t\tif (apiKey$1) apiKeys.push(apiKey$1);\n\t\t}\n\t\treturn apiKeys;\n\t}\n\treturn await ctx.context.adapter.findMany({\n\t\tmodel: \"apikey\",\n\t\twhere: [{\n\t\t\tfield: \"userId\",\n\t\t\tvalue: userId\n\t\t}]\n\t});\n}\n\n//#endregion\n//#region src/plugins/api-key/routes/create-api-key.ts\nfunction createApiKey({ keyGenerator, opts, schema: schema$1, deleteAllExpiredApiKeys: deleteAllExpiredApiKeys$1 }) {\n\treturn createAuthEndpoint(\"/api-key/create\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({\n\t\t\tname: z.string().meta({ description: \"Name of the Api Key\" }).optional(),\n\t\t\texpiresIn: z.number().meta({ description: \"Expiration time of the Api Key in seconds\" }).min(1).optional().nullable().default(null),\n\t\t\tuserId: z.coerce.string().meta({ description: \"User Id of the user that the Api Key belongs to. server-only. Eg: \\\"user-id\\\"\" }).optional(),\n\t\t\tprefix: z.string().meta({ description: \"Prefix of the Api Key\" }).regex(/^[a-zA-Z0-9_-]+$/, { message: \"Invalid prefix format, must be alphanumeric and contain only underscores and hyphens.\" }).optional(),\n\t\t\tremaining: z.number().meta({ description: \"Remaining number of requests. Server side only\" }).min(0).optional().nullable().default(null),\n\t\t\tmetadata: z.any().optional(),\n\t\t\trefillAmount: z.number().meta({ description: \"Amount to refill the remaining count of the Api Key. server-only. Eg: 100\" }).min(1).optional(),\n\t\t\trefillInterval: z.number().meta({ description: \"Interval to refill the Api Key in milliseconds. server-only. Eg: 1000\" }).optional(),\n\t\t\trateLimitTimeWindow: z.number().meta({ description: \"The duration in milliseconds where each request is counted. Once the `maxRequests` is reached, the request will be rejected until the `timeWindow` has passed, at which point the `timeWindow` will be reset. server-only. Eg: 1000\" }).optional(),\n\t\t\trateLimitMax: z.number().meta({ description: \"Maximum amount of requests allowed within a window. Once the `maxRequests` is reached, the request will be rejected until the `timeWindow` has passed, at which point the `timeWindow` will be reset. server-only. Eg: 100\" }).optional(),\n\t\t\trateLimitEnabled: z.boolean().meta({ description: \"Whether the key has rate limiting enabled. server-only. Eg: true\" }).optional(),\n\t\t\tpermissions: z.record(z.string(), z.array(z.string())).meta({ description: \"Permissions of the Api Key.\" }).optional()\n\t\t}),\n\t\tmetadata: { openapi: {\n\t\t\tdescription: \"Create a new API key for a user\",\n\t\t\tresponses: { \"200\": {\n\t\t\t\tdescription: \"API key created successfully\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"Unique identifier of the API key\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tdescription: \"Creation timestamp\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tdescription: \"Last update timestamp\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Name of the API key\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tprefix: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Prefix of the API key\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstart: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Starting characters of the key (if configured)\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tkey: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"The full API key (only returned on creation)\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tenabled: {\n\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\tdescription: \"Whether the key is enabled\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\texpiresAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Expiration timestamp\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"ID of the user owning the key\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlastRefillAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Last refill timestamp\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlastRequest: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Last request timestamp\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\tdescription: \"Metadata associated with the key\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trateLimitMax: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Maximum requests in time window\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trateLimitTimeWindow: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Rate limit time window in milliseconds\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tremaining: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Remaining requests\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trefillAmount: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Amount to refill\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trefillInterval: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Refill interval in milliseconds\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trateLimitEnabled: {\n\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\tdescription: \"Whether rate limiting is enabled\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequestCount: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tdescription: \"Current request count in window\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tadditionalProperties: {\n\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\titems: { type: \"string\" }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdescription: \"Permissions associated with the key\"\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\trequired: [\n\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\"updatedAt\",\n\t\t\t\t\t\t\"key\",\n\t\t\t\t\t\t\"enabled\",\n\t\t\t\t\t\t\"userId\",\n\t\t\t\t\t\t\"rateLimitEnabled\",\n\t\t\t\t\t\t\"requestCount\"\n\t\t\t\t\t]\n\t\t\t\t} } }\n\t\t\t} }\n\t\t} }\n\t}, async (ctx) => {\n\t\tconst { name, expiresIn, prefix, remaining, metadata, refillAmount, refillInterval, permissions, rateLimitMax, rateLimitTimeWindow, rateLimitEnabled } = ctx.body;\n\t\tconst session = await getSessionFromCtx(ctx);\n\t\tconst authRequired = ctx.request || ctx.headers;\n\t\tconst user = authRequired && !session ? null : session?.user || { id: ctx.body.userId };\n\t\tif (!user?.id) throw new APIError$1(\"UNAUTHORIZED\", { message: ERROR_CODES.UNAUTHORIZED_SESSION });\n\t\tif (session && ctx.body.userId && session?.user.id !== ctx.body.userId) throw new APIError$1(\"UNAUTHORIZED\", { message: ERROR_CODES.UNAUTHORIZED_SESSION });\n\t\tif (authRequired) {\n\t\t\tif (refillAmount !== void 0 || refillInterval !== void 0 || rateLimitMax !== void 0 || rateLimitTimeWindow !== void 0 || rateLimitEnabled !== void 0 || permissions !== void 0 || remaining !== null) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.SERVER_ONLY_PROPERTY });\n\t\t}\n\t\tif (metadata) {\n\t\t\tif (opts.enableMetadata === false) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.METADATA_DISABLED });\n\t\t\tif (typeof metadata !== \"object\") throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_METADATA_TYPE });\n\t\t}\n\t\tif (refillAmount && !refillInterval) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.REFILL_AMOUNT_AND_INTERVAL_REQUIRED });\n\t\tif (refillInterval && !refillAmount) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.REFILL_INTERVAL_AND_AMOUNT_REQUIRED });\n\t\tif (expiresIn) {\n\t\t\tif (opts.keyExpiration.disableCustomExpiresTime === true) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.KEY_DISABLED_EXPIRATION });\n\t\t\tconst expiresIn_in_days = expiresIn / (3600 * 24);\n\t\t\tif (opts.keyExpiration.minExpiresIn > expiresIn_in_days) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.EXPIRES_IN_IS_TOO_SMALL });\n\t\t\telse if (opts.keyExpiration.maxExpiresIn < expiresIn_in_days) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.EXPIRES_IN_IS_TOO_LARGE });\n\t\t}\n\t\tif (prefix) {\n\t\t\tif (prefix.length < opts.minimumPrefixLength) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_PREFIX_LENGTH });\n\t\t\tif (prefix.length > opts.maximumPrefixLength) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_PREFIX_LENGTH });\n\t\t}\n\t\tif (name) {\n\t\t\tif (name.length < opts.minimumNameLength) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_NAME_LENGTH });\n\t\t\tif (name.length > opts.maximumNameLength) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_NAME_LENGTH });\n\t\t} else if (opts.requireName) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.NAME_REQUIRED });\n\t\tdeleteAllExpiredApiKeys$1(ctx.context);\n\t\tconst key = await keyGenerator({\n\t\t\tlength: opts.defaultKeyLength,\n\t\t\tprefix: prefix || opts.defaultPrefix\n\t\t});\n\t\tconst hashed = opts.disableKeyHashing ? key : await defaultKeyHasher(key);\n\t\tlet start = null;\n\t\tif (opts.startingCharactersConfig.shouldStore) start = key.substring(0, opts.startingCharactersConfig.charactersLength);\n\t\tconst defaultPermissions = opts.permissions?.defaultPermissions ? typeof opts.permissions.defaultPermissions === \"function\" ? await opts.permissions.defaultPermissions(user.id, ctx) : opts.permissions.defaultPermissions : void 0;\n\t\tconst permissionsToApply = permissions ? JSON.stringify(permissions) : defaultPermissions ? JSON.stringify(defaultPermissions) : void 0;\n\t\tlet data = {\n\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\tupdatedAt: /* @__PURE__ */ new Date(),\n\t\t\tname: name ?? null,\n\t\t\tprefix: prefix ?? opts.defaultPrefix ?? null,\n\t\t\tstart,\n\t\t\tkey: hashed,\n\t\t\tenabled: true,\n\t\t\texpiresAt: expiresIn ? getDate(expiresIn, \"sec\") : opts.keyExpiration.defaultExpiresIn ? getDate(opts.keyExpiration.defaultExpiresIn, \"sec\") : null,\n\t\t\tuserId: user.id,\n\t\t\tlastRefillAt: null,\n\t\t\tlastRequest: null,\n\t\t\tmetadata: null,\n\t\t\trateLimitMax: rateLimitMax ?? opts.rateLimit.maxRequests ?? null,\n\t\t\trateLimitTimeWindow: rateLimitTimeWindow ?? opts.rateLimit.timeWindow ?? null,\n\t\t\tremaining: remaining === null ? remaining : remaining ?? refillAmount ?? null,\n\t\t\trefillAmount: refillAmount ?? null,\n\t\t\trefillInterval: refillInterval ?? null,\n\t\t\trateLimitEnabled: rateLimitEnabled === void 0 ? opts.rateLimit.enabled ?? true : rateLimitEnabled,\n\t\t\trequestCount: 0,\n\t\t\tpermissions: permissionsToApply\n\t\t};\n\t\tif (metadata) data.metadata = schema$1.apikey.fields.metadata.transform.input(metadata);\n\t\tlet apiKey$1;\n\t\tif (opts.storage === \"secondary-storage\" && opts.fallbackToDatabase) {\n\t\t\tapiKey$1 = await ctx.context.adapter.create({\n\t\t\t\tmodel: API_KEY_TABLE_NAME,\n\t\t\t\tdata\n\t\t\t});\n\t\t\tawait setApiKey(ctx, apiKey$1, opts);\n\t\t} else if (opts.storage === \"secondary-storage\") {\n\t\t\tconst id = ctx.context.generateId({ model: API_KEY_TABLE_NAME }) ?? generateId();\n\t\t\tapiKey$1 = {\n\t\t\t\t...data,\n\t\t\t\tid\n\t\t\t};\n\t\t\tawait setApiKey(ctx, apiKey$1, opts);\n\t\t} else apiKey$1 = await ctx.context.adapter.create({\n\t\t\tmodel: API_KEY_TABLE_NAME,\n\t\t\tdata\n\t\t});\n\t\treturn ctx.json({\n\t\t\t...apiKey$1,\n\t\t\tkey,\n\t\t\tmetadata: metadata ?? null,\n\t\t\tpermissions: apiKey$1.permissions ? safeJSONParse(apiKey$1.permissions) : null\n\t\t});\n\t});\n}\n\n//#endregion\n//#region src/plugins/api-key/routes/delete-all-expired-api-keys.ts\nfunction deleteAllExpiredApiKeysEndpoint({ deleteAllExpiredApiKeys: deleteAllExpiredApiKeys$1 }) {\n\treturn createAuthEndpoint(\"/api-key/delete-all-expired-api-keys\", {\n\t\tmethod: \"POST\",\n\t\tmetadata: { SERVER_ONLY: true }\n\t}, async (ctx) => {\n\t\ttry {\n\t\t\tawait deleteAllExpiredApiKeys$1(ctx.context, true);\n\t\t} catch (error) {\n\t\t\tctx.context.logger.error(\"[API KEY PLUGIN] Failed to delete expired API keys:\", error);\n\t\t\treturn ctx.json({\n\t\t\t\tsuccess: false,\n\t\t\t\terror\n\t\t\t});\n\t\t}\n\t\treturn ctx.json({\n\t\t\tsuccess: true,\n\t\t\terror: null\n\t\t});\n\t});\n}\n\n//#endregion\n//#region src/plugins/api-key/routes/delete-api-key.ts\nfunction deleteApiKey({ opts, schema: schema$1, deleteAllExpiredApiKeys: deleteAllExpiredApiKeys$1 }) {\n\treturn createAuthEndpoint(\"/api-key/delete\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({ keyId: z.string().meta({ description: \"The id of the Api Key\" }) }),\n\t\tuse: [sessionMiddleware],\n\t\tmetadata: { openapi: {\n\t\t\tdescription: \"Delete an existing API key\",\n\t\t\trequestBody: { content: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { keyId: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\tdescription: \"The id of the API key to delete\"\n\t\t\t\t} },\n\t\t\t\trequired: [\"keyId\"]\n\t\t\t} } } },\n\t\t\tresponses: { \"200\": {\n\t\t\t\tdescription: \"API key deleted successfully\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: { success: {\n\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\tdescription: \"Indicates if the API key was successfully deleted\"\n\t\t\t\t\t} },\n\t\t\t\t\trequired: [\"success\"]\n\t\t\t\t} } }\n\t\t\t} }\n\t\t} }\n\t}, async (ctx) => {\n\t\tconst { keyId } = ctx.body;\n\t\tconst session = ctx.context.session;\n\t\tif (session.user.banned === true) throw new APIError$1(\"UNAUTHORIZED\", { message: ERROR_CODES.USER_BANNED });\n\t\tlet apiKey$1 = null;\n\t\tapiKey$1 = await getApiKeyById(ctx, keyId, opts);\n\t\tif (!apiKey$1 || apiKey$1.userId !== session.user.id) throw new APIError$1(\"NOT_FOUND\", { message: ERROR_CODES.KEY_NOT_FOUND });\n\t\ttry {\n\t\t\tif (opts.storage === \"secondary-storage\" && opts.fallbackToDatabase) {\n\t\t\t\tawait deleteApiKey$1(ctx, apiKey$1, opts);\n\t\t\t\tawait ctx.context.adapter.delete({\n\t\t\t\t\tmodel: API_KEY_TABLE_NAME,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: apiKey$1.id\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t} else if (opts.storage === \"database\") await ctx.context.adapter.delete({\n\t\t\t\tmodel: API_KEY_TABLE_NAME,\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: apiKey$1.id\n\t\t\t\t}]\n\t\t\t});\n\t\t\telse await deleteApiKey$1(ctx, apiKey$1, opts);\n\t\t} catch (error) {\n\t\t\tthrow new APIError$1(\"INTERNAL_SERVER_ERROR\", { message: error?.message });\n\t\t}\n\t\tdeleteAllExpiredApiKeys$1(ctx.context);\n\t\treturn ctx.json({ success: true });\n\t});\n}\n\n//#endregion\n//#region src/plugins/api-key/routes/get-api-key.ts\nfunction getApiKey({ opts, schema: schema$1, deleteAllExpiredApiKeys: deleteAllExpiredApiKeys$1 }) {\n\treturn createAuthEndpoint(\"/api-key/get\", {\n\t\tmethod: \"GET\",\n\t\tquery: z.object({ id: z.string().meta({ description: \"The id of the Api Key\" }) }),\n\t\tuse: [sessionMiddleware],\n\t\tmetadata: { openapi: {\n\t\t\tdescription: \"Retrieve an existing API key by ID\",\n\t\t\tresponses: { \"200\": {\n\t\t\t\tdescription: \"API key retrieved successfully\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"ID\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The name of the key\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstart: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Shows the first few characters of the API key, including the prefix. This allows you to show those few characters in the UI to make it easier for users to identify the API key.\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tprefix: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The API Key prefix. Stored as plain text.\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"The owner of the user id\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trefillInterval: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The interval in milliseconds between refills of the `remaining` count. Example: 3600000 // refill every hour (3600000ms = 1h)\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trefillAmount: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The amount to refill\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlastRefillAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The last refill date\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tenabled: {\n\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\tdescription: \"Sets if key is enabled or disabled\",\n\t\t\t\t\t\t\tdefault: true\n\t\t\t\t\t\t},\n\t\t\t\t\t\trateLimitEnabled: {\n\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\tdescription: \"Whether the key has rate limiting enabled\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trateLimitTimeWindow: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The duration in milliseconds\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trateLimitMax: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Maximum amount of requests allowed within a window\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequestCount: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tdescription: \"The number of requests made within the rate limit time window\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tremaining: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Remaining requests (every time api key is used this should updated and should be updated on refill as well)\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlastRequest: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"When last request occurred\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\texpiresAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Expiry date of a key\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tdescription: \"created at\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tdescription: \"updated at\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\tdescription: \"Extra metadata about the apiKey\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Permissions for the api key (stored as JSON string)\"\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\trequired: [\n\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\"userId\",\n\t\t\t\t\t\t\"enabled\",\n\t\t\t\t\t\t\"rateLimitEnabled\",\n\t\t\t\t\t\t\"requestCount\",\n\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t]\n\t\t\t\t} } }\n\t\t\t} }\n\t\t} }\n\t}, async (ctx) => {\n\t\tconst { id } = ctx.query;\n\t\tconst session = ctx.context.session;\n\t\tlet apiKey$1 = null;\n\t\tapiKey$1 = await getApiKeyById(ctx, id, opts);\n\t\tif (apiKey$1 && apiKey$1.userId !== session.user.id) apiKey$1 = null;\n\t\tif (!apiKey$1) throw new APIError$1(\"NOT_FOUND\", { message: ERROR_CODES.KEY_NOT_FOUND });\n\t\tdeleteAllExpiredApiKeys$1(ctx.context);\n\t\tapiKey$1.metadata = schema$1.apikey.fields.metadata.transform.output(apiKey$1.metadata);\n\t\tconst { key, ...returningApiKey } = apiKey$1;\n\t\treturn ctx.json({\n\t\t\t...returningApiKey,\n\t\t\tpermissions: returningApiKey.permissions ? safeJSONParse(returningApiKey.permissions) : null\n\t\t});\n\t});\n}\n\n//#endregion\n//#region src/plugins/api-key/routes/list-api-keys.ts\nfunction listApiKeys({ opts, schema: schema$1, deleteAllExpiredApiKeys: deleteAllExpiredApiKeys$1 }) {\n\treturn createAuthEndpoint(\"/api-key/list\", {\n\t\tmethod: \"GET\",\n\t\tuse: [sessionMiddleware],\n\t\tmetadata: { openapi: {\n\t\t\tdescription: \"List all API keys for the authenticated user\",\n\t\t\tresponses: { \"200\": {\n\t\t\t\tdescription: \"API keys retrieved successfully\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"array\",\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tdescription: \"ID\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"The name of the key\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tstart: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"Shows the first few characters of the API key, including the prefix. This allows you to show those few characters in the UI to make it easier for users to identify the API key.\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tprefix: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"The API Key prefix. Stored as plain text.\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tdescription: \"The owner of the user id\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trefillInterval: {\n\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"The interval in milliseconds between refills of the `remaining` count. Example: 3600000 // refill every hour (3600000ms = 1h)\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trefillAmount: {\n\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"The amount to refill\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tlastRefillAt: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"The last refill date\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tenabled: {\n\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\tdescription: \"Sets if key is enabled or disabled\",\n\t\t\t\t\t\t\t\tdefault: true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trateLimitEnabled: {\n\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\tdescription: \"Whether the key has rate limiting enabled\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trateLimitTimeWindow: {\n\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"The duration in milliseconds\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trateLimitMax: {\n\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"Maximum amount of requests allowed within a window\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequestCount: {\n\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\tdescription: \"The number of requests made within the rate limit time window\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tremaining: {\n\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"Remaining requests (every time api key is used this should updated and should be updated on refill as well)\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tlastRequest: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"When last request occurred\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\texpiresAt: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"Expiry date of a key\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\tdescription: \"created at\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\tdescription: \"updated at\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\t\tdescription: \"Extra metadata about the apiKey\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"Permissions for the api key (stored as JSON string)\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\"userId\",\n\t\t\t\t\t\t\t\"enabled\",\n\t\t\t\t\t\t\t\"rateLimitEnabled\",\n\t\t\t\t\t\t\t\"requestCount\",\n\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t} } }\n\t\t\t} }\n\t\t} }\n\t}, async (ctx) => {\n\t\tconst session = ctx.context.session;\n\t\tlet apiKeys;\n\t\tapiKeys = await listApiKeys$1(ctx, session.user.id, opts);\n\t\tdeleteAllExpiredApiKeys$1(ctx.context);\n\t\tapiKeys = apiKeys.map((apiKey$1) => {\n\t\t\treturn {\n\t\t\t\t...apiKey$1,\n\t\t\t\tmetadata: schema$1.apikey.fields.metadata.transform.output(apiKey$1.metadata)\n\t\t\t};\n\t\t});\n\t\tlet returningApiKey = apiKeys.map((x) => {\n\t\t\tconst { key, ...returningApiKey$1 } = x;\n\t\t\treturn {\n\t\t\t\t...returningApiKey$1,\n\t\t\t\tpermissions: returningApiKey$1.permissions ? safeJSONParse(returningApiKey$1.permissions) : null\n\t\t\t};\n\t\t});\n\t\treturn ctx.json(returningApiKey);\n\t});\n}\n\n//#endregion\n//#region src/plugins/api-key/routes/update-api-key.ts\nfunction updateApiKey({ opts, schema: schema$1, deleteAllExpiredApiKeys: deleteAllExpiredApiKeys$1 }) {\n\treturn createAuthEndpoint(\"/api-key/update\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({\n\t\t\tkeyId: z.string().meta({ description: \"The id of the Api Key\" }),\n\t\t\tuserId: z.coerce.string().meta({ description: \"The id of the user which the api key belongs to. server-only. Eg: \\\"some-user-id\\\"\" }).optional(),\n\t\t\tname: z.string().meta({ description: \"The name of the key\" }).optional(),\n\t\t\tenabled: z.boolean().meta({ description: \"Whether the Api Key is enabled or not\" }).optional(),\n\t\t\tremaining: z.number().meta({ description: \"The number of remaining requests\" }).min(1).optional(),\n\t\t\trefillAmount: z.number().meta({ description: \"The refill amount\" }).optional(),\n\t\t\trefillInterval: z.number().meta({ description: \"The refill interval\" }).optional(),\n\t\t\tmetadata: z.any().optional(),\n\t\t\texpiresIn: z.number().meta({ description: \"Expiration time of the Api Key in seconds\" }).min(1).optional().nullable(),\n\t\t\trateLimitEnabled: z.boolean().meta({ description: \"Whether the key has rate limiting enabled.\" }).optional(),\n\t\t\trateLimitTimeWindow: z.number().meta({ description: \"The duration in milliseconds where each request is counted. server-only. Eg: 1000\" }).optional(),\n\t\t\trateLimitMax: z.number().meta({ description: \"Maximum amount of requests allowed within a window. Once the `maxRequests` is reached, the request will be rejected until the `timeWindow` has passed, at which point the `timeWindow` will be reset. server-only. Eg: 100\" }).optional(),\n\t\t\tpermissions: z.record(z.string(), z.array(z.string())).meta({ description: \"Update the permissions on the API Key. server-only.\" }).optional().nullable()\n\t\t}),\n\t\tmetadata: { openapi: {\n\t\t\tdescription: \"Update an existing API key by ID\",\n\t\t\tresponses: { \"200\": {\n\t\t\t\tdescription: \"API key updated successfully\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"ID\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The name of the key\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstart: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Shows the first few characters of the API key, including the prefix. This allows you to show those few characters in the UI to make it easier for users to identify the API key.\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tprefix: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The API Key prefix. Stored as plain text.\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"The owner of the user id\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trefillInterval: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The interval in milliseconds between refills of the `remaining` count. Example: 3600000 // refill every hour (3600000ms = 1h)\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trefillAmount: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The amount to refill\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlastRefillAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The last refill date\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tenabled: {\n\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\tdescription: \"Sets if key is enabled or disabled\",\n\t\t\t\t\t\t\tdefault: true\n\t\t\t\t\t\t},\n\t\t\t\t\t\trateLimitEnabled: {\n\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\tdescription: \"Whether the key has rate limiting enabled\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trateLimitTimeWindow: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The duration in milliseconds\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trateLimitMax: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Maximum amount of requests allowed within a window\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequestCount: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tdescription: \"The number of requests made within the rate limit time window\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tremaining: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Remaining requests (every time api key is used this should updated and should be updated on refill as well)\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlastRequest: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"When last request occurred\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\texpiresAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Expiry date of a key\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tdescription: \"created at\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tdescription: \"updated at\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\tdescription: \"Extra metadata about the apiKey\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Permissions for the api key (stored as JSON string)\"\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\trequired: [\n\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\"userId\",\n\t\t\t\t\t\t\"enabled\",\n\t\t\t\t\t\t\"rateLimitEnabled\",\n\t\t\t\t\t\t\"requestCount\",\n\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t]\n\t\t\t\t} } }\n\t\t\t} }\n\t\t} }\n\t}, async (ctx) => {\n\t\tconst { keyId, expiresIn, enabled, metadata, refillAmount, refillInterval, remaining, name, permissions, rateLimitEnabled, rateLimitTimeWindow, rateLimitMax } = ctx.body;\n\t\tconst session = await getSessionFromCtx(ctx);\n\t\tconst authRequired = ctx.request || ctx.headers;\n\t\tconst user = authRequired && !session ? null : session?.user || { id: ctx.body.userId };\n\t\tif (!user?.id) throw new APIError$1(\"UNAUTHORIZED\", { message: ERROR_CODES.UNAUTHORIZED_SESSION });\n\t\tif (session && ctx.body.userId && session?.user.id !== ctx.body.userId) throw new APIError$1(\"UNAUTHORIZED\", { message: ERROR_CODES.UNAUTHORIZED_SESSION });\n\t\tif (authRequired) {\n\t\t\tif (refillAmount !== void 0 || refillInterval !== void 0 || rateLimitMax !== void 0 || rateLimitTimeWindow !== void 0 || rateLimitEnabled !== void 0 || remaining !== void 0 || permissions !== void 0) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.SERVER_ONLY_PROPERTY });\n\t\t}\n\t\tlet apiKey$1 = null;\n\t\tapiKey$1 = await getApiKeyById(ctx, keyId, opts);\n\t\tif (apiKey$1 && apiKey$1.userId !== user.id) apiKey$1 = null;\n\t\tif (!apiKey$1) throw new APIError$1(\"NOT_FOUND\", { message: ERROR_CODES.KEY_NOT_FOUND });\n\t\tlet newValues = {};\n\t\tif (name !== void 0) {\n\t\t\tif (name.length < opts.minimumNameLength) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_NAME_LENGTH });\n\t\t\telse if (name.length > opts.maximumNameLength) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_NAME_LENGTH });\n\t\t\tnewValues.name = name;\n\t\t}\n\t\tif (enabled !== void 0) newValues.enabled = enabled;\n\t\tif (expiresIn !== void 0) {\n\t\t\tif (opts.keyExpiration.disableCustomExpiresTime === true) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.KEY_DISABLED_EXPIRATION });\n\t\t\tif (expiresIn !== null) {\n\t\t\t\tconst expiresIn_in_days = expiresIn / (3600 * 24);\n\t\t\t\tif (expiresIn_in_days < opts.keyExpiration.minExpiresIn) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.EXPIRES_IN_IS_TOO_SMALL });\n\t\t\t\telse if (expiresIn_in_days > opts.keyExpiration.maxExpiresIn) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.EXPIRES_IN_IS_TOO_LARGE });\n\t\t\t}\n\t\t\tnewValues.expiresAt = expiresIn ? getDate(expiresIn, \"sec\") : null;\n\t\t}\n\t\tif (metadata !== void 0) {\n\t\t\tif (typeof metadata !== \"object\") throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_METADATA_TYPE });\n\t\t\tnewValues.metadata = schema$1.apikey.fields.metadata.transform.input(metadata);\n\t\t}\n\t\tif (remaining !== void 0) newValues.remaining = remaining;\n\t\tif (refillAmount !== void 0 || refillInterval !== void 0) {\n\t\t\tif (refillAmount !== void 0 && refillInterval === void 0) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.REFILL_AMOUNT_AND_INTERVAL_REQUIRED });\n\t\t\telse if (refillInterval !== void 0 && refillAmount === void 0) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.REFILL_INTERVAL_AND_AMOUNT_REQUIRED });\n\t\t\tnewValues.refillAmount = refillAmount;\n\t\t\tnewValues.refillInterval = refillInterval;\n\t\t}\n\t\tif (rateLimitEnabled !== void 0) newValues.rateLimitEnabled = rateLimitEnabled;\n\t\tif (rateLimitTimeWindow !== void 0) newValues.rateLimitTimeWindow = rateLimitTimeWindow;\n\t\tif (rateLimitMax !== void 0) newValues.rateLimitMax = rateLimitMax;\n\t\tif (permissions !== void 0) newValues.permissions = JSON.stringify(permissions);\n\t\tif (Object.keys(newValues).length === 0) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.NO_VALUES_TO_UPDATE });\n\t\tlet newApiKey = apiKey$1;\n\t\ttry {\n\t\t\tif (opts.storage === \"secondary-storage\" && opts.fallbackToDatabase) {\n\t\t\t\tconst dbUpdated = await ctx.context.adapter.update({\n\t\t\t\t\tmodel: API_KEY_TABLE_NAME,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: apiKey$1.id\n\t\t\t\t\t}],\n\t\t\t\t\tupdate: newValues\n\t\t\t\t});\n\t\t\t\tif (dbUpdated) {\n\t\t\t\t\tawait setApiKey(ctx, dbUpdated, opts);\n\t\t\t\t\tnewApiKey = dbUpdated;\n\t\t\t\t}\n\t\t\t} else if (opts.storage === \"database\") {\n\t\t\t\tconst result = await ctx.context.adapter.update({\n\t\t\t\t\tmodel: API_KEY_TABLE_NAME,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: apiKey$1.id\n\t\t\t\t\t}],\n\t\t\t\t\tupdate: newValues\n\t\t\t\t});\n\t\t\t\tif (result) newApiKey = result;\n\t\t\t} else {\n\t\t\t\tconst updated = {\n\t\t\t\t\t...apiKey$1,\n\t\t\t\t\t...newValues,\n\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t};\n\t\t\t\tawait setApiKey(ctx, updated, opts);\n\t\t\t\tnewApiKey = updated;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthrow new APIError$1(\"INTERNAL_SERVER_ERROR\", { message: error?.message });\n\t\t}\n\t\tdeleteAllExpiredApiKeys$1(ctx.context);\n\t\tnewApiKey.metadata = schema$1.apikey.fields.metadata.transform.output(newApiKey.metadata);\n\t\tconst { key, ...returningApiKey } = newApiKey;\n\t\treturn ctx.json({\n\t\t\t...returningApiKey,\n\t\t\tpermissions: returningApiKey.permissions ? safeJSONParse(returningApiKey.permissions) : null\n\t\t});\n\t});\n}\n\n//#endregion\n//#region src/plugins/api-key/rate-limit.ts\n/**\n* Determines if a request is allowed based on rate limiting parameters.\n*\n* @returns An object indicating whether the request is allowed and, if not,\n*          a message and updated ApiKey data.\n*/\nfunction isRateLimited(apiKey$1, opts) {\n\tconst now = /* @__PURE__ */ new Date();\n\tconst lastRequest = apiKey$1.lastRequest;\n\tconst rateLimitTimeWindow = apiKey$1.rateLimitTimeWindow;\n\tconst rateLimitMax = apiKey$1.rateLimitMax;\n\tlet requestCount = apiKey$1.requestCount;\n\tif (opts.rateLimit.enabled === false) return {\n\t\tsuccess: true,\n\t\tmessage: null,\n\t\tupdate: { lastRequest: now },\n\t\ttryAgainIn: null\n\t};\n\tif (apiKey$1.rateLimitEnabled === false) return {\n\t\tsuccess: true,\n\t\tmessage: null,\n\t\tupdate: { lastRequest: now },\n\t\ttryAgainIn: null\n\t};\n\tif (rateLimitTimeWindow === null || rateLimitMax === null) return {\n\t\tsuccess: true,\n\t\tmessage: null,\n\t\tupdate: null,\n\t\ttryAgainIn: null\n\t};\n\tif (lastRequest === null) return {\n\t\tsuccess: true,\n\t\tmessage: null,\n\t\tupdate: {\n\t\t\tlastRequest: now,\n\t\t\trequestCount: 1\n\t\t},\n\t\ttryAgainIn: null\n\t};\n\tconst timeSinceLastRequest = now.getTime() - new Date(lastRequest).getTime();\n\tif (timeSinceLastRequest > rateLimitTimeWindow) return {\n\t\tsuccess: true,\n\t\tmessage: null,\n\t\tupdate: {\n\t\t\tlastRequest: now,\n\t\t\trequestCount: 1\n\t\t},\n\t\ttryAgainIn: null\n\t};\n\tif (requestCount >= rateLimitMax) return {\n\t\tsuccess: false,\n\t\tmessage: ERROR_CODES.RATE_LIMIT_EXCEEDED,\n\t\tupdate: null,\n\t\ttryAgainIn: Math.ceil(rateLimitTimeWindow - timeSinceLastRequest)\n\t};\n\trequestCount++;\n\treturn {\n\t\tsuccess: true,\n\t\tmessage: null,\n\t\ttryAgainIn: null,\n\t\tupdate: {\n\t\t\tlastRequest: now,\n\t\t\trequestCount\n\t\t}\n\t};\n}\n\n//#endregion\n//#region src/plugins/api-key/routes/verify-api-key.ts\nasync function validateApiKey({ hashedKey, ctx, opts, schema: schema$1, permissions }) {\n\tconst apiKey$1 = await getApiKey$1(ctx, hashedKey, opts);\n\tif (!apiKey$1) throw new APIError$1(\"UNAUTHORIZED\", { message: ERROR_CODES.INVALID_API_KEY });\n\tif (apiKey$1.enabled === false) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\tmessage: ERROR_CODES.KEY_DISABLED,\n\t\tcode: \"KEY_DISABLED\"\n\t});\n\tif (apiKey$1.expiresAt) {\n\t\tif (Date.now() > new Date(apiKey$1.expiresAt).getTime()) {\n\t\t\ttry {\n\t\t\t\tif (opts.storage === \"secondary-storage\" && opts.fallbackToDatabase) {\n\t\t\t\t\tawait deleteApiKey$1(ctx, apiKey$1, opts);\n\t\t\t\t\tawait ctx.context.adapter.delete({\n\t\t\t\t\t\tmodel: API_KEY_TABLE_NAME,\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\tvalue: apiKey$1.id\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t} else if (opts.storage === \"secondary-storage\") await deleteApiKey$1(ctx, apiKey$1, opts);\n\t\t\t\telse await ctx.context.adapter.delete({\n\t\t\t\t\tmodel: API_KEY_TABLE_NAME,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: apiKey$1.id\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\tctx.context.logger.error(`Failed to delete expired API keys:`, error);\n\t\t\t}\n\t\t\tthrow new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\tmessage: ERROR_CODES.KEY_EXPIRED,\n\t\t\t\tcode: \"KEY_EXPIRED\"\n\t\t\t});\n\t\t}\n\t}\n\tif (permissions) {\n\t\tconst apiKeyPermissions = apiKey$1.permissions ? safeJSONParse(apiKey$1.permissions) : null;\n\t\tif (!apiKeyPermissions) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\tmessage: ERROR_CODES.KEY_NOT_FOUND,\n\t\t\tcode: \"KEY_NOT_FOUND\"\n\t\t});\n\t\tif (!role(apiKeyPermissions).authorize(permissions).success) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\tmessage: ERROR_CODES.KEY_NOT_FOUND,\n\t\t\tcode: \"KEY_NOT_FOUND\"\n\t\t});\n\t}\n\tlet remaining = apiKey$1.remaining;\n\tlet lastRefillAt = apiKey$1.lastRefillAt;\n\tif (apiKey$1.remaining === 0 && apiKey$1.refillAmount === null) {\n\t\ttry {\n\t\t\tif (opts.storage === \"secondary-storage\") await deleteApiKey$1(ctx, apiKey$1, opts);\n\t\t\telse await ctx.context.adapter.delete({\n\t\t\t\tmodel: API_KEY_TABLE_NAME,\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: apiKey$1.id\n\t\t\t\t}]\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tctx.context.logger.error(`Failed to delete expired API keys:`, error);\n\t\t}\n\t\tthrow new APIError$1(\"TOO_MANY_REQUESTS\", {\n\t\t\tmessage: ERROR_CODES.USAGE_EXCEEDED,\n\t\t\tcode: \"USAGE_EXCEEDED\"\n\t\t});\n\t} else if (remaining !== null) {\n\t\tlet now = Date.now();\n\t\tconst refillInterval = apiKey$1.refillInterval;\n\t\tconst refillAmount = apiKey$1.refillAmount;\n\t\tlet lastTime = new Date(lastRefillAt ?? apiKey$1.createdAt).getTime();\n\t\tif (refillInterval && refillAmount) {\n\t\t\tif (now - lastTime > refillInterval) {\n\t\t\t\tremaining = refillAmount;\n\t\t\t\tlastRefillAt = /* @__PURE__ */ new Date();\n\t\t\t}\n\t\t}\n\t\tif (remaining === 0) throw new APIError$1(\"TOO_MANY_REQUESTS\", {\n\t\t\tmessage: ERROR_CODES.USAGE_EXCEEDED,\n\t\t\tcode: \"USAGE_EXCEEDED\"\n\t\t});\n\t\telse remaining--;\n\t}\n\tconst { message, success, update, tryAgainIn } = isRateLimited(apiKey$1, opts);\n\tlet newApiKey = null;\n\tconst updated = {\n\t\t...apiKey$1,\n\t\t...update,\n\t\tremaining,\n\t\tlastRefillAt,\n\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t};\n\tif (opts.storage === \"database\") newApiKey = await ctx.context.adapter.update({\n\t\tmodel: API_KEY_TABLE_NAME,\n\t\twhere: [{\n\t\t\tfield: \"id\",\n\t\t\tvalue: apiKey$1.id\n\t\t}],\n\t\tupdate: updated\n\t});\n\telse {\n\t\tawait setApiKey(ctx, updated, opts);\n\t\tnewApiKey = updated;\n\t}\n\tif (!newApiKey) throw new APIError$1(\"INTERNAL_SERVER_ERROR\", {\n\t\tmessage: ERROR_CODES.FAILED_TO_UPDATE_API_KEY,\n\t\tcode: \"INTERNAL_SERVER_ERROR\"\n\t});\n\tif (success === false) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\tmessage: message ?? void 0,\n\t\tcode: \"RATE_LIMITED\",\n\t\tdetails: { tryAgainIn }\n\t});\n\treturn newApiKey;\n}\nfunction verifyApiKey({ opts, schema: schema$1, deleteAllExpiredApiKeys: deleteAllExpiredApiKeys$1 }) {\n\treturn createAuthEndpoint(\"/api-key/verify\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({\n\t\t\tkey: z.string().meta({ description: \"The key to verify\" }),\n\t\t\tpermissions: z.record(z.string(), z.array(z.string())).meta({ description: \"The permissions to verify.\" }).optional()\n\t\t}),\n\t\tmetadata: { SERVER_ONLY: true }\n\t}, async (ctx) => {\n\t\tconst { key } = ctx.body;\n\t\tif (key.length < opts.defaultKeyLength) return ctx.json({\n\t\t\tvalid: false,\n\t\t\terror: {\n\t\t\t\tmessage: ERROR_CODES.INVALID_API_KEY,\n\t\t\t\tcode: \"KEY_NOT_FOUND\"\n\t\t\t},\n\t\t\tkey: null\n\t\t});\n\t\tif (opts.customAPIKeyValidator) {\n\t\t\tif (!await opts.customAPIKeyValidator({\n\t\t\t\tctx,\n\t\t\t\tkey\n\t\t\t})) return ctx.json({\n\t\t\t\tvalid: false,\n\t\t\t\terror: {\n\t\t\t\t\tmessage: ERROR_CODES.INVALID_API_KEY,\n\t\t\t\t\tcode: \"KEY_NOT_FOUND\"\n\t\t\t\t},\n\t\t\t\tkey: null\n\t\t\t});\n\t\t}\n\t\tconst hashed = opts.disableKeyHashing ? key : await defaultKeyHasher(key);\n\t\tlet apiKey$1 = null;\n\t\ttry {\n\t\t\tapiKey$1 = await validateApiKey({\n\t\t\t\thashedKey: hashed,\n\t\t\t\tpermissions: ctx.body.permissions,\n\t\t\t\tctx,\n\t\t\t\topts,\n\t\t\t\tschema: schema$1\n\t\t\t});\n\t\t\tawait deleteAllExpiredApiKeys$1(ctx.context);\n\t\t} catch (error) {\n\t\t\tif (error instanceof APIError$1) return ctx.json({\n\t\t\t\tvalid: false,\n\t\t\t\terror: {\n\t\t\t\t\tmessage: error.body?.message,\n\t\t\t\t\tcode: error.body?.code\n\t\t\t\t},\n\t\t\t\tkey: null\n\t\t\t});\n\t\t\treturn ctx.json({\n\t\t\t\tvalid: false,\n\t\t\t\terror: {\n\t\t\t\t\tmessage: ERROR_CODES.INVALID_API_KEY,\n\t\t\t\t\tcode: \"INVALID_API_KEY\"\n\t\t\t\t},\n\t\t\t\tkey: null\n\t\t\t});\n\t\t}\n\t\tconst { key: _, ...returningApiKey } = apiKey$1 ?? {\n\t\t\tkey: 1,\n\t\t\tpermissions: void 0\n\t\t};\n\t\tif (\"metadata\" in returningApiKey) returningApiKey.metadata = schema$1.apikey.fields.metadata.transform.output(returningApiKey.metadata);\n\t\treturningApiKey.permissions = returningApiKey.permissions ? safeJSONParse(returningApiKey.permissions) : null;\n\t\treturn ctx.json({\n\t\t\tvalid: true,\n\t\t\terror: null,\n\t\t\tkey: apiKey$1 === null ? null : returningApiKey\n\t\t});\n\t});\n}\n\n//#endregion\n//#region src/plugins/api-key/routes/index.ts\nlet lastChecked = null;\nasync function deleteAllExpiredApiKeys(ctx, byPassLastCheckTime = false) {\n\tif (lastChecked && !byPassLastCheckTime) {\n\t\tif ((/* @__PURE__ */ new Date()).getTime() - lastChecked.getTime() < 1e4) return;\n\t}\n\tlastChecked = /* @__PURE__ */ new Date();\n\tawait ctx.adapter.deleteMany({\n\t\tmodel: API_KEY_TABLE_NAME,\n\t\twhere: [{\n\t\t\tfield: \"expiresAt\",\n\t\t\toperator: \"lt\",\n\t\t\tvalue: /* @__PURE__ */ new Date()\n\t\t}, {\n\t\t\tfield: \"expiresAt\",\n\t\t\toperator: \"ne\",\n\t\t\tvalue: null\n\t\t}]\n\t}).catch((error) => {\n\t\tctx.logger.error(`Failed to delete expired API keys:`, error);\n\t});\n}\nfunction createApiKeyRoutes({ keyGenerator, opts, schema: schema$1 }) {\n\treturn {\n\t\tcreateApiKey: createApiKey({\n\t\t\tkeyGenerator,\n\t\t\topts,\n\t\t\tschema: schema$1,\n\t\t\tdeleteAllExpiredApiKeys\n\t\t}),\n\t\tverifyApiKey: verifyApiKey({\n\t\t\topts,\n\t\t\tschema: schema$1,\n\t\t\tdeleteAllExpiredApiKeys\n\t\t}),\n\t\tgetApiKey: getApiKey({\n\t\t\topts,\n\t\t\tschema: schema$1,\n\t\t\tdeleteAllExpiredApiKeys\n\t\t}),\n\t\tupdateApiKey: updateApiKey({\n\t\t\topts,\n\t\t\tschema: schema$1,\n\t\t\tdeleteAllExpiredApiKeys\n\t\t}),\n\t\tdeleteApiKey: deleteApiKey({\n\t\t\topts,\n\t\t\tschema: schema$1,\n\t\t\tdeleteAllExpiredApiKeys\n\t\t}),\n\t\tlistApiKeys: listApiKeys({\n\t\t\topts,\n\t\t\tschema: schema$1,\n\t\t\tdeleteAllExpiredApiKeys\n\t\t}),\n\t\tdeleteAllExpiredApiKeys: deleteAllExpiredApiKeysEndpoint({ deleteAllExpiredApiKeys })\n\t};\n}\n\n//#endregion\n//#region src/plugins/api-key/schema.ts\nconst apiKeySchema = ({ timeWindow, rateLimitMax }) => ({ apikey: { fields: {\n\tname: {\n\t\ttype: \"string\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\tstart: {\n\t\ttype: \"string\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\tprefix: {\n\t\ttype: \"string\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\tkey: {\n\t\ttype: \"string\",\n\t\trequired: true,\n\t\tinput: false,\n\t\tindex: true\n\t},\n\tuserId: {\n\t\ttype: \"string\",\n\t\treferences: {\n\t\t\tmodel: \"user\",\n\t\t\tfield: \"id\",\n\t\t\tonDelete: \"cascade\"\n\t\t},\n\t\trequired: true,\n\t\tinput: false,\n\t\tindex: true\n\t},\n\trefillInterval: {\n\t\ttype: \"number\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\trefillAmount: {\n\t\ttype: \"number\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\tlastRefillAt: {\n\t\ttype: \"date\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\tenabled: {\n\t\ttype: \"boolean\",\n\t\trequired: false,\n\t\tinput: false,\n\t\tdefaultValue: true\n\t},\n\trateLimitEnabled: {\n\t\ttype: \"boolean\",\n\t\trequired: false,\n\t\tinput: false,\n\t\tdefaultValue: true\n\t},\n\trateLimitTimeWindow: {\n\t\ttype: \"number\",\n\t\trequired: false,\n\t\tinput: false,\n\t\tdefaultValue: timeWindow\n\t},\n\trateLimitMax: {\n\t\ttype: \"number\",\n\t\trequired: false,\n\t\tinput: false,\n\t\tdefaultValue: rateLimitMax\n\t},\n\trequestCount: {\n\t\ttype: \"number\",\n\t\trequired: false,\n\t\tinput: false,\n\t\tdefaultValue: 0\n\t},\n\tremaining: {\n\t\ttype: \"number\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\tlastRequest: {\n\t\ttype: \"date\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\texpiresAt: {\n\t\ttype: \"date\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\tcreatedAt: {\n\t\ttype: \"date\",\n\t\trequired: true,\n\t\tinput: false\n\t},\n\tupdatedAt: {\n\t\ttype: \"date\",\n\t\trequired: true,\n\t\tinput: false\n\t},\n\tpermissions: {\n\t\ttype: \"string\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\tmetadata: {\n\t\ttype: \"string\",\n\t\trequired: false,\n\t\tinput: true,\n\t\ttransform: {\n\t\t\tinput(value) {\n\t\t\t\treturn JSON.stringify(value);\n\t\t\t},\n\t\t\toutput(value) {\n\t\t\t\tif (!value) return null;\n\t\t\t\treturn parser_default(value);\n\t\t\t}\n\t\t}\n\t}\n} } });\n\n//#endregion\n//#region src/plugins/api-key/index.ts\nconst defaultKeyHasher = async (key) => {\n\tconst hash = await createHash(\"SHA-256\").digest(new TextEncoder().encode(key));\n\treturn base64Url.encode(new Uint8Array(hash), { padding: false });\n};\nconst ERROR_CODES = defineErrorCodes({\n\tINVALID_METADATA_TYPE: \"metadata must be an object or undefined\",\n\tREFILL_AMOUNT_AND_INTERVAL_REQUIRED: \"refillAmount is required when refillInterval is provided\",\n\tREFILL_INTERVAL_AND_AMOUNT_REQUIRED: \"refillInterval is required when refillAmount is provided\",\n\tUSER_BANNED: \"User is banned\",\n\tUNAUTHORIZED_SESSION: \"Unauthorized or invalid session\",\n\tKEY_NOT_FOUND: \"API Key not found\",\n\tKEY_DISABLED: \"API Key is disabled\",\n\tKEY_EXPIRED: \"API Key has expired\",\n\tUSAGE_EXCEEDED: \"API Key has reached its usage limit\",\n\tKEY_NOT_RECOVERABLE: \"API Key is not recoverable\",\n\tEXPIRES_IN_IS_TOO_SMALL: \"The expiresIn is smaller than the predefined minimum value.\",\n\tEXPIRES_IN_IS_TOO_LARGE: \"The expiresIn is larger than the predefined maximum value.\",\n\tINVALID_REMAINING: \"The remaining count is either too large or too small.\",\n\tINVALID_PREFIX_LENGTH: \"The prefix length is either too large or too small.\",\n\tINVALID_NAME_LENGTH: \"The name length is either too large or too small.\",\n\tMETADATA_DISABLED: \"Metadata is disabled.\",\n\tRATE_LIMIT_EXCEEDED: \"Rate limit exceeded.\",\n\tNO_VALUES_TO_UPDATE: \"No values to update.\",\n\tKEY_DISABLED_EXPIRATION: \"Custom key expiration values are disabled.\",\n\tINVALID_API_KEY: \"Invalid API key.\",\n\tINVALID_USER_ID_FROM_API_KEY: \"The user id from the API key is invalid.\",\n\tINVALID_API_KEY_GETTER_RETURN_TYPE: \"API Key getter returned an invalid key type. Expected string.\",\n\tSERVER_ONLY_PROPERTY: \"The property you're trying to set can only be set from the server auth instance only.\",\n\tFAILED_TO_UPDATE_API_KEY: \"Failed to update API key\",\n\tNAME_REQUIRED: \"API Key name is required.\"\n});\nconst API_KEY_TABLE_NAME = \"apikey\";\nconst apiKey = (options) => {\n\tconst opts = {\n\t\t...options,\n\t\tapiKeyHeaders: options?.apiKeyHeaders ?? \"x-api-key\",\n\t\tdefaultKeyLength: options?.defaultKeyLength || 64,\n\t\tmaximumPrefixLength: options?.maximumPrefixLength ?? 32,\n\t\tminimumPrefixLength: options?.minimumPrefixLength ?? 1,\n\t\tmaximumNameLength: options?.maximumNameLength ?? 32,\n\t\tminimumNameLength: options?.minimumNameLength ?? 1,\n\t\tenableMetadata: options?.enableMetadata ?? false,\n\t\tdisableKeyHashing: options?.disableKeyHashing ?? false,\n\t\trequireName: options?.requireName ?? false,\n\t\tstorage: options?.storage ?? \"database\",\n\t\trateLimit: {\n\t\t\tenabled: options?.rateLimit?.enabled === void 0 ? true : options?.rateLimit?.enabled,\n\t\t\ttimeWindow: options?.rateLimit?.timeWindow ?? 1e3 * 60 * 60 * 24,\n\t\t\tmaxRequests: options?.rateLimit?.maxRequests ?? 10\n\t\t},\n\t\tkeyExpiration: {\n\t\t\tdefaultExpiresIn: options?.keyExpiration?.defaultExpiresIn ?? null,\n\t\t\tdisableCustomExpiresTime: options?.keyExpiration?.disableCustomExpiresTime ?? false,\n\t\t\tmaxExpiresIn: options?.keyExpiration?.maxExpiresIn ?? 365,\n\t\t\tminExpiresIn: options?.keyExpiration?.minExpiresIn ?? 1\n\t\t},\n\t\tstartingCharactersConfig: {\n\t\t\tshouldStore: options?.startingCharactersConfig?.shouldStore ?? true,\n\t\t\tcharactersLength: options?.startingCharactersConfig?.charactersLength ?? 6\n\t\t},\n\t\tenableSessionForAPIKeys: options?.enableSessionForAPIKeys ?? false,\n\t\tfallbackToDatabase: options?.fallbackToDatabase ?? false,\n\t\tcustomStorage: options?.customStorage\n\t};\n\tconst schema$1 = mergeSchema(apiKeySchema({\n\t\trateLimitMax: opts.rateLimit.maxRequests,\n\t\ttimeWindow: opts.rateLimit.timeWindow\n\t}), opts.schema);\n\tconst getter = opts.customAPIKeyGetter || ((ctx) => {\n\t\tif (Array.isArray(opts.apiKeyHeaders)) for (const header of opts.apiKeyHeaders) {\n\t\t\tconst value = ctx.headers?.get(header);\n\t\t\tif (value) return value;\n\t\t}\n\t\telse return ctx.headers?.get(opts.apiKeyHeaders);\n\t});\n\tconst routes = createApiKeyRoutes({\n\t\tkeyGenerator: opts.customKeyGenerator || (async (options$1) => {\n\t\t\tconst key = generateRandomString(options$1.length, \"a-z\", \"A-Z\");\n\t\t\treturn `${options$1.prefix || \"\"}${key}`;\n\t\t}),\n\t\topts,\n\t\tschema: schema$1\n\t});\n\treturn {\n\t\tid: \"api-key\",\n\t\t$ERROR_CODES: ERROR_CODES,\n\t\thooks: { before: [{\n\t\t\tmatcher: (ctx) => !!getter(ctx) && opts.enableSessionForAPIKeys,\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst key = getter(ctx);\n\t\t\t\tif (typeof key !== \"string\") throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_API_KEY_GETTER_RETURN_TYPE });\n\t\t\t\tif (key.length < opts.defaultKeyLength) throw new APIError$1(\"FORBIDDEN\", { message: ERROR_CODES.INVALID_API_KEY });\n\t\t\t\tif (opts.customAPIKeyValidator) {\n\t\t\t\t\tif (!await opts.customAPIKeyValidator({\n\t\t\t\t\t\tctx,\n\t\t\t\t\t\tkey\n\t\t\t\t\t})) throw new APIError$1(\"FORBIDDEN\", { message: ERROR_CODES.INVALID_API_KEY });\n\t\t\t\t}\n\t\t\t\tconst apiKey$1 = await validateApiKey({\n\t\t\t\t\thashedKey: opts.disableKeyHashing ? key : await defaultKeyHasher(key),\n\t\t\t\t\tctx,\n\t\t\t\t\topts,\n\t\t\t\t\tschema: schema$1\n\t\t\t\t});\n\t\t\t\tdeleteAllExpiredApiKeys(ctx.context).catch((err) => {\n\t\t\t\t\tctx.context.logger.error(\"Failed to delete expired API keys:\", err);\n\t\t\t\t});\n\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(apiKey$1.userId);\n\t\t\t\tif (!user) throw new APIError$1(\"UNAUTHORIZED\", { message: ERROR_CODES.INVALID_USER_ID_FROM_API_KEY });\n\t\t\t\tconst session = {\n\t\t\t\t\tuser,\n\t\t\t\t\tsession: {\n\t\t\t\t\t\tid: apiKey$1.id,\n\t\t\t\t\t\ttoken: key,\n\t\t\t\t\t\tuserId: apiKey$1.userId,\n\t\t\t\t\t\tuserAgent: ctx.request?.headers.get(\"user-agent\") ?? null,\n\t\t\t\t\t\tipAddress: ctx.request ? getIp(ctx.request, ctx.context.options) : null,\n\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\texpiresAt: apiKey$1.expiresAt || getDate(ctx.context.options.session?.expiresIn || 3600 * 24 * 7, \"ms\")\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tctx.context.session = session;\n\t\t\t\tif (ctx.path === \"/get-session\") return session;\n\t\t\t\telse return { context: ctx };\n\t\t\t})\n\t\t}] },\n\t\tendpoints: {\n\t\t\tcreateApiKey: routes.createApiKey,\n\t\t\tverifyApiKey: routes.verifyApiKey,\n\t\t\tgetApiKey: routes.getApiKey,\n\t\t\tupdateApiKey: routes.updateApiKey,\n\t\t\tdeleteApiKey: routes.deleteApiKey,\n\t\t\tlistApiKeys: routes.listApiKeys,\n\t\t\tdeleteAllExpiredApiKeys: routes.deleteAllExpiredApiKeys\n\t\t},\n\t\tschema: schema$1\n\t};\n};\n\n//#endregion\n//#region src/plugins/last-login-method/index.ts\n/**\n* Plugin to track the last used login method\n*/\nconst lastLoginMethod = (userConfig) => {\n\tconst paths = [\n\t\t\"/callback/:id\",\n\t\t\"/oauth2/callback/:providerId\",\n\t\t\"/sign-in/email\",\n\t\t\"/sign-up/email\"\n\t];\n\tconst defaultResolveMethod = (ctx) => {\n\t\tif (paths.includes(ctx.path)) return ctx.params?.id || ctx.params?.providerId || ctx.path.split(\"/\").pop();\n\t\tif (ctx.path.includes(\"siwe\")) return \"siwe\";\n\t\tif (ctx.path.includes(\"/passkey/verify-authentication\")) return \"passkey\";\n\t\treturn null;\n\t};\n\tconst config = {\n\t\tcookieName: \"better-auth.last_used_login_method\",\n\t\tmaxAge: 3600 * 24 * 30,\n\t\t...userConfig\n\t};\n\treturn {\n\t\tid: \"last-login-method\",\n\t\tinit(ctx) {\n\t\t\treturn { options: { databaseHooks: {\n\t\t\t\tuser: { create: { async before(user, context) {\n\t\t\t\t\tif (!config.storeInDatabase) return;\n\t\t\t\t\tif (!context) return;\n\t\t\t\t\tconst lastUsedLoginMethod = config.customResolveMethod?.(context) ?? defaultResolveMethod(context);\n\t\t\t\t\tif (lastUsedLoginMethod) return { data: {\n\t\t\t\t\t\t...user,\n\t\t\t\t\t\tlastLoginMethod: lastUsedLoginMethod\n\t\t\t\t\t} };\n\t\t\t\t} } },\n\t\t\t\tsession: { create: { async after(session, context) {\n\t\t\t\t\tif (!config.storeInDatabase) return;\n\t\t\t\t\tif (!context) return;\n\t\t\t\t\tconst lastUsedLoginMethod = config.customResolveMethod?.(context) ?? defaultResolveMethod(context);\n\t\t\t\t\tif (lastUsedLoginMethod && session?.userId) try {\n\t\t\t\t\t\tawait ctx.internalAdapter.updateUser(session.userId, { lastLoginMethod: lastUsedLoginMethod });\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tctx.logger.error(\"Failed to update lastLoginMethod\", error);\n\t\t\t\t\t}\n\t\t\t\t} } }\n\t\t\t} } };\n\t\t},\n\t\thooks: { after: [{\n\t\t\tmatcher() {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst lastUsedLoginMethod = config.customResolveMethod?.(ctx) ?? defaultResolveMethod(ctx);\n\t\t\t\tif (lastUsedLoginMethod) {\n\t\t\t\t\tconst setCookie = ctx.context.responseHeaders?.get(\"set-cookie\");\n\t\t\t\t\tconst sessionTokenName = ctx.context.authCookies.sessionToken.name;\n\t\t\t\t\tif (setCookie && setCookie.includes(sessionTokenName)) {\n\t\t\t\t\t\tconst cookieAttributes = {\n\t\t\t\t\t\t\t...ctx.context.authCookies.sessionToken.options,\n\t\t\t\t\t\t\tmaxAge: config.maxAge,\n\t\t\t\t\t\t\thttpOnly: false\n\t\t\t\t\t\t};\n\t\t\t\t\t\tctx.setCookie(config.cookieName, lastUsedLoginMethod, cookieAttributes);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}] },\n\t\tschema: config.storeInDatabase ? { user: { fields: { lastLoginMethod: {\n\t\t\ttype: \"string\",\n\t\t\tinput: false,\n\t\t\trequired: false,\n\t\t\tfieldName: config.schema?.user?.lastLoginMethod || \"lastLoginMethod\"\n\t\t} } } } : void 0\n\t};\n};\n\n//#endregion\n//#region src/plugins/mcp/authorize.ts\nfunction redirectErrorURL(url, error, description) {\n\treturn `${url.includes(\"?\") ? \"&\" : \"?\"}error=${error}&error_description=${description}`;\n}\nasync function authorizeMCPOAuth(ctx, options) {\n\tctx.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n\tctx.setHeader(\"Access-Control-Allow-Methods\", \"POST, OPTIONS\");\n\tctx.setHeader(\"Access-Control-Allow-Headers\", \"Content-Type, Authorization\");\n\tctx.setHeader(\"Access-Control-Max-Age\", \"86400\");\n\tconst opts = {\n\t\tcodeExpiresIn: 600,\n\t\tdefaultScope: \"openid\",\n\t\t...options,\n\t\tscopes: [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\",\n\t\t\t...options?.scopes || []\n\t\t]\n\t};\n\tif (!ctx.request) throw new APIError(\"UNAUTHORIZED\", {\n\t\terror_description: \"request not found\",\n\t\terror: \"invalid_request\"\n\t});\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session) {\n\t\t/**\n\t\t* If the user is not logged in, we need to redirect them to the\n\t\t* login page.\n\t\t*/\n\t\tawait ctx.setSignedCookie(\"oidc_login_prompt\", JSON.stringify(ctx.query), ctx.context.secret, {\n\t\t\tmaxAge: 600,\n\t\t\tpath: \"/\",\n\t\t\tsameSite: \"lax\"\n\t\t});\n\t\tconst queryFromURL = ctx.request.url?.split(\"?\")[1];\n\t\tthrow ctx.redirect(`${options.loginPage}?${queryFromURL}`);\n\t}\n\tconst query = ctx.query;\n\tif (!query.client_id) throw ctx.redirect(`${ctx.context.baseURL}/error?error=invalid_client`);\n\tif (!query.response_type) throw ctx.redirect(redirectErrorURL(`${ctx.context.baseURL}/error`, \"invalid_request\", \"response_type is required\"));\n\tconst client = await ctx.context.adapter.findOne({\n\t\tmodel: \"oauthApplication\",\n\t\twhere: [{\n\t\t\tfield: \"clientId\",\n\t\t\tvalue: ctx.query.client_id\n\t\t}]\n\t}).then((res) => {\n\t\tif (!res) return null;\n\t\treturn {\n\t\t\t...res,\n\t\t\tredirectUrls: res.redirectUrls.split(\",\"),\n\t\t\tmetadata: res.metadata ? JSON.parse(res.metadata) : {}\n\t\t};\n\t});\n\tif (!client) throw ctx.redirect(`${ctx.context.baseURL}/error?error=invalid_client`);\n\tconst redirectURI = client.redirectUrls.find((url) => url === ctx.query.redirect_uri);\n\tif (!redirectURI || !query.redirect_uri)\n /**\n\t* show UI error here warning the user that the redirect URI is invalid\n\t*/\n\tthrow new APIError(\"BAD_REQUEST\", { message: \"Invalid redirect URI\" });\n\tif (client.disabled) throw ctx.redirect(`${ctx.context.baseURL}/error?error=client_disabled`);\n\tif (query.response_type !== \"code\") throw ctx.redirect(`${ctx.context.baseURL}/error?error=unsupported_response_type`);\n\tconst requestScope = query.scope?.split(\" \").filter((s) => s) || opts.defaultScope.split(\" \");\n\tconst invalidScopes = requestScope.filter((scope) => {\n\t\treturn !opts.scopes.includes(scope);\n\t});\n\tif (invalidScopes.length) throw ctx.redirect(redirectErrorURL(query.redirect_uri, \"invalid_scope\", `The following scopes are invalid: ${invalidScopes.join(\", \")}`));\n\tif ((!query.code_challenge || !query.code_challenge_method) && options.requirePKCE) throw ctx.redirect(redirectErrorURL(query.redirect_uri, \"invalid_request\", \"pkce is required\"));\n\tif (!query.code_challenge_method) query.code_challenge_method = \"plain\";\n\tif (![\"s256\", options.allowPlainCodeChallengeMethod ? \"plain\" : \"s256\"].includes(query.code_challenge_method?.toLowerCase() || \"\")) throw ctx.redirect(redirectErrorURL(query.redirect_uri, \"invalid_request\", \"invalid code_challenge method\"));\n\tconst code = generateRandomString(32, \"a-z\", \"A-Z\", \"0-9\");\n\tconst codeExpiresInMs = opts.codeExpiresIn * 1e3;\n\tconst expiresAt = new Date(Date.now() + codeExpiresInMs);\n\ttry {\n\t\t/**\n\t\t* Save the code in the database\n\t\t*/\n\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\tvalue: JSON.stringify({\n\t\t\t\tclientId: client.clientId,\n\t\t\t\tredirectURI: query.redirect_uri,\n\t\t\t\tscope: requestScope,\n\t\t\t\tuserId: session.user.id,\n\t\t\t\tauthTime: new Date(session.session.createdAt).getTime(),\n\t\t\t\trequireConsent: query.prompt === \"consent\",\n\t\t\t\tstate: query.prompt === \"consent\" ? query.state : null,\n\t\t\t\tcodeChallenge: query.code_challenge,\n\t\t\t\tcodeChallengeMethod: query.code_challenge_method,\n\t\t\t\tnonce: query.nonce\n\t\t\t}),\n\t\t\tidentifier: code,\n\t\t\texpiresAt\n\t\t});\n\t} catch (e) {\n\t\tthrow ctx.redirect(redirectErrorURL(query.redirect_uri, \"server_error\", \"An error occurred while processing the request\"));\n\t}\n\tif (query.prompt !== \"consent\") {\n\t\tconst redirectURIWithCode$1 = new URL(redirectURI);\n\t\tredirectURIWithCode$1.searchParams.set(\"code\", code);\n\t\tredirectURIWithCode$1.searchParams.set(\"state\", ctx.query.state);\n\t\tthrow ctx.redirect(redirectURIWithCode$1.toString());\n\t}\n\tif (options?.consentPage) {\n\t\tawait ctx.setSignedCookie(\"oidc_consent_prompt\", code, ctx.context.secret, {\n\t\t\tmaxAge: 600,\n\t\t\tpath: \"/\",\n\t\t\tsameSite: \"lax\"\n\t\t});\n\t\tconst urlParams = new URLSearchParams();\n\t\turlParams.set(\"consent_code\", code);\n\t\turlParams.set(\"client_id\", client.clientId);\n\t\turlParams.set(\"scope\", requestScope.join(\" \"));\n\t\tconst consentURI = `${options.consentPage}?${urlParams.toString()}`;\n\t\tthrow ctx.redirect(consentURI);\n\t}\n\tconst redirectURIWithCode = new URL(redirectURI);\n\tredirectURIWithCode.searchParams.set(\"code\", code);\n\tredirectURIWithCode.searchParams.set(\"state\", ctx.query.state);\n\tthrow ctx.redirect(redirectURIWithCode.toString());\n}\n\n//#endregion\n//#region src/plugins/mcp/index.ts\nconst getMCPProviderMetadata = (ctx, options) => {\n\tconst issuer = ctx.context.options.baseURL;\n\tconst baseURL = ctx.context.baseURL;\n\tif (!issuer || !baseURL) throw new APIError$1(\"INTERNAL_SERVER_ERROR\", {\n\t\terror: \"invalid_issuer\",\n\t\terror_description: \"issuer or baseURL is not set. If you're the app developer, please make sure to set the `baseURL` in your auth config.\"\n\t});\n\treturn {\n\t\tissuer,\n\t\tauthorization_endpoint: `${baseURL}/mcp/authorize`,\n\t\ttoken_endpoint: `${baseURL}/mcp/token`,\n\t\tuserinfo_endpoint: `${baseURL}/mcp/userinfo`,\n\t\tjwks_uri: `${baseURL}/mcp/jwks`,\n\t\tregistration_endpoint: `${baseURL}/mcp/register`,\n\t\tscopes_supported: [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\"\n\t\t],\n\t\tresponse_types_supported: [\"code\"],\n\t\tresponse_modes_supported: [\"query\"],\n\t\tgrant_types_supported: [\"authorization_code\", \"refresh_token\"],\n\t\tacr_values_supported: [\"urn:mace:incommon:iap:silver\", \"urn:mace:incommon:iap:bronze\"],\n\t\tsubject_types_supported: [\"public\"],\n\t\tid_token_signing_alg_values_supported: [\"RS256\", \"none\"],\n\t\ttoken_endpoint_auth_methods_supported: [\n\t\t\t\"client_secret_basic\",\n\t\t\t\"client_secret_post\",\n\t\t\t\"none\"\n\t\t],\n\t\tcode_challenge_methods_supported: [\"S256\"],\n\t\tclaims_supported: [\n\t\t\t\"sub\",\n\t\t\t\"iss\",\n\t\t\t\"aud\",\n\t\t\t\"exp\",\n\t\t\t\"nbf\",\n\t\t\t\"iat\",\n\t\t\t\"jti\",\n\t\t\t\"email\",\n\t\t\t\"email_verified\",\n\t\t\t\"name\"\n\t\t],\n\t\t...options?.metadata\n\t};\n};\nconst getMCPProtectedResourceMetadata = (ctx, options) => {\n\tconst baseURL = ctx.context.baseURL;\n\tconst origin = new URL(baseURL).origin;\n\treturn {\n\t\tresource: options?.resource ?? origin,\n\t\tauthorization_servers: [origin],\n\t\tjwks_uri: options?.oidcConfig?.metadata?.jwks_uri ?? `${baseURL}/mcp/jwks`,\n\t\tscopes_supported: options?.oidcConfig?.metadata?.scopes_supported ?? [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\"\n\t\t],\n\t\tbearer_methods_supported: [\"header\"],\n\t\tresource_signing_alg_values_supported: [\"RS256\", \"none\"]\n\t};\n};\nconst mcp = (options) => {\n\tconst opts = {\n\t\tcodeExpiresIn: 600,\n\t\tdefaultScope: \"openid\",\n\t\taccessTokenExpiresIn: 3600,\n\t\trefreshTokenExpiresIn: 604800,\n\t\tallowPlainCodeChallengeMethod: true,\n\t\t...options.oidcConfig,\n\t\tloginPage: options.loginPage,\n\t\tscopes: [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\",\n\t\t\t...options.oidcConfig?.scopes || []\n\t\t]\n\t};\n\tconst modelName = {\n\t\toauthClient: \"oauthApplication\",\n\t\toauthAccessToken: \"oauthAccessToken\",\n\t\toauthConsent: \"oauthConsent\"\n\t};\n\tconst provider = oidcProvider(opts);\n\treturn {\n\t\tid: \"mcp\",\n\t\thooks: { after: [{\n\t\t\tmatcher() {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst cookie = await ctx.getSignedCookie(\"oidc_login_prompt\", ctx.context.secret);\n\t\t\t\tconst cookieName = ctx.context.authCookies.sessionToken.name;\n\t\t\t\tconst parsedSetCookieHeader = parseSetCookieHeader(ctx.context.responseHeaders?.get(\"set-cookie\") || \"\");\n\t\t\t\tconst hasSessionToken = parsedSetCookieHeader.has(cookieName);\n\t\t\t\tif (!cookie || !hasSessionToken) return;\n\t\t\t\tctx.setCookie(\"oidc_login_prompt\", \"\", { maxAge: 0 });\n\t\t\t\tconst sessionToken = (parsedSetCookieHeader.get(cookieName)?.value)?.split(\".\")[0];\n\t\t\t\tif (!sessionToken) return;\n\t\t\t\tconst session = await ctx.context.internalAdapter.findSession(sessionToken) || ctx.context.newSession;\n\t\t\t\tif (!session) return;\n\t\t\t\tconst promptSet = parsePrompt(String(ctx.query?.prompt));\n\t\t\t\tif (promptSet.has(\"login\")) {\n\t\t\t\t\tconst newPromptSet = new Set(promptSet);\n\t\t\t\t\tnewPromptSet.delete(\"login\");\n\t\t\t\t\tctx.query = {\n\t\t\t\t\t\t...ctx.query,\n\t\t\t\t\t\tprompt: Array.from(newPromptSet).join(\" \")\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tctx.context.session = session;\n\t\t\t\treturn await authorizeMCPOAuth(ctx, opts);\n\t\t\t})\n\t\t}] },\n\t\tendpoints: {\n\t\t\toAuthConsent: provider.endpoints.oAuthConsent,\n\t\t\tgetMcpOAuthConfig: createAuthEndpoint(\"/.well-known/oauth-authorization-server\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tmetadata: { ...HIDE_METADATA }\n\t\t\t}, async (c) => {\n\t\t\t\ttry {\n\t\t\t\t\tconst metadata = getMCPProviderMetadata(c, options);\n\t\t\t\t\treturn c.json(metadata);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log(e);\n\t\t\t\t\treturn c.json(null);\n\t\t\t\t}\n\t\t\t}),\n\t\t\tgetMCPProtectedResource: createAuthEndpoint(\"/.well-known/oauth-protected-resource\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tmetadata: { ...HIDE_METADATA }\n\t\t\t}, async (c) => {\n\t\t\t\tconst metadata = getMCPProtectedResourceMetadata(c, options);\n\t\t\t\treturn c.json(metadata);\n\t\t\t}),\n\t\t\tmcpOAuthAuthorize: createAuthEndpoint(\"/mcp/authorize\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tquery: z.record(z.string(), z.any()),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Authorize an OAuth2 request using MCP\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"Authorization response generated successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\tdescription: \"Authorization response, contents depend on the authorize function implementation\"\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\treturn authorizeMCPOAuth(ctx, opts);\n\t\t\t}),\n\t\t\tmcpOAuthToken: createAuthEndpoint(\"/mcp/token\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.record(z.any(), z.any()),\n\t\t\t\tmetadata: {\n\t\t\t\t\tisAction: false,\n\t\t\t\t\tallowedMediaTypes: [\"application/x-www-form-urlencoded\", \"application/json\"]\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tctx.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n\t\t\t\tctx.setHeader(\"Access-Control-Allow-Methods\", \"POST, OPTIONS\");\n\t\t\t\tctx.setHeader(\"Access-Control-Allow-Headers\", \"Content-Type, Authorization\");\n\t\t\t\tctx.setHeader(\"Access-Control-Max-Age\", \"86400\");\n\t\t\t\tlet { body } = ctx;\n\t\t\t\tif (!body) throw ctx.error(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"request body not found\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif (body instanceof FormData) body = Object.fromEntries(body.entries());\n\t\t\t\tif (!(body instanceof Object)) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"request body is not an object\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tlet { client_id, client_secret } = body;\n\t\t\t\tconst authorization = ctx.request?.headers.get(\"authorization\") || null;\n\t\t\t\tif (authorization && !client_id && !client_secret && authorization.startsWith(\"Basic \")) try {\n\t\t\t\t\tconst encoded = authorization.replace(\"Basic \", \"\");\n\t\t\t\t\tconst decoded = new TextDecoder().decode(base64.decode(encoded));\n\t\t\t\t\tif (!decoded.includes(\":\")) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t\tconst [id, secret] = decoded.split(\":\");\n\t\t\t\t\tif (!id || !secret) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t\tclient_id = id;\n\t\t\t\t\tclient_secret = secret;\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthrow new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst { grant_type, code, redirect_uri, refresh_token, code_verifier } = body;\n\t\t\t\tif (grant_type === \"refresh_token\") {\n\t\t\t\t\tif (!refresh_token) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror_description: \"refresh_token is required\",\n\t\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t\t});\n\t\t\t\t\tconst token = await ctx.context.adapter.findOne({\n\t\t\t\t\t\tmodel: \"oauthAccessToken\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"refreshToken\",\n\t\t\t\t\t\t\tvalue: refresh_token.toString()\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t\tif (!token) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid refresh token\",\n\t\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t\t});\n\t\t\t\t\tif (token.clientId !== client_id?.toString()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t\tif (token.refreshTokenExpiresAt < /* @__PURE__ */ new Date()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"refresh token expired\",\n\t\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t\t});\n\t\t\t\t\tconst accessToken$1 = generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\t\tconst newRefreshToken = generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\t\tconst accessTokenExpiresAt$1 = new Date(Date.now() + opts.accessTokenExpiresIn * 1e3);\n\t\t\t\t\tconst refreshTokenExpiresAt$1 = new Date(Date.now() + opts.refreshTokenExpiresIn * 1e3);\n\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\taccessToken: accessToken$1,\n\t\t\t\t\t\t\trefreshToken: newRefreshToken,\n\t\t\t\t\t\t\taccessTokenExpiresAt: accessTokenExpiresAt$1,\n\t\t\t\t\t\t\trefreshTokenExpiresAt: refreshTokenExpiresAt$1,\n\t\t\t\t\t\t\tclientId: client_id.toString(),\n\t\t\t\t\t\t\tuserId: token.userId,\n\t\t\t\t\t\t\tscopes: token.scopes,\n\t\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\taccess_token: accessToken$1,\n\t\t\t\t\t\ttoken_type: \"bearer\",\n\t\t\t\t\t\texpires_in: opts.accessTokenExpiresIn,\n\t\t\t\t\t\trefresh_token: newRefreshToken,\n\t\t\t\t\t\tscope: token.scopes\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (!code) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"code is required\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif (opts.requirePKCE && !code_verifier) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"code verifier is missing\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\t/**\n\t\t\t\t* We need to check if the code is valid before we can proceed\n\t\t\t\t* with the rest of the request.\n\t\t\t\t*/\n\t\t\t\tconst verificationValue = await ctx.context.internalAdapter.findVerificationValue(code.toString());\n\t\t\t\tif (!verificationValue) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"invalid code\",\n\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t});\n\t\t\t\tif (verificationValue.expiresAt < /* @__PURE__ */ new Date()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"code expired\",\n\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t});\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\tif (!client_id) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"client_id is required\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tif (!grant_type) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"grant_type is required\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif (grant_type !== \"authorization_code\") throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"grant_type must be 'authorization_code'\",\n\t\t\t\t\terror: \"unsupported_grant_type\"\n\t\t\t\t});\n\t\t\t\tif (!redirect_uri) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"redirect_uri is required\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tconst client = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: modelName.oauthClient,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"clientId\",\n\t\t\t\t\t\tvalue: client_id.toString()\n\t\t\t\t\t}]\n\t\t\t\t}).then((res) => {\n\t\t\t\t\tif (!res) return null;\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...res,\n\t\t\t\t\t\tredirectUrls: res.redirectUrls.split(\",\"),\n\t\t\t\t\t\tmetadata: res.metadata ? JSON.parse(res.metadata) : {}\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t\tif (!client) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tif (client.disabled) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"client is disabled\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tif (client.type === \"public\") {\n\t\t\t\t\tif (!code_verifier) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror_description: \"code verifier is required for public clients\",\n\t\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tif (!client_secret) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"client_secret is required for confidential clients\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t\tif (!(client.clientSecret === client_secret.toString())) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid client_secret\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst value = JSON.parse(verificationValue.value);\n\t\t\t\tif (value.clientId !== client_id.toString()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tif (value.redirectURI !== redirect_uri.toString()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"invalid redirect_uri\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tif (value.codeChallenge && !code_verifier) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"code verifier is missing\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif ((value.codeChallengeMethod === \"plain\" ? code_verifier : await createHash(\"SHA-256\", \"base64urlnopad\").digest(code_verifier)) !== value.codeChallenge) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"code verification failed\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tconst requestedScopes = value.scope;\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\tconst accessToken = generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\tconst refreshToken = generateRandomString(32, \"A-Z\", \"a-z\");\n\t\t\t\tconst accessTokenExpiresAt = new Date(Date.now() + opts.accessTokenExpiresIn * 1e3);\n\t\t\t\tconst refreshTokenExpiresAt = new Date(Date.now() + opts.refreshTokenExpiresIn * 1e3);\n\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\taccessToken,\n\t\t\t\t\t\trefreshToken,\n\t\t\t\t\t\taccessTokenExpiresAt,\n\t\t\t\t\t\trefreshTokenExpiresAt,\n\t\t\t\t\t\tclientId: client_id.toString(),\n\t\t\t\t\t\tuserId: value.userId,\n\t\t\t\t\t\tscopes: requestedScopes.join(\" \"),\n\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(value.userId);\n\t\t\t\tif (!user) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"user not found\",\n\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t});\n\t\t\t\tlet secretKey = {\n\t\t\t\t\talg: \"HS256\",\n\t\t\t\t\tkey: await getWebcryptoSubtle().generateKey({\n\t\t\t\t\t\tname: \"HMAC\",\n\t\t\t\t\t\thash: \"SHA-256\"\n\t\t\t\t\t}, true, [\"sign\", \"verify\"])\n\t\t\t\t};\n\t\t\t\tconst profile = {\n\t\t\t\t\tgiven_name: user.name.split(\" \")[0],\n\t\t\t\t\tfamily_name: user.name.split(\" \")[1],\n\t\t\t\t\tname: user.name,\n\t\t\t\t\tprofile: user.image,\n\t\t\t\t\tupdated_at: Math.floor(new Date(user.updatedAt).getTime() / 1e3)\n\t\t\t\t};\n\t\t\t\tconst email = {\n\t\t\t\t\temail: user.email,\n\t\t\t\t\temail_verified: user.emailVerified\n\t\t\t\t};\n\t\t\t\tconst userClaims = {\n\t\t\t\t\t...requestedScopes.includes(\"profile\") ? profile : {},\n\t\t\t\t\t...requestedScopes.includes(\"email\") ? email : {}\n\t\t\t\t};\n\t\t\t\tconst additionalUserClaims = opts.getAdditionalUserInfoClaim ? await opts.getAdditionalUserInfoClaim(user, requestedScopes, client) : {};\n\t\t\t\tconst idToken = await new SignJWT({\n\t\t\t\t\tsub: user.id,\n\t\t\t\t\taud: client_id.toString(),\n\t\t\t\t\tiat: Date.now(),\n\t\t\t\t\tauth_time: ctx.context.session ? new Date(ctx.context.session.session.createdAt).getTime() : void 0,\n\t\t\t\t\tnonce: value.nonce,\n\t\t\t\t\tacr: \"urn:mace:incommon:iap:silver\",\n\t\t\t\t\t...userClaims,\n\t\t\t\t\t...additionalUserClaims\n\t\t\t\t}).setProtectedHeader({ alg: secretKey.alg }).setIssuedAt().setExpirationTime(Math.floor(Date.now() / 1e3) + opts.accessTokenExpiresIn).sign(secretKey.key);\n\t\t\t\treturn ctx.json({\n\t\t\t\t\taccess_token: accessToken,\n\t\t\t\t\ttoken_type: \"Bearer\",\n\t\t\t\t\texpires_in: opts.accessTokenExpiresIn,\n\t\t\t\t\trefresh_token: requestedScopes.includes(\"offline_access\") ? refreshToken : void 0,\n\t\t\t\t\tscope: requestedScopes.join(\" \"),\n\t\t\t\t\tid_token: requestedScopes.includes(\"openid\") ? idToken : void 0\n\t\t\t\t}, { headers: {\n\t\t\t\t\t\"Cache-Control\": \"no-store\",\n\t\t\t\t\tPragma: \"no-cache\"\n\t\t\t\t} });\n\t\t\t}),\n\t\t\tregisterMcpClient: createAuthEndpoint(\"/mcp/register\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tredirect_uris: z.array(z.string()),\n\t\t\t\t\ttoken_endpoint_auth_method: z.enum([\n\t\t\t\t\t\t\"none\",\n\t\t\t\t\t\t\"client_secret_basic\",\n\t\t\t\t\t\t\"client_secret_post\"\n\t\t\t\t\t]).default(\"client_secret_basic\").optional(),\n\t\t\t\t\tgrant_types: z.array(z.enum([\n\t\t\t\t\t\t\"authorization_code\",\n\t\t\t\t\t\t\"implicit\",\n\t\t\t\t\t\t\"password\",\n\t\t\t\t\t\t\"client_credentials\",\n\t\t\t\t\t\t\"refresh_token\",\n\t\t\t\t\t\t\"urn:ietf:params:oauth:grant-type:jwt-bearer\",\n\t\t\t\t\t\t\"urn:ietf:params:oauth:grant-type:saml2-bearer\"\n\t\t\t\t\t])).default([\"authorization_code\"]).optional(),\n\t\t\t\t\tresponse_types: z.array(z.enum([\"code\", \"token\"])).default([\"code\"]).optional(),\n\t\t\t\t\tclient_name: z.string().optional(),\n\t\t\t\t\tclient_uri: z.string().optional(),\n\t\t\t\t\tlogo_uri: z.string().optional(),\n\t\t\t\t\tscope: z.string().optional(),\n\t\t\t\t\tcontacts: z.array(z.string()).optional(),\n\t\t\t\t\ttos_uri: z.string().optional(),\n\t\t\t\t\tpolicy_uri: z.string().optional(),\n\t\t\t\t\tjwks_uri: z.string().optional(),\n\t\t\t\t\tjwks: z.record(z.string(), z.any()).optional(),\n\t\t\t\t\tmetadata: z.record(z.any(), z.any()).optional(),\n\t\t\t\t\tsoftware_id: z.string().optional(),\n\t\t\t\t\tsoftware_version: z.string().optional(),\n\t\t\t\t\tsoftware_statement: z.string().optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Register an OAuth2 application\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"OAuth2 application registered successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Name of the OAuth2 application\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ticon: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\tdescription: \"Icon URL for the application\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\tdescription: \"Additional metadata for the application\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tclientId: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier for the client\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tclientSecret: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Secret key for the client. Not included for public clients.\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tredirectUrls: {\n\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tformat: \"uri\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdescription: \"List of allowed redirect URLs\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttype: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Type of the client\",\n\t\t\t\t\t\t\t\t\tenum: [\"web\", \"public\"]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tauthenticationScheme: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Authentication scheme used by the client\",\n\t\t\t\t\t\t\t\t\tenum: [\"client_secret\", \"none\"]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdisabled: {\n\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\tdescription: \"Whether the client is disabled\",\n\t\t\t\t\t\t\t\t\tenum: [false]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\tdescription: \"ID of the user who registered the client, null if registered anonymously\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\tdescription: \"Creation timestamp\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\tdescription: \"Last update timestamp\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\"name\",\n\t\t\t\t\t\t\t\t\"clientId\",\n\t\t\t\t\t\t\t\t\"redirectUrls\",\n\t\t\t\t\t\t\t\t\"type\",\n\t\t\t\t\t\t\t\t\"authenticationScheme\",\n\t\t\t\t\t\t\t\t\"disabled\",\n\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst body = ctx.body;\n\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\t\tctx.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n\t\t\t\tctx.setHeader(\"Access-Control-Allow-Methods\", \"POST, OPTIONS\");\n\t\t\t\tctx.setHeader(\"Access-Control-Allow-Headers\", \"Content-Type, Authorization\");\n\t\t\t\tctx.setHeader(\"Access-Control-Max-Age\", \"86400\");\n\t\t\t\tctx.headers?.set(\"Access-Control-Max-Age\", \"86400\");\n\t\t\t\tif ((!body.grant_types || body.grant_types.includes(\"authorization_code\") || body.grant_types.includes(\"implicit\")) && (!body.redirect_uris || body.redirect_uris.length === 0)) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_redirect_uri\",\n\t\t\t\t\terror_description: \"Redirect URIs are required for authorization_code and implicit grant types\"\n\t\t\t\t});\n\t\t\t\tif (body.grant_types && body.response_types) {\n\t\t\t\t\tif (body.grant_types.includes(\"authorization_code\") && !body.response_types.includes(\"code\")) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_client_metadata\",\n\t\t\t\t\t\terror_description: \"When 'authorization_code' grant type is used, 'code' response type must be included\"\n\t\t\t\t\t});\n\t\t\t\t\tif (body.grant_types.includes(\"implicit\") && !body.response_types.includes(\"token\")) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_client_metadata\",\n\t\t\t\t\t\terror_description: \"When 'implicit' grant type is used, 'token' response type must be included\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst clientId = opts.generateClientId?.() || generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\tconst clientSecret = opts.generateClientSecret?.() || generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\tconst clientType = body.token_endpoint_auth_method === \"none\" ? \"public\" : \"web\";\n\t\t\t\tconst finalClientSecret = clientType === \"public\" ? \"\" : clientSecret;\n\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\tmodel: modelName.oauthClient,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tname: body.client_name,\n\t\t\t\t\t\ticon: body.logo_uri,\n\t\t\t\t\t\tmetadata: body.metadata ? JSON.stringify(body.metadata) : null,\n\t\t\t\t\t\tclientId,\n\t\t\t\t\t\tclientSecret: finalClientSecret,\n\t\t\t\t\t\tredirectUrls: body.redirect_uris.join(\",\"),\n\t\t\t\t\t\ttype: clientType,\n\t\t\t\t\t\tauthenticationScheme: body.token_endpoint_auth_method || \"client_secret_basic\",\n\t\t\t\t\t\tdisabled: false,\n\t\t\t\t\t\tuserId: session?.session.userId,\n\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tconst responseData = {\n\t\t\t\t\tclient_id: clientId,\n\t\t\t\t\tclient_id_issued_at: Math.floor(Date.now() / 1e3),\n\t\t\t\t\tredirect_uris: body.redirect_uris,\n\t\t\t\t\ttoken_endpoint_auth_method: body.token_endpoint_auth_method || \"client_secret_basic\",\n\t\t\t\t\tgrant_types: body.grant_types || [\"authorization_code\"],\n\t\t\t\t\tresponse_types: body.response_types || [\"code\"],\n\t\t\t\t\tclient_name: body.client_name,\n\t\t\t\t\tclient_uri: body.client_uri,\n\t\t\t\t\tlogo_uri: body.logo_uri,\n\t\t\t\t\tscope: body.scope,\n\t\t\t\t\tcontacts: body.contacts,\n\t\t\t\t\ttos_uri: body.tos_uri,\n\t\t\t\t\tpolicy_uri: body.policy_uri,\n\t\t\t\t\tjwks_uri: body.jwks_uri,\n\t\t\t\t\tjwks: body.jwks,\n\t\t\t\t\tsoftware_id: body.software_id,\n\t\t\t\t\tsoftware_version: body.software_version,\n\t\t\t\t\tsoftware_statement: body.software_statement,\n\t\t\t\t\tmetadata: body.metadata,\n\t\t\t\t\t...clientType !== \"public\" ? {\n\t\t\t\t\t\tclient_secret: finalClientSecret,\n\t\t\t\t\t\tclient_secret_expires_at: 0\n\t\t\t\t\t} : {}\n\t\t\t\t};\n\t\t\t\treturn new Response(JSON.stringify(responseData), {\n\t\t\t\t\tstatus: 201,\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t\t\"Cache-Control\": \"no-store\",\n\t\t\t\t\t\tPragma: \"no-cache\"\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}),\n\t\t\tgetMcpSession: createAuthEndpoint(\"/mcp/get-session\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\trequireHeaders: true\n\t\t\t}, async (c) => {\n\t\t\t\tconst accessToken = c.headers?.get(\"Authorization\")?.replace(\"Bearer \", \"\");\n\t\t\t\tif (!accessToken) {\n\t\t\t\t\tc.headers?.set(\"WWW-Authenticate\", \"Bearer\");\n\t\t\t\t\treturn c.json(null);\n\t\t\t\t}\n\t\t\t\tconst accessTokenData = await c.context.adapter.findOne({\n\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"accessToken\",\n\t\t\t\t\t\tvalue: accessToken\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!accessTokenData) return c.json(null);\n\t\t\t\treturn c.json(accessTokenData);\n\t\t\t})\n\t\t},\n\t\tschema\n\t};\n};\nconst withMcpAuth = (auth, handler) => {\n\treturn async (req) => {\n\t\tconst baseURL = getBaseURL(auth.options.baseURL, auth.options.basePath);\n\t\tif (!baseURL && !isProduction) logger.warn(\"Unable to get the baseURL, please check your config!\");\n\t\tconst session = await auth.api.getMcpSession({ headers: req.headers });\n\t\tconst wwwAuthenticateValue = `Bearer resource_metadata=\"${baseURL}/.well-known/oauth-protected-resource\"`;\n\t\tif (!session) return Response.json({\n\t\t\tjsonrpc: \"2.0\",\n\t\t\terror: {\n\t\t\t\tcode: -32e3,\n\t\t\t\tmessage: \"Unauthorized: Authentication required\",\n\t\t\t\t\"www-authenticate\": wwwAuthenticateValue\n\t\t\t},\n\t\t\tid: null\n\t\t}, {\n\t\t\tstatus: 401,\n\t\t\theaders: {\n\t\t\t\t\"WWW-Authenticate\": wwwAuthenticateValue,\n\t\t\t\t\"Access-Control-Expose-Headers\": \"WWW-Authenticate\"\n\t\t\t}\n\t\t});\n\t\treturn handler(req, session);\n\t};\n};\nconst oAuthDiscoveryMetadata = (auth) => {\n\treturn async (request) => {\n\t\tconst res = await auth.api.getMcpOAuthConfig();\n\t\treturn new Response(JSON.stringify(res), {\n\t\t\tstatus: 200,\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\"Access-Control-Allow-Origin\": \"*\",\n\t\t\t\t\"Access-Control-Allow-Methods\": \"POST, OPTIONS\",\n\t\t\t\t\"Access-Control-Allow-Headers\": \"Content-Type, Authorization\",\n\t\t\t\t\"Access-Control-Max-Age\": \"86400\"\n\t\t\t}\n\t\t});\n\t};\n};\nconst oAuthProtectedResourceMetadata = (auth) => {\n\treturn async (request) => {\n\t\tconst res = await auth.api.getMCPProtectedResource();\n\t\treturn new Response(JSON.stringify(res), {\n\t\t\tstatus: 200,\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\"Access-Control-Allow-Origin\": \"*\",\n\t\t\t\t\"Access-Control-Allow-Methods\": \"POST, OPTIONS\",\n\t\t\t\t\"Access-Control-Allow-Headers\": \"Content-Type, Authorization\",\n\t\t\t\t\"Access-Control-Max-Age\": \"86400\"\n\t\t\t}\n\t\t});\n\t};\n};\n\n//#endregion\nexport { getMCPProviderMetadata as a, oAuthProtectedResourceMetadata as c, API_KEY_TABLE_NAME as d, ERROR_CODES as f, getMCPProtectedResourceMetadata as i, withMcpAuth as l, defaultKeyHasher as m, createAuthMiddleware$1 as n, mcp as o, apiKey as p, optionsMiddleware as r, oAuthDiscoveryMetadata as s, createAuthEndpoint$1 as t, lastLoginMethod as u };"],"names":[],"mappings":"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","ignoreList":[0]}}]
}