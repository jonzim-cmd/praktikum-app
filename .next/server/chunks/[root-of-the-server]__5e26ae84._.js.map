{"version":3,"sources":["../../../node_modules/next/src/server/route-modules/app-route/module.compiled.js","../../../node_modules/next/dist/compiled/%40opentelemetry/api/index.js","../../../node_modules/next/dist/compiled/cookie/index.js","../../../node_modules/%40better-auth/core/dist/api/index.mjs","../../../node_modules/next/dist/esm/client/components/hooks-server-context.js","../../../node_modules/next/dist/esm/client/components/static-generation-bailout.js","../../../node_modules/next/dist/esm/shared/lib/lazy-dynamic/bailout-to-csr.js","../../../node_modules/next/dist/esm/server/lib/clone-response.js","../../../node_modules/next/dist/esm/shared/lib/segment-cache/output-export-prefetch-encoding.js","../../../node_modules/next/dist/esm/shared/lib/i18n/normalize-locale-path.js","../../../node_modules/next/dist/esm/server/web/spec-extension/cookies.js","../../../node_modules/next/dist/esm/server/client-component-renderer-logger.js","../../../node_modules/next/dist/esm/build/templates/app-route.js","../../../node_modules/better-auth/dist/index.mjs","../../../node_modules/better-auth/dist/schema-Bb7wzeK_.mjs","../../../node_modules/better-auth/dist/get-request-ip-D6st-mto.mjs","../../../node_modules/zod/index.js","../../../node_modules/%40better-auth/utils/dist/binary.mjs","../../../node_modules/%40better-auth/utils/dist/hmac.mjs","../../../node_modules/better-auth/node_modules/ms/dist/index.js","../../../node_modules/next/dist/esm/server/lib/trace/constants.js","../../../node_modules/%40better-fetch/fetch/dist/index.js","../../../node_modules/jose/dist/webapi/jwks/remote.js","../../../node_modules/jose/dist/webapi/jwks/local.js","../../../node_modules/jose/dist/webapi/util/decode_jwt.js","../../../node_modules/defu/dist/defu.mjs","../../../node_modules/drizzle-orm/entity.js","../../../node_modules/drizzle-orm/table.utils.js","../../../node_modules/drizzle-orm/tracing-utils.js","../../../node_modules/drizzle-orm/pg-core/utils/array.js","../../../node_modules/drizzle-orm/version.js","../../../node_modules/drizzle-orm/view-common.js","../../../node_modules/better-auth/dist/parser-pHp5yoAv.mjs","../../../node_modules/better-auth/dist/permission-JwliMugl.mjs","../../../node_modules/better-auth/dist/client-CMPEe5-e.mjs","../../../node_modules/%40better-auth/utils/dist/base32.mjs","../../../node_modules/postgres/src/index.js","../../../node_modules/postgres/src/query.js","../../../node_modules/postgres/src/connection.js","../../../node_modules/postgres/src/bytes.js","../../../node_modules/postgres/src/subscribe.js","../../../node_modules/drizzle-orm/pg-core/columns/postgis_extension/utils.js","../../../node_modules/drizzle-orm/pg-core/view-common.js","../../../node_modules/next/dist/esm/server/app-render/dynamic-rendering.js","../../../node_modules/postgres/src/errors.js","../../../node_modules/next/dist/esm/shared/lib/promise-with-resolvers.js","../../../node_modules/next/dist/esm/server/web/error.js","../../../node_modules/next/dist/esm/lib/framework/boundary-constants.js","../../../node_modules/next/dist/esm/server/dynamic-rendering-utils.js","../../../node_modules/next/dist/esm/server/response-cache/types.js","../../../node_modules/next/dist/esm/shared/lib/segment.js","../../../node_modules/next/dist/esm/server/web/spec-extension/adapters/reflect.js","../../../node_modules/next/dist/esm/client/components/redirect-status-code.js","../../../node_modules/next/dist/esm/server/instrumentation/utils.js","../../../node_modules/next/dist/esm/lib/constants.js","../../../node_modules/next/dist/esm/server/stream-utils/encoded-tags.js","../../../node_modules/next/dist/esm/shared/lib/errors/constants.js","../../../node_modules/next/dist/esm/server/route-kind.js","../../../node_modules/next/dist/esm/shared/lib/invariant-error.js","../../../node_modules/next/dist/esm/client/components/app-router-headers.js","../../../node_modules/next/dist/esm/shared/lib/i18n/detect-domain-locale.js","../../../node_modules/postgres/src/result.js","../../../node_modules/postgres/src/queue.js","../../../node_modules/drizzle-orm/cache/core/cache.js","../../../node_modules/drizzle-orm/column.js","../../../node_modules/drizzle-orm/column-builder.js","../../../node_modules/drizzle-orm/subquery.js","../../../node_modules/drizzle-orm/sql/expressions/select.js","../../../node_modules/jose/dist/webapi/key/generate_key_pair.js","../../../node_modules/drizzle-orm/logger.js","../../../node_modules/drizzle-orm/query-promise.js","../../../node_modules/drizzle-orm/pg-core/checks.js","../../../node_modules/drizzle-orm/pg-core/policies.js","../../../node_modules/drizzle-orm/errors.js","../../../node_modules/drizzle-orm/query-builders/query-builder.js","../../../node_modules/next/dist/esm/shared/lib/router/utils/cache-busting-search-param.js","../../../node_modules/next/dist/esm/server/request-meta.js","../../../node_modules/next/dist/esm/server/lib/cache-control.js","../../../node_modules/drizzle-orm/pg-core/unique-constraint.js","../../../node_modules/drizzle-orm/table.js","../../../node_modules/better-auth/dist/get-migration-Bf0TuCzm.mjs","../../../node_modules/better-auth/dist/plugin-helper-zFdFWLgL.mjs","../../../node_modules/drizzle-orm/pg-core/foreign-keys.js","../../../node_modules/next/dist/esm/server/lib/trace/tracer.js","../../../node_modules/drizzle-orm/pg-core/columns/enum.js","../../../node_modules/%40better-auth/core/dist/social-providers/index.mjs","../../../node_modules/drizzle-orm/tracing.js","../../../node_modules/better-auth/dist/access-vPNO48H4.mjs","../../../node_modules/drizzle-orm/pg-core/columns/boolean.js","../../../node_modules/drizzle-orm/pg-core/columns/cidr.js","../../../node_modules/drizzle-orm/pg-core/columns/double-precision.js","../../../node_modules/drizzle-orm/pg-core/columns/inet.js","../../../node_modules/drizzle-orm/pg-core/columns/json.js","../../../node_modules/drizzle-orm/pg-core/columns/jsonb.js","../../../node_modules/drizzle-orm/pg-core/columns/macaddr.js","../../../node_modules/drizzle-orm/pg-core/columns/macaddr8.js","../../../node_modules/better-auth/dist/access-Dx8TLKnw.mjs","../../../node_modules/better-auth/dist/access-h-uttVNZ.mjs","../../../node_modules/drizzle-orm/pg-core/columns/real.js","../../../node_modules/drizzle-orm/pg-core/columns/serial.js","../../../node_modules/drizzle-orm/pg-core/columns/smallserial.js","../../../node_modules/better-auth/dist/password-BFQK0cLg.mjs","../../../node_modules/%40better-auth/core/dist/db/index.mjs","../../../node_modules/drizzle-orm/pg-core/primary-keys.js","../../../node_modules/better-auth/dist/has-permission-qCjQqGds.mjs","../../../node_modules/drizzle-orm/casing.js","../../../node_modules/drizzle-orm/pg-core/view-base.js","../../../node_modules/drizzle-orm/pg-core/query-builders/count.js","../../../node_modules/drizzle-orm/pg-core/query-builders/raw.js","../../../src/lib/db/index.ts","../../../node_modules/drizzle-orm/pg-core/columns/int.common.js","../../../node_modules/next/dist/esm/server/base-http/index.js","../../../node_modules/next/dist/esm/server/app-render/staged-rendering.js","../../../node_modules/next/dist/esm/server/stream-utils/uint8array-helpers.js","../../../node_modules/postgres/src/large.js","../../../node_modules/drizzle-orm/pg-core/columns/char.js","../../../node_modules/%40better-auth/telemetry/dist/index.mjs","../../../node_modules/next/dist/esm/server/app-render/encryption-utils.js","../../../node_modules/better-auth/dist/url-CB8xCwz-.mjs","../../../node_modules/drizzle-orm/pg-core/columns/custom.js","../../../node_modules/drizzle-orm/pg-core/columns/date.common.js","../../../node_modules/drizzle-orm/pg-core/columns/integer.js","../../../node_modules/drizzle-orm/pg-core/columns/interval.js","../../../node_modules/drizzle-orm/pg-core/columns/line.js","../../../node_modules/drizzle-orm/pg-core/columns/numeric.js","../../../node_modules/drizzle-orm/pg-core/columns/point.js","../../../node_modules/drizzle-orm/pg-core/columns/smallint.js","../../../node_modules/drizzle-orm/pg-core/columns/text.js","../../../node_modules/drizzle-orm/pg-core/columns/uuid.js","../../../node_modules/drizzle-orm/pg-core/columns/varchar.js","../../../node_modules/drizzle-orm/pg-core/columns/vector_extension/bit.js","../../../node_modules/drizzle-orm/pg-core/columns/vector_extension/halfvec.js","../../../node_modules/drizzle-orm/pg-core/columns/vector_extension/sparsevec.js","../../../node_modules/drizzle-orm/pg-core/columns/vector_extension/vector.js","../../../node_modules/drizzle-orm/pg-core/table.js","../../../node_modules/drizzle-orm/pg-core/indexes.js","../../../node_modules/next/dist/esm/server/base-http/node.js","../../../node_modules/drizzle-orm/sql/functions/aggregate.js","../../../node_modules/drizzle-orm/pg-core/query-builders/refresh-materialized-view.js","../../../node_modules/drizzle-orm/pg-core/columns/bigserial.js","../../../src/lib/db/schema/notifications.ts","../../../node_modules/next/dist/esm/shared/lib/router/utils/get-next-pathname-info.js","../../../node_modules/postgres/src/types.js","../../../node_modules/jose/dist/webapi/util/decode_protected_header.js","../../../src/app/api/auth/%5B...all%5D/route.ts","../../../src/lib/db/schema/users.ts","../../../src/lib/db/schema/milestones.ts","../../../node_modules/next/dist/esm/server/web/spec-extension/adapters/headers.js","../../../node_modules/next/dist/esm/server/api-utils/get-cookie-parser.js","../../../node_modules/next/dist/esm/shared/lib/page-path/ensure-leading-slash.js","../../../node_modules/next/dist/esm/server/render-result.js","../../../node_modules/drizzle-orm/pg-core/columns/date.js","../../../node_modules/better-auth/dist/captcha-Dbvurc2Z.mjs","../../../node_modules/%40better-auth/core/dist/oauth2-B2XPHgx5.mjs","../../../node_modules/drizzle-orm/pg-core/columns/postgis_extension/geometry.js","../../../node_modules/drizzle-orm/pg-core/columns/time.js","../../../node_modules/next/dist/esm/server/web/next-url.js","../../../node_modules/drizzle-orm/pg-core/columns/bigint.js","../../../node_modules/drizzle-orm/pg-core/columns/timestamp.js","../../../src/lib/db/schema/audit-logs.ts","../../../node_modules/next/dist/esm/server/response-cache/utils.js","../../../node_modules/next/dist/esm/server/web/spec-extension/request.js","../../../src/lib/db/schema/students.ts","../../../src/lib/db/schema/companies.ts","../../../node_modules/next/dist/esm/server/web/spec-extension/adapters/next-request.js","../../../src/lib/db/schema/assessments.ts","../../../node_modules/next/dist/esm/server/api-utils/index.js","../../../node_modules/next/dist/esm/shared/lib/router/utils/format-next-pathname-info.js","../../../node_modules/next/dist/esm/shared/lib/router/utils/parse-path.js","../../../node_modules/next/dist/esm/lib/batcher.js","../../../node_modules/next/dist/esm/shared/lib/router/utils/add-path-prefix.js","../../../node_modules/next/dist/esm/server/response-cache/index.js","../../../node_modules/better-auth/dist/bearer-C6RSCXv_.mjs","../../../node_modules/better-auth/dist/custom-session-CaUbM_of.mjs","../../../node_modules/better-auth/dist/open-api-DZG02vyi.mjs","../../../node_modules/better-auth/dist/siwe-D81Y4fkp.mjs","../../../node_modules/better-auth/dist/adapters/drizzle-adapter/index.mjs","../../../node_modules/next/dist/esm/server/lib/dedupe-fetch.js","../../../node_modules/drizzle-orm/pg-core/query-builders/query-builder.js","../../../node_modules/drizzle-orm/alias.js","../../../node_modules/better-auth/dist/auth-DfR8_5w3.mjs","../../../node_modules/next/dist/esm/server/pipe-readable.js","../../../node_modules/next/dist/esm/lib/scheduler.js","../../../node_modules/next/dist/esm/shared/lib/router/utils/add-path-suffix.js","../../../node_modules/next/dist/esm/shared/lib/get-hostname.js","../../../node_modules/next/dist/esm/shared/lib/is-thenable.js","../../../node_modules/next/dist/esm/lib/detached-promise.js","../../../node_modules/drizzle-orm/selection-proxy.js","../../../node_modules/drizzle-orm/utils.js","../../../node_modules/drizzle-orm/pg-core/query-builders/query.js","../../../node_modules/drizzle-orm/pg-core/session.js","../../../node_modules/%40better-auth/utils/dist/otp.mjs","../../../node_modules/better-auth/dist/haveibeenpwned-BSsFUFTi.mjs","../../../node_modules/better-auth/dist/one-tap-Bz8Q39Od.mjs","../../../src/lib/auth/index.ts","../../../src/lib/db/schema/internships.ts","../../../src/lib/db/schema/documents.ts","../../../node_modules/next/dist/esm/shared/lib/router/utils/remove-trailing-slash.js","../../../node_modules/next/dist/esm/shared/lib/router/utils/add-locale.js","../../../node_modules/better-auth/dist/jwt-Ar1sciI2.mjs","../../../node_modules/better-auth/dist/cookies-D72PbWdz.mjs","../../../node_modules/drizzle-orm/pg-core/view.js","../../../node_modules/drizzle-orm/pg-core/columns/common.js","../../../node_modules/drizzle-orm/pg-core/query-builders/delete.js","../../../node_modules/drizzle-orm/sql/sql.js","../../../node_modules/better-auth/dist/multi-session-CbEYz_wJ.mjs","../../../node_modules/better-auth/dist/one-time-token-C8YQxf38.mjs","../../../node_modules/better-auth/dist/integrations/next-js.mjs","../../../node_modules/next/dist/esm/shared/lib/hash.js","../../../node_modules/next/dist/esm/shared/lib/router/utils/path-has-prefix.js","../../../node_modules/drizzle-orm/postgres-js/session.js","../../../node_modules/better-auth/dist/magic-link-QdHvtdfs.mjs","../../../node_modules/next/dist/esm/server/app-render/action-utils.js","../../../node_modules/next/dist/esm/shared/lib/router/utils/remove-path-prefix.js","../../../node_modules/better-auth/dist/username-C_wmkXwt.mjs","../../../node_modules/drizzle-orm/pg-core/query-builders/insert.js","../../../node_modules/better-auth/dist/anonymous-DxoIOUPc.mjs","../../../node_modules/better-auth/dist/device-authorization-9_f1Up5D.mjs","../../../node_modules/better-auth/dist/oauth-proxy-Dz1E1SVN.mjs","../../../node_modules/next/dist/esm/server/web/utils.js","../../../node_modules/next/dist/esm/server/send-response.js","../../../node_modules/next/dist/esm/server/stream-utils/node-web-streams-helper.js","../../../node_modules/next/dist/esm/server/lib/patch-fetch.js","../../../node_modules/better-auth/dist/phone-number-wU9XYnr8.mjs","../../../node_modules/next/dist/esm/server/base-http/helpers.js","../../../node_modules/better-auth/dist/admin-D-OMdNIc.mjs","../../../node_modules/drizzle-orm/postgres-js/driver.js","../../../node_modules/better-auth/dist/session-AaRl3_x-.mjs","../../../node_modules/better-auth/dist/generic-oauth-BGbWWUh9.mjs","../../../node_modules/drizzle-orm/sql/expressions/conditions.js","../../../node_modules/better-auth/dist/api-CkmycQ2x.mjs","../../../node_modules/better-auth/dist/email-otp-CiznqFUN.mjs","../../../node_modules/better-auth/dist/oidc-provider-B9SsN23J.mjs","../../../node_modules/drizzle-orm/pg-core/utils.js","../../../node_modules/drizzle-orm/pg-core/query-builders/update.js","../../../node_modules/better-auth/dist/base-CiRMFqet.mjs","../../../node_modules/drizzle-orm/pg-core/db.js","../../../node_modules/better-auth/dist/two-factor-BDQvVILL.mjs","../../../node_modules/better-auth/dist/organization-BdJSRNgM.mjs","../../../node_modules/drizzle-orm/pg-core/query-builders/select.js","../../../node_modules/next/dist/esm/shared/lib/router/utils/app-paths.js","../../../node_modules/better-auth/dist/plugins-DgSTpOzm.mjs","../../../node_modules/%40noble/hashes/src/sha3.ts","../../../node_modules/drizzle-orm/relations.js","../../../node_modules/drizzle-orm/pg-core/columns/all.js","../../../node_modules/drizzle-orm/pg-core/dialect.js","../../../src/lib/db/schema/schools.ts","../../../node_modules/%40better-fetch/fetch/src/utils.ts","../../../node_modules/src/pg-core/view.ts"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-route/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-route-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-route-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-route-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-route-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-route-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-route.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-route-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-route.runtime.prod.js')\n      }\n    }\n  }\n}\n","(()=>{\"use strict\";var e={491:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.ContextAPI=void 0;const n=r(223);const a=r(172);const o=r(930);const i=\"context\";const c=new n.NoopContextManager;class ContextAPI{constructor(){}static getInstance(){if(!this._instance){this._instance=new ContextAPI}return this._instance}setGlobalContextManager(e){return(0,a.registerGlobal)(i,e,o.DiagAPI.instance())}active(){return this._getContextManager().active()}with(e,t,r,...n){return this._getContextManager().with(e,t,r,...n)}bind(e,t){return this._getContextManager().bind(e,t)}_getContextManager(){return(0,a.getGlobal)(i)||c}disable(){this._getContextManager().disable();(0,a.unregisterGlobal)(i,o.DiagAPI.instance())}}t.ContextAPI=ContextAPI},930:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.DiagAPI=void 0;const n=r(56);const a=r(912);const o=r(957);const i=r(172);const c=\"diag\";class DiagAPI{constructor(){function _logProxy(e){return function(...t){const r=(0,i.getGlobal)(\"diag\");if(!r)return;return r[e](...t)}}const e=this;const setLogger=(t,r={logLevel:o.DiagLogLevel.INFO})=>{var n,c,s;if(t===e){const t=new Error(\"Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation\");e.error((n=t.stack)!==null&&n!==void 0?n:t.message);return false}if(typeof r===\"number\"){r={logLevel:r}}const u=(0,i.getGlobal)(\"diag\");const l=(0,a.createLogLevelDiagLogger)((c=r.logLevel)!==null&&c!==void 0?c:o.DiagLogLevel.INFO,t);if(u&&!r.suppressOverrideMessage){const e=(s=(new Error).stack)!==null&&s!==void 0?s:\"<failed to generate stacktrace>\";u.warn(`Current logger will be overwritten from ${e}`);l.warn(`Current logger will overwrite one already registered from ${e}`)}return(0,i.registerGlobal)(\"diag\",l,e,true)};e.setLogger=setLogger;e.disable=()=>{(0,i.unregisterGlobal)(c,e)};e.createComponentLogger=e=>new n.DiagComponentLogger(e);e.verbose=_logProxy(\"verbose\");e.debug=_logProxy(\"debug\");e.info=_logProxy(\"info\");e.warn=_logProxy(\"warn\");e.error=_logProxy(\"error\")}static instance(){if(!this._instance){this._instance=new DiagAPI}return this._instance}}t.DiagAPI=DiagAPI},653:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.MetricsAPI=void 0;const n=r(660);const a=r(172);const o=r(930);const i=\"metrics\";class MetricsAPI{constructor(){}static getInstance(){if(!this._instance){this._instance=new MetricsAPI}return this._instance}setGlobalMeterProvider(e){return(0,a.registerGlobal)(i,e,o.DiagAPI.instance())}getMeterProvider(){return(0,a.getGlobal)(i)||n.NOOP_METER_PROVIDER}getMeter(e,t,r){return this.getMeterProvider().getMeter(e,t,r)}disable(){(0,a.unregisterGlobal)(i,o.DiagAPI.instance())}}t.MetricsAPI=MetricsAPI},181:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.PropagationAPI=void 0;const n=r(172);const a=r(874);const o=r(194);const i=r(277);const c=r(369);const s=r(930);const u=\"propagation\";const l=new a.NoopTextMapPropagator;class PropagationAPI{constructor(){this.createBaggage=c.createBaggage;this.getBaggage=i.getBaggage;this.getActiveBaggage=i.getActiveBaggage;this.setBaggage=i.setBaggage;this.deleteBaggage=i.deleteBaggage}static getInstance(){if(!this._instance){this._instance=new PropagationAPI}return this._instance}setGlobalPropagator(e){return(0,n.registerGlobal)(u,e,s.DiagAPI.instance())}inject(e,t,r=o.defaultTextMapSetter){return this._getGlobalPropagator().inject(e,t,r)}extract(e,t,r=o.defaultTextMapGetter){return this._getGlobalPropagator().extract(e,t,r)}fields(){return this._getGlobalPropagator().fields()}disable(){(0,n.unregisterGlobal)(u,s.DiagAPI.instance())}_getGlobalPropagator(){return(0,n.getGlobal)(u)||l}}t.PropagationAPI=PropagationAPI},997:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.TraceAPI=void 0;const n=r(172);const a=r(846);const o=r(139);const i=r(607);const c=r(930);const s=\"trace\";class TraceAPI{constructor(){this._proxyTracerProvider=new a.ProxyTracerProvider;this.wrapSpanContext=o.wrapSpanContext;this.isSpanContextValid=o.isSpanContextValid;this.deleteSpan=i.deleteSpan;this.getSpan=i.getSpan;this.getActiveSpan=i.getActiveSpan;this.getSpanContext=i.getSpanContext;this.setSpan=i.setSpan;this.setSpanContext=i.setSpanContext}static getInstance(){if(!this._instance){this._instance=new TraceAPI}return this._instance}setGlobalTracerProvider(e){const t=(0,n.registerGlobal)(s,this._proxyTracerProvider,c.DiagAPI.instance());if(t){this._proxyTracerProvider.setDelegate(e)}return t}getTracerProvider(){return(0,n.getGlobal)(s)||this._proxyTracerProvider}getTracer(e,t){return this.getTracerProvider().getTracer(e,t)}disable(){(0,n.unregisterGlobal)(s,c.DiagAPI.instance());this._proxyTracerProvider=new a.ProxyTracerProvider}}t.TraceAPI=TraceAPI},277:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.deleteBaggage=t.setBaggage=t.getActiveBaggage=t.getBaggage=void 0;const n=r(491);const a=r(780);const o=(0,a.createContextKey)(\"OpenTelemetry Baggage Key\");function getBaggage(e){return e.getValue(o)||undefined}t.getBaggage=getBaggage;function getActiveBaggage(){return getBaggage(n.ContextAPI.getInstance().active())}t.getActiveBaggage=getActiveBaggage;function setBaggage(e,t){return e.setValue(o,t)}t.setBaggage=setBaggage;function deleteBaggage(e){return e.deleteValue(o)}t.deleteBaggage=deleteBaggage},993:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.BaggageImpl=void 0;class BaggageImpl{constructor(e){this._entries=e?new Map(e):new Map}getEntry(e){const t=this._entries.get(e);if(!t){return undefined}return Object.assign({},t)}getAllEntries(){return Array.from(this._entries.entries()).map((([e,t])=>[e,t]))}setEntry(e,t){const r=new BaggageImpl(this._entries);r._entries.set(e,t);return r}removeEntry(e){const t=new BaggageImpl(this._entries);t._entries.delete(e);return t}removeEntries(...e){const t=new BaggageImpl(this._entries);for(const r of e){t._entries.delete(r)}return t}clear(){return new BaggageImpl}}t.BaggageImpl=BaggageImpl},830:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.baggageEntryMetadataSymbol=void 0;t.baggageEntryMetadataSymbol=Symbol(\"BaggageEntryMetadata\")},369:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.baggageEntryMetadataFromString=t.createBaggage=void 0;const n=r(930);const a=r(993);const o=r(830);const i=n.DiagAPI.instance();function createBaggage(e={}){return new a.BaggageImpl(new Map(Object.entries(e)))}t.createBaggage=createBaggage;function baggageEntryMetadataFromString(e){if(typeof e!==\"string\"){i.error(`Cannot create baggage metadata from unknown type: ${typeof e}`);e=\"\"}return{__TYPE__:o.baggageEntryMetadataSymbol,toString(){return e}}}t.baggageEntryMetadataFromString=baggageEntryMetadataFromString},67:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.context=void 0;const n=r(491);t.context=n.ContextAPI.getInstance()},223:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.NoopContextManager=void 0;const n=r(780);class NoopContextManager{active(){return n.ROOT_CONTEXT}with(e,t,r,...n){return t.call(r,...n)}bind(e,t){return t}enable(){return this}disable(){return this}}t.NoopContextManager=NoopContextManager},780:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.ROOT_CONTEXT=t.createContextKey=void 0;function createContextKey(e){return Symbol.for(e)}t.createContextKey=createContextKey;class BaseContext{constructor(e){const t=this;t._currentContext=e?new Map(e):new Map;t.getValue=e=>t._currentContext.get(e);t.setValue=(e,r)=>{const n=new BaseContext(t._currentContext);n._currentContext.set(e,r);return n};t.deleteValue=e=>{const r=new BaseContext(t._currentContext);r._currentContext.delete(e);return r}}}t.ROOT_CONTEXT=new BaseContext},506:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.diag=void 0;const n=r(930);t.diag=n.DiagAPI.instance()},56:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.DiagComponentLogger=void 0;const n=r(172);class DiagComponentLogger{constructor(e){this._namespace=e.namespace||\"DiagComponentLogger\"}debug(...e){return logProxy(\"debug\",this._namespace,e)}error(...e){return logProxy(\"error\",this._namespace,e)}info(...e){return logProxy(\"info\",this._namespace,e)}warn(...e){return logProxy(\"warn\",this._namespace,e)}verbose(...e){return logProxy(\"verbose\",this._namespace,e)}}t.DiagComponentLogger=DiagComponentLogger;function logProxy(e,t,r){const a=(0,n.getGlobal)(\"diag\");if(!a){return}r.unshift(t);return a[e](...r)}},972:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.DiagConsoleLogger=void 0;const r=[{n:\"error\",c:\"error\"},{n:\"warn\",c:\"warn\"},{n:\"info\",c:\"info\"},{n:\"debug\",c:\"debug\"},{n:\"verbose\",c:\"trace\"}];class DiagConsoleLogger{constructor(){function _consoleFunc(e){return function(...t){if(console){let r=console[e];if(typeof r!==\"function\"){r=console.log}if(typeof r===\"function\"){return r.apply(console,t)}}}}for(let e=0;e<r.length;e++){this[r[e].n]=_consoleFunc(r[e].c)}}}t.DiagConsoleLogger=DiagConsoleLogger},912:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.createLogLevelDiagLogger=void 0;const n=r(957);function createLogLevelDiagLogger(e,t){if(e<n.DiagLogLevel.NONE){e=n.DiagLogLevel.NONE}else if(e>n.DiagLogLevel.ALL){e=n.DiagLogLevel.ALL}t=t||{};function _filterFunc(r,n){const a=t[r];if(typeof a===\"function\"&&e>=n){return a.bind(t)}return function(){}}return{error:_filterFunc(\"error\",n.DiagLogLevel.ERROR),warn:_filterFunc(\"warn\",n.DiagLogLevel.WARN),info:_filterFunc(\"info\",n.DiagLogLevel.INFO),debug:_filterFunc(\"debug\",n.DiagLogLevel.DEBUG),verbose:_filterFunc(\"verbose\",n.DiagLogLevel.VERBOSE)}}t.createLogLevelDiagLogger=createLogLevelDiagLogger},957:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.DiagLogLevel=void 0;var r;(function(e){e[e[\"NONE\"]=0]=\"NONE\";e[e[\"ERROR\"]=30]=\"ERROR\";e[e[\"WARN\"]=50]=\"WARN\";e[e[\"INFO\"]=60]=\"INFO\";e[e[\"DEBUG\"]=70]=\"DEBUG\";e[e[\"VERBOSE\"]=80]=\"VERBOSE\";e[e[\"ALL\"]=9999]=\"ALL\"})(r=t.DiagLogLevel||(t.DiagLogLevel={}))},172:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.unregisterGlobal=t.getGlobal=t.registerGlobal=void 0;const n=r(200);const a=r(521);const o=r(130);const i=a.VERSION.split(\".\")[0];const c=Symbol.for(`opentelemetry.js.api.${i}`);const s=n._globalThis;function registerGlobal(e,t,r,n=false){var o;const i=s[c]=(o=s[c])!==null&&o!==void 0?o:{version:a.VERSION};if(!n&&i[e]){const t=new Error(`@opentelemetry/api: Attempted duplicate registration of API: ${e}`);r.error(t.stack||t.message);return false}if(i.version!==a.VERSION){const t=new Error(`@opentelemetry/api: Registration of version v${i.version} for ${e} does not match previously registered API v${a.VERSION}`);r.error(t.stack||t.message);return false}i[e]=t;r.debug(`@opentelemetry/api: Registered a global for ${e} v${a.VERSION}.`);return true}t.registerGlobal=registerGlobal;function getGlobal(e){var t,r;const n=(t=s[c])===null||t===void 0?void 0:t.version;if(!n||!(0,o.isCompatible)(n)){return}return(r=s[c])===null||r===void 0?void 0:r[e]}t.getGlobal=getGlobal;function unregisterGlobal(e,t){t.debug(`@opentelemetry/api: Unregistering a global for ${e} v${a.VERSION}.`);const r=s[c];if(r){delete r[e]}}t.unregisterGlobal=unregisterGlobal},130:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.isCompatible=t._makeCompatibilityCheck=void 0;const n=r(521);const a=/^(\\d+)\\.(\\d+)\\.(\\d+)(-(.+))?$/;function _makeCompatibilityCheck(e){const t=new Set([e]);const r=new Set;const n=e.match(a);if(!n){return()=>false}const o={major:+n[1],minor:+n[2],patch:+n[3],prerelease:n[4]};if(o.prerelease!=null){return function isExactmatch(t){return t===e}}function _reject(e){r.add(e);return false}function _accept(e){t.add(e);return true}return function isCompatible(e){if(t.has(e)){return true}if(r.has(e)){return false}const n=e.match(a);if(!n){return _reject(e)}const i={major:+n[1],minor:+n[2],patch:+n[3],prerelease:n[4]};if(i.prerelease!=null){return _reject(e)}if(o.major!==i.major){return _reject(e)}if(o.major===0){if(o.minor===i.minor&&o.patch<=i.patch){return _accept(e)}return _reject(e)}if(o.minor<=i.minor){return _accept(e)}return _reject(e)}}t._makeCompatibilityCheck=_makeCompatibilityCheck;t.isCompatible=_makeCompatibilityCheck(n.VERSION)},886:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.metrics=void 0;const n=r(653);t.metrics=n.MetricsAPI.getInstance()},901:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.ValueType=void 0;var r;(function(e){e[e[\"INT\"]=0]=\"INT\";e[e[\"DOUBLE\"]=1]=\"DOUBLE\"})(r=t.ValueType||(t.ValueType={}))},102:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.createNoopMeter=t.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC=t.NOOP_OBSERVABLE_GAUGE_METRIC=t.NOOP_OBSERVABLE_COUNTER_METRIC=t.NOOP_UP_DOWN_COUNTER_METRIC=t.NOOP_HISTOGRAM_METRIC=t.NOOP_COUNTER_METRIC=t.NOOP_METER=t.NoopObservableUpDownCounterMetric=t.NoopObservableGaugeMetric=t.NoopObservableCounterMetric=t.NoopObservableMetric=t.NoopHistogramMetric=t.NoopUpDownCounterMetric=t.NoopCounterMetric=t.NoopMetric=t.NoopMeter=void 0;class NoopMeter{constructor(){}createHistogram(e,r){return t.NOOP_HISTOGRAM_METRIC}createCounter(e,r){return t.NOOP_COUNTER_METRIC}createUpDownCounter(e,r){return t.NOOP_UP_DOWN_COUNTER_METRIC}createObservableGauge(e,r){return t.NOOP_OBSERVABLE_GAUGE_METRIC}createObservableCounter(e,r){return t.NOOP_OBSERVABLE_COUNTER_METRIC}createObservableUpDownCounter(e,r){return t.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC}addBatchObservableCallback(e,t){}removeBatchObservableCallback(e){}}t.NoopMeter=NoopMeter;class NoopMetric{}t.NoopMetric=NoopMetric;class NoopCounterMetric extends NoopMetric{add(e,t){}}t.NoopCounterMetric=NoopCounterMetric;class NoopUpDownCounterMetric extends NoopMetric{add(e,t){}}t.NoopUpDownCounterMetric=NoopUpDownCounterMetric;class NoopHistogramMetric extends NoopMetric{record(e,t){}}t.NoopHistogramMetric=NoopHistogramMetric;class NoopObservableMetric{addCallback(e){}removeCallback(e){}}t.NoopObservableMetric=NoopObservableMetric;class NoopObservableCounterMetric extends NoopObservableMetric{}t.NoopObservableCounterMetric=NoopObservableCounterMetric;class NoopObservableGaugeMetric extends NoopObservableMetric{}t.NoopObservableGaugeMetric=NoopObservableGaugeMetric;class NoopObservableUpDownCounterMetric extends NoopObservableMetric{}t.NoopObservableUpDownCounterMetric=NoopObservableUpDownCounterMetric;t.NOOP_METER=new NoopMeter;t.NOOP_COUNTER_METRIC=new NoopCounterMetric;t.NOOP_HISTOGRAM_METRIC=new NoopHistogramMetric;t.NOOP_UP_DOWN_COUNTER_METRIC=new NoopUpDownCounterMetric;t.NOOP_OBSERVABLE_COUNTER_METRIC=new NoopObservableCounterMetric;t.NOOP_OBSERVABLE_GAUGE_METRIC=new NoopObservableGaugeMetric;t.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC=new NoopObservableUpDownCounterMetric;function createNoopMeter(){return t.NOOP_METER}t.createNoopMeter=createNoopMeter},660:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.NOOP_METER_PROVIDER=t.NoopMeterProvider=void 0;const n=r(102);class NoopMeterProvider{getMeter(e,t,r){return n.NOOP_METER}}t.NoopMeterProvider=NoopMeterProvider;t.NOOP_METER_PROVIDER=new NoopMeterProvider},200:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var a=this&&this.__exportStar||function(e,t){for(var r in e)if(r!==\"default\"&&!Object.prototype.hasOwnProperty.call(t,r))n(t,e,r)};Object.defineProperty(t,\"__esModule\",{value:true});a(r(46),t)},651:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:true});t._globalThis=void 0;t._globalThis=typeof globalThis===\"object\"?globalThis:global},46:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var a=this&&this.__exportStar||function(e,t){for(var r in e)if(r!==\"default\"&&!Object.prototype.hasOwnProperty.call(t,r))n(t,e,r)};Object.defineProperty(t,\"__esModule\",{value:true});a(r(651),t)},939:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.propagation=void 0;const n=r(181);t.propagation=n.PropagationAPI.getInstance()},874:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.NoopTextMapPropagator=void 0;class NoopTextMapPropagator{inject(e,t){}extract(e,t){return e}fields(){return[]}}t.NoopTextMapPropagator=NoopTextMapPropagator},194:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.defaultTextMapSetter=t.defaultTextMapGetter=void 0;t.defaultTextMapGetter={get(e,t){if(e==null){return undefined}return e[t]},keys(e){if(e==null){return[]}return Object.keys(e)}};t.defaultTextMapSetter={set(e,t,r){if(e==null){return}e[t]=r}}},845:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.trace=void 0;const n=r(997);t.trace=n.TraceAPI.getInstance()},403:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.NonRecordingSpan=void 0;const n=r(476);class NonRecordingSpan{constructor(e=n.INVALID_SPAN_CONTEXT){this._spanContext=e}spanContext(){return this._spanContext}setAttribute(e,t){return this}setAttributes(e){return this}addEvent(e,t){return this}setStatus(e){return this}updateName(e){return this}end(e){}isRecording(){return false}recordException(e,t){}}t.NonRecordingSpan=NonRecordingSpan},614:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.NoopTracer=void 0;const n=r(491);const a=r(607);const o=r(403);const i=r(139);const c=n.ContextAPI.getInstance();class NoopTracer{startSpan(e,t,r=c.active()){const n=Boolean(t===null||t===void 0?void 0:t.root);if(n){return new o.NonRecordingSpan}const s=r&&(0,a.getSpanContext)(r);if(isSpanContext(s)&&(0,i.isSpanContextValid)(s)){return new o.NonRecordingSpan(s)}else{return new o.NonRecordingSpan}}startActiveSpan(e,t,r,n){let o;let i;let s;if(arguments.length<2){return}else if(arguments.length===2){s=t}else if(arguments.length===3){o=t;s=r}else{o=t;i=r;s=n}const u=i!==null&&i!==void 0?i:c.active();const l=this.startSpan(e,o,u);const g=(0,a.setSpan)(u,l);return c.with(g,s,undefined,l)}}t.NoopTracer=NoopTracer;function isSpanContext(e){return typeof e===\"object\"&&typeof e[\"spanId\"]===\"string\"&&typeof e[\"traceId\"]===\"string\"&&typeof e[\"traceFlags\"]===\"number\"}},124:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.NoopTracerProvider=void 0;const n=r(614);class NoopTracerProvider{getTracer(e,t,r){return new n.NoopTracer}}t.NoopTracerProvider=NoopTracerProvider},125:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.ProxyTracer=void 0;const n=r(614);const a=new n.NoopTracer;class ProxyTracer{constructor(e,t,r,n){this._provider=e;this.name=t;this.version=r;this.options=n}startSpan(e,t,r){return this._getTracer().startSpan(e,t,r)}startActiveSpan(e,t,r,n){const a=this._getTracer();return Reflect.apply(a.startActiveSpan,a,arguments)}_getTracer(){if(this._delegate){return this._delegate}const e=this._provider.getDelegateTracer(this.name,this.version,this.options);if(!e){return a}this._delegate=e;return this._delegate}}t.ProxyTracer=ProxyTracer},846:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.ProxyTracerProvider=void 0;const n=r(125);const a=r(124);const o=new a.NoopTracerProvider;class ProxyTracerProvider{getTracer(e,t,r){var a;return(a=this.getDelegateTracer(e,t,r))!==null&&a!==void 0?a:new n.ProxyTracer(this,e,t,r)}getDelegate(){var e;return(e=this._delegate)!==null&&e!==void 0?e:o}setDelegate(e){this._delegate=e}getDelegateTracer(e,t,r){var n;return(n=this._delegate)===null||n===void 0?void 0:n.getTracer(e,t,r)}}t.ProxyTracerProvider=ProxyTracerProvider},996:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.SamplingDecision=void 0;var r;(function(e){e[e[\"NOT_RECORD\"]=0]=\"NOT_RECORD\";e[e[\"RECORD\"]=1]=\"RECORD\";e[e[\"RECORD_AND_SAMPLED\"]=2]=\"RECORD_AND_SAMPLED\"})(r=t.SamplingDecision||(t.SamplingDecision={}))},607:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.getSpanContext=t.setSpanContext=t.deleteSpan=t.setSpan=t.getActiveSpan=t.getSpan=void 0;const n=r(780);const a=r(403);const o=r(491);const i=(0,n.createContextKey)(\"OpenTelemetry Context Key SPAN\");function getSpan(e){return e.getValue(i)||undefined}t.getSpan=getSpan;function getActiveSpan(){return getSpan(o.ContextAPI.getInstance().active())}t.getActiveSpan=getActiveSpan;function setSpan(e,t){return e.setValue(i,t)}t.setSpan=setSpan;function deleteSpan(e){return e.deleteValue(i)}t.deleteSpan=deleteSpan;function setSpanContext(e,t){return setSpan(e,new a.NonRecordingSpan(t))}t.setSpanContext=setSpanContext;function getSpanContext(e){var t;return(t=getSpan(e))===null||t===void 0?void 0:t.spanContext()}t.getSpanContext=getSpanContext},325:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.TraceStateImpl=void 0;const n=r(564);const a=32;const o=512;const i=\",\";const c=\"=\";class TraceStateImpl{constructor(e){this._internalState=new Map;if(e)this._parse(e)}set(e,t){const r=this._clone();if(r._internalState.has(e)){r._internalState.delete(e)}r._internalState.set(e,t);return r}unset(e){const t=this._clone();t._internalState.delete(e);return t}get(e){return this._internalState.get(e)}serialize(){return this._keys().reduce(((e,t)=>{e.push(t+c+this.get(t));return e}),[]).join(i)}_parse(e){if(e.length>o)return;this._internalState=e.split(i).reverse().reduce(((e,t)=>{const r=t.trim();const a=r.indexOf(c);if(a!==-1){const o=r.slice(0,a);const i=r.slice(a+1,t.length);if((0,n.validateKey)(o)&&(0,n.validateValue)(i)){e.set(o,i)}else{}}return e}),new Map);if(this._internalState.size>a){this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,a))}}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){const e=new TraceStateImpl;e._internalState=new Map(this._internalState);return e}}t.TraceStateImpl=TraceStateImpl},564:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.validateValue=t.validateKey=void 0;const r=\"[_0-9a-z-*/]\";const n=`[a-z]${r}{0,255}`;const a=`[a-z0-9]${r}{0,240}@[a-z]${r}{0,13}`;const o=new RegExp(`^(?:${n}|${a})$`);const i=/^[ -~]{0,255}[!-~]$/;const c=/,|=/;function validateKey(e){return o.test(e)}t.validateKey=validateKey;function validateValue(e){return i.test(e)&&!c.test(e)}t.validateValue=validateValue},98:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.createTraceState=void 0;const n=r(325);function createTraceState(e){return new n.TraceStateImpl(e)}t.createTraceState=createTraceState},476:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.INVALID_SPAN_CONTEXT=t.INVALID_TRACEID=t.INVALID_SPANID=void 0;const n=r(475);t.INVALID_SPANID=\"0000000000000000\";t.INVALID_TRACEID=\"00000000000000000000000000000000\";t.INVALID_SPAN_CONTEXT={traceId:t.INVALID_TRACEID,spanId:t.INVALID_SPANID,traceFlags:n.TraceFlags.NONE}},357:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.SpanKind=void 0;var r;(function(e){e[e[\"INTERNAL\"]=0]=\"INTERNAL\";e[e[\"SERVER\"]=1]=\"SERVER\";e[e[\"CLIENT\"]=2]=\"CLIENT\";e[e[\"PRODUCER\"]=3]=\"PRODUCER\";e[e[\"CONSUMER\"]=4]=\"CONSUMER\"})(r=t.SpanKind||(t.SpanKind={}))},139:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.wrapSpanContext=t.isSpanContextValid=t.isValidSpanId=t.isValidTraceId=void 0;const n=r(476);const a=r(403);const o=/^([0-9a-f]{32})$/i;const i=/^[0-9a-f]{16}$/i;function isValidTraceId(e){return o.test(e)&&e!==n.INVALID_TRACEID}t.isValidTraceId=isValidTraceId;function isValidSpanId(e){return i.test(e)&&e!==n.INVALID_SPANID}t.isValidSpanId=isValidSpanId;function isSpanContextValid(e){return isValidTraceId(e.traceId)&&isValidSpanId(e.spanId)}t.isSpanContextValid=isSpanContextValid;function wrapSpanContext(e){return new a.NonRecordingSpan(e)}t.wrapSpanContext=wrapSpanContext},847:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.SpanStatusCode=void 0;var r;(function(e){e[e[\"UNSET\"]=0]=\"UNSET\";e[e[\"OK\"]=1]=\"OK\";e[e[\"ERROR\"]=2]=\"ERROR\"})(r=t.SpanStatusCode||(t.SpanStatusCode={}))},475:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.TraceFlags=void 0;var r;(function(e){e[e[\"NONE\"]=0]=\"NONE\";e[e[\"SAMPLED\"]=1]=\"SAMPLED\"})(r=t.TraceFlags||(t.TraceFlags={}))},521:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:true});t.VERSION=void 0;t.VERSION=\"1.6.0\"}};var t={};function __nccwpck_require__(r){var n=t[r];if(n!==undefined){return n.exports}var a=t[r]={exports:{}};var o=true;try{e[r].call(a.exports,a,a.exports,__nccwpck_require__);o=false}finally{if(o)delete t[r]}return a.exports}if(typeof __nccwpck_require__!==\"undefined\")__nccwpck_require__.ab=__dirname+\"/\";var r={};(()=>{var e=r;Object.defineProperty(e,\"__esModule\",{value:true});e.trace=e.propagation=e.metrics=e.diag=e.context=e.INVALID_SPAN_CONTEXT=e.INVALID_TRACEID=e.INVALID_SPANID=e.isValidSpanId=e.isValidTraceId=e.isSpanContextValid=e.createTraceState=e.TraceFlags=e.SpanStatusCode=e.SpanKind=e.SamplingDecision=e.ProxyTracerProvider=e.ProxyTracer=e.defaultTextMapSetter=e.defaultTextMapGetter=e.ValueType=e.createNoopMeter=e.DiagLogLevel=e.DiagConsoleLogger=e.ROOT_CONTEXT=e.createContextKey=e.baggageEntryMetadataFromString=void 0;var t=__nccwpck_require__(369);Object.defineProperty(e,\"baggageEntryMetadataFromString\",{enumerable:true,get:function(){return t.baggageEntryMetadataFromString}});var n=__nccwpck_require__(780);Object.defineProperty(e,\"createContextKey\",{enumerable:true,get:function(){return n.createContextKey}});Object.defineProperty(e,\"ROOT_CONTEXT\",{enumerable:true,get:function(){return n.ROOT_CONTEXT}});var a=__nccwpck_require__(972);Object.defineProperty(e,\"DiagConsoleLogger\",{enumerable:true,get:function(){return a.DiagConsoleLogger}});var o=__nccwpck_require__(957);Object.defineProperty(e,\"DiagLogLevel\",{enumerable:true,get:function(){return o.DiagLogLevel}});var i=__nccwpck_require__(102);Object.defineProperty(e,\"createNoopMeter\",{enumerable:true,get:function(){return i.createNoopMeter}});var c=__nccwpck_require__(901);Object.defineProperty(e,\"ValueType\",{enumerable:true,get:function(){return c.ValueType}});var s=__nccwpck_require__(194);Object.defineProperty(e,\"defaultTextMapGetter\",{enumerable:true,get:function(){return s.defaultTextMapGetter}});Object.defineProperty(e,\"defaultTextMapSetter\",{enumerable:true,get:function(){return s.defaultTextMapSetter}});var u=__nccwpck_require__(125);Object.defineProperty(e,\"ProxyTracer\",{enumerable:true,get:function(){return u.ProxyTracer}});var l=__nccwpck_require__(846);Object.defineProperty(e,\"ProxyTracerProvider\",{enumerable:true,get:function(){return l.ProxyTracerProvider}});var g=__nccwpck_require__(996);Object.defineProperty(e,\"SamplingDecision\",{enumerable:true,get:function(){return g.SamplingDecision}});var p=__nccwpck_require__(357);Object.defineProperty(e,\"SpanKind\",{enumerable:true,get:function(){return p.SpanKind}});var d=__nccwpck_require__(847);Object.defineProperty(e,\"SpanStatusCode\",{enumerable:true,get:function(){return d.SpanStatusCode}});var _=__nccwpck_require__(475);Object.defineProperty(e,\"TraceFlags\",{enumerable:true,get:function(){return _.TraceFlags}});var f=__nccwpck_require__(98);Object.defineProperty(e,\"createTraceState\",{enumerable:true,get:function(){return f.createTraceState}});var b=__nccwpck_require__(139);Object.defineProperty(e,\"isSpanContextValid\",{enumerable:true,get:function(){return b.isSpanContextValid}});Object.defineProperty(e,\"isValidTraceId\",{enumerable:true,get:function(){return b.isValidTraceId}});Object.defineProperty(e,\"isValidSpanId\",{enumerable:true,get:function(){return b.isValidSpanId}});var v=__nccwpck_require__(476);Object.defineProperty(e,\"INVALID_SPANID\",{enumerable:true,get:function(){return v.INVALID_SPANID}});Object.defineProperty(e,\"INVALID_TRACEID\",{enumerable:true,get:function(){return v.INVALID_TRACEID}});Object.defineProperty(e,\"INVALID_SPAN_CONTEXT\",{enumerable:true,get:function(){return v.INVALID_SPAN_CONTEXT}});const O=__nccwpck_require__(67);Object.defineProperty(e,\"context\",{enumerable:true,get:function(){return O.context}});const P=__nccwpck_require__(506);Object.defineProperty(e,\"diag\",{enumerable:true,get:function(){return P.diag}});const N=__nccwpck_require__(886);Object.defineProperty(e,\"metrics\",{enumerable:true,get:function(){return N.metrics}});const S=__nccwpck_require__(939);Object.defineProperty(e,\"propagation\",{enumerable:true,get:function(){return S.propagation}});const C=__nccwpck_require__(845);Object.defineProperty(e,\"trace\",{enumerable:true,get:function(){return C.trace}});e[\"default\"]={context:O.context,diag:P.diag,metrics:N.metrics,propagation:S.propagation,trace:C.trace}})();module.exports=r})();","(()=>{\"use strict\";if(typeof __nccwpck_require__!==\"undefined\")__nccwpck_require__.ab=__dirname+\"/\";var e={};(()=>{var r=e;\n/*!\n * cookie\n * Copyright(c) 2012-2014 Roman Shtylman\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */r.parse=parse;r.serialize=serialize;var i=decodeURIComponent;var t=encodeURIComponent;var a=/; */;var n=/^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;function parse(e,r){if(typeof e!==\"string\"){throw new TypeError(\"argument str must be a string\")}var t={};var n=r||{};var o=e.split(a);var s=n.decode||i;for(var p=0;p<o.length;p++){var f=o[p];var u=f.indexOf(\"=\");if(u<0){continue}var v=f.substr(0,u).trim();var c=f.substr(++u,f.length).trim();if('\"'==c[0]){c=c.slice(1,-1)}if(undefined==t[v]){t[v]=tryDecode(c,s)}}return t}function serialize(e,r,i){var a=i||{};var o=a.encode||t;if(typeof o!==\"function\"){throw new TypeError(\"option encode is invalid\")}if(!n.test(e)){throw new TypeError(\"argument name is invalid\")}var s=o(r);if(s&&!n.test(s)){throw new TypeError(\"argument val is invalid\")}var p=e+\"=\"+s;if(null!=a.maxAge){var f=a.maxAge-0;if(isNaN(f)||!isFinite(f)){throw new TypeError(\"option maxAge is invalid\")}p+=\"; Max-Age=\"+Math.floor(f)}if(a.domain){if(!n.test(a.domain)){throw new TypeError(\"option domain is invalid\")}p+=\"; Domain=\"+a.domain}if(a.path){if(!n.test(a.path)){throw new TypeError(\"option path is invalid\")}p+=\"; Path=\"+a.path}if(a.expires){if(typeof a.expires.toUTCString!==\"function\"){throw new TypeError(\"option expires is invalid\")}p+=\"; Expires=\"+a.expires.toUTCString()}if(a.httpOnly){p+=\"; HttpOnly\"}if(a.secure){p+=\"; Secure\"}if(a.sameSite){var u=typeof a.sameSite===\"string\"?a.sameSite.toLowerCase():a.sameSite;switch(u){case true:p+=\"; SameSite=Strict\";break;case\"lax\":p+=\"; SameSite=Lax\";break;case\"strict\":p+=\"; SameSite=Strict\";break;case\"none\":p+=\"; SameSite=None\";break;default:throw new TypeError(\"option sameSite is invalid\")}}return p}function tryDecode(e,r){try{return r(e)}catch(r){return e}}})();module.exports=e})();","import \"../async_hooks-BfRfbd1J.mjs\";\nimport { f as runWithEndpointContext } from \"../context-DgQ9XGBl.mjs\";\nimport { createEndpoint, createMiddleware } from \"better-call\";\n\n//#region src/api/index.ts\nconst optionsMiddleware = createMiddleware(async () => {\n\t/**\n\t* This will be passed on the instance of\n\t* the context. Used to infer the type\n\t* here.\n\t*/\n\treturn {};\n});\nconst createAuthMiddleware = createMiddleware.create({ use: [optionsMiddleware, createMiddleware(async () => {\n\treturn {};\n})] });\nconst use = [optionsMiddleware];\nconst createAuthEndpoint = (path, options, handler) => {\n\treturn createEndpoint(path, {\n\t\t...options,\n\t\tuse: [...options?.use || [], ...use]\n\t}, async (ctx) => runWithEndpointContext(ctx, () => handler(ctx)));\n};\n\n//#endregion\nexport { createAuthEndpoint, createAuthMiddleware, optionsMiddleware };","const DYNAMIC_ERROR_CODE = 'DYNAMIC_SERVER_USAGE';\nexport class DynamicServerError extends Error {\n    constructor(description){\n        super(`Dynamic server usage: ${description}`), this.description = description, this.digest = DYNAMIC_ERROR_CODE;\n    }\n}\nexport function isDynamicServerError(err) {\n    if (typeof err !== 'object' || err === null || !('digest' in err) || typeof err.digest !== 'string') {\n        return false;\n    }\n    return err.digest === DYNAMIC_ERROR_CODE;\n}\n\n//# sourceMappingURL=hooks-server-context.js.map","const NEXT_STATIC_GEN_BAILOUT = 'NEXT_STATIC_GEN_BAILOUT';\nexport class StaticGenBailoutError extends Error {\n    constructor(...args){\n        super(...args), this.code = NEXT_STATIC_GEN_BAILOUT;\n    }\n}\nexport function isStaticGenBailoutError(error) {\n    if (typeof error !== 'object' || error === null || !('code' in error)) {\n        return false;\n    }\n    return error.code === NEXT_STATIC_GEN_BAILOUT;\n}\n\n//# sourceMappingURL=static-generation-bailout.js.map","// This has to be a shared module which is shared between client component error boundary and dynamic component\nconst BAILOUT_TO_CSR = 'BAILOUT_TO_CLIENT_SIDE_RENDERING';\n/** An error that should be thrown when we want to bail out to client-side rendering. */ export class BailoutToCSRError extends Error {\n    constructor(reason){\n        super(`Bail out to client-side rendering: ${reason}`), this.reason = reason, this.digest = BAILOUT_TO_CSR;\n    }\n}\n/** Checks if a passed argument is an error that is thrown if we want to bail out to client-side rendering. */ export function isBailoutToCSRError(err) {\n    if (typeof err !== 'object' || err === null || !('digest' in err)) {\n        return false;\n    }\n    return err.digest === BAILOUT_TO_CSR;\n}\n\n//# sourceMappingURL=bailout-to-csr.js.map","const noop = ()=>{};\nlet registry;\nif (globalThis.FinalizationRegistry) {\n    registry = new FinalizationRegistry((weakRef)=>{\n        const stream = weakRef.deref();\n        if (stream && !stream.locked) {\n            stream.cancel('Response object has been garbage collected').then(noop);\n        }\n    });\n}\n/**\n * Clones a response by teeing the body so we can return two independent\n * ReadableStreams from it. This avoids the bug in the undici library around\n * response cloning.\n *\n * After cloning, the original response's body will be consumed and closed.\n *\n * @see https://github.com/vercel/next.js/pull/73274\n *\n * @param original - The original response to clone.\n * @returns A tuple containing two independent clones of the original response.\n */ export function cloneResponse(original) {\n    // If the response has no body, then we can just return the original response\n    // twice because it's immutable.\n    if (!original.body) {\n        return [\n            original,\n            original\n        ];\n    }\n    const [body1, body2] = original.body.tee();\n    const cloned1 = new Response(body1, {\n        status: original.status,\n        statusText: original.statusText,\n        headers: original.headers\n    });\n    Object.defineProperty(cloned1, 'url', {\n        value: original.url,\n        // How the original response.url behaves\n        configurable: true,\n        enumerable: true,\n        writable: false\n    });\n    // The Fetch Standard allows users to skip consuming the response body by\n    // relying on garbage collection to release connection resources.\n    // https://github.com/nodejs/undici?tab=readme-ov-file#garbage-collection\n    //\n    // To cancel the stream you then need to cancel both resulting branches.\n    // Teeing a stream will generally lock it for the duration, preventing other\n    // readers from locking it.\n    // https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream/tee\n    // cloned2 is stored in a react cache and cloned for subsequent requests.\n    // It is the original request, and is is garbage collected by a\n    // FinalizationRegistry in Undici, but since we're tee-ing the stream\n    // ourselves, we need to cancel clone1's stream (the response returned from\n    // our dedupe fetch) when clone1 is reclaimed, otherwise we leak memory.\n    if (registry && cloned1.body) {\n        registry.register(cloned1, new WeakRef(cloned1.body));\n    }\n    const cloned2 = new Response(body2, {\n        status: original.status,\n        statusText: original.statusText,\n        headers: original.headers\n    });\n    Object.defineProperty(cloned2, 'url', {\n        value: original.url,\n        // How the original response.url behaves\n        configurable: true,\n        enumerable: true,\n        writable: false\n    });\n    return [\n        cloned1,\n        cloned2\n    ];\n}\n\n//# sourceMappingURL=clone-response.js.map","// In output: export mode, the build id is added to the start of the HTML\n// document, directly after the doctype declaration. During a prefetch, the\n// client performs a range request to get the build id, so it can check whether\n// the target page belongs to the same build.\n//\n// The first 64 bytes of the document are requested. The exact number isn't\n// too important; it must be larger than the build id + doctype + closing and\n// ending comment markers, but it doesn't need to match the end of the\n// comment exactly.\n//\n// Build ids are 21 bytes long in the default implementation, though this\n// can be overridden in the Next.js config. For the purposes of this check,\n// it's OK to only match the start of the id, so we'll truncate it if exceeds\n// a certain length.\nconst DOCTYPE_PREFIX = '<!DOCTYPE html>' // 15 bytes\n;\nconst MAX_BUILD_ID_LENGTH = 24;\n// Request the first 64 bytes. The Range header is inclusive of the end value.\nexport const DOC_PREFETCH_RANGE_HEADER_VALUE = 'bytes=0-63';\nfunction escapeBuildId(buildId) {\n    // If the build id is longer than the given limit, it's OK for our purposes\n    // to only match the beginning.\n    const truncated = buildId.slice(0, MAX_BUILD_ID_LENGTH);\n    // Replace hyphens with underscores so it doesn't break the HTML comment.\n    // (Unlikely, but if this did happen it would break the whole document.)\n    return truncated.replace(/-/g, '_');\n}\nexport function insertBuildIdComment(originalHtml, buildId) {\n    if (// Skip if the build id contains a closing comment marker.\n    buildId.includes('-->') || // React always inserts a doctype at the start of the document. Skip if it\n    // isn't present. Shouldn't happen; suggests an issue elsewhere.\n    !originalHtml.startsWith(DOCTYPE_PREFIX)) {\n        // Return the original HTML unchanged. This means the document will not\n        // be prefetched.\n        // TODO: The build id comment is currently only used during prefetches, but\n        // if we eventually use this mechanism for regular navigations, we may need\n        // to error during build if we fail to insert it for some reason.\n        return originalHtml;\n    }\n    // The comment must be inserted after the doctype.\n    return originalHtml.replace(DOCTYPE_PREFIX, DOCTYPE_PREFIX + '<!--' + escapeBuildId(buildId) + '-->');\n}\nexport function doesExportedHtmlMatchBuildId(partialHtmlDocument, buildId) {\n    // Check whether the document starts with the expected buildId.\n    return partialHtmlDocument.startsWith(DOCTYPE_PREFIX + '<!--' + escapeBuildId(buildId) + '-->');\n}\n\n//# sourceMappingURL=output-export-prefetch-encoding.js.map","/**\n * A cache of lowercased locales for each list of locales. This is stored as a\n * WeakMap so if the locales are garbage collected, the cache entry will be\n * removed as well.\n */ const cache = new WeakMap();\n/**\n * For a pathname that may include a locale from a list of locales, it\n * removes the locale from the pathname returning it alongside with the\n * detected locale.\n *\n * @param pathname A pathname that may include a locale.\n * @param locales A list of locales.\n * @returns The detected locale and pathname without locale\n */ export function normalizeLocalePath(pathname, locales) {\n    // If locales is undefined, return the pathname as is.\n    if (!locales) return {\n        pathname\n    };\n    // Get the cached lowercased locales or create a new cache entry.\n    let lowercasedLocales = cache.get(locales);\n    if (!lowercasedLocales) {\n        lowercasedLocales = locales.map((locale)=>locale.toLowerCase());\n        cache.set(locales, lowercasedLocales);\n    }\n    let detectedLocale;\n    // The first segment will be empty, because it has a leading `/`. If\n    // there is no further segment, there is no locale (or it's the default).\n    const segments = pathname.split('/', 2);\n    // If there's no second segment (ie, the pathname is just `/`), there's no\n    // locale.\n    if (!segments[1]) return {\n        pathname\n    };\n    // The second segment will contain the locale part if any.\n    const segment = segments[1].toLowerCase();\n    // See if the segment matches one of the locales. If it doesn't, there is\n    // no locale (or it's the default).\n    const index = lowercasedLocales.indexOf(segment);\n    if (index < 0) return {\n        pathname\n    };\n    // Return the case-sensitive locale.\n    detectedLocale = locales[index];\n    // Remove the `/${locale}` part of the pathname.\n    pathname = pathname.slice(detectedLocale.length + 1) || '/';\n    return {\n        pathname,\n        detectedLocale\n    };\n}\n\n//# sourceMappingURL=normalize-locale-path.js.map","export { RequestCookies, ResponseCookies, stringifyCookie } from 'next/dist/compiled/@edge-runtime/cookies';\n\n//# sourceMappingURL=cookies.js.map","// Combined load times for loading client components\nlet clientComponentLoadStart = 0;\nlet clientComponentLoadTimes = 0;\nlet clientComponentLoadCount = 0;\nexport function wrapClientComponentLoader(ComponentMod) {\n    if (!('performance' in globalThis)) {\n        return ComponentMod.__next_app__;\n    }\n    return {\n        require: (...args)=>{\n            const startTime = performance.now();\n            if (clientComponentLoadStart === 0) {\n                clientComponentLoadStart = startTime;\n            }\n            try {\n                clientComponentLoadCount += 1;\n                return ComponentMod.__next_app__.require(...args);\n            } finally{\n                clientComponentLoadTimes += performance.now() - startTime;\n            }\n        },\n        loadChunk: (...args)=>{\n            const startTime = performance.now();\n            const result = ComponentMod.__next_app__.loadChunk(...args);\n            // Avoid wrapping `loadChunk`'s result in an extra promise in case something like React depends on its identity.\n            // We only need to know when it's settled.\n            result.finally(()=>{\n                clientComponentLoadTimes += performance.now() - startTime;\n            });\n            return result;\n        }\n    };\n}\nexport function getClientComponentLoaderMetrics(options = {}) {\n    const metrics = clientComponentLoadStart === 0 ? undefined : {\n        clientComponentLoadStart,\n        clientComponentLoadTimes,\n        clientComponentLoadCount\n    };\n    if (options.reset) {\n        clientComponentLoadStart = 0;\n        clientComponentLoadTimes = 0;\n        clientComponentLoadCount = 0;\n    }\n    return metrics;\n}\n\n//# sourceMappingURL=client-component-renderer-logger.js.map","import { AppRouteRouteModule } from \"next/dist/esm/server/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/esm/server/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/esm/server/lib/patch-fetch\";\nimport { addRequestMeta, getRequestMeta } from \"next/dist/esm/server/request-meta\";\nimport { getTracer, SpanKind } from \"next/dist/esm/server/lib/trace/tracer\";\nimport { setReferenceManifestsSingleton } from \"next/dist/esm/server/app-render/encryption-utils\";\nimport { createServerModuleMap } from \"next/dist/esm/server/app-render/action-utils\";\nimport { normalizeAppPath } from \"next/dist/esm/shared/lib/router/utils/app-paths\";\nimport { NodeNextRequest, NodeNextResponse } from \"next/dist/esm/server/base-http/node\";\nimport { NextRequestAdapter, signalFromNodeResponse } from \"next/dist/esm/server/web/spec-extension/adapters/next-request\";\nimport { BaseServerSpan } from \"next/dist/esm/server/lib/trace/constants\";\nimport { getRevalidateReason } from \"next/dist/esm/server/instrumentation/utils\";\nimport { sendResponse } from \"next/dist/esm/server/send-response\";\nimport { fromNodeOutgoingHttpHeaders, toNodeOutgoingHttpHeaders } from \"next/dist/esm/server/web/utils\";\nimport { getCacheControlHeader } from \"next/dist/esm/server/lib/cache-control\";\nimport { INFINITE_CACHE, NEXT_CACHE_TAGS_HEADER } from \"next/dist/esm/lib/constants\";\nimport { NoFallbackError } from \"next/dist/esm/shared/lib/no-fallback-error.external\";\nimport { CachedRouteKind } from \"next/dist/esm/server/response-cache\";\nimport * as userland from \"INNER_APP_ROUTE\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/auth/[...all]/route\",\n        pathname: \"/api/auth/[...all]\",\n        filename: \"route\",\n        bundlePath: \"\"\n    },\n    distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n    relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n    resolvedPagePath: \"[project]/src/app/api/auth/[...all]/route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return _patchFetch({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\nexport { routeModule, workAsyncStorage, workUnitAsyncStorage, serverHooks, patchFetch,  };\nexport async function handler(req, res, ctx) {\n    if (routeModule.isDev) {\n        addRequestMeta(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint());\n    }\n    let srcPage = \"/api/auth/[...all]/route\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (process.env.TURBOPACK) {\n        srcPage = srcPage.replace(/\\/index$/, '') || '/';\n    } else if (srcPage === '/index') {\n        // we always normalize /index specifically\n        srcPage = '/';\n    }\n    const multiZoneDraftMode = process.env.__NEXT_MULTI_ZONE_DRAFT_MODE;\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage,\n        multiZoneDraftMode\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return null;\n    }\n    const { buildId, params, nextConfig, parsedUrl, isDraftMode, prerenderManifest, routerServerContext, isOnDemandRevalidate, revalidateOnlyGenerated, resolvedPathname, clientReferenceManifest, serverActionsManifest } = prepareResult;\n    const normalizedSrcPage = normalizeAppPath(srcPage);\n    let isIsr = Boolean(prerenderManifest.dynamicRoutes[normalizedSrcPage] || prerenderManifest.routes[resolvedPathname]);\n    const render404 = async ()=>{\n        // TODO: should route-module itself handle rendering the 404\n        if (routerServerContext == null ? void 0 : routerServerContext.render404) {\n            await routerServerContext.render404(req, res, parsedUrl, false);\n        } else {\n            res.end('This page could not be found');\n        }\n        return null;\n    };\n    if (isIsr && !isDraftMode) {\n        const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname]);\n        const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage];\n        if (prerenderInfo) {\n            if (prerenderInfo.fallback === false && !isPrerendered) {\n                if (nextConfig.experimental.adapterPath) {\n                    return await render404();\n                }\n                throw new NoFallbackError();\n            }\n        }\n    }\n    let cacheKey = null;\n    if (isIsr && !routeModule.isDev && !isDraftMode) {\n        cacheKey = resolvedPathname;\n        // ensure /index and / is normalized to one key\n        cacheKey = cacheKey === '/index' ? '/' : cacheKey;\n    }\n    const supportsDynamicResponse = // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true || // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr;\n    // This is a revalidation request if the request is for a static\n    // page and it is not being resumed from a postponed render and\n    // it is not a dynamic RSC request then it is a revalidation\n    // request.\n    const isStaticGeneration = isIsr && !supportsDynamicResponse;\n    // Before rendering (which initializes component tree modules), we have to\n    // set the reference manifests to our global store so Server Action's\n    // encryption util can access to them at the top level of the page module.\n    if (serverActionsManifest && clientReferenceManifest) {\n        setReferenceManifestsSingleton({\n            page: srcPage,\n            clientReferenceManifest,\n            serverActionsManifest,\n            serverModuleMap: createServerModuleMap({\n                serverActionsManifest\n            })\n        });\n    }\n    const method = req.method || 'GET';\n    const tracer = getTracer();\n    const activeSpan = tracer.getActiveScopeSpan();\n    const context = {\n        params,\n        prerenderManifest,\n        renderOpts: {\n            experimental: {\n                authInterrupts: Boolean(nextConfig.experimental.authInterrupts)\n            },\n            cacheComponents: Boolean(nextConfig.cacheComponents),\n            supportsDynamicResponse,\n            incrementalCache: getRequestMeta(req, 'incrementalCache'),\n            cacheLifeProfiles: nextConfig.cacheLife,\n            waitUntil: ctx.waitUntil,\n            onClose: (cb)=>{\n                res.on('close', cb);\n            },\n            onAfterTaskError: undefined,\n            onInstrumentationRequestError: (error, _request, errorContext)=>routeModule.onRequestError(req, error, errorContext, routerServerContext)\n        },\n        sharedContext: {\n            buildId\n        }\n    };\n    const nodeNextReq = new NodeNextRequest(req);\n    const nodeNextRes = new NodeNextResponse(res);\n    const nextReq = NextRequestAdapter.fromNodeNextRequest(nodeNextReq, signalFromNodeResponse(res));\n    try {\n        const invokeRouteModule = async (span)=>{\n            return routeModule.handle(nextReq, context).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${srcPage}`);\n                }\n            });\n        };\n        const isMinimalMode = Boolean(process.env.MINIMAL_MODE || getRequestMeta(req, 'minimalMode'));\n        const handleResponse = async (currentSpan)=>{\n            var _cacheEntry_value;\n            const responseGenerator = async ({ previousCacheEntry })=>{\n                try {\n                    if (!isMinimalMode && isOnDemandRevalidate && revalidateOnlyGenerated && !previousCacheEntry) {\n                        res.statusCode = 404;\n                        // on-demand revalidate always sets this header\n                        res.setHeader('x-nextjs-cache', 'REVALIDATED');\n                        res.end('This page could not be found');\n                        return null;\n                    }\n                    const response = await invokeRouteModule(currentSpan);\n                    req.fetchMetrics = context.renderOpts.fetchMetrics;\n                    let pendingWaitUntil = context.renderOpts.pendingWaitUntil;\n                    // Attempt using provided waitUntil if available\n                    // if it's not we fallback to sendResponse's handling\n                    if (pendingWaitUntil) {\n                        if (ctx.waitUntil) {\n                            ctx.waitUntil(pendingWaitUntil);\n                            pendingWaitUntil = undefined;\n                        }\n                    }\n                    const cacheTags = context.renderOpts.collectedTags;\n                    // If the request is for a static response, we can cache it so long\n                    // as it's not edge.\n                    if (isIsr) {\n                        const blob = await response.blob();\n                        // Copy the headers from the response.\n                        const headers = toNodeOutgoingHttpHeaders(response.headers);\n                        if (cacheTags) {\n                            headers[NEXT_CACHE_TAGS_HEADER] = cacheTags;\n                        }\n                        if (!headers['content-type'] && blob.type) {\n                            headers['content-type'] = blob.type;\n                        }\n                        const revalidate = typeof context.renderOpts.collectedRevalidate === 'undefined' || context.renderOpts.collectedRevalidate >= INFINITE_CACHE ? false : context.renderOpts.collectedRevalidate;\n                        const expire = typeof context.renderOpts.collectedExpire === 'undefined' || context.renderOpts.collectedExpire >= INFINITE_CACHE ? undefined : context.renderOpts.collectedExpire;\n                        // Create the cache entry for the response.\n                        const cacheEntry = {\n                            value: {\n                                kind: CachedRouteKind.APP_ROUTE,\n                                status: response.status,\n                                body: Buffer.from(await blob.arrayBuffer()),\n                                headers\n                            },\n                            cacheControl: {\n                                revalidate,\n                                expire\n                            }\n                        };\n                        return cacheEntry;\n                    } else {\n                        // send response without caching if not ISR\n                        await sendResponse(nodeNextReq, nodeNextRes, response, context.renderOpts.pendingWaitUntil);\n                        return null;\n                    }\n                } catch (err) {\n                    // if this is a background revalidate we need to report\n                    // the request error here as it won't be bubbled\n                    if (previousCacheEntry == null ? void 0 : previousCacheEntry.isStale) {\n                        await routeModule.onRequestError(req, err, {\n                            routerKind: 'App Router',\n                            routePath: srcPage,\n                            routeType: 'route',\n                            revalidateReason: getRevalidateReason({\n                                isStaticGeneration,\n                                isOnDemandRevalidate\n                            })\n                        }, routerServerContext);\n                    }\n                    throw err;\n                }\n            };\n            const cacheEntry = await routeModule.handleResponse({\n                req,\n                nextConfig,\n                cacheKey,\n                routeKind: RouteKind.APP_ROUTE,\n                isFallback: false,\n                prerenderManifest,\n                isRoutePPREnabled: false,\n                isOnDemandRevalidate,\n                revalidateOnlyGenerated,\n                responseGenerator,\n                waitUntil: ctx.waitUntil,\n                isMinimalMode\n            });\n            // we don't create a cacheEntry for ISR\n            if (!isIsr) {\n                return null;\n            }\n            if ((cacheEntry == null ? void 0 : (_cacheEntry_value = cacheEntry.value) == null ? void 0 : _cacheEntry_value.kind) !== CachedRouteKind.APP_ROUTE) {\n                var _cacheEntry_value1;\n                throw Object.defineProperty(new Error(`Invariant: app-route received invalid cache entry ${cacheEntry == null ? void 0 : (_cacheEntry_value1 = cacheEntry.value) == null ? void 0 : _cacheEntry_value1.kind}`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E701\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n            if (!isMinimalMode) {\n                res.setHeader('x-nextjs-cache', isOnDemandRevalidate ? 'REVALIDATED' : cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT');\n            }\n            // Draft mode should never be cached\n            if (isDraftMode) {\n                res.setHeader('Cache-Control', 'private, no-cache, no-store, max-age=0, must-revalidate');\n            }\n            const headers = fromNodeOutgoingHttpHeaders(cacheEntry.value.headers);\n            if (!(isMinimalMode && isIsr)) {\n                headers.delete(NEXT_CACHE_TAGS_HEADER);\n            }\n            // If cache control is already set on the response we don't\n            // override it to allow users to customize it via next.config\n            if (cacheEntry.cacheControl && !res.getHeader('Cache-Control') && !headers.get('Cache-Control')) {\n                headers.set('Cache-Control', getCacheControlHeader(cacheEntry.cacheControl));\n            }\n            await sendResponse(nodeNextReq, nodeNextRes, // @ts-expect-error - Argument of type 'Buffer<ArrayBufferLike>' is not assignable to parameter of type 'BodyInit | null | undefined'.\n            new Response(cacheEntry.value.body, {\n                headers,\n                status: cacheEntry.value.status || 200\n            }));\n            return null;\n        };\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await handleResponse(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${srcPage}`,\n                    kind: SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, handleResponse));\n        }\n    } catch (err) {\n        if (!(err instanceof NoFallbackError)) {\n            await routeModule.onRequestError(req, err, {\n                routerKind: 'App Router',\n                routePath: normalizedSrcPage,\n                routeType: 'route',\n                revalidateReason: getRevalidateReason({\n                    isStaticGeneration,\n                    isOnDemandRevalidate\n                })\n            });\n        }\n        // rethrow so that we can handle serving error page\n        // If this is during static generation, throw the error again.\n        if (isIsr) throw err;\n        // Otherwise, send a 500 response.\n        await sendResponse(nodeNextReq, nodeNextRes, new Response(null, {\n            status: 500\n        }));\n        return null;\n    }\n}\n\n//# sourceMappingURL=app-route.js.map\n","import \"./dialect-D9ZUZA4J.mjs\";\nimport \"./get-model-name-D4DUV7S2.mjs\";\nimport \"./get-migration-Bf0TuCzm.mjs\";\nimport { i as parseState, n as HIDE_METADATA, r as generateState, t as generateId } from \"./utils-db7gNqd-.mjs\";\nimport \"./crypto-CFUhAR9W.mjs\";\nimport { t as capitalizeFirstLetter } from \"./misc-BwNc0MKr.mjs\";\nimport \"./schema-Bb7wzeK_.mjs\";\nimport \"./get-request-ip-D6st-mto.mjs\";\nimport \"./json-CnHxKYpj.mjs\";\nimport \"./url-CB8xCwz-.mjs\";\nimport { t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport \"./cookies-D72PbWdz.mjs\";\nimport \"./session-AaRl3_x-.mjs\";\nimport \"./base-CiRMFqet.mjs\";\nimport \"./password-BFQK0cLg.mjs\";\nimport { t as betterAuth } from \"./auth-DfR8_5w3.mjs\";\nimport \"./types-BOTDmeLz.mjs\";\nimport { getCurrentAdapter } from \"@better-auth/core/context\";\nimport { createTelemetry, getTelemetryAuthConfig } from \"@better-auth/telemetry\";\n\nexport * from \"@better-auth/core\"\n\nexport * from \"@better-auth/core/db\"\n\nexport * from \"@better-auth/core/env\"\n\nexport * from \"@better-auth/core/error\"\n\nexport * from \"@better-auth/core/oauth2\"\n\nexport * from \"@better-auth/core/utils\"\n\nexport { APIError, HIDE_METADATA, betterAuth, capitalizeFirstLetter, createTelemetry, generateId, generateState, getCurrentAdapter, getTelemetryAuthConfig, parseState };","import { APIError } from \"better-call\";\n\n//#region src/utils/date.ts\nconst getDate = (span, unit = \"ms\") => {\n\treturn new Date(Date.now() + (unit === \"sec\" ? span * 1e3 : span));\n};\n\n//#endregion\n//#region src/db/schema.ts\nconst cache = /* @__PURE__ */ new WeakMap();\nfunction parseOutputData(data, schema) {\n\tconst fields = schema.fields;\n\tconst parsedData = {};\n\tfor (const key in data) {\n\t\tconst field = fields[key];\n\t\tif (!field) {\n\t\t\tparsedData[key] = data[key];\n\t\t\tcontinue;\n\t\t}\n\t\tif (field.returned === false) continue;\n\t\tparsedData[key] = data[key];\n\t}\n\treturn parsedData;\n}\nfunction getAllFields(options, table) {\n\tif (!cache.has(options)) cache.set(options, /* @__PURE__ */ new Map());\n\tconst tableCache = cache.get(options);\n\tif (tableCache.has(table)) return tableCache.get(table);\n\tlet schema = {\n\t\t...table === \"user\" ? options.user?.additionalFields : {},\n\t\t...table === \"session\" ? options.session?.additionalFields : {}\n\t};\n\tfor (const plugin of options.plugins || []) if (plugin.schema && plugin.schema[table]) schema = {\n\t\t...schema,\n\t\t...plugin.schema[table].fields\n\t};\n\tcache.get(options).set(table, schema);\n\treturn schema;\n}\nfunction parseUserOutput(options, user) {\n\treturn {\n\t\t...parseOutputData(user, { fields: getAllFields(options, \"user\") }),\n\t\tid: user.id\n\t};\n}\nfunction parseAccountOutput(options, account) {\n\treturn parseOutputData(account, { fields: getAllFields(options, \"account\") });\n}\nfunction parseSessionOutput(options, session) {\n\treturn parseOutputData(session, { fields: getAllFields(options, \"session\") });\n}\nfunction parseInputData(data, schema) {\n\tconst action = schema.action || \"create\";\n\tconst fields = schema.fields;\n\tconst parsedData = Object.assign(Object.create(null), null);\n\tfor (const key in fields) {\n\t\tif (key in data) {\n\t\t\tif (fields[key].input === false) {\n\t\t\t\tif (fields[key].defaultValue !== void 0) {\n\t\t\t\t\tif (action !== \"update\") {\n\t\t\t\t\t\tparsedData[key] = fields[key].defaultValue;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (data[key]) throw new APIError(\"BAD_REQUEST\", { message: `${key} is not allowed to be set` });\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (fields[key].validator?.input && data[key] !== void 0) {\n\t\t\t\tparsedData[key] = fields[key].validator.input[\"~standard\"].validate(data[key]);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (fields[key].transform?.input && data[key] !== void 0) {\n\t\t\t\tparsedData[key] = fields[key].transform?.input(data[key]);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tparsedData[key] = data[key];\n\t\t\tcontinue;\n\t\t}\n\t\tif (fields[key].defaultValue !== void 0 && action === \"create\") {\n\t\t\tif (typeof fields[key].defaultValue === \"function\") {\n\t\t\t\tparsedData[key] = fields[key].defaultValue();\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tparsedData[key] = fields[key].defaultValue;\n\t\t\tcontinue;\n\t\t}\n\t\tif (fields[key].required && action === \"create\") throw new APIError(\"BAD_REQUEST\", { message: `${key} is required` });\n\t}\n\treturn parsedData;\n}\nfunction parseUserInput(options, user = {}, action) {\n\treturn parseInputData(user, {\n\t\tfields: getAllFields(options, \"user\"),\n\t\taction\n\t});\n}\nfunction parseAdditionalUserInput(options, user) {\n\tconst schema = getAllFields(options, \"user\");\n\treturn parseInputData(user || {}, { fields: schema });\n}\nfunction parseAccountInput(options, account) {\n\treturn parseInputData(account, { fields: getAllFields(options, \"account\") });\n}\nfunction parseSessionInput(options, session) {\n\treturn parseInputData(session, { fields: getAllFields(options, \"session\") });\n}\nfunction mergeSchema(schema, newSchema) {\n\tif (!newSchema) return schema;\n\tfor (const table in newSchema) {\n\t\tconst newModelName = newSchema[table]?.modelName;\n\t\tif (newModelName) schema[table].modelName = newModelName;\n\t\tfor (const field in schema[table].fields) {\n\t\t\tconst newField = newSchema[table]?.fields?.[field];\n\t\t\tif (!newField) continue;\n\t\t\tschema[table].fields[field].fieldName = newField;\n\t\t}\n\t}\n\treturn schema;\n}\n\n//#endregion\nexport { parseInputData as a, parseUserInput as c, parseAdditionalUserInput as i, parseUserOutput as l, parseAccountInput as n, parseSessionInput as o, parseAccountOutput as r, parseSessionOutput as s, mergeSchema as t, getDate as u };","import { isDevelopment, isTest } from \"@better-auth/core/env\";\nimport * as z from \"zod\";\n\n//#region src/utils/get-request-ip.ts\nconst LOCALHOST_IP = \"127.0.0.1\";\nfunction getIp(req, options) {\n\tif (options.advanced?.ipAddress?.disableIpTracking) return null;\n\tif (isTest() || isDevelopment()) return LOCALHOST_IP;\n\tconst headers = \"headers\" in req ? req.headers : req;\n\tconst ipHeaders = options.advanced?.ipAddress?.ipAddressHeaders || [\"x-forwarded-for\"];\n\tfor (const key of ipHeaders) {\n\t\tconst value = \"get\" in headers ? headers.get(key) : headers[key];\n\t\tif (typeof value === \"string\") {\n\t\t\tconst ip = value.split(\",\")[0].trim();\n\t\t\tif (isValidIP(ip)) return ip;\n\t\t}\n\t}\n\treturn null;\n}\nfunction isValidIP(ip) {\n\tif (z.ipv4().safeParse(ip).success) return true;\n\tif (z.ipv6().safeParse(ip).success) return true;\n\treturn false;\n}\n\n//#endregion\nexport { getIp as t };","import * as z from \"./v4/classic/external.js\";\nexport * from \"./v4/classic/external.js\";\nexport { z };\nexport default z;\n","const decoders = /* @__PURE__ */ new Map();\nconst encoder = new TextEncoder();\nconst binary = {\n  decode: (data, encoding = \"utf-8\") => {\n    if (!decoders.has(encoding)) {\n      decoders.set(encoding, new TextDecoder(encoding));\n    }\n    const decoder = decoders.get(encoding);\n    return decoder.decode(data);\n  },\n  encode: encoder.encode\n};\n\nexport { binary };\n","import { hex } from './hex.mjs';\nimport { base64Url, base64 } from './base64.mjs';\nimport { getWebcryptoSubtle } from './index.mjs';\n\nconst createHMAC = (algorithm = \"SHA-256\", encoding = \"none\") => {\n  const hmac = {\n    importKey: async (key, keyUsage) => {\n      return getWebcryptoSubtle().importKey(\n        \"raw\",\n        typeof key === \"string\" ? new TextEncoder().encode(key) : key,\n        { name: \"HMAC\", hash: { name: algorithm } },\n        false,\n        [keyUsage]\n      );\n    },\n    sign: async (hmacKey, data) => {\n      if (typeof hmacKey === \"string\") {\n        hmacKey = await hmac.importKey(hmacKey, \"sign\");\n      }\n      const signature = await getWebcryptoSubtle().sign(\n        \"HMAC\",\n        hmacKey,\n        typeof data === \"string\" ? new TextEncoder().encode(data) : data\n      );\n      if (encoding === \"hex\") {\n        return hex.encode(signature);\n      }\n      if (encoding === \"base64\" || encoding === \"base64url\" || encoding === \"base64urlnopad\") {\n        return base64Url.encode(signature, {\n          padding: encoding !== \"base64urlnopad\"\n        });\n      }\n      return signature;\n    },\n    verify: async (hmacKey, data, signature) => {\n      if (typeof hmacKey === \"string\") {\n        hmacKey = await hmac.importKey(hmacKey, \"verify\");\n      }\n      if (encoding === \"hex\") {\n        signature = hex.decode(signature);\n      }\n      if (encoding === \"base64\" || encoding === \"base64url\" || encoding === \"base64urlnopad\") {\n        signature = await base64.decode(signature);\n      }\n      return getWebcryptoSubtle().verify(\n        \"HMAC\",\n        hmacKey,\n        typeof signature === \"string\" ? new TextEncoder().encode(signature) : signature,\n        typeof data === \"string\" ? new TextEncoder().encode(data) : data\n      );\n    }\n  };\n  return hmac;\n};\n\nexport { createHMAC };\n","//#region src/index.ts\nconst s = 1e3;\nconst m = s * 60;\nconst h = m * 60;\nconst d = h * 24;\nconst w = d * 7;\nconst y = d * 365.25;\nconst mo = y / 12;\nfunction ms(value, options) {\n\tif (typeof value === \"string\") return parse(value);\n\telse if (typeof value === \"number\") return format(value, options);\n\tthrow new Error(`Value provided to ms() must be a string or number. value=${JSON.stringify(value)}`);\n}\n/**\n* Parse the given string and return milliseconds.\n*\n* @param str - A string to parse to milliseconds\n* @returns The parsed value in milliseconds, or `NaN` if the string can't be\n* parsed\n*/\nfunction parse(str) {\n\tif (typeof str !== \"string\" || str.length === 0 || str.length > 100) throw new Error(`Value provided to ms.parse() must be a string with length between 1 and 99. value=${JSON.stringify(str)}`);\n\tconst match = /^(?<value>-?\\d*\\.?\\d+) *(?<unit>milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|months?|mo|years?|yrs?|y)?$/i.exec(str);\n\tif (!match?.groups) return NaN;\n\tconst { value, unit = \"ms\" } = match.groups;\n\tconst n = parseFloat(value);\n\tconst matchUnit = unit.toLowerCase();\n\t/* istanbul ignore next - istanbul doesn't understand, but thankfully the TypeScript the exhaustiveness check in the default case keeps us type safe here */\n\tswitch (matchUnit) {\n\t\tcase \"years\":\n\t\tcase \"year\":\n\t\tcase \"yrs\":\n\t\tcase \"yr\":\n\t\tcase \"y\": return n * y;\n\t\tcase \"months\":\n\t\tcase \"month\":\n\t\tcase \"mo\": return n * mo;\n\t\tcase \"weeks\":\n\t\tcase \"week\":\n\t\tcase \"w\": return n * w;\n\t\tcase \"days\":\n\t\tcase \"day\":\n\t\tcase \"d\": return n * d;\n\t\tcase \"hours\":\n\t\tcase \"hour\":\n\t\tcase \"hrs\":\n\t\tcase \"hr\":\n\t\tcase \"h\": return n * h;\n\t\tcase \"minutes\":\n\t\tcase \"minute\":\n\t\tcase \"mins\":\n\t\tcase \"min\":\n\t\tcase \"m\": return n * m;\n\t\tcase \"seconds\":\n\t\tcase \"second\":\n\t\tcase \"secs\":\n\t\tcase \"sec\":\n\t\tcase \"s\": return n * s;\n\t\tcase \"milliseconds\":\n\t\tcase \"millisecond\":\n\t\tcase \"msecs\":\n\t\tcase \"msec\":\n\t\tcase \"ms\": return n;\n\t\tdefault: throw new Error(`Unknown unit \"${matchUnit}\" provided to ms.parse(). value=${JSON.stringify(str)}`);\n\t}\n}\n/**\n* Parse the given StringValue and return milliseconds.\n*\n* @param value - A typesafe StringValue to parse to milliseconds\n* @returns The parsed value in milliseconds, or `NaN` if the string can't be\n* parsed\n*/\nfunction parseStrict(value) {\n\treturn parse(value);\n}\n/**\n* Short format for `ms`.\n*/\nfunction fmtShort(ms$1) {\n\tconst msAbs = Math.abs(ms$1);\n\tif (msAbs >= y) return `${Math.round(ms$1 / y)}y`;\n\tif (msAbs >= mo) return `${Math.round(ms$1 / mo)}mo`;\n\tif (msAbs >= w) return `${Math.round(ms$1 / w)}w`;\n\tif (msAbs >= d) return `${Math.round(ms$1 / d)}d`;\n\tif (msAbs >= h) return `${Math.round(ms$1 / h)}h`;\n\tif (msAbs >= m) return `${Math.round(ms$1 / m)}m`;\n\tif (msAbs >= s) return `${Math.round(ms$1 / s)}s`;\n\treturn `${ms$1}ms`;\n}\n/**\n* Long format for `ms`.\n*/\nfunction fmtLong(ms$1) {\n\tconst msAbs = Math.abs(ms$1);\n\tif (msAbs >= y) return plural(ms$1, msAbs, y, \"year\");\n\tif (msAbs >= mo) return plural(ms$1, msAbs, mo, \"month\");\n\tif (msAbs >= w) return plural(ms$1, msAbs, w, \"week\");\n\tif (msAbs >= d) return plural(ms$1, msAbs, d, \"day\");\n\tif (msAbs >= h) return plural(ms$1, msAbs, h, \"hour\");\n\tif (msAbs >= m) return plural(ms$1, msAbs, m, \"minute\");\n\tif (msAbs >= s) return plural(ms$1, msAbs, s, \"second\");\n\treturn `${ms$1} ms`;\n}\n/**\n* Format the given integer as a string.\n*\n* @param ms - milliseconds\n* @param options - Options for the conversion\n* @returns The formatted string\n*/\nfunction format(ms$1, options) {\n\tif (typeof ms$1 !== \"number\" || !Number.isFinite(ms$1)) throw new Error(\"Value provided to ms.format() must be of type number.\");\n\treturn options?.long ? fmtLong(ms$1) : fmtShort(ms$1);\n}\n/**\n* Pluralization helper.\n*/\nfunction plural(ms$1, msAbs, n, name) {\n\tconst isPlural = msAbs >= n * 1.5;\n\treturn `${Math.round(ms$1 / n)} ${name}${isPlural ? \"s\" : \"\"}`;\n}\n\n//#endregion\nexport { format, ms, parse, parseStrict };","/**\n * Contains predefined constants for the trace span name in next/server.\n *\n * Currently, next/server/tracer is internal implementation only for tracking\n * next.js's implementation only with known span names defined here.\n **/ // eslint typescript has a bug with TS enums\nvar BaseServerSpan = /*#__PURE__*/ function(BaseServerSpan) {\n    BaseServerSpan[\"handleRequest\"] = \"BaseServer.handleRequest\";\n    BaseServerSpan[\"run\"] = \"BaseServer.run\";\n    BaseServerSpan[\"pipe\"] = \"BaseServer.pipe\";\n    BaseServerSpan[\"getStaticHTML\"] = \"BaseServer.getStaticHTML\";\n    BaseServerSpan[\"render\"] = \"BaseServer.render\";\n    BaseServerSpan[\"renderToResponseWithComponents\"] = \"BaseServer.renderToResponseWithComponents\";\n    BaseServerSpan[\"renderToResponse\"] = \"BaseServer.renderToResponse\";\n    BaseServerSpan[\"renderToHTML\"] = \"BaseServer.renderToHTML\";\n    BaseServerSpan[\"renderError\"] = \"BaseServer.renderError\";\n    BaseServerSpan[\"renderErrorToResponse\"] = \"BaseServer.renderErrorToResponse\";\n    BaseServerSpan[\"renderErrorToHTML\"] = \"BaseServer.renderErrorToHTML\";\n    BaseServerSpan[\"render404\"] = \"BaseServer.render404\";\n    return BaseServerSpan;\n}(BaseServerSpan || {});\nvar LoadComponentsSpan = /*#__PURE__*/ function(LoadComponentsSpan) {\n    LoadComponentsSpan[\"loadDefaultErrorComponents\"] = \"LoadComponents.loadDefaultErrorComponents\";\n    LoadComponentsSpan[\"loadComponents\"] = \"LoadComponents.loadComponents\";\n    return LoadComponentsSpan;\n}(LoadComponentsSpan || {});\nvar NextServerSpan = /*#__PURE__*/ function(NextServerSpan) {\n    NextServerSpan[\"getRequestHandler\"] = \"NextServer.getRequestHandler\";\n    NextServerSpan[\"getRequestHandlerWithMetadata\"] = \"NextServer.getRequestHandlerWithMetadata\";\n    NextServerSpan[\"getServer\"] = \"NextServer.getServer\";\n    NextServerSpan[\"getServerRequestHandler\"] = \"NextServer.getServerRequestHandler\";\n    NextServerSpan[\"createServer\"] = \"createServer.createServer\";\n    return NextServerSpan;\n}(NextServerSpan || {});\nvar NextNodeServerSpan = /*#__PURE__*/ function(NextNodeServerSpan) {\n    NextNodeServerSpan[\"compression\"] = \"NextNodeServer.compression\";\n    NextNodeServerSpan[\"getBuildId\"] = \"NextNodeServer.getBuildId\";\n    NextNodeServerSpan[\"createComponentTree\"] = \"NextNodeServer.createComponentTree\";\n    NextNodeServerSpan[\"clientComponentLoading\"] = \"NextNodeServer.clientComponentLoading\";\n    NextNodeServerSpan[\"getLayoutOrPageModule\"] = \"NextNodeServer.getLayoutOrPageModule\";\n    NextNodeServerSpan[\"generateStaticRoutes\"] = \"NextNodeServer.generateStaticRoutes\";\n    NextNodeServerSpan[\"generateFsStaticRoutes\"] = \"NextNodeServer.generateFsStaticRoutes\";\n    NextNodeServerSpan[\"generatePublicRoutes\"] = \"NextNodeServer.generatePublicRoutes\";\n    NextNodeServerSpan[\"generateImageRoutes\"] = \"NextNodeServer.generateImageRoutes.route\";\n    NextNodeServerSpan[\"sendRenderResult\"] = \"NextNodeServer.sendRenderResult\";\n    NextNodeServerSpan[\"proxyRequest\"] = \"NextNodeServer.proxyRequest\";\n    NextNodeServerSpan[\"runApi\"] = \"NextNodeServer.runApi\";\n    NextNodeServerSpan[\"render\"] = \"NextNodeServer.render\";\n    NextNodeServerSpan[\"renderHTML\"] = \"NextNodeServer.renderHTML\";\n    NextNodeServerSpan[\"imageOptimizer\"] = \"NextNodeServer.imageOptimizer\";\n    NextNodeServerSpan[\"getPagePath\"] = \"NextNodeServer.getPagePath\";\n    NextNodeServerSpan[\"getRoutesManifest\"] = \"NextNodeServer.getRoutesManifest\";\n    NextNodeServerSpan[\"findPageComponents\"] = \"NextNodeServer.findPageComponents\";\n    NextNodeServerSpan[\"getFontManifest\"] = \"NextNodeServer.getFontManifest\";\n    NextNodeServerSpan[\"getServerComponentManifest\"] = \"NextNodeServer.getServerComponentManifest\";\n    NextNodeServerSpan[\"getRequestHandler\"] = \"NextNodeServer.getRequestHandler\";\n    NextNodeServerSpan[\"renderToHTML\"] = \"NextNodeServer.renderToHTML\";\n    NextNodeServerSpan[\"renderError\"] = \"NextNodeServer.renderError\";\n    NextNodeServerSpan[\"renderErrorToHTML\"] = \"NextNodeServer.renderErrorToHTML\";\n    NextNodeServerSpan[\"render404\"] = \"NextNodeServer.render404\";\n    NextNodeServerSpan[\"startResponse\"] = \"NextNodeServer.startResponse\";\n    // nested inner span, does not require parent scope name\n    NextNodeServerSpan[\"route\"] = \"route\";\n    NextNodeServerSpan[\"onProxyReq\"] = \"onProxyReq\";\n    NextNodeServerSpan[\"apiResolver\"] = \"apiResolver\";\n    NextNodeServerSpan[\"internalFetch\"] = \"internalFetch\";\n    return NextNodeServerSpan;\n}(NextNodeServerSpan || {});\nvar StartServerSpan = /*#__PURE__*/ function(StartServerSpan) {\n    StartServerSpan[\"startServer\"] = \"startServer.startServer\";\n    return StartServerSpan;\n}(StartServerSpan || {});\nvar RenderSpan = /*#__PURE__*/ function(RenderSpan) {\n    RenderSpan[\"getServerSideProps\"] = \"Render.getServerSideProps\";\n    RenderSpan[\"getStaticProps\"] = \"Render.getStaticProps\";\n    RenderSpan[\"renderToString\"] = \"Render.renderToString\";\n    RenderSpan[\"renderDocument\"] = \"Render.renderDocument\";\n    RenderSpan[\"createBodyResult\"] = \"Render.createBodyResult\";\n    return RenderSpan;\n}(RenderSpan || {});\nvar AppRenderSpan = /*#__PURE__*/ function(AppRenderSpan) {\n    AppRenderSpan[\"renderToString\"] = \"AppRender.renderToString\";\n    AppRenderSpan[\"renderToReadableStream\"] = \"AppRender.renderToReadableStream\";\n    AppRenderSpan[\"getBodyResult\"] = \"AppRender.getBodyResult\";\n    AppRenderSpan[\"fetch\"] = \"AppRender.fetch\";\n    return AppRenderSpan;\n}(AppRenderSpan || {});\nvar RouterSpan = /*#__PURE__*/ function(RouterSpan) {\n    RouterSpan[\"executeRoute\"] = \"Router.executeRoute\";\n    return RouterSpan;\n}(RouterSpan || {});\nvar NodeSpan = /*#__PURE__*/ function(NodeSpan) {\n    NodeSpan[\"runHandler\"] = \"Node.runHandler\";\n    return NodeSpan;\n}(NodeSpan || {});\nvar AppRouteRouteHandlersSpan = /*#__PURE__*/ function(AppRouteRouteHandlersSpan) {\n    AppRouteRouteHandlersSpan[\"runHandler\"] = \"AppRouteRouteHandlers.runHandler\";\n    return AppRouteRouteHandlersSpan;\n}(AppRouteRouteHandlersSpan || {});\nvar ResolveMetadataSpan = /*#__PURE__*/ function(ResolveMetadataSpan) {\n    ResolveMetadataSpan[\"generateMetadata\"] = \"ResolveMetadata.generateMetadata\";\n    ResolveMetadataSpan[\"generateViewport\"] = \"ResolveMetadata.generateViewport\";\n    return ResolveMetadataSpan;\n}(ResolveMetadataSpan || {});\nvar MiddlewareSpan = /*#__PURE__*/ function(MiddlewareSpan) {\n    MiddlewareSpan[\"execute\"] = \"Middleware.execute\";\n    return MiddlewareSpan;\n}(MiddlewareSpan || {});\n// This list is used to filter out spans that are not relevant to the user\nexport const NextVanillaSpanAllowlist = new Set([\n    \"Middleware.execute\",\n    \"BaseServer.handleRequest\",\n    \"Render.getServerSideProps\",\n    \"Render.getStaticProps\",\n    \"AppRender.fetch\",\n    \"AppRender.getBodyResult\",\n    \"Render.renderDocument\",\n    \"Node.runHandler\",\n    \"AppRouteRouteHandlers.runHandler\",\n    \"ResolveMetadata.generateMetadata\",\n    \"ResolveMetadata.generateViewport\",\n    \"NextNodeServer.createComponentTree\",\n    \"NextNodeServer.findPageComponents\",\n    \"NextNodeServer.getLayoutOrPageModule\",\n    \"NextNodeServer.startResponse\",\n    \"NextNodeServer.clientComponentLoading\"\n]);\n// These Spans are allowed to be always logged\n// when the otel log prefix env is set\nexport const LogSpanAllowList = new Set([\n    \"NextNodeServer.findPageComponents\",\n    \"NextNodeServer.createComponentTree\",\n    \"NextNodeServer.clientComponentLoading\"\n]);\nexport { BaseServerSpan, LoadComponentsSpan, NextServerSpan, NextNodeServerSpan, StartServerSpan, RenderSpan, RouterSpan, AppRenderSpan, NodeSpan, AppRouteRouteHandlersSpan, ResolveMetadataSpan, MiddlewareSpan,  };\n\n//# sourceMappingURL=constants.js.map","var __defProp = Object.defineProperty;\nvar __defProps = Object.defineProperties;\nvar __getOwnPropDescs = Object.getOwnPropertyDescriptors;\nvar __getOwnPropSymbols = Object.getOwnPropertySymbols;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __propIsEnum = Object.prototype.propertyIsEnumerable;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __spreadValues = (a, b) => {\n  for (var prop in b || (b = {}))\n    if (__hasOwnProp.call(b, prop))\n      __defNormalProp(a, prop, b[prop]);\n  if (__getOwnPropSymbols)\n    for (var prop of __getOwnPropSymbols(b)) {\n      if (__propIsEnum.call(b, prop))\n        __defNormalProp(a, prop, b[prop]);\n    }\n  return a;\n};\nvar __spreadProps = (a, b) => __defProps(a, __getOwnPropDescs(b));\n\n// src/error.ts\nvar BetterFetchError = class extends Error {\n  constructor(status, statusText, error) {\n    super(statusText || status.toString(), {\n      cause: error\n    });\n    this.status = status;\n    this.statusText = statusText;\n    this.error = error;\n  }\n};\n\n// src/plugins.ts\nvar initializePlugins = async (url, options) => {\n  var _a, _b, _c, _d, _e, _f;\n  let opts = options || {};\n  const hooks = {\n    onRequest: [options == null ? void 0 : options.onRequest],\n    onResponse: [options == null ? void 0 : options.onResponse],\n    onSuccess: [options == null ? void 0 : options.onSuccess],\n    onError: [options == null ? void 0 : options.onError],\n    onRetry: [options == null ? void 0 : options.onRetry]\n  };\n  if (!options || !(options == null ? void 0 : options.plugins)) {\n    return {\n      url,\n      options: opts,\n      hooks\n    };\n  }\n  for (const plugin of (options == null ? void 0 : options.plugins) || []) {\n    if (plugin.init) {\n      const pluginRes = await ((_a = plugin.init) == null ? void 0 : _a.call(plugin, url.toString(), options));\n      opts = pluginRes.options || opts;\n      url = pluginRes.url;\n    }\n    hooks.onRequest.push((_b = plugin.hooks) == null ? void 0 : _b.onRequest);\n    hooks.onResponse.push((_c = plugin.hooks) == null ? void 0 : _c.onResponse);\n    hooks.onSuccess.push((_d = plugin.hooks) == null ? void 0 : _d.onSuccess);\n    hooks.onError.push((_e = plugin.hooks) == null ? void 0 : _e.onError);\n    hooks.onRetry.push((_f = plugin.hooks) == null ? void 0 : _f.onRetry);\n  }\n  return {\n    url,\n    options: opts,\n    hooks\n  };\n};\n\n// src/retry.ts\nvar LinearRetryStrategy = class {\n  constructor(options) {\n    this.options = options;\n  }\n  shouldAttemptRetry(attempt, response) {\n    if (this.options.shouldRetry) {\n      return Promise.resolve(\n        attempt < this.options.attempts && this.options.shouldRetry(response)\n      );\n    }\n    return Promise.resolve(attempt < this.options.attempts);\n  }\n  getDelay() {\n    return this.options.delay;\n  }\n};\nvar ExponentialRetryStrategy = class {\n  constructor(options) {\n    this.options = options;\n  }\n  shouldAttemptRetry(attempt, response) {\n    if (this.options.shouldRetry) {\n      return Promise.resolve(\n        attempt < this.options.attempts && this.options.shouldRetry(response)\n      );\n    }\n    return Promise.resolve(attempt < this.options.attempts);\n  }\n  getDelay(attempt) {\n    const delay = Math.min(\n      this.options.maxDelay,\n      this.options.baseDelay * 2 ** attempt\n    );\n    return delay;\n  }\n};\nfunction createRetryStrategy(options) {\n  if (typeof options === \"number\") {\n    return new LinearRetryStrategy({\n      type: \"linear\",\n      attempts: options,\n      delay: 1e3\n    });\n  }\n  switch (options.type) {\n    case \"linear\":\n      return new LinearRetryStrategy(options);\n    case \"exponential\":\n      return new ExponentialRetryStrategy(options);\n    default:\n      throw new Error(\"Invalid retry strategy\");\n  }\n}\n\n// src/auth.ts\nvar getAuthHeader = async (options) => {\n  const headers = {};\n  const getValue = async (value) => typeof value === \"function\" ? await value() : value;\n  if (options == null ? void 0 : options.auth) {\n    if (options.auth.type === \"Bearer\") {\n      const token = await getValue(options.auth.token);\n      if (!token) {\n        return headers;\n      }\n      headers[\"authorization\"] = `Bearer ${token}`;\n    } else if (options.auth.type === \"Basic\") {\n      const username = getValue(options.auth.username);\n      const password = getValue(options.auth.password);\n      if (!username || !password) {\n        return headers;\n      }\n      headers[\"authorization\"] = `Basic ${btoa(`${username}:${password}`)}`;\n    } else if (options.auth.type === \"Custom\") {\n      const value = getValue(options.auth.value);\n      if (!value) {\n        return headers;\n      }\n      headers[\"authorization\"] = `${getValue(options.auth.prefix)} ${value}`;\n    }\n  }\n  return headers;\n};\n\n// src/utils.ts\nvar JSON_RE = /^application\\/(?:[\\w!#$%&*.^`~-]*\\+)?json(;.+)?$/i;\nfunction detectResponseType(request) {\n  const _contentType = request.headers.get(\"content-type\");\n  const textTypes = /* @__PURE__ */ new Set([\n    \"image/svg\",\n    \"application/xml\",\n    \"application/xhtml\",\n    \"application/html\"\n  ]);\n  if (!_contentType) {\n    return \"json\";\n  }\n  const contentType = _contentType.split(\";\").shift() || \"\";\n  if (JSON_RE.test(contentType)) {\n    return \"json\";\n  }\n  if (textTypes.has(contentType) || contentType.startsWith(\"text/\")) {\n    return \"text\";\n  }\n  return \"blob\";\n}\nfunction isJSONParsable(value) {\n  try {\n    JSON.parse(value);\n    return true;\n  } catch (error) {\n    return false;\n  }\n}\nfunction isJSONSerializable(value) {\n  if (value === void 0) {\n    return false;\n  }\n  const t = typeof value;\n  if (t === \"string\" || t === \"number\" || t === \"boolean\" || t === null) {\n    return true;\n  }\n  if (t !== \"object\") {\n    return false;\n  }\n  if (Array.isArray(value)) {\n    return true;\n  }\n  if (value.buffer) {\n    return false;\n  }\n  return value.constructor && value.constructor.name === \"Object\" || typeof value.toJSON === \"function\";\n}\nfunction jsonParse(text) {\n  try {\n    return JSON.parse(text);\n  } catch (error) {\n    return text;\n  }\n}\nfunction isFunction(value) {\n  return typeof value === \"function\";\n}\nfunction getFetch(options) {\n  if (options == null ? void 0 : options.customFetchImpl) {\n    return options.customFetchImpl;\n  }\n  if (typeof globalThis !== \"undefined\" && isFunction(globalThis.fetch)) {\n    return globalThis.fetch;\n  }\n  if (typeof window !== \"undefined\" && isFunction(window.fetch)) {\n    return window.fetch;\n  }\n  throw new Error(\"No fetch implementation found\");\n}\nfunction isPayloadMethod(method) {\n  if (!method) {\n    return false;\n  }\n  const payloadMethod = [\"POST\", \"PUT\", \"PATCH\", \"DELETE\"];\n  return payloadMethod.includes(method.toUpperCase());\n}\nfunction isRouteMethod(method) {\n  const routeMethod = [\"GET\", \"POST\", \"PUT\", \"PATCH\", \"DELETE\"];\n  if (!method) {\n    return false;\n  }\n  return routeMethod.includes(method.toUpperCase());\n}\nasync function getHeaders(opts) {\n  const headers = new Headers(opts == null ? void 0 : opts.headers);\n  const authHeader = await getAuthHeader(opts);\n  for (const [key, value] of Object.entries(authHeader || {})) {\n    headers.set(key, value);\n  }\n  if (!headers.has(\"content-type\")) {\n    const t = detectContentType(opts == null ? void 0 : opts.body);\n    if (t) {\n      headers.set(\"content-type\", t);\n    }\n  }\n  return headers;\n}\nfunction getURL(url, options) {\n  if (url.startsWith(\"@\")) {\n    const m = url.toString().split(\"@\")[1].split(\"/\")[0];\n    if (methods.includes(m)) {\n      url = url.replace(`@${m}/`, \"/\");\n    }\n  }\n  let _url;\n  try {\n    if (url.startsWith(\"http\")) {\n      _url = url;\n    } else {\n      let baseURL = options == null ? void 0 : options.baseURL;\n      if (baseURL && !(baseURL == null ? void 0 : baseURL.endsWith(\"/\"))) {\n        baseURL = baseURL + \"/\";\n      }\n      if (url.startsWith(\"/\")) {\n        _url = new URL(url.substring(1), baseURL);\n      } else {\n        _url = new URL(url, options == null ? void 0 : options.baseURL);\n      }\n    }\n  } catch (e) {\n    if (e instanceof TypeError) {\n      if (!(options == null ? void 0 : options.baseURL)) {\n        throw TypeError(\n          `Invalid URL ${url}. Are you passing in a relative url but not setting the baseURL?`\n        );\n      }\n      throw TypeError(\n        `Invalid URL ${url}. Please validate that you are passing the correct input.`\n      );\n    }\n    throw e;\n  }\n  if (options == null ? void 0 : options.params) {\n    if (Array.isArray(options == null ? void 0 : options.params)) {\n      const params = (options == null ? void 0 : options.params) ? Array.isArray(options.params) ? `/${options.params.join(\"/\")}` : `/${Object.values(options.params).join(\"/\")}` : \"\";\n      _url = _url.toString().split(\"/:\")[0];\n      _url = `${_url.toString()}${params}`;\n    } else {\n      for (const [key, value] of Object.entries(options == null ? void 0 : options.params)) {\n        _url = _url.toString().replace(`:${key}`, String(value));\n      }\n    }\n  }\n  const __url = new URL(_url);\n  const queryParams = options == null ? void 0 : options.query;\n  if (queryParams) {\n    for (const [key, value] of Object.entries(queryParams)) {\n      __url.searchParams.append(key, String(value));\n    }\n  }\n  return __url;\n}\nfunction detectContentType(body) {\n  if (isJSONSerializable(body)) {\n    return \"application/json\";\n  }\n  return null;\n}\nfunction getBody(options) {\n  if (!(options == null ? void 0 : options.body)) {\n    return null;\n  }\n  const headers = new Headers(options == null ? void 0 : options.headers);\n  if (isJSONSerializable(options.body) && !headers.has(\"content-type\")) {\n    for (const [key, value] of Object.entries(options == null ? void 0 : options.body)) {\n      if (value instanceof Date) {\n        options.body[key] = value.toISOString();\n      }\n    }\n    return JSON.stringify(options.body);\n  }\n  return options.body;\n}\nfunction getMethod(url, options) {\n  var _a;\n  if (options == null ? void 0 : options.method) {\n    return options.method.toUpperCase();\n  }\n  if (url.startsWith(\"@\")) {\n    const pMethod = (_a = url.split(\"@\")[1]) == null ? void 0 : _a.split(\"/\")[0];\n    if (!methods.includes(pMethod)) {\n      return (options == null ? void 0 : options.body) ? \"POST\" : \"GET\";\n    }\n    return pMethod.toUpperCase();\n  }\n  return (options == null ? void 0 : options.body) ? \"POST\" : \"GET\";\n}\nfunction getTimeout(options, controller) {\n  let abortTimeout;\n  if (!(options == null ? void 0 : options.signal) && (options == null ? void 0 : options.timeout)) {\n    abortTimeout = setTimeout(() => controller == null ? void 0 : controller.abort(), options == null ? void 0 : options.timeout);\n  }\n  return {\n    abortTimeout,\n    clearTimeout: () => {\n      if (abortTimeout) {\n        clearTimeout(abortTimeout);\n      }\n    }\n  };\n}\nfunction bodyParser(data, responseType) {\n  if (responseType === \"json\") {\n    return JSON.parse(data);\n  }\n  return data;\n}\nvar ValidationError = class _ValidationError extends Error {\n  constructor(issues, message) {\n    super(message || JSON.stringify(issues, null, 2));\n    this.issues = issues;\n    Object.setPrototypeOf(this, _ValidationError.prototype);\n  }\n};\nasync function parseStandardSchema(schema, input) {\n  let result = await schema[\"~standard\"].validate(input);\n  if (result.issues) {\n    throw new ValidationError(result.issues);\n  }\n  return result.value;\n}\n\n// src/create-fetch/schema.ts\nvar methods = [\"get\", \"post\", \"put\", \"patch\", \"delete\"];\nvar createSchema = (schema, config) => {\n  return {\n    schema,\n    config\n  };\n};\n\n// src/create-fetch/index.ts\nvar applySchemaPlugin = (config) => ({\n  id: \"apply-schema\",\n  name: \"Apply Schema\",\n  version: \"1.0.0\",\n  async init(url, options) {\n    var _a, _b, _c, _d;\n    const schema = ((_b = (_a = config.plugins) == null ? void 0 : _a.find(\n      (plugin) => {\n        var _a2;\n        return ((_a2 = plugin.schema) == null ? void 0 : _a2.config) ? url.startsWith(plugin.schema.config.baseURL || \"\") || url.startsWith(plugin.schema.config.prefix || \"\") : false;\n      }\n    )) == null ? void 0 : _b.schema) || config.schema;\n    if (schema) {\n      let urlKey = url;\n      if ((_c = schema.config) == null ? void 0 : _c.prefix) {\n        if (urlKey.startsWith(schema.config.prefix)) {\n          urlKey = urlKey.replace(schema.config.prefix, \"\");\n          if (schema.config.baseURL) {\n            url = url.replace(schema.config.prefix, schema.config.baseURL);\n          }\n        }\n      }\n      if ((_d = schema.config) == null ? void 0 : _d.baseURL) {\n        if (urlKey.startsWith(schema.config.baseURL)) {\n          urlKey = urlKey.replace(schema.config.baseURL, \"\");\n        }\n      }\n      const keySchema = schema.schema[urlKey];\n      if (keySchema) {\n        let opts = __spreadProps(__spreadValues({}, options), {\n          method: keySchema.method,\n          output: keySchema.output\n        });\n        if (!(options == null ? void 0 : options.disableValidation)) {\n          opts = __spreadProps(__spreadValues({}, opts), {\n            body: keySchema.input ? await parseStandardSchema(keySchema.input, options == null ? void 0 : options.body) : options == null ? void 0 : options.body,\n            params: keySchema.params ? await parseStandardSchema(keySchema.params, options == null ? void 0 : options.params) : options == null ? void 0 : options.params,\n            query: keySchema.query ? await parseStandardSchema(keySchema.query, options == null ? void 0 : options.query) : options == null ? void 0 : options.query\n          });\n        }\n        return {\n          url,\n          options: opts\n        };\n      }\n    }\n    return {\n      url,\n      options\n    };\n  }\n});\nvar createFetch = (config) => {\n  async function $fetch(url, options) {\n    const opts = __spreadProps(__spreadValues(__spreadValues({}, config), options), {\n      plugins: [...(config == null ? void 0 : config.plugins) || [], applySchemaPlugin(config || {})]\n    });\n    if (config == null ? void 0 : config.catchAllError) {\n      try {\n        return await betterFetch(url, opts);\n      } catch (error) {\n        return {\n          data: null,\n          error: {\n            status: 500,\n            statusText: \"Fetch Error\",\n            message: \"Fetch related error. Captured by catchAllError option. See error property for more details.\",\n            error\n          }\n        };\n      }\n    }\n    return await betterFetch(url, opts);\n  }\n  return $fetch;\n};\n\n// src/url.ts\nfunction getURL2(url, option) {\n  let { baseURL, params, query } = option || {\n    query: {},\n    params: {},\n    baseURL: \"\"\n  };\n  let basePath = url.startsWith(\"http\") ? url.split(\"/\").slice(0, 3).join(\"/\") : baseURL || \"\";\n  if (url.startsWith(\"@\")) {\n    const m = url.toString().split(\"@\")[1].split(\"/\")[0];\n    if (methods.includes(m)) {\n      url = url.replace(`@${m}/`, \"/\");\n    }\n  }\n  if (!basePath.endsWith(\"/\")) basePath += \"/\";\n  let [path, urlQuery] = url.replace(basePath, \"\").split(\"?\");\n  const queryParams = new URLSearchParams(urlQuery);\n  for (const [key, value] of Object.entries(query || {})) {\n    if (value == null) continue;\n    queryParams.set(key, String(value));\n  }\n  if (params) {\n    if (Array.isArray(params)) {\n      const paramPaths = path.split(\"/\").filter((p) => p.startsWith(\":\"));\n      for (const [index, key] of paramPaths.entries()) {\n        const value = params[index];\n        path = path.replace(key, value);\n      }\n    } else {\n      for (const [key, value] of Object.entries(params)) {\n        path = path.replace(`:${key}`, String(value));\n      }\n    }\n  }\n  path = path.split(\"/\").map(encodeURIComponent).join(\"/\");\n  if (path.startsWith(\"/\")) path = path.slice(1);\n  let queryParamString = queryParams.toString();\n  queryParamString = queryParamString.length > 0 ? `?${queryParamString}`.replace(/\\+/g, \"%20\") : \"\";\n  if (!basePath.startsWith(\"http\")) {\n    return `${basePath}${path}${queryParamString}`;\n  }\n  const _url = new URL(`${path}${queryParamString}`, basePath);\n  return _url;\n}\n\n// src/fetch.ts\nvar betterFetch = async (url, options) => {\n  var _a, _b, _c, _d, _e, _f, _g, _h;\n  const {\n    hooks,\n    url: __url,\n    options: opts\n  } = await initializePlugins(url, options);\n  const fetch = getFetch(opts);\n  const controller = new AbortController();\n  const signal = (_a = opts.signal) != null ? _a : controller.signal;\n  const _url = getURL2(__url, opts);\n  const body = getBody(opts);\n  const headers = await getHeaders(opts);\n  const method = getMethod(__url, opts);\n  let context = __spreadProps(__spreadValues({}, opts), {\n    url: _url,\n    headers,\n    body,\n    method,\n    signal\n  });\n  for (const onRequest of hooks.onRequest) {\n    if (onRequest) {\n      const res = await onRequest(context);\n      if (res instanceof Object) {\n        context = res;\n      }\n    }\n  }\n  if (\"pipeTo\" in context && typeof context.pipeTo === \"function\" || typeof ((_b = options == null ? void 0 : options.body) == null ? void 0 : _b.pipe) === \"function\") {\n    if (!(\"duplex\" in context)) {\n      context.duplex = \"half\";\n    }\n  }\n  const { clearTimeout: clearTimeout2 } = getTimeout(opts, controller);\n  let response = await fetch(context.url, context);\n  clearTimeout2();\n  const responseContext = {\n    response,\n    request: context\n  };\n  for (const onResponse of hooks.onResponse) {\n    if (onResponse) {\n      const r = await onResponse(__spreadProps(__spreadValues({}, responseContext), {\n        response: ((_c = options == null ? void 0 : options.hookOptions) == null ? void 0 : _c.cloneResponse) ? response.clone() : response\n      }));\n      if (r instanceof Response) {\n        response = r;\n      } else if (r instanceof Object) {\n        response = r.response;\n      }\n    }\n  }\n  if (response.ok) {\n    const hasBody = context.method !== \"HEAD\";\n    if (!hasBody) {\n      return {\n        data: \"\",\n        error: null\n      };\n    }\n    const responseType = detectResponseType(response);\n    const successContext = {\n      data: \"\",\n      response,\n      request: context\n    };\n    if (responseType === \"json\" || responseType === \"text\") {\n      const text = await response.text();\n      const parser2 = (_d = context.jsonParser) != null ? _d : jsonParse;\n      const data = await parser2(text);\n      successContext.data = data;\n    } else {\n      successContext.data = await response[responseType]();\n    }\n    if (context == null ? void 0 : context.output) {\n      if (context.output && !context.disableValidation) {\n        successContext.data = await parseStandardSchema(\n          context.output,\n          successContext.data\n        );\n      }\n    }\n    for (const onSuccess of hooks.onSuccess) {\n      if (onSuccess) {\n        await onSuccess(__spreadProps(__spreadValues({}, successContext), {\n          response: ((_e = options == null ? void 0 : options.hookOptions) == null ? void 0 : _e.cloneResponse) ? response.clone() : response\n        }));\n      }\n    }\n    if (options == null ? void 0 : options.throw) {\n      return successContext.data;\n    }\n    return {\n      data: successContext.data,\n      error: null\n    };\n  }\n  const parser = (_f = options == null ? void 0 : options.jsonParser) != null ? _f : jsonParse;\n  const responseText = await response.text();\n  const isJSONResponse = isJSONParsable(responseText);\n  const errorObject = isJSONResponse ? await parser(responseText) : null;\n  const errorContext = {\n    response,\n    responseText,\n    request: context,\n    error: __spreadProps(__spreadValues({}, errorObject), {\n      status: response.status,\n      statusText: response.statusText\n    })\n  };\n  for (const onError of hooks.onError) {\n    if (onError) {\n      await onError(__spreadProps(__spreadValues({}, errorContext), {\n        response: ((_g = options == null ? void 0 : options.hookOptions) == null ? void 0 : _g.cloneResponse) ? response.clone() : response\n      }));\n    }\n  }\n  if (options == null ? void 0 : options.retry) {\n    const retryStrategy = createRetryStrategy(options.retry);\n    const _retryAttempt = (_h = options.retryAttempt) != null ? _h : 0;\n    if (await retryStrategy.shouldAttemptRetry(_retryAttempt, response)) {\n      for (const onRetry of hooks.onRetry) {\n        if (onRetry) {\n          await onRetry(responseContext);\n        }\n      }\n      const delay = retryStrategy.getDelay(_retryAttempt);\n      await new Promise((resolve) => setTimeout(resolve, delay));\n      return await betterFetch(url, __spreadProps(__spreadValues({}, options), {\n        retryAttempt: _retryAttempt + 1\n      }));\n    }\n  }\n  if (options == null ? void 0 : options.throw) {\n    throw new BetterFetchError(\n      response.status,\n      response.statusText,\n      isJSONResponse ? errorObject : responseText\n    );\n  }\n  return {\n    data: null,\n    error: __spreadProps(__spreadValues({}, errorObject), {\n      status: response.status,\n      statusText: response.statusText\n    })\n  };\n};\nexport {\n  BetterFetchError,\n  ValidationError,\n  applySchemaPlugin,\n  betterFetch,\n  bodyParser,\n  createFetch,\n  createRetryStrategy,\n  createSchema,\n  detectContentType,\n  detectResponseType,\n  getBody,\n  getFetch,\n  getHeaders,\n  getMethod,\n  getTimeout,\n  getURL,\n  initializePlugins,\n  isFunction,\n  isJSONParsable,\n  isJSONSerializable,\n  isPayloadMethod,\n  isRouteMethod,\n  jsonParse,\n  methods,\n  parseStandardSchema\n};\n//# sourceMappingURL=index.js.map","import { JOSEError, JWKSNoMatchingKey, JWKSTimeout } from '../util/errors.js';\nimport { createLocalJWKSet } from './local.js';\nimport { isObject } from '../lib/is_object.js';\nfunction isCloudflareWorkers() {\n    return (typeof WebSocketPair !== 'undefined' ||\n        (typeof navigator !== 'undefined' && navigator.userAgent === 'Cloudflare-Workers') ||\n        (typeof EdgeRuntime !== 'undefined' && EdgeRuntime === 'vercel'));\n}\nlet USER_AGENT;\nif (typeof navigator === 'undefined' || !navigator.userAgent?.startsWith?.('Mozilla/5.0 ')) {\n    const NAME = 'jose';\n    const VERSION = 'v6.1.3';\n    USER_AGENT = `${NAME}/${VERSION}`;\n}\nexport const customFetch = Symbol();\nasync function fetchJwks(url, headers, signal, fetchImpl = fetch) {\n    const response = await fetchImpl(url, {\n        method: 'GET',\n        signal,\n        redirect: 'manual',\n        headers,\n    }).catch((err) => {\n        if (err.name === 'TimeoutError') {\n            throw new JWKSTimeout();\n        }\n        throw err;\n    });\n    if (response.status !== 200) {\n        throw new JOSEError('Expected 200 OK from the JSON Web Key Set HTTP response');\n    }\n    try {\n        return await response.json();\n    }\n    catch {\n        throw new JOSEError('Failed to parse the JSON Web Key Set HTTP response as JSON');\n    }\n}\nexport const jwksCache = Symbol();\nfunction isFreshJwksCache(input, cacheMaxAge) {\n    if (typeof input !== 'object' || input === null) {\n        return false;\n    }\n    if (!('uat' in input) || typeof input.uat !== 'number' || Date.now() - input.uat >= cacheMaxAge) {\n        return false;\n    }\n    if (!('jwks' in input) ||\n        !isObject(input.jwks) ||\n        !Array.isArray(input.jwks.keys) ||\n        !Array.prototype.every.call(input.jwks.keys, isObject)) {\n        return false;\n    }\n    return true;\n}\nclass RemoteJWKSet {\n    #url;\n    #timeoutDuration;\n    #cooldownDuration;\n    #cacheMaxAge;\n    #jwksTimestamp;\n    #pendingFetch;\n    #headers;\n    #customFetch;\n    #local;\n    #cache;\n    constructor(url, options) {\n        if (!(url instanceof URL)) {\n            throw new TypeError('url must be an instance of URL');\n        }\n        this.#url = new URL(url.href);\n        this.#timeoutDuration =\n            typeof options?.timeoutDuration === 'number' ? options?.timeoutDuration : 5000;\n        this.#cooldownDuration =\n            typeof options?.cooldownDuration === 'number' ? options?.cooldownDuration : 30000;\n        this.#cacheMaxAge = typeof options?.cacheMaxAge === 'number' ? options?.cacheMaxAge : 600000;\n        this.#headers = new Headers(options?.headers);\n        if (USER_AGENT && !this.#headers.has('User-Agent')) {\n            this.#headers.set('User-Agent', USER_AGENT);\n        }\n        if (!this.#headers.has('accept')) {\n            this.#headers.set('accept', 'application/json');\n            this.#headers.append('accept', 'application/jwk-set+json');\n        }\n        this.#customFetch = options?.[customFetch];\n        if (options?.[jwksCache] !== undefined) {\n            this.#cache = options?.[jwksCache];\n            if (isFreshJwksCache(options?.[jwksCache], this.#cacheMaxAge)) {\n                this.#jwksTimestamp = this.#cache.uat;\n                this.#local = createLocalJWKSet(this.#cache.jwks);\n            }\n        }\n    }\n    pendingFetch() {\n        return !!this.#pendingFetch;\n    }\n    coolingDown() {\n        return typeof this.#jwksTimestamp === 'number'\n            ? Date.now() < this.#jwksTimestamp + this.#cooldownDuration\n            : false;\n    }\n    fresh() {\n        return typeof this.#jwksTimestamp === 'number'\n            ? Date.now() < this.#jwksTimestamp + this.#cacheMaxAge\n            : false;\n    }\n    jwks() {\n        return this.#local?.jwks();\n    }\n    async getKey(protectedHeader, token) {\n        if (!this.#local || !this.fresh()) {\n            await this.reload();\n        }\n        try {\n            return await this.#local(protectedHeader, token);\n        }\n        catch (err) {\n            if (err instanceof JWKSNoMatchingKey) {\n                if (this.coolingDown() === false) {\n                    await this.reload();\n                    return this.#local(protectedHeader, token);\n                }\n            }\n            throw err;\n        }\n    }\n    async reload() {\n        if (this.#pendingFetch && isCloudflareWorkers()) {\n            this.#pendingFetch = undefined;\n        }\n        this.#pendingFetch ||= fetchJwks(this.#url.href, this.#headers, AbortSignal.timeout(this.#timeoutDuration), this.#customFetch)\n            .then((json) => {\n            this.#local = createLocalJWKSet(json);\n            if (this.#cache) {\n                this.#cache.uat = Date.now();\n                this.#cache.jwks = json;\n            }\n            this.#jwksTimestamp = Date.now();\n            this.#pendingFetch = undefined;\n        })\n            .catch((err) => {\n            this.#pendingFetch = undefined;\n            throw err;\n        });\n        await this.#pendingFetch;\n    }\n}\nexport function createRemoteJWKSet(url, options) {\n    const set = new RemoteJWKSet(url, options);\n    const remoteJWKSet = async (protectedHeader, token) => set.getKey(protectedHeader, token);\n    Object.defineProperties(remoteJWKSet, {\n        coolingDown: {\n            get: () => set.coolingDown(),\n            enumerable: true,\n            configurable: false,\n        },\n        fresh: {\n            get: () => set.fresh(),\n            enumerable: true,\n            configurable: false,\n        },\n        reload: {\n            value: () => set.reload(),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n        reloading: {\n            get: () => set.pendingFetch(),\n            enumerable: true,\n            configurable: false,\n        },\n        jwks: {\n            value: () => set.jwks(),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n    });\n    return remoteJWKSet;\n}\n","import { importJWK } from '../key/import.js';\nimport { JWKSInvalid, JOSENotSupported, JWKSNoMatchingKey, JWKSMultipleMatchingKeys, } from '../util/errors.js';\nimport { isObject } from '../lib/is_object.js';\nfunction getKtyFromAlg(alg) {\n    switch (typeof alg === 'string' && alg.slice(0, 2)) {\n        case 'RS':\n        case 'PS':\n            return 'RSA';\n        case 'ES':\n            return 'EC';\n        case 'Ed':\n            return 'OKP';\n        case 'ML':\n            return 'AKP';\n        default:\n            throw new JOSENotSupported('Unsupported \"alg\" value for a JSON Web Key Set');\n    }\n}\nfunction isJWKSLike(jwks) {\n    return (jwks &&\n        typeof jwks === 'object' &&\n        Array.isArray(jwks.keys) &&\n        jwks.keys.every(isJWKLike));\n}\nfunction isJWKLike(key) {\n    return isObject(key);\n}\nclass LocalJWKSet {\n    #jwks;\n    #cached = new WeakMap();\n    constructor(jwks) {\n        if (!isJWKSLike(jwks)) {\n            throw new JWKSInvalid('JSON Web Key Set malformed');\n        }\n        this.#jwks = structuredClone(jwks);\n    }\n    jwks() {\n        return this.#jwks;\n    }\n    async getKey(protectedHeader, token) {\n        const { alg, kid } = { ...protectedHeader, ...token?.header };\n        const kty = getKtyFromAlg(alg);\n        const candidates = this.#jwks.keys.filter((jwk) => {\n            let candidate = kty === jwk.kty;\n            if (candidate && typeof kid === 'string') {\n                candidate = kid === jwk.kid;\n            }\n            if (candidate && (typeof jwk.alg === 'string' || kty === 'AKP')) {\n                candidate = alg === jwk.alg;\n            }\n            if (candidate && typeof jwk.use === 'string') {\n                candidate = jwk.use === 'sig';\n            }\n            if (candidate && Array.isArray(jwk.key_ops)) {\n                candidate = jwk.key_ops.includes('verify');\n            }\n            if (candidate) {\n                switch (alg) {\n                    case 'ES256':\n                        candidate = jwk.crv === 'P-256';\n                        break;\n                    case 'ES384':\n                        candidate = jwk.crv === 'P-384';\n                        break;\n                    case 'ES512':\n                        candidate = jwk.crv === 'P-521';\n                        break;\n                    case 'Ed25519':\n                    case 'EdDSA':\n                        candidate = jwk.crv === 'Ed25519';\n                        break;\n                }\n            }\n            return candidate;\n        });\n        const { 0: jwk, length } = candidates;\n        if (length === 0) {\n            throw new JWKSNoMatchingKey();\n        }\n        if (length !== 1) {\n            const error = new JWKSMultipleMatchingKeys();\n            const _cached = this.#cached;\n            error[Symbol.asyncIterator] = async function* () {\n                for (const jwk of candidates) {\n                    try {\n                        yield await importWithAlgCache(_cached, jwk, alg);\n                    }\n                    catch { }\n                }\n            };\n            throw error;\n        }\n        return importWithAlgCache(this.#cached, jwk, alg);\n    }\n}\nasync function importWithAlgCache(cache, jwk, alg) {\n    const cached = cache.get(jwk) || cache.set(jwk, {}).get(jwk);\n    if (cached[alg] === undefined) {\n        const key = await importJWK({ ...jwk, ext: true }, alg);\n        if (key instanceof Uint8Array || key.type !== 'public') {\n            throw new JWKSInvalid('JSON Web Key Set members must be public keys');\n        }\n        cached[alg] = key;\n    }\n    return cached[alg];\n}\nexport function createLocalJWKSet(jwks) {\n    const set = new LocalJWKSet(jwks);\n    const localJWKSet = async (protectedHeader, token) => set.getKey(protectedHeader, token);\n    Object.defineProperties(localJWKSet, {\n        jwks: {\n            value: () => structuredClone(set.jwks()),\n            enumerable: false,\n            configurable: false,\n            writable: false,\n        },\n    });\n    return localJWKSet;\n}\n","import { decode as b64u } from './base64url.js';\nimport { decoder } from '../lib/buffer_utils.js';\nimport { isObject } from '../lib/is_object.js';\nimport { JWTInvalid } from './errors.js';\nexport function decodeJwt(jwt) {\n    if (typeof jwt !== 'string')\n        throw new JWTInvalid('JWTs must use Compact JWS serialization, JWT must be a string');\n    const { 1: payload, length } = jwt.split('.');\n    if (length === 5)\n        throw new JWTInvalid('Only JWTs using Compact JWS serialization can be decoded');\n    if (length !== 3)\n        throw new JWTInvalid('Invalid JWT');\n    if (!payload)\n        throw new JWTInvalid('JWTs must contain a payload');\n    let decoded;\n    try {\n        decoded = b64u(payload);\n    }\n    catch {\n        throw new JWTInvalid('Failed to base64url decode the payload');\n    }\n    let result;\n    try {\n        result = JSON.parse(decoder.decode(decoded));\n    }\n    catch {\n        throw new JWTInvalid('Failed to parse the decoded payload as JSON');\n    }\n    if (!isObject(result))\n        throw new JWTInvalid('Invalid JWT Claims Set');\n    return result;\n}\n","function isPlainObject(value) {\n  if (value === null || typeof value !== \"object\") {\n    return false;\n  }\n  const prototype = Object.getPrototypeOf(value);\n  if (prototype !== null && prototype !== Object.prototype && Object.getPrototypeOf(prototype) !== null) {\n    return false;\n  }\n  if (Symbol.iterator in value) {\n    return false;\n  }\n  if (Symbol.toStringTag in value) {\n    return Object.prototype.toString.call(value) === \"[object Module]\";\n  }\n  return true;\n}\n\nfunction _defu(baseObject, defaults, namespace = \".\", merger) {\n  if (!isPlainObject(defaults)) {\n    return _defu(baseObject, {}, namespace, merger);\n  }\n  const object = Object.assign({}, defaults);\n  for (const key in baseObject) {\n    if (key === \"__proto__\" || key === \"constructor\") {\n      continue;\n    }\n    const value = baseObject[key];\n    if (value === null || value === void 0) {\n      continue;\n    }\n    if (merger && merger(object, key, value, namespace)) {\n      continue;\n    }\n    if (Array.isArray(value) && Array.isArray(object[key])) {\n      object[key] = [...value, ...object[key]];\n    } else if (isPlainObject(value) && isPlainObject(object[key])) {\n      object[key] = _defu(\n        value,\n        object[key],\n        (namespace ? `${namespace}.` : \"\") + key.toString(),\n        merger\n      );\n    } else {\n      object[key] = value;\n    }\n  }\n  return object;\n}\nfunction createDefu(merger) {\n  return (...arguments_) => (\n    // eslint-disable-next-line unicorn/no-array-reduce\n    arguments_.reduce((p, c) => _defu(p, c, \"\", merger), {})\n  );\n}\nconst defu = createDefu();\nconst defuFn = createDefu((object, key, currentValue) => {\n  if (object[key] !== void 0 && typeof currentValue === \"function\") {\n    object[key] = currentValue(object[key]);\n    return true;\n  }\n});\nconst defuArrayFn = createDefu((object, key, currentValue) => {\n  if (Array.isArray(object[key]) && typeof currentValue === \"function\") {\n    object[key] = currentValue(object[key]);\n    return true;\n  }\n});\n\nexport { createDefu, defu as default, defu, defuArrayFn, defuFn };\n","const entityKind = Symbol.for(\"drizzle:entityKind\");\nconst hasOwnEntityKind = Symbol.for(\"drizzle:hasOwnEntityKind\");\nfunction is(value, type) {\n  if (!value || typeof value !== \"object\") {\n    return false;\n  }\n  if (value instanceof type) {\n    return true;\n  }\n  if (!Object.prototype.hasOwnProperty.call(type, entityKind)) {\n    throw new Error(\n      `Class \"${type.name ?? \"<unknown>\"}\" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`\n    );\n  }\n  let cls = Object.getPrototypeOf(value).constructor;\n  if (cls) {\n    while (cls) {\n      if (entityKind in cls && cls[entityKind] === type[entityKind]) {\n        return true;\n      }\n      cls = Object.getPrototypeOf(cls);\n    }\n  }\n  return false;\n}\nexport {\n  entityKind,\n  hasOwnEntityKind,\n  is\n};\n//# sourceMappingURL=entity.js.map","const TableName = Symbol.for(\"drizzle:Name\");\nexport {\n  TableName\n};\n//# sourceMappingURL=table.utils.js.map","function iife(fn, ...args) {\n  return fn(...args);\n}\nexport {\n  iife\n};\n//# sourceMappingURL=tracing-utils.js.map","function parsePgArrayValue(arrayString, startFrom, inQuotes) {\n  for (let i = startFrom; i < arrayString.length; i++) {\n    const char = arrayString[i];\n    if (char === \"\\\\\") {\n      i++;\n      continue;\n    }\n    if (char === '\"') {\n      return [arrayString.slice(startFrom, i).replace(/\\\\/g, \"\"), i + 1];\n    }\n    if (inQuotes) {\n      continue;\n    }\n    if (char === \",\" || char === \"}\") {\n      return [arrayString.slice(startFrom, i).replace(/\\\\/g, \"\"), i];\n    }\n  }\n  return [arrayString.slice(startFrom).replace(/\\\\/g, \"\"), arrayString.length];\n}\nfunction parsePgNestedArray(arrayString, startFrom = 0) {\n  const result = [];\n  let i = startFrom;\n  let lastCharIsComma = false;\n  while (i < arrayString.length) {\n    const char = arrayString[i];\n    if (char === \",\") {\n      if (lastCharIsComma || i === startFrom) {\n        result.push(\"\");\n      }\n      lastCharIsComma = true;\n      i++;\n      continue;\n    }\n    lastCharIsComma = false;\n    if (char === \"\\\\\") {\n      i += 2;\n      continue;\n    }\n    if (char === '\"') {\n      const [value2, startFrom2] = parsePgArrayValue(arrayString, i + 1, true);\n      result.push(value2);\n      i = startFrom2;\n      continue;\n    }\n    if (char === \"}\") {\n      return [result, i + 1];\n    }\n    if (char === \"{\") {\n      const [value2, startFrom2] = parsePgNestedArray(arrayString, i + 1);\n      result.push(value2);\n      i = startFrom2;\n      continue;\n    }\n    const [value, newStartFrom] = parsePgArrayValue(arrayString, i, false);\n    result.push(value);\n    i = newStartFrom;\n  }\n  return [result, i];\n}\nfunction parsePgArray(arrayString) {\n  const [result] = parsePgNestedArray(arrayString, 1);\n  return result;\n}\nfunction makePgArray(array) {\n  return `{${array.map((item) => {\n    if (Array.isArray(item)) {\n      return makePgArray(item);\n    }\n    if (typeof item === \"string\") {\n      return `\"${item.replace(/\\\\/g, \"\\\\\\\\\").replace(/\"/g, '\\\\\"')}\"`;\n    }\n    return `${item}`;\n  }).join(\",\")}}`;\n}\nexport {\n  makePgArray,\n  parsePgArray,\n  parsePgNestedArray\n};\n//# sourceMappingURL=array.js.map","// package.json\nvar version = \"0.45.0\";\n\n// src/version.ts\nvar compatibilityVersion = 10;\nexport {\n  compatibilityVersion,\n  version as npmVersion\n};\n","const ViewBaseConfig = Symbol.for(\"drizzle:ViewBaseConfig\");\nexport {\n  ViewBaseConfig\n};\n//# sourceMappingURL=view-common.js.map","//#region src/client/parser.ts\nconst PROTO_POLLUTION_PATTERNS = {\n\tproto: /\"(?:_|\\\\u0{2}5[Ff]){2}(?:p|\\\\u0{2}70)(?:r|\\\\u0{2}72)(?:o|\\\\u0{2}6[Ff])(?:t|\\\\u0{2}74)(?:o|\\\\u0{2}6[Ff])(?:_|\\\\u0{2}5[Ff]){2}\"\\s*:/,\n\tconstructor: /\"(?:c|\\\\u0063)(?:o|\\\\u006[Ff])(?:n|\\\\u006[Ee])(?:s|\\\\u0073)(?:t|\\\\u0074)(?:r|\\\\u0072)(?:u|\\\\u0075)(?:c|\\\\u0063)(?:t|\\\\u0074)(?:o|\\\\u006[Ff])(?:r|\\\\u0072)\"\\s*:/,\n\tprotoShort: /\"__proto__\"\\s*:/,\n\tconstructorShort: /\"constructor\"\\s*:/\n};\nconst JSON_SIGNATURE = /^\\s*[\"[{]|^\\s*-?\\d{1,16}(\\.\\d{1,17})?([Ee][+-]?\\d+)?\\s*$/;\nconst SPECIAL_VALUES = {\n\ttrue: true,\n\tfalse: false,\n\tnull: null,\n\tundefined: void 0,\n\tnan: NaN,\n\tinfinity: Number.POSITIVE_INFINITY,\n\t\"-infinity\": Number.NEGATIVE_INFINITY\n};\nconst ISO_DATE_REGEX = /^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})(?:\\.(\\d{1,7}))?(?:Z|([+-])(\\d{2}):(\\d{2}))$/;\nfunction isValidDate(date) {\n\treturn date instanceof Date && !isNaN(date.getTime());\n}\nfunction parseISODate(value) {\n\tconst match = ISO_DATE_REGEX.exec(value);\n\tif (!match) return null;\n\tconst [, year, month, day, hour, minute, second, ms, offsetSign, offsetHour, offsetMinute] = match;\n\tlet date = new Date(Date.UTC(parseInt(year, 10), parseInt(month, 10) - 1, parseInt(day, 10), parseInt(hour, 10), parseInt(minute, 10), parseInt(second, 10), ms ? parseInt(ms.padEnd(3, \"0\"), 10) : 0));\n\tif (offsetSign) {\n\t\tconst offset = (parseInt(offsetHour, 10) * 60 + parseInt(offsetMinute, 10)) * (offsetSign === \"+\" ? -1 : 1);\n\t\tdate.setUTCMinutes(date.getUTCMinutes() + offset);\n\t}\n\treturn isValidDate(date) ? date : null;\n}\nfunction betterJSONParse(value, options = {}) {\n\tconst { strict = false, warnings = false, reviver, parseDates = true } = options;\n\tif (typeof value !== \"string\") return value;\n\tconst trimmed = value.trim();\n\tif (trimmed.length > 0 && trimmed[0] === \"\\\"\" && trimmed.endsWith(\"\\\"\") && !trimmed.slice(1, -1).includes(\"\\\"\")) return trimmed.slice(1, -1);\n\tconst lowerValue = trimmed.toLowerCase();\n\tif (lowerValue.length <= 9 && lowerValue in SPECIAL_VALUES) return SPECIAL_VALUES[lowerValue];\n\tif (!JSON_SIGNATURE.test(trimmed)) {\n\t\tif (strict) throw new SyntaxError(\"[better-json] Invalid JSON\");\n\t\treturn value;\n\t}\n\tif (Object.entries(PROTO_POLLUTION_PATTERNS).some(([key, pattern]) => {\n\t\tconst matches = pattern.test(trimmed);\n\t\tif (matches && warnings) console.warn(`[better-json] Detected potential prototype pollution attempt using ${key} pattern`);\n\t\treturn matches;\n\t}) && strict) throw new Error(\"[better-json] Potential prototype pollution attempt detected\");\n\ttry {\n\t\tconst secureReviver = (key, value$1) => {\n\t\t\tif (key === \"__proto__\" || key === \"constructor\" && value$1 && typeof value$1 === \"object\" && \"prototype\" in value$1) {\n\t\t\t\tif (warnings) console.warn(`[better-json] Dropping \"${key}\" key to prevent prototype pollution`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (parseDates && typeof value$1 === \"string\") {\n\t\t\t\tconst date = parseISODate(value$1);\n\t\t\t\tif (date) return date;\n\t\t\t}\n\t\t\treturn reviver ? reviver(key, value$1) : value$1;\n\t\t};\n\t\treturn JSON.parse(trimmed, secureReviver);\n\t} catch (error) {\n\t\tif (strict) throw error;\n\t\treturn value;\n\t}\n}\nfunction parseJSON(value, options = { strict: true }) {\n\treturn betterJSONParse(value, options);\n}\nvar parser_default = parseJSON;\n\n//#endregion\nexport { parser_default as n, parseJSON as t };","//#region src/plugins/organization/permission.ts\nconst hasPermissionFn = (input, acRoles) => {\n\tif (!input.permissions && !input.permission) return false;\n\tconst roles = input.role.split(\",\");\n\tconst creatorRole = input.options.creatorRole || \"owner\";\n\tconst isCreator = roles.includes(creatorRole);\n\tconst allowCreatorsAllPermissions = input.allowCreatorAllPermissions || false;\n\tif (isCreator && allowCreatorsAllPermissions) return true;\n\tfor (const role of roles) if ((acRoles[role]?.authorize(input.permissions ?? input.permission))?.success) return true;\n\treturn false;\n};\nlet cacheAllRoles = /* @__PURE__ */ new Map();\n\n//#endregion\nexport { hasPermissionFn as n, cacheAllRoles as t };","//#region src/plugins/two-factor/client.ts\nconst twoFactorClient = (options) => {\n\treturn {\n\t\tid: \"two-factor\",\n\t\t$InferServerPlugin: {},\n\t\tatomListeners: [{\n\t\t\tmatcher: (path) => path.startsWith(\"/two-factor/\"),\n\t\t\tsignal: \"$sessionSignal\"\n\t\t}],\n\t\tpathMethods: {\n\t\t\t\"/two-factor/disable\": \"POST\",\n\t\t\t\"/two-factor/enable\": \"POST\",\n\t\t\t\"/two-factor/send-otp\": \"POST\",\n\t\t\t\"/two-factor/generate-backup-codes\": \"POST\"\n\t\t},\n\t\tfetchPlugins: [{\n\t\t\tid: \"two-factor\",\n\t\t\tname: \"two-factor\",\n\t\t\thooks: { async onSuccess(context) {\n\t\t\t\tif (context.data?.twoFactorRedirect) {\n\t\t\t\t\tif (options?.onTwoFactorRedirect) await options.onTwoFactorRedirect();\n\t\t\t\t}\n\t\t\t} }\n\t\t}]\n\t};\n};\n\n//#endregion\nexport { twoFactorClient as t };","function getAlphabet(hex) {\n  return hex ? \"0123456789ABCDEFGHIJKLMNOPQRSTUV\" : \"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567\";\n}\nfunction createDecodeMap(alphabet) {\n  const decodeMap = /* @__PURE__ */ new Map();\n  for (let i = 0; i < alphabet.length; i++) {\n    decodeMap.set(alphabet[i], i);\n  }\n  return decodeMap;\n}\nfunction base32Encode(data, alphabet, padding) {\n  let result = \"\";\n  let buffer = 0;\n  let shift = 0;\n  for (const byte of data) {\n    buffer = buffer << 8 | byte;\n    shift += 8;\n    while (shift >= 5) {\n      shift -= 5;\n      result += alphabet[buffer >> shift & 31];\n    }\n  }\n  if (shift > 0) {\n    result += alphabet[buffer << 5 - shift & 31];\n  }\n  if (padding) {\n    const padCount = (8 - result.length % 8) % 8;\n    result += \"=\".repeat(padCount);\n  }\n  return result;\n}\nfunction base32Decode(data, alphabet) {\n  const decodeMap = createDecodeMap(alphabet);\n  const result = [];\n  let buffer = 0;\n  let bitsCollected = 0;\n  for (const char of data) {\n    if (char === \"=\")\n      break;\n    const value = decodeMap.get(char);\n    if (value === void 0) {\n      throw new Error(`Invalid Base32 character: ${char}`);\n    }\n    buffer = buffer << 5 | value;\n    bitsCollected += 5;\n    while (bitsCollected >= 8) {\n      bitsCollected -= 8;\n      result.push(buffer >> bitsCollected & 255);\n    }\n  }\n  return Uint8Array.from(result);\n}\nconst base32 = {\n  /**\n   * Encodes data into a Base32 string.\n   * @param data - The data to encode (ArrayBuffer, TypedArray, or string).\n   * @param options - Encoding options.\n   * @returns The Base32 encoded string.\n   */\n  encode(data, options = {}) {\n    const alphabet = getAlphabet(false);\n    const buffer = typeof data === \"string\" ? new TextEncoder().encode(data) : new Uint8Array(data);\n    return base32Encode(buffer, alphabet, options.padding ?? true);\n  },\n  /**\n   * Decodes a Base32 string into a Uint8Array.\n   * @param data - The Base32 encoded string or ArrayBuffer/TypedArray.\n   * @returns The decoded Uint8Array.\n   */\n  decode(data) {\n    if (typeof data !== \"string\") {\n      data = new TextDecoder().decode(data);\n    }\n    const alphabet = getAlphabet(false);\n    return base32Decode(data, alphabet);\n  }\n};\nconst base32hex = {\n  /**\n   * Encodes data into a Base32hex string.\n   * @param data - The data to encode (ArrayBuffer, TypedArray, or string).\n   * @param options - Encoding options.\n   * @returns The Base32hex encoded string.\n   */\n  encode(data, options = {}) {\n    const alphabet = getAlphabet(true);\n    const buffer = typeof data === \"string\" ? new TextEncoder().encode(data) : new Uint8Array(data);\n    return base32Encode(buffer, alphabet, options.padding ?? true);\n  },\n  /**\n   * Decodes a Base32hex string into a Uint8Array.\n   * @param data - The Base32hex encoded string.\n   * @returns The decoded Uint8Array.\n   */\n  decode(data) {\n    const alphabet = getAlphabet(true);\n    return base32Decode(data, alphabet);\n  }\n};\n\nexport { base32, base32hex };\n","import os from 'os'\nimport fs from 'fs'\n\nimport {\n  mergeUserTypes,\n  inferType,\n  Parameter,\n  Identifier,\n  Builder,\n  toPascal,\n  pascal,\n  toCamel,\n  camel,\n  toKebab,\n  kebab,\n  fromPascal,\n  fromCamel,\n  fromKebab\n} from './types.js'\n\nimport Connection from './connection.js'\nimport { Query, CLOSE } from './query.js'\nimport Queue from './queue.js'\nimport { Errors, PostgresError } from './errors.js'\nimport Subscribe from './subscribe.js'\nimport largeObject from './large.js'\n\nObject.assign(Postgres, {\n  PostgresError,\n  toPascal,\n  pascal,\n  toCamel,\n  camel,\n  toKebab,\n  kebab,\n  fromPascal,\n  fromCamel,\n  fromKebab,\n  BigInt: {\n    to: 20,\n    from: [20],\n    parse: x => BigInt(x), // eslint-disable-line\n    serialize: x => x.toString()\n  }\n})\n\nexport default Postgres\n\nfunction Postgres(a, b) {\n  const options = parseOptions(a, b)\n      , subscribe = options.no_subscribe || Subscribe(Postgres, { ...options })\n\n  let ending = false\n\n  const queries = Queue()\n      , connecting = Queue()\n      , reserved = Queue()\n      , closed = Queue()\n      , ended = Queue()\n      , open = Queue()\n      , busy = Queue()\n      , full = Queue()\n      , queues = { connecting, reserved, closed, ended, open, busy, full }\n\n  const connections = [...Array(options.max)].map(() => Connection(options, queues, { onopen, onend, onclose }))\n\n  const sql = Sql(handler)\n\n  Object.assign(sql, {\n    get parameters() { return options.parameters },\n    largeObject: largeObject.bind(null, sql),\n    subscribe,\n    CLOSE,\n    END: CLOSE,\n    PostgresError,\n    options,\n    reserve,\n    listen,\n    begin,\n    close,\n    end\n  })\n\n  return sql\n\n  function Sql(handler) {\n    handler.debug = options.debug\n\n    Object.entries(options.types).reduce((acc, [name, type]) => {\n      acc[name] = (x) => new Parameter(x, type.to)\n      return acc\n    }, typed)\n\n    Object.assign(sql, {\n      types: typed,\n      typed,\n      unsafe,\n      notify,\n      array,\n      json,\n      file\n    })\n\n    return sql\n\n    function typed(value, type) {\n      return new Parameter(value, type)\n    }\n\n    function sql(strings, ...args) {\n      const query = strings && Array.isArray(strings.raw)\n        ? new Query(strings, args, handler, cancel)\n        : typeof strings === 'string' && !args.length\n          ? new Identifier(options.transform.column.to ? options.transform.column.to(strings) : strings)\n          : new Builder(strings, args)\n      return query\n    }\n\n    function unsafe(string, args = [], options = {}) {\n      arguments.length === 2 && !Array.isArray(args) && (options = args, args = [])\n      const query = new Query([string], args, handler, cancel, {\n        prepare: false,\n        ...options,\n        simple: 'simple' in options ? options.simple : args.length === 0\n      })\n      return query\n    }\n\n    function file(path, args = [], options = {}) {\n      arguments.length === 2 && !Array.isArray(args) && (options = args, args = [])\n      const query = new Query([], args, (query) => {\n        fs.readFile(path, 'utf8', (err, string) => {\n          if (err)\n            return query.reject(err)\n\n          query.strings = [string]\n          handler(query)\n        })\n      }, cancel, {\n        ...options,\n        simple: 'simple' in options ? options.simple : args.length === 0\n      })\n      return query\n    }\n  }\n\n  async function listen(name, fn, onlisten) {\n    const listener = { fn, onlisten }\n\n    const sql = listen.sql || (listen.sql = Postgres({\n      ...options,\n      max: 1,\n      idle_timeout: null,\n      max_lifetime: null,\n      fetch_types: false,\n      onclose() {\n        Object.entries(listen.channels).forEach(([name, { listeners }]) => {\n          delete listen.channels[name]\n          Promise.all(listeners.map(l => listen(name, l.fn, l.onlisten).catch(() => { /* noop */ })))\n        })\n      },\n      onnotify(c, x) {\n        c in listen.channels && listen.channels[c].listeners.forEach(l => l.fn(x))\n      }\n    }))\n\n    const channels = listen.channels || (listen.channels = {})\n        , exists = name in channels\n\n    if (exists) {\n      channels[name].listeners.push(listener)\n      const result = await channels[name].result\n      listener.onlisten && listener.onlisten()\n      return { state: result.state, unlisten }\n    }\n\n    channels[name] = { result: sql`listen ${\n      sql.unsafe('\"' + name.replace(/\"/g, '\"\"') + '\"')\n    }`, listeners: [listener] }\n    const result = await channels[name].result\n    listener.onlisten && listener.onlisten()\n    return { state: result.state, unlisten }\n\n    async function unlisten() {\n      if (name in channels === false)\n        return\n\n      channels[name].listeners = channels[name].listeners.filter(x => x !== listener)\n      if (channels[name].listeners.length)\n        return\n\n      delete channels[name]\n      return sql`unlisten ${\n        sql.unsafe('\"' + name.replace(/\"/g, '\"\"') + '\"')\n      }`\n    }\n  }\n\n  async function notify(channel, payload) {\n    return await sql`select pg_notify(${ channel }, ${ '' + payload })`\n  }\n\n  async function reserve() {\n    const queue = Queue()\n    const c = open.length\n      ? open.shift()\n      : await new Promise((resolve, reject) => {\n        const query = { reserve: resolve, reject }\n        queries.push(query)\n        closed.length && connect(closed.shift(), query)\n      })\n\n    move(c, reserved)\n    c.reserved = () => queue.length\n      ? c.execute(queue.shift())\n      : move(c, reserved)\n    c.reserved.release = true\n\n    const sql = Sql(handler)\n    sql.release = () => {\n      c.reserved = null\n      onopen(c)\n    }\n\n    return sql\n\n    function handler(q) {\n      c.queue === full\n        ? queue.push(q)\n        : c.execute(q) || move(c, full)\n    }\n  }\n\n  async function begin(options, fn) {\n    !fn && (fn = options, options = '')\n    const queries = Queue()\n    let savepoints = 0\n      , connection\n      , prepare = null\n\n    try {\n      await sql.unsafe('begin ' + options.replace(/[^a-z ]/ig, ''), [], { onexecute }).execute()\n      return await Promise.race([\n        scope(connection, fn),\n        new Promise((_, reject) => connection.onclose = reject)\n      ])\n    } catch (error) {\n      throw error\n    }\n\n    async function scope(c, fn, name) {\n      const sql = Sql(handler)\n      sql.savepoint = savepoint\n      sql.prepare = x => prepare = x.replace(/[^a-z0-9$-_. ]/gi)\n      let uncaughtError\n        , result\n\n      name && await sql`savepoint ${ sql(name) }`\n      try {\n        result = await new Promise((resolve, reject) => {\n          const x = fn(sql)\n          Promise.resolve(Array.isArray(x) ? Promise.all(x) : x).then(resolve, reject)\n        })\n\n        if (uncaughtError)\n          throw uncaughtError\n      } catch (e) {\n        await (name\n          ? sql`rollback to ${ sql(name) }`\n          : sql`rollback`\n        )\n        throw e instanceof PostgresError && e.code === '25P02' && uncaughtError || e\n      }\n\n      if (!name) {\n        prepare\n          ? await sql`prepare transaction '${ sql.unsafe(prepare) }'`\n          : await sql`commit`\n      }\n\n      return result\n\n      function savepoint(name, fn) {\n        if (name && Array.isArray(name.raw))\n          return savepoint(sql => sql.apply(sql, arguments))\n\n        arguments.length === 1 && (fn = name, name = null)\n        return scope(c, fn, 's' + savepoints++ + (name ? '_' + name : ''))\n      }\n\n      function handler(q) {\n        q.catch(e => uncaughtError || (uncaughtError = e))\n        c.queue === full\n          ? queries.push(q)\n          : c.execute(q) || move(c, full)\n      }\n    }\n\n    function onexecute(c) {\n      connection = c\n      move(c, reserved)\n      c.reserved = () => queries.length\n        ? c.execute(queries.shift())\n        : move(c, reserved)\n    }\n  }\n\n  function move(c, queue) {\n    c.queue.remove(c)\n    queue.push(c)\n    c.queue = queue\n    queue === open\n      ? c.idleTimer.start()\n      : c.idleTimer.cancel()\n    return c\n  }\n\n  function json(x) {\n    return new Parameter(x, 3802)\n  }\n\n  function array(x, type) {\n    if (!Array.isArray(x))\n      return array(Array.from(arguments))\n\n    return new Parameter(x, type || (x.length ? inferType(x) || 25 : 0), options.shared.typeArrayMap)\n  }\n\n  function handler(query) {\n    if (ending)\n      return query.reject(Errors.connection('CONNECTION_ENDED', options, options))\n\n    if (open.length)\n      return go(open.shift(), query)\n\n    if (closed.length)\n      return connect(closed.shift(), query)\n\n    busy.length\n      ? go(busy.shift(), query)\n      : queries.push(query)\n  }\n\n  function go(c, query) {\n    return c.execute(query)\n      ? move(c, busy)\n      : move(c, full)\n  }\n\n  function cancel(query) {\n    return new Promise((resolve, reject) => {\n      query.state\n        ? query.active\n          ? Connection(options).cancel(query.state, resolve, reject)\n          : query.cancelled = { resolve, reject }\n        : (\n          queries.remove(query),\n          query.cancelled = true,\n          query.reject(Errors.generic('57014', 'canceling statement due to user request')),\n          resolve()\n        )\n    })\n  }\n\n  async function end({ timeout = null } = {}) {\n    if (ending)\n      return ending\n\n    await 1\n    let timer\n    return ending = Promise.race([\n      new Promise(r => timeout !== null && (timer = setTimeout(destroy, timeout * 1000, r))),\n      Promise.all(connections.map(c => c.end()).concat(\n        listen.sql ? listen.sql.end({ timeout: 0 }) : [],\n        subscribe.sql ? subscribe.sql.end({ timeout: 0 }) : []\n      ))\n    ]).then(() => clearTimeout(timer))\n  }\n\n  async function close() {\n    await Promise.all(connections.map(c => c.end()))\n  }\n\n  async function destroy(resolve) {\n    await Promise.all(connections.map(c => c.terminate()))\n    while (queries.length)\n      queries.shift().reject(Errors.connection('CONNECTION_DESTROYED', options))\n    resolve()\n  }\n\n  function connect(c, query) {\n    move(c, connecting)\n    c.connect(query)\n    return c\n  }\n\n  function onend(c) {\n    move(c, ended)\n  }\n\n  function onopen(c) {\n    if (queries.length === 0)\n      return move(c, open)\n\n    let max = Math.ceil(queries.length / (connecting.length + 1))\n      , ready = true\n\n    while (ready && queries.length && max-- > 0) {\n      const query = queries.shift()\n      if (query.reserve)\n        return query.reserve(c)\n\n      ready = c.execute(query)\n    }\n\n    ready\n      ? move(c, busy)\n      : move(c, full)\n  }\n\n  function onclose(c, e) {\n    move(c, closed)\n    c.reserved = null\n    c.onclose && (c.onclose(e), c.onclose = null)\n    options.onclose && options.onclose(c.id)\n    queries.length && connect(c, queries.shift())\n  }\n}\n\nfunction parseOptions(a, b) {\n  if (a && a.shared)\n    return a\n\n  const env = process.env // eslint-disable-line\n      , o = (!a || typeof a === 'string' ? b : a) || {}\n      , { url, multihost } = parseUrl(a)\n      , query = [...url.searchParams].reduce((a, [b, c]) => (a[b] = c, a), {})\n      , host = o.hostname || o.host || multihost || url.hostname || env.PGHOST || 'localhost'\n      , port = o.port || url.port || env.PGPORT || 5432\n      , user = o.user || o.username || url.username || env.PGUSERNAME || env.PGUSER || osUsername()\n\n  o.no_prepare && (o.prepare = false)\n  query.sslmode && (query.ssl = query.sslmode, delete query.sslmode)\n  'timeout' in o && (console.log('The timeout option is deprecated, use idle_timeout instead'), o.idle_timeout = o.timeout) // eslint-disable-line\n  query.sslrootcert === 'system' && (query.ssl = 'verify-full')\n\n  const ints = ['idle_timeout', 'connect_timeout', 'max_lifetime', 'max_pipeline', 'backoff', 'keep_alive']\n  const defaults = {\n    max             : 10,\n    ssl             : false,\n    idle_timeout    : null,\n    connect_timeout : 30,\n    max_lifetime    : max_lifetime,\n    max_pipeline    : 100,\n    backoff         : backoff,\n    keep_alive      : 60,\n    prepare         : true,\n    debug           : false,\n    fetch_types     : true,\n    publications    : 'alltables',\n    target_session_attrs: null\n  }\n\n  return {\n    host            : Array.isArray(host) ? host : host.split(',').map(x => x.split(':')[0]),\n    port            : Array.isArray(port) ? port : host.split(',').map(x => parseInt(x.split(':')[1] || port)),\n    path            : o.path || host.indexOf('/') > -1 && host + '/.s.PGSQL.' + port,\n    database        : o.database || o.db || (url.pathname || '').slice(1) || env.PGDATABASE || user,\n    user            : user,\n    pass            : o.pass || o.password || url.password || env.PGPASSWORD || '',\n    ...Object.entries(defaults).reduce(\n      (acc, [k, d]) => {\n        const value = k in o ? o[k] : k in query\n          ? (query[k] === 'disable' || query[k] === 'false' ? false : query[k])\n          : env['PG' + k.toUpperCase()] || d\n        acc[k] = typeof value === 'string' && ints.includes(k)\n          ? +value\n          : value\n        return acc\n      },\n      {}\n    ),\n    connection      : {\n      application_name: env.PGAPPNAME || 'postgres.js',\n      ...o.connection,\n      ...Object.entries(query).reduce((acc, [k, v]) => (k in defaults || (acc[k] = v), acc), {})\n    },\n    types           : o.types || {},\n    target_session_attrs: tsa(o, url, env),\n    onnotice        : o.onnotice,\n    onnotify        : o.onnotify,\n    onclose         : o.onclose,\n    onparameter     : o.onparameter,\n    socket          : o.socket,\n    transform       : parseTransform(o.transform || { undefined: undefined }),\n    parameters      : {},\n    shared          : { retries: 0, typeArrayMap: {} },\n    ...mergeUserTypes(o.types)\n  }\n}\n\nfunction tsa(o, url, env) {\n  const x = o.target_session_attrs || url.searchParams.get('target_session_attrs') || env.PGTARGETSESSIONATTRS\n  if (!x || ['read-write', 'read-only', 'primary', 'standby', 'prefer-standby'].includes(x))\n    return x\n\n  throw new Error('target_session_attrs ' + x + ' is not supported')\n}\n\nfunction backoff(retries) {\n  return (0.5 + Math.random() / 2) * Math.min(3 ** retries / 100, 20)\n}\n\nfunction max_lifetime() {\n  return 60 * (30 + Math.random() * 30)\n}\n\nfunction parseTransform(x) {\n  return {\n    undefined: x.undefined,\n    column: {\n      from: typeof x.column === 'function' ? x.column : x.column && x.column.from,\n      to: x.column && x.column.to\n    },\n    value: {\n      from: typeof x.value === 'function' ? x.value : x.value && x.value.from,\n      to: x.value && x.value.to\n    },\n    row: {\n      from: typeof x.row === 'function' ? x.row : x.row && x.row.from,\n      to: x.row && x.row.to\n    }\n  }\n}\n\nfunction parseUrl(url) {\n  if (!url || typeof url !== 'string')\n    return { url: { searchParams: new Map() } }\n\n  let host = url\n  host = host.slice(host.indexOf('://') + 3).split(/[?/]/)[0]\n  host = decodeURIComponent(host.slice(host.indexOf('@') + 1))\n\n  const urlObj = new URL(url.replace(host, host.split(',')[0]))\n\n  return {\n    url: {\n      username: decodeURIComponent(urlObj.username),\n      password: decodeURIComponent(urlObj.password),\n      host: urlObj.host,\n      hostname: urlObj.hostname,\n      port: urlObj.port,\n      pathname: urlObj.pathname,\n      searchParams: urlObj.searchParams\n    },\n    multihost: host.indexOf(',') > -1 && host\n  }\n}\n\nfunction osUsername() {\n  try {\n    return os.userInfo().username // eslint-disable-line\n  } catch (_) {\n    return process.env.USERNAME || process.env.USER || process.env.LOGNAME  // eslint-disable-line\n  }\n}\n","const originCache = new Map()\n    , originStackCache = new Map()\n    , originError = Symbol('OriginError')\n\nexport const CLOSE = {}\nexport class Query extends Promise {\n  constructor(strings, args, handler, canceller, options = {}) {\n    let resolve\n      , reject\n\n    super((a, b) => {\n      resolve = a\n      reject = b\n    })\n\n    this.tagged = Array.isArray(strings.raw)\n    this.strings = strings\n    this.args = args\n    this.handler = handler\n    this.canceller = canceller\n    this.options = options\n\n    this.state = null\n    this.statement = null\n\n    this.resolve = x => (this.active = false, resolve(x))\n    this.reject = x => (this.active = false, reject(x))\n\n    this.active = false\n    this.cancelled = null\n    this.executed = false\n    this.signature = ''\n\n    this[originError] = this.handler.debug\n      ? new Error()\n      : this.tagged && cachedError(this.strings)\n  }\n\n  get origin() {\n    return (this.handler.debug\n      ? this[originError].stack\n      : this.tagged && originStackCache.has(this.strings)\n        ? originStackCache.get(this.strings)\n        : originStackCache.set(this.strings, this[originError].stack).get(this.strings)\n    ) || ''\n  }\n\n  static get [Symbol.species]() {\n    return Promise\n  }\n\n  cancel() {\n    return this.canceller && (this.canceller(this), this.canceller = null)\n  }\n\n  simple() {\n    this.options.simple = true\n    this.options.prepare = false\n    return this\n  }\n\n  async readable() {\n    this.simple()\n    this.streaming = true\n    return this\n  }\n\n  async writable() {\n    this.simple()\n    this.streaming = true\n    return this\n  }\n\n  cursor(rows = 1, fn) {\n    this.options.simple = false\n    if (typeof rows === 'function') {\n      fn = rows\n      rows = 1\n    }\n\n    this.cursorRows = rows\n\n    if (typeof fn === 'function')\n      return (this.cursorFn = fn, this)\n\n    let prev\n    return {\n      [Symbol.asyncIterator]: () => ({\n        next: () => {\n          if (this.executed && !this.active)\n            return { done: true }\n\n          prev && prev()\n          const promise = new Promise((resolve, reject) => {\n            this.cursorFn = value => {\n              resolve({ value, done: false })\n              return new Promise(r => prev = r)\n            }\n            this.resolve = () => (this.active = false, resolve({ done: true }))\n            this.reject = x => (this.active = false, reject(x))\n          })\n          this.execute()\n          return promise\n        },\n        return() {\n          prev && prev(CLOSE)\n          return { done: true }\n        }\n      })\n    }\n  }\n\n  describe() {\n    this.options.simple = false\n    this.onlyDescribe = this.options.prepare = true\n    return this\n  }\n\n  stream() {\n    throw new Error('.stream has been renamed to .forEach')\n  }\n\n  forEach(fn) {\n    this.forEachFn = fn\n    this.handle()\n    return this\n  }\n\n  raw() {\n    this.isRaw = true\n    return this\n  }\n\n  values() {\n    this.isRaw = 'values'\n    return this\n  }\n\n  async handle() {\n    !this.executed && (this.executed = true) && await 1 && this.handler(this)\n  }\n\n  execute() {\n    this.handle()\n    return this\n  }\n\n  then() {\n    this.handle()\n    return super.then.apply(this, arguments)\n  }\n\n  catch() {\n    this.handle()\n    return super.catch.apply(this, arguments)\n  }\n\n  finally() {\n    this.handle()\n    return super.finally.apply(this, arguments)\n  }\n}\n\nfunction cachedError(xs) {\n  if (originCache.has(xs))\n    return originCache.get(xs)\n\n  const x = Error.stackTraceLimit\n  Error.stackTraceLimit = 4\n  originCache.set(xs, new Error())\n  Error.stackTraceLimit = x\n  return originCache.get(xs)\n}\n","import net from 'net'\nimport tls from 'tls'\nimport crypto from 'crypto'\nimport Stream from 'stream'\nimport { performance } from 'perf_hooks'\n\nimport { stringify, handleValue, arrayParser, arraySerializer } from './types.js'\nimport { Errors } from './errors.js'\nimport Result from './result.js'\nimport Queue from './queue.js'\nimport { Query, CLOSE } from './query.js'\nimport b from './bytes.js'\n\nexport default Connection\n\nlet uid = 1\n\nconst Sync = b().S().end()\n    , Flush = b().H().end()\n    , SSLRequest = b().i32(8).i32(80877103).end(8)\n    , ExecuteUnnamed = Buffer.concat([b().E().str(b.N).i32(0).end(), Sync])\n    , DescribeUnnamed = b().D().str('S').str(b.N).end()\n    , noop = () => { /* noop */ }\n\nconst retryRoutines = new Set([\n  'FetchPreparedStatement',\n  'RevalidateCachedQuery',\n  'transformAssignedExpr'\n])\n\nconst errorFields = {\n  83  : 'severity_local',    // S\n  86  : 'severity',          // V\n  67  : 'code',              // C\n  77  : 'message',           // M\n  68  : 'detail',            // D\n  72  : 'hint',              // H\n  80  : 'position',          // P\n  112 : 'internal_position', // p\n  113 : 'internal_query',    // q\n  87  : 'where',             // W\n  115 : 'schema_name',       // s\n  116 : 'table_name',        // t\n  99  : 'column_name',       // c\n  100 : 'data type_name',    // d\n  110 : 'constraint_name',   // n\n  70  : 'file',              // F\n  76  : 'line',              // L\n  82  : 'routine'            // R\n}\n\nfunction Connection(options, queues = {}, { onopen = noop, onend = noop, onclose = noop } = {}) {\n  const {\n    ssl,\n    max,\n    user,\n    host,\n    port,\n    database,\n    parsers,\n    transform,\n    onnotice,\n    onnotify,\n    onparameter,\n    max_pipeline,\n    keep_alive,\n    backoff,\n    target_session_attrs\n  } = options\n\n  const sent = Queue()\n      , id = uid++\n      , backend = { pid: null, secret: null }\n      , idleTimer = timer(end, options.idle_timeout)\n      , lifeTimer = timer(end, options.max_lifetime)\n      , connectTimer = timer(connectTimedOut, options.connect_timeout)\n\n  let socket = null\n    , cancelMessage\n    , result = new Result()\n    , incoming = Buffer.alloc(0)\n    , needsTypes = options.fetch_types\n    , backendParameters = {}\n    , statements = {}\n    , statementId = Math.random().toString(36).slice(2)\n    , statementCount = 1\n    , closedDate = 0\n    , remaining = 0\n    , hostIndex = 0\n    , retries = 0\n    , length = 0\n    , delay = 0\n    , rows = 0\n    , serverSignature = null\n    , nextWriteTimer = null\n    , terminated = false\n    , incomings = null\n    , results = null\n    , initial = null\n    , ending = null\n    , stream = null\n    , chunk = null\n    , ended = null\n    , nonce = null\n    , query = null\n    , final = null\n\n  const connection = {\n    queue: queues.closed,\n    idleTimer,\n    connect(query) {\n      initial = query\n      reconnect()\n    },\n    terminate,\n    execute,\n    cancel,\n    end,\n    count: 0,\n    id\n  }\n\n  queues.closed && queues.closed.push(connection)\n\n  return connection\n\n  async function createSocket() {\n    let x\n    try {\n      x = options.socket\n        ? (await Promise.resolve(options.socket(options)))\n        : new net.Socket()\n    } catch (e) {\n      error(e)\n      return\n    }\n    x.on('error', error)\n    x.on('close', closed)\n    x.on('drain', drain)\n    return x\n  }\n\n  async function cancel({ pid, secret }, resolve, reject) {\n    try {\n      cancelMessage = b().i32(16).i32(80877102).i32(pid).i32(secret).end(16)\n      await connect()\n      socket.once('error', reject)\n      socket.once('close', resolve)\n    } catch (error) {\n      reject(error)\n    }\n  }\n\n  function execute(q) {\n    if (terminated)\n      return queryError(q, Errors.connection('CONNECTION_DESTROYED', options))\n\n    if (q.cancelled)\n      return\n\n    try {\n      q.state = backend\n      query\n        ? sent.push(q)\n        : (query = q, query.active = true)\n\n      build(q)\n      return write(toBuffer(q))\n        && !q.describeFirst\n        && !q.cursorFn\n        && sent.length < max_pipeline\n        && (!q.options.onexecute || q.options.onexecute(connection))\n    } catch (error) {\n      sent.length === 0 && write(Sync)\n      errored(error)\n      return true\n    }\n  }\n\n  function toBuffer(q) {\n    if (q.parameters.length >= 65534)\n      throw Errors.generic('MAX_PARAMETERS_EXCEEDED', 'Max number of parameters (65534) exceeded')\n\n    return q.options.simple\n      ? b().Q().str(q.statement.string + b.N).end()\n      : q.describeFirst\n        ? Buffer.concat([describe(q), Flush])\n        : q.prepare\n          ? q.prepared\n            ? prepared(q)\n            : Buffer.concat([describe(q), prepared(q)])\n          : unnamed(q)\n  }\n\n  function describe(q) {\n    return Buffer.concat([\n      Parse(q.statement.string, q.parameters, q.statement.types, q.statement.name),\n      Describe('S', q.statement.name)\n    ])\n  }\n\n  function prepared(q) {\n    return Buffer.concat([\n      Bind(q.parameters, q.statement.types, q.statement.name, q.cursorName),\n      q.cursorFn\n        ? Execute('', q.cursorRows)\n        : ExecuteUnnamed\n    ])\n  }\n\n  function unnamed(q) {\n    return Buffer.concat([\n      Parse(q.statement.string, q.parameters, q.statement.types),\n      DescribeUnnamed,\n      prepared(q)\n    ])\n  }\n\n  function build(q) {\n    const parameters = []\n        , types = []\n\n    const string = stringify(q, q.strings[0], q.args[0], parameters, types, options)\n\n    !q.tagged && q.args.forEach(x => handleValue(x, parameters, types, options))\n\n    q.prepare = options.prepare && ('prepare' in q.options ? q.options.prepare : true)\n    q.string = string\n    q.signature = q.prepare && types + string\n    q.onlyDescribe && (delete statements[q.signature])\n    q.parameters = q.parameters || parameters\n    q.prepared = q.prepare && q.signature in statements\n    q.describeFirst = q.onlyDescribe || (parameters.length && !q.prepared)\n    q.statement = q.prepared\n      ? statements[q.signature]\n      : { string, types, name: q.prepare ? statementId + statementCount++ : '' }\n\n    typeof options.debug === 'function' && options.debug(id, string, parameters, types)\n  }\n\n  function write(x, fn) {\n    chunk = chunk ? Buffer.concat([chunk, x]) : Buffer.from(x)\n    if (fn || chunk.length >= 1024)\n      return nextWrite(fn)\n    nextWriteTimer === null && (nextWriteTimer = setImmediate(nextWrite))\n    return true\n  }\n\n  function nextWrite(fn) {\n    const x = socket.write(chunk, fn)\n    nextWriteTimer !== null && clearImmediate(nextWriteTimer)\n    chunk = nextWriteTimer = null\n    return x\n  }\n\n  function connectTimedOut() {\n    errored(Errors.connection('CONNECT_TIMEOUT', options, socket))\n    socket.destroy()\n  }\n\n  async function secure() {\n    write(SSLRequest)\n    const canSSL = await new Promise(r => socket.once('data', x => r(x[0] === 83))) // S\n\n    if (!canSSL && ssl === 'prefer')\n      return connected()\n\n    socket.removeAllListeners()\n    socket = tls.connect({\n      socket,\n      servername: net.isIP(socket.host) ? undefined : socket.host,\n      ...(ssl === 'require' || ssl === 'allow' || ssl === 'prefer'\n        ? { rejectUnauthorized: false }\n        : ssl === 'verify-full'\n          ? {}\n          : typeof ssl === 'object'\n            ? ssl\n            : {}\n      )\n    })\n    socket.on('secureConnect', connected)\n    socket.on('error', error)\n    socket.on('close', closed)\n    socket.on('drain', drain)\n  }\n\n  /* c8 ignore next 3 */\n  function drain() {\n    !query && onopen(connection)\n  }\n\n  function data(x) {\n    if (incomings) {\n      incomings.push(x)\n      remaining -= x.length\n      if (remaining > 0)\n        return\n    }\n\n    incoming = incomings\n      ? Buffer.concat(incomings, length - remaining)\n      : incoming.length === 0\n        ? x\n        : Buffer.concat([incoming, x], incoming.length + x.length)\n\n    while (incoming.length > 4) {\n      length = incoming.readUInt32BE(1)\n      if (length >= incoming.length) {\n        remaining = length - incoming.length\n        incomings = [incoming]\n        break\n      }\n\n      try {\n        handle(incoming.subarray(0, length + 1))\n      } catch (e) {\n        query && (query.cursorFn || query.describeFirst) && write(Sync)\n        errored(e)\n      }\n      incoming = incoming.subarray(length + 1)\n      remaining = 0\n      incomings = null\n    }\n  }\n\n  async function connect() {\n    terminated = false\n    backendParameters = {}\n    socket || (socket = await createSocket())\n\n    if (!socket)\n      return\n\n    connectTimer.start()\n\n    if (options.socket)\n      return ssl ? secure() : connected()\n\n    socket.on('connect', ssl ? secure : connected)\n\n    if (options.path)\n      return socket.connect(options.path)\n\n    socket.ssl = ssl\n    socket.connect(port[hostIndex], host[hostIndex])\n    socket.host = host[hostIndex]\n    socket.port = port[hostIndex]\n\n    hostIndex = (hostIndex + 1) % port.length\n  }\n\n  function reconnect() {\n    setTimeout(connect, closedDate ? closedDate + delay - performance.now() : 0)\n  }\n\n  function connected() {\n    try {\n      statements = {}\n      needsTypes = options.fetch_types\n      statementId = Math.random().toString(36).slice(2)\n      statementCount = 1\n      lifeTimer.start()\n      socket.on('data', data)\n      keep_alive && socket.setKeepAlive && socket.setKeepAlive(true, 1000 * keep_alive)\n      const s = StartupMessage()\n      write(s)\n    } catch (err) {\n      error(err)\n    }\n  }\n\n  function error(err) {\n    if (connection.queue === queues.connecting && options.host[retries + 1])\n      return\n\n    errored(err)\n    while (sent.length)\n      queryError(sent.shift(), err)\n  }\n\n  function errored(err) {\n    stream && (stream.destroy(err), stream = null)\n    query && queryError(query, err)\n    initial && (queryError(initial, err), initial = null)\n  }\n\n  function queryError(query, err) {\n    if (query.reserve)\n      return query.reject(err)\n\n    if (!err || typeof err !== 'object')\n      err = new Error(err)\n\n    'query' in err || 'parameters' in err || Object.defineProperties(err, {\n      stack: { value: err.stack + query.origin.replace(/.*\\n/, '\\n'), enumerable: options.debug },\n      query: { value: query.string, enumerable: options.debug },\n      parameters: { value: query.parameters, enumerable: options.debug },\n      args: { value: query.args, enumerable: options.debug },\n      types: { value: query.statement && query.statement.types, enumerable: options.debug }\n    })\n    query.reject(err)\n  }\n\n  function end() {\n    return ending || (\n      !connection.reserved && onend(connection),\n      !connection.reserved && !initial && !query && sent.length === 0\n        ? (terminate(), new Promise(r => socket && socket.readyState !== 'closed' ? socket.once('close', r) : r()))\n        : ending = new Promise(r => ended = r)\n    )\n  }\n\n  function terminate() {\n    terminated = true\n    if (stream || query || initial || sent.length)\n      error(Errors.connection('CONNECTION_DESTROYED', options))\n\n    clearImmediate(nextWriteTimer)\n    if (socket) {\n      socket.removeListener('data', data)\n      socket.removeListener('connect', connected)\n      socket.readyState === 'open' && socket.end(b().X().end())\n    }\n    ended && (ended(), ending = ended = null)\n  }\n\n  async function closed(hadError) {\n    incoming = Buffer.alloc(0)\n    remaining = 0\n    incomings = null\n    clearImmediate(nextWriteTimer)\n    socket.removeListener('data', data)\n    socket.removeListener('connect', connected)\n    idleTimer.cancel()\n    lifeTimer.cancel()\n    connectTimer.cancel()\n\n    socket.removeAllListeners()\n    socket = null\n\n    if (initial)\n      return reconnect()\n\n    !hadError && (query || sent.length) && error(Errors.connection('CONNECTION_CLOSED', options, socket))\n    closedDate = performance.now()\n    hadError && options.shared.retries++\n    delay = (typeof backoff === 'function' ? backoff(options.shared.retries) : backoff) * 1000\n    onclose(connection, Errors.connection('CONNECTION_CLOSED', options, socket))\n  }\n\n  /* Handlers */\n  function handle(xs, x = xs[0]) {\n    (\n      x === 68 ? DataRow :                   // D\n      x === 100 ? CopyData :                 // d\n      x === 65 ? NotificationResponse :      // A\n      x === 83 ? ParameterStatus :           // S\n      x === 90 ? ReadyForQuery :             // Z\n      x === 67 ? CommandComplete :           // C\n      x === 50 ? BindComplete :              // 2\n      x === 49 ? ParseComplete :             // 1\n      x === 116 ? ParameterDescription :     // t\n      x === 84 ? RowDescription :            // T\n      x === 82 ? Authentication :            // R\n      x === 110 ? NoData :                   // n\n      x === 75 ? BackendKeyData :            // K\n      x === 69 ? ErrorResponse :             // E\n      x === 115 ? PortalSuspended :          // s\n      x === 51 ? CloseComplete :             // 3\n      x === 71 ? CopyInResponse :            // G\n      x === 78 ? NoticeResponse :            // N\n      x === 72 ? CopyOutResponse :           // H\n      x === 99 ? CopyDone :                  // c\n      x === 73 ? EmptyQueryResponse :        // I\n      x === 86 ? FunctionCallResponse :      // V\n      x === 118 ? NegotiateProtocolVersion : // v\n      x === 87 ? CopyBothResponse :          // W\n      /* c8 ignore next */\n      UnknownMessage\n    )(xs)\n  }\n\n  function DataRow(x) {\n    let index = 7\n    let length\n    let column\n    let value\n\n    const row = query.isRaw ? new Array(query.statement.columns.length) : {}\n    for (let i = 0; i < query.statement.columns.length; i++) {\n      column = query.statement.columns[i]\n      length = x.readInt32BE(index)\n      index += 4\n\n      value = length === -1\n        ? null\n        : query.isRaw === true\n          ? x.subarray(index, index += length)\n          : column.parser === undefined\n            ? x.toString('utf8', index, index += length)\n            : column.parser.array === true\n              ? column.parser(x.toString('utf8', index + 1, index += length))\n              : column.parser(x.toString('utf8', index, index += length))\n\n      query.isRaw\n        ? (row[i] = query.isRaw === true\n          ? value\n          : transform.value.from ? transform.value.from(value, column) : value)\n        : (row[column.name] = transform.value.from ? transform.value.from(value, column) : value)\n    }\n\n    query.forEachFn\n      ? query.forEachFn(transform.row.from ? transform.row.from(row) : row, result)\n      : (result[rows++] = transform.row.from ? transform.row.from(row) : row)\n  }\n\n  function ParameterStatus(x) {\n    const [k, v] = x.toString('utf8', 5, x.length - 1).split(b.N)\n    backendParameters[k] = v\n    if (options.parameters[k] !== v) {\n      options.parameters[k] = v\n      onparameter && onparameter(k, v)\n    }\n  }\n\n  function ReadyForQuery(x) {\n    query && query.options.simple && query.resolve(results || result)\n    query = results = null\n    result = new Result()\n    connectTimer.cancel()\n\n    if (initial) {\n      if (target_session_attrs) {\n        if (!backendParameters.in_hot_standby || !backendParameters.default_transaction_read_only)\n          return fetchState()\n        else if (tryNext(target_session_attrs, backendParameters))\n          return terminate()\n      }\n\n      if (needsTypes) {\n        initial.reserve && (initial = null)\n        return fetchArrayTypes()\n      }\n\n      initial && !initial.reserve && execute(initial)\n      options.shared.retries = retries = 0\n      initial = null\n      return\n    }\n\n    while (sent.length && (query = sent.shift()) && (query.active = true, query.cancelled))\n      Connection(options).cancel(query.state, query.cancelled.resolve, query.cancelled.reject)\n\n    if (query)\n      return // Consider opening if able and sent.length < 50\n\n    connection.reserved\n      ? !connection.reserved.release && x[5] === 73 // I\n        ? ending\n          ? terminate()\n          : (connection.reserved = null, onopen(connection))\n        : connection.reserved()\n      : ending\n        ? terminate()\n        : onopen(connection)\n  }\n\n  function CommandComplete(x) {\n    rows = 0\n\n    for (let i = x.length - 1; i > 0; i--) {\n      if (x[i] === 32 && x[i + 1] < 58 && result.count === null)\n        result.count = +x.toString('utf8', i + 1, x.length - 1)\n      if (x[i - 1] >= 65) {\n        result.command = x.toString('utf8', 5, i)\n        result.state = backend\n        break\n      }\n    }\n\n    final && (final(), final = null)\n\n    if (result.command === 'BEGIN' && max !== 1 && !connection.reserved)\n      return errored(Errors.generic('UNSAFE_TRANSACTION', 'Only use sql.begin, sql.reserved or max: 1'))\n\n    if (query.options.simple)\n      return BindComplete()\n\n    if (query.cursorFn) {\n      result.count && query.cursorFn(result)\n      write(Sync)\n    }\n\n    query.resolve(result)\n  }\n\n  function ParseComplete() {\n    query.parsing = false\n  }\n\n  function BindComplete() {\n    !result.statement && (result.statement = query.statement)\n    result.columns = query.statement.columns\n  }\n\n  function ParameterDescription(x) {\n    const length = x.readUInt16BE(5)\n\n    for (let i = 0; i < length; ++i)\n      !query.statement.types[i] && (query.statement.types[i] = x.readUInt32BE(7 + i * 4))\n\n    query.prepare && (statements[query.signature] = query.statement)\n    query.describeFirst && !query.onlyDescribe && (write(prepared(query)), query.describeFirst = false)\n  }\n\n  function RowDescription(x) {\n    if (result.command) {\n      results = results || [result]\n      results.push(result = new Result())\n      result.count = null\n      query.statement.columns = null\n    }\n\n    const length = x.readUInt16BE(5)\n    let index = 7\n    let start\n\n    query.statement.columns = Array(length)\n\n    for (let i = 0; i < length; ++i) {\n      start = index\n      while (x[index++] !== 0);\n      const table = x.readUInt32BE(index)\n      const number = x.readUInt16BE(index + 4)\n      const type = x.readUInt32BE(index + 6)\n      query.statement.columns[i] = {\n        name: transform.column.from\n          ? transform.column.from(x.toString('utf8', start, index - 1))\n          : x.toString('utf8', start, index - 1),\n        parser: parsers[type],\n        table,\n        number,\n        type\n      }\n      index += 18\n    }\n\n    result.statement = query.statement\n    if (query.onlyDescribe)\n      return (query.resolve(query.statement), write(Sync))\n  }\n\n  async function Authentication(x, type = x.readUInt32BE(5)) {\n    (\n      type === 3 ? AuthenticationCleartextPassword :\n      type === 5 ? AuthenticationMD5Password :\n      type === 10 ? SASL :\n      type === 11 ? SASLContinue :\n      type === 12 ? SASLFinal :\n      type !== 0 ? UnknownAuth :\n      noop\n    )(x, type)\n  }\n\n  /* c8 ignore next 5 */\n  async function AuthenticationCleartextPassword() {\n    const payload = await Pass()\n    write(\n      b().p().str(payload).z(1).end()\n    )\n  }\n\n  async function AuthenticationMD5Password(x) {\n    const payload = 'md5' + (\n      await md5(\n        Buffer.concat([\n          Buffer.from(await md5((await Pass()) + user)),\n          x.subarray(9)\n        ])\n      )\n    )\n    write(\n      b().p().str(payload).z(1).end()\n    )\n  }\n\n  async function SASL() {\n    nonce = (await crypto.randomBytes(18)).toString('base64')\n    b().p().str('SCRAM-SHA-256' + b.N)\n    const i = b.i\n    write(b.inc(4).str('n,,n=*,r=' + nonce).i32(b.i - i - 4, i).end())\n  }\n\n  async function SASLContinue(x) {\n    const res = x.toString('utf8', 9).split(',').reduce((acc, x) => (acc[x[0]] = x.slice(2), acc), {})\n\n    const saltedPassword = await crypto.pbkdf2Sync(\n      await Pass(),\n      Buffer.from(res.s, 'base64'),\n      parseInt(res.i), 32,\n      'sha256'\n    )\n\n    const clientKey = await hmac(saltedPassword, 'Client Key')\n\n    const auth = 'n=*,r=' + nonce + ','\n               + 'r=' + res.r + ',s=' + res.s + ',i=' + res.i\n               + ',c=biws,r=' + res.r\n\n    serverSignature = (await hmac(await hmac(saltedPassword, 'Server Key'), auth)).toString('base64')\n\n    const payload = 'c=biws,r=' + res.r + ',p=' + xor(\n      clientKey, Buffer.from(await hmac(await sha256(clientKey), auth))\n    ).toString('base64')\n\n    write(\n      b().p().str(payload).end()\n    )\n  }\n\n  function SASLFinal(x) {\n    if (x.toString('utf8', 9).split(b.N, 1)[0].slice(2) === serverSignature)\n      return\n    /* c8 ignore next 5 */\n    errored(Errors.generic('SASL_SIGNATURE_MISMATCH', 'The server did not return the correct signature'))\n    socket.destroy()\n  }\n\n  function Pass() {\n    return Promise.resolve(typeof options.pass === 'function'\n      ? options.pass()\n      : options.pass\n    )\n  }\n\n  function NoData() {\n    result.statement = query.statement\n    result.statement.columns = []\n    if (query.onlyDescribe)\n      return (query.resolve(query.statement), write(Sync))\n  }\n\n  function BackendKeyData(x) {\n    backend.pid = x.readUInt32BE(5)\n    backend.secret = x.readUInt32BE(9)\n  }\n\n  async function fetchArrayTypes() {\n    needsTypes = false\n    const types = await new Query([`\n      select b.oid, b.typarray\n      from pg_catalog.pg_type a\n      left join pg_catalog.pg_type b on b.oid = a.typelem\n      where a.typcategory = 'A'\n      group by b.oid, b.typarray\n      order by b.oid\n    `], [], execute)\n    types.forEach(({ oid, typarray }) => addArrayType(oid, typarray))\n  }\n\n  function addArrayType(oid, typarray) {\n    if (!!options.parsers[typarray] && !!options.serializers[typarray]) return\n    const parser = options.parsers[oid]\n    options.shared.typeArrayMap[oid] = typarray\n    options.parsers[typarray] = (xs) => arrayParser(xs, parser, typarray)\n    options.parsers[typarray].array = true\n    options.serializers[typarray] = (xs) => arraySerializer(xs, options.serializers[oid], options, typarray)\n  }\n\n  function tryNext(x, xs) {\n    return (\n      (x === 'read-write' && xs.default_transaction_read_only === 'on') ||\n      (x === 'read-only' && xs.default_transaction_read_only === 'off') ||\n      (x === 'primary' && xs.in_hot_standby === 'on') ||\n      (x === 'standby' && xs.in_hot_standby === 'off') ||\n      (x === 'prefer-standby' && xs.in_hot_standby === 'off' && options.host[retries])\n    )\n  }\n\n  function fetchState() {\n    const query = new Query([`\n      show transaction_read_only;\n      select pg_catalog.pg_is_in_recovery()\n    `], [], execute, null, { simple: true })\n    query.resolve = ([[a], [b]]) => {\n      backendParameters.default_transaction_read_only = a.transaction_read_only\n      backendParameters.in_hot_standby = b.pg_is_in_recovery ? 'on' : 'off'\n    }\n    query.execute()\n  }\n\n  function ErrorResponse(x) {\n    query && (query.cursorFn || query.describeFirst) && write(Sync)\n    const error = Errors.postgres(parseError(x))\n    query && query.retried\n      ? errored(query.retried)\n      : query && query.prepared && retryRoutines.has(error.routine)\n        ? retry(query, error)\n        : errored(error)\n  }\n\n  function retry(q, error) {\n    delete statements[q.signature]\n    q.retried = error\n    execute(q)\n  }\n\n  function NotificationResponse(x) {\n    if (!onnotify)\n      return\n\n    let index = 9\n    while (x[index++] !== 0);\n    onnotify(\n      x.toString('utf8', 9, index - 1),\n      x.toString('utf8', index, x.length - 1)\n    )\n  }\n\n  async function PortalSuspended() {\n    try {\n      const x = await Promise.resolve(query.cursorFn(result))\n      rows = 0\n      x === CLOSE\n        ? write(Close(query.portal))\n        : (result = new Result(), write(Execute('', query.cursorRows)))\n    } catch (err) {\n      write(Sync)\n      query.reject(err)\n    }\n  }\n\n  function CloseComplete() {\n    result.count && query.cursorFn(result)\n    query.resolve(result)\n  }\n\n  function CopyInResponse() {\n    stream = new Stream.Writable({\n      autoDestroy: true,\n      write(chunk, encoding, callback) {\n        socket.write(b().d().raw(chunk).end(), callback)\n      },\n      destroy(error, callback) {\n        callback(error)\n        socket.write(b().f().str(error + b.N).end())\n        stream = null\n      },\n      final(callback) {\n        socket.write(b().c().end())\n        final = callback\n      }\n    })\n    query.resolve(stream)\n  }\n\n  function CopyOutResponse() {\n    stream = new Stream.Readable({\n      read() { socket.resume() }\n    })\n    query.resolve(stream)\n  }\n\n  /* c8 ignore next 3 */\n  function CopyBothResponse() {\n    stream = new Stream.Duplex({\n      autoDestroy: true,\n      read() { socket.resume() },\n      /* c8 ignore next 11 */\n      write(chunk, encoding, callback) {\n        socket.write(b().d().raw(chunk).end(), callback)\n      },\n      destroy(error, callback) {\n        callback(error)\n        socket.write(b().f().str(error + b.N).end())\n        stream = null\n      },\n      final(callback) {\n        socket.write(b().c().end())\n        final = callback\n      }\n    })\n    query.resolve(stream)\n  }\n\n  function CopyData(x) {\n    stream && (stream.push(x.subarray(5)) || socket.pause())\n  }\n\n  function CopyDone() {\n    stream && stream.push(null)\n    stream = null\n  }\n\n  function NoticeResponse(x) {\n    onnotice\n      ? onnotice(parseError(x))\n      : console.log(parseError(x)) // eslint-disable-line\n\n  }\n\n  /* c8 ignore next 3 */\n  function EmptyQueryResponse() {\n    /* noop */\n  }\n\n  /* c8 ignore next 3 */\n  function FunctionCallResponse() {\n    errored(Errors.notSupported('FunctionCallResponse'))\n  }\n\n  /* c8 ignore next 3 */\n  function NegotiateProtocolVersion() {\n    errored(Errors.notSupported('NegotiateProtocolVersion'))\n  }\n\n  /* c8 ignore next 3 */\n  function UnknownMessage(x) {\n    console.error('Postgres.js : Unknown Message:', x[0]) // eslint-disable-line\n  }\n\n  /* c8 ignore next 3 */\n  function UnknownAuth(x, type) {\n    console.error('Postgres.js : Unknown Auth:', type) // eslint-disable-line\n  }\n\n  /* Messages */\n  function Bind(parameters, types, statement = '', portal = '') {\n    let prev\n      , type\n\n    b().B().str(portal + b.N).str(statement + b.N).i16(0).i16(parameters.length)\n\n    parameters.forEach((x, i) => {\n      if (x === null)\n        return b.i32(0xFFFFFFFF)\n\n      type = types[i]\n      parameters[i] = x = type in options.serializers\n        ? options.serializers[type](x)\n        : '' + x\n\n      prev = b.i\n      b.inc(4).str(x).i32(b.i - prev - 4, prev)\n    })\n\n    b.i16(0)\n\n    return b.end()\n  }\n\n  function Parse(str, parameters, types, name = '') {\n    b().P().str(name + b.N).str(str + b.N).i16(parameters.length)\n    parameters.forEach((x, i) => b.i32(types[i] || 0))\n    return b.end()\n  }\n\n  function Describe(x, name = '') {\n    return b().D().str(x).str(name + b.N).end()\n  }\n\n  function Execute(portal = '', rows = 0) {\n    return Buffer.concat([\n      b().E().str(portal + b.N).i32(rows).end(),\n      Flush\n    ])\n  }\n\n  function Close(portal = '') {\n    return Buffer.concat([\n      b().C().str('P').str(portal + b.N).end(),\n      b().S().end()\n    ])\n  }\n\n  function StartupMessage() {\n    return cancelMessage || b().inc(4).i16(3).z(2).str(\n      Object.entries(Object.assign({\n        user,\n        database,\n        client_encoding: 'UTF8'\n      },\n        options.connection\n      )).filter(([, v]) => v).map(([k, v]) => k + b.N + v).join(b.N)\n    ).z(2).end(0)\n  }\n\n}\n\nfunction parseError(x) {\n  const error = {}\n  let start = 5\n  for (let i = 5; i < x.length - 1; i++) {\n    if (x[i] === 0) {\n      error[errorFields[x[start]]] = x.toString('utf8', start + 1, i)\n      start = i + 1\n    }\n  }\n  return error\n}\n\nfunction md5(x) {\n  return crypto.createHash('md5').update(x).digest('hex')\n}\n\nfunction hmac(key, x) {\n  return crypto.createHmac('sha256', key).update(x).digest()\n}\n\nfunction sha256(x) {\n  return crypto.createHash('sha256').update(x).digest()\n}\n\nfunction xor(a, b) {\n  const length = Math.max(a.length, b.length)\n  const buffer = Buffer.allocUnsafe(length)\n  for (let i = 0; i < length; i++)\n    buffer[i] = a[i] ^ b[i]\n  return buffer\n}\n\nfunction timer(fn, seconds) {\n  seconds = typeof seconds === 'function' ? seconds() : seconds\n  if (!seconds)\n    return { cancel: noop, start: noop }\n\n  let timer\n  return {\n    cancel() {\n      timer && (clearTimeout(timer), timer = null)\n    },\n    start() {\n      timer && clearTimeout(timer)\n      timer = setTimeout(done, seconds * 1000, arguments)\n    }\n  }\n\n  function done(args) {\n    fn.apply(null, args)\n    timer = null\n  }\n}\n","const size = 256\nlet buffer = Buffer.allocUnsafe(size)\n\nconst messages = 'BCcDdEFfHPpQSX'.split('').reduce((acc, x) => {\n  const v = x.charCodeAt(0)\n  acc[x] = () => {\n    buffer[0] = v\n    b.i = 5\n    return b\n  }\n  return acc\n}, {})\n\nconst b = Object.assign(reset, messages, {\n  N: String.fromCharCode(0),\n  i: 0,\n  inc(x) {\n    b.i += x\n    return b\n  },\n  str(x) {\n    const length = Buffer.byteLength(x)\n    fit(length)\n    b.i += buffer.write(x, b.i, length, 'utf8')\n    return b\n  },\n  i16(x) {\n    fit(2)\n    buffer.writeUInt16BE(x, b.i)\n    b.i += 2\n    return b\n  },\n  i32(x, i) {\n    if (i || i === 0) {\n      buffer.writeUInt32BE(x, i)\n      return b\n    }\n    fit(4)\n    buffer.writeUInt32BE(x, b.i)\n    b.i += 4\n    return b\n  },\n  z(x) {\n    fit(x)\n    buffer.fill(0, b.i, b.i + x)\n    b.i += x\n    return b\n  },\n  raw(x) {\n    buffer = Buffer.concat([buffer.subarray(0, b.i), x])\n    b.i = buffer.length\n    return b\n  },\n  end(at = 1) {\n    buffer.writeUInt32BE(b.i - at, at)\n    const out = buffer.subarray(0, b.i)\n    b.i = 0\n    buffer = Buffer.allocUnsafe(size)\n    return out\n  }\n})\n\nexport default b\n\nfunction fit(x) {\n  if (buffer.length - b.i < x) {\n    const prev = buffer\n        , length = prev.length\n\n    buffer = Buffer.allocUnsafe(length + (length >> 1) + x)\n    prev.copy(buffer)\n  }\n}\n\nfunction reset() {\n  b.i = 0\n  return b\n}\n","const noop = () => { /* noop */ }\n\nexport default function Subscribe(postgres, options) {\n  const subscribers = new Map()\n      , slot = 'postgresjs_' + Math.random().toString(36).slice(2)\n      , state = {}\n\n  let connection\n    , stream\n    , ended = false\n\n  const sql = subscribe.sql = postgres({\n    ...options,\n    transform: { column: {}, value: {}, row: {} },\n    max: 1,\n    fetch_types: false,\n    idle_timeout: null,\n    max_lifetime: null,\n    connection: {\n      ...options.connection,\n      replication: 'database'\n    },\n    onclose: async function() {\n      if (ended)\n        return\n      stream = null\n      state.pid = state.secret = undefined\n      connected(await init(sql, slot, options.publications))\n      subscribers.forEach(event => event.forEach(({ onsubscribe }) => onsubscribe()))\n    },\n    no_subscribe: true\n  })\n\n  const end = sql.end\n      , close = sql.close\n\n  sql.end = async() => {\n    ended = true\n    stream && (await new Promise(r => (stream.once('close', r), stream.end())))\n    return end()\n  }\n\n  sql.close = async() => {\n    stream && (await new Promise(r => (stream.once('close', r), stream.end())))\n    return close()\n  }\n\n  return subscribe\n\n  async function subscribe(event, fn, onsubscribe = noop, onerror = noop) {\n    event = parseEvent(event)\n\n    if (!connection)\n      connection = init(sql, slot, options.publications)\n\n    const subscriber = { fn, onsubscribe }\n    const fns = subscribers.has(event)\n      ? subscribers.get(event).add(subscriber)\n      : subscribers.set(event, new Set([subscriber])).get(event)\n\n    const unsubscribe = () => {\n      fns.delete(subscriber)\n      fns.size === 0 && subscribers.delete(event)\n    }\n\n    return connection.then(x => {\n      connected(x)\n      onsubscribe()\n      stream && stream.on('error', onerror)\n      return { unsubscribe, state, sql }\n    })\n  }\n\n  function connected(x) {\n    stream = x.stream\n    state.pid = x.state.pid\n    state.secret = x.state.secret\n  }\n\n  async function init(sql, slot, publications) {\n    if (!publications)\n      throw new Error('Missing publication names')\n\n    const xs = await sql.unsafe(\n      `CREATE_REPLICATION_SLOT ${ slot } TEMPORARY LOGICAL pgoutput NOEXPORT_SNAPSHOT`\n    )\n\n    const [x] = xs\n\n    const stream = await sql.unsafe(\n      `START_REPLICATION SLOT ${ slot } LOGICAL ${\n        x.consistent_point\n      } (proto_version '1', publication_names '${ publications }')`\n    ).writable()\n\n    const state = {\n      lsn: Buffer.concat(x.consistent_point.split('/').map(x => Buffer.from(('00000000' + x).slice(-8), 'hex')))\n    }\n\n    stream.on('data', data)\n    stream.on('error', error)\n    stream.on('close', sql.close)\n\n    return { stream, state: xs.state }\n\n    function error(e) {\n      console.error('Unexpected error during logical streaming - reconnecting', e) // eslint-disable-line\n    }\n\n    function data(x) {\n      if (x[0] === 0x77) {\n        parse(x.subarray(25), state, sql.options.parsers, handle, options.transform)\n      } else if (x[0] === 0x6b && x[17]) {\n        state.lsn = x.subarray(1, 9)\n        pong()\n      }\n    }\n\n    function handle(a, b) {\n      const path = b.relation.schema + '.' + b.relation.table\n      call('*', a, b)\n      call('*:' + path, a, b)\n      b.relation.keys.length && call('*:' + path + '=' + b.relation.keys.map(x => a[x.name]), a, b)\n      call(b.command, a, b)\n      call(b.command + ':' + path, a, b)\n      b.relation.keys.length && call(b.command + ':' + path + '=' + b.relation.keys.map(x => a[x.name]), a, b)\n    }\n\n    function pong() {\n      const x = Buffer.alloc(34)\n      x[0] = 'r'.charCodeAt(0)\n      x.fill(state.lsn, 1)\n      x.writeBigInt64BE(BigInt(Date.now() - Date.UTC(2000, 0, 1)) * BigInt(1000), 25)\n      stream.write(x)\n    }\n  }\n\n  function call(x, a, b) {\n    subscribers.has(x) && subscribers.get(x).forEach(({ fn }) => fn(a, b, x))\n  }\n}\n\nfunction Time(x) {\n  return new Date(Date.UTC(2000, 0, 1) + Number(x / BigInt(1000)))\n}\n\nfunction parse(x, state, parsers, handle, transform) {\n  const char = (acc, [k, v]) => (acc[k.charCodeAt(0)] = v, acc)\n\n  Object.entries({\n    R: x => {  // Relation\n      let i = 1\n      const r = state[x.readUInt32BE(i)] = {\n        schema: x.toString('utf8', i += 4, i = x.indexOf(0, i)) || 'pg_catalog',\n        table: x.toString('utf8', i + 1, i = x.indexOf(0, i + 1)),\n        columns: Array(x.readUInt16BE(i += 2)),\n        keys: []\n      }\n      i += 2\n\n      let columnIndex = 0\n        , column\n\n      while (i < x.length) {\n        column = r.columns[columnIndex++] = {\n          key: x[i++],\n          name: transform.column.from\n            ? transform.column.from(x.toString('utf8', i, i = x.indexOf(0, i)))\n            : x.toString('utf8', i, i = x.indexOf(0, i)),\n          type: x.readUInt32BE(i += 1),\n          parser: parsers[x.readUInt32BE(i)],\n          atttypmod: x.readUInt32BE(i += 4)\n        }\n\n        column.key && r.keys.push(column)\n        i += 4\n      }\n    },\n    Y: () => { /* noop */ }, // Type\n    O: () => { /* noop */ }, // Origin\n    B: x => { // Begin\n      state.date = Time(x.readBigInt64BE(9))\n      state.lsn = x.subarray(1, 9)\n    },\n    I: x => { // Insert\n      let i = 1\n      const relation = state[x.readUInt32BE(i)]\n      const { row } = tuples(x, relation.columns, i += 7, transform)\n\n      handle(row, {\n        command: 'insert',\n        relation\n      })\n    },\n    D: x => { // Delete\n      let i = 1\n      const relation = state[x.readUInt32BE(i)]\n      i += 4\n      const key = x[i] === 75\n      handle(key || x[i] === 79\n        ? tuples(x, relation.columns, i += 3, transform).row\n        : null\n      , {\n        command: 'delete',\n        relation,\n        key\n      })\n    },\n    U: x => { // Update\n      let i = 1\n      const relation = state[x.readUInt32BE(i)]\n      i += 4\n      const key = x[i] === 75\n      const xs = key || x[i] === 79\n        ? tuples(x, relation.columns, i += 3, transform)\n        : null\n\n      xs && (i = xs.i)\n\n      const { row } = tuples(x, relation.columns, i + 3, transform)\n\n      handle(row, {\n        command: 'update',\n        relation,\n        key,\n        old: xs && xs.row\n      })\n    },\n    T: () => { /* noop */ }, // Truncate,\n    C: () => { /* noop */ }  // Commit\n  }).reduce(char, {})[x[0]](x)\n}\n\nfunction tuples(x, columns, xi, transform) {\n  let type\n    , column\n    , value\n\n  const row = transform.raw ? new Array(columns.length) : {}\n  for (let i = 0; i < columns.length; i++) {\n    type = x[xi++]\n    column = columns[i]\n    value = type === 110 // n\n      ? null\n      : type === 117 // u\n        ? undefined\n        : column.parser === undefined\n          ? x.toString('utf8', xi + 4, xi += 4 + x.readUInt32BE(xi))\n          : column.parser.array === true\n            ? column.parser(x.toString('utf8', xi + 5, xi += 4 + x.readUInt32BE(xi)))\n            : column.parser(x.toString('utf8', xi + 4, xi += 4 + x.readUInt32BE(xi)))\n\n    transform.raw\n      ? (row[i] = transform.raw === true\n        ? value\n        : transform.value.from ? transform.value.from(value, column) : value)\n      : (row[column.name] = transform.value.from\n        ? transform.value.from(value, column)\n        : value\n      )\n  }\n\n  return { i: xi, row: transform.row.from ? transform.row.from(row) : row }\n}\n\nfunction parseEvent(x) {\n  const xs = x.match(/^(\\*|insert|update|delete)?:?([^.]+?\\.?[^=]+)?=?(.+)?/i) || []\n\n  if (!xs)\n    throw new Error('Malformed subscribe pattern: ' + x)\n\n  const [, command, path, key] = xs\n\n  return (command || '*')\n       + (path ? ':' + (path.indexOf('.') === -1 ? 'public.' + path : path) : '')\n       + (key ? '=' + key : '')\n}\n","function hexToBytes(hex) {\n  const bytes = [];\n  for (let c = 0; c < hex.length; c += 2) {\n    bytes.push(Number.parseInt(hex.slice(c, c + 2), 16));\n  }\n  return new Uint8Array(bytes);\n}\nfunction bytesToFloat64(bytes, offset) {\n  const buffer = new ArrayBuffer(8);\n  const view = new DataView(buffer);\n  for (let i = 0; i < 8; i++) {\n    view.setUint8(i, bytes[offset + i]);\n  }\n  return view.getFloat64(0, true);\n}\nfunction parseEWKB(hex) {\n  const bytes = hexToBytes(hex);\n  let offset = 0;\n  const byteOrder = bytes[offset];\n  offset += 1;\n  const view = new DataView(bytes.buffer);\n  const geomType = view.getUint32(offset, byteOrder === 1);\n  offset += 4;\n  let _srid;\n  if (geomType & 536870912) {\n    _srid = view.getUint32(offset, byteOrder === 1);\n    offset += 4;\n  }\n  if ((geomType & 65535) === 1) {\n    const x = bytesToFloat64(bytes, offset);\n    offset += 8;\n    const y = bytesToFloat64(bytes, offset);\n    offset += 8;\n    return [x, y];\n  }\n  throw new Error(\"Unsupported geometry type\");\n}\nexport {\n  parseEWKB\n};\n//# sourceMappingURL=utils.js.map","const PgViewConfig = Symbol.for(\"drizzle:PgViewConfig\");\nexport {\n  PgViewConfig\n};\n//# sourceMappingURL=view-common.js.map","/**\n * The functions provided by this module are used to communicate certain properties\n * about the currently running code so that Next.js can make decisions on how to handle\n * the current execution in different rendering modes such as pre-rendering, resuming, and SSR.\n *\n * Today Next.js treats all code as potentially static. Certain APIs may only make sense when dynamically rendering.\n * Traditionally this meant deopting the entire render to dynamic however with PPR we can now deopt parts\n * of a React tree as dynamic while still keeping other parts static. There are really two different kinds of\n * Dynamic indications.\n *\n * The first is simply an intention to be dynamic. unstable_noStore is an example of this where\n * the currently executing code simply declares that the current scope is dynamic but if you use it\n * inside unstable_cache it can still be cached. This type of indication can be removed if we ever\n * make the default dynamic to begin with because the only way you would ever be static is inside\n * a cache scope which this indication does not affect.\n *\n * The second is an indication that a dynamic data source was read. This is a stronger form of dynamic\n * because it means that it is inappropriate to cache this at all. using a dynamic data source inside\n * unstable_cache should error. If you want to use some dynamic data inside unstable_cache you should\n * read that data outside the cache and pass it in as an argument to the cached function.\n */ // Once postpone is in stable we should switch to importing the postpone export directly\nimport React from 'react';\nimport { DynamicServerError } from '../../client/components/hooks-server-context';\nimport { StaticGenBailoutError } from '../../client/components/static-generation-bailout';\nimport { getRuntimeStagePromise, throwForMissingRequestStore, workUnitAsyncStorage } from './work-unit-async-storage.external';\nimport { workAsyncStorage } from '../app-render/work-async-storage.external';\nimport { makeHangingPromise } from '../dynamic-rendering-utils';\nimport { METADATA_BOUNDARY_NAME, VIEWPORT_BOUNDARY_NAME, OUTLET_BOUNDARY_NAME, ROOT_LAYOUT_BOUNDARY_NAME } from '../../lib/framework/boundary-constants';\nimport { scheduleOnNextTick } from '../../lib/scheduler';\nimport { BailoutToCSRError } from '../../shared/lib/lazy-dynamic/bailout-to-csr';\nimport { InvariantError } from '../../shared/lib/invariant-error';\nimport { RenderStage } from './staged-rendering';\nconst hasPostpone = typeof React.unstable_postpone === 'function';\nexport function createDynamicTrackingState(isDebugDynamicAccesses) {\n    return {\n        isDebugDynamicAccesses,\n        dynamicAccesses: [],\n        syncDynamicErrorWithStack: null\n    };\n}\nexport function createDynamicValidationState() {\n    return {\n        hasSuspenseAboveBody: false,\n        hasDynamicMetadata: false,\n        hasDynamicViewport: false,\n        hasAllowedDynamic: false,\n        dynamicErrors: []\n    };\n}\nexport function getFirstDynamicReason(trackingState) {\n    var _trackingState_dynamicAccesses_;\n    return (_trackingState_dynamicAccesses_ = trackingState.dynamicAccesses[0]) == null ? void 0 : _trackingState_dynamicAccesses_.expression;\n}\n/**\n * This function communicates that the current scope should be treated as dynamic.\n *\n * In most cases this function is a no-op but if called during\n * a PPR prerender it will postpone the current sub-tree and calling\n * it during a normal prerender will cause the entire prerender to abort\n */ export function markCurrentScopeAsDynamic(store, workUnitStore, expression) {\n    if (workUnitStore) {\n        switch(workUnitStore.type){\n            case 'cache':\n            case 'unstable-cache':\n                // Inside cache scopes, marking a scope as dynamic has no effect,\n                // because the outer cache scope creates a cache boundary. This is\n                // subtly different from reading a dynamic data source, which is\n                // forbidden inside a cache scope.\n                return;\n            case 'private-cache':\n                // A private cache scope is already dynamic by definition.\n                return;\n            case 'prerender-legacy':\n            case 'prerender-ppr':\n            case 'request':\n                break;\n            default:\n                workUnitStore;\n        }\n    }\n    // If we're forcing dynamic rendering or we're forcing static rendering, we\n    // don't need to do anything here because the entire page is already dynamic\n    // or it's static and it should not throw or postpone here.\n    if (store.forceDynamic || store.forceStatic) return;\n    if (store.dynamicShouldError) {\n        throw Object.defineProperty(new StaticGenBailoutError(`Route ${store.route} with \\`dynamic = \"error\"\\` couldn't be rendered statically because it used \\`${expression}\\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`), \"__NEXT_ERROR_CODE\", {\n            value: \"E553\",\n            enumerable: false,\n            configurable: true\n        });\n    }\n    if (workUnitStore) {\n        switch(workUnitStore.type){\n            case 'prerender-ppr':\n                return postponeWithTracking(store.route, expression, workUnitStore.dynamicTracking);\n            case 'prerender-legacy':\n                workUnitStore.revalidate = 0;\n                // We aren't prerendering, but we are generating a static page. We need\n                // to bail out of static generation.\n                const err = Object.defineProperty(new DynamicServerError(`Route ${store.route} couldn't be rendered statically because it used ${expression}. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E550\",\n                    enumerable: false,\n                    configurable: true\n                });\n                store.dynamicUsageDescription = expression;\n                store.dynamicUsageStack = err.stack;\n                throw err;\n            case 'request':\n                if (process.env.NODE_ENV !== 'production') {\n                    workUnitStore.usedDynamic = true;\n                }\n                break;\n            default:\n                workUnitStore;\n        }\n    }\n}\n/**\n * This function is meant to be used when prerendering without cacheComponents or PPR.\n * When called during a build it will cause Next.js to consider the route as dynamic.\n *\n * @internal\n */ export function throwToInterruptStaticGeneration(expression, store, prerenderStore) {\n    // We aren't prerendering but we are generating a static page. We need to bail out of static generation\n    const err = Object.defineProperty(new DynamicServerError(`Route ${store.route} couldn't be rendered statically because it used \\`${expression}\\`. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`), \"__NEXT_ERROR_CODE\", {\n        value: \"E558\",\n        enumerable: false,\n        configurable: true\n    });\n    prerenderStore.revalidate = 0;\n    store.dynamicUsageDescription = expression;\n    store.dynamicUsageStack = err.stack;\n    throw err;\n}\n/**\n * This function should be used to track whether something dynamic happened even when\n * we are in a dynamic render. This is useful for Dev where all renders are dynamic but\n * we still track whether dynamic APIs were accessed for helpful messaging\n *\n * @internal\n */ export function trackDynamicDataInDynamicRender(workUnitStore) {\n    switch(workUnitStore.type){\n        case 'cache':\n        case 'unstable-cache':\n            // Inside cache scopes, marking a scope as dynamic has no effect,\n            // because the outer cache scope creates a cache boundary. This is\n            // subtly different from reading a dynamic data source, which is\n            // forbidden inside a cache scope.\n            return;\n        case 'private-cache':\n            // A private cache scope is already dynamic by definition.\n            return;\n        case 'prerender':\n        case 'prerender-runtime':\n        case 'prerender-legacy':\n        case 'prerender-ppr':\n        case 'prerender-client':\n            break;\n        case 'request':\n            if (process.env.NODE_ENV !== 'production') {\n                workUnitStore.usedDynamic = true;\n            }\n            break;\n        default:\n            workUnitStore;\n    }\n}\nfunction abortOnSynchronousDynamicDataAccess(route, expression, prerenderStore) {\n    const reason = `Route ${route} needs to bail out of prerendering at this point because it used ${expression}.`;\n    const error = createPrerenderInterruptedError(reason);\n    prerenderStore.controller.abort(error);\n    const dynamicTracking = prerenderStore.dynamicTracking;\n    if (dynamicTracking) {\n        dynamicTracking.dynamicAccesses.push({\n            // When we aren't debugging, we don't need to create another error for the\n            // stack trace.\n            stack: dynamicTracking.isDebugDynamicAccesses ? new Error().stack : undefined,\n            expression\n        });\n    }\n}\nexport function abortOnSynchronousPlatformIOAccess(route, expression, errorWithStack, prerenderStore) {\n    const dynamicTracking = prerenderStore.dynamicTracking;\n    abortOnSynchronousDynamicDataAccess(route, expression, prerenderStore);\n    // It is important that we set this tracking value after aborting. Aborts are executed\n    // synchronously except for the case where you abort during render itself. By setting this\n    // value late we can use it to determine if any of the aborted tasks are the task that\n    // called the sync IO expression in the first place.\n    if (dynamicTracking) {\n        if (dynamicTracking.syncDynamicErrorWithStack === null) {\n            dynamicTracking.syncDynamicErrorWithStack = errorWithStack;\n        }\n    }\n}\nexport function trackSynchronousPlatformIOAccessInDev(requestStore) {\n    // We don't actually have a controller to abort but we do the semantic equivalent by\n    // advancing the request store out of the prerender stage\n    if (requestStore.stagedRendering) {\n        // TODO: error for sync IO in the runtime stage\n        // (which is not currently covered by the validation render in `spawnDynamicValidationInDev`)\n        requestStore.stagedRendering.advanceStage(RenderStage.Dynamic);\n    }\n}\n/**\n * use this function when prerendering with cacheComponents. If we are doing a\n * prospective prerender we don't actually abort because we want to discover\n * all caches for the shell. If this is the actual prerender we do abort.\n *\n * This function accepts a prerenderStore but the caller should ensure we're\n * actually running in cacheComponents mode.\n *\n * @internal\n */ export function abortAndThrowOnSynchronousRequestDataAccess(route, expression, errorWithStack, prerenderStore) {\n    const prerenderSignal = prerenderStore.controller.signal;\n    if (prerenderSignal.aborted === false) {\n        // TODO it would be better to move this aborted check into the callsite so we can avoid making\n        // the error object when it isn't relevant to the aborting of the prerender however\n        // since we need the throw semantics regardless of whether we abort it is easier to land\n        // this way. See how this was handled with `abortOnSynchronousPlatformIOAccess` for a closer\n        // to ideal implementation\n        abortOnSynchronousDynamicDataAccess(route, expression, prerenderStore);\n        // It is important that we set this tracking value after aborting. Aborts are executed\n        // synchronously except for the case where you abort during render itself. By setting this\n        // value late we can use it to determine if any of the aborted tasks are the task that\n        // called the sync IO expression in the first place.\n        const dynamicTracking = prerenderStore.dynamicTracking;\n        if (dynamicTracking) {\n            if (dynamicTracking.syncDynamicErrorWithStack === null) {\n                dynamicTracking.syncDynamicErrorWithStack = errorWithStack;\n            }\n        }\n    }\n    throw createPrerenderInterruptedError(`Route ${route} needs to bail out of prerendering at this point because it used ${expression}.`);\n}\nexport function Postpone({ reason, route }) {\n    const prerenderStore = workUnitAsyncStorage.getStore();\n    const dynamicTracking = prerenderStore && prerenderStore.type === 'prerender-ppr' ? prerenderStore.dynamicTracking : null;\n    postponeWithTracking(route, reason, dynamicTracking);\n}\nexport function postponeWithTracking(route, expression, dynamicTracking) {\n    assertPostpone();\n    if (dynamicTracking) {\n        dynamicTracking.dynamicAccesses.push({\n            // When we aren't debugging, we don't need to create another error for the\n            // stack trace.\n            stack: dynamicTracking.isDebugDynamicAccesses ? new Error().stack : undefined,\n            expression\n        });\n    }\n    React.unstable_postpone(createPostponeReason(route, expression));\n}\nfunction createPostponeReason(route, expression) {\n    return `Route ${route} needs to bail out of prerendering at this point because it used ${expression}. ` + `React throws this special object to indicate where. It should not be caught by ` + `your own try/catch. Learn more: https://nextjs.org/docs/messages/ppr-caught-error`;\n}\nexport function isDynamicPostpone(err) {\n    if (typeof err === 'object' && err !== null && typeof err.message === 'string') {\n        return isDynamicPostponeReason(err.message);\n    }\n    return false;\n}\nfunction isDynamicPostponeReason(reason) {\n    return reason.includes('needs to bail out of prerendering at this point because it used') && reason.includes('Learn more: https://nextjs.org/docs/messages/ppr-caught-error');\n}\nif (isDynamicPostponeReason(createPostponeReason('%%%', '^^^')) === false) {\n    throw Object.defineProperty(new Error('Invariant: isDynamicPostpone misidentified a postpone reason. This is a bug in Next.js'), \"__NEXT_ERROR_CODE\", {\n        value: \"E296\",\n        enumerable: false,\n        configurable: true\n    });\n}\nconst NEXT_PRERENDER_INTERRUPTED = 'NEXT_PRERENDER_INTERRUPTED';\nfunction createPrerenderInterruptedError(message) {\n    const error = Object.defineProperty(new Error(message), \"__NEXT_ERROR_CODE\", {\n        value: \"E394\",\n        enumerable: false,\n        configurable: true\n    });\n    error.digest = NEXT_PRERENDER_INTERRUPTED;\n    return error;\n}\nexport function isPrerenderInterruptedError(error) {\n    return typeof error === 'object' && error !== null && error.digest === NEXT_PRERENDER_INTERRUPTED && 'name' in error && 'message' in error && error instanceof Error;\n}\nexport function accessedDynamicData(dynamicAccesses) {\n    return dynamicAccesses.length > 0;\n}\nexport function consumeDynamicAccess(serverDynamic, clientDynamic) {\n    // We mutate because we only call this once we are no longer writing\n    // to the dynamicTrackingState and it's more efficient than creating a new\n    // array.\n    serverDynamic.dynamicAccesses.push(...clientDynamic.dynamicAccesses);\n    return serverDynamic.dynamicAccesses;\n}\nexport function formatDynamicAPIAccesses(dynamicAccesses) {\n    return dynamicAccesses.filter((access)=>typeof access.stack === 'string' && access.stack.length > 0).map(({ expression, stack })=>{\n        stack = stack.split('\\n')// Remove the \"Error: \" prefix from the first line of the stack trace as\n        // well as the first 4 lines of the stack trace which is the distance\n        // from the user code and the `new Error().stack` call.\n        .slice(4).filter((line)=>{\n            // Exclude Next.js internals from the stack trace.\n            if (line.includes('node_modules/next/')) {\n                return false;\n            }\n            // Exclude anonymous functions from the stack trace.\n            if (line.includes(' (<anonymous>)')) {\n                return false;\n            }\n            // Exclude Node.js internals from the stack trace.\n            if (line.includes(' (node:')) {\n                return false;\n            }\n            return true;\n        }).join('\\n');\n        return `Dynamic API Usage Debug - ${expression}:\\n${stack}`;\n    });\n}\nfunction assertPostpone() {\n    if (!hasPostpone) {\n        throw Object.defineProperty(new Error(`Invariant: React.unstable_postpone is not defined. This suggests the wrong version of React was loaded. This is a bug in Next.js`), \"__NEXT_ERROR_CODE\", {\n            value: \"E224\",\n            enumerable: false,\n            configurable: true\n        });\n    }\n}\n/**\n * This is a bit of a hack to allow us to abort a render using a Postpone instance instead of an Error which changes React's\n * abort semantics slightly.\n */ export function createRenderInBrowserAbortSignal() {\n    const controller = new AbortController();\n    controller.abort(Object.defineProperty(new BailoutToCSRError('Render in Browser'), \"__NEXT_ERROR_CODE\", {\n        value: \"E721\",\n        enumerable: false,\n        configurable: true\n    }));\n    return controller.signal;\n}\n/**\n * In a prerender, we may end up with hanging Promises as inputs due them\n * stalling on connection() or because they're loading dynamic data. In that\n * case we need to abort the encoding of arguments since they'll never complete.\n */ export function createHangingInputAbortSignal(workUnitStore) {\n    switch(workUnitStore.type){\n        case 'prerender':\n        case 'prerender-runtime':\n            const controller = new AbortController();\n            if (workUnitStore.cacheSignal) {\n                // If we have a cacheSignal it means we're in a prospective render. If\n                // the input we're waiting on is coming from another cache, we do want\n                // to wait for it so that we can resolve this cache entry too.\n                workUnitStore.cacheSignal.inputReady().then(()=>{\n                    controller.abort();\n                });\n            } else {\n                // Otherwise we're in the final render and we should already have all\n                // our caches filled.\n                // If the prerender uses stages, we have wait until the runtime stage,\n                // at which point all runtime inputs will be resolved.\n                // (otherwise, a runtime prerender might consider `cookies()` hanging\n                //  even though they'd resolve in the next task.)\n                //\n                // We might still be waiting on some microtasks so we\n                // wait one tick before giving up. When we give up, we still want to\n                // render the content of this cache as deeply as we can so that we can\n                // suspend as deeply as possible in the tree or not at all if we don't\n                // end up waiting for the input.\n                const runtimeStagePromise = getRuntimeStagePromise(workUnitStore);\n                if (runtimeStagePromise) {\n                    runtimeStagePromise.then(()=>scheduleOnNextTick(()=>controller.abort()));\n                } else {\n                    scheduleOnNextTick(()=>controller.abort());\n                }\n            }\n            return controller.signal;\n        case 'prerender-client':\n        case 'prerender-ppr':\n        case 'prerender-legacy':\n        case 'request':\n        case 'cache':\n        case 'private-cache':\n        case 'unstable-cache':\n            return undefined;\n        default:\n            workUnitStore;\n    }\n}\nexport function annotateDynamicAccess(expression, prerenderStore) {\n    const dynamicTracking = prerenderStore.dynamicTracking;\n    if (dynamicTracking) {\n        dynamicTracking.dynamicAccesses.push({\n            stack: dynamicTracking.isDebugDynamicAccesses ? new Error().stack : undefined,\n            expression\n        });\n    }\n}\nexport function useDynamicRouteParams(expression) {\n    const workStore = workAsyncStorage.getStore();\n    const workUnitStore = workUnitAsyncStorage.getStore();\n    if (workStore && workUnitStore) {\n        switch(workUnitStore.type){\n            case 'prerender-client':\n            case 'prerender':\n                {\n                    const fallbackParams = workUnitStore.fallbackRouteParams;\n                    if (fallbackParams && fallbackParams.size > 0) {\n                        // We are in a prerender with cacheComponents semantics. We are going to\n                        // hang here and never resolve. This will cause the currently\n                        // rendering component to effectively be a dynamic hole.\n                        React.use(makeHangingPromise(workUnitStore.renderSignal, workStore.route, expression));\n                    }\n                    break;\n                }\n            case 'prerender-ppr':\n                {\n                    const fallbackParams = workUnitStore.fallbackRouteParams;\n                    if (fallbackParams && fallbackParams.size > 0) {\n                        return postponeWithTracking(workStore.route, expression, workUnitStore.dynamicTracking);\n                    }\n                    break;\n                }\n            case 'prerender-runtime':\n                throw Object.defineProperty(new InvariantError(`\\`${expression}\\` was called during a runtime prerender. Next.js should be preventing ${expression} from being included in server components statically, but did not in this case.`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E771\",\n                    enumerable: false,\n                    configurable: true\n                });\n            case 'cache':\n            case 'private-cache':\n                throw Object.defineProperty(new InvariantError(`\\`${expression}\\` was called inside a cache scope. Next.js should be preventing ${expression} from being included in server components statically, but did not in this case.`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E745\",\n                    enumerable: false,\n                    configurable: true\n                });\n            case 'prerender-legacy':\n            case 'request':\n            case 'unstable-cache':\n                break;\n            default:\n                workUnitStore;\n        }\n    }\n}\nexport function useDynamicSearchParams(expression) {\n    const workStore = workAsyncStorage.getStore();\n    const workUnitStore = workUnitAsyncStorage.getStore();\n    if (!workStore) {\n        // We assume pages router context and just return\n        return;\n    }\n    if (!workUnitStore) {\n        throwForMissingRequestStore(expression);\n    }\n    switch(workUnitStore.type){\n        case 'prerender-client':\n            {\n                React.use(makeHangingPromise(workUnitStore.renderSignal, workStore.route, expression));\n                break;\n            }\n        case 'prerender-legacy':\n        case 'prerender-ppr':\n            {\n                if (workStore.forceStatic) {\n                    return;\n                }\n                throw Object.defineProperty(new BailoutToCSRError(expression), \"__NEXT_ERROR_CODE\", {\n                    value: \"E394\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n        case 'prerender':\n        case 'prerender-runtime':\n            throw Object.defineProperty(new InvariantError(`\\`${expression}\\` was called from a Server Component. Next.js should be preventing ${expression} from being included in server components statically, but did not in this case.`), \"__NEXT_ERROR_CODE\", {\n                value: \"E795\",\n                enumerable: false,\n                configurable: true\n            });\n        case 'cache':\n        case 'unstable-cache':\n        case 'private-cache':\n            throw Object.defineProperty(new InvariantError(`\\`${expression}\\` was called inside a cache scope. Next.js should be preventing ${expression} from being included in server components statically, but did not in this case.`), \"__NEXT_ERROR_CODE\", {\n                value: \"E745\",\n                enumerable: false,\n                configurable: true\n            });\n        case 'request':\n            return;\n        default:\n            workUnitStore;\n    }\n}\nconst hasSuspenseRegex = /\\n\\s+at Suspense \\(<anonymous>\\)/;\n// Common implicit body tags that React will treat as body when placed directly in html\nconst bodyAndImplicitTags = 'body|div|main|section|article|aside|header|footer|nav|form|p|span|h1|h2|h3|h4|h5|h6';\n// Detects when RootLayoutBoundary (our framework marker component) appears\n// after Suspense in the component stack, indicating the root layout is wrapped\n// within a Suspense boundary. Ensures no body/html/implicit-body components are in between.\n//\n// Example matches:\n//   at Suspense (<anonymous>)\n//   at __next_root_layout_boundary__ (<anonymous>)\n//\n// Or with other components in between (but not body/html/implicit-body):\n//   at Suspense (<anonymous>)\n//   at SomeComponent (<anonymous>)\n//   at __next_root_layout_boundary__ (<anonymous>)\nconst hasSuspenseBeforeRootLayoutWithoutBodyOrImplicitBodyRegex = new RegExp(`\\\\n\\\\s+at Suspense \\\\(<anonymous>\\\\)(?:(?!\\\\n\\\\s+at (?:${bodyAndImplicitTags}) \\\\(<anonymous>\\\\))[\\\\s\\\\S])*?\\\\n\\\\s+at ${ROOT_LAYOUT_BOUNDARY_NAME} \\\\([^\\\\n]*\\\\)`);\nconst hasMetadataRegex = new RegExp(`\\\\n\\\\s+at ${METADATA_BOUNDARY_NAME}[\\\\n\\\\s]`);\nconst hasViewportRegex = new RegExp(`\\\\n\\\\s+at ${VIEWPORT_BOUNDARY_NAME}[\\\\n\\\\s]`);\nconst hasOutletRegex = new RegExp(`\\\\n\\\\s+at ${OUTLET_BOUNDARY_NAME}[\\\\n\\\\s]`);\nexport function trackAllowedDynamicAccess(workStore, componentStack, dynamicValidation, clientDynamic) {\n    if (hasOutletRegex.test(componentStack)) {\n        // We don't need to track that this is dynamic. It is only so when something else is also dynamic.\n        return;\n    } else if (hasMetadataRegex.test(componentStack)) {\n        dynamicValidation.hasDynamicMetadata = true;\n        return;\n    } else if (hasViewportRegex.test(componentStack)) {\n        dynamicValidation.hasDynamicViewport = true;\n        return;\n    } else if (hasSuspenseBeforeRootLayoutWithoutBodyOrImplicitBodyRegex.test(componentStack)) {\n        // For Suspense within body, the prelude wouldn't be empty so it wouldn't violate the empty static shells rule.\n        // But if you have Suspense above body, the prelude is empty but we allow that because having Suspense\n        // is an explicit signal from the user that they acknowledge the empty shell and want dynamic rendering.\n        dynamicValidation.hasAllowedDynamic = true;\n        dynamicValidation.hasSuspenseAboveBody = true;\n        return;\n    } else if (hasSuspenseRegex.test(componentStack)) {\n        // this error had a Suspense boundary above it so we don't need to report it as a source\n        // of disallowed\n        dynamicValidation.hasAllowedDynamic = true;\n        return;\n    } else if (clientDynamic.syncDynamicErrorWithStack) {\n        // This task was the task that called the sync error.\n        dynamicValidation.dynamicErrors.push(clientDynamic.syncDynamicErrorWithStack);\n        return;\n    } else {\n        const message = `Route \"${workStore.route}\": Uncached data was accessed outside of ` + '<Suspense>. This delays the entire page from rendering, resulting in a ' + 'slow user experience. Learn more: ' + 'https://nextjs.org/docs/messages/blocking-route';\n        const error = createErrorWithComponentOrOwnerStack(message, componentStack);\n        dynamicValidation.dynamicErrors.push(error);\n        return;\n    }\n}\n/**\n * In dev mode, we prefer using the owner stack, otherwise the provided\n * component stack is used.\n */ function createErrorWithComponentOrOwnerStack(message, componentStack) {\n    const ownerStack = process.env.NODE_ENV !== 'production' && React.captureOwnerStack ? React.captureOwnerStack() : null;\n    const error = Object.defineProperty(new Error(message), \"__NEXT_ERROR_CODE\", {\n        value: \"E394\",\n        enumerable: false,\n        configurable: true\n    });\n    error.stack = error.name + ': ' + message + (ownerStack ?? componentStack);\n    return error;\n}\nexport var PreludeState = /*#__PURE__*/ function(PreludeState) {\n    PreludeState[PreludeState[\"Full\"] = 0] = \"Full\";\n    PreludeState[PreludeState[\"Empty\"] = 1] = \"Empty\";\n    PreludeState[PreludeState[\"Errored\"] = 2] = \"Errored\";\n    return PreludeState;\n}({});\nexport function logDisallowedDynamicError(workStore, error) {\n    console.error(error);\n    if (!workStore.dev) {\n        if (workStore.hasReadableErrorStacks) {\n            console.error(`To get a more detailed stack trace and pinpoint the issue, start the app in development mode by running \\`next dev\\`, then open \"${workStore.route}\" in your browser to investigate the error.`);\n        } else {\n            console.error(`To get a more detailed stack trace and pinpoint the issue, try one of the following:\n  - Start the app in development mode by running \\`next dev\\`, then open \"${workStore.route}\" in your browser to investigate the error.\n  - Rerun the production build with \\`next build --debug-prerender\\` to generate better stack traces.`);\n        }\n    }\n}\nexport function throwIfDisallowedDynamic(workStore, prelude, dynamicValidation, serverDynamic) {\n    if (serverDynamic.syncDynamicErrorWithStack) {\n        logDisallowedDynamicError(workStore, serverDynamic.syncDynamicErrorWithStack);\n        throw new StaticGenBailoutError();\n    }\n    if (prelude !== 0) {\n        if (dynamicValidation.hasSuspenseAboveBody) {\n            // This route has opted into allowing fully dynamic rendering\n            // by including a Suspense boundary above the body. In this case\n            // a lack of a shell is not considered disallowed so we simply return\n            return;\n        }\n        // We didn't have any sync bailouts but there may be user code which\n        // blocked the root. We would have captured these during the prerender\n        // and can log them here and then terminate the build/validating render\n        const dynamicErrors = dynamicValidation.dynamicErrors;\n        if (dynamicErrors.length > 0) {\n            for(let i = 0; i < dynamicErrors.length; i++){\n                logDisallowedDynamicError(workStore, dynamicErrors[i]);\n            }\n            throw new StaticGenBailoutError();\n        }\n        // If we got this far then the only other thing that could be blocking\n        // the root is dynamic Viewport. If this is dynamic then\n        // you need to opt into that by adding a Suspense boundary above the body\n        // to indicate your are ok with fully dynamic rendering.\n        if (dynamicValidation.hasDynamicViewport) {\n            console.error(`Route \"${workStore.route}\" has a \\`generateViewport\\` that depends on Request data (\\`cookies()\\`, etc...) or uncached external data (\\`fetch(...)\\`, etc...) without explicitly allowing fully dynamic rendering. See more info here: https://nextjs.org/docs/messages/next-prerender-dynamic-viewport`);\n            throw new StaticGenBailoutError();\n        }\n        if (prelude === 1) {\n            // If we ever get this far then we messed up the tracking of invalid dynamic.\n            // We still adhere to the constraint that you must produce a shell but invite the\n            // user to report this as a bug in Next.js.\n            console.error(`Route \"${workStore.route}\" did not produce a static shell and Next.js was unable to determine a reason. This is a bug in Next.js.`);\n            throw new StaticGenBailoutError();\n        }\n    } else {\n        if (dynamicValidation.hasAllowedDynamic === false && dynamicValidation.hasDynamicMetadata) {\n            console.error(`Route \"${workStore.route}\" has a \\`generateMetadata\\` that depends on Request data (\\`cookies()\\`, etc...) or uncached external data (\\`fetch(...)\\`, etc...) when the rest of the route does not. See more info here: https://nextjs.org/docs/messages/next-prerender-dynamic-metadata`);\n            throw new StaticGenBailoutError();\n        }\n    }\n}\nexport function delayUntilRuntimeStage(prerenderStore, result) {\n    if (prerenderStore.runtimeStagePromise) {\n        return prerenderStore.runtimeStagePromise.then(()=>result);\n    }\n    return result;\n}\n\n//# sourceMappingURL=dynamic-rendering.js.map","export class PostgresError extends Error {\n  constructor(x) {\n    super(x.message)\n    this.name = this.constructor.name\n    Object.assign(this, x)\n  }\n}\n\nexport const Errors = {\n  connection,\n  postgres,\n  generic,\n  notSupported\n}\n\nfunction connection(x, options, socket) {\n  const { host, port } = socket || options\n  const error = Object.assign(\n    new Error(('write ' + x + ' ' + (options.path || (host + ':' + port)))),\n    {\n      code: x,\n      errno: x,\n      address: options.path || host\n    }, options.path ? {} : { port: port }\n  )\n  Error.captureStackTrace(error, connection)\n  return error\n}\n\nfunction postgres(x) {\n  const error = new PostgresError(x)\n  Error.captureStackTrace(error, postgres)\n  return error\n}\n\nfunction generic(code, message) {\n  const error = Object.assign(new Error(code + ': ' + message), { code })\n  Error.captureStackTrace(error, generic)\n  return error\n}\n\n/* c8 ignore next 10 */\nfunction notSupported(x) {\n  const error = Object.assign(\n    new Error(x + ' (B) is not supported'),\n    {\n      code: 'MESSAGE_NOT_SUPPORTED',\n      name: x\n    }\n  )\n  Error.captureStackTrace(error, notSupported)\n  return error\n}\n","export function createPromiseWithResolvers() {\n    // Shim of Stage 4 Promise.withResolvers proposal\n    let resolve;\n    let reject;\n    const promise = new Promise((res, rej)=>{\n        resolve = res;\n        reject = rej;\n    });\n    return {\n        resolve: resolve,\n        reject: reject,\n        promise\n    };\n}\n\n//# sourceMappingURL=promise-with-resolvers.js.map","export class PageSignatureError extends Error {\n    constructor({ page }){\n        super(`The middleware \"${page}\" accepts an async API directly with the form:\n  \n  export function middleware(request, event) {\n    return NextResponse.redirect('/new-location')\n  }\n  \n  Read more: https://nextjs.org/docs/messages/middleware-new-signature\n  `);\n    }\n}\nexport class RemovedPageError extends Error {\n    constructor(){\n        super(`The request.page has been deprecated in favour of \\`URLPattern\\`.\n  Read more: https://nextjs.org/docs/messages/middleware-request-page\n  `);\n    }\n}\nexport class RemovedUAError extends Error {\n    constructor(){\n        super(`The request.ua has been removed in favour of \\`userAgent\\` function.\n  Read more: https://nextjs.org/docs/messages/middleware-parse-user-agent\n  `);\n    }\n}\n\n//# sourceMappingURL=error.js.map","export const METADATA_BOUNDARY_NAME = '__next_metadata_boundary__';\nexport const VIEWPORT_BOUNDARY_NAME = '__next_viewport_boundary__';\nexport const OUTLET_BOUNDARY_NAME = '__next_outlet_boundary__';\nexport const ROOT_LAYOUT_BOUNDARY_NAME = '__next_root_layout_boundary__';\n\n//# sourceMappingURL=boundary-constants.js.map","export function isHangingPromiseRejectionError(err) {\n    if (typeof err !== 'object' || err === null || !('digest' in err)) {\n        return false;\n    }\n    return err.digest === HANGING_PROMISE_REJECTION;\n}\nconst HANGING_PROMISE_REJECTION = 'HANGING_PROMISE_REJECTION';\nclass HangingPromiseRejectionError extends Error {\n    constructor(route, expression){\n        super(`During prerendering, ${expression} rejects when the prerender is complete. Typically these errors are handled by React but if you move ${expression} to a different context by using \\`setTimeout\\`, \\`after\\`, or similar functions you may observe this error and you should handle it in that context. This occurred at route \"${route}\".`), this.route = route, this.expression = expression, this.digest = HANGING_PROMISE_REJECTION;\n    }\n}\nconst abortListenersBySignal = new WeakMap();\n/**\n * This function constructs a promise that will never resolve. This is primarily\n * useful for cacheComponents where we use promise resolution timing to determine which\n * parts of a render can be included in a prerender.\n *\n * @internal\n */ export function makeHangingPromise(signal, route, expression) {\n    if (signal.aborted) {\n        return Promise.reject(new HangingPromiseRejectionError(route, expression));\n    } else {\n        const hangingPromise = new Promise((_, reject)=>{\n            const boundRejection = reject.bind(null, new HangingPromiseRejectionError(route, expression));\n            let currentListeners = abortListenersBySignal.get(signal);\n            if (currentListeners) {\n                currentListeners.push(boundRejection);\n            } else {\n                const listeners = [\n                    boundRejection\n                ];\n                abortListenersBySignal.set(signal, listeners);\n                signal.addEventListener('abort', ()=>{\n                    for(let i = 0; i < listeners.length; i++){\n                        listeners[i]();\n                    }\n                }, {\n                    once: true\n                });\n            }\n        });\n        // We are fine if no one actually awaits this promise. We shouldn't consider this an unhandled rejection so\n        // we attach a noop catch handler here to suppress this warning. If you actually await somewhere or construct\n        // your own promise out of it you'll need to ensure you handle the error when it rejects.\n        hangingPromise.catch(ignoreReject);\n        return hangingPromise;\n    }\n}\nfunction ignoreReject() {}\nexport function makeDevtoolsIOAwarePromise(underlying, requestStore, stage) {\n    if (requestStore.stagedRendering) {\n        // We resolve each stage in a timeout, so React DevTools will pick this up as IO.\n        return requestStore.stagedRendering.delayUntilStage(stage, undefined, underlying);\n    }\n    // in React DevTools if we resolve in a setTimeout we will observe\n    // the promise resolution as something that can suspend a boundary or root.\n    return new Promise((resolve)=>{\n        // Must use setTimeout to be considered IO React DevTools. setImmediate will not work.\n        setTimeout(()=>{\n            resolve(underlying);\n        }, 0);\n    });\n}\n\n//# sourceMappingURL=dynamic-rendering-utils.js.map","export var CachedRouteKind = /*#__PURE__*/ function(CachedRouteKind) {\n    CachedRouteKind[\"APP_PAGE\"] = \"APP_PAGE\";\n    CachedRouteKind[\"APP_ROUTE\"] = \"APP_ROUTE\";\n    CachedRouteKind[\"PAGES\"] = \"PAGES\";\n    CachedRouteKind[\"FETCH\"] = \"FETCH\";\n    CachedRouteKind[\"REDIRECT\"] = \"REDIRECT\";\n    CachedRouteKind[\"IMAGE\"] = \"IMAGE\";\n    return CachedRouteKind;\n}({});\nexport var IncrementalCacheKind = /*#__PURE__*/ function(IncrementalCacheKind) {\n    IncrementalCacheKind[\"APP_PAGE\"] = \"APP_PAGE\";\n    IncrementalCacheKind[\"APP_ROUTE\"] = \"APP_ROUTE\";\n    IncrementalCacheKind[\"PAGES\"] = \"PAGES\";\n    IncrementalCacheKind[\"FETCH\"] = \"FETCH\";\n    IncrementalCacheKind[\"IMAGE\"] = \"IMAGE\";\n    return IncrementalCacheKind;\n}({});\n\n//# sourceMappingURL=types.js.map","export function getSegmentValue(segment) {\n    return Array.isArray(segment) ? segment[1] : segment;\n}\nexport function isGroupSegment(segment) {\n    // Use array[0] for performant purpose\n    return segment[0] === '(' && segment.endsWith(')');\n}\nexport function isParallelRouteSegment(segment) {\n    return segment.startsWith('@') && segment !== '@children';\n}\nexport function addSearchParamsIfPageSegment(segment, searchParams) {\n    const isPageSegment = segment.includes(PAGE_SEGMENT_KEY);\n    if (isPageSegment) {\n        const stringifiedQuery = JSON.stringify(searchParams);\n        return stringifiedQuery !== '{}' ? PAGE_SEGMENT_KEY + '?' + stringifiedQuery : PAGE_SEGMENT_KEY;\n    }\n    return segment;\n}\nexport function computeSelectedLayoutSegment(segments, parallelRouteKey) {\n    if (!segments || segments.length === 0) {\n        return null;\n    }\n    // For 'children', use first segment; for other parallel routes, use last segment\n    const rawSegment = parallelRouteKey === 'children' ? segments[0] : segments[segments.length - 1];\n    // If the default slot is showing, return null since it's not technically \"selected\" (it's a fallback)\n    // Returning an internal value like `__DEFAULT__` would be confusing\n    return rawSegment === DEFAULT_SEGMENT_KEY ? null : rawSegment;\n}\n/** Get the canonical parameters from the current level to the leaf node. */ export function getSelectedLayoutSegmentPath(tree, parallelRouteKey, first = true, segmentPath = []) {\n    let node;\n    if (first) {\n        // Use the provided parallel route key on the first parallel route\n        node = tree[1][parallelRouteKey];\n    } else {\n        // After first parallel route prefer children, if there's no children pick the first parallel route.\n        const parallelRoutes = tree[1];\n        node = parallelRoutes.children ?? Object.values(parallelRoutes)[0];\n    }\n    if (!node) return segmentPath;\n    const segment = node[0];\n    let segmentValue = getSegmentValue(segment);\n    if (!segmentValue || segmentValue.startsWith(PAGE_SEGMENT_KEY)) {\n        return segmentPath;\n    }\n    segmentPath.push(segmentValue);\n    return getSelectedLayoutSegmentPath(node, parallelRouteKey, false, segmentPath);\n}\nexport const PAGE_SEGMENT_KEY = '__PAGE__';\nexport const DEFAULT_SEGMENT_KEY = '__DEFAULT__';\n\n//# sourceMappingURL=segment.js.map","export class ReflectAdapter {\n    static get(target, prop, receiver) {\n        const value = Reflect.get(target, prop, receiver);\n        if (typeof value === 'function') {\n            return value.bind(target);\n        }\n        return value;\n    }\n    static set(target, prop, value, receiver) {\n        return Reflect.set(target, prop, value, receiver);\n    }\n    static has(target, prop) {\n        return Reflect.has(target, prop);\n    }\n    static deleteProperty(target, prop) {\n        return Reflect.deleteProperty(target, prop);\n    }\n}\n\n//# sourceMappingURL=reflect.js.map","export var RedirectStatusCode = /*#__PURE__*/ function(RedirectStatusCode) {\n    RedirectStatusCode[RedirectStatusCode[\"SeeOther\"] = 303] = \"SeeOther\";\n    RedirectStatusCode[RedirectStatusCode[\"TemporaryRedirect\"] = 307] = \"TemporaryRedirect\";\n    RedirectStatusCode[RedirectStatusCode[\"PermanentRedirect\"] = 308] = \"PermanentRedirect\";\n    return RedirectStatusCode;\n}({});\n\n//# sourceMappingURL=redirect-status-code.js.map","export function getRevalidateReason(params) {\n    if (params.isOnDemandRevalidate) {\n        return 'on-demand';\n    }\n    if (params.isStaticGeneration) {\n        return 'stale';\n    }\n    return undefined;\n}\n\n//# sourceMappingURL=utils.js.map","export const TEXT_PLAIN_CONTENT_TYPE_HEADER = 'text/plain';\nexport const HTML_CONTENT_TYPE_HEADER = 'text/html; charset=utf-8';\nexport const JSON_CONTENT_TYPE_HEADER = 'application/json; charset=utf-8';\nexport const NEXT_QUERY_PARAM_PREFIX = 'nxtP';\nexport const NEXT_INTERCEPTION_MARKER_PREFIX = 'nxtI';\nexport const MATCHED_PATH_HEADER = 'x-matched-path';\nexport const PRERENDER_REVALIDATE_HEADER = 'x-prerender-revalidate';\nexport const PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER = 'x-prerender-revalidate-if-generated';\nexport const RSC_PREFETCH_SUFFIX = '.prefetch.rsc';\nexport const RSC_SEGMENTS_DIR_SUFFIX = '.segments';\nexport const RSC_SEGMENT_SUFFIX = '.segment.rsc';\nexport const RSC_SUFFIX = '.rsc';\nexport const ACTION_SUFFIX = '.action';\nexport const NEXT_DATA_SUFFIX = '.json';\nexport const NEXT_META_SUFFIX = '.meta';\nexport const NEXT_BODY_SUFFIX = '.body';\nexport const NEXT_CACHE_TAGS_HEADER = 'x-next-cache-tags';\nexport const NEXT_CACHE_REVALIDATED_TAGS_HEADER = 'x-next-revalidated-tags';\nexport const NEXT_CACHE_REVALIDATE_TAG_TOKEN_HEADER = 'x-next-revalidate-tag-token';\nexport const NEXT_RESUME_HEADER = 'next-resume';\n// if these change make sure we update the related\n// documentation as well\nexport const NEXT_CACHE_TAG_MAX_ITEMS = 128;\nexport const NEXT_CACHE_TAG_MAX_LENGTH = 256;\nexport const NEXT_CACHE_SOFT_TAG_MAX_LENGTH = 1024;\nexport const NEXT_CACHE_IMPLICIT_TAG_ID = '_N_T_';\n// in seconds\nexport const CACHE_ONE_YEAR = 31536000;\n// in seconds, represents revalidate=false. I.e. never revaliate.\n// We use this value since it can be represented as a V8 SMI for optimal performance.\n// It can also be serialized as JSON if it ever leaks accidentally as an actual value.\nexport const INFINITE_CACHE = 0xfffffffe;\n// Patterns to detect middleware files\nexport const MIDDLEWARE_FILENAME = 'middleware';\nexport const MIDDLEWARE_LOCATION_REGEXP = `(?:src/)?${MIDDLEWARE_FILENAME}`;\n// Patterns to detect proxy files (replacement for middleware)\nexport const PROXY_FILENAME = 'proxy';\nexport const PROXY_LOCATION_REGEXP = `(?:src/)?${PROXY_FILENAME}`;\n// Pattern to detect instrumentation hooks file\nexport const INSTRUMENTATION_HOOK_FILENAME = 'instrumentation';\n// Because on Windows absolute paths in the generated code can break because of numbers, eg 1 in the path,\n// we have to use a private alias\nexport const PAGES_DIR_ALIAS = 'private-next-pages';\nexport const DOT_NEXT_ALIAS = 'private-dot-next';\nexport const ROOT_DIR_ALIAS = 'private-next-root-dir';\nexport const APP_DIR_ALIAS = 'private-next-app-dir';\nexport const RSC_MOD_REF_PROXY_ALIAS = 'private-next-rsc-mod-ref-proxy';\nexport const RSC_ACTION_VALIDATE_ALIAS = 'private-next-rsc-action-validate';\nexport const RSC_ACTION_PROXY_ALIAS = 'private-next-rsc-server-reference';\nexport const RSC_CACHE_WRAPPER_ALIAS = 'private-next-rsc-cache-wrapper';\nexport const RSC_DYNAMIC_IMPORT_WRAPPER_ALIAS = 'private-next-rsc-track-dynamic-import';\nexport const RSC_ACTION_ENCRYPTION_ALIAS = 'private-next-rsc-action-encryption';\nexport const RSC_ACTION_CLIENT_WRAPPER_ALIAS = 'private-next-rsc-action-client-wrapper';\nexport const PUBLIC_DIR_MIDDLEWARE_CONFLICT = `You can not have a '_next' folder inside of your public folder. This conflicts with the internal '/_next' route. https://nextjs.org/docs/messages/public-next-folder-conflict`;\nexport const SSG_GET_INITIAL_PROPS_CONFLICT = `You can not use getInitialProps with getStaticProps. To use SSG, please remove your getInitialProps`;\nexport const SERVER_PROPS_GET_INIT_PROPS_CONFLICT = `You can not use getInitialProps with getServerSideProps. Please remove getInitialProps.`;\nexport const SERVER_PROPS_SSG_CONFLICT = `You can not use getStaticProps or getStaticPaths with getServerSideProps. To use SSG, please remove getServerSideProps`;\nexport const STATIC_STATUS_PAGE_GET_INITIAL_PROPS_ERROR = `can not have getInitialProps/getServerSideProps, https://nextjs.org/docs/messages/404-get-initial-props`;\nexport const SERVER_PROPS_EXPORT_ERROR = `pages with \\`getServerSideProps\\` can not be exported. See more info here: https://nextjs.org/docs/messages/gssp-export`;\nexport const GSP_NO_RETURNED_VALUE = 'Your `getStaticProps` function did not return an object. Did you forget to add a `return`?';\nexport const GSSP_NO_RETURNED_VALUE = 'Your `getServerSideProps` function did not return an object. Did you forget to add a `return`?';\nexport const UNSTABLE_REVALIDATE_RENAME_ERROR = 'The `unstable_revalidate` property is available for general use.\\n' + 'Please use `revalidate` instead.';\nexport const GSSP_COMPONENT_MEMBER_ERROR = `can not be attached to a page's component and must be exported from the page. See more info here: https://nextjs.org/docs/messages/gssp-component-member`;\nexport const NON_STANDARD_NODE_ENV = `You are using a non-standard \"NODE_ENV\" value in your environment. This creates inconsistencies in the project and is strongly advised against. Read more: https://nextjs.org/docs/messages/non-standard-node-env`;\nexport const SSG_FALLBACK_EXPORT_ERROR = `Pages with \\`fallback\\` enabled in \\`getStaticPaths\\` can not be exported. See more info here: https://nextjs.org/docs/messages/ssg-fallback-true-export`;\nexport const ESLINT_DEFAULT_DIRS = [\n    'app',\n    'pages',\n    'components',\n    'lib',\n    'src'\n];\nexport const SERVER_RUNTIME = {\n    edge: 'edge',\n    experimentalEdge: 'experimental-edge',\n    nodejs: 'nodejs'\n};\nexport const WEB_SOCKET_MAX_RECONNECTIONS = 12;\n/**\n * The names of the webpack layers. These layers are the primitives for the\n * webpack chunks.\n */ const WEBPACK_LAYERS_NAMES = {\n    /**\n   * The layer for the shared code between the client and server bundles.\n   */ shared: 'shared',\n    /**\n   * The layer for server-only runtime and picking up `react-server` export conditions.\n   * Including app router RSC pages and app router custom routes and metadata routes.\n   */ reactServerComponents: 'rsc',\n    /**\n   * Server Side Rendering layer for app (ssr).\n   */ serverSideRendering: 'ssr',\n    /**\n   * The browser client bundle layer for actions.\n   */ actionBrowser: 'action-browser',\n    /**\n   * The Node.js bundle layer for the API routes.\n   */ apiNode: 'api-node',\n    /**\n   * The Edge Lite bundle layer for the API routes.\n   */ apiEdge: 'api-edge',\n    /**\n   * The layer for the middleware code.\n   */ middleware: 'middleware',\n    /**\n   * The layer for the instrumentation hooks.\n   */ instrument: 'instrument',\n    /**\n   * The layer for assets on the edge.\n   */ edgeAsset: 'edge-asset',\n    /**\n   * The browser client bundle layer for App directory.\n   */ appPagesBrowser: 'app-pages-browser',\n    /**\n   * The browser client bundle layer for Pages directory.\n   */ pagesDirBrowser: 'pages-dir-browser',\n    /**\n   * The Edge Lite bundle layer for Pages directory.\n   */ pagesDirEdge: 'pages-dir-edge',\n    /**\n   * The Node.js bundle layer for Pages directory.\n   */ pagesDirNode: 'pages-dir-node'\n};\nconst WEBPACK_LAYERS = {\n    ...WEBPACK_LAYERS_NAMES,\n    GROUP: {\n        builtinReact: [\n            WEBPACK_LAYERS_NAMES.reactServerComponents,\n            WEBPACK_LAYERS_NAMES.actionBrowser\n        ],\n        serverOnly: [\n            WEBPACK_LAYERS_NAMES.reactServerComponents,\n            WEBPACK_LAYERS_NAMES.actionBrowser,\n            WEBPACK_LAYERS_NAMES.instrument,\n            WEBPACK_LAYERS_NAMES.middleware\n        ],\n        neutralTarget: [\n            // pages api\n            WEBPACK_LAYERS_NAMES.apiNode,\n            WEBPACK_LAYERS_NAMES.apiEdge\n        ],\n        clientOnly: [\n            WEBPACK_LAYERS_NAMES.serverSideRendering,\n            WEBPACK_LAYERS_NAMES.appPagesBrowser\n        ],\n        bundled: [\n            WEBPACK_LAYERS_NAMES.reactServerComponents,\n            WEBPACK_LAYERS_NAMES.actionBrowser,\n            WEBPACK_LAYERS_NAMES.serverSideRendering,\n            WEBPACK_LAYERS_NAMES.appPagesBrowser,\n            WEBPACK_LAYERS_NAMES.shared,\n            WEBPACK_LAYERS_NAMES.instrument,\n            WEBPACK_LAYERS_NAMES.middleware\n        ],\n        appPages: [\n            // app router pages and layouts\n            WEBPACK_LAYERS_NAMES.reactServerComponents,\n            WEBPACK_LAYERS_NAMES.serverSideRendering,\n            WEBPACK_LAYERS_NAMES.appPagesBrowser,\n            WEBPACK_LAYERS_NAMES.actionBrowser\n        ]\n    }\n};\nconst WEBPACK_RESOURCE_QUERIES = {\n    edgeSSREntry: '__next_edge_ssr_entry__',\n    metadata: '__next_metadata__',\n    metadataRoute: '__next_metadata_route__',\n    metadataImageMeta: '__next_metadata_image_meta__'\n};\nexport { WEBPACK_LAYERS, WEBPACK_RESOURCE_QUERIES };\n\n//# sourceMappingURL=constants.js.map","export const ENCODED_TAGS = {\n    // opening tags do not have the closing `>` since they can contain other attributes such as `<body className=''>`\n    OPENING: {\n        // <html\n        HTML: new Uint8Array([\n            60,\n            104,\n            116,\n            109,\n            108\n        ]),\n        // <body\n        BODY: new Uint8Array([\n            60,\n            98,\n            111,\n            100,\n            121\n        ])\n    },\n    CLOSED: {\n        // </head>\n        HEAD: new Uint8Array([\n            60,\n            47,\n            104,\n            101,\n            97,\n            100,\n            62\n        ]),\n        // </body>\n        BODY: new Uint8Array([\n            60,\n            47,\n            98,\n            111,\n            100,\n            121,\n            62\n        ]),\n        // </html>\n        HTML: new Uint8Array([\n            60,\n            47,\n            104,\n            116,\n            109,\n            108,\n            62\n        ]),\n        // </body></html>\n        BODY_AND_HTML: new Uint8Array([\n            60,\n            47,\n            98,\n            111,\n            100,\n            121,\n            62,\n            60,\n            47,\n            104,\n            116,\n            109,\n            108,\n            62\n        ])\n    },\n    META: {\n        // Only the match the prefix cause the suffix can be different wether it's xml compatible or not \">\" or \"/>\"\n        // <meta name=\"nxt-icon\"\n        // This is a special mark that will be replaced by the icon insertion script tag.\n        ICON_MARK: new Uint8Array([\n            60,\n            109,\n            101,\n            116,\n            97,\n            32,\n            110,\n            97,\n            109,\n            101,\n            61,\n            34,\n            194,\n            171,\n            110,\n            120,\n            116,\n            45,\n            105,\n            99,\n            111,\n            110,\n            194,\n            187,\n            34\n        ])\n    }\n};\n\n//# sourceMappingURL=encoded-tags.js.map","export const MISSING_ROOT_TAGS_ERROR = 'NEXT_MISSING_ROOT_TAGS';\n\n//# sourceMappingURL=constants.js.map","export var RouteKind = /*#__PURE__*/ function(RouteKind) {\n    /**\n   * `PAGES` represents all the React pages that are under `pages/`.\n   */ RouteKind[\"PAGES\"] = \"PAGES\";\n    /**\n   * `PAGES_API` represents all the API routes under `pages/api/`.\n   */ RouteKind[\"PAGES_API\"] = \"PAGES_API\";\n    /**\n   * `APP_PAGE` represents all the React pages that are under `app/` with the\n   * filename of `page.{j,t}s{,x}`.\n   */ RouteKind[\"APP_PAGE\"] = \"APP_PAGE\";\n    /**\n   * `APP_ROUTE` represents all the API routes and metadata routes that are under `app/` with the\n   * filename of `route.{j,t}s{,x}`.\n   */ RouteKind[\"APP_ROUTE\"] = \"APP_ROUTE\";\n    /**\n   * `IMAGE` represents all the images that are generated by `next/image`.\n   */ RouteKind[\"IMAGE\"] = \"IMAGE\";\n    return RouteKind;\n}({});\n\n//# sourceMappingURL=route-kind.js.map","export class InvariantError extends Error {\n    constructor(message, options){\n        super(`Invariant: ${message.endsWith('.') ? message : message + '.'} This is a bug in Next.js.`, options);\n        this.name = 'InvariantError';\n    }\n}\n\n//# sourceMappingURL=invariant-error.js.map","export const RSC_HEADER = 'rsc';\nexport const ACTION_HEADER = 'next-action';\n// TODO: Instead of sending the full router state, we only need to send the\n// segment path. Saves bytes. Then we could also use this field for segment\n// prefetches, which also need to specify a particular segment.\nexport const NEXT_ROUTER_STATE_TREE_HEADER = 'next-router-state-tree';\nexport const NEXT_ROUTER_PREFETCH_HEADER = 'next-router-prefetch';\n// This contains the path to the segment being prefetched.\n// TODO: If we change next-router-state-tree to be a segment path, we can use\n// that instead. Then next-router-prefetch and next-router-segment-prefetch can\n// be merged into a single enum.\nexport const NEXT_ROUTER_SEGMENT_PREFETCH_HEADER = 'next-router-segment-prefetch';\nexport const NEXT_HMR_REFRESH_HEADER = 'next-hmr-refresh';\nexport const NEXT_HMR_REFRESH_HASH_COOKIE = '__next_hmr_refresh_hash__';\nexport const NEXT_URL = 'next-url';\nexport const RSC_CONTENT_TYPE_HEADER = 'text/x-component';\nexport const FLIGHT_HEADERS = [\n    RSC_HEADER,\n    NEXT_ROUTER_STATE_TREE_HEADER,\n    NEXT_ROUTER_PREFETCH_HEADER,\n    NEXT_HMR_REFRESH_HEADER,\n    NEXT_ROUTER_SEGMENT_PREFETCH_HEADER\n];\nexport const NEXT_RSC_UNION_QUERY = '_rsc';\nexport const NEXT_ROUTER_STALE_TIME_HEADER = 'x-nextjs-stale-time';\nexport const NEXT_DID_POSTPONE_HEADER = 'x-nextjs-postponed';\nexport const NEXT_REWRITTEN_PATH_HEADER = 'x-nextjs-rewritten-path';\nexport const NEXT_REWRITTEN_QUERY_HEADER = 'x-nextjs-rewritten-query';\nexport const NEXT_IS_PRERENDER_HEADER = 'x-nextjs-prerender';\nexport const NEXT_ACTION_NOT_FOUND_HEADER = 'x-nextjs-action-not-found';\nexport const NEXT_REQUEST_ID_HEADER = 'x-nextjs-request-id';\nexport const NEXT_HTML_REQUEST_ID_HEADER = 'x-nextjs-html-request-id';\n\n//# sourceMappingURL=app-router-headers.js.map","export function detectDomainLocale(domainItems, hostname, detectedLocale) {\n    if (!domainItems) return;\n    if (detectedLocale) {\n        detectedLocale = detectedLocale.toLowerCase();\n    }\n    for (const item of domainItems){\n        // remove port if present\n        const domainHostname = item.domain?.split(':', 1)[0].toLowerCase();\n        if (hostname === domainHostname || detectedLocale === item.defaultLocale.toLowerCase() || item.locales?.some((locale)=>locale.toLowerCase() === detectedLocale)) {\n            return item;\n        }\n    }\n}\n\n//# sourceMappingURL=detect-domain-locale.js.map","export default class Result extends Array {\n  constructor() {\n    super()\n    Object.defineProperties(this, {\n      count: { value: null, writable: true },\n      state: { value: null, writable: true },\n      command: { value: null, writable: true },\n      columns: { value: null, writable: true },\n      statement: { value: null, writable: true }\n    })\n  }\n\n  static get [Symbol.species]() {\n    return Array\n  }\n}\n","export default Queue\n\nfunction Queue(initial = []) {\n  let xs = initial.slice()\n  let index = 0\n\n  return {\n    get length() {\n      return xs.length - index\n    },\n    remove: (x) => {\n      const index = xs.indexOf(x)\n      return index === -1\n        ? null\n        : (xs.splice(index, 1), x)\n    },\n    push: (x) => (xs.push(x), x),\n    shift: () => {\n      const out = xs[index++]\n\n      if (index === xs.length) {\n        index = 0\n        xs = []\n      } else {\n        xs[index - 1] = undefined\n      }\n\n      return out\n    }\n  }\n}\n","import { entityKind } from \"../../entity.js\";\nclass Cache {\n  static [entityKind] = \"Cache\";\n}\nclass NoopCache extends Cache {\n  strategy() {\n    return \"all\";\n  }\n  static [entityKind] = \"NoopCache\";\n  async get(_key) {\n    return void 0;\n  }\n  async put(_hashedQuery, _response, _tables, _config) {\n  }\n  async onMutate(_params) {\n  }\n}\nasync function hashQuery(sql, params) {\n  const dataToHash = `${sql}-${JSON.stringify(params)}`;\n  const encoder = new TextEncoder();\n  const data = encoder.encode(dataToHash);\n  const hashBuffer = await crypto.subtle.digest(\"SHA-256\", data);\n  const hashArray = [...new Uint8Array(hashBuffer)];\n  const hashHex = hashArray.map((b) => b.toString(16).padStart(2, \"0\")).join(\"\");\n  return hashHex;\n}\nexport {\n  Cache,\n  NoopCache,\n  hashQuery\n};\n//# sourceMappingURL=cache.js.map","import { entityKind } from \"./entity.js\";\nclass Column {\n  constructor(table, config) {\n    this.table = table;\n    this.config = config;\n    this.name = config.name;\n    this.keyAsName = config.keyAsName;\n    this.notNull = config.notNull;\n    this.default = config.default;\n    this.defaultFn = config.defaultFn;\n    this.onUpdateFn = config.onUpdateFn;\n    this.hasDefault = config.hasDefault;\n    this.primary = config.primaryKey;\n    this.isUnique = config.isUnique;\n    this.uniqueName = config.uniqueName;\n    this.uniqueType = config.uniqueType;\n    this.dataType = config.dataType;\n    this.columnType = config.columnType;\n    this.generated = config.generated;\n    this.generatedIdentity = config.generatedIdentity;\n  }\n  static [entityKind] = \"Column\";\n  name;\n  keyAsName;\n  primary;\n  notNull;\n  default;\n  defaultFn;\n  onUpdateFn;\n  hasDefault;\n  isUnique;\n  uniqueName;\n  uniqueType;\n  dataType;\n  columnType;\n  enumValues = void 0;\n  generated = void 0;\n  generatedIdentity = void 0;\n  config;\n  mapFromDriverValue(value) {\n    return value;\n  }\n  mapToDriverValue(value) {\n    return value;\n  }\n  // ** @internal */\n  shouldDisableInsert() {\n    return this.config.generated !== void 0 && this.config.generated.type !== \"byDefault\";\n  }\n}\nexport {\n  Column\n};\n//# sourceMappingURL=column.js.map","import { entityKind } from \"./entity.js\";\nclass ColumnBuilder {\n  static [entityKind] = \"ColumnBuilder\";\n  config;\n  constructor(name, dataType, columnType) {\n    this.config = {\n      name,\n      keyAsName: name === \"\",\n      notNull: false,\n      default: void 0,\n      hasDefault: false,\n      primaryKey: false,\n      isUnique: false,\n      uniqueName: void 0,\n      uniqueType: void 0,\n      dataType,\n      columnType,\n      generated: void 0\n    };\n  }\n  /**\n   * Changes the data type of the column. Commonly used with `json` columns. Also, useful for branded types.\n   *\n   * @example\n   * ```ts\n   * const users = pgTable('users', {\n   * \tid: integer('id').$type<UserId>().primaryKey(),\n   * \tdetails: json('details').$type<UserDetails>().notNull(),\n   * });\n   * ```\n   */\n  $type() {\n    return this;\n  }\n  /**\n   * Adds a `not null` clause to the column definition.\n   *\n   * Affects the `select` model of the table - columns *without* `not null` will be nullable on select.\n   */\n  notNull() {\n    this.config.notNull = true;\n    return this;\n  }\n  /**\n   * Adds a `default <value>` clause to the column definition.\n   *\n   * Affects the `insert` model of the table - columns *with* `default` are optional on insert.\n   *\n   * If you need to set a dynamic default value, use {@link $defaultFn} instead.\n   */\n  default(value) {\n    this.config.default = value;\n    this.config.hasDefault = true;\n    return this;\n  }\n  /**\n   * Adds a dynamic default value to the column.\n   * The function will be called when the row is inserted, and the returned value will be used as the column value.\n   *\n   * **Note:** This value does not affect the `drizzle-kit` behavior, it is only used at runtime in `drizzle-orm`.\n   */\n  $defaultFn(fn) {\n    this.config.defaultFn = fn;\n    this.config.hasDefault = true;\n    return this;\n  }\n  /**\n   * Alias for {@link $defaultFn}.\n   */\n  $default = this.$defaultFn;\n  /**\n   * Adds a dynamic update value to the column.\n   * The function will be called when the row is updated, and the returned value will be used as the column value if none is provided.\n   * If no `default` (or `$defaultFn`) value is provided, the function will be called when the row is inserted as well, and the returned value will be used as the column value.\n   *\n   * **Note:** This value does not affect the `drizzle-kit` behavior, it is only used at runtime in `drizzle-orm`.\n   */\n  $onUpdateFn(fn) {\n    this.config.onUpdateFn = fn;\n    this.config.hasDefault = true;\n    return this;\n  }\n  /**\n   * Alias for {@link $onUpdateFn}.\n   */\n  $onUpdate = this.$onUpdateFn;\n  /**\n   * Adds a `primary key` clause to the column definition. This implicitly makes the column `not null`.\n   *\n   * In SQLite, `integer primary key` implicitly makes the column auto-incrementing.\n   */\n  primaryKey() {\n    this.config.primaryKey = true;\n    this.config.notNull = true;\n    return this;\n  }\n  /** @internal Sets the name of the column to the key within the table definition if a name was not given. */\n  setName(name) {\n    if (this.config.name !== \"\") return;\n    this.config.name = name;\n  }\n}\nexport {\n  ColumnBuilder\n};\n//# sourceMappingURL=column-builder.js.map","import { entityKind } from \"./entity.js\";\nclass Subquery {\n  static [entityKind] = \"Subquery\";\n  constructor(sql, fields, alias, isWith = false, usedTables = []) {\n    this._ = {\n      brand: \"Subquery\",\n      sql,\n      selectedFields: fields,\n      alias,\n      isWith,\n      usedTables\n    };\n  }\n  // getSQL(): SQL<unknown> {\n  // \treturn new SQL([this]);\n  // }\n}\nclass WithSubquery extends Subquery {\n  static [entityKind] = \"WithSubquery\";\n}\nexport {\n  Subquery,\n  WithSubquery\n};\n//# sourceMappingURL=subquery.js.map","import { sql } from \"../sql.js\";\nfunction asc(column) {\n  return sql`${column} asc`;\n}\nfunction desc(column) {\n  return sql`${column} desc`;\n}\nexport {\n  asc,\n  desc\n};\n//# sourceMappingURL=select.js.map","import { JOSENotSupported } from '../util/errors.js';\nfunction getModulusLengthOption(options) {\n    const modulusLength = options?.modulusLength ?? 2048;\n    if (typeof modulusLength !== 'number' || modulusLength < 2048) {\n        throw new JOSENotSupported('Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used');\n    }\n    return modulusLength;\n}\nexport async function generateKeyPair(alg, options) {\n    let algorithm;\n    let keyUsages;\n    switch (alg) {\n        case 'PS256':\n        case 'PS384':\n        case 'PS512':\n            algorithm = {\n                name: 'RSA-PSS',\n                hash: `SHA-${alg.slice(-3)}`,\n                publicExponent: Uint8Array.of(0x01, 0x00, 0x01),\n                modulusLength: getModulusLengthOption(options),\n            };\n            keyUsages = ['sign', 'verify'];\n            break;\n        case 'RS256':\n        case 'RS384':\n        case 'RS512':\n            algorithm = {\n                name: 'RSASSA-PKCS1-v1_5',\n                hash: `SHA-${alg.slice(-3)}`,\n                publicExponent: Uint8Array.of(0x01, 0x00, 0x01),\n                modulusLength: getModulusLengthOption(options),\n            };\n            keyUsages = ['sign', 'verify'];\n            break;\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512':\n            algorithm = {\n                name: 'RSA-OAEP',\n                hash: `SHA-${parseInt(alg.slice(-3), 10) || 1}`,\n                publicExponent: Uint8Array.of(0x01, 0x00, 0x01),\n                modulusLength: getModulusLengthOption(options),\n            };\n            keyUsages = ['decrypt', 'unwrapKey', 'encrypt', 'wrapKey'];\n            break;\n        case 'ES256':\n            algorithm = { name: 'ECDSA', namedCurve: 'P-256' };\n            keyUsages = ['sign', 'verify'];\n            break;\n        case 'ES384':\n            algorithm = { name: 'ECDSA', namedCurve: 'P-384' };\n            keyUsages = ['sign', 'verify'];\n            break;\n        case 'ES512':\n            algorithm = { name: 'ECDSA', namedCurve: 'P-521' };\n            keyUsages = ['sign', 'verify'];\n            break;\n        case 'Ed25519':\n        case 'EdDSA': {\n            keyUsages = ['sign', 'verify'];\n            algorithm = { name: 'Ed25519' };\n            break;\n        }\n        case 'ML-DSA-44':\n        case 'ML-DSA-65':\n        case 'ML-DSA-87': {\n            keyUsages = ['sign', 'verify'];\n            algorithm = { name: alg };\n            break;\n        }\n        case 'ECDH-ES':\n        case 'ECDH-ES+A128KW':\n        case 'ECDH-ES+A192KW':\n        case 'ECDH-ES+A256KW': {\n            keyUsages = ['deriveBits'];\n            const crv = options?.crv ?? 'P-256';\n            switch (crv) {\n                case 'P-256':\n                case 'P-384':\n                case 'P-521': {\n                    algorithm = { name: 'ECDH', namedCurve: crv };\n                    break;\n                }\n                case 'X25519':\n                    algorithm = { name: 'X25519' };\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, and X25519');\n            }\n            break;\n        }\n        default:\n            throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n    }\n    return crypto.subtle.generateKey(algorithm, options?.extractable ?? false, keyUsages);\n}\n","import { entityKind } from \"./entity.js\";\nclass ConsoleLogWriter {\n  static [entityKind] = \"ConsoleLogWriter\";\n  write(message) {\n    console.log(message);\n  }\n}\nclass DefaultLogger {\n  static [entityKind] = \"DefaultLogger\";\n  writer;\n  constructor(config) {\n    this.writer = config?.writer ?? new ConsoleLogWriter();\n  }\n  logQuery(query, params) {\n    const stringifiedParams = params.map((p) => {\n      try {\n        return JSON.stringify(p);\n      } catch {\n        return String(p);\n      }\n    });\n    const paramsStr = stringifiedParams.length ? ` -- params: [${stringifiedParams.join(\", \")}]` : \"\";\n    this.writer.write(`Query: ${query}${paramsStr}`);\n  }\n}\nclass NoopLogger {\n  static [entityKind] = \"NoopLogger\";\n  logQuery() {\n  }\n}\nexport {\n  ConsoleLogWriter,\n  DefaultLogger,\n  NoopLogger\n};\n//# sourceMappingURL=logger.js.map","import { entityKind } from \"./entity.js\";\nclass QueryPromise {\n  static [entityKind] = \"QueryPromise\";\n  [Symbol.toStringTag] = \"QueryPromise\";\n  catch(onRejected) {\n    return this.then(void 0, onRejected);\n  }\n  finally(onFinally) {\n    return this.then(\n      (value) => {\n        onFinally?.();\n        return value;\n      },\n      (reason) => {\n        onFinally?.();\n        throw reason;\n      }\n    );\n  }\n  then(onFulfilled, onRejected) {\n    return this.execute().then(onFulfilled, onRejected);\n  }\n}\nexport {\n  QueryPromise\n};\n//# sourceMappingURL=query-promise.js.map","import { entityKind } from \"../entity.js\";\nclass CheckBuilder {\n  constructor(name, value) {\n    this.name = name;\n    this.value = value;\n  }\n  static [entityKind] = \"PgCheckBuilder\";\n  brand;\n  /** @internal */\n  build(table) {\n    return new Check(table, this);\n  }\n}\nclass Check {\n  constructor(table, builder) {\n    this.table = table;\n    this.name = builder.name;\n    this.value = builder.value;\n  }\n  static [entityKind] = \"PgCheck\";\n  name;\n  value;\n}\nfunction check(name, value) {\n  return new CheckBuilder(name, value);\n}\nexport {\n  Check,\n  CheckBuilder,\n  check\n};\n//# sourceMappingURL=checks.js.map","import { entityKind } from \"../entity.js\";\nclass PgPolicy {\n  constructor(name, config) {\n    this.name = name;\n    if (config) {\n      this.as = config.as;\n      this.for = config.for;\n      this.to = config.to;\n      this.using = config.using;\n      this.withCheck = config.withCheck;\n    }\n  }\n  static [entityKind] = \"PgPolicy\";\n  as;\n  for;\n  to;\n  using;\n  withCheck;\n  /** @internal */\n  _linkedTable;\n  link(table) {\n    this._linkedTable = table;\n    return this;\n  }\n}\nfunction pgPolicy(name, config) {\n  return new PgPolicy(name, config);\n}\nexport {\n  PgPolicy,\n  pgPolicy\n};\n//# sourceMappingURL=policies.js.map","import { entityKind } from \"./entity.js\";\nclass DrizzleError extends Error {\n  static [entityKind] = \"DrizzleError\";\n  constructor({ message, cause }) {\n    super(message);\n    this.name = \"DrizzleError\";\n    this.cause = cause;\n  }\n}\nclass DrizzleQueryError extends Error {\n  constructor(query, params, cause) {\n    super(`Failed query: ${query}\nparams: ${params}`);\n    this.query = query;\n    this.params = params;\n    this.cause = cause;\n    Error.captureStackTrace(this, DrizzleQueryError);\n    if (cause) this.cause = cause;\n  }\n}\nclass TransactionRollbackError extends DrizzleError {\n  static [entityKind] = \"TransactionRollbackError\";\n  constructor() {\n    super({ message: \"Rollback\" });\n  }\n}\nexport {\n  DrizzleError,\n  DrizzleQueryError,\n  TransactionRollbackError\n};\n//# sourceMappingURL=errors.js.map","import { entityKind } from \"../entity.js\";\nclass TypedQueryBuilder {\n  static [entityKind] = \"TypedQueryBuilder\";\n  /** @internal */\n  getSelectedFields() {\n    return this._.selectedFields;\n  }\n}\nexport {\n  TypedQueryBuilder\n};\n//# sourceMappingURL=query-builder.js.map","import { hexHash } from '../../hash';\nexport function computeCacheBustingSearchParam(prefetchHeader, segmentPrefetchHeader, stateTreeHeader, nextUrlHeader) {\n    if ((prefetchHeader === undefined || prefetchHeader === '0') && segmentPrefetchHeader === undefined && stateTreeHeader === undefined && nextUrlHeader === undefined) {\n        return '';\n    }\n    return hexHash([\n        prefetchHeader || '0',\n        segmentPrefetchHeader || '0',\n        stateTreeHeader || '0',\n        nextUrlHeader || '0'\n    ].join(','));\n}\n\n//# sourceMappingURL=cache-busting-search-param.js.map","// FIXME: (wyattjoh) this is a temporary solution to allow us to pass data between bundled modules\nexport const NEXT_REQUEST_META = Symbol.for('NextInternalRequestMeta');\nexport function getRequestMeta(req, key) {\n    const meta = req[NEXT_REQUEST_META] || {};\n    return typeof key === 'string' ? meta[key] : meta;\n}\n/**\n * Sets the request metadata.\n *\n * @param req the request to set the metadata on\n * @param meta the metadata to set\n * @returns the mutated request metadata\n */ export function setRequestMeta(req, meta) {\n    req[NEXT_REQUEST_META] = meta;\n    return meta;\n}\n/**\n * Adds a value to the request metadata.\n *\n * @param request the request to mutate\n * @param key the key to set\n * @param value the value to set\n * @returns the mutated request metadata\n */ export function addRequestMeta(request, key, value) {\n    const meta = getRequestMeta(request);\n    meta[key] = value;\n    return setRequestMeta(request, meta);\n}\n/**\n * Removes a key from the request metadata.\n *\n * @param request the request to mutate\n * @param key the key to remove\n * @returns the mutated request metadata\n */ export function removeRequestMeta(request, key) {\n    const meta = getRequestMeta(request);\n    delete meta[key];\n    return setRequestMeta(request, meta);\n}\n\n//# sourceMappingURL=request-meta.js.map","import { CACHE_ONE_YEAR } from '../../lib/constants';\nexport function getCacheControlHeader({ revalidate, expire }) {\n    const swrHeader = typeof revalidate === 'number' && expire !== undefined && revalidate < expire ? `, stale-while-revalidate=${expire - revalidate}` : '';\n    if (revalidate === 0) {\n        return 'private, no-cache, no-store, max-age=0, must-revalidate';\n    } else if (typeof revalidate === 'number') {\n        return `s-maxage=${revalidate}${swrHeader}`;\n    }\n    return `s-maxage=${CACHE_ONE_YEAR}${swrHeader}`;\n}\n\n//# sourceMappingURL=cache-control.js.map","import { entityKind } from \"../entity.js\";\nimport { TableName } from \"../table.utils.js\";\nfunction unique(name) {\n  return new UniqueOnConstraintBuilder(name);\n}\nfunction uniqueKeyName(table, columns) {\n  return `${table[TableName]}_${columns.join(\"_\")}_unique`;\n}\nclass UniqueConstraintBuilder {\n  constructor(columns, name) {\n    this.name = name;\n    this.columns = columns;\n  }\n  static [entityKind] = \"PgUniqueConstraintBuilder\";\n  /** @internal */\n  columns;\n  /** @internal */\n  nullsNotDistinctConfig = false;\n  nullsNotDistinct() {\n    this.nullsNotDistinctConfig = true;\n    return this;\n  }\n  /** @internal */\n  build(table) {\n    return new UniqueConstraint(table, this.columns, this.nullsNotDistinctConfig, this.name);\n  }\n}\nclass UniqueOnConstraintBuilder {\n  static [entityKind] = \"PgUniqueOnConstraintBuilder\";\n  /** @internal */\n  name;\n  constructor(name) {\n    this.name = name;\n  }\n  on(...columns) {\n    return new UniqueConstraintBuilder(columns, this.name);\n  }\n}\nclass UniqueConstraint {\n  constructor(table, columns, nullsNotDistinct, name) {\n    this.table = table;\n    this.columns = columns;\n    this.name = name ?? uniqueKeyName(this.table, this.columns.map((column) => column.name));\n    this.nullsNotDistinct = nullsNotDistinct;\n  }\n  static [entityKind] = \"PgUniqueConstraint\";\n  columns;\n  name;\n  nullsNotDistinct = false;\n  getName() {\n    return this.name;\n  }\n}\nexport {\n  UniqueConstraint,\n  UniqueConstraintBuilder,\n  UniqueOnConstraintBuilder,\n  unique,\n  uniqueKeyName\n};\n//# sourceMappingURL=unique-constraint.js.map","import { entityKind } from \"./entity.js\";\nimport { TableName } from \"./table.utils.js\";\nconst Schema = Symbol.for(\"drizzle:Schema\");\nconst Columns = Symbol.for(\"drizzle:Columns\");\nconst ExtraConfigColumns = Symbol.for(\"drizzle:ExtraConfigColumns\");\nconst OriginalName = Symbol.for(\"drizzle:OriginalName\");\nconst BaseName = Symbol.for(\"drizzle:BaseName\");\nconst IsAlias = Symbol.for(\"drizzle:IsAlias\");\nconst ExtraConfigBuilder = Symbol.for(\"drizzle:ExtraConfigBuilder\");\nconst IsDrizzleTable = Symbol.for(\"drizzle:IsDrizzleTable\");\nclass Table {\n  static [entityKind] = \"Table\";\n  /** @internal */\n  static Symbol = {\n    Name: TableName,\n    Schema,\n    OriginalName,\n    Columns,\n    ExtraConfigColumns,\n    BaseName,\n    IsAlias,\n    ExtraConfigBuilder\n  };\n  /**\n   * @internal\n   * Can be changed if the table is aliased.\n   */\n  [TableName];\n  /**\n   * @internal\n   * Used to store the original name of the table, before any aliasing.\n   */\n  [OriginalName];\n  /** @internal */\n  [Schema];\n  /** @internal */\n  [Columns];\n  /** @internal */\n  [ExtraConfigColumns];\n  /**\n   *  @internal\n   * Used to store the table name before the transformation via the `tableCreator` functions.\n   */\n  [BaseName];\n  /** @internal */\n  [IsAlias] = false;\n  /** @internal */\n  [IsDrizzleTable] = true;\n  /** @internal */\n  [ExtraConfigBuilder] = void 0;\n  constructor(name, schema, baseName) {\n    this[TableName] = this[OriginalName] = name;\n    this[Schema] = schema;\n    this[BaseName] = baseName;\n  }\n}\nfunction isTable(table) {\n  return typeof table === \"object\" && table !== null && IsDrizzleTable in table;\n}\nfunction getTableName(table) {\n  return table[TableName];\n}\nfunction getTableUniqueName(table) {\n  return `${table[Schema] ?? \"public\"}.${table[TableName]}`;\n}\nexport {\n  BaseName,\n  Columns,\n  ExtraConfigBuilder,\n  ExtraConfigColumns,\n  IsAlias,\n  OriginalName,\n  Schema,\n  Table,\n  getTableName,\n  getTableUniqueName,\n  isTable\n};\n//# sourceMappingURL=table.js.map","import { t as createKyselyAdapter } from \"./dialect-D9ZUZA4J.mjs\";\nimport { a as getAuthTables, n as initGetFieldName, t as initGetModelName } from \"./get-model-name-D4DUV7S2.mjs\";\nimport { t as generateId } from \"./utils-db7gNqd-.mjs\";\nimport { l as parseUserOutput, o as parseSessionInput, s as parseSessionOutput, u as getDate } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as getIp } from \"./get-request-ip-D6st-mto.mjs\";\nimport { t as safeJSONParse } from \"./json-CnHxKYpj.mjs\";\nimport { getCurrentAdapter, getCurrentAuthContext, runWithTransaction } from \"@better-auth/core/context\";\nimport { createLogger, logger } from \"@better-auth/core/env\";\nimport { BetterAuthError } from \"@better-auth/core/error\";\nimport { sql } from \"kysely\";\nimport * as z from \"zod\";\n\n//#region src/db/adapter-base.ts\nasync function getBaseAdapter(options, handleDirectDatabase) {\n\tlet adapter;\n\tif (!options.database) {\n\t\tconst tables = getAuthTables(options);\n\t\tconst memoryDB = Object.keys(tables).reduce((acc, key) => {\n\t\t\tacc[key] = [];\n\t\t\treturn acc;\n\t\t}, {});\n\t\tconst { memoryAdapter } = await import(\"./adapters/memory-adapter/index.mjs\");\n\t\tadapter = memoryAdapter(memoryDB)(options);\n\t} else if (typeof options.database === \"function\") adapter = options.database(options);\n\telse adapter = await handleDirectDatabase(options);\n\tif (!adapter.transaction) {\n\t\tlogger.warn(\"Adapter does not correctly implement transaction function, patching it automatically. Please update your adapter implementation.\");\n\t\tadapter.transaction = async (cb) => {\n\t\t\treturn cb(adapter);\n\t\t};\n\t}\n\treturn adapter;\n}\n\n//#endregion\n//#region src/db/adapter-kysely.ts\nasync function getAdapter(options) {\n\treturn getBaseAdapter(options, async (opts) => {\n\t\tconst { createKyselyAdapter: createKyselyAdapter$1 } = await import(\"./adapters/kysely-adapter/index.mjs\");\n\t\tconst { kysely, databaseType, transaction } = await createKyselyAdapter$1(opts);\n\t\tif (!kysely) throw new BetterAuthError(\"Failed to initialize database adapter\");\n\t\tconst { kyselyAdapter } = await import(\"./adapters/kysely-adapter/index.mjs\");\n\t\treturn kyselyAdapter(kysely, {\n\t\t\ttype: databaseType || \"sqlite\",\n\t\t\tdebugLogs: opts.database && \"debugLogs\" in opts.database ? opts.database.debugLogs : false,\n\t\t\ttransaction\n\t\t})(opts);\n\t});\n}\n\n//#endregion\n//#region src/db/field.ts\nconst createFieldAttribute = (type, config) => {\n\treturn {\n\t\ttype,\n\t\t...config\n\t};\n};\n\n//#endregion\n//#region src/db/field-converter.ts\nfunction convertToDB(fields, values) {\n\tlet result = values.id ? { id: values.id } : {};\n\tfor (const key in fields) {\n\t\tconst field = fields[key];\n\t\tconst value = values[key];\n\t\tif (value === void 0) continue;\n\t\tresult[field.fieldName || key] = value;\n\t}\n\treturn result;\n}\nfunction convertFromDB(fields, values) {\n\tif (!values) return null;\n\tlet result = { id: values.id };\n\tfor (const [key, value] of Object.entries(fields)) result[key] = values[value.fieldName || key];\n\treturn result;\n}\n\n//#endregion\n//#region src/db/with-hooks.ts\nfunction getWithHooks(adapter, ctx) {\n\tconst hooks = ctx.hooks;\n\tasync function createWithHooks(data, model, customCreateFn) {\n\t\tconst context = await getCurrentAuthContext();\n\t\tlet actualData = data;\n\t\tfor (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.create?.before;\n\t\t\tif (toRun) {\n\t\t\t\tconst result = await toRun(actualData, context);\n\t\t\t\tif (result === false) return null;\n\t\t\t\tif (typeof result === \"object\" && \"data\" in result) actualData = {\n\t\t\t\t\t...actualData,\n\t\t\t\t\t...result.data\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tconst customCreated = customCreateFn ? await customCreateFn.fn(actualData) : null;\n\t\tconst created = !customCreateFn || customCreateFn.executeMainFn ? await (await getCurrentAdapter(adapter)).create({\n\t\t\tmodel,\n\t\t\tdata: actualData,\n\t\t\tforceAllowId: true\n\t\t}) : customCreated;\n\t\tfor (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.create?.after;\n\t\t\tif (toRun) await toRun(created, context);\n\t\t}\n\t\treturn created;\n\t}\n\tasync function updateWithHooks(data, where, model, customUpdateFn) {\n\t\tconst context = await getCurrentAuthContext();\n\t\tlet actualData = data;\n\t\tfor (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.update?.before;\n\t\t\tif (toRun) {\n\t\t\t\tconst result = await toRun(data, context);\n\t\t\t\tif (result === false) return null;\n\t\t\t\tif (typeof result === \"object\" && \"data\" in result) actualData = {\n\t\t\t\t\t...actualData,\n\t\t\t\t\t...result.data\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tconst customUpdated = customUpdateFn ? await customUpdateFn.fn(actualData) : null;\n\t\tconst updated = !customUpdateFn || customUpdateFn.executeMainFn ? await (await getCurrentAdapter(adapter)).update({\n\t\t\tmodel,\n\t\t\tupdate: actualData,\n\t\t\twhere\n\t\t}) : customUpdated;\n\t\tfor (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.update?.after;\n\t\t\tif (toRun) await toRun(updated, context);\n\t\t}\n\t\treturn updated;\n\t}\n\tasync function updateManyWithHooks(data, where, model, customUpdateFn) {\n\t\tconst context = await getCurrentAuthContext();\n\t\tlet actualData = data;\n\t\tfor (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.update?.before;\n\t\t\tif (toRun) {\n\t\t\t\tconst result = await toRun(data, context);\n\t\t\t\tif (result === false) return null;\n\t\t\t\tif (typeof result === \"object\" && \"data\" in result) actualData = {\n\t\t\t\t\t...actualData,\n\t\t\t\t\t...result.data\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tconst customUpdated = customUpdateFn ? await customUpdateFn.fn(actualData) : null;\n\t\tconst updated = !customUpdateFn || customUpdateFn.executeMainFn ? await (await getCurrentAdapter(adapter)).updateMany({\n\t\t\tmodel,\n\t\t\tupdate: actualData,\n\t\t\twhere\n\t\t}) : customUpdated;\n\t\tfor (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.update?.after;\n\t\t\tif (toRun) await toRun(updated, context);\n\t\t}\n\t\treturn updated;\n\t}\n\tasync function deleteWithHooks(where, model, customDeleteFn) {\n\t\tconst context = await getCurrentAuthContext();\n\t\tlet entityToDelete = null;\n\t\ttry {\n\t\t\tentityToDelete = (await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\tmodel,\n\t\t\t\twhere,\n\t\t\t\tlimit: 1\n\t\t\t}))[0] || null;\n\t\t} catch (error) {}\n\t\tif (entityToDelete) for (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.delete?.before;\n\t\t\tif (toRun) {\n\t\t\t\tif (await toRun(entityToDelete, context) === false) return null;\n\t\t\t}\n\t\t}\n\t\tconst customDeleted = customDeleteFn ? await customDeleteFn.fn(where) : null;\n\t\tconst deleted = !customDeleteFn || customDeleteFn.executeMainFn ? await (await getCurrentAdapter(adapter)).delete({\n\t\t\tmodel,\n\t\t\twhere\n\t\t}) : customDeleted;\n\t\tif (entityToDelete) for (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.delete?.after;\n\t\t\tif (toRun) await toRun(entityToDelete, context);\n\t\t}\n\t\treturn deleted;\n\t}\n\tasync function deleteManyWithHooks(where, model, customDeleteFn) {\n\t\tconst context = await getCurrentAuthContext();\n\t\tlet entitiesToDelete = [];\n\t\ttry {\n\t\t\tentitiesToDelete = await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\tmodel,\n\t\t\t\twhere\n\t\t\t});\n\t\t} catch (error) {}\n\t\tfor (const entity of entitiesToDelete) for (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.delete?.before;\n\t\t\tif (toRun) {\n\t\t\t\tif (await toRun(entity, context) === false) return null;\n\t\t\t}\n\t\t}\n\t\tconst customDeleted = customDeleteFn ? await customDeleteFn.fn(where) : null;\n\t\tconst deleted = !customDeleteFn || customDeleteFn.executeMainFn ? await (await getCurrentAdapter(adapter)).deleteMany({\n\t\t\tmodel,\n\t\t\twhere\n\t\t}) : customDeleted;\n\t\tfor (const entity of entitiesToDelete) for (const hook of hooks || []) {\n\t\t\tconst toRun = hook[model]?.delete?.after;\n\t\t\tif (toRun) await toRun(entity, context);\n\t\t}\n\t\treturn deleted;\n\t}\n\treturn {\n\t\tcreateWithHooks,\n\t\tupdateWithHooks,\n\t\tupdateManyWithHooks,\n\t\tdeleteWithHooks,\n\t\tdeleteManyWithHooks\n\t};\n}\n\n//#endregion\n//#region src/db/internal-adapter.ts\nconst createInternalAdapter = (adapter, ctx) => {\n\tconst logger$1 = ctx.logger;\n\tconst options = ctx.options;\n\tconst secondaryStorage = options.secondaryStorage;\n\tconst sessionExpiration = options.session?.expiresIn || 3600 * 24 * 7;\n\tconst { createWithHooks, updateWithHooks, updateManyWithHooks, deleteWithHooks, deleteManyWithHooks } = getWithHooks(adapter, ctx);\n\tasync function refreshUserSessions(user) {\n\t\tif (!secondaryStorage) return;\n\t\tconst listRaw = await secondaryStorage.get(`active-sessions-${user.id}`);\n\t\tif (!listRaw) return;\n\t\tconst now = Date.now();\n\t\tconst validSessions = (safeJSONParse(listRaw) || []).filter((s) => s.expiresAt > now);\n\t\tawait Promise.all(validSessions.map(async ({ token }) => {\n\t\t\tconst cached = await secondaryStorage.get(token);\n\t\t\tif (!cached) return;\n\t\t\tconst parsed = safeJSONParse(cached);\n\t\t\tif (!parsed) return;\n\t\t\tconst sessionTTL = Math.max(Math.floor(new Date(parsed.session.expiresAt).getTime() - now) / 1e3, 0);\n\t\t\tawait secondaryStorage.set(token, JSON.stringify({\n\t\t\t\tsession: parsed.session,\n\t\t\t\tuser\n\t\t\t}), Math.floor(sessionTTL));\n\t\t}));\n\t}\n\treturn {\n\t\tcreateOAuthUser: async (user, account) => {\n\t\t\treturn runWithTransaction(adapter, async () => {\n\t\t\t\tconst createdUser = await createWithHooks({\n\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t...user\n\t\t\t\t}, \"user\", void 0);\n\t\t\t\treturn {\n\t\t\t\t\tuser: createdUser,\n\t\t\t\t\taccount: await createWithHooks({\n\t\t\t\t\t\t...account,\n\t\t\t\t\t\tuserId: createdUser.id,\n\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t}, \"account\", void 0)\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\t\tcreateUser: async (user) => {\n\t\t\treturn await createWithHooks({\n\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t...user,\n\t\t\t\temail: user.email?.toLowerCase()\n\t\t\t}, \"user\", void 0);\n\t\t},\n\t\tcreateAccount: async (account) => {\n\t\t\treturn await createWithHooks({\n\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t...account\n\t\t\t}, \"account\", void 0);\n\t\t},\n\t\tlistSessions: async (userId) => {\n\t\t\tif (secondaryStorage) {\n\t\t\t\tconst currentList = await secondaryStorage.get(`active-sessions-${userId}`);\n\t\t\t\tif (!currentList) return [];\n\t\t\t\tconst list = safeJSONParse(currentList) || [];\n\t\t\t\tconst now = Date.now();\n\t\t\t\tconst validSessions = list.filter((s) => s.expiresAt > now);\n\t\t\t\tconst sessions = [];\n\t\t\t\tfor (const session of validSessions) {\n\t\t\t\t\tconst sessionStringified = await secondaryStorage.get(session.token);\n\t\t\t\t\tif (sessionStringified) {\n\t\t\t\t\t\tconst s = safeJSONParse(sessionStringified);\n\t\t\t\t\t\tif (!s) return [];\n\t\t\t\t\t\tconst parsedSession = parseSessionOutput(ctx.options, {\n\t\t\t\t\t\t\t...s.session,\n\t\t\t\t\t\t\texpiresAt: new Date(s.session.expiresAt)\n\t\t\t\t\t\t});\n\t\t\t\t\t\tsessions.push(parsedSession);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn sessions;\n\t\t\t}\n\t\t\treturn await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\tmodel: \"session\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\tvalue: userId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tlistUsers: async (limit, offset, sortBy, where) => {\n\t\t\treturn await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\tmodel: \"user\",\n\t\t\t\tlimit,\n\t\t\t\toffset,\n\t\t\t\tsortBy,\n\t\t\t\twhere\n\t\t\t});\n\t\t},\n\t\tcountTotalUsers: async (where) => {\n\t\t\tconst total = await (await getCurrentAdapter(adapter)).count({\n\t\t\t\tmodel: \"user\",\n\t\t\t\twhere\n\t\t\t});\n\t\t\tif (typeof total === \"string\") return parseInt(total);\n\t\t\treturn total;\n\t\t},\n\t\tdeleteUser: async (userId) => {\n\t\t\tif (secondaryStorage) await secondaryStorage.delete(`active-sessions-${userId}`);\n\t\t\tif (!secondaryStorage || options.session?.storeSessionInDatabase) await deleteManyWithHooks([{\n\t\t\t\tfield: \"userId\",\n\t\t\t\tvalue: userId\n\t\t\t}], \"session\", void 0);\n\t\t\tawait deleteManyWithHooks([{\n\t\t\t\tfield: \"userId\",\n\t\t\t\tvalue: userId\n\t\t\t}], \"account\", void 0);\n\t\t\tawait deleteWithHooks([{\n\t\t\t\tfield: \"id\",\n\t\t\t\tvalue: userId\n\t\t\t}], \"user\", void 0);\n\t\t},\n\t\tcreateSession: async (userId, dontRememberMe, override, overrideAll) => {\n\t\t\tconst ctx$1 = await getCurrentAuthContext().catch(() => null);\n\t\t\tconst headers = ctx$1?.headers || ctx$1?.request?.headers;\n\t\t\tconst { id: _, ...rest } = override || {};\n\t\t\tconst defaultAdditionalFields = parseSessionInput(ctx$1?.context.options ?? options, {});\n\t\t\tconst data = {\n\t\t\t\tipAddress: ctx$1?.request || ctx$1?.headers ? getIp(ctx$1?.request || ctx$1?.headers, ctx$1?.context.options) || \"\" : \"\",\n\t\t\t\tuserAgent: headers?.get(\"user-agent\") || \"\",\n\t\t\t\t...rest,\n\t\t\t\texpiresAt: dontRememberMe ? getDate(3600 * 24, \"sec\") : getDate(sessionExpiration, \"sec\"),\n\t\t\t\tuserId,\n\t\t\t\ttoken: generateId(32),\n\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t...defaultAdditionalFields,\n\t\t\t\t...overrideAll ? rest : {}\n\t\t\t};\n\t\t\treturn await createWithHooks(data, \"session\", secondaryStorage ? {\n\t\t\t\tfn: async (sessionData) => {\n\t\t\t\t\t/**\n\t\t\t\t\t* store the session token for the user\n\t\t\t\t\t* so we can retrieve it later for listing sessions\n\t\t\t\t\t*/\n\t\t\t\t\tconst currentList = await secondaryStorage.get(`active-sessions-${userId}`);\n\t\t\t\t\tlet list = [];\n\t\t\t\t\tconst now = Date.now();\n\t\t\t\t\tif (currentList) {\n\t\t\t\t\t\tlist = safeJSONParse(currentList) || [];\n\t\t\t\t\t\tlist = list.filter((session) => session.expiresAt > now);\n\t\t\t\t\t}\n\t\t\t\t\tconst sorted = list.sort((a, b) => a.expiresAt - b.expiresAt);\n\t\t\t\t\tlet furthestSessionExp = sorted.at(-1)?.expiresAt;\n\t\t\t\t\tsorted.push({\n\t\t\t\t\t\ttoken: data.token,\n\t\t\t\t\t\texpiresAt: data.expiresAt.getTime()\n\t\t\t\t\t});\n\t\t\t\t\tif (!furthestSessionExp || furthestSessionExp < data.expiresAt.getTime()) furthestSessionExp = data.expiresAt.getTime();\n\t\t\t\t\tconst furthestSessionTTL = Math.max(Math.floor((furthestSessionExp - now) / 1e3), 0);\n\t\t\t\t\tif (furthestSessionTTL > 0) await secondaryStorage.set(`active-sessions-${userId}`, JSON.stringify(sorted), furthestSessionTTL);\n\t\t\t\t\tconst user = await adapter.findOne({\n\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\tvalue: userId\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t\tconst sessionTTL = Math.max(Math.floor((data.expiresAt.getTime() - now) / 1e3), 0);\n\t\t\t\t\tif (sessionTTL > 0) await secondaryStorage.set(data.token, JSON.stringify({\n\t\t\t\t\t\tsession: sessionData,\n\t\t\t\t\t\tuser\n\t\t\t\t\t}), sessionTTL);\n\t\t\t\t\treturn sessionData;\n\t\t\t\t},\n\t\t\t\texecuteMainFn: options.session?.storeSessionInDatabase\n\t\t\t} : void 0);\n\t\t},\n\t\tfindSession: async (token) => {\n\t\t\tif (secondaryStorage) {\n\t\t\t\tconst sessionStringified = await secondaryStorage.get(token);\n\t\t\t\tif (!sessionStringified && !options.session?.storeSessionInDatabase) return null;\n\t\t\t\tif (sessionStringified) {\n\t\t\t\t\tconst s = safeJSONParse(sessionStringified);\n\t\t\t\t\tif (!s) return null;\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsession: parseSessionOutput(ctx.options, {\n\t\t\t\t\t\t\t...s.session,\n\t\t\t\t\t\t\texpiresAt: new Date(s.session.expiresAt),\n\t\t\t\t\t\t\tcreatedAt: new Date(s.session.createdAt),\n\t\t\t\t\t\t\tupdatedAt: new Date(s.session.updatedAt)\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tuser: parseUserOutput(ctx.options, {\n\t\t\t\t\t\t\t...s.user,\n\t\t\t\t\t\t\tcreatedAt: new Date(s.user.createdAt),\n\t\t\t\t\t\t\tupdatedAt: new Date(s.user.updatedAt)\n\t\t\t\t\t\t})\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst result = await (await getCurrentAdapter(adapter)).findOne({\n\t\t\t\tmodel: \"session\",\n\t\t\t\twhere: [{\n\t\t\t\t\tvalue: token,\n\t\t\t\t\tfield: \"token\"\n\t\t\t\t}],\n\t\t\t\tjoin: { user: true }\n\t\t\t});\n\t\t\tif (!result) return null;\n\t\t\tconst { user, ...session } = result;\n\t\t\tif (!user) return null;\n\t\t\treturn {\n\t\t\t\tsession: parseSessionOutput(ctx.options, session),\n\t\t\t\tuser: parseUserOutput(ctx.options, user)\n\t\t\t};\n\t\t},\n\t\tfindSessions: async (sessionTokens) => {\n\t\t\tif (secondaryStorage) {\n\t\t\t\tconst sessions$1 = [];\n\t\t\t\tfor (const sessionToken of sessionTokens) {\n\t\t\t\t\tconst sessionStringified = await secondaryStorage.get(sessionToken);\n\t\t\t\t\tif (sessionStringified) {\n\t\t\t\t\t\tconst s = safeJSONParse(sessionStringified);\n\t\t\t\t\t\tif (!s) return [];\n\t\t\t\t\t\tconst session = {\n\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\t...s.session,\n\t\t\t\t\t\t\t\texpiresAt: new Date(s.session.expiresAt)\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t...s.user,\n\t\t\t\t\t\t\t\tcreatedAt: new Date(s.user.createdAt),\n\t\t\t\t\t\t\t\tupdatedAt: new Date(s.user.updatedAt)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tsessions$1.push(session);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn sessions$1;\n\t\t\t}\n\t\t\tconst sessions = await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\tmodel: \"session\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"token\",\n\t\t\t\t\tvalue: sessionTokens,\n\t\t\t\t\toperator: \"in\"\n\t\t\t\t}],\n\t\t\t\tjoin: { user: true }\n\t\t\t});\n\t\t\tif (!sessions.length) return [];\n\t\t\tif (sessions.some((session) => !session.user)) return [];\n\t\t\treturn sessions.map((_session) => {\n\t\t\t\tconst { user, ...session } = _session;\n\t\t\t\treturn {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\t\tupdateSession: async (sessionToken, session) => {\n\t\t\treturn await updateWithHooks(session, [{\n\t\t\t\tfield: \"token\",\n\t\t\t\tvalue: sessionToken\n\t\t\t}], \"session\", secondaryStorage ? {\n\t\t\t\tasync fn(data) {\n\t\t\t\t\tconst currentSession = await secondaryStorage.get(sessionToken);\n\t\t\t\t\tlet updatedSession = null;\n\t\t\t\t\tif (currentSession) {\n\t\t\t\t\t\tconst parsedSession = safeJSONParse(currentSession);\n\t\t\t\t\t\tif (!parsedSession) return null;\n\t\t\t\t\t\tupdatedSession = {\n\t\t\t\t\t\t\t...parsedSession.session,\n\t\t\t\t\t\t\t...data\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn updatedSession;\n\t\t\t\t\t} else return null;\n\t\t\t\t},\n\t\t\t\texecuteMainFn: options.session?.storeSessionInDatabase\n\t\t\t} : void 0);\n\t\t},\n\t\tdeleteSession: async (token) => {\n\t\t\tif (secondaryStorage) {\n\t\t\t\tconst data = await secondaryStorage.get(token);\n\t\t\t\tif (data) {\n\t\t\t\t\tconst { session } = safeJSONParse(data) ?? {};\n\t\t\t\t\tif (!session) {\n\t\t\t\t\t\tlogger$1.error(\"Session not found in secondary storage\");\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst userId = session.userId;\n\t\t\t\t\tconst currentList = await secondaryStorage.get(`active-sessions-${userId}`);\n\t\t\t\t\tif (currentList) {\n\t\t\t\t\t\tlet list = safeJSONParse(currentList) || [];\n\t\t\t\t\t\tconst now = Date.now();\n\t\t\t\t\t\tconst filtered = list.filter((session$1) => session$1.expiresAt > now && session$1.token !== token);\n\t\t\t\t\t\tconst furthestSessionExp = filtered.sort((a, b) => a.expiresAt - b.expiresAt).at(-1)?.expiresAt;\n\t\t\t\t\t\tif (filtered.length > 0 && furthestSessionExp && furthestSessionExp > Date.now()) await secondaryStorage.set(`active-sessions-${userId}`, JSON.stringify(filtered), Math.floor((furthestSessionExp - now) / 1e3));\n\t\t\t\t\t\telse await secondaryStorage.delete(`active-sessions-${userId}`);\n\t\t\t\t\t} else logger$1.error(\"Active sessions list not found in secondary storage\");\n\t\t\t\t}\n\t\t\t\tawait secondaryStorage.delete(token);\n\t\t\t\tif (!options.session?.storeSessionInDatabase || ctx.options.session?.preserveSessionInDatabase) return;\n\t\t\t}\n\t\t\tawait (await getCurrentAdapter(adapter)).delete({\n\t\t\t\tmodel: \"session\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"token\",\n\t\t\t\t\tvalue: token\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tdeleteAccounts: async (userId) => {\n\t\t\tawait deleteManyWithHooks([{\n\t\t\t\tfield: \"userId\",\n\t\t\t\tvalue: userId\n\t\t\t}], \"account\", void 0);\n\t\t},\n\t\tdeleteAccount: async (accountId) => {\n\t\t\tawait deleteWithHooks([{\n\t\t\t\tfield: \"id\",\n\t\t\t\tvalue: accountId\n\t\t\t}], \"account\", void 0);\n\t\t},\n\t\tdeleteSessions: async (userIdOrSessionTokens) => {\n\t\t\tif (secondaryStorage) {\n\t\t\t\tif (typeof userIdOrSessionTokens === \"string\") {\n\t\t\t\t\tconst activeSession = await secondaryStorage.get(`active-sessions-${userIdOrSessionTokens}`);\n\t\t\t\t\tconst sessions = activeSession ? safeJSONParse(activeSession) : [];\n\t\t\t\t\tif (!sessions) return;\n\t\t\t\t\tfor (const session of sessions) await secondaryStorage.delete(session.token);\n\t\t\t\t} else for (const sessionToken of userIdOrSessionTokens) if (await secondaryStorage.get(sessionToken)) await secondaryStorage.delete(sessionToken);\n\t\t\t\tif (!options.session?.storeSessionInDatabase || ctx.options.session?.preserveSessionInDatabase) return;\n\t\t\t}\n\t\t\tawait deleteManyWithHooks([{\n\t\t\t\tfield: Array.isArray(userIdOrSessionTokens) ? \"token\" : \"userId\",\n\t\t\t\tvalue: userIdOrSessionTokens,\n\t\t\t\toperator: Array.isArray(userIdOrSessionTokens) ? \"in\" : void 0\n\t\t\t}], \"session\", void 0);\n\t\t},\n\t\tfindOAuthUser: async (email, accountId, providerId) => {\n\t\t\tconst account = await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\tmodel: \"account\",\n\t\t\t\twhere: [{\n\t\t\t\t\tvalue: accountId,\n\t\t\t\t\tfield: \"accountId\"\n\t\t\t\t}],\n\t\t\t\tjoin: { user: true }\n\t\t\t}).then((accounts) => {\n\t\t\t\treturn accounts.find((a) => a.providerId === providerId);\n\t\t\t});\n\t\t\tif (account) if (account.user) return {\n\t\t\t\tuser: account.user,\n\t\t\t\taccounts: [account]\n\t\t\t};\n\t\t\telse {\n\t\t\t\tconst user = await (await getCurrentAdapter(adapter)).findOne({\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tvalue: email.toLowerCase(),\n\t\t\t\t\t\tfield: \"email\"\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (user) return {\n\t\t\t\t\tuser,\n\t\t\t\t\taccounts: [account]\n\t\t\t\t};\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconst user = await (await getCurrentAdapter(adapter)).findOne({\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tvalue: email.toLowerCase(),\n\t\t\t\t\t\tfield: \"email\"\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (user) return {\n\t\t\t\t\tuser,\n\t\t\t\t\taccounts: await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\t\t\tmodel: \"account\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t\t\tfield: \"userId\"\n\t\t\t\t\t\t}]\n\t\t\t\t\t}) || []\n\t\t\t\t};\n\t\t\t\telse return null;\n\t\t\t}\n\t\t},\n\t\tfindUserByEmail: async (email, options$1) => {\n\t\t\tconst result = await (await getCurrentAdapter(adapter)).findOne({\n\t\t\t\tmodel: \"user\",\n\t\t\t\twhere: [{\n\t\t\t\t\tvalue: email.toLowerCase(),\n\t\t\t\t\tfield: \"email\"\n\t\t\t\t}],\n\t\t\t\tjoin: { ...options$1?.includeAccounts ? { account: true } : {} }\n\t\t\t});\n\t\t\tif (!result) return null;\n\t\t\tconst { account: accounts, ...user } = result;\n\t\t\treturn {\n\t\t\t\tuser,\n\t\t\t\taccounts: accounts ?? []\n\t\t\t};\n\t\t},\n\t\tfindUserById: async (userId) => {\n\t\t\tif (!userId) return null;\n\t\t\treturn await (await getCurrentAdapter(adapter)).findOne({\n\t\t\t\tmodel: \"user\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: userId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tlinkAccount: async (account) => {\n\t\t\treturn await createWithHooks({\n\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t...account\n\t\t\t}, \"account\", void 0);\n\t\t},\n\t\tupdateUser: async (userId, data) => {\n\t\t\tconst user = await updateWithHooks(data, [{\n\t\t\t\tfield: \"id\",\n\t\t\t\tvalue: userId\n\t\t\t}], \"user\", void 0);\n\t\t\tawait refreshUserSessions(user);\n\t\t\tawait refreshUserSessions(user);\n\t\t\treturn user;\n\t\t},\n\t\tupdateUserByEmail: async (email, data) => {\n\t\t\tconst user = await updateWithHooks(data, [{\n\t\t\t\tfield: \"email\",\n\t\t\t\tvalue: email.toLowerCase()\n\t\t\t}], \"user\", void 0);\n\t\t\tawait refreshUserSessions(user);\n\t\t\tawait refreshUserSessions(user);\n\t\t\treturn user;\n\t\t},\n\t\tupdatePassword: async (userId, password) => {\n\t\t\tawait updateManyWithHooks({ password }, [{\n\t\t\t\tfield: \"userId\",\n\t\t\t\tvalue: userId\n\t\t\t}, {\n\t\t\t\tfield: \"providerId\",\n\t\t\t\tvalue: \"credential\"\n\t\t\t}], \"account\", void 0);\n\t\t},\n\t\tfindAccounts: async (userId) => {\n\t\t\treturn await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\tmodel: \"account\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\tvalue: userId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tfindAccount: async (accountId) => {\n\t\t\treturn await (await getCurrentAdapter(adapter)).findOne({\n\t\t\t\tmodel: \"account\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"accountId\",\n\t\t\t\t\tvalue: accountId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tfindAccountByProviderId: async (accountId, providerId) => {\n\t\t\treturn await (await getCurrentAdapter(adapter)).findOne({\n\t\t\t\tmodel: \"account\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"accountId\",\n\t\t\t\t\tvalue: accountId\n\t\t\t\t}, {\n\t\t\t\t\tfield: \"providerId\",\n\t\t\t\t\tvalue: providerId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tfindAccountByUserId: async (userId) => {\n\t\t\treturn await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\tmodel: \"account\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\tvalue: userId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tupdateAccount: async (id, data) => {\n\t\t\treturn await updateWithHooks(data, [{\n\t\t\t\tfield: \"id\",\n\t\t\t\tvalue: id\n\t\t\t}], \"account\", void 0);\n\t\t},\n\t\tcreateVerificationValue: async (data) => {\n\t\t\treturn await createWithHooks({\n\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t...data\n\t\t\t}, \"verification\", void 0);\n\t\t},\n\t\tfindVerificationValue: async (identifier) => {\n\t\t\tconst verification = await (await getCurrentAdapter(adapter)).findMany({\n\t\t\t\tmodel: \"verification\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"identifier\",\n\t\t\t\t\tvalue: identifier\n\t\t\t\t}],\n\t\t\t\tsortBy: {\n\t\t\t\t\tfield: \"createdAt\",\n\t\t\t\t\tdirection: \"desc\"\n\t\t\t\t},\n\t\t\t\tlimit: 1\n\t\t\t});\n\t\t\tif (!options.verification?.disableCleanup) await (await getCurrentAdapter(adapter)).deleteMany({\n\t\t\t\tmodel: \"verification\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"expiresAt\",\n\t\t\t\t\tvalue: /* @__PURE__ */ new Date(),\n\t\t\t\t\toperator: \"lt\"\n\t\t\t\t}]\n\t\t\t});\n\t\t\treturn verification[0];\n\t\t},\n\t\tdeleteVerificationValue: async (id) => {\n\t\t\tawait (await getCurrentAdapter(adapter)).delete({\n\t\t\t\tmodel: \"verification\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: id\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tdeleteVerificationByIdentifier: async (identifier) => {\n\t\t\tawait (await getCurrentAdapter(adapter)).delete({\n\t\t\t\tmodel: \"verification\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"identifier\",\n\t\t\t\t\tvalue: identifier\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tupdateVerificationValue: async (id, data) => {\n\t\t\treturn await updateWithHooks(data, [{\n\t\t\t\tfield: \"id\",\n\t\t\t\tvalue: id\n\t\t\t}], \"verification\", void 0);\n\t\t}\n\t};\n};\n\n//#endregion\n//#region src/db/to-zod.ts\nfunction toZodSchema({ fields, isClientSide }) {\n\tconst zodFields = Object.keys(fields).reduce((acc, key) => {\n\t\tconst field = fields[key];\n\t\tif (!field) return acc;\n\t\tif (isClientSide && field.input === false) return acc;\n\t\tlet schema;\n\t\tif (field.type === \"json\") schema = z.json ? z.json() : z.any();\n\t\telse if (field.type === \"string[]\" || field.type === \"number[]\") schema = z.array(field.type === \"string[]\" ? z.string() : z.number());\n\t\telse if (Array.isArray(field.type)) schema = z.any();\n\t\telse schema = z[field.type]();\n\t\tif (field?.required === false) schema = schema.optional();\n\t\tif (field?.returned === false) return acc;\n\t\treturn {\n\t\t\t...acc,\n\t\t\t[key]: schema\n\t\t};\n\t}, {});\n\treturn z.object(zodFields);\n}\n\n//#endregion\n//#region src/db/get-schema.ts\nfunction getSchema(config) {\n\tconst tables = getAuthTables(config);\n\tlet schema = {};\n\tfor (const key in tables) {\n\t\tconst table = tables[key];\n\t\tconst fields = table.fields;\n\t\tlet actualFields = {};\n\t\tObject.entries(fields).forEach(([key$1, field]) => {\n\t\t\tactualFields[field.fieldName || key$1] = field;\n\t\t\tif (field.references) {\n\t\t\t\tconst refTable = tables[field.references.model];\n\t\t\t\tif (refTable) actualFields[field.fieldName || key$1].references = {\n\t\t\t\t\t...field.references,\n\t\t\t\t\tmodel: refTable.modelName,\n\t\t\t\t\tfield: field.references.field\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\tif (schema[table.modelName]) {\n\t\t\tschema[table.modelName].fields = {\n\t\t\t\t...schema[table.modelName].fields,\n\t\t\t\t...actualFields\n\t\t\t};\n\t\t\tcontinue;\n\t\t}\n\t\tschema[table.modelName] = {\n\t\t\tfields: actualFields,\n\t\t\torder: table.order || Infinity\n\t\t};\n\t}\n\treturn schema;\n}\n\n//#endregion\n//#region src/db/get-migration.ts\nconst map = {\n\tpostgres: {\n\t\tstring: [\n\t\t\t\"character varying\",\n\t\t\t\"varchar\",\n\t\t\t\"text\",\n\t\t\t\"uuid\"\n\t\t],\n\t\tnumber: [\n\t\t\t\"int4\",\n\t\t\t\"integer\",\n\t\t\t\"bigint\",\n\t\t\t\"smallint\",\n\t\t\t\"numeric\",\n\t\t\t\"real\",\n\t\t\t\"double precision\"\n\t\t],\n\t\tboolean: [\"bool\", \"boolean\"],\n\t\tdate: [\n\t\t\t\"timestamptz\",\n\t\t\t\"timestamp\",\n\t\t\t\"date\"\n\t\t],\n\t\tjson: [\"json\", \"jsonb\"]\n\t},\n\tmysql: {\n\t\tstring: [\n\t\t\t\"varchar\",\n\t\t\t\"text\",\n\t\t\t\"uuid\"\n\t\t],\n\t\tnumber: [\n\t\t\t\"integer\",\n\t\t\t\"int\",\n\t\t\t\"bigint\",\n\t\t\t\"smallint\",\n\t\t\t\"decimal\",\n\t\t\t\"float\",\n\t\t\t\"double\"\n\t\t],\n\t\tboolean: [\"boolean\", \"tinyint\"],\n\t\tdate: [\n\t\t\t\"timestamp\",\n\t\t\t\"datetime\",\n\t\t\t\"date\"\n\t\t],\n\t\tjson: [\"json\"]\n\t},\n\tsqlite: {\n\t\tstring: [\"TEXT\"],\n\t\tnumber: [\"INTEGER\", \"REAL\"],\n\t\tboolean: [\"INTEGER\", \"BOOLEAN\"],\n\t\tdate: [\"DATE\", \"INTEGER\"],\n\t\tjson: [\"TEXT\"]\n\t},\n\tmssql: {\n\t\tstring: [\n\t\t\t\"varchar\",\n\t\t\t\"nvarchar\",\n\t\t\t\"uniqueidentifier\"\n\t\t],\n\t\tnumber: [\n\t\t\t\"int\",\n\t\t\t\"bigint\",\n\t\t\t\"smallint\",\n\t\t\t\"decimal\",\n\t\t\t\"float\",\n\t\t\t\"double\"\n\t\t],\n\t\tboolean: [\"bit\", \"smallint\"],\n\t\tdate: [\n\t\t\t\"datetime2\",\n\t\t\t\"date\",\n\t\t\t\"datetime\"\n\t\t],\n\t\tjson: [\"varchar\", \"nvarchar\"]\n\t}\n};\nfunction matchType(columnDataType, fieldType, dbType) {\n\tfunction normalize(type) {\n\t\treturn type.toLowerCase().split(\"(\")[0].trim();\n\t}\n\tif (fieldType === \"string[]\" || fieldType === \"number[]\") return columnDataType.toLowerCase().includes(\"json\");\n\tconst types = map[dbType];\n\treturn (Array.isArray(fieldType) ? types[\"string\"].map((t) => t.toLowerCase()) : types[fieldType].map((t) => t.toLowerCase())).includes(normalize(columnDataType));\n}\n/**\n* Get the current PostgreSQL schema (search_path) for the database connection\n* Returns the first schema in the search_path, defaulting to 'public' if not found\n*/\nasync function getPostgresSchema(db) {\n\ttry {\n\t\tconst result = await sql`SHOW search_path`.execute(db);\n\t\tif (result.rows[0]?.search_path) return result.rows[0].search_path.split(\",\").map((s) => s.trim()).map((s) => s.replace(/^[\"']|[\"']$/g, \"\")).filter((s) => !s.startsWith(\"$\"))[0] || \"public\";\n\t} catch (error) {}\n\treturn \"public\";\n}\nasync function getMigrations(config) {\n\tconst betterAuthSchema = getSchema(config);\n\tconst logger$1 = createLogger(config.logger);\n\tlet { kysely: db, databaseType: dbType } = await createKyselyAdapter(config);\n\tif (!dbType) {\n\t\tlogger$1.warn(\"Could not determine database type, defaulting to sqlite. Please provide a type in the database options to avoid this.\");\n\t\tdbType = \"sqlite\";\n\t}\n\tif (!db) {\n\t\tlogger$1.error(\"Only kysely adapter is supported for migrations. You can use `generate` command to generate the schema, if you're using a different adapter.\");\n\t\tprocess.exit(1);\n\t}\n\tlet currentSchema = \"public\";\n\tif (dbType === \"postgres\") {\n\t\tcurrentSchema = await getPostgresSchema(db);\n\t\tlogger$1.debug(`PostgreSQL migration: Using schema '${currentSchema}' (from search_path)`);\n\t\ttry {\n\t\t\tif (!(await sql`\n\t\t\t\tSELECT schema_name \n\t\t\t\tFROM information_schema.schemata \n\t\t\t\tWHERE schema_name = ${currentSchema}\n\t\t\t`.execute(db)).rows[0]) logger$1.warn(`Schema '${currentSchema}' does not exist. Tables will be inspected from available schemas. Consider creating the schema first or checking your database configuration.`);\n\t\t} catch (error) {\n\t\t\tlogger$1.debug(`Could not verify schema existence: ${error instanceof Error ? error.message : String(error)}`);\n\t\t}\n\t}\n\tconst allTableMetadata = await db.introspection.getTables();\n\tlet tableMetadata = allTableMetadata;\n\tif (dbType === \"postgres\") try {\n\t\tconst tablesInSchema = await sql`\n\t\t\t\tSELECT table_name \n\t\t\t\tFROM information_schema.tables \n\t\t\t\tWHERE table_schema = ${currentSchema}\n\t\t\t\tAND table_type = 'BASE TABLE'\n\t\t\t`.execute(db);\n\t\tconst tableNamesInSchema = new Set(tablesInSchema.rows.map((row) => row.table_name));\n\t\ttableMetadata = allTableMetadata.filter((table) => table.schema === currentSchema && tableNamesInSchema.has(table.name));\n\t\tlogger$1.debug(`Found ${tableMetadata.length} table(s) in schema '${currentSchema}': ${tableMetadata.map((t) => t.name).join(\", \") || \"(none)\"}`);\n\t} catch (error) {\n\t\tlogger$1.warn(`Could not filter tables by schema. Using all discovered tables. Error: ${error instanceof Error ? error.message : String(error)}`);\n\t}\n\tconst toBeCreated = [];\n\tconst toBeAdded = [];\n\tfor (const [key, value] of Object.entries(betterAuthSchema)) {\n\t\tconst table = tableMetadata.find((t) => t.name === key);\n\t\tif (!table) {\n\t\t\tconst tIndex = toBeCreated.findIndex((t) => t.table === key);\n\t\t\tconst tableData = {\n\t\t\t\ttable: key,\n\t\t\t\tfields: value.fields,\n\t\t\t\torder: value.order || Infinity\n\t\t\t};\n\t\t\tconst insertIndex = toBeCreated.findIndex((t) => (t.order || Infinity) > tableData.order);\n\t\t\tif (insertIndex === -1) if (tIndex === -1) toBeCreated.push(tableData);\n\t\t\telse toBeCreated[tIndex].fields = {\n\t\t\t\t...toBeCreated[tIndex].fields,\n\t\t\t\t...value.fields\n\t\t\t};\n\t\t\telse toBeCreated.splice(insertIndex, 0, tableData);\n\t\t\tcontinue;\n\t\t}\n\t\tlet toBeAddedFields = {};\n\t\tfor (const [fieldName, field] of Object.entries(value.fields)) {\n\t\t\tconst column = table.columns.find((c) => c.name === fieldName);\n\t\t\tif (!column) {\n\t\t\t\ttoBeAddedFields[fieldName] = field;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (matchType(column.dataType, field.type, dbType)) continue;\n\t\t\telse logger$1.warn(`Field ${fieldName} in table ${key} has a different type in the database. Expected ${field.type} but got ${column.dataType}.`);\n\t\t}\n\t\tif (Object.keys(toBeAddedFields).length > 0) toBeAdded.push({\n\t\t\ttable: key,\n\t\t\tfields: toBeAddedFields,\n\t\t\torder: value.order || Infinity\n\t\t});\n\t}\n\tconst migrations = [];\n\tconst useUUIDs = config.advanced?.database?.generateId === \"uuid\";\n\tconst useNumberId = config.advanced?.database?.useNumberId || config.advanced?.database?.generateId === \"serial\";\n\tfunction getType(field, fieldName) {\n\t\tconst type = field.type;\n\t\tconst typeMap = {\n\t\t\tstring: {\n\t\t\t\tsqlite: \"text\",\n\t\t\t\tpostgres: \"text\",\n\t\t\t\tmysql: field.unique ? \"varchar(255)\" : field.references ? \"varchar(36)\" : field.sortable ? \"varchar(255)\" : field.index ? \"varchar(255)\" : \"text\",\n\t\t\t\tmssql: field.unique || field.sortable ? \"varchar(255)\" : field.references ? \"varchar(36)\" : \"varchar(8000)\"\n\t\t\t},\n\t\t\tboolean: {\n\t\t\t\tsqlite: \"integer\",\n\t\t\t\tpostgres: \"boolean\",\n\t\t\t\tmysql: \"boolean\",\n\t\t\t\tmssql: \"smallint\"\n\t\t\t},\n\t\t\tnumber: {\n\t\t\t\tsqlite: field.bigint ? \"bigint\" : \"integer\",\n\t\t\t\tpostgres: field.bigint ? \"bigint\" : \"integer\",\n\t\t\t\tmysql: field.bigint ? \"bigint\" : \"integer\",\n\t\t\t\tmssql: field.bigint ? \"bigint\" : \"integer\"\n\t\t\t},\n\t\t\tdate: {\n\t\t\t\tsqlite: \"date\",\n\t\t\t\tpostgres: \"timestamptz\",\n\t\t\t\tmysql: \"timestamp(3)\",\n\t\t\t\tmssql: sql`datetime2(3)`\n\t\t\t},\n\t\t\tjson: {\n\t\t\t\tsqlite: \"text\",\n\t\t\t\tpostgres: \"jsonb\",\n\t\t\t\tmysql: \"json\",\n\t\t\t\tmssql: \"varchar(8000)\"\n\t\t\t},\n\t\t\tid: {\n\t\t\t\tpostgres: useNumberId ? sql`integer GENERATED BY DEFAULT AS IDENTITY` : useUUIDs ? \"uuid\" : \"text\",\n\t\t\t\tmysql: useNumberId ? \"integer\" : useUUIDs ? \"varchar(36)\" : \"varchar(36)\",\n\t\t\t\tmssql: useNumberId ? \"integer\" : useUUIDs ? \"varchar(36)\" : \"varchar(36)\",\n\t\t\t\tsqlite: useNumberId ? \"integer\" : \"text\"\n\t\t\t},\n\t\t\tforeignKeyId: {\n\t\t\t\tpostgres: useNumberId ? \"integer\" : useUUIDs ? \"uuid\" : \"text\",\n\t\t\t\tmysql: useNumberId ? \"integer\" : useUUIDs ? \"varchar(36)\" : \"varchar(36)\",\n\t\t\t\tmssql: useNumberId ? \"integer\" : useUUIDs ? \"varchar(36)\" : \"varchar(36)\",\n\t\t\t\tsqlite: useNumberId ? \"integer\" : \"text\"\n\t\t\t}\n\t\t};\n\t\tif (fieldName === \"id\" || field.references?.field === \"id\") {\n\t\t\tif (fieldName === \"id\") return typeMap.id[dbType];\n\t\t\treturn typeMap.foreignKeyId[dbType];\n\t\t}\n\t\tif (dbType === \"sqlite\" && (type === \"string[]\" || type === \"number[]\")) return \"text\";\n\t\tif (type === \"string[]\" || type === \"number[]\") return \"jsonb\";\n\t\tif (Array.isArray(type)) return \"text\";\n\t\tif (!(type in typeMap)) throw new Error(`Unsupported field type '${String(type)}' for field '${fieldName}'. Allowed types are: string, number, boolean, date, string[], number[]. If you need to store structured data, store it as a JSON string (type: \"string\") or split it into primitive fields. See https://better-auth.com/docs/advanced/schema#additional-fields`);\n\t\treturn typeMap[type][dbType || \"sqlite\"];\n\t}\n\tconst getModelName = initGetModelName({\n\t\tschema: getAuthTables(config),\n\t\tusePlural: false\n\t});\n\tconst getFieldName = initGetFieldName({\n\t\tschema: getAuthTables(config),\n\t\tusePlural: false\n\t});\n\tfunction getReferencePath(model, field) {\n\t\ttry {\n\t\t\treturn `${getModelName(model)}.${getFieldName({\n\t\t\t\tmodel,\n\t\t\t\tfield\n\t\t\t})}`;\n\t\t} catch {\n\t\t\treturn `${model}.${field}`;\n\t\t}\n\t}\n\tif (toBeAdded.length) for (const table of toBeAdded) for (const [fieldName, field] of Object.entries(table.fields)) {\n\t\tconst type = getType(field, fieldName);\n\t\tlet builder = db.schema.alterTable(table.table);\n\t\tif (field.index) {\n\t\t\tconst index = db.schema.alterTable(table.table).addIndex(`${table.table}_${fieldName}_idx`);\n\t\t\tmigrations.push(index);\n\t\t}\n\t\tlet built = builder.addColumn(fieldName, type, (col) => {\n\t\t\tcol = field.required !== false ? col.notNull() : col;\n\t\t\tif (field.references) col = col.references(getReferencePath(field.references.model, field.references.field)).onDelete(field.references.onDelete || \"cascade\");\n\t\t\tif (field.unique) col = col.unique();\n\t\t\tif (field.type === \"date\" && typeof field.defaultValue === \"function\" && (dbType === \"postgres\" || dbType === \"mysql\" || dbType === \"mssql\")) if (dbType === \"mysql\") col = col.defaultTo(sql`CURRENT_TIMESTAMP(3)`);\n\t\t\telse col = col.defaultTo(sql`CURRENT_TIMESTAMP`);\n\t\t\treturn col;\n\t\t});\n\t\tmigrations.push(built);\n\t}\n\tlet toBeIndexed = [];\n\tif (config.advanced?.database?.useNumberId) logger$1.warn(\"`useNumberId` is deprecated. Please use `generateId` with `serial` instead.\");\n\tif (toBeCreated.length) for (const table of toBeCreated) {\n\t\tconst idType = getType({ type: useNumberId ? \"number\" : \"string\" }, \"id\");\n\t\tlet dbT = db.schema.createTable(table.table).addColumn(\"id\", idType, (col) => {\n\t\t\tif (useNumberId) {\n\t\t\t\tif (dbType === \"postgres\") return col.primaryKey().notNull();\n\t\t\t\telse if (dbType === \"sqlite\") return col.primaryKey().notNull();\n\t\t\t\telse if (dbType === \"mssql\") return col.identity().primaryKey().notNull();\n\t\t\t\treturn col.autoIncrement().primaryKey().notNull();\n\t\t\t}\n\t\t\tif (useUUIDs) {\n\t\t\t\tif (dbType === \"postgres\") return col.primaryKey().defaultTo(sql`pg_catalog.gen_random_uuid()`).notNull();\n\t\t\t\treturn col.primaryKey().notNull();\n\t\t\t}\n\t\t\treturn col.primaryKey().notNull();\n\t\t});\n\t\tfor (const [fieldName, field] of Object.entries(table.fields)) {\n\t\t\tconst type = getType(field, fieldName);\n\t\t\tdbT = dbT.addColumn(fieldName, type, (col) => {\n\t\t\t\tcol = field.required !== false ? col.notNull() : col;\n\t\t\t\tif (field.references) col = col.references(getReferencePath(field.references.model, field.references.field)).onDelete(field.references.onDelete || \"cascade\");\n\t\t\t\tif (field.unique) col = col.unique();\n\t\t\t\tif (field.type === \"date\" && typeof field.defaultValue === \"function\" && (dbType === \"postgres\" || dbType === \"mysql\" || dbType === \"mssql\")) if (dbType === \"mysql\") col = col.defaultTo(sql`CURRENT_TIMESTAMP(3)`);\n\t\t\t\telse col = col.defaultTo(sql`CURRENT_TIMESTAMP`);\n\t\t\t\treturn col;\n\t\t\t});\n\t\t\tif (field.index) {\n\t\t\t\tlet builder = db.schema.createIndex(`${table.table}_${fieldName}_${field.unique ? \"uidx\" : \"idx\"}`).on(table.table).columns([fieldName]);\n\t\t\t\ttoBeIndexed.push(field.unique ? builder.unique() : builder);\n\t\t\t}\n\t\t}\n\t\tmigrations.push(dbT);\n\t}\n\tif (toBeIndexed.length) for (const index of toBeIndexed) migrations.push(index);\n\tasync function runMigrations() {\n\t\tfor (const migration of migrations) await migration.execute();\n\t}\n\tasync function compileMigrations() {\n\t\treturn migrations.map((m) => m.compile().sql).join(\";\\n\\n\") + \";\";\n\t}\n\treturn {\n\t\ttoBeCreated,\n\t\ttoBeAdded,\n\t\trunMigrations,\n\t\tcompileMigrations\n\t};\n}\n\n//#endregion\nexport { createInternalAdapter as a, convertToDB as c, getBaseAdapter as d, toZodSchema as i, createFieldAttribute as l, matchType as n, getWithHooks as o, getSchema as r, convertFromDB as s, getMigrations as t, getAdapter as u };","import { APIError } from \"better-call\";\n\n//#region src/utils/plugin-helper.ts\nconst getEndpointResponse = async (ctx) => {\n\tconst returned = ctx.context.returned;\n\tif (!returned) return null;\n\tif (returned instanceof Response) {\n\t\tif (returned.status !== 200) return null;\n\t\treturn await returned.clone().json();\n\t}\n\tif (returned instanceof APIError) return null;\n\treturn returned;\n};\n\n//#endregion\nexport { getEndpointResponse as t };","import { entityKind } from \"../entity.js\";\nimport { TableName } from \"../table.utils.js\";\nclass ForeignKeyBuilder {\n  static [entityKind] = \"PgForeignKeyBuilder\";\n  /** @internal */\n  reference;\n  /** @internal */\n  _onUpdate = \"no action\";\n  /** @internal */\n  _onDelete = \"no action\";\n  constructor(config, actions) {\n    this.reference = () => {\n      const { name, columns, foreignColumns } = config();\n      return { name, columns, foreignTable: foreignColumns[0].table, foreignColumns };\n    };\n    if (actions) {\n      this._onUpdate = actions.onUpdate;\n      this._onDelete = actions.onDelete;\n    }\n  }\n  onUpdate(action) {\n    this._onUpdate = action === void 0 ? \"no action\" : action;\n    return this;\n  }\n  onDelete(action) {\n    this._onDelete = action === void 0 ? \"no action\" : action;\n    return this;\n  }\n  /** @internal */\n  build(table) {\n    return new ForeignKey(table, this);\n  }\n}\nclass ForeignKey {\n  constructor(table, builder) {\n    this.table = table;\n    this.reference = builder.reference;\n    this.onUpdate = builder._onUpdate;\n    this.onDelete = builder._onDelete;\n  }\n  static [entityKind] = \"PgForeignKey\";\n  reference;\n  onUpdate;\n  onDelete;\n  getName() {\n    const { name, columns, foreignColumns } = this.reference();\n    const columnNames = columns.map((column) => column.name);\n    const foreignColumnNames = foreignColumns.map((column) => column.name);\n    const chunks = [\n      this.table[TableName],\n      ...columnNames,\n      foreignColumns[0].table[TableName],\n      ...foreignColumnNames\n    ];\n    return name ?? `${chunks.join(\"_\")}_fk`;\n  }\n}\nfunction foreignKey(config) {\n  function mappedConfig() {\n    const { name, columns, foreignColumns } = config;\n    return {\n      name,\n      columns,\n      foreignColumns\n    };\n  }\n  return new ForeignKeyBuilder(mappedConfig);\n}\nexport {\n  ForeignKey,\n  ForeignKeyBuilder,\n  foreignKey\n};\n//# sourceMappingURL=foreign-keys.js.map","import { LogSpanAllowList, NextVanillaSpanAllowlist } from './constants';\nimport { isThenable } from '../../../shared/lib/is-thenable';\nconst NEXT_OTEL_PERFORMANCE_PREFIX = process.env.NEXT_OTEL_PERFORMANCE_PREFIX;\nlet api;\n// we want to allow users to use their own version of @opentelemetry/api if they\n// want to, so we try to require it first, and if it fails we fall back to the\n// version that is bundled with Next.js\n// this is because @opentelemetry/api has to be synced with the version of\n// @opentelemetry/tracing that is used, and we don't want to force users to use\n// the version that is bundled with Next.js.\n// the API is ~stable, so this should be fine\nif (process.env.NEXT_RUNTIME === 'edge') {\n    api = require('@opentelemetry/api');\n} else {\n    try {\n        api = require('@opentelemetry/api');\n    } catch (err) {\n        api = require('next/dist/compiled/@opentelemetry/api');\n    }\n}\nconst { context, propagation, trace, SpanStatusCode, SpanKind, ROOT_CONTEXT } = api;\nexport class BubbledError extends Error {\n    constructor(bubble, result){\n        super(), this.bubble = bubble, this.result = result;\n    }\n}\nexport function isBubbledError(error) {\n    if (typeof error !== 'object' || error === null) return false;\n    return error instanceof BubbledError;\n}\nconst closeSpanWithError = (span, error)=>{\n    if (isBubbledError(error) && error.bubble) {\n        span.setAttribute('next.bubble', true);\n    } else {\n        if (error) {\n            span.recordException(error);\n            span.setAttribute('error.type', error.name);\n        }\n        span.setStatus({\n            code: SpanStatusCode.ERROR,\n            message: error == null ? void 0 : error.message\n        });\n    }\n    span.end();\n};\n/** we use this map to propagate attributes from nested spans to the top span */ const rootSpanAttributesStore = new Map();\nconst rootSpanIdKey = api.createContextKey('next.rootSpanId');\nlet lastSpanId = 0;\nconst getSpanId = ()=>lastSpanId++;\nconst clientTraceDataSetter = {\n    set (carrier, key, value) {\n        carrier.push({\n            key,\n            value\n        });\n    }\n};\nclass NextTracerImpl {\n    /**\n   * Returns an instance to the trace with configured name.\n   * Since wrap / trace can be defined in any place prior to actual trace subscriber initialization,\n   * This should be lazily evaluated.\n   */ getTracerInstance() {\n        return trace.getTracer('next.js', '0.0.1');\n    }\n    getContext() {\n        return context;\n    }\n    getTracePropagationData() {\n        const activeContext = context.active();\n        const entries = [];\n        propagation.inject(activeContext, entries, clientTraceDataSetter);\n        return entries;\n    }\n    getActiveScopeSpan() {\n        return trace.getSpan(context == null ? void 0 : context.active());\n    }\n    withPropagatedContext(carrier, fn, getter) {\n        const activeContext = context.active();\n        if (trace.getSpanContext(activeContext)) {\n            // Active span is already set, too late to propagate.\n            return fn();\n        }\n        const remoteContext = propagation.extract(activeContext, carrier, getter);\n        return context.with(remoteContext, fn);\n    }\n    trace(...args) {\n        const [type, fnOrOptions, fnOrEmpty] = args;\n        // coerce options form overload\n        const { fn, options } = typeof fnOrOptions === 'function' ? {\n            fn: fnOrOptions,\n            options: {}\n        } : {\n            fn: fnOrEmpty,\n            options: {\n                ...fnOrOptions\n            }\n        };\n        const spanName = options.spanName ?? type;\n        if (!NextVanillaSpanAllowlist.has(type) && process.env.NEXT_OTEL_VERBOSE !== '1' || options.hideSpan) {\n            return fn();\n        }\n        // Trying to get active scoped span to assign parent. If option specifies parent span manually, will try to use it.\n        let spanContext = this.getSpanContext((options == null ? void 0 : options.parentSpan) ?? this.getActiveScopeSpan());\n        if (!spanContext) {\n            spanContext = (context == null ? void 0 : context.active()) ?? ROOT_CONTEXT;\n        }\n        // Check if there's already a root span in the store for this trace\n        // We are intentionally not checking whether there is an active context\n        // from outside of nextjs to ensure that we can provide the same level\n        // of telemetry when using a custom server\n        const existingRootSpanId = spanContext.getValue(rootSpanIdKey);\n        const isRootSpan = typeof existingRootSpanId !== 'number' || !rootSpanAttributesStore.has(existingRootSpanId);\n        const spanId = getSpanId();\n        options.attributes = {\n            'next.span_name': spanName,\n            'next.span_type': type,\n            ...options.attributes\n        };\n        return context.with(spanContext.setValue(rootSpanIdKey, spanId), ()=>this.getTracerInstance().startActiveSpan(spanName, options, (span)=>{\n                let startTime;\n                if (NEXT_OTEL_PERFORMANCE_PREFIX && type && LogSpanAllowList.has(type)) {\n                    startTime = 'performance' in globalThis && 'measure' in performance ? globalThis.performance.now() : undefined;\n                }\n                let cleanedUp = false;\n                const onCleanup = ()=>{\n                    if (cleanedUp) return;\n                    cleanedUp = true;\n                    rootSpanAttributesStore.delete(spanId);\n                    if (startTime) {\n                        performance.measure(`${NEXT_OTEL_PERFORMANCE_PREFIX}:next-${(type.split('.').pop() || '').replace(/[A-Z]/g, (match)=>'-' + match.toLowerCase())}`, {\n                            start: startTime,\n                            end: performance.now()\n                        });\n                    }\n                };\n                if (isRootSpan) {\n                    rootSpanAttributesStore.set(spanId, new Map(Object.entries(options.attributes ?? {})));\n                }\n                if (fn.length > 1) {\n                    try {\n                        return fn(span, (err)=>closeSpanWithError(span, err));\n                    } catch (err) {\n                        closeSpanWithError(span, err);\n                        throw err;\n                    } finally{\n                        onCleanup();\n                    }\n                }\n                try {\n                    const result = fn(span);\n                    if (isThenable(result)) {\n                        // If there's error make sure it throws\n                        return result.then((res)=>{\n                            span.end();\n                            // Need to pass down the promise result,\n                            // it could be react stream response with error { error, stream }\n                            return res;\n                        }).catch((err)=>{\n                            closeSpanWithError(span, err);\n                            throw err;\n                        }).finally(onCleanup);\n                    } else {\n                        span.end();\n                        onCleanup();\n                    }\n                    return result;\n                } catch (err) {\n                    closeSpanWithError(span, err);\n                    onCleanup();\n                    throw err;\n                }\n            }));\n    }\n    wrap(...args) {\n        const tracer = this;\n        const [name, options, fn] = args.length === 3 ? args : [\n            args[0],\n            {},\n            args[1]\n        ];\n        if (!NextVanillaSpanAllowlist.has(name) && process.env.NEXT_OTEL_VERBOSE !== '1') {\n            return fn;\n        }\n        return function() {\n            let optionsObj = options;\n            if (typeof optionsObj === 'function' && typeof fn === 'function') {\n                optionsObj = optionsObj.apply(this, arguments);\n            }\n            const lastArgId = arguments.length - 1;\n            const cb = arguments[lastArgId];\n            if (typeof cb === 'function') {\n                const scopeBoundCb = tracer.getContext().bind(context.active(), cb);\n                return tracer.trace(name, optionsObj, (_span, done)=>{\n                    arguments[lastArgId] = function(err) {\n                        done == null ? void 0 : done(err);\n                        return scopeBoundCb.apply(this, arguments);\n                    };\n                    return fn.apply(this, arguments);\n                });\n            } else {\n                return tracer.trace(name, optionsObj, ()=>fn.apply(this, arguments));\n            }\n        };\n    }\n    startSpan(...args) {\n        const [type, options] = args;\n        const spanContext = this.getSpanContext((options == null ? void 0 : options.parentSpan) ?? this.getActiveScopeSpan());\n        return this.getTracerInstance().startSpan(type, options, spanContext);\n    }\n    getSpanContext(parentSpan) {\n        const spanContext = parentSpan ? trace.setSpan(context.active(), parentSpan) : undefined;\n        return spanContext;\n    }\n    getRootSpanAttributes() {\n        const spanId = context.active().getValue(rootSpanIdKey);\n        return rootSpanAttributesStore.get(spanId);\n    }\n    setRootSpanAttribute(key, value) {\n        const spanId = context.active().getValue(rootSpanIdKey);\n        const attributes = rootSpanAttributesStore.get(spanId);\n        if (attributes && !attributes.has(key)) {\n            attributes.set(key, value);\n        }\n    }\n}\nconst getTracer = (()=>{\n    const tracer = new NextTracerImpl();\n    return ()=>tracer;\n})();\nexport { getTracer, SpanStatusCode, SpanKind };\n\n//# sourceMappingURL=tracer.js.map","import { entityKind } from \"../../entity.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgEnumObjectColumnBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgEnumObjectColumnBuilder\";\n  constructor(name, enumInstance) {\n    super(name, \"string\", \"PgEnumObjectColumn\");\n    this.config.enum = enumInstance;\n  }\n  /** @internal */\n  build(table) {\n    return new PgEnumObjectColumn(\n      table,\n      this.config\n    );\n  }\n}\nclass PgEnumObjectColumn extends PgColumn {\n  static [entityKind] = \"PgEnumObjectColumn\";\n  enum;\n  enumValues = this.config.enum.enumValues;\n  constructor(table, config) {\n    super(table, config);\n    this.enum = config.enum;\n  }\n  getSQLType() {\n    return this.enum.enumName;\n  }\n}\nconst isPgEnumSym = Symbol.for(\"drizzle:isPgEnum\");\nfunction isPgEnum(obj) {\n  return !!obj && typeof obj === \"function\" && isPgEnumSym in obj && obj[isPgEnumSym] === true;\n}\nclass PgEnumColumnBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgEnumColumnBuilder\";\n  constructor(name, enumInstance) {\n    super(name, \"string\", \"PgEnumColumn\");\n    this.config.enum = enumInstance;\n  }\n  /** @internal */\n  build(table) {\n    return new PgEnumColumn(\n      table,\n      this.config\n    );\n  }\n}\nclass PgEnumColumn extends PgColumn {\n  static [entityKind] = \"PgEnumColumn\";\n  enum = this.config.enum;\n  enumValues = this.config.enum.enumValues;\n  constructor(table, config) {\n    super(table, config);\n    this.enum = config.enum;\n  }\n  getSQLType() {\n    return this.enum.enumName;\n  }\n}\nfunction pgEnum(enumName, input) {\n  return Array.isArray(input) ? pgEnumWithSchema(enumName, [...input], void 0) : pgEnumObjectWithSchema(enumName, input, void 0);\n}\nfunction pgEnumWithSchema(enumName, values, schema) {\n  const enumInstance = Object.assign(\n    (name) => new PgEnumColumnBuilder(name ?? \"\", enumInstance),\n    {\n      enumName,\n      enumValues: values,\n      schema,\n      [isPgEnumSym]: true\n    }\n  );\n  return enumInstance;\n}\nfunction pgEnumObjectWithSchema(enumName, values, schema) {\n  const enumInstance = Object.assign(\n    (name) => new PgEnumObjectColumnBuilder(name ?? \"\", enumInstance),\n    {\n      enumName,\n      enumValues: Object.values(values),\n      schema,\n      [isPgEnumSym]: true\n    }\n  );\n  return enumInstance;\n}\nexport {\n  PgEnumColumn,\n  PgEnumColumnBuilder,\n  PgEnumObjectColumn,\n  PgEnumObjectColumnBuilder,\n  isPgEnum,\n  pgEnum,\n  pgEnumObjectWithSchema,\n  pgEnumWithSchema\n};\n//# sourceMappingURL=enum.js.map","import { i as logger } from \"../env-8yWFh7b8.mjs\";\nimport { a as refreshAccessToken, c as getOAuth2Tokens, n as validateAuthorizationCode, o as createAuthorizationURL, s as generateCodeChallenge } from \"../oauth2-B2XPHgx5.mjs\";\nimport \"../utils-C5EN75oV.mjs\";\nimport { t as BetterAuthError } from \"../error-BhAKg8LX.mjs\";\nimport * as z from \"zod\";\nimport { base64 } from \"@better-auth/utils/base64\";\nimport { betterFetch } from \"@better-fetch/fetch\";\nimport { createRemoteJWKSet, decodeJwt, decodeProtectedHeader, importJWK, jwtVerify } from \"jose\";\nimport { APIError } from \"better-call\";\n\n//#region src/social-providers/apple.ts\nconst apple = (options) => {\n\tconst tokenEndpoint = \"https://appleid.apple.com/auth/token\";\n\treturn {\n\t\tid: \"apple\",\n\t\tname: \"Apple\",\n\t\tasync createAuthorizationURL({ state, scopes, redirectURI }) {\n\t\t\tconst _scope = options.disableDefaultScope ? [] : [\"email\", \"name\"];\n\t\t\tif (options.scope) _scope.push(...options.scope);\n\t\t\tif (scopes) _scope.push(...scopes);\n\t\t\treturn await createAuthorizationURL({\n\t\t\t\tid: \"apple\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://appleid.apple.com/auth/authorize\",\n\t\t\t\tscopes: _scope,\n\t\t\t\tstate,\n\t\t\t\tredirectURI,\n\t\t\t\tresponseMode: \"form_post\",\n\t\t\t\tresponseType: \"code id_token\"\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\tasync verifyIdToken(token, nonce) {\n\t\t\tif (options.disableIdTokenSignIn) return false;\n\t\t\tif (options.verifyIdToken) return options.verifyIdToken(token, nonce);\n\t\t\tconst { kid, alg: jwtAlg } = decodeProtectedHeader(token);\n\t\t\tif (!kid || !jwtAlg) return false;\n\t\t\tconst { payload: jwtClaims } = await jwtVerify(token, await getApplePublicKey(kid), {\n\t\t\t\talgorithms: [jwtAlg],\n\t\t\t\tissuer: \"https://appleid.apple.com\",\n\t\t\t\taudience: options.audience && options.audience.length ? options.audience : options.appBundleIdentifier ? options.appBundleIdentifier : options.clientId,\n\t\t\t\tmaxTokenAge: \"1h\"\n\t\t\t});\n\t\t\t[\"email_verified\", \"is_private_email\"].forEach((field) => {\n\t\t\t\tif (jwtClaims[field] !== void 0) jwtClaims[field] = Boolean(jwtClaims[field]);\n\t\t\t});\n\t\t\tif (nonce && jwtClaims.nonce !== nonce) return false;\n\t\t\treturn !!jwtClaims;\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint: \"https://appleid.apple.com/auth/token\"\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tif (!token.idToken) return null;\n\t\t\tconst profile = decodeJwt(token.idToken);\n\t\t\tif (!profile) return null;\n\t\t\tconst name = token.user ? `${token.user.name?.firstName} ${token.user.name?.lastName}` : profile.name || profile.email;\n\t\t\tconst emailVerified = typeof profile.email_verified === \"boolean\" ? profile.email_verified : profile.email_verified === \"true\";\n\t\t\tconst enrichedProfile = {\n\t\t\t\t...profile,\n\t\t\t\tname\n\t\t\t};\n\t\t\tconst userMap = await options.mapProfileToUser?.(enrichedProfile);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile.sub,\n\t\t\t\t\tname: enrichedProfile.name,\n\t\t\t\t\temailVerified,\n\t\t\t\t\temail: profile.email,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: enrichedProfile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\nconst getApplePublicKey = async (kid) => {\n\tconst { data } = await betterFetch(`https://appleid.apple.com/auth/keys`);\n\tif (!data?.keys) throw new APIError(\"BAD_REQUEST\", { message: \"Keys not found\" });\n\tconst jwk = data.keys.find((key) => key.kid === kid);\n\tif (!jwk) throw new Error(`JWK with kid ${kid} not found`);\n\treturn await importJWK(jwk, jwk.alg);\n};\n\n//#endregion\n//#region src/social-providers/atlassian.ts\nconst atlassian = (options) => {\n\treturn {\n\t\tid: \"atlassian\",\n\t\tname: \"Atlassian\",\n\t\tasync createAuthorizationURL({ state, scopes, codeVerifier, redirectURI }) {\n\t\t\tif (!options.clientId || !options.clientSecret) {\n\t\t\t\tlogger.error(\"Client Id and Secret are required for Atlassian\");\n\t\t\t\tthrow new BetterAuthError(\"CLIENT_ID_AND_SECRET_REQUIRED\");\n\t\t\t}\n\t\t\tif (!codeVerifier) throw new BetterAuthError(\"codeVerifier is required for Atlassian\");\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\"read:jira-user\", \"offline_access\"];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn createAuthorizationURL({\n\t\t\t\tid: \"atlassian\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://auth.atlassian.com/authorize\",\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\tadditionalParams: { audience: \"api.atlassian.com\" },\n\t\t\t\tprompt: options.prompt\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint: \"https://auth.atlassian.com/oauth/token\"\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint: \"https://auth.atlassian.com/oauth/token\"\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tif (!token.accessToken) return null;\n\t\t\ttry {\n\t\t\t\tconst { data: profile } = await betterFetch(\"https://api.atlassian.com/me\", { headers: { Authorization: `Bearer ${token.accessToken}` } });\n\t\t\t\tif (!profile) return null;\n\t\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\t\treturn {\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: profile.account_id,\n\t\t\t\t\t\tname: profile.name,\n\t\t\t\t\t\temail: profile.email,\n\t\t\t\t\t\timage: profile.picture,\n\t\t\t\t\t\temailVerified: false,\n\t\t\t\t\t\t...userMap\n\t\t\t\t\t},\n\t\t\t\t\tdata: profile\n\t\t\t\t};\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error(\"Failed to fetch user info from Figma:\", error);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/cognito.ts\nconst cognito = (options) => {\n\tif (!options.domain || !options.region || !options.userPoolId) {\n\t\tlogger.error(\"Domain, region and userPoolId are required for Amazon Cognito. Make sure to provide them in the options.\");\n\t\tthrow new BetterAuthError(\"DOMAIN_AND_REGION_REQUIRED\");\n\t}\n\tconst cleanDomain = options.domain.replace(/^https?:\\/\\//, \"\");\n\tconst authorizationEndpoint = `https://${cleanDomain}/oauth2/authorize`;\n\tconst tokenEndpoint = `https://${cleanDomain}/oauth2/token`;\n\tconst userInfoEndpoint = `https://${cleanDomain}/oauth2/userinfo`;\n\treturn {\n\t\tid: \"cognito\",\n\t\tname: \"Cognito\",\n\t\tasync createAuthorizationURL({ state, scopes, codeVerifier, redirectURI }) {\n\t\t\tif (!options.clientId) {\n\t\t\t\tlogger.error(\"ClientId is required for Amazon Cognito. Make sure to provide them in the options.\");\n\t\t\t\tthrow new BetterAuthError(\"CLIENT_ID_AND_SECRET_REQUIRED\");\n\t\t\t}\n\t\t\tif (options.requireClientSecret && !options.clientSecret) {\n\t\t\t\tlogger.error(\"Client Secret is required when requireClientSecret is true. Make sure to provide it in the options.\");\n\t\t\t\tthrow new BetterAuthError(\"CLIENT_SECRET_REQUIRED\");\n\t\t\t}\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\n\t\t\t\t\"openid\",\n\t\t\t\t\"profile\",\n\t\t\t\t\"email\"\n\t\t\t];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn await createAuthorizationURL({\n\t\t\t\tid: \"cognito\",\n\t\t\t\toptions: { ...options },\n\t\t\t\tauthorizationEndpoint,\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\tprompt: options.prompt\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\tasync verifyIdToken(token, nonce) {\n\t\t\tif (options.disableIdTokenSignIn) return false;\n\t\t\tif (options.verifyIdToken) return options.verifyIdToken(token, nonce);\n\t\t\ttry {\n\t\t\t\tconst { kid, alg: jwtAlg } = decodeProtectedHeader(token);\n\t\t\t\tif (!kid || !jwtAlg) return false;\n\t\t\t\tconst publicKey = await getCognitoPublicKey(kid, options.region, options.userPoolId);\n\t\t\t\tconst expectedIssuer = `https://cognito-idp.${options.region}.amazonaws.com/${options.userPoolId}`;\n\t\t\t\tconst { payload: jwtClaims } = await jwtVerify(token, publicKey, {\n\t\t\t\t\talgorithms: [jwtAlg],\n\t\t\t\t\tissuer: expectedIssuer,\n\t\t\t\t\taudience: options.clientId,\n\t\t\t\t\tmaxTokenAge: \"1h\"\n\t\t\t\t});\n\t\t\t\tif (nonce && jwtClaims.nonce !== nonce) return false;\n\t\t\t\treturn true;\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error(\"Failed to verify ID token:\", error);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tif (token.idToken) try {\n\t\t\t\tconst profile = decodeJwt(token.idToken);\n\t\t\t\tif (!profile) return null;\n\t\t\t\tconst name = profile.name || profile.given_name || profile.username || profile.email;\n\t\t\t\tconst enrichedProfile = {\n\t\t\t\t\t...profile,\n\t\t\t\t\tname\n\t\t\t\t};\n\t\t\t\tconst userMap = await options.mapProfileToUser?.(enrichedProfile);\n\t\t\t\treturn {\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: profile.sub,\n\t\t\t\t\t\tname: enrichedProfile.name,\n\t\t\t\t\t\temail: profile.email,\n\t\t\t\t\t\timage: profile.picture,\n\t\t\t\t\t\temailVerified: profile.email_verified,\n\t\t\t\t\t\t...userMap\n\t\t\t\t\t},\n\t\t\t\t\tdata: enrichedProfile\n\t\t\t\t};\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error(\"Failed to decode ID token:\", error);\n\t\t\t}\n\t\t\tif (token.accessToken) try {\n\t\t\t\tconst { data: userInfo } = await betterFetch(userInfoEndpoint, { headers: { Authorization: `Bearer ${token.accessToken}` } });\n\t\t\t\tif (userInfo) {\n\t\t\t\t\tconst userMap = await options.mapProfileToUser?.(userInfo);\n\t\t\t\t\treturn {\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tid: userInfo.sub,\n\t\t\t\t\t\t\tname: userInfo.name || userInfo.given_name || userInfo.username,\n\t\t\t\t\t\t\temail: userInfo.email,\n\t\t\t\t\t\t\timage: userInfo.picture,\n\t\t\t\t\t\t\temailVerified: userInfo.email_verified,\n\t\t\t\t\t\t\t...userMap\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdata: userInfo\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error(\"Failed to fetch user info from Cognito:\", error);\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\toptions\n\t};\n};\nconst getCognitoPublicKey = async (kid, region, userPoolId) => {\n\tconst COGNITO_JWKS_URI = `https://cognito-idp.${region}.amazonaws.com/${userPoolId}/.well-known/jwks.json`;\n\ttry {\n\t\tconst { data } = await betterFetch(COGNITO_JWKS_URI);\n\t\tif (!data?.keys) throw new APIError(\"BAD_REQUEST\", { message: \"Keys not found\" });\n\t\tconst jwk = data.keys.find((key) => key.kid === kid);\n\t\tif (!jwk) throw new Error(`JWK with kid ${kid} not found`);\n\t\treturn await importJWK(jwk, jwk.alg);\n\t} catch (error) {\n\t\tlogger.error(\"Failed to fetch Cognito public key:\", error);\n\t\tthrow error;\n\t}\n};\n\n//#endregion\n//#region src/social-providers/discord.ts\nconst discord = (options) => {\n\treturn {\n\t\tid: \"discord\",\n\t\tname: \"Discord\",\n\t\tcreateAuthorizationURL({ state, scopes, redirectURI }) {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\"identify\", \"email\"];\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tconst permissionsParam = _scopes.includes(\"bot\") && options.permissions !== void 0 ? `&permissions=${options.permissions}` : \"\";\n\t\t\treturn new URL(`https://discord.com/api/oauth2/authorize?scope=${_scopes.join(\"+\")}&response_type=code&client_id=${options.clientId}&redirect_uri=${encodeURIComponent(options.redirectURI || redirectURI)}&state=${state}&prompt=${options.prompt || \"none\"}${permissionsParam}`);\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint: \"https://discord.com/api/oauth2/token\"\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint: \"https://discord.com/api/oauth2/token\"\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data: profile, error } = await betterFetch(\"https://discord.com/api/users/@me\", { headers: { authorization: `Bearer ${token.accessToken}` } });\n\t\t\tif (error) return null;\n\t\t\tif (profile.avatar === null) profile.image_url = `https://cdn.discordapp.com/embed/avatars/${profile.discriminator === \"0\" ? Number(BigInt(profile.id) >> BigInt(22)) % 6 : parseInt(profile.discriminator) % 5}.png`;\n\t\t\telse {\n\t\t\t\tconst format = profile.avatar.startsWith(\"a_\") ? \"gif\" : \"png\";\n\t\t\t\tprofile.image_url = `https://cdn.discordapp.com/avatars/${profile.id}/${profile.avatar}.${format}`;\n\t\t\t}\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile.id,\n\t\t\t\t\tname: profile.global_name || profile.username || \"\",\n\t\t\t\t\temail: profile.email,\n\t\t\t\t\temailVerified: profile.verified,\n\t\t\t\t\timage: profile.image_url,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/dropbox.ts\nconst dropbox = (options) => {\n\tconst tokenEndpoint = \"https://api.dropboxapi.com/oauth2/token\";\n\treturn {\n\t\tid: \"dropbox\",\n\t\tname: \"Dropbox\",\n\t\tcreateAuthorizationURL: async ({ state, scopes, codeVerifier, redirectURI }) => {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\"account_info.read\"];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\tconst additionalParams = {};\n\t\t\tif (options.accessType) additionalParams.token_access_type = options.accessType;\n\t\t\treturn await createAuthorizationURL({\n\t\t\t\tid: \"dropbox\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://www.dropbox.com/oauth2/authorize\",\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tredirectURI,\n\t\t\t\tcodeVerifier,\n\t\t\t\tadditionalParams\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n\t\t\treturn await validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint: \"https://api.dropbox.com/oauth2/token\"\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data: profile, error } = await betterFetch(\"https://api.dropboxapi.com/2/users/get_current_account\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: { Authorization: `Bearer ${token.accessToken}` }\n\t\t\t});\n\t\t\tif (error) return null;\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile.account_id,\n\t\t\t\t\tname: profile.name?.display_name,\n\t\t\t\t\temail: profile.email,\n\t\t\t\t\temailVerified: profile.email_verified || false,\n\t\t\t\t\timage: profile.profile_photo_url,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/facebook.ts\nconst facebook = (options) => {\n\treturn {\n\t\tid: \"facebook\",\n\t\tname: \"Facebook\",\n\t\tasync createAuthorizationURL({ state, scopes, redirectURI, loginHint }) {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\"email\", \"public_profile\"];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn await createAuthorizationURL({\n\t\t\t\tid: \"facebook\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://www.facebook.com/v21.0/dialog/oauth\",\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tredirectURI,\n\t\t\t\tloginHint,\n\t\t\t\tadditionalParams: options.configId ? { config_id: options.configId } : {}\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint: \"https://graph.facebook.com/oauth/access_token\"\n\t\t\t});\n\t\t},\n\t\tasync verifyIdToken(token, nonce) {\n\t\t\tif (options.disableIdTokenSignIn) return false;\n\t\t\tif (options.verifyIdToken) return options.verifyIdToken(token, nonce);\n\t\t\tif (token.split(\".\").length === 3) try {\n\t\t\t\tconst { payload: jwtClaims } = await jwtVerify(token, createRemoteJWKSet(new URL(\"https://limited.facebook.com/.well-known/oauth/openid/jwks/\")), {\n\t\t\t\t\talgorithms: [\"RS256\"],\n\t\t\t\t\taudience: options.clientId,\n\t\t\t\t\tissuer: \"https://www.facebook.com\"\n\t\t\t\t});\n\t\t\t\tif (nonce && jwtClaims.nonce !== nonce) return false;\n\t\t\t\treturn !!jwtClaims;\n\t\t\t} catch (error) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint: \"https://graph.facebook.com/v18.0/oauth/access_token\"\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tif (token.idToken && token.idToken.split(\".\").length === 3) {\n\t\t\t\tconst profile$1 = decodeJwt(token.idToken);\n\t\t\t\tconst user = {\n\t\t\t\t\tid: profile$1.sub,\n\t\t\t\t\tname: profile$1.name,\n\t\t\t\t\temail: profile$1.email,\n\t\t\t\t\tpicture: { data: {\n\t\t\t\t\t\turl: profile$1.picture,\n\t\t\t\t\t\theight: 100,\n\t\t\t\t\t\twidth: 100,\n\t\t\t\t\t\tis_silhouette: false\n\t\t\t\t\t} }\n\t\t\t\t};\n\t\t\t\tconst userMap$1 = await options.mapProfileToUser?.({\n\t\t\t\t\t...user,\n\t\t\t\t\temail_verified: false\n\t\t\t\t});\n\t\t\t\treturn {\n\t\t\t\t\tuser: {\n\t\t\t\t\t\t...user,\n\t\t\t\t\t\temailVerified: false,\n\t\t\t\t\t\t...userMap$1\n\t\t\t\t\t},\n\t\t\t\t\tdata: profile$1\n\t\t\t\t};\n\t\t\t}\n\t\t\tconst { data: profile, error } = await betterFetch(\"https://graph.facebook.com/me?fields=\" + [\n\t\t\t\t\"id\",\n\t\t\t\t\"name\",\n\t\t\t\t\"email\",\n\t\t\t\t\"picture\",\n\t\t\t\t...options?.fields || []\n\t\t\t].join(\",\"), { auth: {\n\t\t\t\ttype: \"Bearer\",\n\t\t\t\ttoken: token.accessToken\n\t\t\t} });\n\t\t\tif (error) return null;\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile.id,\n\t\t\t\t\tname: profile.name,\n\t\t\t\t\temail: profile.email,\n\t\t\t\t\timage: profile.picture.data.url,\n\t\t\t\t\temailVerified: profile.email_verified,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/figma.ts\nconst figma = (options) => {\n\treturn {\n\t\tid: \"figma\",\n\t\tname: \"Figma\",\n\t\tasync createAuthorizationURL({ state, scopes, codeVerifier, redirectURI }) {\n\t\t\tif (!options.clientId || !options.clientSecret) {\n\t\t\t\tlogger.error(\"Client Id and Client Secret are required for Figma. Make sure to provide them in the options.\");\n\t\t\t\tthrow new BetterAuthError(\"CLIENT_ID_AND_SECRET_REQUIRED\");\n\t\t\t}\n\t\t\tif (!codeVerifier) throw new BetterAuthError(\"codeVerifier is required for Figma\");\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\"file_read\"];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn await createAuthorizationURL({\n\t\t\t\tid: \"figma\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://www.figma.com/oauth\",\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint: \"https://www.figma.com/api/oauth/token\"\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint: \"https://www.figma.com/api/oauth/token\"\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\ttry {\n\t\t\t\tconst { data: profile } = await betterFetch(\"https://api.figma.com/v1/me\", { headers: { Authorization: `Bearer ${token.accessToken}` } });\n\t\t\t\tif (!profile) {\n\t\t\t\t\tlogger.error(\"Failed to fetch user from Figma\");\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\t\treturn {\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: profile.id,\n\t\t\t\t\t\tname: profile.handle,\n\t\t\t\t\t\temail: profile.email,\n\t\t\t\t\t\timage: profile.img_url,\n\t\t\t\t\t\temailVerified: !!profile.email,\n\t\t\t\t\t\t...userMap\n\t\t\t\t\t},\n\t\t\t\t\tdata: profile\n\t\t\t\t};\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error(\"Failed to fetch user info from Figma:\", error);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/github.ts\nconst github = (options) => {\n\tconst tokenEndpoint = \"https://github.com/login/oauth/access_token\";\n\treturn {\n\t\tid: \"github\",\n\t\tname: \"GitHub\",\n\t\tcreateAuthorizationURL({ state, scopes, loginHint, codeVerifier, redirectURI }) {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\"read:user\", \"user:email\"];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn createAuthorizationURL({\n\t\t\t\tid: \"github\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://github.com/login/oauth/authorize\",\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\tloginHint,\n\t\t\t\tprompt: options.prompt\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint: \"https://github.com/login/oauth/access_token\"\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data: profile, error } = await betterFetch(\"https://api.github.com/user\", { headers: {\n\t\t\t\t\"User-Agent\": \"better-auth\",\n\t\t\t\tauthorization: `Bearer ${token.accessToken}`\n\t\t\t} });\n\t\t\tif (error) return null;\n\t\t\tconst { data: emails } = await betterFetch(\"https://api.github.com/user/emails\", { headers: {\n\t\t\t\tAuthorization: `Bearer ${token.accessToken}`,\n\t\t\t\t\"User-Agent\": \"better-auth\"\n\t\t\t} });\n\t\t\tif (!profile.email && emails) profile.email = (emails.find((e) => e.primary) ?? emails[0])?.email;\n\t\t\tconst emailVerified = emails?.find((e) => e.email === profile.email)?.verified ?? false;\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile.id,\n\t\t\t\t\tname: profile.name || profile.login,\n\t\t\t\t\temail: profile.email,\n\t\t\t\t\timage: profile.avatar_url,\n\t\t\t\t\temailVerified,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/gitlab.ts\nconst cleanDoubleSlashes = (input = \"\") => {\n\treturn input.split(\"://\").map((str) => str.replace(/\\/{2,}/g, \"/\")).join(\"://\");\n};\nconst issuerToEndpoints = (issuer) => {\n\tlet baseUrl = issuer || \"https://gitlab.com\";\n\treturn {\n\t\tauthorizationEndpoint: cleanDoubleSlashes(`${baseUrl}/oauth/authorize`),\n\t\ttokenEndpoint: cleanDoubleSlashes(`${baseUrl}/oauth/token`),\n\t\tuserinfoEndpoint: cleanDoubleSlashes(`${baseUrl}/api/v4/user`)\n\t};\n};\nconst gitlab = (options) => {\n\tconst { authorizationEndpoint, tokenEndpoint, userinfoEndpoint } = issuerToEndpoints(options.issuer);\n\tconst issuerId = \"gitlab\";\n\treturn {\n\t\tid: issuerId,\n\t\tname: \"Gitlab\",\n\t\tcreateAuthorizationURL: async ({ state, scopes, codeVerifier, loginHint, redirectURI }) => {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\"read_user\"];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn await createAuthorizationURL({\n\t\t\t\tid: issuerId,\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint,\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tredirectURI,\n\t\t\t\tcodeVerifier,\n\t\t\t\tloginHint\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, redirectURI, codeVerifier }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\tcodeVerifier,\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data: profile, error } = await betterFetch(userinfoEndpoint, { headers: { authorization: `Bearer ${token.accessToken}` } });\n\t\t\tif (error || profile.state !== \"active\" || profile.locked) return null;\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile.id,\n\t\t\t\t\tname: profile.name ?? profile.username,\n\t\t\t\t\temail: profile.email,\n\t\t\t\t\timage: profile.avatar_url,\n\t\t\t\t\temailVerified: profile.email_verified ?? false,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/google.ts\nconst google = (options) => {\n\treturn {\n\t\tid: \"google\",\n\t\tname: \"Google\",\n\t\tasync createAuthorizationURL({ state, scopes, codeVerifier, redirectURI, loginHint, display }) {\n\t\t\tif (!options.clientId || !options.clientSecret) {\n\t\t\t\tlogger.error(\"Client Id and Client Secret is required for Google. Make sure to provide them in the options.\");\n\t\t\t\tthrow new BetterAuthError(\"CLIENT_ID_AND_SECRET_REQUIRED\");\n\t\t\t}\n\t\t\tif (!codeVerifier) throw new BetterAuthError(\"codeVerifier is required for Google\");\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\n\t\t\t\t\"email\",\n\t\t\t\t\"profile\",\n\t\t\t\t\"openid\"\n\t\t\t];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn await createAuthorizationURL({\n\t\t\t\tid: \"google\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://accounts.google.com/o/oauth2/auth\",\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\tprompt: options.prompt,\n\t\t\t\taccessType: options.accessType,\n\t\t\t\tdisplay: display || options.display,\n\t\t\t\tloginHint,\n\t\t\t\thd: options.hd,\n\t\t\t\tadditionalParams: { include_granted_scopes: \"true\" }\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint: \"https://oauth2.googleapis.com/token\"\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint: \"https://www.googleapis.com/oauth2/v4/token\"\n\t\t\t});\n\t\t},\n\t\tasync verifyIdToken(token, nonce) {\n\t\t\tif (options.disableIdTokenSignIn) return false;\n\t\t\tif (options.verifyIdToken) return options.verifyIdToken(token, nonce);\n\t\t\tconst { data: tokenInfo } = await betterFetch(`https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${token}`);\n\t\t\tif (!tokenInfo) return false;\n\t\t\treturn tokenInfo.aud === options.clientId && (tokenInfo.iss === \"https://accounts.google.com\" || tokenInfo.iss === \"accounts.google.com\");\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tif (!token.idToken) return null;\n\t\t\tconst user = decodeJwt(token.idToken);\n\t\t\tconst userMap = await options.mapProfileToUser?.(user);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: user.sub,\n\t\t\t\t\tname: user.name,\n\t\t\t\t\temail: user.email,\n\t\t\t\t\timage: user.picture,\n\t\t\t\t\temailVerified: user.email_verified,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: user\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/huggingface.ts\nconst huggingface = (options) => {\n\treturn {\n\t\tid: \"huggingface\",\n\t\tname: \"Hugging Face\",\n\t\tcreateAuthorizationURL({ state, scopes, codeVerifier, redirectURI }) {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\n\t\t\t\t\"openid\",\n\t\t\t\t\"profile\",\n\t\t\t\t\"email\"\n\t\t\t];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn createAuthorizationURL({\n\t\t\t\tid: \"huggingface\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://huggingface.co/oauth/authorize\",\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint: \"https://huggingface.co/oauth/token\"\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint: \"https://huggingface.co/oauth/token\"\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data: profile, error } = await betterFetch(\"https://huggingface.co/oauth/userinfo\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\theaders: { Authorization: `Bearer ${token.accessToken}` }\n\t\t\t});\n\t\t\tif (error) return null;\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile.sub,\n\t\t\t\t\tname: profile.name || profile.preferred_username,\n\t\t\t\t\temail: profile.email,\n\t\t\t\t\timage: profile.picture,\n\t\t\t\t\temailVerified: profile.email_verified ?? false,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/kakao.ts\nconst kakao = (options) => {\n\treturn {\n\t\tid: \"kakao\",\n\t\tname: \"Kakao\",\n\t\tcreateAuthorizationURL({ state, scopes, redirectURI }) {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\n\t\t\t\t\"account_email\",\n\t\t\t\t\"profile_image\",\n\t\t\t\t\"profile_nickname\"\n\t\t\t];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn createAuthorizationURL({\n\t\t\t\tid: \"kakao\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://kauth.kakao.com/oauth/authorize\",\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tredirectURI\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint: \"https://kauth.kakao.com/oauth/token\"\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint: \"https://kauth.kakao.com/oauth/token\"\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data: profile, error } = await betterFetch(\"https://kapi.kakao.com/v2/user/me\", { headers: { Authorization: `Bearer ${token.accessToken}` } });\n\t\t\tif (error || !profile) return null;\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\tconst account = profile.kakao_account || {};\n\t\t\tconst kakaoProfile = account.profile || {};\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: String(profile.id),\n\t\t\t\t\tname: kakaoProfile.nickname || account.name || void 0,\n\t\t\t\t\temail: account.email,\n\t\t\t\t\timage: kakaoProfile.profile_image_url || kakaoProfile.thumbnail_image_url,\n\t\t\t\t\temailVerified: !!account.is_email_valid && !!account.is_email_verified,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/kick.ts\nconst kick = (options) => {\n\treturn {\n\t\tid: \"kick\",\n\t\tname: \"Kick\",\n\t\tcreateAuthorizationURL({ state, scopes, redirectURI, codeVerifier }) {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\"user:read\"];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn createAuthorizationURL({\n\t\t\t\tid: \"kick\",\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://id.kick.com/oauth/authorize\",\n\t\t\t\tscopes: _scopes,\n\t\t\t\tcodeVerifier,\n\t\t\t\tstate\n\t\t\t});\n\t\t},\n\t\tasync validateAuthorizationCode({ code, redirectURI, codeVerifier }) {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint: \"https://id.kick.com/oauth/token\",\n\t\t\t\tcodeVerifier\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data, error } = await betterFetch(\"https://api.kick.com/public/v1/users\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\theaders: { Authorization: `Bearer ${token.accessToken}` }\n\t\t\t});\n\t\t\tif (error) return null;\n\t\t\tconst profile = data.data[0];\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile.user_id,\n\t\t\t\t\tname: profile.name,\n\t\t\t\t\temail: profile.email,\n\t\t\t\t\timage: profile.profile_picture,\n\t\t\t\t\temailVerified: false,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/line.ts\n/**\n* LINE Login v2.1\n* - Authorization endpoint: https://access.line.me/oauth2/v2.1/authorize\n* - Token endpoint: https://api.line.me/oauth2/v2.1/token\n* - UserInfo endpoint: https://api.line.me/oauth2/v2.1/userinfo\n* - Verify ID token: https://api.line.me/oauth2/v2.1/verify\n*\n* Docs: https://developers.line.biz/en/reference/line-login/#issue-access-token\n*/\nconst line = (options) => {\n\tconst authorizationEndpoint = \"https://access.line.me/oauth2/v2.1/authorize\";\n\tconst tokenEndpoint = \"https://api.line.me/oauth2/v2.1/token\";\n\tconst userInfoEndpoint = \"https://api.line.me/oauth2/v2.1/userinfo\";\n\tconst verifyIdTokenEndpoint = \"https://api.line.me/oauth2/v2.1/verify\";\n\treturn {\n\t\tid: \"line\",\n\t\tname: \"LINE\",\n\t\tasync createAuthorizationURL({ state, scopes, codeVerifier, redirectURI, loginHint }) {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\n\t\t\t\t\"openid\",\n\t\t\t\t\"profile\",\n\t\t\t\t\"email\"\n\t\t\t];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn await createAuthorizationURL({\n\t\t\t\tid: \"line\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint,\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\tloginHint\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\tasync verifyIdToken(token, nonce) {\n\t\t\tif (options.disableIdTokenSignIn) return false;\n\t\t\tif (options.verifyIdToken) return options.verifyIdToken(token, nonce);\n\t\t\tconst body = new URLSearchParams();\n\t\t\tbody.set(\"id_token\", token);\n\t\t\tbody.set(\"client_id\", options.clientId);\n\t\t\tif (nonce) body.set(\"nonce\", nonce);\n\t\t\tconst { data, error } = await betterFetch(verifyIdTokenEndpoint, {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: { \"content-type\": \"application/x-www-form-urlencoded\" },\n\t\t\t\tbody\n\t\t\t});\n\t\t\tif (error || !data) return false;\n\t\t\tif (data.aud !== options.clientId) return false;\n\t\t\tif (nonce && data.nonce && data.nonce !== nonce) return false;\n\t\t\treturn true;\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tlet profile = null;\n\t\t\tif (token.idToken) try {\n\t\t\t\tprofile = decodeJwt(token.idToken);\n\t\t\t} catch {}\n\t\t\tif (!profile) {\n\t\t\t\tconst { data } = await betterFetch(userInfoEndpoint, { headers: { authorization: `Bearer ${token.accessToken}` } });\n\t\t\t\tprofile = data || null;\n\t\t\t}\n\t\t\tif (!profile) return null;\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\tconst id = profile.sub || profile.userId;\n\t\t\tconst name = profile.name || profile.displayName;\n\t\t\tconst image = profile.picture || profile.pictureUrl || void 0;\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid,\n\t\t\t\t\tname,\n\t\t\t\t\temail: profile.email,\n\t\t\t\t\timage,\n\t\t\t\t\temailVerified: false,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/linear.ts\nconst linear = (options) => {\n\tconst tokenEndpoint = \"https://api.linear.app/oauth/token\";\n\treturn {\n\t\tid: \"linear\",\n\t\tname: \"Linear\",\n\t\tcreateAuthorizationURL({ state, scopes, loginHint, redirectURI }) {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\"read\"];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn createAuthorizationURL({\n\t\t\t\tid: \"linear\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://linear.app/oauth/authorize\",\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tredirectURI,\n\t\t\t\tloginHint\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data: profile, error } = await betterFetch(\"https://api.linear.app/graphql\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: {\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\tAuthorization: `Bearer ${token.accessToken}`\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify({ query: `\n\t\t\t\t\t\t\tquery {\n\t\t\t\t\t\t\t\tviewer {\n\t\t\t\t\t\t\t\t\tid\n\t\t\t\t\t\t\t\t\tname\n\t\t\t\t\t\t\t\t\temail\n\t\t\t\t\t\t\t\t\tavatarUrl\n\t\t\t\t\t\t\t\t\tactive\n\t\t\t\t\t\t\t\t\tcreatedAt\n\t\t\t\t\t\t\t\t\tupdatedAt\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t` })\n\t\t\t});\n\t\t\tif (error || !profile?.data?.viewer) return null;\n\t\t\tconst userData = profile.data.viewer;\n\t\t\tconst userMap = await options.mapProfileToUser?.(userData);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile.data.viewer.id,\n\t\t\t\t\tname: profile.data.viewer.name,\n\t\t\t\t\temail: profile.data.viewer.email,\n\t\t\t\t\timage: profile.data.viewer.avatarUrl,\n\t\t\t\t\temailVerified: false,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: userData\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/linkedin.ts\nconst linkedin = (options) => {\n\tconst authorizationEndpoint = \"https://www.linkedin.com/oauth/v2/authorization\";\n\tconst tokenEndpoint = \"https://www.linkedin.com/oauth/v2/accessToken\";\n\treturn {\n\t\tid: \"linkedin\",\n\t\tname: \"Linkedin\",\n\t\tcreateAuthorizationURL: async ({ state, scopes, redirectURI, loginHint }) => {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\n\t\t\t\t\"profile\",\n\t\t\t\t\"email\",\n\t\t\t\t\"openid\"\n\t\t\t];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn await createAuthorizationURL({\n\t\t\t\tid: \"linkedin\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint,\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tloginHint,\n\t\t\t\tredirectURI\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, redirectURI }) => {\n\t\t\treturn await validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data: profile, error } = await betterFetch(\"https://api.linkedin.com/v2/userinfo\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\theaders: { Authorization: `Bearer ${token.accessToken}` }\n\t\t\t});\n\t\t\tif (error) return null;\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile.sub,\n\t\t\t\t\tname: profile.name,\n\t\t\t\t\temail: profile.email,\n\t\t\t\t\temailVerified: profile.email_verified || false,\n\t\t\t\t\timage: profile.picture,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/microsoft-entra-id.ts\nconst microsoft = (options) => {\n\tconst tenant = options.tenantId || \"common\";\n\tconst authority = options.authority || \"https://login.microsoftonline.com\";\n\tconst authorizationEndpoint = `${authority}/${tenant}/oauth2/v2.0/authorize`;\n\tconst tokenEndpoint = `${authority}/${tenant}/oauth2/v2.0/token`;\n\treturn {\n\t\tid: \"microsoft\",\n\t\tname: \"Microsoft EntraID\",\n\t\tcreateAuthorizationURL(data) {\n\t\t\tconst scopes = options.disableDefaultScope ? [] : [\n\t\t\t\t\"openid\",\n\t\t\t\t\"profile\",\n\t\t\t\t\"email\",\n\t\t\t\t\"User.Read\",\n\t\t\t\t\"offline_access\"\n\t\t\t];\n\t\t\tif (options.scope) scopes.push(...options.scope);\n\t\t\tif (data.scopes) scopes.push(...data.scopes);\n\t\t\treturn createAuthorizationURL({\n\t\t\t\tid: \"microsoft\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint,\n\t\t\t\tstate: data.state,\n\t\t\t\tcodeVerifier: data.codeVerifier,\n\t\t\t\tscopes,\n\t\t\t\tredirectURI: data.redirectURI,\n\t\t\t\tprompt: options.prompt,\n\t\t\t\tloginHint: data.loginHint\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode({ code, codeVerifier, redirectURI }) {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tif (!token.idToken) return null;\n\t\t\tconst user = decodeJwt(token.idToken);\n\t\t\tconst profilePhotoSize = options.profilePhotoSize || 48;\n\t\t\tawait betterFetch(`https://graph.microsoft.com/v1.0/me/photos/${profilePhotoSize}x${profilePhotoSize}/$value`, {\n\t\t\t\theaders: { Authorization: `Bearer ${token.accessToken}` },\n\t\t\t\tasync onResponse(context) {\n\t\t\t\t\tif (options.disableProfilePhoto || !context.response.ok) return;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst pictureBuffer = await context.response.clone().arrayBuffer();\n\t\t\t\t\t\tuser.picture = `data:image/jpeg;base64, ${base64.encode(pictureBuffer)}`;\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlogger.error(e && typeof e === \"object\" && \"name\" in e ? e.name : \"\", e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst userMap = await options.mapProfileToUser?.(user);\n\t\t\tconst emailVerified = user.email_verified !== void 0 ? user.email_verified : user.email && (user.verified_primary_email?.includes(user.email) || user.verified_secondary_email?.includes(user.email)) ? true : false;\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: user.sub,\n\t\t\t\t\tname: user.name,\n\t\t\t\t\temail: user.email,\n\t\t\t\t\timage: user.picture,\n\t\t\t\t\temailVerified,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: user\n\t\t\t};\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\tconst scopes = options.disableDefaultScope ? [] : [\n\t\t\t\t\"openid\",\n\t\t\t\t\"profile\",\n\t\t\t\t\"email\",\n\t\t\t\t\"User.Read\",\n\t\t\t\t\"offline_access\"\n\t\t\t];\n\t\t\tif (options.scope) scopes.push(...options.scope);\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\textraParams: { scope: scopes.join(\" \") },\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/naver.ts\nconst naver = (options) => {\n\treturn {\n\t\tid: \"naver\",\n\t\tname: \"Naver\",\n\t\tcreateAuthorizationURL({ state, scopes, redirectURI }) {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\"profile\", \"email\"];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn createAuthorizationURL({\n\t\t\t\tid: \"naver\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://nid.naver.com/oauth2.0/authorize\",\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tredirectURI\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint: \"https://nid.naver.com/oauth2.0/token\"\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint: \"https://nid.naver.com/oauth2.0/token\"\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data: profile, error } = await betterFetch(\"https://openapi.naver.com/v1/nid/me\", { headers: { Authorization: `Bearer ${token.accessToken}` } });\n\t\t\tif (error || !profile || profile.resultcode !== \"00\") return null;\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\tconst res = profile.response || {};\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: res.id,\n\t\t\t\t\tname: res.name || res.nickname,\n\t\t\t\t\temail: res.email,\n\t\t\t\t\timage: res.profile_image,\n\t\t\t\t\temailVerified: false,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/notion.ts\nconst notion = (options) => {\n\tconst tokenEndpoint = \"https://api.notion.com/v1/oauth/token\";\n\treturn {\n\t\tid: \"notion\",\n\t\tname: \"Notion\",\n\t\tcreateAuthorizationURL({ state, scopes, loginHint, redirectURI }) {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn createAuthorizationURL({\n\t\t\t\tid: \"notion\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://api.notion.com/v1/oauth/authorize\",\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tredirectURI,\n\t\t\t\tloginHint,\n\t\t\t\tadditionalParams: { owner: \"user\" }\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint,\n\t\t\t\tauthentication: \"basic\"\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data: profile, error } = await betterFetch(\"https://api.notion.com/v1/users/me\", { headers: {\n\t\t\t\tAuthorization: `Bearer ${token.accessToken}`,\n\t\t\t\t\"Notion-Version\": \"2022-06-28\"\n\t\t\t} });\n\t\t\tif (error || !profile) return null;\n\t\t\tconst userProfile = profile.bot?.owner?.user;\n\t\t\tif (!userProfile) return null;\n\t\t\tconst userMap = await options.mapProfileToUser?.(userProfile);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: userProfile.id,\n\t\t\t\t\tname: userProfile.name || \"Notion User\",\n\t\t\t\t\temail: userProfile.person?.email || null,\n\t\t\t\t\timage: userProfile.avatar_url,\n\t\t\t\t\temailVerified: !!userProfile.person?.email,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: userProfile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/paybin.ts\nconst paybin = (options) => {\n\tconst issuer = options.issuer || \"https://idp.paybin.io\";\n\tconst authorizationEndpoint = `${issuer}/oauth2/authorize`;\n\tconst tokenEndpoint = `${issuer}/oauth2/token`;\n\treturn {\n\t\tid: \"paybin\",\n\t\tname: \"Paybin\",\n\t\tasync createAuthorizationURL({ state, scopes, codeVerifier, redirectURI, loginHint }) {\n\t\t\tif (!options.clientId || !options.clientSecret) {\n\t\t\t\tlogger.error(\"Client Id and Client Secret is required for Paybin. Make sure to provide them in the options.\");\n\t\t\t\tthrow new BetterAuthError(\"CLIENT_ID_AND_SECRET_REQUIRED\");\n\t\t\t}\n\t\t\tif (!codeVerifier) throw new BetterAuthError(\"codeVerifier is required for Paybin\");\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\n\t\t\t\t\"openid\",\n\t\t\t\t\"email\",\n\t\t\t\t\"profile\"\n\t\t\t];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn await createAuthorizationURL({\n\t\t\t\tid: \"paybin\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint,\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\tprompt: options.prompt,\n\t\t\t\tloginHint\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tif (!token.idToken) return null;\n\t\t\tconst user = decodeJwt(token.idToken);\n\t\t\tconst userMap = await options.mapProfileToUser?.(user);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: user.sub,\n\t\t\t\t\tname: user.name || user.preferred_username || (user.email ? user.email.split(\"@\")[0] : \"User\") || \"User\",\n\t\t\t\t\temail: user.email,\n\t\t\t\t\timage: user.picture,\n\t\t\t\t\temailVerified: user.email_verified || false,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: user\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/paypal.ts\nconst paypal = (options) => {\n\tconst isSandbox = (options.environment || \"sandbox\") === \"sandbox\";\n\tconst authorizationEndpoint = isSandbox ? \"https://www.sandbox.paypal.com/signin/authorize\" : \"https://www.paypal.com/signin/authorize\";\n\tconst tokenEndpoint = isSandbox ? \"https://api-m.sandbox.paypal.com/v1/oauth2/token\" : \"https://api-m.paypal.com/v1/oauth2/token\";\n\tconst userInfoEndpoint = isSandbox ? \"https://api-m.sandbox.paypal.com/v1/identity/oauth2/userinfo\" : \"https://api-m.paypal.com/v1/identity/oauth2/userinfo\";\n\treturn {\n\t\tid: \"paypal\",\n\t\tname: \"PayPal\",\n\t\tasync createAuthorizationURL({ state, codeVerifier, redirectURI }) {\n\t\t\tif (!options.clientId || !options.clientSecret) {\n\t\t\t\tlogger.error(\"Client Id and Client Secret is required for PayPal. Make sure to provide them in the options.\");\n\t\t\t\tthrow new BetterAuthError(\"CLIENT_ID_AND_SECRET_REQUIRED\");\n\t\t\t}\n\t\t\treturn await createAuthorizationURL({\n\t\t\t\tid: \"paypal\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint,\n\t\t\t\tscopes: [],\n\t\t\t\tstate,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\tprompt: options.prompt\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, redirectURI }) => {\n\t\t\t/**\n\t\t\t* PayPal requires Basic Auth for token exchange\n\t\t\t**/\n\t\t\tconst credentials = base64.encode(`${options.clientId}:${options.clientSecret}`);\n\t\t\ttry {\n\t\t\t\tconst response = await betterFetch(tokenEndpoint, {\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\theaders: {\n\t\t\t\t\t\tAuthorization: `Basic ${credentials}`,\n\t\t\t\t\t\tAccept: \"application/json\",\n\t\t\t\t\t\t\"Accept-Language\": \"en_US\",\n\t\t\t\t\t\t\"Content-Type\": \"application/x-www-form-urlencoded\"\n\t\t\t\t\t},\n\t\t\t\t\tbody: new URLSearchParams({\n\t\t\t\t\t\tgrant_type: \"authorization_code\",\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tredirect_uri: redirectURI\n\t\t\t\t\t}).toString()\n\t\t\t\t});\n\t\t\t\tif (!response.data) throw new BetterAuthError(\"FAILED_TO_GET_ACCESS_TOKEN\");\n\t\t\t\tconst data = response.data;\n\t\t\t\treturn {\n\t\t\t\t\taccessToken: data.access_token,\n\t\t\t\t\trefreshToken: data.refresh_token,\n\t\t\t\t\taccessTokenExpiresAt: data.expires_in ? new Date(Date.now() + data.expires_in * 1e3) : void 0,\n\t\t\t\t\tidToken: data.id_token\n\t\t\t\t};\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error(\"PayPal token exchange failed:\", error);\n\t\t\t\tthrow new BetterAuthError(\"FAILED_TO_GET_ACCESS_TOKEN\");\n\t\t\t}\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\tconst credentials = base64.encode(`${options.clientId}:${options.clientSecret}`);\n\t\t\ttry {\n\t\t\t\tconst response = await betterFetch(tokenEndpoint, {\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\theaders: {\n\t\t\t\t\t\tAuthorization: `Basic ${credentials}`,\n\t\t\t\t\t\tAccept: \"application/json\",\n\t\t\t\t\t\t\"Accept-Language\": \"en_US\",\n\t\t\t\t\t\t\"Content-Type\": \"application/x-www-form-urlencoded\"\n\t\t\t\t\t},\n\t\t\t\t\tbody: new URLSearchParams({\n\t\t\t\t\t\tgrant_type: \"refresh_token\",\n\t\t\t\t\t\trefresh_token: refreshToken\n\t\t\t\t\t}).toString()\n\t\t\t\t});\n\t\t\t\tif (!response.data) throw new BetterAuthError(\"FAILED_TO_REFRESH_ACCESS_TOKEN\");\n\t\t\t\tconst data = response.data;\n\t\t\t\treturn {\n\t\t\t\t\taccessToken: data.access_token,\n\t\t\t\t\trefreshToken: data.refresh_token,\n\t\t\t\t\taccessTokenExpiresAt: data.expires_in ? new Date(Date.now() + data.expires_in * 1e3) : void 0\n\t\t\t\t};\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error(\"PayPal token refresh failed:\", error);\n\t\t\t\tthrow new BetterAuthError(\"FAILED_TO_REFRESH_ACCESS_TOKEN\");\n\t\t\t}\n\t\t},\n\t\tasync verifyIdToken(token, nonce) {\n\t\t\tif (options.disableIdTokenSignIn) return false;\n\t\t\tif (options.verifyIdToken) return options.verifyIdToken(token, nonce);\n\t\t\ttry {\n\t\t\t\treturn !!decodeJwt(token).sub;\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error(\"Failed to verify PayPal ID token:\", error);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tif (!token.accessToken) {\n\t\t\t\tlogger.error(\"Access token is required to fetch PayPal user info\");\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tconst response = await betterFetch(`${userInfoEndpoint}?schema=paypalv1.1`, { headers: {\n\t\t\t\t\tAuthorization: `Bearer ${token.accessToken}`,\n\t\t\t\t\tAccept: \"application/json\"\n\t\t\t\t} });\n\t\t\t\tif (!response.data) {\n\t\t\t\t\tlogger.error(\"Failed to fetch user info from PayPal\");\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\tconst userInfo = response.data;\n\t\t\t\tconst userMap = await options.mapProfileToUser?.(userInfo);\n\t\t\t\treturn {\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: userInfo.user_id,\n\t\t\t\t\t\tname: userInfo.name,\n\t\t\t\t\t\temail: userInfo.email,\n\t\t\t\t\t\timage: userInfo.picture,\n\t\t\t\t\t\temailVerified: userInfo.email_verified,\n\t\t\t\t\t\t...userMap\n\t\t\t\t\t},\n\t\t\t\t\tdata: userInfo\n\t\t\t\t};\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error(\"Failed to fetch user info from PayPal:\", error);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/polar.ts\nconst polar = (options) => {\n\treturn {\n\t\tid: \"polar\",\n\t\tname: \"Polar\",\n\t\tcreateAuthorizationURL({ state, scopes, codeVerifier, redirectURI }) {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\n\t\t\t\t\"openid\",\n\t\t\t\t\"profile\",\n\t\t\t\t\"email\"\n\t\t\t];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn createAuthorizationURL({\n\t\t\t\tid: \"polar\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://polar.sh/oauth2/authorize\",\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\tprompt: options.prompt\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint: \"https://api.polar.sh/v1/oauth2/token\"\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint: \"https://api.polar.sh/v1/oauth2/token\"\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data: profile, error } = await betterFetch(\"https://api.polar.sh/v1/oauth2/userinfo\", { headers: { Authorization: `Bearer ${token.accessToken}` } });\n\t\t\tif (error) return null;\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile.id,\n\t\t\t\t\tname: profile.public_name || profile.username,\n\t\t\t\t\temail: profile.email,\n\t\t\t\t\timage: profile.avatar_url,\n\t\t\t\t\temailVerified: profile.email_verified ?? false,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/reddit.ts\nconst reddit = (options) => {\n\treturn {\n\t\tid: \"reddit\",\n\t\tname: \"Reddit\",\n\t\tcreateAuthorizationURL({ state, scopes, redirectURI }) {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\"identity\"];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn createAuthorizationURL({\n\t\t\t\tid: \"reddit\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://www.reddit.com/api/v1/authorize\",\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tredirectURI,\n\t\t\t\tduration: options.duration\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, redirectURI }) => {\n\t\t\tconst body = new URLSearchParams({\n\t\t\t\tgrant_type: \"authorization_code\",\n\t\t\t\tcode,\n\t\t\t\tredirect_uri: options.redirectURI || redirectURI\n\t\t\t});\n\t\t\tconst { data, error } = await betterFetch(\"https://www.reddit.com/api/v1/access_token\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: {\n\t\t\t\t\t\"content-type\": \"application/x-www-form-urlencoded\",\n\t\t\t\t\taccept: \"text/plain\",\n\t\t\t\t\t\"user-agent\": \"better-auth\",\n\t\t\t\t\tAuthorization: `Basic ${base64.encode(`${options.clientId}:${options.clientSecret}`)}`\n\t\t\t\t},\n\t\t\t\tbody: body.toString()\n\t\t\t});\n\t\t\tif (error) throw error;\n\t\t\treturn getOAuth2Tokens(data);\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\tauthentication: \"basic\",\n\t\t\t\ttokenEndpoint: \"https://www.reddit.com/api/v1/access_token\"\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data: profile, error } = await betterFetch(\"https://oauth.reddit.com/api/v1/me\", { headers: {\n\t\t\t\tAuthorization: `Bearer ${token.accessToken}`,\n\t\t\t\t\"User-Agent\": \"better-auth\"\n\t\t\t} });\n\t\t\tif (error) return null;\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile.id,\n\t\t\t\t\tname: profile.name,\n\t\t\t\t\temail: profile.oauth_client_id,\n\t\t\t\t\temailVerified: profile.has_verified_email,\n\t\t\t\t\timage: profile.icon_img?.split(\"?\")[0],\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/roblox.ts\nconst roblox = (options) => {\n\treturn {\n\t\tid: \"roblox\",\n\t\tname: \"Roblox\",\n\t\tcreateAuthorizationURL({ state, scopes, redirectURI }) {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\"openid\", \"profile\"];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn new URL(`https://apis.roblox.com/oauth/v1/authorize?scope=${_scopes.join(\"+\")}&response_type=code&client_id=${options.clientId}&redirect_uri=${encodeURIComponent(options.redirectURI || redirectURI)}&state=${state}&prompt=${options.prompt || \"select_account consent\"}`);\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tredirectURI: options.redirectURI || redirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint: \"https://apis.roblox.com/oauth/v1/token\",\n\t\t\t\tauthentication: \"post\"\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint: \"https://apis.roblox.com/oauth/v1/token\"\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data: profile, error } = await betterFetch(\"https://apis.roblox.com/oauth/v1/userinfo\", { headers: { authorization: `Bearer ${token.accessToken}` } });\n\t\t\tif (error) return null;\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile.sub,\n\t\t\t\t\tname: profile.nickname || profile.preferred_username || \"\",\n\t\t\t\t\timage: profile.picture,\n\t\t\t\t\temail: profile.preferred_username || null,\n\t\t\t\t\temailVerified: false,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: { ...profile }\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/salesforce.ts\nconst salesforce = (options) => {\n\tconst isSandbox = (options.environment ?? \"production\") === \"sandbox\";\n\tconst authorizationEndpoint = options.loginUrl ? `https://${options.loginUrl}/services/oauth2/authorize` : isSandbox ? \"https://test.salesforce.com/services/oauth2/authorize\" : \"https://login.salesforce.com/services/oauth2/authorize\";\n\tconst tokenEndpoint = options.loginUrl ? `https://${options.loginUrl}/services/oauth2/token` : isSandbox ? \"https://test.salesforce.com/services/oauth2/token\" : \"https://login.salesforce.com/services/oauth2/token\";\n\tconst userInfoEndpoint = options.loginUrl ? `https://${options.loginUrl}/services/oauth2/userinfo` : isSandbox ? \"https://test.salesforce.com/services/oauth2/userinfo\" : \"https://login.salesforce.com/services/oauth2/userinfo\";\n\treturn {\n\t\tid: \"salesforce\",\n\t\tname: \"Salesforce\",\n\t\tasync createAuthorizationURL({ state, scopes, codeVerifier, redirectURI }) {\n\t\t\tif (!options.clientId || !options.clientSecret) {\n\t\t\t\tlogger.error(\"Client Id and Client Secret are required for Salesforce. Make sure to provide them in the options.\");\n\t\t\t\tthrow new BetterAuthError(\"CLIENT_ID_AND_SECRET_REQUIRED\");\n\t\t\t}\n\t\t\tif (!codeVerifier) throw new BetterAuthError(\"codeVerifier is required for Salesforce\");\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\n\t\t\t\t\"openid\",\n\t\t\t\t\"email\",\n\t\t\t\t\"profile\"\n\t\t\t];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn createAuthorizationURL({\n\t\t\t\tid: \"salesforce\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint,\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI: options.redirectURI || redirectURI\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI: options.redirectURI || redirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\ttry {\n\t\t\t\tconst { data: user } = await betterFetch(userInfoEndpoint, { headers: { Authorization: `Bearer ${token.accessToken}` } });\n\t\t\t\tif (!user) {\n\t\t\t\t\tlogger.error(\"Failed to fetch user info from Salesforce\");\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\tconst userMap = await options.mapProfileToUser?.(user);\n\t\t\t\treturn {\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: user.user_id,\n\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\timage: user.photos?.picture || user.photos?.thumbnail,\n\t\t\t\t\t\temailVerified: user.email_verified ?? false,\n\t\t\t\t\t\t...userMap\n\t\t\t\t\t},\n\t\t\t\t\tdata: user\n\t\t\t\t};\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error(\"Failed to fetch user info from Salesforce:\", error);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/slack.ts\nconst slack = (options) => {\n\treturn {\n\t\tid: \"slack\",\n\t\tname: \"Slack\",\n\t\tcreateAuthorizationURL({ state, scopes, redirectURI }) {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\n\t\t\t\t\"openid\",\n\t\t\t\t\"profile\",\n\t\t\t\t\"email\"\n\t\t\t];\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tconst url = new URL(\"https://slack.com/openid/connect/authorize\");\n\t\t\turl.searchParams.set(\"scope\", _scopes.join(\" \"));\n\t\t\turl.searchParams.set(\"response_type\", \"code\");\n\t\t\turl.searchParams.set(\"client_id\", options.clientId);\n\t\t\turl.searchParams.set(\"redirect_uri\", options.redirectURI || redirectURI);\n\t\t\turl.searchParams.set(\"state\", state);\n\t\t\treturn url;\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint: \"https://slack.com/api/openid.connect.token\"\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint: \"https://slack.com/api/openid.connect.token\"\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data: profile, error } = await betterFetch(\"https://slack.com/api/openid.connect.userInfo\", { headers: { authorization: `Bearer ${token.accessToken}` } });\n\t\t\tif (error) return null;\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile[\"https://slack.com/user_id\"],\n\t\t\t\t\tname: profile.name || \"\",\n\t\t\t\t\temail: profile.email,\n\t\t\t\t\temailVerified: profile.email_verified,\n\t\t\t\t\timage: profile.picture || profile[\"https://slack.com/user_image_512\"],\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/spotify.ts\nconst spotify = (options) => {\n\treturn {\n\t\tid: \"spotify\",\n\t\tname: \"Spotify\",\n\t\tcreateAuthorizationURL({ state, scopes, codeVerifier, redirectURI }) {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\"user-read-email\"];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn createAuthorizationURL({\n\t\t\t\tid: \"spotify\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://accounts.spotify.com/authorize\",\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint: \"https://accounts.spotify.com/api/token\"\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint: \"https://accounts.spotify.com/api/token\"\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data: profile, error } = await betterFetch(\"https://api.spotify.com/v1/me\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\theaders: { Authorization: `Bearer ${token.accessToken}` }\n\t\t\t});\n\t\t\tif (error) return null;\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile.id,\n\t\t\t\t\tname: profile.display_name,\n\t\t\t\t\temail: profile.email,\n\t\t\t\t\timage: profile.images[0]?.url,\n\t\t\t\t\temailVerified: false,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/tiktok.ts\nconst tiktok = (options) => {\n\treturn {\n\t\tid: \"tiktok\",\n\t\tname: \"TikTok\",\n\t\tcreateAuthorizationURL({ state, scopes, redirectURI }) {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\"user.info.profile\"];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn new URL(`https://www.tiktok.com/v2/auth/authorize?scope=${_scopes.join(\",\")}&response_type=code&client_key=${options.clientKey}&redirect_uri=${encodeURIComponent(options.redirectURI || redirectURI)}&state=${state}`);\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tredirectURI: options.redirectURI || redirectURI,\n\t\t\t\toptions: {\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint: \"https://open.tiktokapis.com/v2/oauth/token/\"\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: { clientSecret: options.clientSecret },\n\t\t\t\ttokenEndpoint: \"https://open.tiktokapis.com/v2/oauth/token/\",\n\t\t\t\tauthentication: \"post\",\n\t\t\t\textraParams: { client_key: options.clientKey }\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data: profile, error } = await betterFetch(`https://open.tiktokapis.com/v2/user/info/?fields=${[\n\t\t\t\t\"open_id\",\n\t\t\t\t\"avatar_large_url\",\n\t\t\t\t\"display_name\",\n\t\t\t\t\"username\"\n\t\t\t].join(\",\")}`, { headers: { authorization: `Bearer ${token.accessToken}` } });\n\t\t\tif (error) return null;\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\temail: profile.data.user.email || profile.data.user.username,\n\t\t\t\t\tid: profile.data.user.open_id,\n\t\t\t\t\tname: profile.data.user.display_name || profile.data.user.username,\n\t\t\t\t\timage: profile.data.user.avatar_large_url,\n\t\t\t\t\temailVerified: profile.data.user.email ? true : false\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/twitch.ts\nconst twitch = (options) => {\n\treturn {\n\t\tid: \"twitch\",\n\t\tname: \"Twitch\",\n\t\tcreateAuthorizationURL({ state, scopes, redirectURI }) {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\"user:read:email\", \"openid\"];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn createAuthorizationURL({\n\t\t\t\tid: \"twitch\",\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://id.twitch.tv/oauth2/authorize\",\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tclaims: options.claims || [\n\t\t\t\t\t\"email\",\n\t\t\t\t\t\"email_verified\",\n\t\t\t\t\t\"preferred_username\",\n\t\t\t\t\t\"picture\"\n\t\t\t\t]\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint: \"https://id.twitch.tv/oauth2/token\"\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint: \"https://id.twitch.tv/oauth2/token\"\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst idToken = token.idToken;\n\t\t\tif (!idToken) {\n\t\t\t\tlogger.error(\"No idToken found in token\");\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tconst profile = decodeJwt(idToken);\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile.sub,\n\t\t\t\t\tname: profile.preferred_username,\n\t\t\t\t\temail: profile.email,\n\t\t\t\t\timage: profile.picture,\n\t\t\t\t\temailVerified: profile.email_verified,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/twitter.ts\nconst twitter = (options) => {\n\treturn {\n\t\tid: \"twitter\",\n\t\tname: \"Twitter\",\n\t\tcreateAuthorizationURL(data) {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\n\t\t\t\t\"users.read\",\n\t\t\t\t\"tweet.read\",\n\t\t\t\t\"offline.access\",\n\t\t\t\t\"users.email\"\n\t\t\t];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (data.scopes) _scopes.push(...data.scopes);\n\t\t\treturn createAuthorizationURL({\n\t\t\t\tid: \"twitter\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://x.com/i/oauth2/authorize\",\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate: data.state,\n\t\t\t\tcodeVerifier: data.codeVerifier,\n\t\t\t\tredirectURI: data.redirectURI\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tcodeVerifier,\n\t\t\t\tauthentication: \"basic\",\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint: \"https://api.x.com/2/oauth2/token\"\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\tauthentication: \"basic\",\n\t\t\t\ttokenEndpoint: \"https://api.x.com/2/oauth2/token\"\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data: profile, error: profileError } = await betterFetch(\"https://api.x.com/2/users/me?user.fields=profile_image_url\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\theaders: { Authorization: `Bearer ${token.accessToken}` }\n\t\t\t});\n\t\t\tif (profileError) return null;\n\t\t\tconst { data: emailData, error: emailError } = await betterFetch(\"https://api.x.com/2/users/me?user.fields=confirmed_email\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\theaders: { Authorization: `Bearer ${token.accessToken}` }\n\t\t\t});\n\t\t\tlet emailVerified = false;\n\t\t\tif (!emailError && emailData?.data?.confirmed_email) {\n\t\t\t\tprofile.data.email = emailData.data.confirmed_email;\n\t\t\t\temailVerified = true;\n\t\t\t}\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile.data.id,\n\t\t\t\t\tname: profile.data.name,\n\t\t\t\t\temail: profile.data.email || profile.data.username || null,\n\t\t\t\t\timage: profile.data.profile_image_url,\n\t\t\t\t\temailVerified,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/vercel.ts\nconst vercel = (options) => {\n\treturn {\n\t\tid: \"vercel\",\n\t\tname: \"Vercel\",\n\t\tcreateAuthorizationURL({ state, scopes, codeVerifier, redirectURI }) {\n\t\t\tif (!codeVerifier) throw new BetterAuthError(\"codeVerifier is required for Vercel\");\n\t\t\tlet _scopes = void 0;\n\t\t\tif (options.scope !== void 0 || scopes !== void 0) {\n\t\t\t\t_scopes = [];\n\t\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\t}\n\t\t\treturn createAuthorizationURL({\n\t\t\t\tid: \"vercel\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://vercel.com/oauth/authorize\",\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint: \"https://api.vercel.com/login/oauth/token\"\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data: profile, error } = await betterFetch(\"https://api.vercel.com/login/oauth/userinfo\", { headers: { Authorization: `Bearer ${token.accessToken}` } });\n\t\t\tif (error || !profile) return null;\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile.sub,\n\t\t\t\t\tname: profile.name ?? profile.preferred_username,\n\t\t\t\t\temail: profile.email,\n\t\t\t\t\timage: profile.picture,\n\t\t\t\t\temailVerified: profile.email_verified ?? false,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/vk.ts\nconst vk = (options) => {\n\treturn {\n\t\tid: \"vk\",\n\t\tname: \"VK\",\n\t\tasync createAuthorizationURL({ state, scopes, codeVerifier, redirectURI }) {\n\t\t\tconst _scopes = options.disableDefaultScope ? [] : [\"email\", \"phone\"];\n\t\t\tif (options.scope) _scopes.push(...options.scope);\n\t\t\tif (scopes) _scopes.push(...scopes);\n\t\t\treturn createAuthorizationURL({\n\t\t\t\tid: \"vk\",\n\t\t\t\toptions,\n\t\t\t\tauthorizationEndpoint: \"https://id.vk.com/authorize\",\n\t\t\t\tscopes: _scopes,\n\t\t\t\tstate,\n\t\t\t\tredirectURI,\n\t\t\t\tcodeVerifier\n\t\t\t});\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, codeVerifier, redirectURI, deviceId }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tcodeVerifier,\n\t\t\t\tredirectURI: options.redirectURI || redirectURI,\n\t\t\t\toptions,\n\t\t\t\tdeviceId,\n\t\t\t\ttokenEndpoint: \"https://id.vk.com/oauth2/auth\"\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n\t\t\treturn refreshAccessToken({\n\t\t\t\trefreshToken,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId: options.clientId,\n\t\t\t\t\tclientKey: options.clientKey,\n\t\t\t\t\tclientSecret: options.clientSecret\n\t\t\t\t},\n\t\t\t\ttokenEndpoint: \"https://id.vk.com/oauth2/auth\"\n\t\t\t});\n\t\t},\n\t\tasync getUserInfo(data) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(data);\n\t\t\tif (!data.accessToken) return null;\n\t\t\tconst formBody = new URLSearchParams({\n\t\t\t\taccess_token: data.accessToken,\n\t\t\t\tclient_id: options.clientId\n\t\t\t}).toString();\n\t\t\tconst { data: profile, error } = await betterFetch(\"https://id.vk.com/oauth2/user_info\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n\t\t\t\tbody: formBody\n\t\t\t});\n\t\t\tif (error) return null;\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\tif (!profile.user.email && !userMap?.email) return null;\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile.user.user_id,\n\t\t\t\t\tfirst_name: profile.user.first_name,\n\t\t\t\t\tlast_name: profile.user.last_name,\n\t\t\t\t\temail: profile.user.email,\n\t\t\t\t\timage: profile.user.avatar,\n\t\t\t\t\temailVerified: !!profile.user.email,\n\t\t\t\t\tbirthday: profile.user.birthday,\n\t\t\t\t\tsex: profile.user.sex,\n\t\t\t\t\tname: `${profile.user.first_name} ${profile.user.last_name}`,\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: profile\n\t\t\t};\n\t\t},\n\t\toptions\n\t};\n};\n\n//#endregion\n//#region src/social-providers/zoom.ts\nconst zoom = (userOptions) => {\n\tconst options = {\n\t\tpkce: true,\n\t\t...userOptions\n\t};\n\treturn {\n\t\tid: \"zoom\",\n\t\tname: \"Zoom\",\n\t\tcreateAuthorizationURL: async ({ state, redirectURI, codeVerifier }) => {\n\t\t\tconst params = new URLSearchParams({\n\t\t\t\tresponse_type: \"code\",\n\t\t\t\tredirect_uri: options.redirectURI ? options.redirectURI : redirectURI,\n\t\t\t\tclient_id: options.clientId,\n\t\t\t\tstate\n\t\t\t});\n\t\t\tif (options.pkce) {\n\t\t\t\tconst codeChallenge = await generateCodeChallenge(codeVerifier);\n\t\t\t\tparams.set(\"code_challenge_method\", \"S256\");\n\t\t\t\tparams.set(\"code_challenge\", codeChallenge);\n\t\t\t}\n\t\t\tconst url = new URL(\"https://zoom.us/oauth/authorize\");\n\t\t\turl.search = params.toString();\n\t\t\treturn url;\n\t\t},\n\t\tvalidateAuthorizationCode: async ({ code, redirectURI, codeVerifier }) => {\n\t\t\treturn validateAuthorizationCode({\n\t\t\t\tcode,\n\t\t\t\tredirectURI: options.redirectURI || redirectURI,\n\t\t\t\tcodeVerifier,\n\t\t\t\toptions,\n\t\t\t\ttokenEndpoint: \"https://zoom.us/oauth/token\",\n\t\t\t\tauthentication: \"post\"\n\t\t\t});\n\t\t},\n\t\trefreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => refreshAccessToken({\n\t\t\trefreshToken,\n\t\t\toptions: {\n\t\t\t\tclientId: options.clientId,\n\t\t\t\tclientKey: options.clientKey,\n\t\t\t\tclientSecret: options.clientSecret\n\t\t\t},\n\t\t\ttokenEndpoint: \"https://zoom.us/oauth/token\"\n\t\t}),\n\t\tasync getUserInfo(token) {\n\t\t\tif (options.getUserInfo) return options.getUserInfo(token);\n\t\t\tconst { data: profile, error } = await betterFetch(\"https://api.zoom.us/v2/users/me\", { headers: { authorization: `Bearer ${token.accessToken}` } });\n\t\t\tif (error) return null;\n\t\t\tconst userMap = await options.mapProfileToUser?.(profile);\n\t\t\treturn {\n\t\t\t\tuser: {\n\t\t\t\t\tid: profile.id,\n\t\t\t\t\tname: profile.display_name,\n\t\t\t\t\timage: profile.pic_url,\n\t\t\t\t\temail: profile.email,\n\t\t\t\t\temailVerified: Boolean(profile.verified),\n\t\t\t\t\t...userMap\n\t\t\t\t},\n\t\t\t\tdata: { ...profile }\n\t\t\t};\n\t\t}\n\t};\n};\n\n//#endregion\n//#region src/social-providers/index.ts\nconst socialProviders = {\n\tapple,\n\tatlassian,\n\tcognito,\n\tdiscord,\n\tfacebook,\n\tfigma,\n\tgithub,\n\tmicrosoft,\n\tgoogle,\n\thuggingface,\n\tslack,\n\tspotify,\n\ttwitch,\n\ttwitter,\n\tdropbox,\n\tkick,\n\tlinear,\n\tlinkedin,\n\tgitlab,\n\ttiktok,\n\treddit,\n\troblox,\n\tsalesforce,\n\tvk,\n\tzoom,\n\tnotion,\n\tkakao,\n\tnaver,\n\tline,\n\tpaybin,\n\tpaypal,\n\tpolar,\n\tvercel\n};\nconst socialProviderList = Object.keys(socialProviders);\nconst SocialProviderListEnum = z.enum(socialProviderList).or(z.string());\n\n//#endregion\nexport { SocialProviderListEnum, apple, atlassian, cognito, discord, dropbox, facebook, figma, getApplePublicKey, getCognitoPublicKey, github, gitlab, google, huggingface, kakao, kick, line, linear, linkedin, microsoft, naver, notion, paybin, paypal, polar, reddit, roblox, salesforce, slack, socialProviderList, socialProviders, spotify, tiktok, twitch, twitter, vercel, vk, zoom };","import { iife } from \"./tracing-utils.js\";\nimport { npmVersion } from \"./version.js\";\nlet otel;\nlet rawTracer;\nconst tracer = {\n  startActiveSpan(name, fn) {\n    if (!otel) {\n      return fn();\n    }\n    if (!rawTracer) {\n      rawTracer = otel.trace.getTracer(\"drizzle-orm\", npmVersion);\n    }\n    return iife(\n      (otel2, rawTracer2) => rawTracer2.startActiveSpan(\n        name,\n        (span) => {\n          try {\n            return fn(span);\n          } catch (e) {\n            span.setStatus({\n              code: otel2.SpanStatusCode.ERROR,\n              message: e instanceof Error ? e.message : \"Unknown error\"\n              // eslint-disable-line no-instanceof/no-instanceof\n            });\n            throw e;\n          } finally {\n            span.end();\n          }\n        }\n      ),\n      otel,\n      rawTracer\n    );\n  }\n};\nexport {\n  tracer\n};\n//# sourceMappingURL=tracing.js.map","import { t as createAccessControl } from \"./access-Dx8TLKnw.mjs\";\n\n//#region src/plugins/organization/access/statement.ts\nconst defaultStatements = {\n\torganization: [\"update\", \"delete\"],\n\tmember: [\n\t\t\"create\",\n\t\t\"update\",\n\t\t\"delete\"\n\t],\n\tinvitation: [\"create\", \"cancel\"],\n\tteam: [\n\t\t\"create\",\n\t\t\"update\",\n\t\t\"delete\"\n\t],\n\tac: [\n\t\t\"create\",\n\t\t\"read\",\n\t\t\"update\",\n\t\t\"delete\"\n\t]\n};\nconst defaultAc = createAccessControl(defaultStatements);\nconst adminAc = defaultAc.newRole({\n\torganization: [\"update\"],\n\tinvitation: [\"create\", \"cancel\"],\n\tmember: [\n\t\t\"create\",\n\t\t\"update\",\n\t\t\"delete\"\n\t],\n\tteam: [\n\t\t\"create\",\n\t\t\"update\",\n\t\t\"delete\"\n\t],\n\tac: [\n\t\t\"create\",\n\t\t\"read\",\n\t\t\"update\",\n\t\t\"delete\"\n\t]\n});\nconst ownerAc = defaultAc.newRole({\n\torganization: [\"update\", \"delete\"],\n\tmember: [\n\t\t\"create\",\n\t\t\"update\",\n\t\t\"delete\"\n\t],\n\tinvitation: [\"create\", \"cancel\"],\n\tteam: [\n\t\t\"create\",\n\t\t\"update\",\n\t\t\"delete\"\n\t],\n\tac: [\n\t\t\"create\",\n\t\t\"read\",\n\t\t\"update\",\n\t\t\"delete\"\n\t]\n});\nconst memberAc = defaultAc.newRole({\n\torganization: [],\n\tmember: [],\n\tinvitation: [],\n\tteam: [],\n\tac: [\"read\"]\n});\nconst defaultRoles = {\n\tadmin: adminAc,\n\towner: ownerAc,\n\tmember: memberAc\n};\n\n//#endregion\nexport { memberAc as a, defaultStatements as i, defaultAc as n, ownerAc as o, defaultRoles as r, adminAc as t };","import { entityKind } from \"../../entity.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgBooleanBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgBooleanBuilder\";\n  constructor(name) {\n    super(name, \"boolean\", \"PgBoolean\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgBoolean(table, this.config);\n  }\n}\nclass PgBoolean extends PgColumn {\n  static [entityKind] = \"PgBoolean\";\n  getSQLType() {\n    return \"boolean\";\n  }\n}\nfunction boolean(name) {\n  return new PgBooleanBuilder(name ?? \"\");\n}\nexport {\n  PgBoolean,\n  PgBooleanBuilder,\n  boolean\n};\n//# sourceMappingURL=boolean.js.map","import { entityKind } from \"../../entity.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgCidrBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgCidrBuilder\";\n  constructor(name) {\n    super(name, \"string\", \"PgCidr\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgCidr(table, this.config);\n  }\n}\nclass PgCidr extends PgColumn {\n  static [entityKind] = \"PgCidr\";\n  getSQLType() {\n    return \"cidr\";\n  }\n}\nfunction cidr(name) {\n  return new PgCidrBuilder(name ?? \"\");\n}\nexport {\n  PgCidr,\n  PgCidrBuilder,\n  cidr\n};\n//# sourceMappingURL=cidr.js.map","import { entityKind } from \"../../entity.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgDoublePrecisionBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgDoublePrecisionBuilder\";\n  constructor(name) {\n    super(name, \"number\", \"PgDoublePrecision\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgDoublePrecision(\n      table,\n      this.config\n    );\n  }\n}\nclass PgDoublePrecision extends PgColumn {\n  static [entityKind] = \"PgDoublePrecision\";\n  getSQLType() {\n    return \"double precision\";\n  }\n  mapFromDriverValue(value) {\n    if (typeof value === \"string\") {\n      return Number.parseFloat(value);\n    }\n    return value;\n  }\n}\nfunction doublePrecision(name) {\n  return new PgDoublePrecisionBuilder(name ?? \"\");\n}\nexport {\n  PgDoublePrecision,\n  PgDoublePrecisionBuilder,\n  doublePrecision\n};\n//# sourceMappingURL=double-precision.js.map","import { entityKind } from \"../../entity.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgInetBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgInetBuilder\";\n  constructor(name) {\n    super(name, \"string\", \"PgInet\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgInet(table, this.config);\n  }\n}\nclass PgInet extends PgColumn {\n  static [entityKind] = \"PgInet\";\n  getSQLType() {\n    return \"inet\";\n  }\n}\nfunction inet(name) {\n  return new PgInetBuilder(name ?? \"\");\n}\nexport {\n  PgInet,\n  PgInetBuilder,\n  inet\n};\n//# sourceMappingURL=inet.js.map","import { entityKind } from \"../../entity.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgJsonBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgJsonBuilder\";\n  constructor(name) {\n    super(name, \"json\", \"PgJson\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgJson(table, this.config);\n  }\n}\nclass PgJson extends PgColumn {\n  static [entityKind] = \"PgJson\";\n  constructor(table, config) {\n    super(table, config);\n  }\n  getSQLType() {\n    return \"json\";\n  }\n  mapToDriverValue(value) {\n    return JSON.stringify(value);\n  }\n  mapFromDriverValue(value) {\n    if (typeof value === \"string\") {\n      try {\n        return JSON.parse(value);\n      } catch {\n        return value;\n      }\n    }\n    return value;\n  }\n}\nfunction json(name) {\n  return new PgJsonBuilder(name ?? \"\");\n}\nexport {\n  PgJson,\n  PgJsonBuilder,\n  json\n};\n//# sourceMappingURL=json.js.map","import { entityKind } from \"../../entity.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgJsonbBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgJsonbBuilder\";\n  constructor(name) {\n    super(name, \"json\", \"PgJsonb\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgJsonb(table, this.config);\n  }\n}\nclass PgJsonb extends PgColumn {\n  static [entityKind] = \"PgJsonb\";\n  constructor(table, config) {\n    super(table, config);\n  }\n  getSQLType() {\n    return \"jsonb\";\n  }\n  mapToDriverValue(value) {\n    return JSON.stringify(value);\n  }\n  mapFromDriverValue(value) {\n    if (typeof value === \"string\") {\n      try {\n        return JSON.parse(value);\n      } catch {\n        return value;\n      }\n    }\n    return value;\n  }\n}\nfunction jsonb(name) {\n  return new PgJsonbBuilder(name ?? \"\");\n}\nexport {\n  PgJsonb,\n  PgJsonbBuilder,\n  jsonb\n};\n//# sourceMappingURL=jsonb.js.map","import { entityKind } from \"../../entity.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgMacaddrBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgMacaddrBuilder\";\n  constructor(name) {\n    super(name, \"string\", \"PgMacaddr\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgMacaddr(table, this.config);\n  }\n}\nclass PgMacaddr extends PgColumn {\n  static [entityKind] = \"PgMacaddr\";\n  getSQLType() {\n    return \"macaddr\";\n  }\n}\nfunction macaddr(name) {\n  return new PgMacaddrBuilder(name ?? \"\");\n}\nexport {\n  PgMacaddr,\n  PgMacaddrBuilder,\n  macaddr\n};\n//# sourceMappingURL=macaddr.js.map","import { entityKind } from \"../../entity.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgMacaddr8Builder extends PgColumnBuilder {\n  static [entityKind] = \"PgMacaddr8Builder\";\n  constructor(name) {\n    super(name, \"string\", \"PgMacaddr8\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgMacaddr8(table, this.config);\n  }\n}\nclass PgMacaddr8 extends PgColumn {\n  static [entityKind] = \"PgMacaddr8\";\n  getSQLType() {\n    return \"macaddr8\";\n  }\n}\nfunction macaddr8(name) {\n  return new PgMacaddr8Builder(name ?? \"\");\n}\nexport {\n  PgMacaddr8,\n  PgMacaddr8Builder,\n  macaddr8\n};\n//# sourceMappingURL=macaddr8.js.map","import { BetterAuthError } from \"@better-auth/core/error\";\n\n//#region src/plugins/access/access.ts\nfunction role(statements) {\n\treturn {\n\t\tauthorize(request, connector = \"AND\") {\n\t\t\tlet success = false;\n\t\t\tfor (const [requestedResource, requestedActions] of Object.entries(request)) {\n\t\t\t\tconst allowedActions = statements[requestedResource];\n\t\t\t\tif (!allowedActions) return {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\terror: `You are not allowed to access resource: ${requestedResource}`\n\t\t\t\t};\n\t\t\t\tif (Array.isArray(requestedActions)) success = requestedActions.every((requestedAction) => allowedActions.includes(requestedAction));\n\t\t\t\telse if (typeof requestedActions === \"object\") {\n\t\t\t\t\tconst actions = requestedActions;\n\t\t\t\t\tif (actions.connector === \"OR\") success = actions.actions.some((requestedAction) => allowedActions.includes(requestedAction));\n\t\t\t\t\telse success = actions.actions.every((requestedAction) => allowedActions.includes(requestedAction));\n\t\t\t\t} else throw new BetterAuthError(\"Invalid access control request\");\n\t\t\t\tif (success && connector === \"OR\") return { success };\n\t\t\t\tif (!success && connector === \"AND\") return {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\terror: `unauthorized to access resource \"${requestedResource}\"`\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (success) return { success };\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Not authorized\"\n\t\t\t};\n\t\t},\n\t\tstatements\n\t};\n}\nfunction createAccessControl(s) {\n\treturn {\n\t\tnewRole(statements) {\n\t\t\treturn role(statements);\n\t\t},\n\t\tstatements: s\n\t};\n}\n\n//#endregion\nexport { role as n, createAccessControl as t };","import { t as createAccessControl } from \"./access-Dx8TLKnw.mjs\";\n\n//#region src/plugins/admin/access/statement.ts\nconst defaultStatements = {\n\tuser: [\n\t\t\"create\",\n\t\t\"list\",\n\t\t\"set-role\",\n\t\t\"ban\",\n\t\t\"impersonate\",\n\t\t\"delete\",\n\t\t\"set-password\",\n\t\t\"get\",\n\t\t\"update\"\n\t],\n\tsession: [\n\t\t\"list\",\n\t\t\"revoke\",\n\t\t\"delete\"\n\t]\n};\nconst defaultAc = createAccessControl(defaultStatements);\nconst adminAc = defaultAc.newRole({\n\tuser: [\n\t\t\"create\",\n\t\t\"list\",\n\t\t\"set-role\",\n\t\t\"ban\",\n\t\t\"impersonate\",\n\t\t\"delete\",\n\t\t\"set-password\",\n\t\t\"get\",\n\t\t\"update\"\n\t],\n\tsession: [\n\t\t\"list\",\n\t\t\"revoke\",\n\t\t\"delete\"\n\t]\n});\nconst userAc = defaultAc.newRole({\n\tuser: [],\n\tsession: []\n});\nconst defaultRoles = {\n\tadmin: adminAc,\n\tuser: userAc\n};\n\n//#endregion\nexport { userAc as a, defaultStatements as i, defaultAc as n, defaultRoles as r, adminAc as t };","import { entityKind } from \"../../entity.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgRealBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgRealBuilder\";\n  constructor(name, length) {\n    super(name, \"number\", \"PgReal\");\n    this.config.length = length;\n  }\n  /** @internal */\n  build(table) {\n    return new PgReal(table, this.config);\n  }\n}\nclass PgReal extends PgColumn {\n  static [entityKind] = \"PgReal\";\n  constructor(table, config) {\n    super(table, config);\n  }\n  getSQLType() {\n    return \"real\";\n  }\n  mapFromDriverValue = (value) => {\n    if (typeof value === \"string\") {\n      return Number.parseFloat(value);\n    }\n    return value;\n  };\n}\nfunction real(name) {\n  return new PgRealBuilder(name ?? \"\");\n}\nexport {\n  PgReal,\n  PgRealBuilder,\n  real\n};\n//# sourceMappingURL=real.js.map","import { entityKind } from \"../../entity.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgSerialBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgSerialBuilder\";\n  constructor(name) {\n    super(name, \"number\", \"PgSerial\");\n    this.config.hasDefault = true;\n    this.config.notNull = true;\n  }\n  /** @internal */\n  build(table) {\n    return new PgSerial(table, this.config);\n  }\n}\nclass PgSerial extends PgColumn {\n  static [entityKind] = \"PgSerial\";\n  getSQLType() {\n    return \"serial\";\n  }\n}\nfunction serial(name) {\n  return new PgSerialBuilder(name ?? \"\");\n}\nexport {\n  PgSerial,\n  PgSerialBuilder,\n  serial\n};\n//# sourceMappingURL=serial.js.map","import { entityKind } from \"../../entity.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgSmallSerialBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgSmallSerialBuilder\";\n  constructor(name) {\n    super(name, \"number\", \"PgSmallSerial\");\n    this.config.hasDefault = true;\n    this.config.notNull = true;\n  }\n  /** @internal */\n  build(table) {\n    return new PgSmallSerial(\n      table,\n      this.config\n    );\n  }\n}\nclass PgSmallSerial extends PgColumn {\n  static [entityKind] = \"PgSmallSerial\";\n  getSQLType() {\n    return \"smallserial\";\n  }\n}\nfunction smallserial(name) {\n  return new PgSmallSerialBuilder(name ?? \"\");\n}\nexport {\n  PgSmallSerial,\n  PgSmallSerialBuilder,\n  smallserial\n};\n//# sourceMappingURL=smallserial.js.map","import { APIError } from \"better-call\";\n\n//#region src/utils/password.ts\nasync function validatePassword(ctx, data) {\n\tconst credentialAccount = (await ctx.context.internalAdapter.findAccounts(data.userId))?.find((account) => account.providerId === \"credential\");\n\tconst currentPassword = credentialAccount?.password;\n\tif (!credentialAccount || !currentPassword) return false;\n\treturn await ctx.context.password.verify({\n\t\thash: currentPassword,\n\t\tpassword: data.password\n\t});\n}\nasync function checkPassword(userId, c) {\n\tconst credentialAccount = (await c.context.internalAdapter.findAccounts(userId))?.find((account) => account.providerId === \"credential\");\n\tconst currentPassword = credentialAccount?.password;\n\tif (!credentialAccount || !currentPassword || !c.body.password) throw new APIError(\"BAD_REQUEST\", { message: \"No password credential found\" });\n\tif (!await c.context.password.verify({\n\t\thash: currentPassword,\n\t\tpassword: c.body.password\n\t})) throw new APIError(\"BAD_REQUEST\", { message: \"Invalid password\" });\n\treturn true;\n}\n\n//#endregion\nexport { validatePassword as n, checkPassword as t };","import * as z from \"zod\";\n\n//#region src/db/schema/shared.ts\nconst coreSchema = z.object({\n\tid: z.string(),\n\tcreatedAt: z.date().default(() => /* @__PURE__ */ new Date()),\n\tupdatedAt: z.date().default(() => /* @__PURE__ */ new Date())\n});\n\n//#endregion\n//#region src/db/schema/account.ts\nconst accountSchema = coreSchema.extend({\n\tproviderId: z.string(),\n\taccountId: z.string(),\n\tuserId: z.coerce.string(),\n\taccessToken: z.string().nullish(),\n\trefreshToken: z.string().nullish(),\n\tidToken: z.string().nullish(),\n\taccessTokenExpiresAt: z.date().nullish(),\n\trefreshTokenExpiresAt: z.date().nullish(),\n\tscope: z.string().nullish(),\n\tpassword: z.string().nullish()\n});\n\n//#endregion\n//#region src/db/schema/rate-limit.ts\nconst rateLimitSchema = z.object({\n\tkey: z.string(),\n\tcount: z.number(),\n\tlastRequest: z.number()\n});\n\n//#endregion\n//#region src/db/schema/session.ts\nconst sessionSchema = coreSchema.extend({\n\tuserId: z.coerce.string(),\n\texpiresAt: z.date(),\n\ttoken: z.string(),\n\tipAddress: z.string().nullish(),\n\tuserAgent: z.string().nullish()\n});\n\n//#endregion\n//#region src/db/schema/user.ts\nconst userSchema = coreSchema.extend({\n\temail: z.string().transform((val) => val.toLowerCase()),\n\temailVerified: z.boolean().default(false),\n\tname: z.string(),\n\timage: z.string().nullish()\n});\n\n//#endregion\n//#region src/db/schema/verification.ts\nconst verificationSchema = coreSchema.extend({\n\tvalue: z.string(),\n\texpiresAt: z.date(),\n\tidentifier: z.string()\n});\n\n//#endregion\nexport { accountSchema, coreSchema, rateLimitSchema, sessionSchema, userSchema, verificationSchema };","import { entityKind } from \"../entity.js\";\nimport { PgTable } from \"./table.js\";\nfunction primaryKey(...config) {\n  if (config[0].columns) {\n    return new PrimaryKeyBuilder(config[0].columns, config[0].name);\n  }\n  return new PrimaryKeyBuilder(config);\n}\nclass PrimaryKeyBuilder {\n  static [entityKind] = \"PgPrimaryKeyBuilder\";\n  /** @internal */\n  columns;\n  /** @internal */\n  name;\n  constructor(columns, name) {\n    this.columns = columns;\n    this.name = name;\n  }\n  /** @internal */\n  build(table) {\n    return new PrimaryKey(table, this.columns, this.name);\n  }\n}\nclass PrimaryKey {\n  constructor(table, columns, name) {\n    this.table = table;\n    this.columns = columns;\n    this.name = name;\n  }\n  static [entityKind] = \"PgPrimaryKey\";\n  columns;\n  name;\n  getName() {\n    return this.name ?? `${this.table[PgTable.Symbol.Name]}_${this.columns.map((column) => column.name).join(\"_\")}_pk`;\n  }\n}\nexport {\n  PrimaryKey,\n  PrimaryKeyBuilder,\n  primaryKey\n};\n//# sourceMappingURL=primary-keys.js.map","import { r as defaultRoles } from \"./access-h-uttVNZ.mjs\";\n\n//#region src/plugins/admin/has-permission.ts\nconst hasPermission = (input) => {\n\tif (input.userId && input.options?.adminUserIds?.includes(input.userId)) return true;\n\tif (!input.permissions && !input.permission) return false;\n\tconst roles = (input.role || input.options?.defaultRole || \"user\").split(\",\");\n\tconst acRoles = input.options?.roles || defaultRoles;\n\tfor (const role of roles) if ((acRoles[role]?.authorize(input.permission ?? input.permissions))?.success) return true;\n\treturn false;\n};\n\n//#endregion\nexport { hasPermission as t };","import { entityKind } from \"./entity.js\";\nimport { Table } from \"./table.js\";\nfunction toSnakeCase(input) {\n  const words = input.replace(/['\\u2019]/g, \"\").match(/[\\da-z]+|[A-Z]+(?![a-z])|[A-Z][\\da-z]+/g) ?? [];\n  return words.map((word) => word.toLowerCase()).join(\"_\");\n}\nfunction toCamelCase(input) {\n  const words = input.replace(/['\\u2019]/g, \"\").match(/[\\da-z]+|[A-Z]+(?![a-z])|[A-Z][\\da-z]+/g) ?? [];\n  return words.reduce((acc, word, i) => {\n    const formattedWord = i === 0 ? word.toLowerCase() : `${word[0].toUpperCase()}${word.slice(1)}`;\n    return acc + formattedWord;\n  }, \"\");\n}\nfunction noopCase(input) {\n  return input;\n}\nclass CasingCache {\n  static [entityKind] = \"CasingCache\";\n  /** @internal */\n  cache = {};\n  cachedTables = {};\n  convert;\n  constructor(casing) {\n    this.convert = casing === \"snake_case\" ? toSnakeCase : casing === \"camelCase\" ? toCamelCase : noopCase;\n  }\n  getColumnCasing(column) {\n    if (!column.keyAsName) return column.name;\n    const schema = column.table[Table.Symbol.Schema] ?? \"public\";\n    const tableName = column.table[Table.Symbol.OriginalName];\n    const key = `${schema}.${tableName}.${column.name}`;\n    if (!this.cache[key]) {\n      this.cacheTable(column.table);\n    }\n    return this.cache[key];\n  }\n  cacheTable(table) {\n    const schema = table[Table.Symbol.Schema] ?? \"public\";\n    const tableName = table[Table.Symbol.OriginalName];\n    const tableKey = `${schema}.${tableName}`;\n    if (!this.cachedTables[tableKey]) {\n      for (const column of Object.values(table[Table.Symbol.Columns])) {\n        const columnKey = `${tableKey}.${column.name}`;\n        this.cache[columnKey] = this.convert(column.name);\n      }\n      this.cachedTables[tableKey] = true;\n    }\n  }\n  clearCache() {\n    this.cache = {};\n    this.cachedTables = {};\n  }\n}\nexport {\n  CasingCache,\n  toCamelCase,\n  toSnakeCase\n};\n//# sourceMappingURL=casing.js.map","import { entityKind } from \"../entity.js\";\nimport { View } from \"../sql/sql.js\";\nclass PgViewBase extends View {\n  static [entityKind] = \"PgViewBase\";\n}\nexport {\n  PgViewBase\n};\n//# sourceMappingURL=view-base.js.map","import { entityKind } from \"../../entity.js\";\nimport { SQL, sql } from \"../../sql/sql.js\";\nclass PgCountBuilder extends SQL {\n  constructor(params) {\n    super(PgCountBuilder.buildEmbeddedCount(params.source, params.filters).queryChunks);\n    this.params = params;\n    this.mapWith(Number);\n    this.session = params.session;\n    this.sql = PgCountBuilder.buildCount(\n      params.source,\n      params.filters\n    );\n  }\n  sql;\n  token;\n  static [entityKind] = \"PgCountBuilder\";\n  [Symbol.toStringTag] = \"PgCountBuilder\";\n  session;\n  static buildEmbeddedCount(source, filters) {\n    return sql`(select count(*) from ${source}${sql.raw(\" where \").if(filters)}${filters})`;\n  }\n  static buildCount(source, filters) {\n    return sql`select count(*) as count from ${source}${sql.raw(\" where \").if(filters)}${filters};`;\n  }\n  /** @intrnal */\n  setToken(token) {\n    this.token = token;\n    return this;\n  }\n  then(onfulfilled, onrejected) {\n    return Promise.resolve(this.session.count(this.sql, this.token)).then(\n      onfulfilled,\n      onrejected\n    );\n  }\n  catch(onRejected) {\n    return this.then(void 0, onRejected);\n  }\n  finally(onFinally) {\n    return this.then(\n      (value) => {\n        onFinally?.();\n        return value;\n      },\n      (reason) => {\n        onFinally?.();\n        throw reason;\n      }\n    );\n  }\n}\nexport {\n  PgCountBuilder\n};\n//# sourceMappingURL=count.js.map","import { entityKind } from \"../../entity.js\";\nimport { QueryPromise } from \"../../query-promise.js\";\nclass PgRaw extends QueryPromise {\n  constructor(execute, sql, query, mapBatchResult) {\n    super();\n    this.execute = execute;\n    this.sql = sql;\n    this.query = query;\n    this.mapBatchResult = mapBatchResult;\n  }\n  static [entityKind] = \"PgRaw\";\n  /** @internal */\n  getSQL() {\n    return this.sql;\n  }\n  getQuery() {\n    return this.query;\n  }\n  mapResult(result, isFromBatch) {\n    return isFromBatch ? this.mapBatchResult(result) : result;\n  }\n  _prepare() {\n    return this;\n  }\n  /** @internal */\n  isResponseInArrayMode() {\n    return false;\n  }\n}\nexport {\n  PgRaw\n};\n//# sourceMappingURL=raw.js.map","import { drizzle } from 'drizzle-orm/postgres-js';\nimport postgres from 'postgres';\nimport * as schema from './schema';\n\nconst connectionString = process.env.DATABASE_URL!;\n\nconst client = postgres(connectionString);\nexport const db = drizzle(client, { schema });\n","import { entityKind } from \"../../entity.js\";\nimport { PgColumnBuilder } from \"./common.js\";\nclass PgIntColumnBaseBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgIntColumnBaseBuilder\";\n  generatedAlwaysAsIdentity(sequence) {\n    if (sequence) {\n      const { name, ...options } = sequence;\n      this.config.generatedIdentity = {\n        type: \"always\",\n        sequenceName: name,\n        sequenceOptions: options\n      };\n    } else {\n      this.config.generatedIdentity = {\n        type: \"always\"\n      };\n    }\n    this.config.hasDefault = true;\n    this.config.notNull = true;\n    return this;\n  }\n  generatedByDefaultAsIdentity(sequence) {\n    if (sequence) {\n      const { name, ...options } = sequence;\n      this.config.generatedIdentity = {\n        type: \"byDefault\",\n        sequenceName: name,\n        sequenceOptions: options\n      };\n    } else {\n      this.config.generatedIdentity = {\n        type: \"byDefault\"\n      };\n    }\n    this.config.hasDefault = true;\n    this.config.notNull = true;\n    return this;\n  }\n}\nexport {\n  PgIntColumnBaseBuilder\n};\n//# sourceMappingURL=int.common.js.map","import { RedirectStatusCode } from '../../client/components/redirect-status-code';\nimport { getCookieParser } from '../api-utils/get-cookie-parser';\nexport class BaseNextRequest {\n    constructor(method, url, body){\n        this.method = method;\n        this.url = url;\n        this.body = body;\n    }\n    // Utils implemented using the abstract methods above\n    get cookies() {\n        if (this._cookies) return this._cookies;\n        return this._cookies = getCookieParser(this.headers)();\n    }\n}\nexport class BaseNextResponse {\n    constructor(destination){\n        this.destination = destination;\n    }\n    // Utils implemented using the abstract methods above\n    redirect(destination, statusCode) {\n        this.setHeader('Location', destination);\n        this.statusCode = statusCode;\n        // Since IE11 doesn't support the 308 header add backwards\n        // compatibility using refresh header\n        if (statusCode === RedirectStatusCode.PermanentRedirect) {\n            this.setHeader('Refresh', `0;url=${destination}`);\n        }\n        return this;\n    }\n}\n\n//# sourceMappingURL=index.js.map","import { InvariantError } from '../../shared/lib/invariant-error';\nimport { createPromiseWithResolvers } from '../../shared/lib/promise-with-resolvers';\nexport var RenderStage = /*#__PURE__*/ function(RenderStage) {\n    RenderStage[RenderStage[\"Static\"] = 1] = \"Static\";\n    RenderStage[RenderStage[\"Runtime\"] = 2] = \"Runtime\";\n    RenderStage[RenderStage[\"Dynamic\"] = 3] = \"Dynamic\";\n    return RenderStage;\n}({});\nexport class StagedRenderingController {\n    constructor(abortSignal = null){\n        this.abortSignal = abortSignal;\n        this.currentStage = 1;\n        this.runtimeStagePromise = createPromiseWithResolvers();\n        this.dynamicStagePromise = createPromiseWithResolvers();\n        if (abortSignal) {\n            abortSignal.addEventListener('abort', ()=>{\n                const { reason } = abortSignal;\n                if (this.currentStage < 2) {\n                    this.runtimeStagePromise.promise.catch(ignoreReject) // avoid unhandled rejections\n                    ;\n                    this.runtimeStagePromise.reject(reason);\n                }\n                if (this.currentStage < 3) {\n                    this.dynamicStagePromise.promise.catch(ignoreReject) // avoid unhandled rejections\n                    ;\n                    this.dynamicStagePromise.reject(reason);\n                }\n            }, {\n                once: true\n            });\n        }\n    }\n    advanceStage(stage) {\n        // If we're already at the target stage or beyond, do nothing.\n        // (this can happen e.g. if sync IO advanced us to the dynamic stage)\n        if (this.currentStage >= stage) {\n            return;\n        }\n        this.currentStage = stage;\n        // Note that we might be going directly from Static to Dynamic,\n        // so we need to resolve the runtime stage as well.\n        if (stage >= 2) {\n            this.runtimeStagePromise.resolve();\n        }\n        if (stage >= 3) {\n            this.dynamicStagePromise.resolve();\n        }\n    }\n    getStagePromise(stage) {\n        switch(stage){\n            case 2:\n                {\n                    return this.runtimeStagePromise.promise;\n                }\n            case 3:\n                {\n                    return this.dynamicStagePromise.promise;\n                }\n            default:\n                {\n                    stage;\n                    throw Object.defineProperty(new InvariantError(`Invalid render stage: ${stage}`), \"__NEXT_ERROR_CODE\", {\n                        value: \"E881\",\n                        enumerable: false,\n                        configurable: true\n                    });\n                }\n        }\n    }\n    waitForStage(stage) {\n        return this.getStagePromise(stage);\n    }\n    delayUntilStage(stage, displayName, resolvedValue) {\n        const ioTriggerPromise = this.getStagePromise(stage);\n        const promise = makeDevtoolsIOPromiseFromIOTrigger(ioTriggerPromise, displayName, resolvedValue);\n        // Analogously to `makeHangingPromise`, we might reject this promise if the signal is invoked.\n        // (e.g. in the case where we don't want want the render to proceed to the dynamic stage and abort it).\n        // We shouldn't consider this an unhandled rejection, so we attach a noop catch handler here to suppress this warning.\n        if (this.abortSignal) {\n            promise.catch(ignoreReject);\n        }\n        return promise;\n    }\n}\nfunction ignoreReject() {}\n// TODO(restart-on-cache-miss): the layering of `delayUntilStage`,\n// `makeDevtoolsIOPromiseFromIOTrigger` and and `makeDevtoolsIOAwarePromise`\n// is confusing, we should clean it up.\nfunction makeDevtoolsIOPromiseFromIOTrigger(ioTrigger, displayName, resolvedValue) {\n    // If we create a `new Promise` and give it a displayName\n    // (with no userspace code above us in the stack)\n    // React Devtools will use it as the IO cause when determining \"suspended by\".\n    // In particular, it should shadow any inner IO that resolved/rejected the promise\n    // (in case of staged rendering, this will be the `setTimeout` that triggers the relevant stage)\n    const promise = new Promise((resolve, reject)=>{\n        ioTrigger.then(resolve.bind(null, resolvedValue), reject);\n    });\n    if (displayName !== undefined) {\n        // @ts-expect-error\n        promise.displayName = displayName;\n    }\n    return promise;\n}\n\n//# sourceMappingURL=staged-rendering.js.map","/**\n * Find the starting index of Uint8Array `b` within Uint8Array `a`.\n */ export function indexOfUint8Array(a, b) {\n    if (b.length === 0) return 0;\n    if (a.length === 0 || b.length > a.length) return -1;\n    // start iterating through `a`\n    for(let i = 0; i <= a.length - b.length; i++){\n        let completeMatch = true;\n        // from index `i`, iterate through `b` and check for mismatch\n        for(let j = 0; j < b.length; j++){\n            // if the values do not match, then this isn't a complete match, exit `b` iteration early and iterate to next index of `a`.\n            if (a[i + j] !== b[j]) {\n                completeMatch = false;\n                break;\n            }\n        }\n        if (completeMatch) {\n            return i;\n        }\n    }\n    return -1;\n}\n/**\n * Check if two Uint8Arrays are strictly equivalent.\n */ export function isEquivalentUint8Arrays(a, b) {\n    if (a.length !== b.length) return false;\n    for(let i = 0; i < a.length; i++){\n        if (a[i] !== b[i]) return false;\n    }\n    return true;\n}\n/**\n * Remove Uint8Array `b` from Uint8Array `a`.\n *\n * If `b` is not in `a`, `a` is returned unchanged.\n *\n * Otherwise, the function returns a new Uint8Array instance with size `a.length - b.length`\n */ export function removeFromUint8Array(a, b) {\n    const tagIndex = indexOfUint8Array(a, b);\n    if (tagIndex === 0) return a.subarray(b.length);\n    if (tagIndex > -1) {\n        const removed = new Uint8Array(a.length - b.length);\n        removed.set(a.slice(0, tagIndex));\n        removed.set(a.slice(tagIndex + b.length), tagIndex);\n        return removed;\n    } else {\n        return a;\n    }\n}\n\n//# sourceMappingURL=uint8array-helpers.js.map","import Stream from 'stream'\n\nexport default function largeObject(sql, oid, mode = 0x00020000 | 0x00040000) {\n  return new Promise(async(resolve, reject) => {\n    await sql.begin(async sql => {\n      let finish\n      !oid && ([{ oid }] = await sql`select lo_creat(-1) as oid`)\n      const [{ fd }] = await sql`select lo_open(${ oid }, ${ mode }) as fd`\n\n      const lo = {\n        writable,\n        readable,\n        close     : () => sql`select lo_close(${ fd })`.then(finish),\n        tell      : () => sql`select lo_tell64(${ fd })`,\n        read      : (x) => sql`select loread(${ fd }, ${ x }) as data`,\n        write     : (x) => sql`select lowrite(${ fd }, ${ x })`,\n        truncate  : (x) => sql`select lo_truncate64(${ fd }, ${ x })`,\n        seek      : (x, whence = 0) => sql`select lo_lseek64(${ fd }, ${ x }, ${ whence })`,\n        size      : () => sql`\n          select\n            lo_lseek64(${ fd }, location, 0) as position,\n            seek.size\n          from (\n            select\n              lo_lseek64($1, 0, 2) as size,\n              tell.location\n            from (select lo_tell64($1) as location) tell\n          ) seek\n        `\n      }\n\n      resolve(lo)\n\n      return new Promise(async r => finish = r)\n\n      async function readable({\n        highWaterMark = 2048 * 8,\n        start = 0,\n        end = Infinity\n      } = {}) {\n        let max = end - start\n        start && await lo.seek(start)\n        return new Stream.Readable({\n          highWaterMark,\n          async read(size) {\n            const l = size > max ? size - max : size\n            max -= size\n            const [{ data }] = await lo.read(l)\n            this.push(data)\n            if (data.length < size)\n              this.push(null)\n          }\n        })\n      }\n\n      async function writable({\n        highWaterMark = 2048 * 8,\n        start = 0\n      } = {}) {\n        start && await lo.seek(start)\n        return new Stream.Writable({\n          highWaterMark,\n          write(chunk, encoding, callback) {\n            lo.write(chunk).then(() => callback(), callback)\n          }\n        })\n      }\n    }).catch(reject)\n  })\n}\n","import { entityKind } from \"../../entity.js\";\nimport { getColumnNameAndConfig } from \"../../utils.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgCharBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgCharBuilder\";\n  constructor(name, config) {\n    super(name, \"string\", \"PgChar\");\n    this.config.length = config.length;\n    this.config.enumValues = config.enum;\n  }\n  /** @internal */\n  build(table) {\n    return new PgChar(\n      table,\n      this.config\n    );\n  }\n}\nclass PgChar extends PgColumn {\n  static [entityKind] = \"PgChar\";\n  length = this.config.length;\n  enumValues = this.config.enumValues;\n  getSQLType() {\n    return this.length === void 0 ? `char` : `char(${this.length})`;\n  }\n}\nfunction char(a, b = {}) {\n  const { name, config } = getColumnNameAndConfig(a, b);\n  return new PgCharBuilder(name, config);\n}\nexport {\n  PgChar,\n  PgCharBuilder,\n  char\n};\n//# sourceMappingURL=char.js.map","import { ENV, env, getBooleanEnvVar, getEnvVar, isTest, logger } from \"@better-auth/core/env\";\nimport { betterFetch } from \"@better-fetch/fetch\";\nimport { base64 } from \"@better-auth/utils/base64\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport { createRandomStringGenerator } from \"@better-auth/utils/random\";\n\n//#region src/detectors/detect-auth-config.ts\nfunction getTelemetryAuthConfig(options, context) {\n\treturn {\n\t\tdatabase: context?.database,\n\t\tadapter: context?.adapter,\n\t\temailVerification: {\n\t\t\tsendVerificationEmail: !!options.emailVerification?.sendVerificationEmail,\n\t\t\tsendOnSignUp: !!options.emailVerification?.sendOnSignUp,\n\t\t\tsendOnSignIn: !!options.emailVerification?.sendOnSignIn,\n\t\t\tautoSignInAfterVerification: !!options.emailVerification?.autoSignInAfterVerification,\n\t\t\texpiresIn: options.emailVerification?.expiresIn,\n\t\t\tonEmailVerification: !!options.emailVerification?.onEmailVerification,\n\t\t\tafterEmailVerification: !!options.emailVerification?.afterEmailVerification\n\t\t},\n\t\temailAndPassword: {\n\t\t\tenabled: !!options.emailAndPassword?.enabled,\n\t\t\tdisableSignUp: !!options.emailAndPassword?.disableSignUp,\n\t\t\trequireEmailVerification: !!options.emailAndPassword?.requireEmailVerification,\n\t\t\tmaxPasswordLength: options.emailAndPassword?.maxPasswordLength,\n\t\t\tminPasswordLength: options.emailAndPassword?.minPasswordLength,\n\t\t\tsendResetPassword: !!options.emailAndPassword?.sendResetPassword,\n\t\t\tresetPasswordTokenExpiresIn: options.emailAndPassword?.resetPasswordTokenExpiresIn,\n\t\t\tonPasswordReset: !!options.emailAndPassword?.onPasswordReset,\n\t\t\tpassword: {\n\t\t\t\thash: !!options.emailAndPassword?.password?.hash,\n\t\t\t\tverify: !!options.emailAndPassword?.password?.verify\n\t\t\t},\n\t\t\tautoSignIn: !!options.emailAndPassword?.autoSignIn,\n\t\t\trevokeSessionsOnPasswordReset: !!options.emailAndPassword?.revokeSessionsOnPasswordReset\n\t\t},\n\t\tsocialProviders: Object.keys(options.socialProviders || {}).map((p) => {\n\t\t\tconst provider = options.socialProviders?.[p];\n\t\t\tif (!provider) return {};\n\t\t\treturn {\n\t\t\t\tid: p,\n\t\t\t\tmapProfileToUser: !!provider.mapProfileToUser,\n\t\t\t\tdisableDefaultScope: !!provider.disableDefaultScope,\n\t\t\t\tdisableIdTokenSignIn: !!provider.disableIdTokenSignIn,\n\t\t\t\tdisableImplicitSignUp: provider.disableImplicitSignUp,\n\t\t\t\tdisableSignUp: provider.disableSignUp,\n\t\t\t\tgetUserInfo: !!provider.getUserInfo,\n\t\t\t\toverrideUserInfoOnSignIn: !!provider.overrideUserInfoOnSignIn,\n\t\t\t\tprompt: provider.prompt,\n\t\t\t\tverifyIdToken: !!provider.verifyIdToken,\n\t\t\t\tscope: provider.scope,\n\t\t\t\trefreshAccessToken: !!provider.refreshAccessToken\n\t\t\t};\n\t\t}),\n\t\tplugins: options.plugins?.map((p) => p.id.toString()),\n\t\tuser: {\n\t\t\tmodelName: options.user?.modelName,\n\t\t\tfields: options.user?.fields,\n\t\t\tadditionalFields: options.user?.additionalFields,\n\t\t\tchangeEmail: {\n\t\t\t\tenabled: options.user?.changeEmail?.enabled,\n\t\t\t\tsendChangeEmailVerification: !!options.user?.changeEmail?.sendChangeEmailVerification\n\t\t\t}\n\t\t},\n\t\tverification: {\n\t\t\tmodelName: options.verification?.modelName,\n\t\t\tdisableCleanup: options.verification?.disableCleanup,\n\t\t\tfields: options.verification?.fields\n\t\t},\n\t\tsession: {\n\t\t\tmodelName: options.session?.modelName,\n\t\t\tadditionalFields: options.session?.additionalFields,\n\t\t\tcookieCache: {\n\t\t\t\tenabled: options.session?.cookieCache?.enabled,\n\t\t\t\tmaxAge: options.session?.cookieCache?.maxAge,\n\t\t\t\tstrategy: options.session?.cookieCache?.strategy\n\t\t\t},\n\t\t\tdisableSessionRefresh: options.session?.disableSessionRefresh,\n\t\t\texpiresIn: options.session?.expiresIn,\n\t\t\tfields: options.session?.fields,\n\t\t\tfreshAge: options.session?.freshAge,\n\t\t\tpreserveSessionInDatabase: options.session?.preserveSessionInDatabase,\n\t\t\tstoreSessionInDatabase: options.session?.storeSessionInDatabase,\n\t\t\tupdateAge: options.session?.updateAge\n\t\t},\n\t\taccount: {\n\t\t\tmodelName: options.account?.modelName,\n\t\t\tfields: options.account?.fields,\n\t\t\tencryptOAuthTokens: options.account?.encryptOAuthTokens,\n\t\t\tupdateAccountOnSignIn: options.account?.updateAccountOnSignIn,\n\t\t\taccountLinking: {\n\t\t\t\tenabled: options.account?.accountLinking?.enabled,\n\t\t\t\ttrustedProviders: options.account?.accountLinking?.trustedProviders,\n\t\t\t\tupdateUserInfoOnLink: options.account?.accountLinking?.updateUserInfoOnLink,\n\t\t\t\tallowUnlinkingAll: options.account?.accountLinking?.allowUnlinkingAll\n\t\t\t}\n\t\t},\n\t\thooks: {\n\t\t\tafter: !!options.hooks?.after,\n\t\t\tbefore: !!options.hooks?.before\n\t\t},\n\t\tsecondaryStorage: !!options.secondaryStorage,\n\t\tadvanced: {\n\t\t\tcookiePrefix: !!options.advanced?.cookiePrefix,\n\t\t\tcookies: !!options.advanced?.cookies,\n\t\t\tcrossSubDomainCookies: {\n\t\t\t\tdomain: !!options.advanced?.crossSubDomainCookies?.domain,\n\t\t\t\tenabled: options.advanced?.crossSubDomainCookies?.enabled,\n\t\t\t\tadditionalCookies: options.advanced?.crossSubDomainCookies?.additionalCookies\n\t\t\t},\n\t\t\tdatabase: {\n\t\t\t\tuseNumberId: !!options.advanced?.database?.useNumberId || options.advanced?.database?.generateId === \"serial\",\n\t\t\t\tgenerateId: options.advanced?.database?.generateId,\n\t\t\t\tdefaultFindManyLimit: options.advanced?.database?.defaultFindManyLimit\n\t\t\t},\n\t\t\tuseSecureCookies: options.advanced?.useSecureCookies,\n\t\t\tipAddress: {\n\t\t\t\tdisableIpTracking: options.advanced?.ipAddress?.disableIpTracking,\n\t\t\t\tipAddressHeaders: options.advanced?.ipAddress?.ipAddressHeaders\n\t\t\t},\n\t\t\tdisableCSRFCheck: options.advanced?.disableCSRFCheck,\n\t\t\tcookieAttributes: {\n\t\t\t\texpires: options.advanced?.defaultCookieAttributes?.expires,\n\t\t\t\tsecure: options.advanced?.defaultCookieAttributes?.secure,\n\t\t\t\tsameSite: options.advanced?.defaultCookieAttributes?.sameSite,\n\t\t\t\tdomain: !!options.advanced?.defaultCookieAttributes?.domain,\n\t\t\t\tpath: options.advanced?.defaultCookieAttributes?.path,\n\t\t\t\thttpOnly: options.advanced?.defaultCookieAttributes?.httpOnly\n\t\t\t}\n\t\t},\n\t\ttrustedOrigins: options.trustedOrigins?.length,\n\t\trateLimit: {\n\t\t\tstorage: options.rateLimit?.storage,\n\t\t\tmodelName: options.rateLimit?.modelName,\n\t\t\twindow: options.rateLimit?.window,\n\t\t\tcustomStorage: !!options.rateLimit?.customStorage,\n\t\t\tenabled: options.rateLimit?.enabled,\n\t\t\tmax: options.rateLimit?.max\n\t\t},\n\t\tonAPIError: {\n\t\t\terrorURL: options.onAPIError?.errorURL,\n\t\t\tonError: !!options.onAPIError?.onError,\n\t\t\tthrow: options.onAPIError?.throw\n\t\t},\n\t\tlogger: {\n\t\t\tdisabled: options.logger?.disabled,\n\t\t\tlevel: options.logger?.level,\n\t\t\tlog: !!options.logger?.log\n\t\t},\n\t\tdatabaseHooks: {\n\t\t\tuser: {\n\t\t\t\tcreate: {\n\t\t\t\t\tafter: !!options.databaseHooks?.user?.create?.after,\n\t\t\t\t\tbefore: !!options.databaseHooks?.user?.create?.before\n\t\t\t\t},\n\t\t\t\tupdate: {\n\t\t\t\t\tafter: !!options.databaseHooks?.user?.update?.after,\n\t\t\t\t\tbefore: !!options.databaseHooks?.user?.update?.before\n\t\t\t\t}\n\t\t\t},\n\t\t\tsession: {\n\t\t\t\tcreate: {\n\t\t\t\t\tafter: !!options.databaseHooks?.session?.create?.after,\n\t\t\t\t\tbefore: !!options.databaseHooks?.session?.create?.before\n\t\t\t\t},\n\t\t\t\tupdate: {\n\t\t\t\t\tafter: !!options.databaseHooks?.session?.update?.after,\n\t\t\t\t\tbefore: !!options.databaseHooks?.session?.update?.before\n\t\t\t\t}\n\t\t\t},\n\t\t\taccount: {\n\t\t\t\tcreate: {\n\t\t\t\t\tafter: !!options.databaseHooks?.account?.create?.after,\n\t\t\t\t\tbefore: !!options.databaseHooks?.account?.create?.before\n\t\t\t\t},\n\t\t\t\tupdate: {\n\t\t\t\t\tafter: !!options.databaseHooks?.account?.update?.after,\n\t\t\t\t\tbefore: !!options.databaseHooks?.account?.update?.before\n\t\t\t\t}\n\t\t\t},\n\t\t\tverification: {\n\t\t\t\tcreate: {\n\t\t\t\t\tafter: !!options.databaseHooks?.verification?.create?.after,\n\t\t\t\t\tbefore: !!options.databaseHooks?.verification?.create?.before\n\t\t\t\t},\n\t\t\t\tupdate: {\n\t\t\t\t\tafter: !!options.databaseHooks?.verification?.update?.after,\n\t\t\t\t\tbefore: !!options.databaseHooks?.verification?.update?.before\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n}\n\n//#endregion\n//#region src/utils/package-json.ts\nlet packageJSONCache;\nasync function readRootPackageJson() {\n\tif (packageJSONCache) return packageJSONCache;\n\ttry {\n\t\tconst cwd = typeof process !== \"undefined\" && typeof process.cwd === \"function\" ? process.cwd() : \"\";\n\t\tif (!cwd) return void 0;\n\t\tconst importRuntime$1 = (m) => Function(\"mm\", \"return import(mm)\")(m);\n\t\tconst [{ default: fs }, { default: path }] = await Promise.all([importRuntime$1(\"fs/promises\"), importRuntime$1(\"path\")]);\n\t\tconst raw = await fs.readFile(path.join(cwd, \"package.json\"), \"utf-8\");\n\t\tpackageJSONCache = JSON.parse(raw);\n\t\treturn packageJSONCache;\n\t} catch {}\n}\nasync function getPackageVersion(pkg) {\n\tif (packageJSONCache) return packageJSONCache.dependencies?.[pkg] || packageJSONCache.devDependencies?.[pkg] || packageJSONCache.peerDependencies?.[pkg];\n\ttry {\n\t\tconst cwd = typeof process !== \"undefined\" && typeof process.cwd === \"function\" ? process.cwd() : \"\";\n\t\tif (!cwd) throw new Error(\"no-cwd\");\n\t\tconst importRuntime$1 = (m) => Function(\"mm\", \"return import(mm)\")(m);\n\t\tconst [{ default: fs }, { default: path }] = await Promise.all([importRuntime$1(\"fs/promises\"), importRuntime$1(\"path\")]);\n\t\tconst pkgJsonPath = path.join(cwd, \"node_modules\", pkg, \"package.json\");\n\t\tconst raw = await fs.readFile(pkgJsonPath, \"utf-8\");\n\t\treturn JSON.parse(raw).version || await getVersionFromLocalPackageJson(pkg) || void 0;\n\t} catch {}\n\treturn await getVersionFromLocalPackageJson(pkg);\n}\nasync function getVersionFromLocalPackageJson(pkg) {\n\tconst json = await readRootPackageJson();\n\tif (!json) return void 0;\n\treturn {\n\t\t...json.dependencies,\n\t\t...json.devDependencies,\n\t\t...json.peerDependencies\n\t}[pkg];\n}\nasync function getNameFromLocalPackageJson() {\n\treturn (await readRootPackageJson())?.name;\n}\n\n//#endregion\n//#region src/detectors/detect-database.ts\nconst DATABASES = {\n\tpg: \"postgresql\",\n\tmysql: \"mysql\",\n\tmariadb: \"mariadb\",\n\tsqlite3: \"sqlite\",\n\t\"better-sqlite3\": \"sqlite\",\n\t\"@prisma/client\": \"prisma\",\n\tmongoose: \"mongodb\",\n\tmongodb: \"mongodb\",\n\t\"drizzle-orm\": \"drizzle\"\n};\nasync function detectDatabase() {\n\tfor (const [pkg, name] of Object.entries(DATABASES)) {\n\t\tconst version = await getPackageVersion(pkg);\n\t\tif (version) return {\n\t\t\tname,\n\t\t\tversion\n\t\t};\n\t}\n}\n\n//#endregion\n//#region src/detectors/detect-framework.ts\nconst FRAMEWORKS = {\n\tnext: \"next\",\n\tnuxt: \"nuxt\",\n\t\"@remix-run/server-runtime\": \"remix\",\n\tastro: \"astro\",\n\t\"@sveltejs/kit\": \"sveltekit\",\n\t\"solid-start\": \"solid-start\",\n\t\"tanstack-start\": \"tanstack-start\",\n\thono: \"hono\",\n\texpress: \"express\",\n\telysia: \"elysia\",\n\texpo: \"expo\"\n};\nasync function detectFramework() {\n\tfor (const [pkg, name] of Object.entries(FRAMEWORKS)) {\n\t\tconst version = await getPackageVersion(pkg);\n\t\tif (version) return {\n\t\t\tname,\n\t\t\tversion\n\t\t};\n\t}\n}\n\n//#endregion\n//#region src/detectors/detect-project-info.ts\nfunction detectPackageManager() {\n\tconst userAgent = env.npm_config_user_agent;\n\tif (!userAgent) return;\n\tconst pmSpec = userAgent.split(\" \")[0];\n\tconst separatorPos = pmSpec.lastIndexOf(\"/\");\n\tconst name = pmSpec.substring(0, separatorPos);\n\treturn {\n\t\tname: name === \"npminstall\" ? \"cnpm\" : name,\n\t\tversion: pmSpec.substring(separatorPos + 1)\n\t};\n}\n\n//#endregion\n//#region src/utils/import-util.ts\nconst importRuntime = (m) => {\n\treturn Function(\"mm\", \"return import(mm)\")(m);\n};\n\n//#endregion\n//#region src/detectors/detect-system-info.ts\nfunction getVendor() {\n\tconst hasAny = (...keys) => keys.some((k) => Boolean(env[k]));\n\tif (hasAny(\"CF_PAGES\", \"CF_PAGES_URL\", \"CF_ACCOUNT_ID\") || typeof navigator !== \"undefined\" && navigator.userAgent === \"Cloudflare-Workers\") return \"cloudflare\";\n\tif (hasAny(\"VERCEL\", \"VERCEL_URL\", \"VERCEL_ENV\")) return \"vercel\";\n\tif (hasAny(\"NETLIFY\", \"NETLIFY_URL\")) return \"netlify\";\n\tif (hasAny(\"RENDER\", \"RENDER_URL\", \"RENDER_INTERNAL_HOSTNAME\", \"RENDER_SERVICE_ID\")) return \"render\";\n\tif (hasAny(\"AWS_LAMBDA_FUNCTION_NAME\", \"AWS_EXECUTION_ENV\", \"LAMBDA_TASK_ROOT\")) return \"aws\";\n\tif (hasAny(\"GOOGLE_CLOUD_FUNCTION_NAME\", \"GOOGLE_CLOUD_PROJECT\", \"GCP_PROJECT\", \"K_SERVICE\")) return \"gcp\";\n\tif (hasAny(\"AZURE_FUNCTION_NAME\", \"FUNCTIONS_WORKER_RUNTIME\", \"WEBSITE_INSTANCE_ID\", \"WEBSITE_SITE_NAME\")) return \"azure\";\n\tif (hasAny(\"DENO_DEPLOYMENT_ID\", \"DENO_REGION\")) return \"deno-deploy\";\n\tif (hasAny(\"FLY_APP_NAME\", \"FLY_REGION\", \"FLY_ALLOC_ID\")) return \"fly-io\";\n\tif (hasAny(\"RAILWAY_STATIC_URL\", \"RAILWAY_ENVIRONMENT_NAME\")) return \"railway\";\n\tif (hasAny(\"DYNO\", \"HEROKU_APP_NAME\")) return \"heroku\";\n\tif (hasAny(\"DO_DEPLOYMENT_ID\", \"DO_APP_NAME\", \"DIGITALOCEAN\")) return \"digitalocean\";\n\tif (hasAny(\"KOYEB\", \"KOYEB_DEPLOYMENT_ID\", \"KOYEB_APP_NAME\")) return \"koyeb\";\n\treturn null;\n}\nasync function detectSystemInfo() {\n\ttry {\n\t\tif (getVendor() === \"cloudflare\") return \"cloudflare\";\n\t\tconst os = await importRuntime(\"os\");\n\t\tconst cpus = os.cpus();\n\t\treturn {\n\t\t\tdeploymentVendor: getVendor(),\n\t\t\tsystemPlatform: os.platform(),\n\t\t\tsystemRelease: os.release(),\n\t\t\tsystemArchitecture: os.arch(),\n\t\t\tcpuCount: cpus.length,\n\t\t\tcpuModel: cpus.length ? cpus[0].model : null,\n\t\t\tcpuSpeed: cpus.length ? cpus[0].speed : null,\n\t\t\tmemory: os.totalmem(),\n\t\t\tisWSL: await isWsl(),\n\t\t\tisDocker: await isDocker(),\n\t\t\tisTTY: typeof process !== \"undefined\" && process.stdout ? process.stdout.isTTY : null\n\t\t};\n\t} catch (e) {\n\t\treturn {\n\t\t\tsystemPlatform: null,\n\t\t\tsystemRelease: null,\n\t\t\tsystemArchitecture: null,\n\t\t\tcpuCount: null,\n\t\t\tcpuModel: null,\n\t\t\tcpuSpeed: null,\n\t\t\tmemory: null,\n\t\t\tisWSL: null,\n\t\t\tisDocker: null,\n\t\t\tisTTY: null\n\t\t};\n\t}\n}\nlet isDockerCached;\nasync function hasDockerEnv() {\n\tif (getVendor() === \"cloudflare\") return false;\n\ttry {\n\t\t(await importRuntime(\"fs\")).statSync(\"/.dockerenv\");\n\t\treturn true;\n\t} catch {\n\t\treturn false;\n\t}\n}\nasync function hasDockerCGroup() {\n\tif (getVendor() === \"cloudflare\") return false;\n\ttry {\n\t\treturn (await importRuntime(\"fs\")).readFileSync(\"/proc/self/cgroup\", \"utf8\").includes(\"docker\");\n\t} catch {\n\t\treturn false;\n\t}\n}\nasync function isDocker() {\n\tif (getVendor() === \"cloudflare\") return false;\n\tif (isDockerCached === void 0) isDockerCached = await hasDockerEnv() || await hasDockerCGroup();\n\treturn isDockerCached;\n}\nasync function isWsl() {\n\ttry {\n\t\tif (getVendor() === \"cloudflare\") return false;\n\t\tif (typeof process === \"undefined\" || process?.platform !== \"linux\") return false;\n\t\tconst fs = await importRuntime(\"fs\");\n\t\tif ((await importRuntime(\"os\")).release().toLowerCase().includes(\"microsoft\")) {\n\t\t\tif (await isInsideContainer()) return false;\n\t\t\treturn true;\n\t\t}\n\t\treturn fs.readFileSync(\"/proc/version\", \"utf8\").toLowerCase().includes(\"microsoft\") ? !await isInsideContainer() : false;\n\t} catch {\n\t\treturn false;\n\t}\n}\nlet isInsideContainerCached;\nconst hasContainerEnv = async () => {\n\tif (getVendor() === \"cloudflare\") return false;\n\ttry {\n\t\t(await importRuntime(\"fs\")).statSync(\"/run/.containerenv\");\n\t\treturn true;\n\t} catch {\n\t\treturn false;\n\t}\n};\nasync function isInsideContainer() {\n\tif (isInsideContainerCached === void 0) isInsideContainerCached = await hasContainerEnv() || await isDocker();\n\treturn isInsideContainerCached;\n}\nfunction isCI() {\n\treturn env.CI !== \"false\" && (\"BUILD_ID\" in env || \"BUILD_NUMBER\" in env || \"CI\" in env || \"CI_APP_ID\" in env || \"CI_BUILD_ID\" in env || \"CI_BUILD_NUMBER\" in env || \"CI_NAME\" in env || \"CONTINUOUS_INTEGRATION\" in env || \"RUN_ID\" in env);\n}\n\n//#endregion\n//#region src/detectors/detect-runtime.ts\nfunction detectRuntime() {\n\tif (typeof Deno !== \"undefined\") return {\n\t\tname: \"deno\",\n\t\tversion: Deno?.version?.deno ?? null\n\t};\n\tif (typeof Bun !== \"undefined\") return {\n\t\tname: \"bun\",\n\t\tversion: Bun?.version ?? null\n\t};\n\tif (typeof process !== \"undefined\" && process?.versions?.node) return {\n\t\tname: \"node\",\n\t\tversion: process.versions.node ?? null\n\t};\n\treturn {\n\t\tname: \"edge\",\n\t\tversion: null\n\t};\n}\nfunction detectEnvironment() {\n\treturn getEnvVar(\"NODE_ENV\") === \"production\" ? \"production\" : isCI() ? \"ci\" : isTest() ? \"test\" : \"development\";\n}\n\n//#endregion\n//#region src/utils/hash.ts\nasync function hashToBase64(data) {\n\tconst buffer = await createHash(\"SHA-256\").digest(data);\n\treturn base64.encode(buffer);\n}\n\n//#endregion\n//#region src/utils/id.ts\nconst generateId = (size) => {\n\treturn createRandomStringGenerator(\"a-z\", \"A-Z\", \"0-9\")(size || 32);\n};\n\n//#endregion\n//#region src/project-id.ts\nlet projectIdCached = null;\nasync function getProjectId(baseUrl) {\n\tif (projectIdCached) return projectIdCached;\n\tconst projectName = await getNameFromLocalPackageJson();\n\tif (projectName) {\n\t\tprojectIdCached = await hashToBase64(baseUrl ? baseUrl + projectName : projectName);\n\t\treturn projectIdCached;\n\t}\n\tif (baseUrl) {\n\t\tprojectIdCached = await hashToBase64(baseUrl);\n\t\treturn projectIdCached;\n\t}\n\tprojectIdCached = generateId(32);\n\treturn projectIdCached;\n}\n\n//#endregion\n//#region src/index.ts\nasync function createTelemetry(options, context) {\n\tconst debugEnabled = options.telemetry?.debug || getBooleanEnvVar(\"BETTER_AUTH_TELEMETRY_DEBUG\", false);\n\tconst TELEMETRY_ENDPOINT = ENV.BETTER_AUTH_TELEMETRY_ENDPOINT;\n\tconst track = async (event) => {\n\t\tif (context?.customTrack) await context.customTrack(event).catch(logger.error);\n\t\telse if (debugEnabled) logger.info(\"telemetry event\", JSON.stringify(event, null, 2));\n\t\telse await betterFetch(TELEMETRY_ENDPOINT, {\n\t\t\tmethod: \"POST\",\n\t\t\tbody: event\n\t\t}).catch(logger.error);\n\t};\n\tconst isEnabled = async () => {\n\t\tconst telemetryEnabled = options.telemetry?.enabled !== void 0 ? options.telemetry.enabled : false;\n\t\treturn (getBooleanEnvVar(\"BETTER_AUTH_TELEMETRY\", false) || telemetryEnabled) && (context?.skipTestCheck || !isTest());\n\t};\n\tconst enabled = await isEnabled();\n\tlet anonymousId;\n\tif (enabled) {\n\t\tanonymousId = await getProjectId(options.baseURL);\n\t\ttrack({\n\t\t\ttype: \"init\",\n\t\t\tpayload: {\n\t\t\t\tconfig: getTelemetryAuthConfig(options, context),\n\t\t\t\truntime: detectRuntime(),\n\t\t\t\tdatabase: await detectDatabase(),\n\t\t\t\tframework: await detectFramework(),\n\t\t\t\tenvironment: detectEnvironment(),\n\t\t\t\tsystemInfo: await detectSystemInfo(),\n\t\t\t\tpackageManager: detectPackageManager()\n\t\t\t},\n\t\t\tanonymousId\n\t\t});\n\t}\n\treturn { publish: async (event) => {\n\t\tif (!enabled) return;\n\t\tif (!anonymousId) anonymousId = await getProjectId(options.baseURL);\n\t\tawait track({\n\t\t\ttype: event.type,\n\t\t\tpayload: event.payload,\n\t\t\tanonymousId\n\t\t});\n\t} };\n}\n\n//#endregion\nexport { createTelemetry, getTelemetryAuthConfig };","import { InvariantError } from '../../shared/lib/invariant-error';\nimport { normalizeAppPath } from '../../shared/lib/router/utils/app-paths';\nimport { workAsyncStorage } from './work-async-storage.external';\nlet __next_loaded_action_key;\nexport function arrayBufferToString(buffer) {\n    const bytes = new Uint8Array(buffer);\n    const len = bytes.byteLength;\n    // @anonrig: V8 has a limit of 65535 arguments in a function.\n    // For len < 65535, this is faster.\n    // https://github.com/vercel/next.js/pull/56377#pullrequestreview-1656181623\n    if (len < 65535) {\n        return String.fromCharCode.apply(null, bytes);\n    }\n    let binary = '';\n    for(let i = 0; i < len; i++){\n        binary += String.fromCharCode(bytes[i]);\n    }\n    return binary;\n}\nexport function stringToUint8Array(binary) {\n    const len = binary.length;\n    const arr = new Uint8Array(len);\n    for(let i = 0; i < len; i++){\n        arr[i] = binary.charCodeAt(i);\n    }\n    return arr;\n}\nexport function encrypt(key, iv, data) {\n    return crypto.subtle.encrypt({\n        name: 'AES-GCM',\n        iv\n    }, key, data);\n}\nexport function decrypt(key, iv, data) {\n    return crypto.subtle.decrypt({\n        name: 'AES-GCM',\n        iv\n    }, key, data);\n}\n// This is a global singleton that is used to encode/decode the action bound args from\n// the closure. This can't be using a AsyncLocalStorage as it might happen on the module\n// level. Since the client reference manifest won't be mutated, let's use a global singleton\n// to keep it.\nconst SERVER_ACTION_MANIFESTS_SINGLETON = Symbol.for('next.server.action-manifests');\nexport function setReferenceManifestsSingleton({ page, clientReferenceManifest, serverActionsManifest, serverModuleMap }) {\n    var _globalThis_SERVER_ACTION_MANIFESTS_SINGLETON;\n    // @ts-expect-error\n    const clientReferenceManifestsPerPage = (_globalThis_SERVER_ACTION_MANIFESTS_SINGLETON = globalThis[SERVER_ACTION_MANIFESTS_SINGLETON]) == null ? void 0 : _globalThis_SERVER_ACTION_MANIFESTS_SINGLETON.clientReferenceManifestsPerPage;\n    // @ts-expect-error\n    globalThis[SERVER_ACTION_MANIFESTS_SINGLETON] = {\n        clientReferenceManifestsPerPage: {\n            ...clientReferenceManifestsPerPage,\n            [normalizeAppPath(page)]: clientReferenceManifest\n        },\n        serverActionsManifest,\n        serverModuleMap\n    };\n}\nexport function getServerModuleMap() {\n    const serverActionsManifestSingleton = globalThis[SERVER_ACTION_MANIFESTS_SINGLETON];\n    if (!serverActionsManifestSingleton) {\n        throw Object.defineProperty(new InvariantError('Missing manifest for Server Actions.'), \"__NEXT_ERROR_CODE\", {\n            value: \"E606\",\n            enumerable: false,\n            configurable: true\n        });\n    }\n    return serverActionsManifestSingleton.serverModuleMap;\n}\nexport function getClientReferenceManifestForRsc() {\n    const serverActionsManifestSingleton = globalThis[SERVER_ACTION_MANIFESTS_SINGLETON];\n    if (!serverActionsManifestSingleton) {\n        throw Object.defineProperty(new InvariantError('Missing manifest for Server Actions.'), \"__NEXT_ERROR_CODE\", {\n            value: \"E606\",\n            enumerable: false,\n            configurable: true\n        });\n    }\n    const { clientReferenceManifestsPerPage } = serverActionsManifestSingleton;\n    const workStore = workAsyncStorage.getStore();\n    if (!workStore) {\n        // If there's no work store defined, we can assume that a client reference\n        // manifest is needed during module evaluation, e.g. to create a server\n        // action using a higher-order function. This might also use client\n        // components which need to be serialized by Flight, and therefore client\n        // references need to be resolvable. To make this work, we're returning a\n        // merged manifest across all pages. This is fine as long as the module IDs\n        // are not page specific, which they are not for Webpack. TODO: Fix this in\n        // Turbopack.\n        return mergeClientReferenceManifests(clientReferenceManifestsPerPage);\n    }\n    const clientReferenceManifest = clientReferenceManifestsPerPage[workStore.route];\n    if (!clientReferenceManifest) {\n        throw Object.defineProperty(new InvariantError(`Missing Client Reference Manifest for ${workStore.route}.`), \"__NEXT_ERROR_CODE\", {\n            value: \"E570\",\n            enumerable: false,\n            configurable: true\n        });\n    }\n    return clientReferenceManifest;\n}\nexport async function getActionEncryptionKey() {\n    if (__next_loaded_action_key) {\n        return __next_loaded_action_key;\n    }\n    const serverActionsManifestSingleton = globalThis[SERVER_ACTION_MANIFESTS_SINGLETON];\n    if (!serverActionsManifestSingleton) {\n        throw Object.defineProperty(new InvariantError('Missing manifest for Server Actions.'), \"__NEXT_ERROR_CODE\", {\n            value: \"E606\",\n            enumerable: false,\n            configurable: true\n        });\n    }\n    const rawKey = process.env.NEXT_SERVER_ACTIONS_ENCRYPTION_KEY || serverActionsManifestSingleton.serverActionsManifest.encryptionKey;\n    if (rawKey === undefined) {\n        throw Object.defineProperty(new InvariantError('Missing encryption key for Server Actions'), \"__NEXT_ERROR_CODE\", {\n            value: \"E571\",\n            enumerable: false,\n            configurable: true\n        });\n    }\n    __next_loaded_action_key = await crypto.subtle.importKey('raw', stringToUint8Array(atob(rawKey)), 'AES-GCM', true, [\n        'encrypt',\n        'decrypt'\n    ]);\n    return __next_loaded_action_key;\n}\nfunction mergeClientReferenceManifests(clientReferenceManifestsPerPage) {\n    const clientReferenceManifests = Object.values(clientReferenceManifestsPerPage);\n    const mergedClientReferenceManifest = {\n        clientModules: {},\n        edgeRscModuleMapping: {},\n        rscModuleMapping: {}\n    };\n    for (const clientReferenceManifest of clientReferenceManifests){\n        mergedClientReferenceManifest.clientModules = {\n            ...mergedClientReferenceManifest.clientModules,\n            ...clientReferenceManifest.clientModules\n        };\n        mergedClientReferenceManifest.edgeRscModuleMapping = {\n            ...mergedClientReferenceManifest.edgeRscModuleMapping,\n            ...clientReferenceManifest.edgeRscModuleMapping\n        };\n        mergedClientReferenceManifest.rscModuleMapping = {\n            ...mergedClientReferenceManifest.rscModuleMapping,\n            ...clientReferenceManifest.rscModuleMapping\n        };\n    }\n    return mergedClientReferenceManifest;\n}\n\n//# sourceMappingURL=encryption-utils.js.map","import { env } from \"@better-auth/core/env\";\nimport { BetterAuthError } from \"@better-auth/core/error\";\n\n//#region src/utils/url.ts\nfunction checkHasPath(url) {\n\ttry {\n\t\treturn (new URL(url).pathname.replace(/\\/+$/, \"\") || \"/\") !== \"/\";\n\t} catch (error) {\n\t\tthrow new BetterAuthError(`Invalid base URL: ${url}. Please provide a valid base URL.`);\n\t}\n}\nfunction assertHasProtocol(url) {\n\ttry {\n\t\tconst parsedUrl = new URL(url);\n\t\tif (parsedUrl.protocol !== \"http:\" && parsedUrl.protocol !== \"https:\") throw new BetterAuthError(`Invalid base URL: ${url}. URL must include 'http://' or 'https://'`);\n\t} catch (error) {\n\t\tif (error instanceof BetterAuthError) throw error;\n\t\tthrow new BetterAuthError(`Invalid base URL: ${url}. Please provide a valid base URL.`, String(error));\n\t}\n}\nfunction withPath(url, path = \"/api/auth\") {\n\tassertHasProtocol(url);\n\tif (checkHasPath(url)) return url;\n\tconst trimmedUrl = url.replace(/\\/+$/, \"\");\n\tif (!path || path === \"/\") return trimmedUrl;\n\tpath = path.startsWith(\"/\") ? path : `/${path}`;\n\treturn `${trimmedUrl}${path}`;\n}\nfunction getBaseURL(url, path, request, loadEnv, trustedProxyHeaders) {\n\tif (url) return withPath(url, path);\n\tif (loadEnv !== false) {\n\t\tconst fromEnv = env.BETTER_AUTH_URL || env.NEXT_PUBLIC_BETTER_AUTH_URL || env.PUBLIC_BETTER_AUTH_URL || env.NUXT_PUBLIC_BETTER_AUTH_URL || env.NUXT_PUBLIC_AUTH_URL || (env.BASE_URL !== \"/\" ? env.BASE_URL : void 0);\n\t\tif (fromEnv) return withPath(fromEnv, path);\n\t}\n\tconst fromRequest = request?.headers.get(\"x-forwarded-host\");\n\tconst fromRequestProto = request?.headers.get(\"x-forwarded-proto\");\n\tif (fromRequest && fromRequestProto && trustedProxyHeaders) return withPath(`${fromRequestProto}://${fromRequest}`, path);\n\tif (request) {\n\t\tconst url$1 = getOrigin(request.url);\n\t\tif (!url$1) throw new BetterAuthError(\"Could not get origin from request. Please provide a valid base URL.\");\n\t\treturn withPath(url$1, path);\n\t}\n\tif (typeof window !== \"undefined\" && window.location) return withPath(window.location.origin, path);\n}\nfunction getOrigin(url) {\n\ttry {\n\t\tconst parsedUrl = new URL(url);\n\t\treturn parsedUrl.origin === \"null\" ? null : parsedUrl.origin;\n\t} catch (error) {\n\t\treturn null;\n\t}\n}\nfunction getProtocol(url) {\n\ttry {\n\t\treturn new URL(url).protocol;\n\t} catch (error) {\n\t\treturn null;\n\t}\n}\nfunction getHost(url) {\n\ttry {\n\t\treturn new URL(url).host;\n\t} catch (error) {\n\t\treturn null;\n\t}\n}\n\n//#endregion\nexport { getProtocol as i, getHost as n, getOrigin as r, getBaseURL as t };","import { entityKind } from \"../../entity.js\";\nimport { getColumnNameAndConfig } from \"../../utils.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgCustomColumnBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgCustomColumnBuilder\";\n  constructor(name, fieldConfig, customTypeParams) {\n    super(name, \"custom\", \"PgCustomColumn\");\n    this.config.fieldConfig = fieldConfig;\n    this.config.customTypeParams = customTypeParams;\n  }\n  /** @internal */\n  build(table) {\n    return new PgCustomColumn(\n      table,\n      this.config\n    );\n  }\n}\nclass PgCustomColumn extends PgColumn {\n  static [entityKind] = \"PgCustomColumn\";\n  sqlName;\n  mapTo;\n  mapFrom;\n  constructor(table, config) {\n    super(table, config);\n    this.sqlName = config.customTypeParams.dataType(config.fieldConfig);\n    this.mapTo = config.customTypeParams.toDriver;\n    this.mapFrom = config.customTypeParams.fromDriver;\n  }\n  getSQLType() {\n    return this.sqlName;\n  }\n  mapFromDriverValue(value) {\n    return typeof this.mapFrom === \"function\" ? this.mapFrom(value) : value;\n  }\n  mapToDriverValue(value) {\n    return typeof this.mapTo === \"function\" ? this.mapTo(value) : value;\n  }\n}\nfunction customType(customTypeParams) {\n  return (a, b) => {\n    const { name, config } = getColumnNameAndConfig(a, b);\n    return new PgCustomColumnBuilder(name, config, customTypeParams);\n  };\n}\nexport {\n  PgCustomColumn,\n  PgCustomColumnBuilder,\n  customType\n};\n//# sourceMappingURL=custom.js.map","import { entityKind } from \"../../entity.js\";\nimport { sql } from \"../../sql/sql.js\";\nimport { PgColumnBuilder } from \"./common.js\";\nclass PgDateColumnBaseBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgDateColumnBaseBuilder\";\n  defaultNow() {\n    return this.default(sql`now()`);\n  }\n}\nexport {\n  PgDateColumnBaseBuilder\n};\n//# sourceMappingURL=date.common.js.map","import { entityKind } from \"../../entity.js\";\nimport { PgColumn } from \"./common.js\";\nimport { PgIntColumnBaseBuilder } from \"./int.common.js\";\nclass PgIntegerBuilder extends PgIntColumnBaseBuilder {\n  static [entityKind] = \"PgIntegerBuilder\";\n  constructor(name) {\n    super(name, \"number\", \"PgInteger\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgInteger(table, this.config);\n  }\n}\nclass PgInteger extends PgColumn {\n  static [entityKind] = \"PgInteger\";\n  getSQLType() {\n    return \"integer\";\n  }\n  mapFromDriverValue(value) {\n    if (typeof value === \"string\") {\n      return Number.parseInt(value);\n    }\n    return value;\n  }\n}\nfunction integer(name) {\n  return new PgIntegerBuilder(name ?? \"\");\n}\nexport {\n  PgInteger,\n  PgIntegerBuilder,\n  integer\n};\n//# sourceMappingURL=integer.js.map","import { entityKind } from \"../../entity.js\";\nimport { getColumnNameAndConfig } from \"../../utils.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgIntervalBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgIntervalBuilder\";\n  constructor(name, intervalConfig) {\n    super(name, \"string\", \"PgInterval\");\n    this.config.intervalConfig = intervalConfig;\n  }\n  /** @internal */\n  build(table) {\n    return new PgInterval(table, this.config);\n  }\n}\nclass PgInterval extends PgColumn {\n  static [entityKind] = \"PgInterval\";\n  fields = this.config.intervalConfig.fields;\n  precision = this.config.intervalConfig.precision;\n  getSQLType() {\n    const fields = this.fields ? ` ${this.fields}` : \"\";\n    const precision = this.precision ? `(${this.precision})` : \"\";\n    return `interval${fields}${precision}`;\n  }\n}\nfunction interval(a, b = {}) {\n  const { name, config } = getColumnNameAndConfig(a, b);\n  return new PgIntervalBuilder(name, config);\n}\nexport {\n  PgInterval,\n  PgIntervalBuilder,\n  interval\n};\n//# sourceMappingURL=interval.js.map","import { entityKind } from \"../../entity.js\";\nimport { getColumnNameAndConfig } from \"../../utils.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgLineBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgLineBuilder\";\n  constructor(name) {\n    super(name, \"array\", \"PgLine\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgLineTuple(\n      table,\n      this.config\n    );\n  }\n}\nclass PgLineTuple extends PgColumn {\n  static [entityKind] = \"PgLine\";\n  getSQLType() {\n    return \"line\";\n  }\n  mapFromDriverValue(value) {\n    const [a, b, c] = value.slice(1, -1).split(\",\");\n    return [Number.parseFloat(a), Number.parseFloat(b), Number.parseFloat(c)];\n  }\n  mapToDriverValue(value) {\n    return `{${value[0]},${value[1]},${value[2]}}`;\n  }\n}\nclass PgLineABCBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgLineABCBuilder\";\n  constructor(name) {\n    super(name, \"json\", \"PgLineABC\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgLineABC(\n      table,\n      this.config\n    );\n  }\n}\nclass PgLineABC extends PgColumn {\n  static [entityKind] = \"PgLineABC\";\n  getSQLType() {\n    return \"line\";\n  }\n  mapFromDriverValue(value) {\n    const [a, b, c] = value.slice(1, -1).split(\",\");\n    return { a: Number.parseFloat(a), b: Number.parseFloat(b), c: Number.parseFloat(c) };\n  }\n  mapToDriverValue(value) {\n    return `{${value.a},${value.b},${value.c}}`;\n  }\n}\nfunction line(a, b) {\n  const { name, config } = getColumnNameAndConfig(a, b);\n  if (!config?.mode || config.mode === \"tuple\") {\n    return new PgLineBuilder(name);\n  }\n  return new PgLineABCBuilder(name);\n}\nexport {\n  PgLineABC,\n  PgLineABCBuilder,\n  PgLineBuilder,\n  PgLineTuple,\n  line\n};\n//# sourceMappingURL=line.js.map","import { entityKind } from \"../../entity.js\";\nimport { getColumnNameAndConfig } from \"../../utils.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgNumericBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgNumericBuilder\";\n  constructor(name, precision, scale) {\n    super(name, \"string\", \"PgNumeric\");\n    this.config.precision = precision;\n    this.config.scale = scale;\n  }\n  /** @internal */\n  build(table) {\n    return new PgNumeric(table, this.config);\n  }\n}\nclass PgNumeric extends PgColumn {\n  static [entityKind] = \"PgNumeric\";\n  precision;\n  scale;\n  constructor(table, config) {\n    super(table, config);\n    this.precision = config.precision;\n    this.scale = config.scale;\n  }\n  mapFromDriverValue(value) {\n    if (typeof value === \"string\") return value;\n    return String(value);\n  }\n  getSQLType() {\n    if (this.precision !== void 0 && this.scale !== void 0) {\n      return `numeric(${this.precision}, ${this.scale})`;\n    } else if (this.precision === void 0) {\n      return \"numeric\";\n    } else {\n      return `numeric(${this.precision})`;\n    }\n  }\n}\nclass PgNumericNumberBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgNumericNumberBuilder\";\n  constructor(name, precision, scale) {\n    super(name, \"number\", \"PgNumericNumber\");\n    this.config.precision = precision;\n    this.config.scale = scale;\n  }\n  /** @internal */\n  build(table) {\n    return new PgNumericNumber(\n      table,\n      this.config\n    );\n  }\n}\nclass PgNumericNumber extends PgColumn {\n  static [entityKind] = \"PgNumericNumber\";\n  precision;\n  scale;\n  constructor(table, config) {\n    super(table, config);\n    this.precision = config.precision;\n    this.scale = config.scale;\n  }\n  mapFromDriverValue(value) {\n    if (typeof value === \"number\") return value;\n    return Number(value);\n  }\n  mapToDriverValue = String;\n  getSQLType() {\n    if (this.precision !== void 0 && this.scale !== void 0) {\n      return `numeric(${this.precision}, ${this.scale})`;\n    } else if (this.precision === void 0) {\n      return \"numeric\";\n    } else {\n      return `numeric(${this.precision})`;\n    }\n  }\n}\nclass PgNumericBigIntBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgNumericBigIntBuilder\";\n  constructor(name, precision, scale) {\n    super(name, \"bigint\", \"PgNumericBigInt\");\n    this.config.precision = precision;\n    this.config.scale = scale;\n  }\n  /** @internal */\n  build(table) {\n    return new PgNumericBigInt(\n      table,\n      this.config\n    );\n  }\n}\nclass PgNumericBigInt extends PgColumn {\n  static [entityKind] = \"PgNumericBigInt\";\n  precision;\n  scale;\n  constructor(table, config) {\n    super(table, config);\n    this.precision = config.precision;\n    this.scale = config.scale;\n  }\n  mapFromDriverValue = BigInt;\n  mapToDriverValue = String;\n  getSQLType() {\n    if (this.precision !== void 0 && this.scale !== void 0) {\n      return `numeric(${this.precision}, ${this.scale})`;\n    } else if (this.precision === void 0) {\n      return \"numeric\";\n    } else {\n      return `numeric(${this.precision})`;\n    }\n  }\n}\nfunction numeric(a, b) {\n  const { name, config } = getColumnNameAndConfig(a, b);\n  const mode = config?.mode;\n  return mode === \"number\" ? new PgNumericNumberBuilder(name, config?.precision, config?.scale) : mode === \"bigint\" ? new PgNumericBigIntBuilder(name, config?.precision, config?.scale) : new PgNumericBuilder(name, config?.precision, config?.scale);\n}\nconst decimal = numeric;\nexport {\n  PgNumeric,\n  PgNumericBigInt,\n  PgNumericBigIntBuilder,\n  PgNumericBuilder,\n  PgNumericNumber,\n  PgNumericNumberBuilder,\n  decimal,\n  numeric\n};\n//# sourceMappingURL=numeric.js.map","import { entityKind } from \"../../entity.js\";\nimport { getColumnNameAndConfig } from \"../../utils.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgPointTupleBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgPointTupleBuilder\";\n  constructor(name) {\n    super(name, \"array\", \"PgPointTuple\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgPointTuple(\n      table,\n      this.config\n    );\n  }\n}\nclass PgPointTuple extends PgColumn {\n  static [entityKind] = \"PgPointTuple\";\n  getSQLType() {\n    return \"point\";\n  }\n  mapFromDriverValue(value) {\n    if (typeof value === \"string\") {\n      const [x, y] = value.slice(1, -1).split(\",\");\n      return [Number.parseFloat(x), Number.parseFloat(y)];\n    }\n    return [value.x, value.y];\n  }\n  mapToDriverValue(value) {\n    return `(${value[0]},${value[1]})`;\n  }\n}\nclass PgPointObjectBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgPointObjectBuilder\";\n  constructor(name) {\n    super(name, \"json\", \"PgPointObject\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgPointObject(\n      table,\n      this.config\n    );\n  }\n}\nclass PgPointObject extends PgColumn {\n  static [entityKind] = \"PgPointObject\";\n  getSQLType() {\n    return \"point\";\n  }\n  mapFromDriverValue(value) {\n    if (typeof value === \"string\") {\n      const [x, y] = value.slice(1, -1).split(\",\");\n      return { x: Number.parseFloat(x), y: Number.parseFloat(y) };\n    }\n    return value;\n  }\n  mapToDriverValue(value) {\n    return `(${value.x},${value.y})`;\n  }\n}\nfunction point(a, b) {\n  const { name, config } = getColumnNameAndConfig(a, b);\n  if (!config?.mode || config.mode === \"tuple\") {\n    return new PgPointTupleBuilder(name);\n  }\n  return new PgPointObjectBuilder(name);\n}\nexport {\n  PgPointObject,\n  PgPointObjectBuilder,\n  PgPointTuple,\n  PgPointTupleBuilder,\n  point\n};\n//# sourceMappingURL=point.js.map","import { entityKind } from \"../../entity.js\";\nimport { PgColumn } from \"./common.js\";\nimport { PgIntColumnBaseBuilder } from \"./int.common.js\";\nclass PgSmallIntBuilder extends PgIntColumnBaseBuilder {\n  static [entityKind] = \"PgSmallIntBuilder\";\n  constructor(name) {\n    super(name, \"number\", \"PgSmallInt\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgSmallInt(table, this.config);\n  }\n}\nclass PgSmallInt extends PgColumn {\n  static [entityKind] = \"PgSmallInt\";\n  getSQLType() {\n    return \"smallint\";\n  }\n  mapFromDriverValue = (value) => {\n    if (typeof value === \"string\") {\n      return Number(value);\n    }\n    return value;\n  };\n}\nfunction smallint(name) {\n  return new PgSmallIntBuilder(name ?? \"\");\n}\nexport {\n  PgSmallInt,\n  PgSmallIntBuilder,\n  smallint\n};\n//# sourceMappingURL=smallint.js.map","import { entityKind } from \"../../entity.js\";\nimport { getColumnNameAndConfig } from \"../../utils.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgTextBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgTextBuilder\";\n  constructor(name, config) {\n    super(name, \"string\", \"PgText\");\n    this.config.enumValues = config.enum;\n  }\n  /** @internal */\n  build(table) {\n    return new PgText(table, this.config);\n  }\n}\nclass PgText extends PgColumn {\n  static [entityKind] = \"PgText\";\n  enumValues = this.config.enumValues;\n  getSQLType() {\n    return \"text\";\n  }\n}\nfunction text(a, b = {}) {\n  const { name, config } = getColumnNameAndConfig(a, b);\n  return new PgTextBuilder(name, config);\n}\nexport {\n  PgText,\n  PgTextBuilder,\n  text\n};\n//# sourceMappingURL=text.js.map","import { entityKind } from \"../../entity.js\";\nimport { sql } from \"../../sql/sql.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgUUIDBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgUUIDBuilder\";\n  constructor(name) {\n    super(name, \"string\", \"PgUUID\");\n  }\n  /**\n   * Adds `default gen_random_uuid()` to the column definition.\n   */\n  defaultRandom() {\n    return this.default(sql`gen_random_uuid()`);\n  }\n  /** @internal */\n  build(table) {\n    return new PgUUID(table, this.config);\n  }\n}\nclass PgUUID extends PgColumn {\n  static [entityKind] = \"PgUUID\";\n  getSQLType() {\n    return \"uuid\";\n  }\n}\nfunction uuid(name) {\n  return new PgUUIDBuilder(name ?? \"\");\n}\nexport {\n  PgUUID,\n  PgUUIDBuilder,\n  uuid\n};\n//# sourceMappingURL=uuid.js.map","import { entityKind } from \"../../entity.js\";\nimport { getColumnNameAndConfig } from \"../../utils.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgVarcharBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgVarcharBuilder\";\n  constructor(name, config) {\n    super(name, \"string\", \"PgVarchar\");\n    this.config.length = config.length;\n    this.config.enumValues = config.enum;\n  }\n  /** @internal */\n  build(table) {\n    return new PgVarchar(\n      table,\n      this.config\n    );\n  }\n}\nclass PgVarchar extends PgColumn {\n  static [entityKind] = \"PgVarchar\";\n  length = this.config.length;\n  enumValues = this.config.enumValues;\n  getSQLType() {\n    return this.length === void 0 ? `varchar` : `varchar(${this.length})`;\n  }\n}\nfunction varchar(a, b = {}) {\n  const { name, config } = getColumnNameAndConfig(a, b);\n  return new PgVarcharBuilder(name, config);\n}\nexport {\n  PgVarchar,\n  PgVarcharBuilder,\n  varchar\n};\n//# sourceMappingURL=varchar.js.map","import { entityKind } from \"../../../entity.js\";\nimport { getColumnNameAndConfig } from \"../../../utils.js\";\nimport { PgColumn, PgColumnBuilder } from \"../common.js\";\nclass PgBinaryVectorBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgBinaryVectorBuilder\";\n  constructor(name, config) {\n    super(name, \"string\", \"PgBinaryVector\");\n    this.config.dimensions = config.dimensions;\n  }\n  /** @internal */\n  build(table) {\n    return new PgBinaryVector(\n      table,\n      this.config\n    );\n  }\n}\nclass PgBinaryVector extends PgColumn {\n  static [entityKind] = \"PgBinaryVector\";\n  dimensions = this.config.dimensions;\n  getSQLType() {\n    return `bit(${this.dimensions})`;\n  }\n}\nfunction bit(a, b) {\n  const { name, config } = getColumnNameAndConfig(a, b);\n  return new PgBinaryVectorBuilder(name, config);\n}\nexport {\n  PgBinaryVector,\n  PgBinaryVectorBuilder,\n  bit\n};\n//# sourceMappingURL=bit.js.map","import { entityKind } from \"../../../entity.js\";\nimport { getColumnNameAndConfig } from \"../../../utils.js\";\nimport { PgColumn, PgColumnBuilder } from \"../common.js\";\nclass PgHalfVectorBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgHalfVectorBuilder\";\n  constructor(name, config) {\n    super(name, \"array\", \"PgHalfVector\");\n    this.config.dimensions = config.dimensions;\n  }\n  /** @internal */\n  build(table) {\n    return new PgHalfVector(\n      table,\n      this.config\n    );\n  }\n}\nclass PgHalfVector extends PgColumn {\n  static [entityKind] = \"PgHalfVector\";\n  dimensions = this.config.dimensions;\n  getSQLType() {\n    return `halfvec(${this.dimensions})`;\n  }\n  mapToDriverValue(value) {\n    return JSON.stringify(value);\n  }\n  mapFromDriverValue(value) {\n    return value.slice(1, -1).split(\",\").map((v) => Number.parseFloat(v));\n  }\n}\nfunction halfvec(a, b) {\n  const { name, config } = getColumnNameAndConfig(a, b);\n  return new PgHalfVectorBuilder(name, config);\n}\nexport {\n  PgHalfVector,\n  PgHalfVectorBuilder,\n  halfvec\n};\n//# sourceMappingURL=halfvec.js.map","import { entityKind } from \"../../../entity.js\";\nimport { getColumnNameAndConfig } from \"../../../utils.js\";\nimport { PgColumn, PgColumnBuilder } from \"../common.js\";\nclass PgSparseVectorBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgSparseVectorBuilder\";\n  constructor(name, config) {\n    super(name, \"string\", \"PgSparseVector\");\n    this.config.dimensions = config.dimensions;\n  }\n  /** @internal */\n  build(table) {\n    return new PgSparseVector(\n      table,\n      this.config\n    );\n  }\n}\nclass PgSparseVector extends PgColumn {\n  static [entityKind] = \"PgSparseVector\";\n  dimensions = this.config.dimensions;\n  getSQLType() {\n    return `sparsevec(${this.dimensions})`;\n  }\n}\nfunction sparsevec(a, b) {\n  const { name, config } = getColumnNameAndConfig(a, b);\n  return new PgSparseVectorBuilder(name, config);\n}\nexport {\n  PgSparseVector,\n  PgSparseVectorBuilder,\n  sparsevec\n};\n//# sourceMappingURL=sparsevec.js.map","import { entityKind } from \"../../../entity.js\";\nimport { getColumnNameAndConfig } from \"../../../utils.js\";\nimport { PgColumn, PgColumnBuilder } from \"../common.js\";\nclass PgVectorBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgVectorBuilder\";\n  constructor(name, config) {\n    super(name, \"array\", \"PgVector\");\n    this.config.dimensions = config.dimensions;\n  }\n  /** @internal */\n  build(table) {\n    return new PgVector(\n      table,\n      this.config\n    );\n  }\n}\nclass PgVector extends PgColumn {\n  static [entityKind] = \"PgVector\";\n  dimensions = this.config.dimensions;\n  getSQLType() {\n    return `vector(${this.dimensions})`;\n  }\n  mapToDriverValue(value) {\n    return JSON.stringify(value);\n  }\n  mapFromDriverValue(value) {\n    return value.slice(1, -1).split(\",\").map((v) => Number.parseFloat(v));\n  }\n}\nfunction vector(a, b) {\n  const { name, config } = getColumnNameAndConfig(a, b);\n  return new PgVectorBuilder(name, config);\n}\nexport {\n  PgVector,\n  PgVectorBuilder,\n  vector\n};\n//# sourceMappingURL=vector.js.map","import { entityKind } from \"../entity.js\";\nimport { Table } from \"../table.js\";\nimport { getPgColumnBuilders } from \"./columns/all.js\";\nconst InlineForeignKeys = Symbol.for(\"drizzle:PgInlineForeignKeys\");\nconst EnableRLS = Symbol.for(\"drizzle:EnableRLS\");\nclass PgTable extends Table {\n  static [entityKind] = \"PgTable\";\n  /** @internal */\n  static Symbol = Object.assign({}, Table.Symbol, {\n    InlineForeignKeys,\n    EnableRLS\n  });\n  /**@internal */\n  [InlineForeignKeys] = [];\n  /** @internal */\n  [EnableRLS] = false;\n  /** @internal */\n  [Table.Symbol.ExtraConfigBuilder] = void 0;\n  /** @internal */\n  [Table.Symbol.ExtraConfigColumns] = {};\n}\nfunction pgTableWithSchema(name, columns, extraConfig, schema, baseName = name) {\n  const rawTable = new PgTable(name, schema, baseName);\n  const parsedColumns = typeof columns === \"function\" ? columns(getPgColumnBuilders()) : columns;\n  const builtColumns = Object.fromEntries(\n    Object.entries(parsedColumns).map(([name2, colBuilderBase]) => {\n      const colBuilder = colBuilderBase;\n      colBuilder.setName(name2);\n      const column = colBuilder.build(rawTable);\n      rawTable[InlineForeignKeys].push(...colBuilder.buildForeignKeys(column, rawTable));\n      return [name2, column];\n    })\n  );\n  const builtColumnsForExtraConfig = Object.fromEntries(\n    Object.entries(parsedColumns).map(([name2, colBuilderBase]) => {\n      const colBuilder = colBuilderBase;\n      colBuilder.setName(name2);\n      const column = colBuilder.buildExtraConfigColumn(rawTable);\n      return [name2, column];\n    })\n  );\n  const table = Object.assign(rawTable, builtColumns);\n  table[Table.Symbol.Columns] = builtColumns;\n  table[Table.Symbol.ExtraConfigColumns] = builtColumnsForExtraConfig;\n  if (extraConfig) {\n    table[PgTable.Symbol.ExtraConfigBuilder] = extraConfig;\n  }\n  return Object.assign(table, {\n    enableRLS: () => {\n      table[PgTable.Symbol.EnableRLS] = true;\n      return table;\n    }\n  });\n}\nconst pgTable = (name, columns, extraConfig) => {\n  return pgTableWithSchema(name, columns, extraConfig, void 0);\n};\nfunction pgTableCreator(customizeTableName) {\n  return (name, columns, extraConfig) => {\n    return pgTableWithSchema(customizeTableName(name), columns, extraConfig, void 0, name);\n  };\n}\nexport {\n  EnableRLS,\n  InlineForeignKeys,\n  PgTable,\n  pgTable,\n  pgTableCreator,\n  pgTableWithSchema\n};\n//# sourceMappingURL=table.js.map","import { SQL } from \"../sql/sql.js\";\nimport { entityKind, is } from \"../entity.js\";\nimport { IndexedColumn } from \"./columns/index.js\";\nclass IndexBuilderOn {\n  constructor(unique, name) {\n    this.unique = unique;\n    this.name = name;\n  }\n  static [entityKind] = \"PgIndexBuilderOn\";\n  on(...columns) {\n    return new IndexBuilder(\n      columns.map((it) => {\n        if (is(it, SQL)) {\n          return it;\n        }\n        it = it;\n        const clonedIndexedColumn = new IndexedColumn(it.name, !!it.keyAsName, it.columnType, it.indexConfig);\n        it.indexConfig = JSON.parse(JSON.stringify(it.defaultConfig));\n        return clonedIndexedColumn;\n      }),\n      this.unique,\n      false,\n      this.name\n    );\n  }\n  onOnly(...columns) {\n    return new IndexBuilder(\n      columns.map((it) => {\n        if (is(it, SQL)) {\n          return it;\n        }\n        it = it;\n        const clonedIndexedColumn = new IndexedColumn(it.name, !!it.keyAsName, it.columnType, it.indexConfig);\n        it.indexConfig = it.defaultConfig;\n        return clonedIndexedColumn;\n      }),\n      this.unique,\n      true,\n      this.name\n    );\n  }\n  /**\n   * Specify what index method to use. Choices are `btree`, `hash`, `gist`, `spgist`, `gin`, `brin`, or user-installed access methods like `bloom`. The default method is `btree.\n   *\n   * If you have the `pg_vector` extension installed in your database, you can use the `hnsw` and `ivfflat` options, which are predefined types.\n   *\n   * **You can always specify any string you want in the method, in case Drizzle doesn't have it natively in its types**\n   *\n   * @param method The name of the index method to be used\n   * @param columns\n   * @returns\n   */\n  using(method, ...columns) {\n    return new IndexBuilder(\n      columns.map((it) => {\n        if (is(it, SQL)) {\n          return it;\n        }\n        it = it;\n        const clonedIndexedColumn = new IndexedColumn(it.name, !!it.keyAsName, it.columnType, it.indexConfig);\n        it.indexConfig = JSON.parse(JSON.stringify(it.defaultConfig));\n        return clonedIndexedColumn;\n      }),\n      this.unique,\n      true,\n      this.name,\n      method\n    );\n  }\n}\nclass IndexBuilder {\n  static [entityKind] = \"PgIndexBuilder\";\n  /** @internal */\n  config;\n  constructor(columns, unique, only, name, method = \"btree\") {\n    this.config = {\n      name,\n      columns,\n      unique,\n      only,\n      method\n    };\n  }\n  concurrently() {\n    this.config.concurrently = true;\n    return this;\n  }\n  with(obj) {\n    this.config.with = obj;\n    return this;\n  }\n  where(condition) {\n    this.config.where = condition;\n    return this;\n  }\n  /** @internal */\n  build(table) {\n    return new Index(this.config, table);\n  }\n}\nclass Index {\n  static [entityKind] = \"PgIndex\";\n  config;\n  constructor(config, table) {\n    this.config = { ...config, table };\n  }\n}\nfunction index(name) {\n  return new IndexBuilderOn(false, name);\n}\nfunction uniqueIndex(name) {\n  return new IndexBuilderOn(true, name);\n}\nexport {\n  Index,\n  IndexBuilder,\n  IndexBuilderOn,\n  index,\n  uniqueIndex\n};\n//# sourceMappingURL=indexes.js.map","import { SYMBOL_CLEARED_COOKIES } from '../api-utils';\nimport { NEXT_REQUEST_META } from '../request-meta';\nimport { BaseNextRequest, BaseNextResponse } from './index';\nlet prop;\nexport class NodeNextRequest extends BaseNextRequest {\n    static #_ = prop = _NEXT_REQUEST_META = NEXT_REQUEST_META;\n    constructor(_req){\n        var _this__req;\n        super(_req.method.toUpperCase(), _req.url, _req), this._req = _req, this.headers = this._req.headers, this.fetchMetrics = (_this__req = this._req) == null ? void 0 : _this__req.fetchMetrics, this[_NEXT_REQUEST_META] = this._req[NEXT_REQUEST_META] || {}, this.streaming = false;\n    }\n    get originalRequest() {\n        // Need to mimic these changes to the original req object for places where we use it:\n        // render.tsx, api/ssg requests\n        this._req[NEXT_REQUEST_META] = this[NEXT_REQUEST_META];\n        this._req.url = this.url;\n        this._req.cookies = this.cookies;\n        return this._req;\n    }\n    set originalRequest(value) {\n        this._req = value;\n    }\n    /**\n   * Returns the request body as a Web Readable Stream. The body here can only\n   * be read once as the body will start flowing as soon as the data handler\n   * is attached.\n   *\n   * @internal\n   */ stream() {\n        if (this.streaming) {\n            throw Object.defineProperty(new Error('Invariant: NodeNextRequest.stream() can only be called once'), \"__NEXT_ERROR_CODE\", {\n                value: \"E467\",\n                enumerable: false,\n                configurable: true\n            });\n        }\n        this.streaming = true;\n        return new ReadableStream({\n            start: (controller)=>{\n                this._req.on('data', (chunk)=>{\n                    controller.enqueue(new Uint8Array(chunk));\n                });\n                this._req.on('end', ()=>{\n                    controller.close();\n                });\n                this._req.on('error', (err)=>{\n                    controller.error(err);\n                });\n            }\n        });\n    }\n}\nexport class NodeNextResponse extends BaseNextResponse {\n    get originalResponse() {\n        if (SYMBOL_CLEARED_COOKIES in this) {\n            this._res[SYMBOL_CLEARED_COOKIES] = this[SYMBOL_CLEARED_COOKIES];\n        }\n        return this._res;\n    }\n    constructor(_res){\n        super(_res), this._res = _res, this.textBody = undefined;\n    }\n    get sent() {\n        return this._res.finished || this._res.headersSent;\n    }\n    get statusCode() {\n        return this._res.statusCode;\n    }\n    set statusCode(value) {\n        this._res.statusCode = value;\n    }\n    get statusMessage() {\n        return this._res.statusMessage;\n    }\n    set statusMessage(value) {\n        this._res.statusMessage = value;\n    }\n    setHeader(name, value) {\n        this._res.setHeader(name, value);\n        return this;\n    }\n    removeHeader(name) {\n        this._res.removeHeader(name);\n        return this;\n    }\n    getHeaderValues(name) {\n        const values = this._res.getHeader(name);\n        if (values === undefined) return undefined;\n        return (Array.isArray(values) ? values : [\n            values\n        ]).map((value)=>value.toString());\n    }\n    hasHeader(name) {\n        return this._res.hasHeader(name);\n    }\n    getHeader(name) {\n        const values = this.getHeaderValues(name);\n        return Array.isArray(values) ? values.join(',') : undefined;\n    }\n    getHeaders() {\n        return this._res.getHeaders();\n    }\n    appendHeader(name, value) {\n        const currentValues = this.getHeaderValues(name) ?? [];\n        if (!currentValues.includes(value)) {\n            this._res.setHeader(name, [\n                ...currentValues,\n                value\n            ]);\n        }\n        return this;\n    }\n    body(value) {\n        this.textBody = value;\n        return this;\n    }\n    send() {\n        this._res.end(this.textBody);\n    }\n    onClose(callback) {\n        this.originalResponse.on('close', callback);\n    }\n}\nvar _NEXT_REQUEST_META;\n\n//# sourceMappingURL=node.js.map","import { Column } from \"../../column.js\";\nimport { is } from \"../../entity.js\";\nimport { sql } from \"../sql.js\";\nfunction count(expression) {\n  return sql`count(${expression || sql.raw(\"*\")})`.mapWith(Number);\n}\nfunction countDistinct(expression) {\n  return sql`count(distinct ${expression})`.mapWith(Number);\n}\nfunction avg(expression) {\n  return sql`avg(${expression})`.mapWith(String);\n}\nfunction avgDistinct(expression) {\n  return sql`avg(distinct ${expression})`.mapWith(String);\n}\nfunction sum(expression) {\n  return sql`sum(${expression})`.mapWith(String);\n}\nfunction sumDistinct(expression) {\n  return sql`sum(distinct ${expression})`.mapWith(String);\n}\nfunction max(expression) {\n  return sql`max(${expression})`.mapWith(is(expression, Column) ? expression : String);\n}\nfunction min(expression) {\n  return sql`min(${expression})`.mapWith(is(expression, Column) ? expression : String);\n}\nexport {\n  avg,\n  avgDistinct,\n  count,\n  countDistinct,\n  max,\n  min,\n  sum,\n  sumDistinct\n};\n//# sourceMappingURL=aggregate.js.map","import { entityKind } from \"../../entity.js\";\nimport { QueryPromise } from \"../../query-promise.js\";\nimport { tracer } from \"../../tracing.js\";\nclass PgRefreshMaterializedView extends QueryPromise {\n  constructor(view, session, dialect) {\n    super();\n    this.session = session;\n    this.dialect = dialect;\n    this.config = { view };\n  }\n  static [entityKind] = \"PgRefreshMaterializedView\";\n  config;\n  concurrently() {\n    if (this.config.withNoData !== void 0) {\n      throw new Error(\"Cannot use concurrently and withNoData together\");\n    }\n    this.config.concurrently = true;\n    return this;\n  }\n  withNoData() {\n    if (this.config.concurrently !== void 0) {\n      throw new Error(\"Cannot use concurrently and withNoData together\");\n    }\n    this.config.withNoData = true;\n    return this;\n  }\n  /** @internal */\n  getSQL() {\n    return this.dialect.buildRefreshMaterializedViewQuery(this.config);\n  }\n  toSQL() {\n    const { typings: _typings, ...rest } = this.dialect.sqlToQuery(this.getSQL());\n    return rest;\n  }\n  /** @internal */\n  _prepare(name) {\n    return tracer.startActiveSpan(\"drizzle.prepareQuery\", () => {\n      return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()), void 0, name, true);\n    });\n  }\n  prepare(name) {\n    return this._prepare(name);\n  }\n  authToken;\n  /** @internal */\n  setToken(token) {\n    this.authToken = token;\n    return this;\n  }\n  execute = (placeholderValues) => {\n    return tracer.startActiveSpan(\"drizzle.operation\", () => {\n      return this._prepare().execute(placeholderValues, this.authToken);\n    });\n  };\n}\nexport {\n  PgRefreshMaterializedView\n};\n//# sourceMappingURL=refresh-materialized-view.js.map","import { entityKind } from \"../../entity.js\";\nimport { getColumnNameAndConfig } from \"../../utils.js\";\nimport { PgColumn, PgColumnBuilder } from \"./common.js\";\nclass PgBigSerial53Builder extends PgColumnBuilder {\n  static [entityKind] = \"PgBigSerial53Builder\";\n  constructor(name) {\n    super(name, \"number\", \"PgBigSerial53\");\n    this.config.hasDefault = true;\n    this.config.notNull = true;\n  }\n  /** @internal */\n  build(table) {\n    return new PgBigSerial53(\n      table,\n      this.config\n    );\n  }\n}\nclass PgBigSerial53 extends PgColumn {\n  static [entityKind] = \"PgBigSerial53\";\n  getSQLType() {\n    return \"bigserial\";\n  }\n  mapFromDriverValue(value) {\n    if (typeof value === \"number\") {\n      return value;\n    }\n    return Number(value);\n  }\n}\nclass PgBigSerial64Builder extends PgColumnBuilder {\n  static [entityKind] = \"PgBigSerial64Builder\";\n  constructor(name) {\n    super(name, \"bigint\", \"PgBigSerial64\");\n    this.config.hasDefault = true;\n  }\n  /** @internal */\n  build(table) {\n    return new PgBigSerial64(\n      table,\n      this.config\n    );\n  }\n}\nclass PgBigSerial64 extends PgColumn {\n  static [entityKind] = \"PgBigSerial64\";\n  getSQLType() {\n    return \"bigserial\";\n  }\n  // eslint-disable-next-line unicorn/prefer-native-coercion-functions\n  mapFromDriverValue(value) {\n    return BigInt(value);\n  }\n}\nfunction bigserial(a, b) {\n  const { name, config } = getColumnNameAndConfig(a, b);\n  if (config.mode === \"number\") {\n    return new PgBigSerial53Builder(name);\n  }\n  return new PgBigSerial64Builder(name);\n}\nexport {\n  PgBigSerial53,\n  PgBigSerial53Builder,\n  PgBigSerial64,\n  PgBigSerial64Builder,\n  bigserial\n};\n//# sourceMappingURL=bigserial.js.map","import { pgTable, uuid, varchar, timestamp, boolean, text } from 'drizzle-orm/pg-core';\nimport { users } from './users';\n\nexport const notifications = pgTable('notifications', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  userId: uuid('user_id').notNull().references(() => users.id),\n\n  type: varchar('type', { length: 50 }).notNull(),\n  title: varchar('title', { length: 255 }).notNull(),\n  message: text('message'),\n\n  relatedType: varchar('related_type', { length: 50 }),\n  relatedId: uuid('related_id'),\n\n  isRead: boolean('is_read').default(false),\n  readAt: timestamp('read_at'),\n\n  pushSentAt: timestamp('push_sent_at'),\n  emailSentAt: timestamp('email_sent_at'),\n\n  createdAt: timestamp('created_at').defaultNow(),\n});\n\nexport const pushSubscriptions = pgTable('push_subscriptions', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  userId: uuid('user_id').notNull().references(() => users.id),\n\n  endpoint: text('endpoint').notNull(),\n  p256dh: text('p256dh').notNull(),\n  auth: text('auth').notNull(),\n\n  userAgent: varchar('user_agent', { length: 500 }),\n\n  createdAt: timestamp('created_at').defaultNow(),\n});\n","import { normalizeLocalePath } from '../../i18n/normalize-locale-path';\nimport { removePathPrefix } from './remove-path-prefix';\nimport { pathHasPrefix } from './path-has-prefix';\nexport function getNextPathnameInfo(pathname, options) {\n    const { basePath, i18n, trailingSlash } = options.nextConfig ?? {};\n    const info = {\n        pathname,\n        trailingSlash: pathname !== '/' ? pathname.endsWith('/') : trailingSlash\n    };\n    if (basePath && pathHasPrefix(info.pathname, basePath)) {\n        info.pathname = removePathPrefix(info.pathname, basePath);\n        info.basePath = basePath;\n    }\n    let pathnameNoDataPrefix = info.pathname;\n    if (info.pathname.startsWith('/_next/data/') && info.pathname.endsWith('.json')) {\n        const paths = info.pathname.replace(/^\\/_next\\/data\\//, '').replace(/\\.json$/, '').split('/');\n        const buildId = paths[0];\n        info.buildId = buildId;\n        pathnameNoDataPrefix = paths[1] !== 'index' ? `/${paths.slice(1).join('/')}` : '/';\n        // update pathname with normalized if enabled although\n        // we use normalized to populate locale info still\n        if (options.parseData === true) {\n            info.pathname = pathnameNoDataPrefix;\n        }\n    }\n    // If provided, use the locale route normalizer to detect the locale instead\n    // of the function below.\n    if (i18n) {\n        let result = options.i18nProvider ? options.i18nProvider.analyze(info.pathname) : normalizeLocalePath(info.pathname, i18n.locales);\n        info.locale = result.detectedLocale;\n        info.pathname = result.pathname ?? info.pathname;\n        if (!result.detectedLocale && info.buildId) {\n            result = options.i18nProvider ? options.i18nProvider.analyze(pathnameNoDataPrefix) : normalizeLocalePath(pathnameNoDataPrefix, i18n.locales);\n            if (result.detectedLocale) {\n                info.locale = result.detectedLocale;\n            }\n        }\n    }\n    return info;\n}\n\n//# sourceMappingURL=get-next-pathname-info.js.map","import { Query } from './query.js'\nimport { Errors } from './errors.js'\n\nexport const types = {\n  string: {\n    to: 25,\n    from: null,             // defaults to string\n    serialize: x => '' + x\n  },\n  number: {\n    to: 0,\n    from: [21, 23, 26, 700, 701],\n    serialize: x => '' + x,\n    parse: x => +x\n  },\n  json: {\n    to: 114,\n    from: [114, 3802],\n    serialize: x => JSON.stringify(x),\n    parse: x => JSON.parse(x)\n  },\n  boolean: {\n    to: 16,\n    from: 16,\n    serialize: x => x === true ? 't' : 'f',\n    parse: x => x === 't'\n  },\n  date: {\n    to: 1184,\n    from: [1082, 1114, 1184],\n    serialize: x => (x instanceof Date ? x : new Date(x)).toISOString(),\n    parse: x => new Date(x)\n  },\n  bytea: {\n    to: 17,\n    from: 17,\n    serialize: x => '\\\\x' + Buffer.from(x).toString('hex'),\n    parse: x => Buffer.from(x.slice(2), 'hex')\n  }\n}\n\nclass NotTagged { then() { notTagged() } catch() { notTagged() } finally() { notTagged() }}\n\nexport class Identifier extends NotTagged {\n  constructor(value) {\n    super()\n    this.value = escapeIdentifier(value)\n  }\n}\n\nexport class Parameter extends NotTagged {\n  constructor(value, type, array) {\n    super()\n    this.value = value\n    this.type = type\n    this.array = array\n  }\n}\n\nexport class Builder extends NotTagged {\n  constructor(first, rest) {\n    super()\n    this.first = first\n    this.rest = rest\n  }\n\n  build(before, parameters, types, options) {\n    const keyword = builders.map(([x, fn]) => ({ fn, i: before.search(x) })).sort((a, b) => a.i - b.i).pop()\n    return keyword.i === -1\n      ? escapeIdentifiers(this.first, options)\n      : keyword.fn(this.first, this.rest, parameters, types, options)\n  }\n}\n\nexport function handleValue(x, parameters, types, options) {\n  let value = x instanceof Parameter ? x.value : x\n  if (value === undefined) {\n    x instanceof Parameter\n      ? x.value = options.transform.undefined\n      : value = x = options.transform.undefined\n\n    if (value === undefined)\n      throw Errors.generic('UNDEFINED_VALUE', 'Undefined values are not allowed')\n  }\n\n  return '$' + (types.push(\n    x instanceof Parameter\n      ? (parameters.push(x.value), x.array\n        ? x.array[x.type || inferType(x.value)] || x.type || firstIsString(x.value)\n        : x.type\n      )\n      : (parameters.push(x), inferType(x))\n  ))\n}\n\nconst defaultHandlers = typeHandlers(types)\n\nexport function stringify(q, string, value, parameters, types, options) { // eslint-disable-line\n  for (let i = 1; i < q.strings.length; i++) {\n    string += (stringifyValue(string, value, parameters, types, options)) + q.strings[i]\n    value = q.args[i]\n  }\n\n  return string\n}\n\nfunction stringifyValue(string, value, parameters, types, o) {\n  return (\n    value instanceof Builder ? value.build(string, parameters, types, o) :\n    value instanceof Query ? fragment(value, parameters, types, o) :\n    value instanceof Identifier ? value.value :\n    value && value[0] instanceof Query ? value.reduce((acc, x) => acc + ' ' + fragment(x, parameters, types, o), '') :\n    handleValue(value, parameters, types, o)\n  )\n}\n\nfunction fragment(q, parameters, types, options) {\n  q.fragment = true\n  return stringify(q, q.strings[0], q.args[0], parameters, types, options)\n}\n\nfunction valuesBuilder(first, parameters, types, columns, options) {\n  return first.map(row =>\n    '(' + columns.map(column =>\n      stringifyValue('values', row[column], parameters, types, options)\n    ).join(',') + ')'\n  ).join(',')\n}\n\nfunction values(first, rest, parameters, types, options) {\n  const multi = Array.isArray(first[0])\n  const columns = rest.length ? rest.flat() : Object.keys(multi ? first[0] : first)\n  return valuesBuilder(multi ? first : [first], parameters, types, columns, options)\n}\n\nfunction select(first, rest, parameters, types, options) {\n  typeof first === 'string' && (first = [first].concat(rest))\n  if (Array.isArray(first))\n    return escapeIdentifiers(first, options)\n\n  let value\n  const columns = rest.length ? rest.flat() : Object.keys(first)\n  return columns.map(x => {\n    value = first[x]\n    return (\n      value instanceof Query ? fragment(value, parameters, types, options) :\n      value instanceof Identifier ? value.value :\n      handleValue(value, parameters, types, options)\n    ) + ' as ' + escapeIdentifier(options.transform.column.to ? options.transform.column.to(x) : x)\n  }).join(',')\n}\n\nconst builders = Object.entries({\n  values,\n  in: (...xs) => {\n    const x = values(...xs)\n    return x === '()' ? '(null)' : x\n  },\n  select,\n  as: select,\n  returning: select,\n  '\\\\(': select,\n\n  update(first, rest, parameters, types, options) {\n    return (rest.length ? rest.flat() : Object.keys(first)).map(x =>\n      escapeIdentifier(options.transform.column.to ? options.transform.column.to(x) : x) +\n      '=' + stringifyValue('values', first[x], parameters, types, options)\n    )\n  },\n\n  insert(first, rest, parameters, types, options) {\n    const columns = rest.length ? rest.flat() : Object.keys(Array.isArray(first) ? first[0] : first)\n    return '(' + escapeIdentifiers(columns, options) + ')values' +\n    valuesBuilder(Array.isArray(first) ? first : [first], parameters, types, columns, options)\n  }\n}).map(([x, fn]) => ([new RegExp('((?:^|[\\\\s(])' + x + '(?:$|[\\\\s(]))(?![\\\\s\\\\S]*\\\\1)', 'i'), fn]))\n\nfunction notTagged() {\n  throw Errors.generic('NOT_TAGGED_CALL', 'Query not called as a tagged template literal')\n}\n\nexport const serializers = defaultHandlers.serializers\nexport const parsers = defaultHandlers.parsers\n\nexport const END = {}\n\nfunction firstIsString(x) {\n  if (Array.isArray(x))\n    return firstIsString(x[0])\n  return typeof x === 'string' ? 1009 : 0\n}\n\nexport const mergeUserTypes = function(types) {\n  const user = typeHandlers(types || {})\n  return {\n    serializers: Object.assign({}, serializers, user.serializers),\n    parsers: Object.assign({}, parsers, user.parsers)\n  }\n}\n\nfunction typeHandlers(types) {\n  return Object.keys(types).reduce((acc, k) => {\n    types[k].from && [].concat(types[k].from).forEach(x => acc.parsers[x] = types[k].parse)\n    if (types[k].serialize) {\n      acc.serializers[types[k].to] = types[k].serialize\n      types[k].from && [].concat(types[k].from).forEach(x => acc.serializers[x] = types[k].serialize)\n    }\n    return acc\n  }, { parsers: {}, serializers: {} })\n}\n\nfunction escapeIdentifiers(xs, { transform: { column } }) {\n  return xs.map(x => escapeIdentifier(column.to ? column.to(x) : x)).join(',')\n}\n\nexport const escapeIdentifier = function escape(str) {\n  return '\"' + str.replace(/\"/g, '\"\"').replace(/\\./g, '\".\"') + '\"'\n}\n\nexport const inferType = function inferType(x) {\n  return (\n    x instanceof Parameter ? x.type :\n    x instanceof Date ? 1184 :\n    x instanceof Uint8Array ? 17 :\n    (x === true || x === false) ? 16 :\n    typeof x === 'bigint' ? 20 :\n    Array.isArray(x) ? inferType(x[0]) :\n    0\n  )\n}\n\nconst escapeBackslash = /\\\\/g\nconst escapeQuote = /\"/g\n\nfunction arrayEscape(x) {\n  return x\n    .replace(escapeBackslash, '\\\\\\\\')\n    .replace(escapeQuote, '\\\\\"')\n}\n\nexport const arraySerializer = function arraySerializer(xs, serializer, options, typarray) {\n  if (Array.isArray(xs) === false)\n    return xs\n\n  if (!xs.length)\n    return '{}'\n\n  const first = xs[0]\n  // Only _box (1020) has the ';' delimiter for arrays, all other types use the ',' delimiter\n  const delimiter = typarray === 1020 ? ';' : ','\n\n  if (Array.isArray(first) && !first.type)\n    return '{' + xs.map(x => arraySerializer(x, serializer, options, typarray)).join(delimiter) + '}'\n\n  return '{' + xs.map(x => {\n    if (x === undefined) {\n      x = options.transform.undefined\n      if (x === undefined)\n        throw Errors.generic('UNDEFINED_VALUE', 'Undefined values are not allowed')\n    }\n\n    return x === null\n      ? 'null'\n      : '\"' + arrayEscape(serializer ? serializer(x.type ? x.value : x) : '' + x) + '\"'\n  }).join(delimiter) + '}'\n}\n\nconst arrayParserState = {\n  i: 0,\n  char: null,\n  str: '',\n  quoted: false,\n  last: 0\n}\n\nexport const arrayParser = function arrayParser(x, parser, typarray) {\n  arrayParserState.i = arrayParserState.last = 0\n  return arrayParserLoop(arrayParserState, x, parser, typarray)\n}\n\nfunction arrayParserLoop(s, x, parser, typarray) {\n  const xs = []\n  // Only _box (1020) has the ';' delimiter for arrays, all other types use the ',' delimiter\n  const delimiter = typarray === 1020 ? ';' : ','\n  for (; s.i < x.length; s.i++) {\n    s.char = x[s.i]\n    if (s.quoted) {\n      if (s.char === '\\\\') {\n        s.str += x[++s.i]\n      } else if (s.char === '\"') {\n        xs.push(parser ? parser(s.str) : s.str)\n        s.str = ''\n        s.quoted = x[s.i + 1] === '\"'\n        s.last = s.i + 2\n      } else {\n        s.str += s.char\n      }\n    } else if (s.char === '\"') {\n      s.quoted = true\n    } else if (s.char === '{') {\n      s.last = ++s.i\n      xs.push(arrayParserLoop(s, x, parser, typarray))\n    } else if (s.char === '}') {\n      s.quoted = false\n      s.last < s.i && xs.push(parser ? parser(x.slice(s.last, s.i)) : x.slice(s.last, s.i))\n      s.last = s.i + 1\n      break\n    } else if (s.char === delimiter && s.p !== '}' && s.p !== '\"') {\n      xs.push(parser ? parser(x.slice(s.last, s.i)) : x.slice(s.last, s.i))\n      s.last = s.i + 1\n    }\n    s.p = s.char\n  }\n  s.last < s.i && xs.push(parser ? parser(x.slice(s.last, s.i + 1)) : x.slice(s.last, s.i + 1))\n  return xs\n}\n\nexport const toCamel = x => {\n  let str = x[0]\n  for (let i = 1; i < x.length; i++)\n    str += x[i] === '_' ? x[++i].toUpperCase() : x[i]\n  return str\n}\n\nexport const toPascal = x => {\n  let str = x[0].toUpperCase()\n  for (let i = 1; i < x.length; i++)\n    str += x[i] === '_' ? x[++i].toUpperCase() : x[i]\n  return str\n}\n\nexport const toKebab = x => x.replace(/_/g, '-')\n\nexport const fromCamel = x => x.replace(/([A-Z])/g, '_$1').toLowerCase()\nexport const fromPascal = x => (x.slice(0, 1) + x.slice(1).replace(/([A-Z])/g, '_$1')).toLowerCase()\nexport const fromKebab = x => x.replace(/-/g, '_')\n\nfunction createJsonTransform(fn) {\n  return function jsonTransform(x, column) {\n    return typeof x === 'object' && x !== null && (column.type === 114 || column.type === 3802)\n      ? Array.isArray(x)\n        ? x.map(x => jsonTransform(x, column))\n        : Object.entries(x).reduce((acc, [k, v]) => Object.assign(acc, { [fn(k)]: jsonTransform(v, column) }), {})\n      : x\n  }\n}\n\ntoCamel.column = { from: toCamel }\ntoCamel.value = { from: createJsonTransform(toCamel) }\nfromCamel.column = { to: fromCamel }\n\nexport const camel = { ...toCamel }\ncamel.column.to = fromCamel\n\ntoPascal.column = { from: toPascal }\ntoPascal.value = { from: createJsonTransform(toPascal) }\nfromPascal.column = { to: fromPascal }\n\nexport const pascal = { ...toPascal }\npascal.column.to = fromPascal\n\ntoKebab.column = { from: toKebab }\ntoKebab.value = { from: createJsonTransform(toKebab) }\nfromKebab.column = { to: fromKebab }\n\nexport const kebab = { ...toKebab }\nkebab.column.to = fromKebab\n","import { decode as b64u } from './base64url.js';\nimport { decoder } from '../lib/buffer_utils.js';\nimport { isObject } from '../lib/is_object.js';\nexport function decodeProtectedHeader(token) {\n    let protectedB64u;\n    if (typeof token === 'string') {\n        const parts = token.split('.');\n        if (parts.length === 3 || parts.length === 5) {\n            ;\n            [protectedB64u] = parts;\n        }\n    }\n    else if (typeof token === 'object' && token) {\n        if ('protected' in token) {\n            protectedB64u = token.protected;\n        }\n        else {\n            throw new TypeError('Token does not contain a Protected Header');\n        }\n    }\n    try {\n        if (typeof protectedB64u !== 'string' || !protectedB64u) {\n            throw new Error();\n        }\n        const result = JSON.parse(decoder.decode(b64u(protectedB64u)));\n        if (!isObject(result)) {\n            throw new Error();\n        }\n        return result;\n    }\n    catch {\n        throw new TypeError('Invalid Token or Protected Header formatting');\n    }\n}\n","import { auth } from '@/lib/auth';\nimport { toNextJsHandler } from 'better-auth/next-js';\n\nexport const { GET, POST } = toNextJsHandler(auth);\n","import { pgTable, uuid, varchar, timestamp, boolean, pgEnum, text } from 'drizzle-orm/pg-core';\nimport { schools } from './schools';\n\nexport const userRoleEnum = pgEnum('user_role', [\n  'super_admin',\n  'school_admin',\n  'teacher',\n  'student',\n  'company_user',\n]);\n\nexport type UserRole = 'super_admin' | 'school_admin' | 'teacher' | 'student' | 'company_user';\n\n/**\n * Users table - compatible with Better Auth\n *\n * Better Auth required fields: id, name, email, emailVerified, image, createdAt, updatedAt\n * Custom fields: schoolId, role, firstName, lastName, username, displayUsername, isActive, lastLoginAt\n */\nexport const users = pgTable('users', {\n  // Better Auth required fields\n  id: uuid('id').primaryKey().defaultRandom(),\n  name: varchar('name', { length: 255 }).notNull(),\n  email: varchar('email', { length: 255 }).notNull(),\n  emailVerified: boolean('email_verified').default(false),\n  image: varchar('image', { length: 500 }),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  updatedAt: timestamp('updated_at').defaultNow().notNull(),\n\n  // Username plugin fields\n  username: varchar('username', { length: 100 }).unique(),\n  displayUsername: varchar('display_username', { length: 100 }),\n\n  // Custom fields for our app\n  schoolId: uuid('school_id').references(() => schools.id),\n  firstName: varchar('first_name', { length: 100 }).notNull(),\n  lastName: varchar('last_name', { length: 100 }).notNull(),\n  role: userRoleEnum('role').notNull().default('student'),\n  isActive: boolean('is_active').default(true),\n  lastLoginAt: timestamp('last_login_at'),\n});\n\n/**\n * Sessions table - compatible with Better Auth\n */\nexport const sessions = pgTable('sessions', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  userId: uuid('user_id').notNull().references(() => users.id, { onDelete: 'cascade' }),\n  token: varchar('token', { length: 255 }).notNull().unique(),\n  expiresAt: timestamp('expires_at').notNull(),\n  ipAddress: varchar('ip_address', { length: 45 }),\n  userAgent: text('user_agent'),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  updatedAt: timestamp('updated_at').defaultNow().notNull(),\n});\n\n/**\n * Accounts table - Better Auth uses this for OAuth providers and credentials\n */\nexport const accounts = pgTable('accounts', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  userId: uuid('user_id').notNull().references(() => users.id, { onDelete: 'cascade' }),\n  accountId: varchar('account_id', { length: 255 }).notNull(),\n  providerId: varchar('provider_id', { length: 255 }).notNull(),\n  accessToken: text('access_token'),\n  refreshToken: text('refresh_token'),\n  accessTokenExpiresAt: timestamp('access_token_expires_at'),\n  refreshTokenExpiresAt: timestamp('refresh_token_expires_at'),\n  scope: varchar('scope', { length: 500 }),\n  idToken: text('id_token'),\n  password: varchar('password', { length: 255 }),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  updatedAt: timestamp('updated_at').defaultNow().notNull(),\n});\n\n/**\n * Verifications table - Better Auth uses this for email verification, password reset, etc.\n */\nexport const verifications = pgTable('verifications', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  identifier: varchar('identifier', { length: 255 }).notNull(),\n  value: varchar('value', { length: 255 }).notNull(),\n  expiresAt: timestamp('expires_at').notNull(),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  updatedAt: timestamp('updated_at').defaultNow().notNull(),\n});\n","import { pgTable, uuid, varchar, timestamp, boolean, date, text, jsonb } from 'drizzle-orm/pg-core';\nimport { internships } from './internships';\n\nexport const milestones = pgTable('milestones', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  internshipId: uuid('internship_id').notNull().references(() => internships.id),\n\n  type: varchar('type', { length: 50 }).notNull(),\n  title: varchar('title', { length: 255 }).notNull(),\n  description: text('description'),\n\n  dueDate: date('due_date'),\n\n  isCompleted: boolean('is_completed').default(false),\n  completedAt: timestamp('completed_at'),\n\n  documentIds: jsonb('document_ids').$type<string[]>().default([]),\n  remindersSent: jsonb('reminders_sent').$type<string[]>().default([]),\n\n  createdAt: timestamp('created_at').defaultNow(),\n});\n","import { ReflectAdapter } from './reflect';\n/**\n * @internal\n */ export class ReadonlyHeadersError extends Error {\n    constructor(){\n        super('Headers cannot be modified. Read more: https://nextjs.org/docs/app/api-reference/functions/headers');\n    }\n    static callable() {\n        throw new ReadonlyHeadersError();\n    }\n}\nexport class HeadersAdapter extends Headers {\n    constructor(headers){\n        // We've already overridden the methods that would be called, so we're just\n        // calling the super constructor to ensure that the instanceof check works.\n        super();\n        this.headers = new Proxy(headers, {\n            get (target, prop, receiver) {\n                // Because this is just an object, we expect that all \"get\" operations\n                // are for properties. If it's a \"get\" for a symbol, we'll just return\n                // the symbol.\n                if (typeof prop === 'symbol') {\n                    return ReflectAdapter.get(target, prop, receiver);\n                }\n                const lowercased = prop.toLowerCase();\n                // Let's find the original casing of the key. This assumes that there is\n                // no mixed case keys (e.g. \"Content-Type\" and \"content-type\") in the\n                // headers object.\n                const original = Object.keys(headers).find((o)=>o.toLowerCase() === lowercased);\n                // If the original casing doesn't exist, return undefined.\n                if (typeof original === 'undefined') return;\n                // If the original casing exists, return the value.\n                return ReflectAdapter.get(target, original, receiver);\n            },\n            set (target, prop, value, receiver) {\n                if (typeof prop === 'symbol') {\n                    return ReflectAdapter.set(target, prop, value, receiver);\n                }\n                const lowercased = prop.toLowerCase();\n                // Let's find the original casing of the key. This assumes that there is\n                // no mixed case keys (e.g. \"Content-Type\" and \"content-type\") in the\n                // headers object.\n                const original = Object.keys(headers).find((o)=>o.toLowerCase() === lowercased);\n                // If the original casing doesn't exist, use the prop as the key.\n                return ReflectAdapter.set(target, original ?? prop, value, receiver);\n            },\n            has (target, prop) {\n                if (typeof prop === 'symbol') return ReflectAdapter.has(target, prop);\n                const lowercased = prop.toLowerCase();\n                // Let's find the original casing of the key. This assumes that there is\n                // no mixed case keys (e.g. \"Content-Type\" and \"content-type\") in the\n                // headers object.\n                const original = Object.keys(headers).find((o)=>o.toLowerCase() === lowercased);\n                // If the original casing doesn't exist, return false.\n                if (typeof original === 'undefined') return false;\n                // If the original casing exists, return true.\n                return ReflectAdapter.has(target, original);\n            },\n            deleteProperty (target, prop) {\n                if (typeof prop === 'symbol') return ReflectAdapter.deleteProperty(target, prop);\n                const lowercased = prop.toLowerCase();\n                // Let's find the original casing of the key. This assumes that there is\n                // no mixed case keys (e.g. \"Content-Type\" and \"content-type\") in the\n                // headers object.\n                const original = Object.keys(headers).find((o)=>o.toLowerCase() === lowercased);\n                // If the original casing doesn't exist, return true.\n                if (typeof original === 'undefined') return true;\n                // If the original casing exists, delete the property.\n                return ReflectAdapter.deleteProperty(target, original);\n            }\n        });\n    }\n    /**\n   * Seals a Headers instance to prevent modification by throwing an error when\n   * any mutating method is called.\n   */ static seal(headers) {\n        return new Proxy(headers, {\n            get (target, prop, receiver) {\n                switch(prop){\n                    case 'append':\n                    case 'delete':\n                    case 'set':\n                        return ReadonlyHeadersError.callable;\n                    default:\n                        return ReflectAdapter.get(target, prop, receiver);\n                }\n            }\n        });\n    }\n    /**\n   * Merges a header value into a string. This stores multiple values as an\n   * array, so we need to merge them into a string.\n   *\n   * @param value a header value\n   * @returns a merged header value (a string)\n   */ merge(value) {\n        if (Array.isArray(value)) return value.join(', ');\n        return value;\n    }\n    /**\n   * Creates a Headers instance from a plain object or a Headers instance.\n   *\n   * @param headers a plain object or a Headers instance\n   * @returns a headers instance\n   */ static from(headers) {\n        if (headers instanceof Headers) return headers;\n        return new HeadersAdapter(headers);\n    }\n    append(name, value) {\n        const existing = this.headers[name];\n        if (typeof existing === 'string') {\n            this.headers[name] = [\n                existing,\n                value\n            ];\n        } else if (Array.isArray(existing)) {\n            existing.push(value);\n        } else {\n            this.headers[name] = value;\n        }\n    }\n    delete(name) {\n        delete this.headers[name];\n    }\n    get(name) {\n        const value = this.headers[name];\n        if (typeof value !== 'undefined') return this.merge(value);\n        return null;\n    }\n    has(name) {\n        return typeof this.headers[name] !== 'undefined';\n    }\n    set(name, value) {\n        this.headers[name] = value;\n    }\n    forEach(callbackfn, thisArg) {\n        for (const [name, value] of this.entries()){\n            callbackfn.call(thisArg, value, name, this);\n        }\n    }\n    *entries() {\n        for (const key of Object.keys(this.headers)){\n            const name = key.toLowerCase();\n            // We assert here that this is a string because we got it from the\n            // Object.keys() call above.\n            const value = this.get(name);\n            yield [\n                name,\n                value\n            ];\n        }\n    }\n    *keys() {\n        for (const key of Object.keys(this.headers)){\n            const name = key.toLowerCase();\n            yield name;\n        }\n    }\n    *values() {\n        for (const key of Object.keys(this.headers)){\n            // We assert here that this is a string because we got it from the\n            // Object.keys() call above.\n            const value = this.get(key);\n            yield value;\n        }\n    }\n    [Symbol.iterator]() {\n        return this.entries();\n    }\n}\n\n//# sourceMappingURL=headers.js.map","/**\n * Parse cookies from the `headers` of request\n * @param req request object\n */ export function getCookieParser(headers) {\n    return function parseCookie() {\n        const { cookie } = headers;\n        if (!cookie) {\n            return {};\n        }\n        const { parse: parseCookieFn } = require('next/dist/compiled/cookie');\n        return parseCookieFn(Array.isArray(cookie) ? cookie.join('; ') : cookie);\n    };\n}\n\n//# sourceMappingURL=get-cookie-parser.js.map","/**\n * For a given page path, this function ensures that there is a leading slash.\n * If there is not a leading slash, one is added, otherwise it is noop.\n */ export function ensureLeadingSlash(path) {\n    return path.startsWith('/') ? path : `/${path}`;\n}\n\n//# sourceMappingURL=ensure-leading-slash.js.map","import { chainStreams, streamFromBuffer, streamFromString, streamToString } from './stream-utils/node-web-streams-helper';\nimport { isAbortError, pipeToNodeResponse } from './pipe-readable';\nimport { InvariantError } from '../shared/lib/invariant-error';\nexport default class RenderResult {\n    static #_ = /**\n   * A render result that represents an empty response. This is used to\n   * represent a response that was not found or was already sent.\n   */ this.EMPTY = new RenderResult(null, {\n        metadata: {},\n        contentType: null\n    });\n    /**\n   * Creates a new RenderResult instance from a static response.\n   *\n   * @param value the static response value\n   * @param contentType the content type of the response\n   * @returns a new RenderResult instance\n   */ static fromStatic(value, contentType) {\n        return new RenderResult(value, {\n            metadata: {},\n            contentType\n        });\n    }\n    constructor(response, { contentType, waitUntil, metadata }){\n        this.response = response;\n        this.contentType = contentType;\n        this.metadata = metadata;\n        this.waitUntil = waitUntil;\n    }\n    assignMetadata(metadata) {\n        Object.assign(this.metadata, metadata);\n    }\n    /**\n   * Returns true if the response is null. It can be null if the response was\n   * not found or was already sent.\n   */ get isNull() {\n        return this.response === null;\n    }\n    /**\n   * Returns false if the response is a string. It can be a string if the page\n   * was prerendered. If it's not, then it was generated dynamically.\n   */ get isDynamic() {\n        return typeof this.response !== 'string';\n    }\n    toUnchunkedString(stream = false) {\n        if (this.response === null) {\n            // If the response is null, return an empty string. This behavior is\n            // intentional as we're now providing the `RenderResult.EMPTY` value.\n            return '';\n        }\n        if (typeof this.response !== 'string') {\n            if (!stream) {\n                throw Object.defineProperty(new InvariantError('dynamic responses cannot be unchunked. This is a bug in Next.js'), \"__NEXT_ERROR_CODE\", {\n                    value: \"E732\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n            return streamToString(this.readable);\n        }\n        return this.response;\n    }\n    /**\n   * Returns a readable stream of the response.\n   */ get readable() {\n        if (this.response === null) {\n            // If the response is null, return an empty stream. This behavior is\n            // intentional as we're now providing the `RenderResult.EMPTY` value.\n            return new ReadableStream({\n                start (controller) {\n                    controller.close();\n                }\n            });\n        }\n        if (typeof this.response === 'string') {\n            return streamFromString(this.response);\n        }\n        if (Buffer.isBuffer(this.response)) {\n            return streamFromBuffer(this.response);\n        }\n        // If the response is an array of streams, then chain them together.\n        if (Array.isArray(this.response)) {\n            return chainStreams(...this.response);\n        }\n        return this.response;\n    }\n    /**\n   * Coerces the response to an array of streams. This will convert the response\n   * to an array of streams if it is not already one.\n   *\n   * @returns An array of streams\n   */ coerce() {\n        if (this.response === null) {\n            // If the response is null, return an empty stream. This behavior is\n            // intentional as we're now providing the `RenderResult.EMPTY` value.\n            return [];\n        }\n        if (typeof this.response === 'string') {\n            return [\n                streamFromString(this.response)\n            ];\n        } else if (Array.isArray(this.response)) {\n            return this.response;\n        } else if (Buffer.isBuffer(this.response)) {\n            return [\n                streamFromBuffer(this.response)\n            ];\n        } else {\n            return [\n                this.response\n            ];\n        }\n    }\n    /**\n   * Unshifts a new stream to the response. This will convert the response to an\n   * array of streams if it is not already one and will add the new stream to\n   * the start of the array. When this response is piped, all of the streams\n   * will be piped one after the other.\n   *\n   * @param readable The new stream to unshift\n   */ unshift(readable) {\n        // Coerce the response to an array of streams.\n        this.response = this.coerce();\n        // Add the new stream to the start of the array.\n        this.response.unshift(readable);\n    }\n    /**\n   * Chains a new stream to the response. This will convert the response to an\n   * array of streams if it is not already one and will add the new stream to\n   * the end. When this response is piped, all of the streams will be piped\n   * one after the other.\n   *\n   * @param readable The new stream to chain\n   */ push(readable) {\n        // Coerce the response to an array of streams.\n        this.response = this.coerce();\n        // Add the new stream to the end of the array.\n        this.response.push(readable);\n    }\n    /**\n   * Pipes the response to a writable stream. This will close/cancel the\n   * writable stream if an error is encountered. If this doesn't throw, then\n   * the writable stream will be closed or aborted.\n   *\n   * @param writable Writable stream to pipe the response to\n   */ async pipeTo(writable) {\n        try {\n            await this.readable.pipeTo(writable, {\n                // We want to close the writable stream ourselves so that we can wait\n                // for the waitUntil promise to resolve before closing it. If an error\n                // is encountered, we'll abort the writable stream if we swallowed the\n                // error.\n                preventClose: true\n            });\n            // If there is a waitUntil promise, wait for it to resolve before\n            // closing the writable stream.\n            if (this.waitUntil) await this.waitUntil;\n            // Close the writable stream.\n            await writable.close();\n        } catch (err) {\n            // If this is an abort error, we should abort the writable stream (as we\n            // took ownership of it when we started piping). We don't need to re-throw\n            // because we handled the error.\n            if (isAbortError(err)) {\n                // Abort the writable stream if an error is encountered.\n                await writable.abort(err);\n                return;\n            }\n            // We're not aborting the writer here as when this method throws it's not\n            // clear as to how so the caller should assume it's their responsibility\n            // to clean up the writer.\n            throw err;\n        }\n    }\n    /**\n   * Pipes the response to a node response. This will close/cancel the node\n   * response if an error is encountered.\n   *\n   * @param res\n   */ async pipeToNodeResponse(res) {\n        await pipeToNodeResponse(this.readable, res, this.waitUntil);\n    }\n}\n\n//# sourceMappingURL=render-result.js.map","import { entityKind } from \"../../entity.js\";\nimport { getColumnNameAndConfig } from \"../../utils.js\";\nimport { PgColumn } from \"./common.js\";\nimport { PgDateColumnBaseBuilder } from \"./date.common.js\";\nclass PgDateBuilder extends PgDateColumnBaseBuilder {\n  static [entityKind] = \"PgDateBuilder\";\n  constructor(name) {\n    super(name, \"date\", \"PgDate\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgDate(table, this.config);\n  }\n}\nclass PgDate extends PgColumn {\n  static [entityKind] = \"PgDate\";\n  getSQLType() {\n    return \"date\";\n  }\n  mapFromDriverValue(value) {\n    if (typeof value === \"string\") return new Date(value);\n    return value;\n  }\n  mapToDriverValue(value) {\n    return value.toISOString();\n  }\n}\nclass PgDateStringBuilder extends PgDateColumnBaseBuilder {\n  static [entityKind] = \"PgDateStringBuilder\";\n  constructor(name) {\n    super(name, \"string\", \"PgDateString\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgDateString(\n      table,\n      this.config\n    );\n  }\n}\nclass PgDateString extends PgColumn {\n  static [entityKind] = \"PgDateString\";\n  getSQLType() {\n    return \"date\";\n  }\n  mapFromDriverValue(value) {\n    if (typeof value === \"string\") return value;\n    return value.toISOString().slice(0, -14);\n  }\n}\nfunction date(a, b) {\n  const { name, config } = getColumnNameAndConfig(a, b);\n  if (config?.mode === \"date\") {\n    return new PgDateBuilder(name);\n  }\n  return new PgDateStringBuilder(name);\n}\nexport {\n  PgDate,\n  PgDateBuilder,\n  PgDateString,\n  PgDateStringBuilder,\n  date\n};\n//# sourceMappingURL=date.js.map","import { t as getIp } from \"./get-request-ip-D6st-mto.mjs\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport { betterFetch } from \"@better-fetch/fetch\";\n\n//#region src/utils/middleware-response.ts\nconst middlewareResponse = ({ message, status }) => ({ response: new Response(JSON.stringify({ message }), { status }) });\n\n//#endregion\n//#region src/plugins/captcha/constants.ts\nconst defaultEndpoints = [\n\t\"/sign-up/email\",\n\t\"/sign-in/email\",\n\t\"/request-password-reset\"\n];\nconst Providers = {\n\tCLOUDFLARE_TURNSTILE: \"cloudflare-turnstile\",\n\tGOOGLE_RECAPTCHA: \"google-recaptcha\",\n\tHCAPTCHA: \"hcaptcha\",\n\tCAPTCHAFOX: \"captchafox\"\n};\nconst siteVerifyMap = {\n\t[Providers.CLOUDFLARE_TURNSTILE]: \"https://challenges.cloudflare.com/turnstile/v0/siteverify\",\n\t[Providers.GOOGLE_RECAPTCHA]: \"https://www.google.com/recaptcha/api/siteverify\",\n\t[Providers.HCAPTCHA]: \"https://api.hcaptcha.com/siteverify\",\n\t[Providers.CAPTCHAFOX]: \"https://api.captchafox.com/siteverify\"\n};\n\n//#endregion\n//#region src/plugins/captcha/error-codes.ts\nconst EXTERNAL_ERROR_CODES = defineErrorCodes({\n\tVERIFICATION_FAILED: \"Captcha verification failed\",\n\tMISSING_RESPONSE: \"Missing CAPTCHA response\",\n\tUNKNOWN_ERROR: \"Something went wrong\"\n});\nconst INTERNAL_ERROR_CODES = defineErrorCodes({\n\tMISSING_SECRET_KEY: \"Missing secret key\",\n\tSERVICE_UNAVAILABLE: \"CAPTCHA service unavailable\"\n});\n\n//#endregion\n//#region src/plugins/captcha/utils.ts\nconst encodeToURLParams = (obj) => {\n\tif (typeof obj !== \"object\" || obj === null || Array.isArray(obj)) throw new Error(\"Input must be a non-null object.\");\n\tconst params = new URLSearchParams();\n\tfor (const [key, value] of Object.entries(obj)) if (value !== void 0 && value !== null) params.append(key, String(value));\n\treturn params.toString();\n};\n\n//#endregion\n//#region src/plugins/captcha/verify-handlers/captchafox.ts\nconst captchaFox = async ({ siteVerifyURL, captchaResponse, secretKey, siteKey, remoteIP }) => {\n\tconst response = await betterFetch(siteVerifyURL, {\n\t\tmethod: \"POST\",\n\t\theaders: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n\t\tbody: encodeToURLParams({\n\t\t\tsecret: secretKey,\n\t\t\tresponse: captchaResponse,\n\t\t\t...siteKey && { sitekey: siteKey },\n\t\t\t...remoteIP && { remoteIp: remoteIP }\n\t\t})\n\t});\n\tif (!response.data || response.error) throw new Error(INTERNAL_ERROR_CODES.SERVICE_UNAVAILABLE);\n\tif (!response.data.success) return middlewareResponse({\n\t\tmessage: EXTERNAL_ERROR_CODES.VERIFICATION_FAILED,\n\t\tstatus: 403\n\t});\n};\n\n//#endregion\n//#region src/plugins/captcha/verify-handlers/cloudflare-turnstile.ts\nconst cloudflareTurnstile = async ({ siteVerifyURL, captchaResponse, secretKey, remoteIP }) => {\n\tconst response = await betterFetch(siteVerifyURL, {\n\t\tmethod: \"POST\",\n\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\tbody: JSON.stringify({\n\t\t\tsecret: secretKey,\n\t\t\tresponse: captchaResponse,\n\t\t\t...remoteIP && { remoteip: remoteIP }\n\t\t})\n\t});\n\tif (!response.data || response.error) throw new Error(INTERNAL_ERROR_CODES.SERVICE_UNAVAILABLE);\n\tif (!response.data.success) return middlewareResponse({\n\t\tmessage: EXTERNAL_ERROR_CODES.VERIFICATION_FAILED,\n\t\tstatus: 403\n\t});\n};\n\n//#endregion\n//#region src/plugins/captcha/verify-handlers/google-recaptcha.ts\nconst isV3 = (response) => {\n\treturn \"score\" in response && typeof response.score === \"number\";\n};\nconst googleRecaptcha = async ({ siteVerifyURL, captchaResponse, secretKey, minScore = .5, remoteIP }) => {\n\tconst response = await betterFetch(siteVerifyURL, {\n\t\tmethod: \"POST\",\n\t\theaders: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n\t\tbody: encodeToURLParams({\n\t\t\tsecret: secretKey,\n\t\t\tresponse: captchaResponse,\n\t\t\t...remoteIP && { remoteip: remoteIP }\n\t\t})\n\t});\n\tif (!response.data || response.error) throw new Error(INTERNAL_ERROR_CODES.SERVICE_UNAVAILABLE);\n\tif (!response.data.success || isV3(response.data) && response.data.score < minScore) return middlewareResponse({\n\t\tmessage: EXTERNAL_ERROR_CODES.VERIFICATION_FAILED,\n\t\tstatus: 403\n\t});\n};\n\n//#endregion\n//#region src/plugins/captcha/verify-handlers/h-captcha.ts\nconst hCaptcha = async ({ siteVerifyURL, captchaResponse, secretKey, siteKey, remoteIP }) => {\n\tconst response = await betterFetch(siteVerifyURL, {\n\t\tmethod: \"POST\",\n\t\theaders: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n\t\tbody: encodeToURLParams({\n\t\t\tsecret: secretKey,\n\t\t\tresponse: captchaResponse,\n\t\t\t...siteKey && { sitekey: siteKey },\n\t\t\t...remoteIP && { remoteip: remoteIP }\n\t\t})\n\t});\n\tif (!response.data || response.error) throw new Error(INTERNAL_ERROR_CODES.SERVICE_UNAVAILABLE);\n\tif (!response.data.success) return middlewareResponse({\n\t\tmessage: EXTERNAL_ERROR_CODES.VERIFICATION_FAILED,\n\t\tstatus: 403\n\t});\n};\n\n//#endregion\n//#region src/plugins/captcha/index.ts\nconst captcha = (options) => ({\n\tid: \"captcha\",\n\tonRequest: async (request, ctx) => {\n\t\ttry {\n\t\t\tif (!(options.endpoints?.length ? options.endpoints : defaultEndpoints).some((endpoint) => request.url.includes(endpoint))) return void 0;\n\t\t\tif (!options.secretKey) throw new Error(INTERNAL_ERROR_CODES.MISSING_SECRET_KEY);\n\t\t\tconst captchaResponse = request.headers.get(\"x-captcha-response\");\n\t\t\tconst remoteUserIP = getIp(request, ctx.options) ?? void 0;\n\t\t\tif (!captchaResponse) return middlewareResponse({\n\t\t\t\tmessage: EXTERNAL_ERROR_CODES.MISSING_RESPONSE,\n\t\t\t\tstatus: 400\n\t\t\t});\n\t\t\tconst handlerParams = {\n\t\t\t\tsiteVerifyURL: options.siteVerifyURLOverride || siteVerifyMap[options.provider],\n\t\t\t\tcaptchaResponse,\n\t\t\t\tsecretKey: options.secretKey,\n\t\t\t\tremoteIP: remoteUserIP\n\t\t\t};\n\t\t\tif (options.provider === Providers.CLOUDFLARE_TURNSTILE) return await cloudflareTurnstile(handlerParams);\n\t\t\tif (options.provider === Providers.GOOGLE_RECAPTCHA) return await googleRecaptcha({\n\t\t\t\t...handlerParams,\n\t\t\t\tminScore: options.minScore\n\t\t\t});\n\t\t\tif (options.provider === Providers.HCAPTCHA) return await hCaptcha({\n\t\t\t\t...handlerParams,\n\t\t\t\tsiteKey: options.siteKey\n\t\t\t});\n\t\t\tif (options.provider === Providers.CAPTCHAFOX) return await captchaFox({\n\t\t\t\t...handlerParams,\n\t\t\t\tsiteKey: options.siteKey\n\t\t\t});\n\t\t} catch (_error) {\n\t\t\tconst errorMessage = _error instanceof Error ? _error.message : void 0;\n\t\t\tctx.logger.error(errorMessage ?? \"Unknown error\", {\n\t\t\t\tendpoint: request.url,\n\t\t\t\tmessage: _error\n\t\t\t});\n\t\t\treturn middlewareResponse({\n\t\t\t\tmessage: EXTERNAL_ERROR_CODES.UNKNOWN_ERROR,\n\t\t\t\tstatus: 500\n\t\t\t});\n\t\t}\n\t}\n});\n\n//#endregion\nexport { captcha as t };","import { base64, base64Url } from \"@better-auth/utils/base64\";\nimport { betterFetch } from \"@better-fetch/fetch\";\nimport { jwtVerify } from \"jose\";\n\n//#region src/oauth2/client-credentials-token.ts\nfunction createClientCredentialsTokenRequest({ options, scope, authentication, resource }) {\n\tconst body = new URLSearchParams();\n\tconst headers = {\n\t\t\"content-type\": \"application/x-www-form-urlencoded\",\n\t\taccept: \"application/json\"\n\t};\n\tbody.set(\"grant_type\", \"client_credentials\");\n\tscope && body.set(\"scope\", scope);\n\tif (resource) if (typeof resource === \"string\") body.append(\"resource\", resource);\n\telse for (const _resource of resource) body.append(\"resource\", _resource);\n\tif (authentication === \"basic\") {\n\t\tconst primaryClientId = Array.isArray(options.clientId) ? options.clientId[0] : options.clientId;\n\t\theaders[\"authorization\"] = `Basic ${base64Url.encode(`${primaryClientId}:${options.clientSecret}`)}`;\n\t} else {\n\t\tconst primaryClientId = Array.isArray(options.clientId) ? options.clientId[0] : options.clientId;\n\t\tbody.set(\"client_id\", primaryClientId);\n\t\tbody.set(\"client_secret\", options.clientSecret);\n\t}\n\treturn {\n\t\tbody,\n\t\theaders\n\t};\n}\nasync function clientCredentialsToken({ options, tokenEndpoint, scope, authentication, resource }) {\n\tconst { body, headers } = createClientCredentialsTokenRequest({\n\t\toptions,\n\t\tscope,\n\t\tauthentication,\n\t\tresource\n\t});\n\tconst { data, error } = await betterFetch(tokenEndpoint, {\n\t\tmethod: \"POST\",\n\t\tbody,\n\t\theaders\n\t});\n\tif (error) throw error;\n\tconst tokens = {\n\t\taccessToken: data.access_token,\n\t\ttokenType: data.token_type,\n\t\tscopes: data.scope?.split(\" \")\n\t};\n\tif (data.expires_in) {\n\t\tconst now = /* @__PURE__ */ new Date();\n\t\ttokens.accessTokenExpiresAt = new Date(now.getTime() + data.expires_in * 1e3);\n\t}\n\treturn tokens;\n}\n\n//#endregion\n//#region src/oauth2/utils.ts\nfunction getOAuth2Tokens(data) {\n\tconst getDate = (seconds) => {\n\t\tconst now = /* @__PURE__ */ new Date();\n\t\treturn new Date(now.getTime() + seconds * 1e3);\n\t};\n\treturn {\n\t\ttokenType: data.token_type,\n\t\taccessToken: data.access_token,\n\t\trefreshToken: data.refresh_token,\n\t\taccessTokenExpiresAt: data.expires_in ? getDate(data.expires_in) : void 0,\n\t\trefreshTokenExpiresAt: data.refresh_token_expires_in ? getDate(data.refresh_token_expires_in) : void 0,\n\t\tscopes: data?.scope ? typeof data.scope === \"string\" ? data.scope.split(\" \") : data.scope : [],\n\t\tidToken: data.id_token,\n\t\traw: data\n\t};\n}\nasync function generateCodeChallenge(codeVerifier) {\n\tconst data = new TextEncoder().encode(codeVerifier);\n\tconst hash = await crypto.subtle.digest(\"SHA-256\", data);\n\treturn base64Url.encode(new Uint8Array(hash), { padding: false });\n}\n\n//#endregion\n//#region src/oauth2/create-authorization-url.ts\nasync function createAuthorizationURL({ id, options, authorizationEndpoint, state, codeVerifier, scopes, claims, redirectURI, duration, prompt, accessType, responseType, display, loginHint, hd, responseMode, additionalParams, scopeJoiner }) {\n\tconst url = new URL(authorizationEndpoint);\n\turl.searchParams.set(\"response_type\", responseType || \"code\");\n\tconst primaryClientId = Array.isArray(options.clientId) ? options.clientId[0] : options.clientId;\n\turl.searchParams.set(\"client_id\", primaryClientId);\n\turl.searchParams.set(\"state\", state);\n\tif (scopes) url.searchParams.set(\"scope\", scopes.join(scopeJoiner || \" \"));\n\turl.searchParams.set(\"redirect_uri\", options.redirectURI || redirectURI);\n\tduration && url.searchParams.set(\"duration\", duration);\n\tdisplay && url.searchParams.set(\"display\", display);\n\tloginHint && url.searchParams.set(\"login_hint\", loginHint);\n\tprompt && url.searchParams.set(\"prompt\", prompt);\n\thd && url.searchParams.set(\"hd\", hd);\n\taccessType && url.searchParams.set(\"access_type\", accessType);\n\tresponseMode && url.searchParams.set(\"response_mode\", responseMode);\n\tif (codeVerifier) {\n\t\tconst codeChallenge = await generateCodeChallenge(codeVerifier);\n\t\turl.searchParams.set(\"code_challenge_method\", \"S256\");\n\t\turl.searchParams.set(\"code_challenge\", codeChallenge);\n\t}\n\tif (claims) {\n\t\tconst claimsObj = claims.reduce((acc, claim) => {\n\t\t\tacc[claim] = null;\n\t\t\treturn acc;\n\t\t}, {});\n\t\turl.searchParams.set(\"claims\", JSON.stringify({ id_token: {\n\t\t\temail: null,\n\t\t\temail_verified: null,\n\t\t\t...claimsObj\n\t\t} }));\n\t}\n\tif (additionalParams) Object.entries(additionalParams).forEach(([key, value]) => {\n\t\turl.searchParams.set(key, value);\n\t});\n\treturn url;\n}\n\n//#endregion\n//#region src/oauth2/refresh-access-token.ts\nfunction createRefreshAccessTokenRequest({ refreshToken, options, authentication, extraParams, resource }) {\n\tconst body = new URLSearchParams();\n\tconst headers = {\n\t\t\"content-type\": \"application/x-www-form-urlencoded\",\n\t\taccept: \"application/json\"\n\t};\n\tbody.set(\"grant_type\", \"refresh_token\");\n\tbody.set(\"refresh_token\", refreshToken);\n\tif (authentication === \"basic\") {\n\t\tconst primaryClientId = Array.isArray(options.clientId) ? options.clientId[0] : options.clientId;\n\t\tif (primaryClientId) headers[\"authorization\"] = \"Basic \" + base64.encode(`${primaryClientId}:${options.clientSecret ?? \"\"}`);\n\t\telse headers[\"authorization\"] = \"Basic \" + base64.encode(`:${options.clientSecret ?? \"\"}`);\n\t} else {\n\t\tconst primaryClientId = Array.isArray(options.clientId) ? options.clientId[0] : options.clientId;\n\t\tbody.set(\"client_id\", primaryClientId);\n\t\tif (options.clientSecret) body.set(\"client_secret\", options.clientSecret);\n\t}\n\tif (resource) if (typeof resource === \"string\") body.append(\"resource\", resource);\n\telse for (const _resource of resource) body.append(\"resource\", _resource);\n\tif (extraParams) for (const [key, value] of Object.entries(extraParams)) body.set(key, value);\n\treturn {\n\t\tbody,\n\t\theaders\n\t};\n}\nasync function refreshAccessToken({ refreshToken, options, tokenEndpoint, authentication, extraParams }) {\n\tconst { body, headers } = createRefreshAccessTokenRequest({\n\t\trefreshToken,\n\t\toptions,\n\t\tauthentication,\n\t\textraParams\n\t});\n\tconst { data, error } = await betterFetch(tokenEndpoint, {\n\t\tmethod: \"POST\",\n\t\tbody,\n\t\theaders\n\t});\n\tif (error) throw error;\n\tconst tokens = {\n\t\taccessToken: data.access_token,\n\t\trefreshToken: data.refresh_token,\n\t\ttokenType: data.token_type,\n\t\tscopes: data.scope?.split(\" \"),\n\t\tidToken: data.id_token\n\t};\n\tif (data.expires_in) {\n\t\tconst now = /* @__PURE__ */ new Date();\n\t\ttokens.accessTokenExpiresAt = new Date(now.getTime() + data.expires_in * 1e3);\n\t}\n\treturn tokens;\n}\n\n//#endregion\n//#region src/oauth2/validate-authorization-code.ts\nfunction createAuthorizationCodeRequest({ code, codeVerifier, redirectURI, options, authentication, deviceId, headers, additionalParams = {}, resource }) {\n\tconst body = new URLSearchParams();\n\tconst requestHeaders = {\n\t\t\"content-type\": \"application/x-www-form-urlencoded\",\n\t\taccept: \"application/json\",\n\t\t...headers\n\t};\n\tbody.set(\"grant_type\", \"authorization_code\");\n\tbody.set(\"code\", code);\n\tcodeVerifier && body.set(\"code_verifier\", codeVerifier);\n\toptions.clientKey && body.set(\"client_key\", options.clientKey);\n\tdeviceId && body.set(\"device_id\", deviceId);\n\tbody.set(\"redirect_uri\", options.redirectURI || redirectURI);\n\tif (resource) if (typeof resource === \"string\") body.append(\"resource\", resource);\n\telse for (const _resource of resource) body.append(\"resource\", _resource);\n\tif (authentication === \"basic\") {\n\t\tconst primaryClientId = Array.isArray(options.clientId) ? options.clientId[0] : options.clientId;\n\t\trequestHeaders[\"authorization\"] = `Basic ${base64.encode(`${primaryClientId}:${options.clientSecret ?? \"\"}`)}`;\n\t} else {\n\t\tconst primaryClientId = Array.isArray(options.clientId) ? options.clientId[0] : options.clientId;\n\t\tbody.set(\"client_id\", primaryClientId);\n\t\tif (options.clientSecret) body.set(\"client_secret\", options.clientSecret);\n\t}\n\tfor (const [key, value] of Object.entries(additionalParams)) if (!body.has(key)) body.append(key, value);\n\treturn {\n\t\tbody,\n\t\theaders: requestHeaders\n\t};\n}\nasync function validateAuthorizationCode({ code, codeVerifier, redirectURI, options, tokenEndpoint, authentication, deviceId, headers, additionalParams = {}, resource }) {\n\tconst { body, headers: requestHeaders } = createAuthorizationCodeRequest({\n\t\tcode,\n\t\tcodeVerifier,\n\t\tredirectURI,\n\t\toptions,\n\t\tauthentication,\n\t\tdeviceId,\n\t\theaders,\n\t\tadditionalParams,\n\t\tresource\n\t});\n\tconst { data, error } = await betterFetch(tokenEndpoint, {\n\t\tmethod: \"POST\",\n\t\tbody,\n\t\theaders: requestHeaders\n\t});\n\tif (error) throw error;\n\treturn getOAuth2Tokens(data);\n}\nasync function validateToken(token, jwksEndpoint) {\n\tconst { data, error } = await betterFetch(jwksEndpoint, {\n\t\tmethod: \"GET\",\n\t\theaders: { accept: \"application/json\" }\n\t});\n\tif (error) throw error;\n\tconst keys = data[\"keys\"];\n\tconst header = JSON.parse(atob(token.split(\".\")[0]));\n\tconst key = keys.find((key$1) => key$1.kid === header.kid);\n\tif (!key) throw new Error(\"Key not found\");\n\treturn await jwtVerify(token, key);\n}\n\n//#endregion\nexport { refreshAccessToken as a, getOAuth2Tokens as c, createRefreshAccessTokenRequest as i, clientCredentialsToken as l, validateAuthorizationCode as n, createAuthorizationURL as o, validateToken as r, generateCodeChallenge as s, createAuthorizationCodeRequest as t, createClientCredentialsTokenRequest as u };","import { entityKind } from \"../../../entity.js\";\nimport { getColumnNameAndConfig } from \"../../../utils.js\";\nimport { PgColumn, PgColumnBuilder } from \"../common.js\";\nimport { parseEWKB } from \"./utils.js\";\nclass PgGeometryBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgGeometryBuilder\";\n  constructor(name) {\n    super(name, \"array\", \"PgGeometry\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgGeometry(\n      table,\n      this.config\n    );\n  }\n}\nclass PgGeometry extends PgColumn {\n  static [entityKind] = \"PgGeometry\";\n  getSQLType() {\n    return \"geometry(point)\";\n  }\n  mapFromDriverValue(value) {\n    return parseEWKB(value);\n  }\n  mapToDriverValue(value) {\n    return `point(${value[0]} ${value[1]})`;\n  }\n}\nclass PgGeometryObjectBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgGeometryObjectBuilder\";\n  constructor(name) {\n    super(name, \"json\", \"PgGeometryObject\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgGeometryObject(\n      table,\n      this.config\n    );\n  }\n}\nclass PgGeometryObject extends PgColumn {\n  static [entityKind] = \"PgGeometryObject\";\n  getSQLType() {\n    return \"geometry(point)\";\n  }\n  mapFromDriverValue(value) {\n    const parsed = parseEWKB(value);\n    return { x: parsed[0], y: parsed[1] };\n  }\n  mapToDriverValue(value) {\n    return `point(${value.x} ${value.y})`;\n  }\n}\nfunction geometry(a, b) {\n  const { name, config } = getColumnNameAndConfig(a, b);\n  if (!config?.mode || config.mode === \"tuple\") {\n    return new PgGeometryBuilder(name);\n  }\n  return new PgGeometryObjectBuilder(name);\n}\nexport {\n  PgGeometry,\n  PgGeometryBuilder,\n  PgGeometryObject,\n  PgGeometryObjectBuilder,\n  geometry\n};\n//# sourceMappingURL=geometry.js.map","import { entityKind } from \"../../entity.js\";\nimport { getColumnNameAndConfig } from \"../../utils.js\";\nimport { PgColumn } from \"./common.js\";\nimport { PgDateColumnBaseBuilder } from \"./date.common.js\";\nclass PgTimeBuilder extends PgDateColumnBaseBuilder {\n  constructor(name, withTimezone, precision) {\n    super(name, \"string\", \"PgTime\");\n    this.withTimezone = withTimezone;\n    this.precision = precision;\n    this.config.withTimezone = withTimezone;\n    this.config.precision = precision;\n  }\n  static [entityKind] = \"PgTimeBuilder\";\n  /** @internal */\n  build(table) {\n    return new PgTime(table, this.config);\n  }\n}\nclass PgTime extends PgColumn {\n  static [entityKind] = \"PgTime\";\n  withTimezone;\n  precision;\n  constructor(table, config) {\n    super(table, config);\n    this.withTimezone = config.withTimezone;\n    this.precision = config.precision;\n  }\n  getSQLType() {\n    const precision = this.precision === void 0 ? \"\" : `(${this.precision})`;\n    return `time${precision}${this.withTimezone ? \" with time zone\" : \"\"}`;\n  }\n}\nfunction time(a, b = {}) {\n  const { name, config } = getColumnNameAndConfig(a, b);\n  return new PgTimeBuilder(name, config.withTimezone ?? false, config.precision);\n}\nexport {\n  PgTime,\n  PgTimeBuilder,\n  time\n};\n//# sourceMappingURL=time.js.map","import { detectDomainLocale } from '../../shared/lib/i18n/detect-domain-locale';\nimport { formatNextPathnameInfo } from '../../shared/lib/router/utils/format-next-pathname-info';\nimport { getHostname } from '../../shared/lib/get-hostname';\nimport { getNextPathnameInfo } from '../../shared/lib/router/utils/get-next-pathname-info';\nconst REGEX_LOCALHOST_HOSTNAME = /(?!^https?:\\/\\/)(127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}|\\[::1\\]|localhost)/;\nfunction parseURL(url, base) {\n    return new URL(String(url).replace(REGEX_LOCALHOST_HOSTNAME, 'localhost'), base && String(base).replace(REGEX_LOCALHOST_HOSTNAME, 'localhost'));\n}\nconst Internal = Symbol('NextURLInternal');\nexport class NextURL {\n    constructor(input, baseOrOpts, opts){\n        let base;\n        let options;\n        if (typeof baseOrOpts === 'object' && 'pathname' in baseOrOpts || typeof baseOrOpts === 'string') {\n            base = baseOrOpts;\n            options = opts || {};\n        } else {\n            options = opts || baseOrOpts || {};\n        }\n        this[Internal] = {\n            url: parseURL(input, base ?? options.base),\n            options: options,\n            basePath: ''\n        };\n        this.analyze();\n    }\n    analyze() {\n        var _this_Internal_options_nextConfig_i18n, _this_Internal_options_nextConfig, _this_Internal_domainLocale, _this_Internal_options_nextConfig_i18n1, _this_Internal_options_nextConfig1;\n        const info = getNextPathnameInfo(this[Internal].url.pathname, {\n            nextConfig: this[Internal].options.nextConfig,\n            parseData: !process.env.__NEXT_NO_MIDDLEWARE_URL_NORMALIZE,\n            i18nProvider: this[Internal].options.i18nProvider\n        });\n        const hostname = getHostname(this[Internal].url, this[Internal].options.headers);\n        this[Internal].domainLocale = this[Internal].options.i18nProvider ? this[Internal].options.i18nProvider.detectDomainLocale(hostname) : detectDomainLocale((_this_Internal_options_nextConfig = this[Internal].options.nextConfig) == null ? void 0 : (_this_Internal_options_nextConfig_i18n = _this_Internal_options_nextConfig.i18n) == null ? void 0 : _this_Internal_options_nextConfig_i18n.domains, hostname);\n        const defaultLocale = ((_this_Internal_domainLocale = this[Internal].domainLocale) == null ? void 0 : _this_Internal_domainLocale.defaultLocale) || ((_this_Internal_options_nextConfig1 = this[Internal].options.nextConfig) == null ? void 0 : (_this_Internal_options_nextConfig_i18n1 = _this_Internal_options_nextConfig1.i18n) == null ? void 0 : _this_Internal_options_nextConfig_i18n1.defaultLocale);\n        this[Internal].url.pathname = info.pathname;\n        this[Internal].defaultLocale = defaultLocale;\n        this[Internal].basePath = info.basePath ?? '';\n        this[Internal].buildId = info.buildId;\n        this[Internal].locale = info.locale ?? defaultLocale;\n        this[Internal].trailingSlash = info.trailingSlash;\n    }\n    formatPathname() {\n        return formatNextPathnameInfo({\n            basePath: this[Internal].basePath,\n            buildId: this[Internal].buildId,\n            defaultLocale: !this[Internal].options.forceLocale ? this[Internal].defaultLocale : undefined,\n            locale: this[Internal].locale,\n            pathname: this[Internal].url.pathname,\n            trailingSlash: this[Internal].trailingSlash\n        });\n    }\n    formatSearch() {\n        return this[Internal].url.search;\n    }\n    get buildId() {\n        return this[Internal].buildId;\n    }\n    set buildId(buildId) {\n        this[Internal].buildId = buildId;\n    }\n    get locale() {\n        return this[Internal].locale ?? '';\n    }\n    set locale(locale) {\n        var _this_Internal_options_nextConfig_i18n, _this_Internal_options_nextConfig;\n        if (!this[Internal].locale || !((_this_Internal_options_nextConfig = this[Internal].options.nextConfig) == null ? void 0 : (_this_Internal_options_nextConfig_i18n = _this_Internal_options_nextConfig.i18n) == null ? void 0 : _this_Internal_options_nextConfig_i18n.locales.includes(locale))) {\n            throw Object.defineProperty(new TypeError(`The NextURL configuration includes no locale \"${locale}\"`), \"__NEXT_ERROR_CODE\", {\n                value: \"E597\",\n                enumerable: false,\n                configurable: true\n            });\n        }\n        this[Internal].locale = locale;\n    }\n    get defaultLocale() {\n        return this[Internal].defaultLocale;\n    }\n    get domainLocale() {\n        return this[Internal].domainLocale;\n    }\n    get searchParams() {\n        return this[Internal].url.searchParams;\n    }\n    get host() {\n        return this[Internal].url.host;\n    }\n    set host(value) {\n        this[Internal].url.host = value;\n    }\n    get hostname() {\n        return this[Internal].url.hostname;\n    }\n    set hostname(value) {\n        this[Internal].url.hostname = value;\n    }\n    get port() {\n        return this[Internal].url.port;\n    }\n    set port(value) {\n        this[Internal].url.port = value;\n    }\n    get protocol() {\n        return this[Internal].url.protocol;\n    }\n    set protocol(value) {\n        this[Internal].url.protocol = value;\n    }\n    get href() {\n        const pathname = this.formatPathname();\n        const search = this.formatSearch();\n        return `${this.protocol}//${this.host}${pathname}${search}${this.hash}`;\n    }\n    set href(url) {\n        this[Internal].url = parseURL(url);\n        this.analyze();\n    }\n    get origin() {\n        return this[Internal].url.origin;\n    }\n    get pathname() {\n        return this[Internal].url.pathname;\n    }\n    set pathname(value) {\n        this[Internal].url.pathname = value;\n    }\n    get hash() {\n        return this[Internal].url.hash;\n    }\n    set hash(value) {\n        this[Internal].url.hash = value;\n    }\n    get search() {\n        return this[Internal].url.search;\n    }\n    set search(value) {\n        this[Internal].url.search = value;\n    }\n    get password() {\n        return this[Internal].url.password;\n    }\n    set password(value) {\n        this[Internal].url.password = value;\n    }\n    get username() {\n        return this[Internal].url.username;\n    }\n    set username(value) {\n        this[Internal].url.username = value;\n    }\n    get basePath() {\n        return this[Internal].basePath;\n    }\n    set basePath(value) {\n        this[Internal].basePath = value.startsWith('/') ? value : `/${value}`;\n    }\n    toString() {\n        return this.href;\n    }\n    toJSON() {\n        return this.href;\n    }\n    [Symbol.for('edge-runtime.inspect.custom')]() {\n        return {\n            href: this.href,\n            origin: this.origin,\n            protocol: this.protocol,\n            username: this.username,\n            password: this.password,\n            host: this.host,\n            hostname: this.hostname,\n            port: this.port,\n            pathname: this.pathname,\n            search: this.search,\n            searchParams: this.searchParams,\n            hash: this.hash\n        };\n    }\n    clone() {\n        return new NextURL(String(this), this[Internal].options);\n    }\n}\n\n//# sourceMappingURL=next-url.js.map","import { entityKind } from \"../../entity.js\";\nimport { getColumnNameAndConfig } from \"../../utils.js\";\nimport { PgColumn } from \"./common.js\";\nimport { PgIntColumnBaseBuilder } from \"./int.common.js\";\nclass PgBigInt53Builder extends PgIntColumnBaseBuilder {\n  static [entityKind] = \"PgBigInt53Builder\";\n  constructor(name) {\n    super(name, \"number\", \"PgBigInt53\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgBigInt53(table, this.config);\n  }\n}\nclass PgBigInt53 extends PgColumn {\n  static [entityKind] = \"PgBigInt53\";\n  getSQLType() {\n    return \"bigint\";\n  }\n  mapFromDriverValue(value) {\n    if (typeof value === \"number\") {\n      return value;\n    }\n    return Number(value);\n  }\n}\nclass PgBigInt64Builder extends PgIntColumnBaseBuilder {\n  static [entityKind] = \"PgBigInt64Builder\";\n  constructor(name) {\n    super(name, \"bigint\", \"PgBigInt64\");\n  }\n  /** @internal */\n  build(table) {\n    return new PgBigInt64(\n      table,\n      this.config\n    );\n  }\n}\nclass PgBigInt64 extends PgColumn {\n  static [entityKind] = \"PgBigInt64\";\n  getSQLType() {\n    return \"bigint\";\n  }\n  // eslint-disable-next-line unicorn/prefer-native-coercion-functions\n  mapFromDriverValue(value) {\n    return BigInt(value);\n  }\n}\nfunction bigint(a, b) {\n  const { name, config } = getColumnNameAndConfig(a, b);\n  if (config.mode === \"number\") {\n    return new PgBigInt53Builder(name);\n  }\n  return new PgBigInt64Builder(name);\n}\nexport {\n  PgBigInt53,\n  PgBigInt53Builder,\n  PgBigInt64,\n  PgBigInt64Builder,\n  bigint\n};\n//# sourceMappingURL=bigint.js.map","import { entityKind } from \"../../entity.js\";\nimport { getColumnNameAndConfig } from \"../../utils.js\";\nimport { PgColumn } from \"./common.js\";\nimport { PgDateColumnBaseBuilder } from \"./date.common.js\";\nclass PgTimestampBuilder extends PgDateColumnBaseBuilder {\n  static [entityKind] = \"PgTimestampBuilder\";\n  constructor(name, withTimezone, precision) {\n    super(name, \"date\", \"PgTimestamp\");\n    this.config.withTimezone = withTimezone;\n    this.config.precision = precision;\n  }\n  /** @internal */\n  build(table) {\n    return new PgTimestamp(table, this.config);\n  }\n}\nclass PgTimestamp extends PgColumn {\n  static [entityKind] = \"PgTimestamp\";\n  withTimezone;\n  precision;\n  constructor(table, config) {\n    super(table, config);\n    this.withTimezone = config.withTimezone;\n    this.precision = config.precision;\n  }\n  getSQLType() {\n    const precision = this.precision === void 0 ? \"\" : ` (${this.precision})`;\n    return `timestamp${precision}${this.withTimezone ? \" with time zone\" : \"\"}`;\n  }\n  mapFromDriverValue(value) {\n    if (typeof value === \"string\") return new Date(this.withTimezone ? value : value + \"+0000\");\n    return value;\n  }\n  mapToDriverValue = (value) => {\n    return value.toISOString();\n  };\n}\nclass PgTimestampStringBuilder extends PgDateColumnBaseBuilder {\n  static [entityKind] = \"PgTimestampStringBuilder\";\n  constructor(name, withTimezone, precision) {\n    super(name, \"string\", \"PgTimestampString\");\n    this.config.withTimezone = withTimezone;\n    this.config.precision = precision;\n  }\n  /** @internal */\n  build(table) {\n    return new PgTimestampString(\n      table,\n      this.config\n    );\n  }\n}\nclass PgTimestampString extends PgColumn {\n  static [entityKind] = \"PgTimestampString\";\n  withTimezone;\n  precision;\n  constructor(table, config) {\n    super(table, config);\n    this.withTimezone = config.withTimezone;\n    this.precision = config.precision;\n  }\n  getSQLType() {\n    const precision = this.precision === void 0 ? \"\" : `(${this.precision})`;\n    return `timestamp${precision}${this.withTimezone ? \" with time zone\" : \"\"}`;\n  }\n  mapFromDriverValue(value) {\n    if (typeof value === \"string\") return value;\n    const shortened = value.toISOString().slice(0, -1).replace(\"T\", \" \");\n    if (this.withTimezone) {\n      const offset = value.getTimezoneOffset();\n      const sign = offset <= 0 ? \"+\" : \"-\";\n      return `${shortened}${sign}${Math.floor(Math.abs(offset) / 60).toString().padStart(2, \"0\")}`;\n    }\n    return shortened;\n  }\n}\nfunction timestamp(a, b = {}) {\n  const { name, config } = getColumnNameAndConfig(a, b);\n  if (config?.mode === \"string\") {\n    return new PgTimestampStringBuilder(name, config.withTimezone ?? false, config.precision);\n  }\n  return new PgTimestampBuilder(name, config?.withTimezone ?? false, config?.precision);\n}\nexport {\n  PgTimestamp,\n  PgTimestampBuilder,\n  PgTimestampString,\n  PgTimestampStringBuilder,\n  timestamp\n};\n//# sourceMappingURL=timestamp.js.map","import { pgTable, uuid, varchar, timestamp, jsonb } from 'drizzle-orm/pg-core';\nimport { schools } from './schools';\nimport { users } from './users';\n\nexport const auditLogs = pgTable('audit_logs', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  schoolId: uuid('school_id').references(() => schools.id),\n  userId: uuid('user_id').references(() => users.id),\n\n  action: varchar('action', { length: 20 }).notNull(),\n\n  entityType: varchar('entity_type', { length: 50 }).notNull(),\n  entityId: uuid('entity_id').notNull(),\n\n  oldValues: jsonb('old_values'),\n  newValues: jsonb('new_values'),\n\n  ipAddress: varchar('ip_address', { length: 45 }),\n  userAgent: varchar('user_agent', { length: 500 }),\n\n  createdAt: timestamp('created_at').defaultNow(),\n});\n","import { CachedRouteKind, IncrementalCacheKind } from './types';\nimport RenderResult from '../render-result';\nimport { RouteKind } from '../route-kind';\nimport { HTML_CONTENT_TYPE_HEADER } from '../../lib/constants';\nexport async function fromResponseCacheEntry(cacheEntry) {\n    var _cacheEntry_value, _cacheEntry_value1;\n    return {\n        ...cacheEntry,\n        value: ((_cacheEntry_value = cacheEntry.value) == null ? void 0 : _cacheEntry_value.kind) === CachedRouteKind.PAGES ? {\n            kind: CachedRouteKind.PAGES,\n            html: await cacheEntry.value.html.toUnchunkedString(true),\n            pageData: cacheEntry.value.pageData,\n            headers: cacheEntry.value.headers,\n            status: cacheEntry.value.status\n        } : ((_cacheEntry_value1 = cacheEntry.value) == null ? void 0 : _cacheEntry_value1.kind) === CachedRouteKind.APP_PAGE ? {\n            kind: CachedRouteKind.APP_PAGE,\n            html: await cacheEntry.value.html.toUnchunkedString(true),\n            postponed: cacheEntry.value.postponed,\n            rscData: cacheEntry.value.rscData,\n            headers: cacheEntry.value.headers,\n            status: cacheEntry.value.status,\n            segmentData: cacheEntry.value.segmentData\n        } : cacheEntry.value\n    };\n}\nexport async function toResponseCacheEntry(response) {\n    var _response_value, _response_value1;\n    if (!response) return null;\n    return {\n        isMiss: response.isMiss,\n        isStale: response.isStale,\n        cacheControl: response.cacheControl,\n        value: ((_response_value = response.value) == null ? void 0 : _response_value.kind) === CachedRouteKind.PAGES ? {\n            kind: CachedRouteKind.PAGES,\n            html: RenderResult.fromStatic(response.value.html, HTML_CONTENT_TYPE_HEADER),\n            pageData: response.value.pageData,\n            headers: response.value.headers,\n            status: response.value.status\n        } : ((_response_value1 = response.value) == null ? void 0 : _response_value1.kind) === CachedRouteKind.APP_PAGE ? {\n            kind: CachedRouteKind.APP_PAGE,\n            html: RenderResult.fromStatic(response.value.html, HTML_CONTENT_TYPE_HEADER),\n            rscData: response.value.rscData,\n            headers: response.value.headers,\n            status: response.value.status,\n            postponed: response.value.postponed,\n            segmentData: response.value.segmentData\n        } : response.value\n    };\n}\nexport function routeKindToIncrementalCacheKind(routeKind) {\n    switch(routeKind){\n        case RouteKind.PAGES:\n            return IncrementalCacheKind.PAGES;\n        case RouteKind.APP_PAGE:\n            return IncrementalCacheKind.APP_PAGE;\n        case RouteKind.IMAGE:\n            return IncrementalCacheKind.IMAGE;\n        case RouteKind.APP_ROUTE:\n            return IncrementalCacheKind.APP_ROUTE;\n        case RouteKind.PAGES_API:\n            // Pages Router API routes are not cached in the incremental cache.\n            throw Object.defineProperty(new Error(`Unexpected route kind ${routeKind}`), \"__NEXT_ERROR_CODE\", {\n                value: \"E64\",\n                enumerable: false,\n                configurable: true\n            });\n        default:\n            return routeKind;\n    }\n}\n\n//# sourceMappingURL=utils.js.map","import { NextURL } from '../next-url';\nimport { toNodeOutgoingHttpHeaders, validateURL } from '../utils';\nimport { RemovedUAError, RemovedPageError } from '../error';\nimport { RequestCookies } from './cookies';\nexport const INTERNALS = Symbol('internal request');\n/**\n * This class extends the [Web `Request` API](https://developer.mozilla.org/docs/Web/API/Request) with additional convenience methods.\n *\n * Read more: [Next.js Docs: `NextRequest`](https://nextjs.org/docs/app/api-reference/functions/next-request)\n */ export class NextRequest extends Request {\n    constructor(input, init = {}){\n        const url = typeof input !== 'string' && 'url' in input ? input.url : String(input);\n        validateURL(url);\n        // node Request instance requires duplex option when a body\n        // is present or it errors, we don't handle this for\n        // Request being passed in since it would have already\n        // errored if this wasn't configured\n        if (process.env.NEXT_RUNTIME !== 'edge') {\n            if (init.body && init.duplex !== 'half') {\n                init.duplex = 'half';\n            }\n        }\n        if (input instanceof Request) super(input, init);\n        else super(url, init);\n        const nextUrl = new NextURL(url, {\n            headers: toNodeOutgoingHttpHeaders(this.headers),\n            nextConfig: init.nextConfig\n        });\n        this[INTERNALS] = {\n            cookies: new RequestCookies(this.headers),\n            nextUrl,\n            url: process.env.__NEXT_NO_MIDDLEWARE_URL_NORMALIZE ? url : nextUrl.toString()\n        };\n    }\n    [Symbol.for('edge-runtime.inspect.custom')]() {\n        return {\n            cookies: this.cookies,\n            nextUrl: this.nextUrl,\n            url: this.url,\n            // rest of props come from Request\n            bodyUsed: this.bodyUsed,\n            cache: this.cache,\n            credentials: this.credentials,\n            destination: this.destination,\n            headers: Object.fromEntries(this.headers),\n            integrity: this.integrity,\n            keepalive: this.keepalive,\n            method: this.method,\n            mode: this.mode,\n            redirect: this.redirect,\n            referrer: this.referrer,\n            referrerPolicy: this.referrerPolicy,\n            signal: this.signal\n        };\n    }\n    get cookies() {\n        return this[INTERNALS].cookies;\n    }\n    get nextUrl() {\n        return this[INTERNALS].nextUrl;\n    }\n    /**\n   * @deprecated\n   * `page` has been deprecated in favour of `URLPattern`.\n   * Read more: https://nextjs.org/docs/messages/middleware-request-page\n   */ get page() {\n        throw new RemovedPageError();\n    }\n    /**\n   * @deprecated\n   * `ua` has been removed in favour of \\`userAgent\\` function.\n   * Read more: https://nextjs.org/docs/messages/middleware-parse-user-agent\n   */ get ua() {\n        throw new RemovedUAError();\n    }\n    get url() {\n        return this[INTERNALS].url;\n    }\n}\n\n//# sourceMappingURL=request.js.map","import { pgTable, uuid, varchar, timestamp } from 'drizzle-orm/pg-core';\nimport { users } from './users';\nimport { schools } from './schools';\n\nexport const students = pgTable('students', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  userId: uuid('user_id').notNull().references(() => users.id),\n  schoolId: uuid('school_id').notNull().references(() => schools.id),\n\n  classYear: varchar('class_year', { length: 20 }),\n  schoolYear: varchar('school_year', { length: 10 }),\n\n  primaryTeacherId: uuid('primary_teacher_id').references(() => users.id),\n\n  createdAt: timestamp('created_at').defaultNow(),\n  updatedAt: timestamp('updated_at').defaultNow(),\n});\n\nexport const studentTeachers = pgTable('student_teachers', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  studentId: uuid('student_id').notNull().references(() => students.id),\n  teacherId: uuid('teacher_id').notNull().references(() => users.id),\n  role: varchar('role', { length: 50 }),\n  assignedAt: timestamp('assigned_at').defaultNow(),\n});\n","import { pgTable, uuid, varchar, timestamp, boolean, integer, decimal, text } from 'drizzle-orm/pg-core';\nimport { schools } from './schools';\nimport { users } from './users';\n\nexport const companies = pgTable('companies', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  schoolId: uuid('school_id').notNull().references(() => schools.id),\n\n  name: varchar('name', { length: 255 }).notNull(),\n  industry: varchar('industry', { length: 100 }),\n\n  street: varchar('street', { length: 255 }),\n  zip: varchar('zip', { length: 10 }),\n  city: varchar('city', { length: 100 }),\n\n  latitude: decimal('latitude', { precision: 10, scale: 7 }),\n  longitude: decimal('longitude', { precision: 10, scale: 7 }),\n\n  phone: varchar('phone', { length: 50 }),\n  email: varchar('email', { length: 255 }),\n  website: varchar('website', { length: 255 }),\n\n  inPool: boolean('in_pool').default(false),\n  poolOptInAt: timestamp('pool_opt_in_at'),\n\n  totalInternships: integer('total_internships').default(0),\n\n  createdAt: timestamp('created_at').defaultNow(),\n  updatedAt: timestamp('updated_at').defaultNow(),\n});\n\nexport const companyContacts = pgTable('company_contacts', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  companyId: uuid('company_id').notNull().references(() => companies.id),\n  userId: uuid('user_id').references(() => users.id),\n\n  firstName: varchar('first_name', { length: 100 }).notNull(),\n  lastName: varchar('last_name', { length: 100 }).notNull(),\n  position: varchar('position', { length: 100 }),\n  phone: varchar('phone', { length: 50 }),\n  email: varchar('email', { length: 255 }),\n\n  isPrimary: boolean('is_primary').default(false),\n\n  createdAt: timestamp('created_at').defaultNow(),\n});\n\nexport const companyReviews = pgTable('company_reviews', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  companyId: uuid('company_id').notNull().references(() => companies.id),\n  internshipId: uuid('internship_id').notNull(),\n\n  wouldRecommend: boolean('would_recommend'),\n  supervisionRating: integer('supervision_rating'),\n  learningRating: integer('learning_rating'),\n  atmosphereRating: integer('atmosphere_rating'),\n  comment: text('comment'),\n\n  createdAt: timestamp('created_at').defaultNow(),\n});\n","import { getRequestMeta } from '../../../request-meta';\nimport { fromNodeOutgoingHttpHeaders } from '../../utils';\nimport { NextRequest } from '../request';\nimport { isNodeNextRequest, isWebNextRequest } from '../../../base-http/helpers';\nexport const ResponseAbortedName = 'ResponseAborted';\nexport class ResponseAborted extends Error {\n    constructor(...args){\n        super(...args), this.name = ResponseAbortedName;\n    }\n}\n/**\n * Creates an AbortController tied to the closing of a ServerResponse (or other\n * appropriate Writable).\n *\n * If the `close` event is fired before the `finish` event, then we'll send the\n * `abort` signal.\n */ export function createAbortController(response) {\n    const controller = new AbortController();\n    // If `finish` fires first, then `res.end()` has been called and the close is\n    // just us finishing the stream on our side. If `close` fires first, then we\n    // know the client disconnected before we finished.\n    response.once('close', ()=>{\n        if (response.writableFinished) return;\n        controller.abort(new ResponseAborted());\n    });\n    return controller;\n}\n/**\n * Creates an AbortSignal tied to the closing of a ServerResponse (or other\n * appropriate Writable).\n *\n * This cannot be done with the request (IncomingMessage or Readable) because\n * the `abort` event will not fire if to data has been fully read (because that\n * will \"close\" the readable stream and nothing fires after that).\n */ export function signalFromNodeResponse(response) {\n    const { errored, destroyed } = response;\n    if (errored || destroyed) {\n        return AbortSignal.abort(errored ?? new ResponseAborted());\n    }\n    const { signal } = createAbortController(response);\n    return signal;\n}\nexport class NextRequestAdapter {\n    static fromBaseNextRequest(request, signal) {\n        if (// The type check here ensures that `req` is correctly typed, and the\n        // environment variable check provides dead code elimination.\n        process.env.NEXT_RUNTIME === 'edge' && isWebNextRequest(request)) {\n            return NextRequestAdapter.fromWebNextRequest(request);\n        } else if (// The type check here ensures that `req` is correctly typed, and the\n        // environment variable check provides dead code elimination.\n        process.env.NEXT_RUNTIME !== 'edge' && isNodeNextRequest(request)) {\n            return NextRequestAdapter.fromNodeNextRequest(request, signal);\n        } else {\n            throw Object.defineProperty(new Error('Invariant: Unsupported NextRequest type'), \"__NEXT_ERROR_CODE\", {\n                value: \"E345\",\n                enumerable: false,\n                configurable: true\n            });\n        }\n    }\n    static fromNodeNextRequest(request, signal) {\n        // HEAD and GET requests can not have a body.\n        let body = null;\n        if (request.method !== 'GET' && request.method !== 'HEAD' && request.body) {\n            // @ts-expect-error - this is handled by undici, when streams/web land use it instead\n            body = request.body;\n        }\n        let url;\n        if (request.url.startsWith('http')) {\n            url = new URL(request.url);\n        } else {\n            // Grab the full URL from the request metadata.\n            const base = getRequestMeta(request, 'initURL');\n            if (!base || !base.startsWith('http')) {\n                // Because the URL construction relies on the fact that the URL provided\n                // is absolute, we need to provide a base URL. We can't use the request\n                // URL because it's relative, so we use a dummy URL instead.\n                url = new URL(request.url, 'http://n');\n            } else {\n                url = new URL(request.url, base);\n            }\n        }\n        return new NextRequest(url, {\n            method: request.method,\n            headers: fromNodeOutgoingHttpHeaders(request.headers),\n            duplex: 'half',\n            signal,\n            // geo\n            // ip\n            // nextConfig\n            // body can not be passed if request was aborted\n            // or we get a Request body was disturbed error\n            ...signal.aborted ? {} : {\n                body\n            }\n        });\n    }\n    static fromWebNextRequest(request) {\n        // HEAD and GET requests can not have a body.\n        let body = null;\n        if (request.method !== 'GET' && request.method !== 'HEAD') {\n            body = request.body;\n        }\n        return new NextRequest(request.url, {\n            method: request.method,\n            headers: fromNodeOutgoingHttpHeaders(request.headers),\n            duplex: 'half',\n            signal: request.request.signal,\n            // geo\n            // ip\n            // nextConfig\n            // body can not be passed if request was aborted\n            // or we get a Request body was disturbed error\n            ...request.request.signal.aborted ? {} : {\n                body\n            }\n        });\n    }\n}\n\n//# sourceMappingURL=next-request.js.map","import { pgTable, uuid, varchar, timestamp, text, jsonb } from 'drizzle-orm/pg-core';\nimport { internships, internshipBlocks } from './internships';\nimport { users } from './users';\n\nexport const assessments = pgTable('assessments', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  internshipId: uuid('internship_id').notNull().references(() => internships.id),\n  blockId: uuid('block_id').references(() => internshipBlocks.id),\n\n  assessorType: varchar('assessor_type', { length: 20 }).notNull(),\n  assessorId: uuid('assessor_id').references(() => users.id),\n\n  ratings: jsonb('ratings').$type<Record<string, number>>().notNull(),\n\n  strengths: text('strengths'),\n  improvements: text('improvements'),\n  comments: text('comments'),\n\n  wouldRecommend: varchar('would_recommend', { length: 20 }),\n\n  submittedAt: timestamp('submitted_at').defaultNow(),\n});\n","import { HeadersAdapter } from '../web/spec-extension/adapters/headers';\nimport { PRERENDER_REVALIDATE_HEADER, PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER } from '../../lib/constants';\nimport { getTracer } from '../lib/trace/tracer';\nimport { NodeSpan } from '../lib/trace/constants';\nexport function wrapApiHandler(page, handler) {\n    return (...args)=>{\n        getTracer().setRootSpanAttribute('next.route', page);\n        // Call API route method\n        return getTracer().trace(NodeSpan.runHandler, {\n            spanName: `executing api route (pages) ${page}`\n        }, ()=>handler(...args));\n    };\n}\n/**\n *\n * @param res response object\n * @param statusCode `HTTP` status code of response\n */ export function sendStatusCode(res, statusCode) {\n    res.statusCode = statusCode;\n    return res;\n}\n/**\n *\n * @param res response object\n * @param [statusOrUrl] `HTTP` status code of redirect\n * @param url URL of redirect\n */ export function redirect(res, statusOrUrl, url) {\n    if (typeof statusOrUrl === 'string') {\n        url = statusOrUrl;\n        statusOrUrl = 307;\n    }\n    if (typeof statusOrUrl !== 'number' || typeof url !== 'string') {\n        throw Object.defineProperty(new Error(`Invalid redirect arguments. Please use a single argument URL, e.g. res.redirect('/destination') or use a status code and URL, e.g. res.redirect(307, '/destination').`), \"__NEXT_ERROR_CODE\", {\n            value: \"E389\",\n            enumerable: false,\n            configurable: true\n        });\n    }\n    res.writeHead(statusOrUrl, {\n        Location: url\n    });\n    res.write(url);\n    res.end();\n    return res;\n}\nexport function checkIsOnDemandRevalidate(req, previewProps) {\n    const headers = HeadersAdapter.from(req.headers);\n    const previewModeId = headers.get(PRERENDER_REVALIDATE_HEADER);\n    const isOnDemandRevalidate = previewModeId === previewProps.previewModeId;\n    const revalidateOnlyGenerated = headers.has(PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER);\n    return {\n        isOnDemandRevalidate,\n        revalidateOnlyGenerated\n    };\n}\nexport const COOKIE_NAME_PRERENDER_BYPASS = `__prerender_bypass`;\nexport const COOKIE_NAME_PRERENDER_DATA = `__next_preview_data`;\nexport const RESPONSE_LIMIT_DEFAULT = 4 * 1024 * 1024;\nexport const SYMBOL_PREVIEW_DATA = Symbol(COOKIE_NAME_PRERENDER_DATA);\nexport const SYMBOL_CLEARED_COOKIES = Symbol(COOKIE_NAME_PRERENDER_BYPASS);\nexport function clearPreviewData(res, options = {}) {\n    if (SYMBOL_CLEARED_COOKIES in res) {\n        return res;\n    }\n    const { serialize } = require('next/dist/compiled/cookie');\n    const previous = res.getHeader('Set-Cookie');\n    res.setHeader(`Set-Cookie`, [\n        ...typeof previous === 'string' ? [\n            previous\n        ] : Array.isArray(previous) ? previous : [],\n        serialize(COOKIE_NAME_PRERENDER_BYPASS, '', {\n            // To delete a cookie, set `expires` to a date in the past:\n            // https://tools.ietf.org/html/rfc6265#section-4.1.1\n            // `Max-Age: 0` is not valid, thus ignored, and the cookie is persisted.\n            expires: new Date(0),\n            httpOnly: true,\n            sameSite: process.env.NODE_ENV !== 'development' ? 'none' : 'lax',\n            secure: process.env.NODE_ENV !== 'development',\n            path: '/',\n            ...options.path !== undefined ? {\n                path: options.path\n            } : undefined\n        }),\n        serialize(COOKIE_NAME_PRERENDER_DATA, '', {\n            // To delete a cookie, set `expires` to a date in the past:\n            // https://tools.ietf.org/html/rfc6265#section-4.1.1\n            // `Max-Age: 0` is not valid, thus ignored, and the cookie is persisted.\n            expires: new Date(0),\n            httpOnly: true,\n            sameSite: process.env.NODE_ENV !== 'development' ? 'none' : 'lax',\n            secure: process.env.NODE_ENV !== 'development',\n            path: '/',\n            ...options.path !== undefined ? {\n                path: options.path\n            } : undefined\n        })\n    ]);\n    Object.defineProperty(res, SYMBOL_CLEARED_COOKIES, {\n        value: true,\n        enumerable: false\n    });\n    return res;\n}\n/**\n * Custom error class\n */ export class ApiError extends Error {\n    constructor(statusCode, message){\n        super(message);\n        this.statusCode = statusCode;\n    }\n}\n/**\n * Sends error in `response`\n * @param res response object\n * @param statusCode of response\n * @param message of response\n */ export function sendError(res, statusCode, message) {\n    res.statusCode = statusCode;\n    res.statusMessage = message;\n    res.end(message);\n}\n/**\n * Execute getter function only if its needed\n * @param LazyProps `req` and `params` for lazyProp\n * @param prop name of property\n * @param getter function to get data\n */ export function setLazyProp({ req }, prop, getter) {\n    const opts = {\n        configurable: true,\n        enumerable: true\n    };\n    const optsReset = {\n        ...opts,\n        writable: true\n    };\n    Object.defineProperty(req, prop, {\n        ...opts,\n        get: ()=>{\n            const value = getter();\n            // we set the property on the object to avoid recalculating it\n            Object.defineProperty(req, prop, {\n                ...optsReset,\n                value\n            });\n            return value;\n        },\n        set: (value)=>{\n            Object.defineProperty(req, prop, {\n                ...optsReset,\n                value\n            });\n        }\n    });\n}\n\n//# sourceMappingURL=index.js.map","import { removeTrailingSlash } from './remove-trailing-slash';\nimport { addPathPrefix } from './add-path-prefix';\nimport { addPathSuffix } from './add-path-suffix';\nimport { addLocale } from './add-locale';\nexport function formatNextPathnameInfo(info) {\n    let pathname = addLocale(info.pathname, info.locale, info.buildId ? undefined : info.defaultLocale, info.ignorePrefix);\n    if (info.buildId || !info.trailingSlash) {\n        pathname = removeTrailingSlash(pathname);\n    }\n    if (info.buildId) {\n        pathname = addPathSuffix(addPathPrefix(pathname, `/_next/data/${info.buildId}`), info.pathname === '/' ? 'index.json' : '.json');\n    }\n    pathname = addPathPrefix(pathname, info.basePath);\n    return !info.buildId && info.trailingSlash ? !pathname.endsWith('/') ? addPathSuffix(pathname, '/') : pathname : removeTrailingSlash(pathname);\n}\n\n//# sourceMappingURL=format-next-pathname-info.js.map","/**\n * Given a path this function will find the pathname, query and hash and return\n * them. This is useful to parse full paths on the client side.\n * @param path A path to parse e.g. /foo/bar?id=1#hash\n */ export function parsePath(path) {\n    const hashIndex = path.indexOf('#');\n    const queryIndex = path.indexOf('?');\n    const hasQuery = queryIndex > -1 && (hashIndex < 0 || queryIndex < hashIndex);\n    if (hasQuery || hashIndex > -1) {\n        return {\n            pathname: path.substring(0, hasQuery ? queryIndex : hashIndex),\n            query: hasQuery ? path.substring(queryIndex, hashIndex > -1 ? hashIndex : undefined) : '',\n            hash: hashIndex > -1 ? path.slice(hashIndex) : ''\n        };\n    }\n    return {\n        pathname: path,\n        query: '',\n        hash: ''\n    };\n}\n\n//# sourceMappingURL=parse-path.js.map","import { DetachedPromise } from './detached-promise';\n/**\n * A wrapper for a function that will only allow one call to the function to\n * execute at a time.\n */ export class Batcher {\n    constructor(cacheKeyFn, /**\n     * A function that will be called to schedule the wrapped function to be\n     * executed. This defaults to a function that will execute the function\n     * immediately.\n     */ schedulerFn = (fn)=>fn()){\n        this.cacheKeyFn = cacheKeyFn;\n        this.schedulerFn = schedulerFn;\n        this.pending = new Map();\n    }\n    static create(options) {\n        return new Batcher(options == null ? void 0 : options.cacheKeyFn, options == null ? void 0 : options.schedulerFn);\n    }\n    /**\n   * Wraps a function in a promise that will be resolved or rejected only once\n   * for a given key. This will allow multiple calls to the function to be\n   * made, but only one will be executed at a time. The result of the first\n   * call will be returned to all callers.\n   *\n   * @param key the key to use for the cache\n   * @param fn the function to wrap\n   * @returns a promise that resolves to the result of the function\n   */ async batch(key, fn) {\n        const cacheKey = this.cacheKeyFn ? await this.cacheKeyFn(key) : key;\n        if (cacheKey === null) {\n            return fn({\n                resolve: (value)=>Promise.resolve(value),\n                key\n            });\n        }\n        const pending = this.pending.get(cacheKey);\n        if (pending) return pending;\n        const { promise, resolve, reject } = new DetachedPromise();\n        this.pending.set(cacheKey, promise);\n        this.schedulerFn(async ()=>{\n            try {\n                const result = await fn({\n                    resolve,\n                    key\n                });\n                // Resolving a promise multiple times is a no-op, so we can safely\n                // resolve all pending promises with the same result.\n                resolve(result);\n            } catch (err) {\n                reject(err);\n            } finally{\n                this.pending.delete(cacheKey);\n            }\n        });\n        return promise;\n    }\n}\n\n//# sourceMappingURL=batcher.js.map","import { parsePath } from './parse-path';\n/**\n * Adds the provided prefix to the given path. It first ensures that the path\n * is indeed starting with a slash.\n */ export function addPathPrefix(path, prefix) {\n    if (!path.startsWith('/') || !prefix) {\n        return path;\n    }\n    const { pathname, query, hash } = parsePath(path);\n    return `${prefix}${pathname}${query}${hash}`;\n}\n\n//# sourceMappingURL=add-path-prefix.js.map","import { Batcher } from '../../lib/batcher';\nimport { scheduleOnNextTick } from '../../lib/scheduler';\nimport { fromResponseCacheEntry, routeKindToIncrementalCacheKind, toResponseCacheEntry } from './utils';\nexport * from './types';\nexport default class ResponseCache {\n    constructor(minimal_mode){\n        this.getBatcher = Batcher.create({\n            // Ensure on-demand revalidate doesn't block normal requests, it should be\n            // safe to run an on-demand revalidate for the same key as a normal request.\n            cacheKeyFn: ({ key, isOnDemandRevalidate })=>`${key}-${isOnDemandRevalidate ? '1' : '0'}`,\n            // We wait to do any async work until after we've added our promise to\n            // `pendingResponses` to ensure that any any other calls will reuse the\n            // same promise until we've fully finished our work.\n            schedulerFn: scheduleOnNextTick\n        });\n        this.revalidateBatcher = Batcher.create({\n            // We wait to do any async work until after we've added our promise to\n            // `pendingResponses` to ensure that any any other calls will reuse the\n            // same promise until we've fully finished our work.\n            schedulerFn: scheduleOnNextTick\n        });\n        this.minimal_mode = minimal_mode;\n    }\n    /**\n   * Gets the response cache entry for the given key.\n   *\n   * @param key - The key to get the response cache entry for.\n   * @param responseGenerator - The response generator to use to generate the response cache entry.\n   * @param context - The context for the get request.\n   * @returns The response cache entry.\n   */ async get(key, responseGenerator, context) {\n        var _this_previousCacheItem;\n        // If there is no key for the cache, we can't possibly look this up in the\n        // cache so just return the result of the response generator.\n        if (!key) {\n            return responseGenerator({\n                hasResolved: false,\n                previousCacheEntry: null\n            });\n        }\n        // Check minimal mode cache before doing any other work\n        if (this.minimal_mode && ((_this_previousCacheItem = this.previousCacheItem) == null ? void 0 : _this_previousCacheItem.key) === key && this.previousCacheItem.expiresAt > Date.now()) {\n            return toResponseCacheEntry(this.previousCacheItem.entry);\n        }\n        const { incrementalCache, isOnDemandRevalidate = false, isFallback = false, isRoutePPREnabled = false, isPrefetch = false, waitUntil, routeKind } = context;\n        const response = await this.getBatcher.batch({\n            key,\n            isOnDemandRevalidate\n        }, ({ resolve })=>{\n            const promise = this.handleGet(key, responseGenerator, {\n                incrementalCache,\n                isOnDemandRevalidate,\n                isFallback,\n                isRoutePPREnabled,\n                isPrefetch,\n                routeKind\n            }, resolve);\n            // We need to ensure background revalidates are passed to waitUntil.\n            if (waitUntil) waitUntil(promise);\n            return promise;\n        });\n        return toResponseCacheEntry(response);\n    }\n    /**\n   * Handles the get request for the response cache.\n   *\n   * @param key - The key to get the response cache entry for.\n   * @param responseGenerator - The response generator to use to generate the response cache entry.\n   * @param context - The context for the get request.\n   * @param resolve - The resolve function to use to resolve the response cache entry.\n   * @returns The response cache entry.\n   */ async handleGet(key, responseGenerator, context, resolve) {\n        let previousIncrementalCacheEntry = null;\n        let resolved = false;\n        try {\n            // Get the previous cache entry if not in minimal mode\n            previousIncrementalCacheEntry = !this.minimal_mode ? await context.incrementalCache.get(key, {\n                kind: routeKindToIncrementalCacheKind(context.routeKind),\n                isRoutePPREnabled: context.isRoutePPREnabled,\n                isFallback: context.isFallback\n            }) : null;\n            if (previousIncrementalCacheEntry && !context.isOnDemandRevalidate) {\n                resolve(previousIncrementalCacheEntry);\n                resolved = true;\n                if (!previousIncrementalCacheEntry.isStale || context.isPrefetch) {\n                    // The cached value is still valid, so we don't need to update it yet.\n                    return previousIncrementalCacheEntry;\n                }\n            }\n            // Revalidate the cache entry\n            const incrementalResponseCacheEntry = await this.revalidate(key, context.incrementalCache, context.isRoutePPREnabled, context.isFallback, responseGenerator, previousIncrementalCacheEntry, previousIncrementalCacheEntry !== null && !context.isOnDemandRevalidate);\n            // Handle null response\n            if (!incrementalResponseCacheEntry) {\n                // Unset the previous cache item if it was set so we don't use it again.\n                if (this.minimal_mode) this.previousCacheItem = undefined;\n                return null;\n            }\n            // Resolve for on-demand revalidation or if not already resolved\n            if (context.isOnDemandRevalidate && !resolved) {\n                return incrementalResponseCacheEntry;\n            }\n            return incrementalResponseCacheEntry;\n        } catch (err) {\n            // If we've already resolved the cache entry, we can't reject as we\n            // already resolved the cache entry so log the error here.\n            if (resolved) {\n                console.error(err);\n                return null;\n            }\n            throw err;\n        }\n    }\n    /**\n   * Revalidates the cache entry for the given key.\n   *\n   * @param key - The key to revalidate the cache entry for.\n   * @param incrementalCache - The incremental cache to use to revalidate the cache entry.\n   * @param isRoutePPREnabled - Whether the route is PPR enabled.\n   * @param isFallback - Whether the route is a fallback.\n   * @param responseGenerator - The response generator to use to generate the response cache entry.\n   * @param previousIncrementalCacheEntry - The previous cache entry to use to revalidate the cache entry.\n   * @param hasResolved - Whether the response has been resolved.\n   * @returns The revalidated cache entry.\n   */ async revalidate(key, incrementalCache, isRoutePPREnabled, isFallback, responseGenerator, previousIncrementalCacheEntry, hasResolved, waitUntil) {\n        return this.revalidateBatcher.batch(key, ()=>{\n            const promise = this.handleRevalidate(key, incrementalCache, isRoutePPREnabled, isFallback, responseGenerator, previousIncrementalCacheEntry, hasResolved);\n            // We need to ensure background revalidates are passed to waitUntil.\n            if (waitUntil) waitUntil(promise);\n            return promise;\n        });\n    }\n    async handleRevalidate(key, incrementalCache, isRoutePPREnabled, isFallback, responseGenerator, previousIncrementalCacheEntry, hasResolved) {\n        try {\n            // Generate the response cache entry using the response generator.\n            const responseCacheEntry = await responseGenerator({\n                hasResolved,\n                previousCacheEntry: previousIncrementalCacheEntry,\n                isRevalidating: true\n            });\n            if (!responseCacheEntry) {\n                return null;\n            }\n            // Convert the response cache entry to an incremental response cache entry.\n            const incrementalResponseCacheEntry = await fromResponseCacheEntry({\n                ...responseCacheEntry,\n                isMiss: !previousIncrementalCacheEntry\n            });\n            // We want to persist the result only if it has a cache control value\n            // defined.\n            if (incrementalResponseCacheEntry.cacheControl) {\n                if (this.minimal_mode) {\n                    this.previousCacheItem = {\n                        key,\n                        entry: incrementalResponseCacheEntry,\n                        expiresAt: Date.now() + 1000\n                    };\n                } else {\n                    await incrementalCache.set(key, incrementalResponseCacheEntry.value, {\n                        cacheControl: incrementalResponseCacheEntry.cacheControl,\n                        isRoutePPREnabled,\n                        isFallback\n                    });\n                }\n            }\n            return incrementalResponseCacheEntry;\n        } catch (err) {\n            // When a path is erroring we automatically re-set the existing cache\n            // with new revalidate and expire times to prevent non-stop retrying.\n            if (previousIncrementalCacheEntry == null ? void 0 : previousIncrementalCacheEntry.cacheControl) {\n                const revalidate = Math.min(Math.max(previousIncrementalCacheEntry.cacheControl.revalidate || 3, 3), 30);\n                const expire = previousIncrementalCacheEntry.cacheControl.expire === undefined ? undefined : Math.max(revalidate + 3, previousIncrementalCacheEntry.cacheControl.expire);\n                await incrementalCache.set(key, previousIncrementalCacheEntry.value, {\n                    cacheControl: {\n                        revalidate: revalidate,\n                        expire: expire\n                    },\n                    isRoutePPREnabled,\n                    isFallback\n                });\n            }\n            // We haven't resolved yet, so let's throw to indicate an error.\n            throw err;\n        }\n    }\n}\n\n//# sourceMappingURL=index.js.map","import { l as parseSetCookieHeader } from \"./cookies-D72PbWdz.mjs\";\nimport { serializeSignedCookie } from \"better-call\";\nimport { createAuthMiddleware } from \"@better-auth/core/api\";\nimport { createHMAC } from \"@better-auth/utils/hmac\";\n\n//#region src/plugins/bearer/index.ts\n/**\n* Converts bearer token to session cookie\n*/\nconst bearer = (options) => {\n\treturn {\n\t\tid: \"bearer\",\n\t\thooks: {\n\t\t\tbefore: [{\n\t\t\t\tmatcher(context) {\n\t\t\t\t\treturn Boolean(context.request?.headers.get(\"authorization\") || context.headers?.get(\"authorization\"));\n\t\t\t\t},\n\t\t\t\thandler: createAuthMiddleware(async (c) => {\n\t\t\t\t\tconst token = c.request?.headers.get(\"authorization\")?.replace(\"Bearer \", \"\") || c.headers?.get(\"Authorization\")?.replace(\"Bearer \", \"\");\n\t\t\t\t\tif (!token) return;\n\t\t\t\t\tlet signedToken = \"\";\n\t\t\t\t\tif (token.includes(\".\")) signedToken = token.replace(\"=\", \"\");\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (options?.requireSignature) return;\n\t\t\t\t\t\tsignedToken = (await serializeSignedCookie(\"\", token, c.context.secret)).replace(\"=\", \"\");\n\t\t\t\t\t}\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst decodedToken = decodeURIComponent(signedToken);\n\t\t\t\t\t\tif (!await createHMAC(\"SHA-256\", \"base64urlnopad\").verify(c.context.secret, decodedToken.split(\".\")[0], decodedToken.split(\".\")[1])) return;\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst existingHeaders = c.request?.headers || c.headers;\n\t\t\t\t\tconst headers = new Headers({ ...Object.fromEntries(existingHeaders?.entries()) });\n\t\t\t\t\theaders.append(\"cookie\", `${c.context.authCookies.sessionToken.name}=${signedToken}`);\n\t\t\t\t\treturn { context: { headers } };\n\t\t\t\t})\n\t\t\t}],\n\t\t\tafter: [{\n\t\t\t\tmatcher(context) {\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\tconst setCookie = ctx.context.responseHeaders?.get(\"set-cookie\");\n\t\t\t\t\tif (!setCookie) return;\n\t\t\t\t\tconst parsedCookies = parseSetCookieHeader(setCookie);\n\t\t\t\t\tconst cookieName = ctx.context.authCookies.sessionToken.name;\n\t\t\t\t\tconst sessionCookie = parsedCookies.get(cookieName);\n\t\t\t\t\tif (!sessionCookie || !sessionCookie.value || sessionCookie[\"max-age\"] === 0) return;\n\t\t\t\t\tconst token = sessionCookie.value;\n\t\t\t\t\tconst exposedHeaders = ctx.context.responseHeaders?.get(\"access-control-expose-headers\") || \"\";\n\t\t\t\t\tconst headersSet = new Set(exposedHeaders.split(\",\").map((header) => header.trim()).filter(Boolean));\n\t\t\t\t\theadersSet.add(\"set-auth-token\");\n\t\t\t\t\tctx.setHeader(\"set-auth-token\", token);\n\t\t\t\t\tctx.setHeader(\"Access-Control-Expose-Headers\", Array.from(headersSet).join(\", \"));\n\t\t\t\t})\n\t\t\t}]\n\t\t}\n\t};\n};\n\n//#endregion\nexport { bearer as t };","import { n as getSession } from \"./session-AaRl3_x-.mjs\";\nimport { t as getEndpointResponse } from \"./plugin-helper-zFdFWLgL.mjs\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\n\n//#region src/plugins/custom-session/index.ts\nconst getSessionQuerySchema = z.optional(z.object({\n\tdisableCookieCache: z.boolean().meta({ description: \"Disable cookie cache and fetch session from database\" }).or(z.string().transform((v) => v === \"true\")).optional(),\n\tdisableRefresh: z.boolean().meta({ description: \"Disable session refresh. Useful for checking session status, without updating the session\" }).optional()\n}));\nconst customSession = (fn, options, pluginOptions) => {\n\treturn {\n\t\tid: \"custom-session\",\n\t\thooks: { after: [{\n\t\t\tmatcher: (ctx) => ctx.path === \"/multi-session/list-device-sessions\" && (pluginOptions?.shouldMutateListDeviceSessionsEndpoint ?? false),\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst response = await getEndpointResponse(ctx);\n\t\t\t\tif (!response) return;\n\t\t\t\tconst newResponse = await Promise.all(response.map(async (v) => await fn(v, ctx)));\n\t\t\t\treturn ctx.json(newResponse);\n\t\t\t})\n\t\t}] },\n\t\tendpoints: { getSession: createAuthEndpoint(\"/get-session\", {\n\t\t\tmethod: \"GET\",\n\t\t\tquery: getSessionQuerySchema,\n\t\t\tmetadata: {\n\t\t\t\tCUSTOM_SESSION: true,\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Get custom session data\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\titems: { $ref: \"#/components/schemas/Session\" }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t}\n\t\t\t},\n\t\t\trequireHeaders: true\n\t\t}, async (ctx) => {\n\t\t\tconst session = await getSession()({\n\t\t\t\t...ctx,\n\t\t\t\tasResponse: false,\n\t\t\t\theaders: ctx.headers,\n\t\t\t\treturnHeaders: true\n\t\t\t}).catch((e) => {\n\t\t\t\treturn null;\n\t\t\t});\n\t\t\tif (!session?.response) return ctx.json(null);\n\t\t\tconst fnResult = await fn(session.response, ctx);\n\t\t\tconst setCookie = session.headers.get(\"set-cookie\");\n\t\t\tif (setCookie) {\n\t\t\t\tctx.setHeader(\"set-cookie\", setCookie);\n\t\t\t\tsession.headers.delete(\"set-cookie\");\n\t\t\t}\n\t\t\tsession.headers.forEach((value, key) => {\n\t\t\t\tctx.setHeader(key, value);\n\t\t\t});\n\t\t\treturn ctx.json(fnResult);\n\t\t}) },\n\t\t$Infer: { Session: {} }\n\t};\n};\n\n//#endregion\nexport { customSession as t };","import { a as getAuthTables } from \"./get-model-name-D4DUV7S2.mjs\";\nimport { a as getEndpoints, t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\n\n//#region src/plugins/open-api/generator.ts\nconst allowedType = new Set([\n\t\"string\",\n\t\"number\",\n\t\"boolean\",\n\t\"array\",\n\t\"object\"\n]);\nfunction getTypeFromZodType(zodType) {\n\tconst type = zodType.type;\n\treturn allowedType.has(type) ? type : \"string\";\n}\nfunction getFieldSchema(field) {\n\tconst schema = {\n\t\ttype: field.type === \"date\" ? \"string\" : field.type,\n\t\t...field.type === \"date\" && { format: \"date-time\" }\n\t};\n\tif (field.defaultValue !== void 0) schema.default = typeof field.defaultValue === \"function\" ? \"Generated at runtime\" : field.defaultValue;\n\tif (field.input === false) schema.readOnly = true;\n\treturn schema;\n}\nfunction getParameters(options) {\n\tconst parameters = [];\n\tif (options.metadata?.openapi?.parameters) {\n\t\tparameters.push(...options.metadata.openapi.parameters);\n\t\treturn parameters;\n\t}\n\tif (options.query instanceof z.ZodObject) Object.entries(options.query.shape).forEach(([key, value]) => {\n\t\tif (value instanceof z.ZodType) parameters.push({\n\t\t\tname: key,\n\t\t\tin: \"query\",\n\t\t\tschema: {\n\t\t\t\t...processZodType(value),\n\t\t\t\t...\"minLength\" in value && value.minLength ? { minLength: value.minLength } : {}\n\t\t\t}\n\t\t});\n\t});\n\treturn parameters;\n}\nfunction getRequestBody(options) {\n\tif (options.metadata?.openapi?.requestBody) return options.metadata.openapi.requestBody;\n\tif (!options.body) return void 0;\n\tif (options.body instanceof z.ZodObject || options.body instanceof z.ZodOptional) {\n\t\tconst shape = options.body.shape;\n\t\tif (!shape) return void 0;\n\t\tconst properties = {};\n\t\tconst required = [];\n\t\tObject.entries(shape).forEach(([key, value]) => {\n\t\t\tif (value instanceof z.ZodType) {\n\t\t\t\tproperties[key] = processZodType(value);\n\t\t\t\tif (!(value instanceof z.ZodOptional)) required.push(key);\n\t\t\t}\n\t\t});\n\t\treturn {\n\t\t\trequired: options.body instanceof z.ZodOptional ? false : options.body ? true : false,\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties,\n\t\t\t\trequired\n\t\t\t} } }\n\t\t};\n\t}\n}\nfunction processZodType(zodType) {\n\tif (zodType instanceof z.ZodOptional) {\n\t\tconst innerType = zodType._def.innerType;\n\t\treturn {\n\t\t\t...processZodType(innerType),\n\t\t\tnullable: true\n\t\t};\n\t}\n\tif (zodType instanceof z.ZodObject) {\n\t\tconst shape = zodType.shape;\n\t\tif (shape) {\n\t\t\tconst properties = {};\n\t\t\tconst required = [];\n\t\t\tObject.entries(shape).forEach(([key, value]) => {\n\t\t\t\tif (value instanceof z.ZodType) {\n\t\t\t\t\tproperties[key] = processZodType(value);\n\t\t\t\t\tif (!(value instanceof z.ZodOptional)) required.push(key);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties,\n\t\t\t\t...required.length > 0 ? { required } : {},\n\t\t\t\tdescription: zodType.description\n\t\t\t};\n\t\t}\n\t}\n\treturn {\n\t\ttype: getTypeFromZodType(zodType),\n\t\tdescription: zodType.description\n\t};\n}\nfunction getResponse(responses) {\n\treturn {\n\t\t\"400\": {\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { message: { type: \"string\" } },\n\t\t\t\trequired: [\"message\"]\n\t\t\t} } },\n\t\t\tdescription: \"Bad Request. Usually due to missing parameters, or invalid parameters.\"\n\t\t},\n\t\t\"401\": {\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { message: { type: \"string\" } },\n\t\t\t\trequired: [\"message\"]\n\t\t\t} } },\n\t\t\tdescription: \"Unauthorized. Due to missing or invalid authentication.\"\n\t\t},\n\t\t\"403\": {\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { message: { type: \"string\" } }\n\t\t\t} } },\n\t\t\tdescription: \"Forbidden. You do not have permission to access this resource or to perform this action.\"\n\t\t},\n\t\t\"404\": {\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { message: { type: \"string\" } }\n\t\t\t} } },\n\t\t\tdescription: \"Not Found. The requested resource was not found.\"\n\t\t},\n\t\t\"429\": {\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { message: { type: \"string\" } }\n\t\t\t} } },\n\t\t\tdescription: \"Too Many Requests. You have exceeded the rate limit. Try again later.\"\n\t\t},\n\t\t\"500\": {\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { message: { type: \"string\" } }\n\t\t\t} } },\n\t\t\tdescription: \"Internal Server Error. This is a problem with the server that you cannot fix.\"\n\t\t},\n\t\t...responses\n\t};\n}\nfunction toOpenApiPath(path) {\n\treturn path.split(\"/\").map((part) => part.startsWith(\":\") ? `{${part.slice(1)}}` : part).join(\"/\");\n}\nasync function generator(ctx, options) {\n\tconst baseEndpoints = getEndpoints(ctx, {\n\t\t...options,\n\t\tplugins: []\n\t});\n\tconst tables = getAuthTables({\n\t\t...options,\n\t\tsession: {\n\t\t\t...options.session,\n\t\t\tstoreSessionInDatabase: true\n\t\t}\n\t});\n\tconst components = { schemas: { ...Object.entries(tables).reduce((acc, [key, value]) => {\n\t\tconst modelName = key.charAt(0).toUpperCase() + key.slice(1);\n\t\tconst fields = value.fields;\n\t\tconst required = [];\n\t\tconst properties = { id: { type: \"string\" } };\n\t\tObject.entries(fields).forEach(([fieldKey, fieldValue]) => {\n\t\t\tif (!fieldValue) return;\n\t\t\tproperties[fieldKey] = getFieldSchema(fieldValue);\n\t\t\tif (fieldValue.required && fieldValue.input !== false) required.push(fieldKey);\n\t\t});\n\t\tObject.entries(properties).forEach(([key$1, prop]) => {\n\t\t\tconst field = value.fields[key$1];\n\t\t\tif (field && field.type === \"date\" && prop.type === \"string\") prop.format = \"date-time\";\n\t\t});\n\t\tacc[modelName] = {\n\t\t\ttype: \"object\",\n\t\t\tproperties,\n\t\t\trequired\n\t\t};\n\t\treturn acc;\n\t}, {}) } };\n\tconst paths = {};\n\tObject.entries(baseEndpoints.api).forEach(([_, value]) => {\n\t\tif (ctx.options.disabledPaths?.includes(value.path)) return;\n\t\tconst options$1 = value.options;\n\t\tif (options$1.metadata?.SERVER_ONLY) return;\n\t\tconst path = toOpenApiPath(value.path);\n\t\tif (options$1.method === \"GET\" || options$1.method === \"DELETE\") paths[path] = {\n\t\t\t...paths[path],\n\t\t\t[options$1.method.toLowerCase()]: {\n\t\t\t\ttags: [\"Default\", ...options$1.metadata?.openapi?.tags || []],\n\t\t\t\tdescription: options$1.metadata?.openapi?.description,\n\t\t\t\toperationId: options$1.metadata?.openapi?.operationId,\n\t\t\t\tsecurity: [{ bearerAuth: [] }],\n\t\t\t\tparameters: getParameters(options$1),\n\t\t\t\tresponses: getResponse(options$1.metadata?.openapi?.responses)\n\t\t\t}\n\t\t};\n\t\tif (options$1.method === \"POST\" || options$1.method === \"PATCH\" || options$1.method === \"PUT\") {\n\t\t\tconst body = getRequestBody(options$1);\n\t\t\tpaths[path] = {\n\t\t\t\t...paths[path],\n\t\t\t\t[options$1.method.toLowerCase()]: {\n\t\t\t\t\ttags: [\"Default\", ...options$1.metadata?.openapi?.tags || []],\n\t\t\t\t\tdescription: options$1.metadata?.openapi?.description,\n\t\t\t\t\toperationId: options$1.metadata?.openapi?.operationId,\n\t\t\t\t\tsecurity: [{ bearerAuth: [] }],\n\t\t\t\t\tparameters: getParameters(options$1),\n\t\t\t\t\t...body ? { requestBody: body } : { requestBody: { content: { \"application/json\": { schema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {}\n\t\t\t\t\t} } } } },\n\t\t\t\t\tresponses: getResponse(options$1.metadata?.openapi?.responses)\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t});\n\tfor (const plugin of options.plugins || []) {\n\t\tif (plugin.id === \"open-api\") continue;\n\t\tconst pluginEndpoints = getEndpoints(ctx, {\n\t\t\t...options,\n\t\t\tplugins: [plugin]\n\t\t});\n\t\tconst api = Object.keys(pluginEndpoints.api).map((key) => {\n\t\t\tif (baseEndpoints.api[key] === void 0) return pluginEndpoints.api[key];\n\t\t\treturn null;\n\t\t}).filter((x) => x !== null);\n\t\tObject.entries(api).forEach(([key, value]) => {\n\t\t\tif (ctx.options.disabledPaths?.includes(value.path)) return;\n\t\t\tconst options$1 = value.options;\n\t\t\tif (options$1.metadata?.SERVER_ONLY) return;\n\t\t\tconst path = toOpenApiPath(value.path);\n\t\t\tif (options$1.method === \"GET\" || options$1.method === \"DELETE\") paths[path] = {\n\t\t\t\t...paths[path],\n\t\t\t\t[options$1.method.toLowerCase()]: {\n\t\t\t\t\ttags: options$1.metadata?.openapi?.tags || [plugin.id.charAt(0).toUpperCase() + plugin.id.slice(1)],\n\t\t\t\t\tdescription: options$1.metadata?.openapi?.description,\n\t\t\t\t\toperationId: options$1.metadata?.openapi?.operationId,\n\t\t\t\t\tsecurity: [{ bearerAuth: [] }],\n\t\t\t\t\tparameters: getParameters(options$1),\n\t\t\t\t\tresponses: getResponse(options$1.metadata?.openapi?.responses)\n\t\t\t\t}\n\t\t\t};\n\t\t\tif (options$1.method === \"POST\" || options$1.method === \"PATCH\" || options$1.method === \"PUT\") paths[path] = {\n\t\t\t\t...paths[path],\n\t\t\t\t[options$1.method.toLowerCase()]: {\n\t\t\t\t\ttags: options$1.metadata?.openapi?.tags || [plugin.id.charAt(0).toUpperCase() + plugin.id.slice(1)],\n\t\t\t\t\tdescription: options$1.metadata?.openapi?.description,\n\t\t\t\t\toperationId: options$1.metadata?.openapi?.operationId,\n\t\t\t\t\tsecurity: [{ bearerAuth: [] }],\n\t\t\t\t\tparameters: getParameters(options$1),\n\t\t\t\t\trequestBody: getRequestBody(options$1),\n\t\t\t\t\tresponses: getResponse(options$1.metadata?.openapi?.responses)\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t}\n\treturn {\n\t\topenapi: \"3.1.1\",\n\t\tinfo: {\n\t\t\ttitle: \"Better Auth\",\n\t\t\tdescription: \"API Reference for your Better Auth Instance\",\n\t\t\tversion: \"1.1.0\"\n\t\t},\n\t\tcomponents: {\n\t\t\t...components,\n\t\t\tsecuritySchemes: {\n\t\t\t\tapiKeyCookie: {\n\t\t\t\t\ttype: \"apiKey\",\n\t\t\t\t\tin: \"cookie\",\n\t\t\t\t\tname: \"apiKeyCookie\",\n\t\t\t\t\tdescription: \"API Key authentication via cookie\"\n\t\t\t\t},\n\t\t\t\tbearerAuth: {\n\t\t\t\t\ttype: \"http\",\n\t\t\t\t\tscheme: \"bearer\",\n\t\t\t\t\tdescription: \"Bearer token authentication\"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tsecurity: [{\n\t\t\tapiKeyCookie: [],\n\t\t\tbearerAuth: []\n\t\t}],\n\t\tservers: [{ url: ctx.baseURL }],\n\t\ttags: [{\n\t\t\tname: \"Default\",\n\t\t\tdescription: \"Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin.\"\n\t\t}],\n\t\tpaths\n\t};\n}\n\n//#endregion\n//#region src/plugins/open-api/logo.ts\nconst logo = `<svg width=\"75\" height=\"75\" viewBox=\"0 0 75 75\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n<rect width=\"75\" height=\"75\" fill=\"url(#pattern0_21_12)\"/>\n<defs>\n<pattern id=\"pattern0_21_12\" patternContentUnits=\"objectBoundingBox\" width=\"1\" height=\"1\">\n<use xlink:href=\"#image0_21_12\" transform=\"scale(0.00094697)\"/>\n</pattern>\n<image id=\"image0_21_12\" width=\"1056\" height=\"1056\" xlink:href=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/4QBARXhpZgAATU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAEIKADAAQAAAABAAAEIAAAAAD/7QA4UGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAAA4QklNBCUAAAAAABDUHYzZjwCyBOmACZjs+EJ+/+ICKElDQ19QUk9GSUxFAAEBAAACGGFwcGwEAAAAbW50clJHQiBYWVogB+YAAQABAAAAAAAAYWNzcEFQUEwAAAAAQVBQTAAAAAAAAAAAAAAAAAAAAAAAAPbWAAEAAAAA0y1hcHBs7P2jjjiFR8NttL1PetoYLwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKZGVzYwAAAPwAAAAwY3BydAAAASwAAABQd3RwdAAAAXwAAAAUclhZWgAAAZAAAAAUZ1hZWgAAAaQAAAAUYlhZWgAAAbgAAAAUclRSQwAAAcwAAAAgY2hhZAAAAewAAAAsYlRSQwAAAcwAAAAgZ1RSQwAAAcwAAAAgbWx1YwAAAAAAAAABAAAADGVuVVMAAAAUAAAAHABEAGkAcwBwAGwAYQB5ACAAUAAzbWx1YwAAAAAAAAABAAAADGVuVVMAAAA0AAAAHABDAG8AcAB5AHIAaQBnAGgAdAAgAEEAcABwAGwAZQAgAEkAbgBjAC4ALAAgADIAMAAyADJYWVogAAAAAAAA9tUAAQAAAADTLFhZWiAAAAAAAACD3wAAPb////+7WFlaIAAAAAAAAEq/AACxNwAACrlYWVogAAAAAAAAKDgAABELAADIuXBhcmEAAAAAAAMAAAACZmYAAPKnAAANWQAAE9AAAApbc2YzMgAAAAAAAQxCAAAF3v//8yYAAAeTAAD9kP//+6L///2jAAAD3AAAwG7/wAARCAQgBCADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9sAQwACAgICAgIDAgIDBAMDAwQFBAQEBAUHBQUFBQUHCAcHBwcHBwgICAgICAgICgoKCgoKCwsLCwsNDQ0NDQ0NDQ0N/9sAQwECAgIDAwMGAwMGDQkHCQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0N/90ABABC/9oADAMBAAIRAxEAPwD9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//Q/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9L9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//T/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9b9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9H9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9T9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//V/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Ln/gq38a/in8Dvgp4T8R/CfxFdeG9SvvFMdlcXFoELyW5srqQxnzEcY3op4Gciv1Gr8Z/+C2X/JvXgj/sc4v/AE33lAH4z/8ADwv9tD/oq2tf9823/wAZo/4eF/tof9FW1r/vm2/+M18Z0UAfZn/Dwv8AbQ/6KtrX/fNt/wDGaP8Ah4X+2h/0VbWv++bb/wCM18Z0UAfZn/Dwv9tD/oq2tf8AfNt/8Zo/4eF/tof9FW1r/vm2/wDjNfGdFAH2Z/w8L/bQ/wCira1/3zbf/GaP+Hhf7aH/AEVbWv8Avm2/+M18Z0UAfZn/AA8L/bQ/6KtrX/fNt/8AGaP+Hhf7aH/RVta/75tv/jNfGdFAH2Z/w8L/AG0P+ira1/3zbf8Axmj/AIeF/tof9FW1r/vm2/8AjNfGdFAH63/sVftq/tTfEb9qb4deCfG3xF1TVtD1bVGgvbKdYBHPGIJW2ttiVsblB4I6V/UbX8Z//BPT/k9D4U/9hpv/AEmmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+M/wD4eF/tof8ARVta/wC+bb/4zR/w8L/bQ/6KtrX/AHzbf/Ga+M6KAPsz/h4X+2h/0VbWv++bb/4zR/w8L/bQ/wCira1/3zbf/Ga+M6KAPsz/AIeF/tof9FW1r/vm2/8AjNH/AA8L/bQ/6KtrX/fNt/8AGa+M6KAPsz/h4X+2h/0VbWv++bb/AOM0f8PC/wBtD/oq2tf9823/AMZr4zooA+zP+Hhf7aH/AEVbWv8Avm2/+M0f8PC/20P+ira1/wB823/xmvjOigD7M/4eF/tof9FW1r/vm2/+M0f8PC/20P8Aoq2tf9823/xmvjOigD7M/wCHhf7aH/RVta/75tv/AIzR/wAPC/20P+ira1/3zbf/ABmvjOigD7M/4eF/tof9FW1r/vm2/wDjNH/Dwv8AbQ/6KtrX/fNt/wDGa+M6KAPsz/h4X+2h/wBFW1r/AL5tv/jNH/Dwv9tD/oq2tf8AfNt/8Zr4zooA+zP+Hhf7aH/RVta/75tv/jNH/Dwv9tD/AKKtrX/fNt/8Zr4zooA+zP8Ah4X+2h/0VbWv++bb/wCM0f8ADwv9tD/oq2tf9823/wAZr4zooA+zP+Hhf7aH/RVta/75tv8A4zR/w8L/AG0P+ira1/3zbf8AxmvjOigD7M/4eF/tof8ARVta/wC+bb/4zR/w8L/bQ/6KtrX/AHzbf/Ga+M6KAP6tv+CUnxr+Kfxx+CnizxH8WPEV14k1Kx8UyWVvcXYQPHbiytZBGPLRBje7HkZya/Uavxn/AOCJv/JvXjf/ALHOX/032dfsxQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfxn/APBPT/k9D4U/9hpv/Saav7MKACiiigAooooAKKKKACiiigAooooAKKKKAP4A6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfwq/BT4r638Dvin4d+LHhy0tb7UvDd0bu3t70ObeRzG0eJBGyPjDnowOa/Ub/h9l+0L/ANCR4M/79ah/8m0Af0yUV/M3/wAPsv2hf+hI8Gf9+tQ/+TaP+H2X7Qv/AEJHgz/v1qH/AMm0Af0yUV/M3/w+y/aF/wChI8Gf9+tQ/wDk2j/h9l+0L/0JHgz/AL9ah/8AJtAH9MlFfzN/8Psv2hf+hI8Gf9+tQ/8Ak2j/AIfZftC/9CR4M/79ah/8m0Af0yUV/M3/AMPsv2hf+hI8Gf8AfrUP/k2j/h9l+0L/ANCR4M/79ah/8m0Af0yUV/M3/wAPsv2hf+hI8Gf9+tQ/+TaP+H2X7Qv/AEJHgz/v1qH/AMm0Af0yUV/M3/w+y/aF/wChI8Gf9+tQ/wDk2j/h9l+0L/0JHgz/AL9ah/8AJtAH4z0V/TJ/w5N/Z6/6Hfxn/wB/dP8A/kKj/hyb+z1/0O/jP/v7p/8A8hUAfzN0V/TJ/wAOTf2ev+h38Z/9/dP/APkKj/hyb+z1/wBDv4z/AO/un/8AyFQB/M3RX9Mn/Dk39nr/AKHfxn/390//AOQqP+HJv7PX/Q7+M/8Av7p//wAhUAfzN0V/TJ/w5N/Z6/6Hfxn/AN/dP/8AkKj/AIcm/s9f9Dv4z/7+6f8A/IVAH8zdFf0yf8OTf2ev+h38Z/8Af3T/AP5Co/4cm/s9f9Dv4z/7+6f/APIVAH8zdFf0yf8ADk39nr/od/Gf/f3T/wD5Co/4cm/s9f8AQ7+M/wDv7p//AMhUAfzN0V/TJ/w5N/Z6/wCh38Z/9/dP/wDkKvwV/ag+FGifA74++M/hP4cu7q+03w3fi0t7i9KG4kQxRyZkMaomcueigYoA8FooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/AOxzl/8ATfZ1+zFfjP8A8ETf+TevG/8A2Ocv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/v8ooooAKKKKACiiigAooooAKKKKACiiigAr+M//goX/wAnofFb/sNL/wCk0Nf2YV/Gf/wUL/5PQ+K3/YaX/wBJoaAPjOiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP7/KKKKACiiigAooooAKKKKACiiigAooooAK/jP/4KF/8AJ6HxW/7DS/8ApNDX9mFfxn/8FC/+T0Pit/2Gl/8ASaGgD4zooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+/yiiigAooooAKKKKACiiigAooooAKKKKACv4z/+Chf/ACeh8Vv+w0v/AKTQ1/ZhX8Z//BQv/k9D4rf9hpf/AEmhoA+M6KKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/v8ooooAKKKKACiiigAooooAKKKKACiiigAr+M//goX/wAnofFb/sNL/wCk0Nf2YV/Gf/wUL/5PQ+K3/YaX/wBJoaAPjOiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP7/KKKKACiiigAooooAKKKKACiiigAooooAK/jP/4KF/8AJ6HxW/7DS/8ApNDX9mFfxn/8FC/+T0Pit/2Gl/8ASaGgD4zooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+/yiiigAooooAKKKKACiiigAooooAKKKKACv4z/+Chf/ACeh8Vv+w0v/AKTQ1/ZhX8Z//BQv/k9D4rf9hpf/AEmhoA+M6KKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD1L4KfCjW/jj8U/Dvwn8OXdrY6l4kujaW9xelxbxuI2kzIY1d8YQ9FJzX6jf8OTf2hf8Aod/Bn/f3UP8A5Cr4z/4J6f8AJ6Hwp/7DTf8ApNNX9mFAH8zf/Dk39oX/AKHfwZ/391D/AOQqP+HJv7Qv/Q7+DP8Av7qH/wAhV/TJRQB/M3/w5N/aF/6HfwZ/391D/wCQqP8Ahyb+0L/0O/gz/v7qH/yFX9MlFAH8zf8Aw5N/aF/6HfwZ/wB/dQ/+QqP+HJv7Qv8A0O/gz/v7qH/yFX9MlFAH8zf/AA5N/aF/6HfwZ/391D/5Co/4cm/tC/8AQ7+DP+/uof8AyFX9MlFAH8zf/Dk39oX/AKHfwZ/391D/AOQqP+HJv7Qv/Q7+DP8Av7qH/wAhV/TJRQB/M3/w5N/aF/6HfwZ/391D/wCQqP8Ahyb+0L/0O/gz/v7qH/yFX9MlFAH4z/8AD7L9nr/oSPGf/frT/wD5No/4fZfs9f8AQkeM/wDv1p//AMm1/M3RQB/TJ/w+y/Z6/wChI8Z/9+tP/wDk2j/h9l+z1/0JHjP/AL9af/8AJtfzN0UAf0yf8Psv2ev+hI8Z/wDfrT//AJNo/wCH2X7PX/QkeM/+/Wn/APybX8zdFAH9Mn/D7L9nr/oSPGf/AH60/wD+TaP+H2X7PX/QkeM/+/Wn/wDybX8zdFAH9Mn/AA+y/Z6/6Ejxn/360/8A+TaP+H2X7PX/AEJHjP8A79af/wDJtfzN0UAf0yf8Psv2ev8AoSPGf/frT/8A5No/4fZfs9f9CR4z/wC/Wn//ACbX8zdFAH9Mn/D7L9nr/oSPGf8A360//wCTa/BX9qD4r6J8cfj74z+LHhy0urHTfEl+Lu3t70ILiNBFHHiQRs6Zyh6MRivBaKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/ACb143/7HOX/ANN9nX7MV+M//BE3/k3rxv8A9jnL/wCm+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfxn/APBPT/k9D4U/9hpv/Saav7MKACiiigAooooAKKKKACiiigAooooAKKKKAP4A6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+XP/BVv4KfFP44/BTwn4c+E/h268SalY+KY724t7QoHjtxZXUZkPmOgxvdRwc5NAH8pNFfZn/DvT9tD/olOtf99W3/AMeo/wCHen7aH/RKda/76tv/AI9QB8Z0V9mf8O9P20P+iU61/wB9W3/x6j/h3p+2h/0SnWv++rb/AOPUAfGdFfZn/DvT9tD/AKJTrX/fVt/8eo/4d6ftof8ARKda/wC+rb/49QB8Z0V9mf8ADvT9tD/olOtf99W3/wAeo/4d6ftof9Ep1r/vq2/+PUAfGdFfZn/DvT9tD/olOtf99W3/AMeo/wCHen7aH/RKda/76tv/AI9QB8Z0V9mf8O9P20P+iU61/wB9W3/x6j/h3p+2h/0SnWv++rb/AOPUAH/BPT/k9D4U/wDYab/0mmr+zCv5cv2Kv2Kv2pvhz+1N8OvG3jb4dappOh6TqjT3t7O0BjgjMEq7m2ys2NzAcA9a/qNoAKKKKACiiigAooooAKKKKACiiigAooooA/gDor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD9mP+CJv/JvXjf8A7HOX/wBN9nX7MV+XP/BKT4KfFP4HfBTxZ4c+LHh268N6lfeKZL23t7soXktzZWsYkHlu4xvRhyc5FfqNQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf/9L9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//T/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9b9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9H9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9T9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//V/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9f9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//Q/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/2Q==\"/>\n</defs>\n</svg>\n`;\n\n//#endregion\n//#region src/plugins/open-api/index.ts\nconst getHTML = (apiReference, theme, nonce) => {\n\tconst nonceAttr = nonce ? `nonce=\"${nonce}\"` : \"\";\n\treturn `<!doctype html>\n<html>\n  <head>\n    <title>Scalar API Reference</title>\n    <meta charset=\"utf-8\" />\n    <meta\n      name=\"viewport\"\n      content=\"width=device-width, initial-scale=1\" />\n  </head>\n  <body>\n    <script\n      id=\"api-reference\"\n      type=\"application/json\">\n    ${JSON.stringify(apiReference)}\n    <\\/script>\n\t <script ${nonceAttr}>\n      var configuration = {\n\t  \tfavicon: \"data:image/svg+xml;utf8,${encodeURIComponent(logo)}\",\n\t   \ttheme: \"${theme || \"default\"}\",\n        metaData: {\n\t\t\ttitle: \"Better Auth API\",\n\t\t\tdescription: \"API Reference for your Better Auth Instance\",\n\t\t}\n      }\n\n      document.getElementById('api-reference').dataset.configuration =\n        JSON.stringify(configuration)\n    <\\/script>\n\t  <script src=\"https://cdn.jsdelivr.net/npm/@scalar/api-reference\" ${nonceAttr}><\\/script>\n  </body>\n</html>`;\n};\nconst openAPI = (options) => {\n\tconst path = options?.path ?? \"/reference\";\n\treturn {\n\t\tid: \"open-api\",\n\t\tendpoints: {\n\t\t\tgenerateOpenAPISchema: createAuthEndpoint(\"/open-api/generate-schema\", { method: \"GET\" }, async (ctx) => {\n\t\t\t\tconst schema = await generator(ctx.context, ctx.context.options);\n\t\t\t\treturn ctx.json(schema);\n\t\t\t}),\n\t\t\topenAPIReference: createAuthEndpoint(path, {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tmetadata: { isAction: false }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (options?.disableDefaultReference) throw new APIError(\"NOT_FOUND\");\n\t\t\t\tconst schema = await generator(ctx.context, ctx.context.options);\n\t\t\t\treturn new Response(getHTML(schema, options?.theme, options?.nonce), { headers: { \"Content-Type\": \"text/html\" } });\n\t\t\t})\n\t\t}\n\t};\n};\n\n//#endregion\nexport { openAPI as t };","import { t as mergeSchema } from \"./schema-Bb7wzeK_.mjs\";\nimport { r as getOrigin } from \"./url-CB8xCwz-.mjs\";\nimport { t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport { c as setSessionCookie } from \"./cookies-D72PbWdz.mjs\";\nimport * as z from \"zod\";\nimport { utf8ToBytes } from \"@noble/hashes/utils.js\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { keccak_256 } from \"@noble/hashes/sha3.js\";\n\n//#region src/utils/hashing.ts\n/**\n* TS implementation of ERC-55 (\"Mixed-case checksum address encoding\") using @noble/hashes\n* @param address - The address to convert to a checksum address\n* @returns The checksummed address\n*/\nfunction toChecksumAddress(address) {\n\taddress = address.toLowerCase().replace(\"0x\", \"\");\n\tconst hash = [...keccak_256(utf8ToBytes(address))].map((v) => v.toString(16).padStart(2, \"0\")).join(\"\");\n\tlet ret = \"0x\";\n\tfor (let i = 0; i < 40; i++) if (parseInt(hash[i], 16) >= 8) ret += address[i].toUpperCase();\n\telse ret += address[i];\n\treturn ret;\n}\n\n//#endregion\n//#region src/plugins/siwe/schema.ts\nconst schema = { walletAddress: { fields: {\n\tuserId: {\n\t\ttype: \"string\",\n\t\treferences: {\n\t\t\tmodel: \"user\",\n\t\t\tfield: \"id\"\n\t\t},\n\t\trequired: true,\n\t\tindex: true\n\t},\n\taddress: {\n\t\ttype: \"string\",\n\t\trequired: true\n\t},\n\tchainId: {\n\t\ttype: \"number\",\n\t\trequired: true\n\t},\n\tisPrimary: {\n\t\ttype: \"boolean\",\n\t\tdefaultValue: false\n\t},\n\tcreatedAt: {\n\t\ttype: \"date\",\n\t\trequired: true\n\t}\n} } };\n\n//#endregion\n//#region src/plugins/siwe/index.ts\nconst siwe = (options) => ({\n\tid: \"siwe\",\n\tschema: mergeSchema(schema, options?.schema),\n\tendpoints: {\n\t\tgetSiweNonce: createAuthEndpoint(\"/siwe/nonce\", {\n\t\t\tmethod: \"POST\",\n\t\t\tbody: z.object({\n\t\t\t\twalletAddress: z.string().regex(/^0[xX][a-fA-F0-9]{40}$/i).length(42),\n\t\t\t\tchainId: z.number().int().positive().max(2147483647).optional().default(1)\n\t\t\t})\n\t\t}, async (ctx) => {\n\t\t\tconst { walletAddress: rawWalletAddress, chainId } = ctx.body;\n\t\t\tconst walletAddress = toChecksumAddress(rawWalletAddress);\n\t\t\tconst nonce = await options.getNonce();\n\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\tidentifier: `siwe:${walletAddress}:${chainId}`,\n\t\t\t\tvalue: nonce,\n\t\t\t\texpiresAt: new Date(Date.now() + 900 * 1e3)\n\t\t\t});\n\t\t\treturn ctx.json({ nonce });\n\t\t}),\n\t\tverifySiweMessage: createAuthEndpoint(\"/siwe/verify\", {\n\t\t\tmethod: \"POST\",\n\t\t\tbody: z.object({\n\t\t\t\tmessage: z.string().min(1),\n\t\t\t\tsignature: z.string().min(1),\n\t\t\t\twalletAddress: z.string().regex(/^0[xX][a-fA-F0-9]{40}$/i).length(42),\n\t\t\t\tchainId: z.number().int().positive().max(2147483647).optional().default(1),\n\t\t\t\temail: z.email().optional()\n\t\t\t}).refine((data) => options.anonymous !== false || !!data.email, {\n\t\t\t\tmessage: \"Email is required when the anonymous plugin option is disabled.\",\n\t\t\t\tpath: [\"email\"]\n\t\t\t}),\n\t\t\trequireRequest: true\n\t\t}, async (ctx) => {\n\t\t\tconst { message, signature, walletAddress: rawWalletAddress, chainId, email } = ctx.body;\n\t\t\tconst walletAddress = toChecksumAddress(rawWalletAddress);\n\t\t\tconst isAnon = options.anonymous ?? true;\n\t\t\tif (!isAnon && !email) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\tmessage: \"Email is required when anonymous is disabled.\",\n\t\t\t\tstatus: 400\n\t\t\t});\n\t\t\ttry {\n\t\t\t\tconst verification = await ctx.context.internalAdapter.findVerificationValue(`siwe:${walletAddress}:${chainId}`);\n\t\t\t\tif (!verification || /* @__PURE__ */ new Date() > verification.expiresAt) throw new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\tmessage: \"Unauthorized: Invalid or expired nonce\",\n\t\t\t\t\tstatus: 401,\n\t\t\t\t\tcode: \"UNAUTHORIZED_INVALID_OR_EXPIRED_NONCE\"\n\t\t\t\t});\n\t\t\t\tconst { value: nonce } = verification;\n\t\t\t\tif (!await options.verifyMessage({\n\t\t\t\t\tmessage,\n\t\t\t\t\tsignature,\n\t\t\t\t\taddress: walletAddress,\n\t\t\t\t\tchainId,\n\t\t\t\t\tcacao: {\n\t\t\t\t\t\th: { t: \"caip122\" },\n\t\t\t\t\t\tp: {\n\t\t\t\t\t\t\tdomain: options.domain,\n\t\t\t\t\t\t\taud: options.domain,\n\t\t\t\t\t\t\tnonce,\n\t\t\t\t\t\t\tiss: options.domain,\n\t\t\t\t\t\t\tversion: \"1\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\ts: {\n\t\t\t\t\t\t\tt: \"eip191\",\n\t\t\t\t\t\t\ts: signature\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})) throw new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\tmessage: \"Unauthorized: Invalid SIWE signature\",\n\t\t\t\t\tstatus: 401\n\t\t\t\t});\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verification.id);\n\t\t\t\tlet user = null;\n\t\t\t\tconst existingWalletAddress = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"walletAddress\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"address\",\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tvalue: walletAddress\n\t\t\t\t\t}, {\n\t\t\t\t\t\tfield: \"chainId\",\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tvalue: chainId\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (existingWalletAddress) user = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tvalue: existingWalletAddress.userId\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\telse {\n\t\t\t\t\tconst anyWalletAddress = await ctx.context.adapter.findOne({\n\t\t\t\t\t\tmodel: \"walletAddress\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"address\",\n\t\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\t\tvalue: walletAddress\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t\tif (anyWalletAddress) user = await ctx.context.adapter.findOne({\n\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\t\tvalue: anyWalletAddress.userId\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (!user) {\n\t\t\t\t\tconst domain = options.emailDomainName ?? getOrigin(ctx.context.baseURL);\n\t\t\t\t\tconst userEmail = !isAnon && email ? email : `${walletAddress}@${domain}`;\n\t\t\t\t\tconst { name, avatar } = await options.ensLookup?.({ walletAddress }) ?? {};\n\t\t\t\t\tuser = await ctx.context.internalAdapter.createUser({\n\t\t\t\t\t\tname: name ?? walletAddress,\n\t\t\t\t\t\temail: userEmail,\n\t\t\t\t\t\timage: avatar ?? \"\"\n\t\t\t\t\t});\n\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\tmodel: \"walletAddress\",\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\t\taddress: walletAddress,\n\t\t\t\t\t\t\tchainId,\n\t\t\t\t\t\t\tisPrimary: true,\n\t\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tawait ctx.context.internalAdapter.createAccount({\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\tproviderId: \"siwe\",\n\t\t\t\t\t\taccountId: `${walletAddress}:${chainId}`,\n\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t});\n\t\t\t\t} else if (!existingWalletAddress) {\n\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\tmodel: \"walletAddress\",\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\t\taddress: walletAddress,\n\t\t\t\t\t\t\tchainId,\n\t\t\t\t\t\t\tisPrimary: false,\n\t\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tawait ctx.context.internalAdapter.createAccount({\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\tproviderId: \"siwe\",\n\t\t\t\t\t\taccountId: `${walletAddress}:${chainId}`,\n\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(user.id);\n\t\t\t\tif (!session) throw new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\tmessage: \"Internal Server Error\",\n\t\t\t\t\tstatus: 500\n\t\t\t\t});\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser\n\t\t\t\t});\n\t\t\t\treturn ctx.json({\n\t\t\t\t\ttoken: session.token,\n\t\t\t\t\tsuccess: true,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\twalletAddress,\n\t\t\t\t\t\tchainId\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\tif (error instanceof APIError) throw error;\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\tmessage: \"Something went wrong. Please try again later.\",\n\t\t\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\t\t\tstatus: 401\n\t\t\t\t});\n\t\t\t}\n\t\t})\n\t}\n});\n\n//#endregion\nexport { siwe as t };","import \"../../get-model-name-D4DUV7S2.mjs\";\nimport \"../../utils-db7gNqd-.mjs\";\nimport \"../../crypto-CFUhAR9W.mjs\";\nimport \"../../misc-BwNc0MKr.mjs\";\nimport \"../../json-CnHxKYpj.mjs\";\nimport { t as createAdapterFactory } from \"../../adapter-factory-HF3JB9cT.mjs\";\nimport { logger } from \"@better-auth/core/env\";\nimport { BetterAuthError } from \"@better-auth/core/error\";\nimport { and, asc, count, desc, eq, gt, gte, inArray, like, lt, lte, ne, notInArray, or, sql } from \"drizzle-orm\";\n\n//#region src/adapters/drizzle-adapter/drizzle-adapter.ts\nconst drizzleAdapter = (db, config) => {\n\tlet lazyOptions = null;\n\tconst createCustomAdapter = (db$1) => ({ getFieldName, options }) => {\n\t\tfunction getSchema(model) {\n\t\t\tconst schema = config.schema || db$1._.fullSchema;\n\t\t\tif (!schema) throw new BetterAuthError(\"Drizzle adapter failed to initialize. Schema not found. Please provide a schema object in the adapter options object.\");\n\t\t\tconst schemaModel = schema[model];\n\t\t\tif (!schemaModel) throw new BetterAuthError(`[# Drizzle Adapter]: The model \"${model}\" was not found in the schema object. Please pass the schema directly to the adapter options.`);\n\t\t\treturn schemaModel;\n\t\t}\n\t\tconst withReturning = async (model, builder, data, where) => {\n\t\t\tif (config.provider !== \"mysql\") return (await builder.returning())[0];\n\t\t\tawait builder.execute();\n\t\t\tconst schemaModel = getSchema(model);\n\t\t\tconst builderVal = builder.config?.values;\n\t\t\tif (where?.length) {\n\t\t\t\tconst clause = convertWhereClause(where.map((w) => {\n\t\t\t\t\tif (data[w.field] !== void 0) return {\n\t\t\t\t\t\t...w,\n\t\t\t\t\t\tvalue: data[w.field]\n\t\t\t\t\t};\n\t\t\t\t\treturn w;\n\t\t\t\t}), model);\n\t\t\t\treturn (await db$1.select().from(schemaModel).where(...clause))[0];\n\t\t\t} else if (builderVal && builderVal[0]?.id?.value) {\n\t\t\t\tlet tId = builderVal[0]?.id?.value;\n\t\t\t\tif (!tId) tId = (await db$1.select({ id: sql`LAST_INSERT_ID()` }).from(schemaModel).orderBy(desc(schemaModel.id)).limit(1))[0].id;\n\t\t\t\treturn (await db$1.select().from(schemaModel).where(eq(schemaModel.id, tId)).limit(1).execute())[0];\n\t\t\t} else if (data.id) return (await db$1.select().from(schemaModel).where(eq(schemaModel.id, data.id)).limit(1).execute())[0];\n\t\t\telse {\n\t\t\t\tif (!(\"id\" in schemaModel)) throw new BetterAuthError(`The model \"${model}\" does not have an \"id\" field. Please use the \"id\" field as your primary key.`);\n\t\t\t\treturn (await db$1.select().from(schemaModel).orderBy(desc(schemaModel.id)).limit(1).execute())[0];\n\t\t\t}\n\t\t};\n\t\tfunction convertWhereClause(where, model) {\n\t\t\tconst schemaModel = getSchema(model);\n\t\t\tif (!where) return [];\n\t\t\tif (where.length === 1) {\n\t\t\t\tconst w = where[0];\n\t\t\t\tif (!w) return [];\n\t\t\t\tconst field = getFieldName({\n\t\t\t\t\tmodel,\n\t\t\t\t\tfield: w.field\n\t\t\t\t});\n\t\t\t\tif (!schemaModel[field]) throw new BetterAuthError(`The field \"${w.field}\" does not exist in the schema for the model \"${model}\". Please update your schema.`);\n\t\t\t\tif (w.operator === \"in\") {\n\t\t\t\t\tif (!Array.isArray(w.value)) throw new BetterAuthError(`The value for the field \"${w.field}\" must be an array when using the \"in\" operator.`);\n\t\t\t\t\treturn [inArray(schemaModel[field], w.value)];\n\t\t\t\t}\n\t\t\t\tif (w.operator === \"not_in\") {\n\t\t\t\t\tif (!Array.isArray(w.value)) throw new BetterAuthError(`The value for the field \"${w.field}\" must be an array when using the \"not_in\" operator.`);\n\t\t\t\t\treturn [notInArray(schemaModel[field], w.value)];\n\t\t\t\t}\n\t\t\t\tif (w.operator === \"contains\") return [like(schemaModel[field], `%${w.value}%`)];\n\t\t\t\tif (w.operator === \"starts_with\") return [like(schemaModel[field], `${w.value}%`)];\n\t\t\t\tif (w.operator === \"ends_with\") return [like(schemaModel[field], `%${w.value}`)];\n\t\t\t\tif (w.operator === \"lt\") return [lt(schemaModel[field], w.value)];\n\t\t\t\tif (w.operator === \"lte\") return [lte(schemaModel[field], w.value)];\n\t\t\t\tif (w.operator === \"ne\") return [ne(schemaModel[field], w.value)];\n\t\t\t\tif (w.operator === \"gt\") return [gt(schemaModel[field], w.value)];\n\t\t\t\tif (w.operator === \"gte\") return [gte(schemaModel[field], w.value)];\n\t\t\t\treturn [eq(schemaModel[field], w.value)];\n\t\t\t}\n\t\t\tconst andGroup = where.filter((w) => w.connector === \"AND\" || !w.connector);\n\t\t\tconst orGroup = where.filter((w) => w.connector === \"OR\");\n\t\t\tconst andClause = and(...andGroup.map((w) => {\n\t\t\t\tconst field = getFieldName({\n\t\t\t\t\tmodel,\n\t\t\t\t\tfield: w.field\n\t\t\t\t});\n\t\t\t\tif (w.operator === \"in\") {\n\t\t\t\t\tif (!Array.isArray(w.value)) throw new BetterAuthError(`The value for the field \"${w.field}\" must be an array when using the \"in\" operator.`);\n\t\t\t\t\treturn inArray(schemaModel[field], w.value);\n\t\t\t\t}\n\t\t\t\tif (w.operator === \"not_in\") {\n\t\t\t\t\tif (!Array.isArray(w.value)) throw new BetterAuthError(`The value for the field \"${w.field}\" must be an array when using the \"not_in\" operator.`);\n\t\t\t\t\treturn notInArray(schemaModel[field], w.value);\n\t\t\t\t}\n\t\t\t\tif (w.operator === \"contains\") return like(schemaModel[field], `%${w.value}%`);\n\t\t\t\tif (w.operator === \"starts_with\") return like(schemaModel[field], `${w.value}%`);\n\t\t\t\tif (w.operator === \"ends_with\") return like(schemaModel[field], `%${w.value}`);\n\t\t\t\tif (w.operator === \"lt\") return lt(schemaModel[field], w.value);\n\t\t\t\tif (w.operator === \"lte\") return lte(schemaModel[field], w.value);\n\t\t\t\tif (w.operator === \"gt\") return gt(schemaModel[field], w.value);\n\t\t\t\tif (w.operator === \"gte\") return gte(schemaModel[field], w.value);\n\t\t\t\tif (w.operator === \"ne\") return ne(schemaModel[field], w.value);\n\t\t\t\treturn eq(schemaModel[field], w.value);\n\t\t\t}));\n\t\t\tconst orClause = or(...orGroup.map((w) => {\n\t\t\t\tconst field = getFieldName({\n\t\t\t\t\tmodel,\n\t\t\t\t\tfield: w.field\n\t\t\t\t});\n\t\t\t\tif (w.operator === \"in\") {\n\t\t\t\t\tif (!Array.isArray(w.value)) throw new BetterAuthError(`The value for the field \"${w.field}\" must be an array when using the \"in\" operator.`);\n\t\t\t\t\treturn inArray(schemaModel[field], w.value);\n\t\t\t\t}\n\t\t\t\tif (w.operator === \"not_in\") {\n\t\t\t\t\tif (!Array.isArray(w.value)) throw new BetterAuthError(`The value for the field \"${w.field}\" must be an array when using the \"not_in\" operator.`);\n\t\t\t\t\treturn notInArray(schemaModel[field], w.value);\n\t\t\t\t}\n\t\t\t\tif (w.operator === \"contains\") return like(schemaModel[field], `%${w.value}%`);\n\t\t\t\tif (w.operator === \"starts_with\") return like(schemaModel[field], `${w.value}%`);\n\t\t\t\tif (w.operator === \"ends_with\") return like(schemaModel[field], `%${w.value}`);\n\t\t\t\tif (w.operator === \"lt\") return lt(schemaModel[field], w.value);\n\t\t\t\tif (w.operator === \"lte\") return lte(schemaModel[field], w.value);\n\t\t\t\tif (w.operator === \"gt\") return gt(schemaModel[field], w.value);\n\t\t\t\tif (w.operator === \"gte\") return gte(schemaModel[field], w.value);\n\t\t\t\tif (w.operator === \"ne\") return ne(schemaModel[field], w.value);\n\t\t\t\treturn eq(schemaModel[field], w.value);\n\t\t\t}));\n\t\t\tconst clause = [];\n\t\t\tif (andGroup.length) clause.push(andClause);\n\t\t\tif (orGroup.length) clause.push(orClause);\n\t\t\treturn clause;\n\t\t}\n\t\tfunction checkMissingFields(schema, model, values) {\n\t\t\tif (!schema) throw new BetterAuthError(\"Drizzle adapter failed to initialize. Drizzle Schema not found. Please provide a schema object in the adapter options object.\");\n\t\t\tfor (const key in values) if (!schema[key]) throw new BetterAuthError(`The field \"${key}\" does not exist in the \"${model}\" Drizzle schema. Please update your drizzle schema or re-generate using \"npx @better-auth/cli@latest generate\".`);\n\t\t}\n\t\treturn {\n\t\t\tasync create({ model, data: values }) {\n\t\t\t\tconst schemaModel = getSchema(model);\n\t\t\t\tcheckMissingFields(schemaModel, model, values);\n\t\t\t\treturn await withReturning(model, db$1.insert(schemaModel).values(values), values);\n\t\t\t},\n\t\t\tasync findOne({ model, where, join }) {\n\t\t\t\tconst schemaModel = getSchema(model);\n\t\t\t\tconst clause = convertWhereClause(where, model);\n\t\t\t\tif (options.experimental?.joins) if (!db$1.query || !db$1.query[model]) {\n\t\t\t\t\tlogger.error(`[# Drizzle Adapter]: The model \"${model}\" was not found in the query object. Please update your Drizzle schema to include relations or re-generate using \"npx @better-auth/cli@latest generate\".`);\n\t\t\t\t\tlogger.info(\"Falling back to regular query\");\n\t\t\t\t} else {\n\t\t\t\t\tlet includes;\n\t\t\t\t\tconst pluralJoinResults = [];\n\t\t\t\t\tif (join) {\n\t\t\t\t\t\tincludes = {};\n\t\t\t\t\t\tconst joinEntries = Object.entries(join);\n\t\t\t\t\t\tfor (const [model$1, joinAttr] of joinEntries) {\n\t\t\t\t\t\t\tconst limit = joinAttr.limit ?? options.advanced?.database?.defaultFindManyLimit ?? 100;\n\t\t\t\t\t\t\tconst isUnique = joinAttr.relation === \"one-to-one\";\n\t\t\t\t\t\t\tconst pluralSuffix = isUnique || config.usePlural ? \"\" : \"s\";\n\t\t\t\t\t\t\tincludes[`${model$1}${pluralSuffix}`] = isUnique ? true : { limit };\n\t\t\t\t\t\t\tif (!isUnique) pluralJoinResults.push(`${model$1}${pluralSuffix}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconst res$1 = await db$1.query[model].findFirst({\n\t\t\t\t\t\twhere: clause[0],\n\t\t\t\t\t\twith: includes\n\t\t\t\t\t});\n\t\t\t\t\tif (res$1) for (const pluralJoinResult of pluralJoinResults) {\n\t\t\t\t\t\tlet singularKey = !config.usePlural ? pluralJoinResult.slice(0, -1) : pluralJoinResult;\n\t\t\t\t\t\tres$1[singularKey] = res$1[pluralJoinResult];\n\t\t\t\t\t\tif (pluralJoinResult !== singularKey) delete res$1[pluralJoinResult];\n\t\t\t\t\t}\n\t\t\t\t\treturn res$1;\n\t\t\t\t}\n\t\t\t\tconst res = await db$1.select().from(schemaModel).where(...clause);\n\t\t\t\tif (!res.length) return null;\n\t\t\t\treturn res[0];\n\t\t\t},\n\t\t\tasync findMany({ model, where, sortBy, limit, offset, join }) {\n\t\t\t\tconst schemaModel = getSchema(model);\n\t\t\t\tconst clause = where ? convertWhereClause(where, model) : [];\n\t\t\t\tconst sortFn = sortBy?.direction === \"desc\" ? desc : asc;\n\t\t\t\tif (options.experimental?.joins) if (!db$1.query[model]) {\n\t\t\t\t\tlogger.error(`[# Drizzle Adapter]: The model \"${model}\" was not found in the query object. Please update your Drizzle schema to include relations or re-generate using \"npx @better-auth/cli@latest generate\".`);\n\t\t\t\t\tlogger.info(\"Falling back to regular query\");\n\t\t\t\t} else {\n\t\t\t\t\tlet includes;\n\t\t\t\t\tconst pluralJoinResults = [];\n\t\t\t\t\tif (join) {\n\t\t\t\t\t\tincludes = {};\n\t\t\t\t\t\tconst joinEntries = Object.entries(join);\n\t\t\t\t\t\tfor (const [model$1, joinAttr] of joinEntries) {\n\t\t\t\t\t\t\tconst isUnique = joinAttr.relation === \"one-to-one\";\n\t\t\t\t\t\t\tconst limit$1 = joinAttr.limit ?? options.advanced?.database?.defaultFindManyLimit ?? 100;\n\t\t\t\t\t\t\tlet pluralSuffix = isUnique || config.usePlural ? \"\" : \"s\";\n\t\t\t\t\t\t\tincludes[`${model$1}${pluralSuffix}`] = isUnique ? true : { limit: limit$1 };\n\t\t\t\t\t\t\tif (!isUnique) pluralJoinResults.push(`${model$1}${pluralSuffix}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tlet orderBy = void 0;\n\t\t\t\t\tif (sortBy?.field) orderBy = [sortFn(schemaModel[getFieldName({\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\tfield: sortBy?.field\n\t\t\t\t\t})])];\n\t\t\t\t\tlet res = await db$1.query[model].findMany({\n\t\t\t\t\t\twhere: clause[0],\n\t\t\t\t\t\twith: includes,\n\t\t\t\t\t\tlimit: limit ?? 100,\n\t\t\t\t\t\toffset: offset ?? 0,\n\t\t\t\t\t\torderBy\n\t\t\t\t\t});\n\t\t\t\t\tif (res) for (const item of res) for (const pluralJoinResult of pluralJoinResults) {\n\t\t\t\t\t\tconst singularKey = !config.usePlural ? pluralJoinResult.slice(0, -1) : pluralJoinResult;\n\t\t\t\t\t\tif (singularKey === pluralJoinResult) continue;\n\t\t\t\t\t\titem[singularKey] = item[pluralJoinResult];\n\t\t\t\t\t\tdelete item[pluralJoinResult];\n\t\t\t\t\t}\n\t\t\t\t\treturn res;\n\t\t\t\t}\n\t\t\t\tlet builder = db$1.select().from(schemaModel);\n\t\t\t\tconst effectiveLimit = limit;\n\t\t\t\tconst effectiveOffset = offset;\n\t\t\t\tif (typeof effectiveLimit !== \"undefined\") builder = builder.limit(effectiveLimit);\n\t\t\t\tif (typeof effectiveOffset !== \"undefined\") builder = builder.offset(effectiveOffset);\n\t\t\t\tif (sortBy?.field) builder = builder.orderBy(sortFn(schemaModel[getFieldName({\n\t\t\t\t\tmodel,\n\t\t\t\t\tfield: sortBy?.field\n\t\t\t\t})]));\n\t\t\t\treturn await builder.where(...clause);\n\t\t\t},\n\t\t\tasync count({ model, where }) {\n\t\t\t\tconst schemaModel = getSchema(model);\n\t\t\t\tconst clause = where ? convertWhereClause(where, model) : [];\n\t\t\t\treturn (await db$1.select({ count: count() }).from(schemaModel).where(...clause))[0].count;\n\t\t\t},\n\t\t\tasync update({ model, where, update: values }) {\n\t\t\t\tconst schemaModel = getSchema(model);\n\t\t\t\tconst clause = convertWhereClause(where, model);\n\t\t\t\treturn await withReturning(model, db$1.update(schemaModel).set(values).where(...clause), values, where);\n\t\t\t},\n\t\t\tasync updateMany({ model, where, update: values }) {\n\t\t\t\tconst schemaModel = getSchema(model);\n\t\t\t\tconst clause = convertWhereClause(where, model);\n\t\t\t\treturn await db$1.update(schemaModel).set(values).where(...clause);\n\t\t\t},\n\t\t\tasync delete({ model, where }) {\n\t\t\t\tconst schemaModel = getSchema(model);\n\t\t\t\tconst clause = convertWhereClause(where, model);\n\t\t\t\treturn await db$1.delete(schemaModel).where(...clause);\n\t\t\t},\n\t\t\tasync deleteMany({ model, where }) {\n\t\t\t\tconst schemaModel = getSchema(model);\n\t\t\t\tconst clause = convertWhereClause(where, model);\n\t\t\t\tconst res = await db$1.delete(schemaModel).where(...clause);\n\t\t\t\tlet count$1 = 0;\n\t\t\t\tif (res && \"rowCount\" in res) count$1 = res.rowCount;\n\t\t\t\telse if (Array.isArray(res)) count$1 = res.length;\n\t\t\t\telse if (res && (\"affectedRows\" in res || \"rowsAffected\" in res || \"changes\" in res)) count$1 = res.affectedRows ?? res.rowsAffected ?? res.changes;\n\t\t\t\tif (typeof count$1 !== \"number\") logger.error(\"[Drizzle Adapter] The result of the deleteMany operation is not a number. This is likely a bug in the adapter. Please report this issue to the Better Auth team.\", {\n\t\t\t\t\tres,\n\t\t\t\t\tmodel,\n\t\t\t\t\twhere\n\t\t\t\t});\n\t\t\t\treturn count$1;\n\t\t\t},\n\t\t\toptions: config\n\t\t};\n\t};\n\tlet adapterOptions = null;\n\tadapterOptions = {\n\t\tconfig: {\n\t\t\tadapterId: \"drizzle\",\n\t\t\tadapterName: \"Drizzle Adapter\",\n\t\t\tusePlural: config.usePlural ?? false,\n\t\t\tdebugLogs: config.debugLogs ?? false,\n\t\t\tsupportsUUIDs: config.provider === \"pg\" ? true : false,\n\t\t\ttransaction: config.transaction ?? false ? (cb) => db.transaction((tx) => {\n\t\t\t\treturn cb(createAdapterFactory({\n\t\t\t\t\tconfig: adapterOptions.config,\n\t\t\t\t\tadapter: createCustomAdapter(tx)\n\t\t\t\t})(lazyOptions));\n\t\t\t}) : false\n\t\t},\n\t\tadapter: createCustomAdapter(db)\n\t};\n\tconst adapter = createAdapterFactory(adapterOptions);\n\treturn (options) => {\n\t\tlazyOptions = options;\n\t\treturn adapter(options);\n\t};\n};\n\n//#endregion\nexport { drizzleAdapter };","/**\n * Based on https://github.com/facebook/react/blob/d4e78c42a94be027b4dc7ed2659a5fddfbf9bd4e/packages/react/src/ReactFetch.js\n */ import * as React from 'react';\nimport { cloneResponse } from './clone-response';\nimport { InvariantError } from '../../shared/lib/invariant-error';\nconst simpleCacheKey = '[\"GET\",[],null,\"follow\",null,null,null,null]' // generateCacheKey(new Request('https://blank'));\n;\n// Headers that should not affect deduplication\n// traceparent and tracestate are used for distributed tracing and should not affect cache keys\nconst headersToExcludeInCacheKey = new Set([\n    'traceparent',\n    'tracestate'\n]);\nfunction generateCacheKey(request) {\n    // We pick the fields that goes into the key used to dedupe requests.\n    // We don't include the `cache` field, because we end up using whatever\n    // caching resulted from the first request.\n    // Notably we currently don't consider non-standard (or future) options.\n    // This might not be safe. TODO: warn for non-standard extensions differing.\n    // IF YOU CHANGE THIS UPDATE THE simpleCacheKey ABOVE.\n    const filteredHeaders = Array.from(request.headers.entries()).filter(([key])=>!headersToExcludeInCacheKey.has(key.toLowerCase()));\n    return JSON.stringify([\n        request.method,\n        filteredHeaders,\n        request.mode,\n        request.redirect,\n        request.credentials,\n        request.referrer,\n        request.referrerPolicy,\n        request.integrity\n    ]);\n}\nexport function createDedupeFetch(originalFetch) {\n    const getCacheEntries = React.cache(// eslint-disable-next-line @typescript-eslint/no-unused-vars -- url is the cache key\n    (url)=>[]);\n    return function dedupeFetch(resource, options) {\n        if (options && options.signal) {\n            // If we're passed a signal, then we assume that\n            // someone else controls the lifetime of this object and opts out of\n            // caching. It's effectively the opt-out mechanism.\n            // Ideally we should be able to check this on the Request but\n            // it always gets initialized with its own signal so we don't\n            // know if it's supposed to override - unless we also override the\n            // Request constructor.\n            return originalFetch(resource, options);\n        }\n        // Normalize the Request\n        let url;\n        let cacheKey;\n        if (typeof resource === 'string' && !options) {\n            // Fast path.\n            cacheKey = simpleCacheKey;\n            url = resource;\n        } else {\n            // Normalize the request.\n            // if resource is not a string or a URL (its an instance of Request)\n            // then do not instantiate a new Request but instead\n            // reuse the request as to not disturb the body in the event it's a ReadableStream.\n            const request = typeof resource === 'string' || resource instanceof URL ? new Request(resource, options) : resource;\n            if (request.method !== 'GET' && request.method !== 'HEAD' || request.keepalive) {\n                // We currently don't dedupe requests that might have side-effects. Those\n                // have to be explicitly cached. We assume that the request doesn't have a\n                // body if it's GET or HEAD.\n                // keepalive gets treated the same as if you passed a custom cache signal.\n                return originalFetch(resource, options);\n            }\n            cacheKey = generateCacheKey(request);\n            url = request.url;\n        }\n        const cacheEntries = getCacheEntries(url);\n        for(let i = 0, j = cacheEntries.length; i < j; i += 1){\n            const [key, promise] = cacheEntries[i];\n            if (key === cacheKey) {\n                return promise.then(()=>{\n                    const response = cacheEntries[i][2];\n                    if (!response) throw Object.defineProperty(new InvariantError('No cached response'), \"__NEXT_ERROR_CODE\", {\n                        value: \"E579\",\n                        enumerable: false,\n                        configurable: true\n                    });\n                    // We're cloning the response using this utility because there exists\n                    // a bug in the undici library around response cloning. See the\n                    // following pull request for more details:\n                    // https://github.com/vercel/next.js/pull/73274\n                    const [cloned1, cloned2] = cloneResponse(response);\n                    cacheEntries[i][2] = cloned2;\n                    return cloned1;\n                });\n            }\n        }\n        // We pass the original arguments here in case normalizing the Request\n        // doesn't include all the options in this environment.\n        const promise = originalFetch(resource, options);\n        const entry = [\n            cacheKey,\n            promise,\n            null\n        ];\n        cacheEntries.push(entry);\n        return promise.then((response)=>{\n            // We're cloning the response using this utility because there exists\n            // a bug in the undici library around response cloning. See the\n            // following pull request for more details:\n            // https://github.com/vercel/next.js/pull/73274\n            const [cloned1, cloned2] = cloneResponse(response);\n            entry[2] = cloned2;\n            return cloned1;\n        });\n    };\n}\n\n//# sourceMappingURL=dedupe-fetch.js.map","import { entityKind, is } from \"../../entity.js\";\nimport { PgDialect } from \"../dialect.js\";\nimport { SelectionProxyHandler } from \"../../selection-proxy.js\";\nimport { WithSubquery } from \"../../subquery.js\";\nimport { PgSelectBuilder } from \"./select.js\";\nclass QueryBuilder {\n  static [entityKind] = \"PgQueryBuilder\";\n  dialect;\n  dialectConfig;\n  constructor(dialect) {\n    this.dialect = is(dialect, PgDialect) ? dialect : void 0;\n    this.dialectConfig = is(dialect, PgDialect) ? void 0 : dialect;\n  }\n  $with = (alias, selection) => {\n    const queryBuilder = this;\n    const as = (qb) => {\n      if (typeof qb === \"function\") {\n        qb = qb(queryBuilder);\n      }\n      return new Proxy(\n        new WithSubquery(\n          qb.getSQL(),\n          selection ?? (\"getSelectedFields\" in qb ? qb.getSelectedFields() ?? {} : {}),\n          alias,\n          true\n        ),\n        new SelectionProxyHandler({ alias, sqlAliasedBehavior: \"alias\", sqlBehavior: \"error\" })\n      );\n    };\n    return { as };\n  };\n  with(...queries) {\n    const self = this;\n    function select(fields) {\n      return new PgSelectBuilder({\n        fields: fields ?? void 0,\n        session: void 0,\n        dialect: self.getDialect(),\n        withList: queries\n      });\n    }\n    function selectDistinct(fields) {\n      return new PgSelectBuilder({\n        fields: fields ?? void 0,\n        session: void 0,\n        dialect: self.getDialect(),\n        distinct: true\n      });\n    }\n    function selectDistinctOn(on, fields) {\n      return new PgSelectBuilder({\n        fields: fields ?? void 0,\n        session: void 0,\n        dialect: self.getDialect(),\n        distinct: { on }\n      });\n    }\n    return { select, selectDistinct, selectDistinctOn };\n  }\n  select(fields) {\n    return new PgSelectBuilder({\n      fields: fields ?? void 0,\n      session: void 0,\n      dialect: this.getDialect()\n    });\n  }\n  selectDistinct(fields) {\n    return new PgSelectBuilder({\n      fields: fields ?? void 0,\n      session: void 0,\n      dialect: this.getDialect(),\n      distinct: true\n    });\n  }\n  selectDistinctOn(on, fields) {\n    return new PgSelectBuilder({\n      fields: fields ?? void 0,\n      session: void 0,\n      dialect: this.getDialect(),\n      distinct: { on }\n    });\n  }\n  // Lazy load dialect to avoid circular dependency\n  getDialect() {\n    if (!this.dialect) {\n      this.dialect = new PgDialect(this.dialectConfig);\n    }\n    return this.dialect;\n  }\n}\nexport {\n  QueryBuilder\n};\n//# sourceMappingURL=query-builder.js.map","import { Column } from \"./column.js\";\nimport { entityKind, is } from \"./entity.js\";\nimport { SQL, sql } from \"./sql/sql.js\";\nimport { Table } from \"./table.js\";\nimport { ViewBaseConfig } from \"./view-common.js\";\nclass ColumnAliasProxyHandler {\n  constructor(table) {\n    this.table = table;\n  }\n  static [entityKind] = \"ColumnAliasProxyHandler\";\n  get(columnObj, prop) {\n    if (prop === \"table\") {\n      return this.table;\n    }\n    return columnObj[prop];\n  }\n}\nclass TableAliasProxyHandler {\n  constructor(alias, replaceOriginalName) {\n    this.alias = alias;\n    this.replaceOriginalName = replaceOriginalName;\n  }\n  static [entityKind] = \"TableAliasProxyHandler\";\n  get(target, prop) {\n    if (prop === Table.Symbol.IsAlias) {\n      return true;\n    }\n    if (prop === Table.Symbol.Name) {\n      return this.alias;\n    }\n    if (this.replaceOriginalName && prop === Table.Symbol.OriginalName) {\n      return this.alias;\n    }\n    if (prop === ViewBaseConfig) {\n      return {\n        ...target[ViewBaseConfig],\n        name: this.alias,\n        isAlias: true\n      };\n    }\n    if (prop === Table.Symbol.Columns) {\n      const columns = target[Table.Symbol.Columns];\n      if (!columns) {\n        return columns;\n      }\n      const proxiedColumns = {};\n      Object.keys(columns).map((key) => {\n        proxiedColumns[key] = new Proxy(\n          columns[key],\n          new ColumnAliasProxyHandler(new Proxy(target, this))\n        );\n      });\n      return proxiedColumns;\n    }\n    const value = target[prop];\n    if (is(value, Column)) {\n      return new Proxy(value, new ColumnAliasProxyHandler(new Proxy(target, this)));\n    }\n    return value;\n  }\n}\nclass RelationTableAliasProxyHandler {\n  constructor(alias) {\n    this.alias = alias;\n  }\n  static [entityKind] = \"RelationTableAliasProxyHandler\";\n  get(target, prop) {\n    if (prop === \"sourceTable\") {\n      return aliasedTable(target.sourceTable, this.alias);\n    }\n    return target[prop];\n  }\n}\nfunction aliasedTable(table, tableAlias) {\n  return new Proxy(table, new TableAliasProxyHandler(tableAlias, false));\n}\nfunction aliasedRelation(relation, tableAlias) {\n  return new Proxy(relation, new RelationTableAliasProxyHandler(tableAlias));\n}\nfunction aliasedTableColumn(column, tableAlias) {\n  return new Proxy(\n    column,\n    new ColumnAliasProxyHandler(new Proxy(column.table, new TableAliasProxyHandler(tableAlias, false)))\n  );\n}\nfunction mapColumnsInAliasedSQLToAlias(query, alias) {\n  return new SQL.Aliased(mapColumnsInSQLToAlias(query.sql, alias), query.fieldAlias);\n}\nfunction mapColumnsInSQLToAlias(query, alias) {\n  return sql.join(query.queryChunks.map((c) => {\n    if (is(c, Column)) {\n      return aliasedTableColumn(c, alias);\n    }\n    if (is(c, SQL)) {\n      return mapColumnsInSQLToAlias(c, alias);\n    }\n    if (is(c, SQL.Aliased)) {\n      return mapColumnsInAliasedSQLToAlias(c, alias);\n    }\n    return c;\n  }));\n}\nexport {\n  ColumnAliasProxyHandler,\n  RelationTableAliasProxyHandler,\n  TableAliasProxyHandler,\n  aliasedRelation,\n  aliasedTable,\n  aliasedTableColumn,\n  mapColumnsInAliasedSQLToAlias,\n  mapColumnsInSQLToAlias\n};\n//# sourceMappingURL=alias.js.map","import { n as getKyselyDatabaseType } from \"./dialect-D9ZUZA4J.mjs\";\nimport { t as getMigrations, u as getAdapter } from \"./get-migration-Bf0TuCzm.mjs\";\nimport { n as createAuthContext, t as createBetterAuth } from \"./base-CiRMFqet.mjs\";\nimport { BetterAuthError } from \"@better-auth/core/error\";\n\n//#region src/context/init.ts\nconst init = async (options) => {\n\tconst adapter = await getAdapter(options);\n\tconst getDatabaseType = (database) => getKyselyDatabaseType(database) || \"unknown\";\n\tconst ctx = await createAuthContext(adapter, options, getDatabaseType);\n\tctx.runMigrations = async function() {\n\t\tif (!options.database || \"updateMany\" in options.database) throw new BetterAuthError(\"Database is not provided or it's an adapter. Migrations are only supported with a database instance.\");\n\t\tconst { runMigrations } = await getMigrations(options);\n\t\tawait runMigrations();\n\t};\n\treturn ctx;\n};\n\n//#endregion\n//#region src/auth/auth.ts\n/**\n* Better Auth initializer for full mode (with Kysely)\n*\n* Check `minimal.ts` for minimal mode (without Kysely)\n*/\nconst betterAuth = (options) => {\n\treturn createBetterAuth(options, init);\n};\n\n//#endregion\nexport { betterAuth as t };","import { ResponseAbortedName, createAbortController } from './web/spec-extension/adapters/next-request';\nimport { DetachedPromise } from '../lib/detached-promise';\nimport { getTracer } from './lib/trace/tracer';\nimport { NextNodeServerSpan } from './lib/trace/constants';\nimport { getClientComponentLoaderMetrics } from './client-component-renderer-logger';\nexport function isAbortError(e) {\n    return (e == null ? void 0 : e.name) === 'AbortError' || (e == null ? void 0 : e.name) === ResponseAbortedName;\n}\nfunction createWriterFromResponse(res, waitUntilForEnd) {\n    let started = false;\n    // Create a promise that will resolve once the response has drained. See\n    // https://nodejs.org/api/stream.html#stream_event_drain\n    let drained = new DetachedPromise();\n    function onDrain() {\n        drained.resolve();\n    }\n    res.on('drain', onDrain);\n    // If the finish event fires, it means we shouldn't block and wait for the\n    // drain event.\n    res.once('close', ()=>{\n        res.off('drain', onDrain);\n        drained.resolve();\n    });\n    // Create a promise that will resolve once the response has finished. See\n    // https://nodejs.org/api/http.html#event-finish_1\n    const finished = new DetachedPromise();\n    res.once('finish', ()=>{\n        finished.resolve();\n    });\n    // Create a writable stream that will write to the response.\n    return new WritableStream({\n        write: async (chunk)=>{\n            // You'd think we'd want to use `start` instead of placing this in `write`\n            // but this ensures that we don't actually flush the headers until we've\n            // started writing chunks.\n            if (!started) {\n                started = true;\n                if ('performance' in globalThis && process.env.NEXT_OTEL_PERFORMANCE_PREFIX) {\n                    const metrics = getClientComponentLoaderMetrics();\n                    if (metrics) {\n                        performance.measure(`${process.env.NEXT_OTEL_PERFORMANCE_PREFIX}:next-client-component-loading`, {\n                            start: metrics.clientComponentLoadStart,\n                            end: metrics.clientComponentLoadStart + metrics.clientComponentLoadTimes\n                        });\n                    }\n                }\n                res.flushHeaders();\n                getTracer().trace(NextNodeServerSpan.startResponse, {\n                    spanName: 'start response'\n                }, ()=>undefined);\n            }\n            try {\n                const ok = res.write(chunk);\n                // Added by the `compression` middleware, this is a function that will\n                // flush the partially-compressed response to the client.\n                if ('flush' in res && typeof res.flush === 'function') {\n                    res.flush();\n                }\n                // If the write returns false, it means there's some backpressure, so\n                // wait until it's streamed before continuing.\n                if (!ok) {\n                    await drained.promise;\n                    // Reset the drained promise so that we can wait for the next drain event.\n                    drained = new DetachedPromise();\n                }\n            } catch (err) {\n                res.end();\n                throw Object.defineProperty(new Error('failed to write chunk to response', {\n                    cause: err\n                }), \"__NEXT_ERROR_CODE\", {\n                    value: \"E321\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n        },\n        abort: (err)=>{\n            if (res.writableFinished) return;\n            res.destroy(err);\n        },\n        close: async ()=>{\n            // if a waitUntil promise was passed, wait for it to resolve before\n            // ending the response.\n            if (waitUntilForEnd) {\n                await waitUntilForEnd;\n            }\n            if (res.writableFinished) return;\n            res.end();\n            return finished.promise;\n        }\n    });\n}\nexport async function pipeToNodeResponse(readable, res, waitUntilForEnd) {\n    try {\n        // If the response has already errored, then just return now.\n        const { errored, destroyed } = res;\n        if (errored || destroyed) return;\n        // Create a new AbortController so that we can abort the readable if the\n        // client disconnects.\n        const controller = createAbortController(res);\n        const writer = createWriterFromResponse(res, waitUntilForEnd);\n        await readable.pipeTo(writer, {\n            signal: controller.signal\n        });\n    } catch (err) {\n        // If this isn't related to an abort error, re-throw it.\n        if (isAbortError(err)) return;\n        throw Object.defineProperty(new Error('failed to pipe response', {\n            cause: err\n        }), \"__NEXT_ERROR_CODE\", {\n            value: \"E180\",\n            enumerable: false,\n            configurable: true\n        });\n    }\n}\n\n//# sourceMappingURL=pipe-readable.js.map","/**\n * Schedules a function to be called on the next tick after the other promises\n * have been resolved.\n *\n * @param cb the function to schedule\n */ export const scheduleOnNextTick = (cb)=>{\n    // We use Promise.resolve().then() here so that the operation is scheduled at\n    // the end of the promise job queue, we then add it to the next process tick\n    // to ensure it's evaluated afterwards.\n    //\n    // This was inspired by the implementation of the DataLoader interface: https://github.com/graphql/dataloader/blob/d336bd15282664e0be4b4a657cb796f09bafbc6b/src/index.js#L213-L255\n    //\n    Promise.resolve().then(()=>{\n        if (process.env.NEXT_RUNTIME === 'edge') {\n            setTimeout(cb, 0);\n        } else {\n            process.nextTick(cb);\n        }\n    });\n};\n/**\n * Schedules a function to be called using `setImmediate` or `setTimeout` if\n * `setImmediate` is not available (like in the Edge runtime).\n *\n * @param cb the function to schedule\n */ export const scheduleImmediate = (cb)=>{\n    if (process.env.NEXT_RUNTIME === 'edge') {\n        setTimeout(cb, 0);\n    } else {\n        setImmediate(cb);\n    }\n};\n/**\n * returns a promise than resolves in a future task. There is no guarantee that the task it resolves in\n * will be the next task but if you await it you can at least be sure that the current task is over and\n * most usefully that the entire microtask queue of the current task has been emptied.\n */ export function atLeastOneTask() {\n    return new Promise((resolve)=>scheduleImmediate(resolve));\n}\n/**\n * This utility function is extracted to make it easier to find places where we are doing\n * specific timing tricks to try to schedule work after React has rendered. This is especially\n * important at the moment because Next.js uses the edge builds of React which use setTimeout to\n * schedule work when you might expect that something like setImmediate would do the trick.\n *\n * Long term we should switch to the node versions of React rendering when possible and then\n * update this to use setImmediate rather than setTimeout\n */ export function waitAtLeastOneReactRenderTask() {\n    if (process.env.NEXT_RUNTIME === 'edge') {\n        return new Promise((r)=>setTimeout(r, 0));\n    } else {\n        return new Promise((r)=>setImmediate(r));\n    }\n}\n\n//# sourceMappingURL=scheduler.js.map","import { parsePath } from './parse-path';\n/**\n * Similarly to `addPathPrefix`, this function adds a suffix at the end on the\n * provided path. It also works only for paths ensuring the argument starts\n * with a slash.\n */ export function addPathSuffix(path, suffix) {\n    if (!path.startsWith('/') || !suffix) {\n        return path;\n    }\n    const { pathname, query, hash } = parsePath(path);\n    return `${pathname}${suffix}${query}${hash}`;\n}\n\n//# sourceMappingURL=add-path-suffix.js.map","/**\n * Takes an object with a hostname property (like a parsed URL) and some\n * headers that may contain Host and returns the preferred hostname.\n * @param parsed An object containing a hostname property.\n * @param headers A dictionary with headers containing a `host`.\n */ export function getHostname(parsed, headers) {\n    // Get the hostname from the headers if it exists, otherwise use the parsed\n    // hostname.\n    let hostname;\n    if (headers?.host && !Array.isArray(headers.host)) {\n        hostname = headers.host.toString().split(':', 1)[0];\n    } else if (parsed.hostname) {\n        hostname = parsed.hostname;\n    } else return;\n    return hostname.toLowerCase();\n}\n\n//# sourceMappingURL=get-hostname.js.map","/**\n * Check to see if a value is Thenable.\n *\n * @param promise the maybe-thenable value\n * @returns true if the value is thenable\n */ export function isThenable(promise) {\n    return promise !== null && typeof promise === 'object' && 'then' in promise && typeof promise.then === 'function';\n}\n\n//# sourceMappingURL=is-thenable.js.map","/**\n * A `Promise.withResolvers` implementation that exposes the `resolve` and\n * `reject` functions on a `Promise`.\n *\n * @see https://tc39.es/proposal-promise-with-resolvers/\n */ export class DetachedPromise {\n    constructor(){\n        let resolve;\n        let reject;\n        // Create the promise and assign the resolvers to the object.\n        this.promise = new Promise((res, rej)=>{\n            resolve = res;\n            reject = rej;\n        });\n        // We know that resolvers is defined because the Promise constructor runs\n        // synchronously.\n        this.resolve = resolve;\n        this.reject = reject;\n    }\n}\n\n//# sourceMappingURL=detached-promise.js.map","import { ColumnAliasProxyHandler, TableAliasProxyHandler } from \"./alias.js\";\nimport { Column } from \"./column.js\";\nimport { entityKind, is } from \"./entity.js\";\nimport { SQL, View } from \"./sql/sql.js\";\nimport { Subquery } from \"./subquery.js\";\nimport { ViewBaseConfig } from \"./view-common.js\";\nclass SelectionProxyHandler {\n  static [entityKind] = \"SelectionProxyHandler\";\n  config;\n  constructor(config) {\n    this.config = { ...config };\n  }\n  get(subquery, prop) {\n    if (prop === \"_\") {\n      return {\n        ...subquery[\"_\"],\n        selectedFields: new Proxy(\n          subquery._.selectedFields,\n          this\n        )\n      };\n    }\n    if (prop === ViewBaseConfig) {\n      return {\n        ...subquery[ViewBaseConfig],\n        selectedFields: new Proxy(\n          subquery[ViewBaseConfig].selectedFields,\n          this\n        )\n      };\n    }\n    if (typeof prop === \"symbol\") {\n      return subquery[prop];\n    }\n    const columns = is(subquery, Subquery) ? subquery._.selectedFields : is(subquery, View) ? subquery[ViewBaseConfig].selectedFields : subquery;\n    const value = columns[prop];\n    if (is(value, SQL.Aliased)) {\n      if (this.config.sqlAliasedBehavior === \"sql\" && !value.isSelectionField) {\n        return value.sql;\n      }\n      const newValue = value.clone();\n      newValue.isSelectionField = true;\n      return newValue;\n    }\n    if (is(value, SQL)) {\n      if (this.config.sqlBehavior === \"sql\") {\n        return value;\n      }\n      throw new Error(\n        `You tried to reference \"${prop}\" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using \".as('alias')\" method.`\n      );\n    }\n    if (is(value, Column)) {\n      if (this.config.alias) {\n        return new Proxy(\n          value,\n          new ColumnAliasProxyHandler(\n            new Proxy(\n              value.table,\n              new TableAliasProxyHandler(this.config.alias, this.config.replaceOriginalName ?? false)\n            )\n          )\n        );\n      }\n      return value;\n    }\n    if (typeof value !== \"object\" || value === null) {\n      return value;\n    }\n    return new Proxy(value, new SelectionProxyHandler(this.config));\n  }\n}\nexport {\n  SelectionProxyHandler\n};\n//# sourceMappingURL=selection-proxy.js.map","import { Column } from \"./column.js\";\nimport { is } from \"./entity.js\";\nimport { Param, SQL, View } from \"./sql/sql.js\";\nimport { Subquery } from \"./subquery.js\";\nimport { getTableName, Table } from \"./table.js\";\nimport { ViewBaseConfig } from \"./view-common.js\";\nfunction mapResultRow(columns, row, joinsNotNullableMap) {\n  const nullifyMap = {};\n  const result = columns.reduce(\n    (result2, { path, field }, columnIndex) => {\n      let decoder;\n      if (is(field, Column)) {\n        decoder = field;\n      } else if (is(field, SQL)) {\n        decoder = field.decoder;\n      } else if (is(field, Subquery)) {\n        decoder = field._.sql.decoder;\n      } else {\n        decoder = field.sql.decoder;\n      }\n      let node = result2;\n      for (const [pathChunkIndex, pathChunk] of path.entries()) {\n        if (pathChunkIndex < path.length - 1) {\n          if (!(pathChunk in node)) {\n            node[pathChunk] = {};\n          }\n          node = node[pathChunk];\n        } else {\n          const rawValue = row[columnIndex];\n          const value = node[pathChunk] = rawValue === null ? null : decoder.mapFromDriverValue(rawValue);\n          if (joinsNotNullableMap && is(field, Column) && path.length === 2) {\n            const objectName = path[0];\n            if (!(objectName in nullifyMap)) {\n              nullifyMap[objectName] = value === null ? getTableName(field.table) : false;\n            } else if (typeof nullifyMap[objectName] === \"string\" && nullifyMap[objectName] !== getTableName(field.table)) {\n              nullifyMap[objectName] = false;\n            }\n          }\n        }\n      }\n      return result2;\n    },\n    {}\n  );\n  if (joinsNotNullableMap && Object.keys(nullifyMap).length > 0) {\n    for (const [objectName, tableName] of Object.entries(nullifyMap)) {\n      if (typeof tableName === \"string\" && !joinsNotNullableMap[tableName]) {\n        result[objectName] = null;\n      }\n    }\n  }\n  return result;\n}\nfunction orderSelectedFields(fields, pathPrefix) {\n  return Object.entries(fields).reduce((result, [name, field]) => {\n    if (typeof name !== \"string\") {\n      return result;\n    }\n    const newPath = pathPrefix ? [...pathPrefix, name] : [name];\n    if (is(field, Column) || is(field, SQL) || is(field, SQL.Aliased) || is(field, Subquery)) {\n      result.push({ path: newPath, field });\n    } else if (is(field, Table)) {\n      result.push(...orderSelectedFields(field[Table.Symbol.Columns], newPath));\n    } else {\n      result.push(...orderSelectedFields(field, newPath));\n    }\n    return result;\n  }, []);\n}\nfunction haveSameKeys(left, right) {\n  const leftKeys = Object.keys(left);\n  const rightKeys = Object.keys(right);\n  if (leftKeys.length !== rightKeys.length) {\n    return false;\n  }\n  for (const [index, key] of leftKeys.entries()) {\n    if (key !== rightKeys[index]) {\n      return false;\n    }\n  }\n  return true;\n}\nfunction mapUpdateSet(table, values) {\n  const entries = Object.entries(values).filter(([, value]) => value !== void 0).map(([key, value]) => {\n    if (is(value, SQL) || is(value, Column)) {\n      return [key, value];\n    } else {\n      return [key, new Param(value, table[Table.Symbol.Columns][key])];\n    }\n  });\n  if (entries.length === 0) {\n    throw new Error(\"No values to set\");\n  }\n  return Object.fromEntries(entries);\n}\nfunction applyMixins(baseClass, extendedClasses) {\n  for (const extendedClass of extendedClasses) {\n    for (const name of Object.getOwnPropertyNames(extendedClass.prototype)) {\n      if (name === \"constructor\") continue;\n      Object.defineProperty(\n        baseClass.prototype,\n        name,\n        Object.getOwnPropertyDescriptor(extendedClass.prototype, name) || /* @__PURE__ */ Object.create(null)\n      );\n    }\n  }\n}\nfunction getTableColumns(table) {\n  return table[Table.Symbol.Columns];\n}\nfunction getViewSelectedFields(view) {\n  return view[ViewBaseConfig].selectedFields;\n}\nfunction getTableLikeName(table) {\n  return is(table, Subquery) ? table._.alias : is(table, View) ? table[ViewBaseConfig].name : is(table, SQL) ? void 0 : table[Table.Symbol.IsAlias] ? table[Table.Symbol.Name] : table[Table.Symbol.BaseName];\n}\nfunction getColumnNameAndConfig(a, b) {\n  return {\n    name: typeof a === \"string\" && a.length > 0 ? a : \"\",\n    config: typeof a === \"object\" ? a : b\n  };\n}\nconst _ = {};\nconst __ = {};\nfunction isConfig(data) {\n  if (typeof data !== \"object\" || data === null) return false;\n  if (data.constructor.name !== \"Object\") return false;\n  if (\"logger\" in data) {\n    const type = typeof data[\"logger\"];\n    if (type !== \"boolean\" && (type !== \"object\" || typeof data[\"logger\"][\"logQuery\"] !== \"function\") && type !== \"undefined\") return false;\n    return true;\n  }\n  if (\"schema\" in data) {\n    const type = typeof data[\"schema\"];\n    if (type !== \"object\" && type !== \"undefined\") return false;\n    return true;\n  }\n  if (\"casing\" in data) {\n    const type = typeof data[\"casing\"];\n    if (type !== \"string\" && type !== \"undefined\") return false;\n    return true;\n  }\n  if (\"mode\" in data) {\n    if (data[\"mode\"] !== \"default\" || data[\"mode\"] !== \"planetscale\" || data[\"mode\"] !== void 0) return false;\n    return true;\n  }\n  if (\"connection\" in data) {\n    const type = typeof data[\"connection\"];\n    if (type !== \"string\" && type !== \"object\" && type !== \"undefined\") return false;\n    return true;\n  }\n  if (\"client\" in data) {\n    const type = typeof data[\"client\"];\n    if (type !== \"object\" && type !== \"function\" && type !== \"undefined\") return false;\n    return true;\n  }\n  if (Object.keys(data).length === 0) return true;\n  return false;\n}\nconst textDecoder = typeof TextDecoder === \"undefined\" ? null : new TextDecoder();\nexport {\n  applyMixins,\n  getColumnNameAndConfig,\n  getTableColumns,\n  getTableLikeName,\n  getViewSelectedFields,\n  haveSameKeys,\n  isConfig,\n  mapResultRow,\n  mapUpdateSet,\n  orderSelectedFields,\n  textDecoder\n};\n//# sourceMappingURL=utils.js.map","import { entityKind } from \"../../entity.js\";\nimport { QueryPromise } from \"../../query-promise.js\";\nimport {\n  mapRelationalRow\n} from \"../../relations.js\";\nimport { tracer } from \"../../tracing.js\";\nclass RelationalQueryBuilder {\n  constructor(fullSchema, schema, tableNamesMap, table, tableConfig, dialect, session) {\n    this.fullSchema = fullSchema;\n    this.schema = schema;\n    this.tableNamesMap = tableNamesMap;\n    this.table = table;\n    this.tableConfig = tableConfig;\n    this.dialect = dialect;\n    this.session = session;\n  }\n  static [entityKind] = \"PgRelationalQueryBuilder\";\n  findMany(config) {\n    return new PgRelationalQuery(\n      this.fullSchema,\n      this.schema,\n      this.tableNamesMap,\n      this.table,\n      this.tableConfig,\n      this.dialect,\n      this.session,\n      config ? config : {},\n      \"many\"\n    );\n  }\n  findFirst(config) {\n    return new PgRelationalQuery(\n      this.fullSchema,\n      this.schema,\n      this.tableNamesMap,\n      this.table,\n      this.tableConfig,\n      this.dialect,\n      this.session,\n      config ? { ...config, limit: 1 } : { limit: 1 },\n      \"first\"\n    );\n  }\n}\nclass PgRelationalQuery extends QueryPromise {\n  constructor(fullSchema, schema, tableNamesMap, table, tableConfig, dialect, session, config, mode) {\n    super();\n    this.fullSchema = fullSchema;\n    this.schema = schema;\n    this.tableNamesMap = tableNamesMap;\n    this.table = table;\n    this.tableConfig = tableConfig;\n    this.dialect = dialect;\n    this.session = session;\n    this.config = config;\n    this.mode = mode;\n  }\n  static [entityKind] = \"PgRelationalQuery\";\n  /** @internal */\n  _prepare(name) {\n    return tracer.startActiveSpan(\"drizzle.prepareQuery\", () => {\n      const { query, builtQuery } = this._toSQL();\n      return this.session.prepareQuery(\n        builtQuery,\n        void 0,\n        name,\n        true,\n        (rawRows, mapColumnValue) => {\n          const rows = rawRows.map(\n            (row) => mapRelationalRow(this.schema, this.tableConfig, row, query.selection, mapColumnValue)\n          );\n          if (this.mode === \"first\") {\n            return rows[0];\n          }\n          return rows;\n        }\n      );\n    });\n  }\n  prepare(name) {\n    return this._prepare(name);\n  }\n  _getQuery() {\n    return this.dialect.buildRelationalQueryWithoutPK({\n      fullSchema: this.fullSchema,\n      schema: this.schema,\n      tableNamesMap: this.tableNamesMap,\n      table: this.table,\n      tableConfig: this.tableConfig,\n      queryConfig: this.config,\n      tableAlias: this.tableConfig.tsName\n    });\n  }\n  /** @internal */\n  getSQL() {\n    return this._getQuery().sql;\n  }\n  _toSQL() {\n    const query = this._getQuery();\n    const builtQuery = this.dialect.sqlToQuery(query.sql);\n    return { query, builtQuery };\n  }\n  toSQL() {\n    return this._toSQL().builtQuery;\n  }\n  authToken;\n  /** @internal */\n  setToken(token) {\n    this.authToken = token;\n    return this;\n  }\n  execute() {\n    return tracer.startActiveSpan(\"drizzle.operation\", () => {\n      return this._prepare().execute(void 0, this.authToken);\n    });\n  }\n}\nexport {\n  PgRelationalQuery,\n  RelationalQueryBuilder\n};\n//# sourceMappingURL=query.js.map","import { hashQuery, NoopCache } from \"../cache/core/cache.js\";\nimport { entityKind, is } from \"../entity.js\";\nimport { DrizzleQueryError, TransactionRollbackError } from \"../errors.js\";\nimport { sql } from \"../sql/index.js\";\nimport { tracer } from \"../tracing.js\";\nimport { PgDatabase } from \"./db.js\";\nclass PgPreparedQuery {\n  constructor(query, cache, queryMetadata, cacheConfig) {\n    this.query = query;\n    this.cache = cache;\n    this.queryMetadata = queryMetadata;\n    this.cacheConfig = cacheConfig;\n    if (cache && cache.strategy() === \"all\" && cacheConfig === void 0) {\n      this.cacheConfig = { enable: true, autoInvalidate: true };\n    }\n    if (!this.cacheConfig?.enable) {\n      this.cacheConfig = void 0;\n    }\n  }\n  authToken;\n  getQuery() {\n    return this.query;\n  }\n  mapResult(response, _isFromBatch) {\n    return response;\n  }\n  /** @internal */\n  setToken(token) {\n    this.authToken = token;\n    return this;\n  }\n  static [entityKind] = \"PgPreparedQuery\";\n  /** @internal */\n  joinsNotNullableMap;\n  /** @internal */\n  async queryWithCache(queryString, params, query) {\n    if (this.cache === void 0 || is(this.cache, NoopCache) || this.queryMetadata === void 0) {\n      try {\n        return await query();\n      } catch (e) {\n        throw new DrizzleQueryError(queryString, params, e);\n      }\n    }\n    if (this.cacheConfig && !this.cacheConfig.enable) {\n      try {\n        return await query();\n      } catch (e) {\n        throw new DrizzleQueryError(queryString, params, e);\n      }\n    }\n    if ((this.queryMetadata.type === \"insert\" || this.queryMetadata.type === \"update\" || this.queryMetadata.type === \"delete\") && this.queryMetadata.tables.length > 0) {\n      try {\n        const [res] = await Promise.all([\n          query(),\n          this.cache.onMutate({ tables: this.queryMetadata.tables })\n        ]);\n        return res;\n      } catch (e) {\n        throw new DrizzleQueryError(queryString, params, e);\n      }\n    }\n    if (!this.cacheConfig) {\n      try {\n        return await query();\n      } catch (e) {\n        throw new DrizzleQueryError(queryString, params, e);\n      }\n    }\n    if (this.queryMetadata.type === \"select\") {\n      const fromCache = await this.cache.get(\n        this.cacheConfig.tag ?? (await hashQuery(queryString, params)),\n        this.queryMetadata.tables,\n        this.cacheConfig.tag !== void 0,\n        this.cacheConfig.autoInvalidate\n      );\n      if (fromCache === void 0) {\n        let result;\n        try {\n          result = await query();\n        } catch (e) {\n          throw new DrizzleQueryError(queryString, params, e);\n        }\n        await this.cache.put(\n          this.cacheConfig.tag ?? (await hashQuery(queryString, params)),\n          result,\n          // make sure we send tables that were used in a query only if user wants to invalidate it on each write\n          this.cacheConfig.autoInvalidate ? this.queryMetadata.tables : [],\n          this.cacheConfig.tag !== void 0,\n          this.cacheConfig.config\n        );\n        return result;\n      }\n      return fromCache;\n    }\n    try {\n      return await query();\n    } catch (e) {\n      throw new DrizzleQueryError(queryString, params, e);\n    }\n  }\n}\nclass PgSession {\n  constructor(dialect) {\n    this.dialect = dialect;\n  }\n  static [entityKind] = \"PgSession\";\n  /** @internal */\n  execute(query, token) {\n    return tracer.startActiveSpan(\"drizzle.operation\", () => {\n      const prepared = tracer.startActiveSpan(\"drizzle.prepareQuery\", () => {\n        return this.prepareQuery(\n          this.dialect.sqlToQuery(query),\n          void 0,\n          void 0,\n          false\n        );\n      });\n      return prepared.setToken(token).execute(void 0, token);\n    });\n  }\n  all(query) {\n    return this.prepareQuery(\n      this.dialect.sqlToQuery(query),\n      void 0,\n      void 0,\n      false\n    ).all();\n  }\n  /** @internal */\n  async count(sql2, token) {\n    const res = await this.execute(sql2, token);\n    return Number(\n      res[0][\"count\"]\n    );\n  }\n}\nclass PgTransaction extends PgDatabase {\n  constructor(dialect, session, schema, nestedIndex = 0) {\n    super(dialect, session, schema);\n    this.schema = schema;\n    this.nestedIndex = nestedIndex;\n  }\n  static [entityKind] = \"PgTransaction\";\n  rollback() {\n    throw new TransactionRollbackError();\n  }\n  /** @internal */\n  getTransactionConfigSQL(config) {\n    const chunks = [];\n    if (config.isolationLevel) {\n      chunks.push(`isolation level ${config.isolationLevel}`);\n    }\n    if (config.accessMode) {\n      chunks.push(config.accessMode);\n    }\n    if (typeof config.deferrable === \"boolean\") {\n      chunks.push(config.deferrable ? \"deferrable\" : \"not deferrable\");\n    }\n    return sql.raw(chunks.join(\" \"));\n  }\n  setTransaction(config) {\n    return this.session.execute(sql`set transaction ${this.getTransactionConfigSQL(config)}`);\n  }\n}\nexport {\n  PgPreparedQuery,\n  PgSession,\n  PgTransaction\n};\n//# sourceMappingURL=session.js.map","import { base32 } from './base32.mjs';\nimport { createHMAC } from './hmac.mjs';\nimport './hex.mjs';\nimport './base64.mjs';\nimport './index.mjs';\n\nconst defaultPeriod = 30;\nconst defaultDigits = 6;\nasync function generateHOTP(secret, {\n  counter,\n  digits,\n  hash = \"SHA-1\"\n}) {\n  const _digits = digits ?? defaultDigits;\n  if (_digits < 1 || _digits > 8) {\n    throw new TypeError(\"Digits must be between 1 and 8\");\n  }\n  const buffer = new ArrayBuffer(8);\n  new DataView(buffer).setBigUint64(0, BigInt(counter), false);\n  const bytes = new Uint8Array(buffer);\n  const hmacResult = new Uint8Array(await createHMAC(hash).sign(secret, bytes));\n  const offset = hmacResult[hmacResult.length - 1] & 15;\n  const truncated = (hmacResult[offset] & 127) << 24 | (hmacResult[offset + 1] & 255) << 16 | (hmacResult[offset + 2] & 255) << 8 | hmacResult[offset + 3] & 255;\n  const otp = truncated % 10 ** _digits;\n  return otp.toString().padStart(_digits, \"0\");\n}\nasync function generateTOTP(secret, options) {\n  const digits = options?.digits ?? defaultDigits;\n  const period = options?.period ?? defaultPeriod;\n  const milliseconds = period * 1e3;\n  const counter = Math.floor(Date.now() / milliseconds);\n  return await generateHOTP(secret, { counter, digits, hash: options?.hash });\n}\nasync function verifyTOTP(otp, {\n  window = 1,\n  digits = defaultDigits,\n  secret,\n  period = defaultPeriod\n}) {\n  const milliseconds = period * 1e3;\n  const counter = Math.floor(Date.now() / milliseconds);\n  for (let i = -window; i <= window; i++) {\n    const generatedOTP = await generateHOTP(secret, {\n      counter: counter + i,\n      digits\n    });\n    if (otp === generatedOTP) {\n      return true;\n    }\n  }\n  return false;\n}\nfunction generateQRCode({\n  issuer,\n  account,\n  secret,\n  digits = defaultDigits,\n  period = defaultPeriod\n}) {\n  const encodedIssuer = encodeURIComponent(issuer);\n  const encodedAccountName = encodeURIComponent(account);\n  const baseURI = `otpauth://totp/${encodedIssuer}:${encodedAccountName}`;\n  const params = new URLSearchParams({\n    secret: base32.encode(secret, {\n      padding: false\n    }),\n    issuer\n  });\n  if (digits !== void 0) {\n    params.set(\"digits\", digits.toString());\n  }\n  if (period !== void 0) {\n    params.set(\"period\", period.toString());\n  }\n  return `${baseURI}?${params.toString()}`;\n}\nconst createOTP = (secret, opts) => {\n  const digits = opts?.digits ?? defaultDigits;\n  const period = opts?.period ?? defaultPeriod;\n  return {\n    hotp: (counter) => generateHOTP(secret, { counter, digits }),\n    totp: () => generateTOTP(secret, { digits, period }),\n    verify: (otp, options) => verifyTOTP(otp, { secret, digits, period, ...options }),\n    url: (issuer, account) => generateQRCode({ issuer, account, secret, digits, period })\n  };\n};\n\nexport { createOTP };\n","import { t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport { getCurrentAuthContext } from \"@better-auth/core/context\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport { betterFetch } from \"@better-fetch/fetch\";\n\n//#region src/plugins/haveibeenpwned/index.ts\nconst ERROR_CODES = defineErrorCodes({ PASSWORD_COMPROMISED: \"The password you entered has been compromised. Please choose a different password.\" });\nasync function checkPasswordCompromise(password, customMessage) {\n\tif (!password) return;\n\tconst sha1Hash = (await createHash(\"SHA-1\", \"hex\").digest(password)).toUpperCase();\n\tconst prefix = sha1Hash.substring(0, 5);\n\tconst suffix = sha1Hash.substring(5);\n\ttry {\n\t\tconst { data, error } = await betterFetch(`https://api.pwnedpasswords.com/range/${prefix}`, { headers: {\n\t\t\t\"Add-Padding\": \"true\",\n\t\t\t\"User-Agent\": \"BetterAuth Password Checker\"\n\t\t} });\n\t\tif (error) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: `Failed to check password. Status: ${error.status}` });\n\t\tif (data.split(\"\\n\").some((line) => line.split(\":\")[0].toUpperCase() === suffix.toUpperCase())) throw new APIError(\"BAD_REQUEST\", {\n\t\t\tmessage: customMessage || ERROR_CODES.PASSWORD_COMPROMISED,\n\t\t\tcode: \"PASSWORD_COMPROMISED\"\n\t\t});\n\t} catch (error) {\n\t\tif (error instanceof APIError) throw error;\n\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", { message: \"Failed to check password. Please try again later.\" });\n\t}\n}\nconst haveIBeenPwned = (options) => {\n\tconst paths = options?.paths || [\n\t\t\"/sign-up/email\",\n\t\t\"/change-password\",\n\t\t\"/reset-password\"\n\t];\n\treturn {\n\t\tid: \"haveIBeenPwned\",\n\t\tinit(ctx) {\n\t\t\treturn { context: { password: {\n\t\t\t\t...ctx.password,\n\t\t\t\tasync hash(password) {\n\t\t\t\t\tconst c = await getCurrentAuthContext();\n\t\t\t\t\tif (!c.path || !paths.includes(c.path)) return ctx.password.hash(password);\n\t\t\t\t\tawait checkPasswordCompromise(password, options?.customPasswordCompromisedMessage);\n\t\t\t\t\treturn ctx.password.hash(password);\n\t\t\t\t}\n\t\t\t} } };\n\t\t},\n\t\t$ERROR_CODES: ERROR_CODES\n\t};\n};\n\n//#endregion\nexport { haveIBeenPwned as t };","import { t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport { c as setSessionCookie } from \"./cookies-D72PbWdz.mjs\";\nimport * as z from \"zod\";\nimport { createRemoteJWKSet, jwtVerify } from \"jose\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\n\n//#region src/utils/boolean.ts\nfunction toBoolean(value) {\n\treturn value === \"true\" || value === true;\n}\n\n//#endregion\n//#region src/plugins/one-tap/index.ts\nconst oneTap = (options) => ({\n\tid: \"one-tap\",\n\tendpoints: { oneTapCallback: createAuthEndpoint(\"/one-tap/callback\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({ idToken: z.string().meta({ description: \"Google ID token, which the client obtains from the One Tap API\" }) }),\n\t\tmetadata: { openapi: {\n\t\t\tsummary: \"One tap callback\",\n\t\t\tdescription: \"Use this endpoint to authenticate with Google One Tap\",\n\t\t\tresponses: {\n\t\t\t\t200: {\n\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tsession: { $ref: \"#/components/schemas/Session\" },\n\t\t\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" }\n\t\t\t\t\t\t}\n\t\t\t\t\t} } }\n\t\t\t\t},\n\t\t\t\t400: { description: \"Invalid token\" }\n\t\t\t}\n\t\t} }\n\t}, async (ctx) => {\n\t\tconst { idToken } = ctx.body;\n\t\tlet payload;\n\t\ttry {\n\t\t\tconst { payload: verifiedPayload } = await jwtVerify(idToken, createRemoteJWKSet(new URL(\"https://www.googleapis.com/oauth2/v3/certs\")), {\n\t\t\t\tissuer: [\"https://accounts.google.com\", \"accounts.google.com\"],\n\t\t\t\taudience: options?.clientId || ctx.context.options.socialProviders?.google?.clientId\n\t\t\t});\n\t\t\tpayload = verifiedPayload;\n\t\t} catch (error) {\n\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"invalid id token\" });\n\t\t}\n\t\tconst { email, email_verified, name, picture, sub } = payload;\n\t\tif (!email) return ctx.json({ error: \"Email not available in token\" });\n\t\tconst user = await ctx.context.internalAdapter.findUserByEmail(email);\n\t\tif (!user) {\n\t\t\tif (options?.disableSignup) throw new APIError(\"BAD_GATEWAY\", { message: \"User not found\" });\n\t\t\tconst newUser = await ctx.context.internalAdapter.createOAuthUser({\n\t\t\t\temail,\n\t\t\t\temailVerified: typeof email_verified === \"boolean\" ? email_verified : toBoolean(email_verified),\n\t\t\t\tname,\n\t\t\t\timage: picture\n\t\t\t}, {\n\t\t\t\tproviderId: \"google\",\n\t\t\t\taccountId: sub\n\t\t\t});\n\t\t\tif (!newUser) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: \"Could not create user\" });\n\t\t\tconst session$1 = await ctx.context.internalAdapter.createSession(newUser.user.id);\n\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\tuser: newUser.user,\n\t\t\t\tsession: session$1\n\t\t\t});\n\t\t\treturn ctx.json({\n\t\t\t\ttoken: session$1.token,\n\t\t\t\tuser: {\n\t\t\t\t\tid: newUser.user.id,\n\t\t\t\t\temail: newUser.user.email,\n\t\t\t\t\temailVerified: newUser.user.emailVerified,\n\t\t\t\t\tname: newUser.user.name,\n\t\t\t\t\timage: newUser.user.image,\n\t\t\t\t\tcreatedAt: newUser.user.createdAt,\n\t\t\t\t\tupdatedAt: newUser.user.updatedAt\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (!await ctx.context.internalAdapter.findAccount(sub)) {\n\t\t\tconst accountLinking = ctx.context.options.account?.accountLinking;\n\t\t\tif (accountLinking?.enabled && (accountLinking.trustedProviders?.includes(\"google\") || email_verified)) await ctx.context.internalAdapter.linkAccount({\n\t\t\t\tuserId: user.user.id,\n\t\t\t\tproviderId: \"google\",\n\t\t\t\taccountId: sub,\n\t\t\t\tscope: \"openid,profile,email\",\n\t\t\t\tidToken\n\t\t\t});\n\t\t\telse throw new APIError(\"UNAUTHORIZED\", { message: \"Google sub doesn't match\" });\n\t\t}\n\t\tconst session = await ctx.context.internalAdapter.createSession(user.user.id);\n\t\tawait setSessionCookie(ctx, {\n\t\t\tuser: user.user,\n\t\t\tsession\n\t\t});\n\t\treturn ctx.json({\n\t\t\ttoken: session.token,\n\t\t\tuser: {\n\t\t\t\tid: user.user.id,\n\t\t\t\temail: user.user.email,\n\t\t\t\temailVerified: user.user.emailVerified,\n\t\t\t\tname: user.user.name,\n\t\t\t\timage: user.user.image,\n\t\t\t\tcreatedAt: user.user.createdAt,\n\t\t\t\tupdatedAt: user.user.updatedAt\n\t\t\t}\n\t\t});\n\t}) }\n});\n\n//#endregion\nexport { oneTap as t };","import { betterAuth } from 'better-auth';\nimport { drizzleAdapter } from 'better-auth/adapters/drizzle';\nimport { username } from 'better-auth/plugins';\nimport { db } from '@/lib/db';\nimport * as schema from '@/lib/db/schema';\n\nexport const auth = betterAuth({\n  database: drizzleAdapter(db, {\n    provider: 'pg',\n    usePlural: true,\n    schema: {\n      ...schema,\n      user: schema.users,\n      session: schema.sessions,\n      account: schema.accounts,\n      verification: schema.verifications,\n    },\n  }),\n\n  emailAndPassword: {\n    enabled: true,\n    requireEmailVerification: false,\n  },\n\n  plugins: [\n    username({\n      minUsernameLength: 3,\n      maxUsernameLength: 30,\n    }),\n  ],\n\n  session: {\n    cookieCache: {\n      enabled: true,\n      maxAge: 60 * 5, // 5 minutes\n    },\n    expiresIn: 60 * 60 * 24 * 7, // 7 days\n    updateAge: 60 * 60 * 24, // 1 day\n  },\n\n  user: {\n    additionalFields: {\n      schoolId: {\n        type: 'string',\n        required: false,\n      },\n      role: {\n        type: 'string',\n        required: true,\n        defaultValue: 'student',\n      },\n      firstName: {\n        type: 'string',\n        required: true,\n      },\n      lastName: {\n        type: 'string',\n        required: true,\n      },\n      isActive: {\n        type: 'boolean',\n        required: false,\n        defaultValue: true,\n      },\n      lastLoginAt: {\n        type: 'date',\n        required: false,\n      },\n    },\n  },\n\n  trustedOrigins: [\n    process.env.BETTER_AUTH_URL || 'http://localhost:3000',\n  ],\n});\n\nexport type Session = typeof auth.$Infer.Session;\nexport type User = typeof auth.$Infer.Session.user;\n","import { pgTable, uuid, varchar, timestamp, boolean, integer, date, time, text, pgEnum } from 'drizzle-orm/pg-core';\nimport { students } from './students';\nimport { schools } from './schools';\nimport { users } from './users';\nimport { companies, companyContacts } from './companies';\n\nexport const internshipStatusEnum = pgEnum('internship_status', [\n  'draft',\n  'searching',\n  'confirmed',\n  'in_progress',\n  'completed',\n  'incomplete',\n]);\n\nexport type InternshipStatus = 'draft' | 'searching' | 'confirmed' | 'in_progress' | 'completed' | 'incomplete';\n\nexport const internships = pgTable('internships', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  studentId: uuid('student_id').notNull().references(() => students.id),\n  schoolId: uuid('school_id').notNull().references(() => schools.id),\n\n  requiredDays: integer('required_days').notNull(),\n\n  status: internshipStatusEnum('status').default('draft'),\n\n  completedDays: integer('completed_days').default(0),\n  missedDays: integer('missed_days').default(0),\n\n  finalGrade: varchar('final_grade', { length: 10 }),\n  gradedAt: timestamp('graded_at'),\n  gradedBy: uuid('graded_by').references(() => users.id),\n\n  certificateGeneratedAt: timestamp('certificate_generated_at'),\n  certificateUrl: varchar('certificate_url', { length: 500 }),\n\n  createdAt: timestamp('created_at').defaultNow(),\n  updatedAt: timestamp('updated_at').defaultNow(),\n});\n\nexport const internshipBlocks = pgTable('internship_blocks', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  internshipId: uuid('internship_id').notNull().references(() => internships.id),\n  companyId: uuid('company_id').notNull().references(() => companies.id),\n  contactId: uuid('contact_id').references(() => companyContacts.id),\n\n  startDate: date('start_date').notNull(),\n  endDate: date('end_date').notNull(),\n  plannedDays: integer('planned_days').notNull(),\n\n  contractStatus: varchar('contract_status', { length: 20 }).default('pending'),\n  contractUrl: varchar('contract_url', { length: 500 }),\n  signedContractUrl: varchar('signed_contract_url', { length: 500 }),\n\n  visitScheduledAt: timestamp('visit_scheduled_at'),\n  visitCompletedAt: timestamp('visit_completed_at'),\n  visitNotes: text('visit_notes'),\n\n  createdAt: timestamp('created_at').defaultNow(),\n});\n\nexport const timeEntries = pgTable('time_entries', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  blockId: uuid('block_id').notNull().references(() => internshipBlocks.id),\n\n  date: date('date').notNull(),\n\n  studentConfirmed: boolean('student_confirmed').default(false),\n  studentConfirmedAt: timestamp('student_confirmed_at'),\n  companyConfirmed: boolean('company_confirmed').default(false),\n  companyConfirmedAt: timestamp('company_confirmed_at'),\n\n  checkInTime: time('check_in_time'),\n  checkOutTime: time('check_out_time'),\n\n  notes: text('notes'),\n\n  createdAt: timestamp('created_at').defaultNow(),\n});\n\nexport const sickLeaves = pgTable('sick_leaves', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  blockId: uuid('block_id').notNull().references(() => internshipBlocks.id),\n\n  startDate: date('start_date').notNull(),\n  endDate: date('end_date').notNull(),\n  days: integer('days').notNull(),\n\n  hasAttest: boolean('has_attest').default(false),\n  attestUrl: varchar('attest_url', { length: 500 }),\n  attestUploadedAt: timestamp('attest_uploaded_at'),\n\n  makeUpRequired: boolean('make_up_required').default(true),\n  madeUpDays: integer('made_up_days').default(0),\n\n  createdAt: timestamp('created_at').defaultNow(),\n});\n\nexport const reports = pgTable('reports', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  blockId: uuid('block_id').notNull().references(() => internshipBlocks.id),\n\n  reportDate: date('report_date').notNull(),\n  reportType: varchar('report_type', { length: 10 }).default('daily'),\n\n  content: text('content').notNull(),\n\n  companyApproved: boolean('company_approved').default(false),\n  companyApprovedAt: timestamp('company_approved_at'),\n  teacherReviewed: boolean('teacher_reviewed').default(false),\n  teacherComment: text('teacher_comment'),\n\n  createdAt: timestamp('created_at').defaultNow(),\n  updatedAt: timestamp('updated_at').defaultNow(),\n});\n","import { pgTable, uuid, varchar, timestamp, integer } from 'drizzle-orm/pg-core';\nimport { schools } from './schools';\nimport { internships, internshipBlocks } from './internships';\nimport { students } from './students';\nimport { users } from './users';\n\nexport const documents = pgTable('documents', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  schoolId: uuid('school_id').notNull().references(() => schools.id),\n\n  internshipId: uuid('internship_id').references(() => internships.id),\n  blockId: uuid('block_id').references(() => internshipBlocks.id),\n  studentId: uuid('student_id').references(() => students.id),\n\n  type: varchar('type', { length: 50 }).notNull(),\n\n  fileName: varchar('file_name', { length: 255 }).notNull(),\n  fileSize: integer('file_size'),\n  mimeType: varchar('mime_type', { length: 100 }),\n  storageUrl: varchar('storage_url', { length: 500 }).notNull(),\n\n  uploadedBy: uuid('uploaded_by').references(() => users.id),\n  createdAt: timestamp('created_at').defaultNow(),\n});\n","/**\n * Removes the trailing slash for a given route or page path. Preserves the\n * root page. Examples:\n *   - `/foo/bar/` -> `/foo/bar`\n *   - `/foo/bar` -> `/foo/bar`\n *   - `/` -> `/`\n */ export function removeTrailingSlash(route) {\n    return route.replace(/\\/$/, '') || '/';\n}\n\n//# sourceMappingURL=remove-trailing-slash.js.map","import { addPathPrefix } from './add-path-prefix';\nimport { pathHasPrefix } from './path-has-prefix';\n/**\n * For a given path and a locale, if the locale is given, it will prefix the\n * locale. The path shouldn't be an API path. If a default locale is given the\n * prefix will be omitted if the locale is already the default locale.\n */ export function addLocale(path, locale, defaultLocale, ignorePrefix) {\n    // If no locale was given or the locale is the default locale, we don't need\n    // to prefix the path.\n    if (!locale || locale === defaultLocale) return path;\n    const lower = path.toLowerCase();\n    // If the path is an API path or the path already has the locale prefix, we\n    // don't need to prefix the path.\n    if (!ignorePrefix) {\n        if (pathHasPrefix(lower, '/api')) return path;\n        if (pathHasPrefix(lower, `/${locale.toLowerCase()}`)) return path;\n    }\n    // Add the locale prefix to the path.\n    return addPathPrefix(path, `/${locale}`);\n}\n\n//# sourceMappingURL=add-locale.js.map","import { n as symmetricEncrypt, t as symmetricDecrypt } from \"./crypto-CFUhAR9W.mjs\";\nimport { t as mergeSchema } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport { u as sessionMiddleware } from \"./session-AaRl3_x-.mjs\";\nimport { getCurrentAuthContext } from \"@better-auth/core/context\";\nimport { BetterAuthError } from \"@better-auth/core/error\";\nimport * as z from \"zod\";\nimport { SignJWT, exportJWK, generateKeyPair, importJWK, jwtVerify } from \"jose\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\nimport { base64 } from \"@better-auth/utils/base64\";\nimport { getWebcryptoSubtle } from \"@better-auth/utils\";\n\n//#region src/plugins/jwt/adapter.ts\nconst getJwksAdapter = (adapter, options) => {\n\treturn {\n\t\tgetAllKeys: async (ctx) => {\n\t\t\tif (options?.adapter?.getJwks) return await options.adapter.getJwks(ctx);\n\t\t\treturn await adapter.findMany({ model: \"jwks\" });\n\t\t},\n\t\tgetLatestKey: async (ctx) => {\n\t\t\tif (options?.adapter?.getJwks) return (await options.adapter.getJwks(ctx))?.sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime())[0];\n\t\t\treturn (await adapter.findMany({ model: \"jwks\" }))?.sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime())[0];\n\t\t},\n\t\tcreateJwk: async (ctx, webKey) => {\n\t\t\tif (options?.adapter?.createJwk) return await options.adapter.createJwk(webKey, ctx);\n\t\t\treturn await adapter.create({\n\t\t\t\tmodel: \"jwks\",\n\t\t\t\tdata: {\n\t\t\t\t\t...webKey,\n\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n};\n\n//#endregion\n//#region src/plugins/jwt/schema.ts\nconst schema = { jwks: { fields: {\n\tpublicKey: {\n\t\ttype: \"string\",\n\t\trequired: true\n\t},\n\tprivateKey: {\n\t\ttype: \"string\",\n\t\trequired: true\n\t},\n\tcreatedAt: {\n\t\ttype: \"date\",\n\t\trequired: true\n\t},\n\texpiresAt: {\n\t\ttype: \"date\",\n\t\trequired: false\n\t}\n} } };\n\n//#endregion\n//#region src/utils/time.ts\nconst minute = 60;\nconst hour = minute * 60;\nconst day = hour * 24;\nconst week = day * 7;\nconst year = day * 365.25;\nconst REGEX = /^(\\+|\\-)? ?(\\d+|\\d+\\.\\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;\n/**\n* https://github.com/panva/jose/blob/723ee6152d7ee2fc81852d2d26777e86df6fce01/src/lib/secs.ts\n*/\nfunction joseSecs(str) {\n\tconst matched = REGEX.exec(str);\n\tif (!matched || matched[4] && matched[1]) throw new TypeError(\"Invalid time period format\");\n\tconst value = parseFloat(matched[2]);\n\tconst unit = matched[3].toLowerCase();\n\tlet numericDate;\n\tswitch (unit) {\n\t\tcase \"sec\":\n\t\tcase \"secs\":\n\t\tcase \"second\":\n\t\tcase \"seconds\":\n\t\tcase \"s\":\n\t\t\tnumericDate = Math.round(value);\n\t\t\tbreak;\n\t\tcase \"minute\":\n\t\tcase \"minutes\":\n\t\tcase \"min\":\n\t\tcase \"mins\":\n\t\tcase \"m\":\n\t\t\tnumericDate = Math.round(value * minute);\n\t\t\tbreak;\n\t\tcase \"hour\":\n\t\tcase \"hours\":\n\t\tcase \"hr\":\n\t\tcase \"hrs\":\n\t\tcase \"h\":\n\t\t\tnumericDate = Math.round(value * hour);\n\t\t\tbreak;\n\t\tcase \"day\":\n\t\tcase \"days\":\n\t\tcase \"d\":\n\t\t\tnumericDate = Math.round(value * day);\n\t\t\tbreak;\n\t\tcase \"week\":\n\t\tcase \"weeks\":\n\t\tcase \"w\":\n\t\t\tnumericDate = Math.round(value * week);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tnumericDate = Math.round(value * year);\n\t\t\tbreak;\n\t}\n\tif (matched[1] === \"-\" || matched[4] === \"ago\") return -numericDate;\n\treturn numericDate;\n}\n\n//#endregion\n//#region src/plugins/jwt/utils.ts\n/**\n* Converts an expirationTime to ISO seconds expiration time (the format of JWT exp)\n*\n* See https://github.com/panva/jose/blob/main/src/lib/jwt_claims_set.ts#L245\n*\n* @param expirationTime - see options.jwt.expirationTime\n* @param iat - the iat time to consolidate on\n* @returns\n*/\nfunction toExpJWT(expirationTime, iat) {\n\tif (typeof expirationTime === \"number\") return expirationTime;\n\telse if (expirationTime instanceof Date) return Math.floor(expirationTime.getTime() / 1e3);\n\telse return iat + joseSecs(expirationTime);\n}\nasync function generateExportedKeyPair(options) {\n\tconst { alg, ...cfg } = options?.jwks?.keyPairConfig ?? {\n\t\talg: \"EdDSA\",\n\t\tcrv: \"Ed25519\"\n\t};\n\tconst { publicKey, privateKey } = await generateKeyPair(alg, {\n\t\t...cfg,\n\t\textractable: true\n\t});\n\treturn {\n\t\tpublicWebKey: await exportJWK(publicKey),\n\t\tprivateWebKey: await exportJWK(privateKey),\n\t\talg,\n\t\tcfg\n\t};\n}\n/**\n* Creates a Jwk on the database\n*\n* @param ctx\n* @param options\n* @returns\n*/\nasync function createJwk(ctx, options) {\n\tconst { publicWebKey, privateWebKey, alg, cfg } = await generateExportedKeyPair(options);\n\tconst stringifiedPrivateWebKey = JSON.stringify(privateWebKey);\n\tconst privateKeyEncryptionEnabled = !options?.jwks?.disablePrivateKeyEncryption;\n\tlet jwk = {\n\t\talg,\n\t\t...cfg && \"crv\" in cfg ? { crv: cfg.crv } : {},\n\t\tpublicKey: JSON.stringify(publicWebKey),\n\t\tprivateKey: privateKeyEncryptionEnabled ? JSON.stringify(await symmetricEncrypt({\n\t\t\tkey: ctx.context.secret,\n\t\t\tdata: stringifiedPrivateWebKey\n\t\t})) : stringifiedPrivateWebKey,\n\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t...options?.jwks?.rotationInterval ? { expiresAt: new Date(Date.now() + options.jwks.rotationInterval * 1e3) } : {}\n\t};\n\treturn await getJwksAdapter(ctx.context.adapter, options).createJwk(ctx, jwk);\n}\n\n//#endregion\n//#region src/plugins/jwt/sign.ts\nasync function signJWT(ctx, config) {\n\tconst { options, payload } = config;\n\tconst nowSeconds = Math.floor(Date.now() / 1e3);\n\tconst iat = payload.iat;\n\tlet exp = payload.exp;\n\tconst defaultExp = toExpJWT(options?.jwt?.expirationTime ?? \"15m\", iat ?? nowSeconds);\n\texp = exp ?? defaultExp;\n\tconst nbf = payload.nbf;\n\tconst iss = payload.iss;\n\tconst defaultIss = options?.jwt?.issuer ?? ctx.context.options.baseURL;\n\tconst aud = payload.aud;\n\tconst defaultAud = options?.jwt?.audience ?? ctx.context.options.baseURL;\n\tif (options?.jwt?.sign) {\n\t\tconst jwtPayload = {\n\t\t\t...payload,\n\t\t\tiat,\n\t\t\texp,\n\t\t\tnbf,\n\t\t\tiss: iss ?? defaultIss,\n\t\t\taud: aud ?? defaultAud\n\t\t};\n\t\treturn options.jwt.sign(jwtPayload);\n\t}\n\tlet key = await getJwksAdapter(ctx.context.adapter, options).getLatestKey(ctx);\n\tif (!key || key.expiresAt && key.expiresAt < /* @__PURE__ */ new Date()) key = await createJwk(ctx, options);\n\tlet privateWebKey = !options?.jwks?.disablePrivateKeyEncryption ? await symmetricDecrypt({\n\t\tkey: ctx.context.secret,\n\t\tdata: JSON.parse(key.privateKey)\n\t}).catch(() => {\n\t\tthrow new BetterAuthError(\"Failed to decrypt private key. Make sure the secret currently in use is the same as the one used to encrypt the private key. If you are using a different secret, either clean up your JWKS or disable private key encryption.\");\n\t}) : key.privateKey;\n\tconst alg = key.alg ?? options?.jwks?.keyPairConfig?.alg ?? \"EdDSA\";\n\tconst privateKey = await importJWK(JSON.parse(privateWebKey), alg);\n\tconst jwt$1 = new SignJWT(payload).setProtectedHeader({\n\t\talg,\n\t\tkid: key.id\n\t}).setExpirationTime(exp).setIssuer(iss ?? defaultIss).setAudience(aud ?? defaultAud);\n\tif (iat) jwt$1.setIssuedAt(iat);\n\tif (payload.sub) jwt$1.setSubject(payload.sub);\n\tif (payload.nbf) jwt$1.setNotBefore(payload.nbf);\n\tif (payload.jti) jwt$1.setJti(payload.jti);\n\treturn await jwt$1.sign(privateKey);\n}\nasync function getJwtToken(ctx, options) {\n\tconst payload = !options?.jwt?.definePayload ? ctx.context.session.user : await options?.jwt.definePayload(ctx.context.session);\n\treturn await signJWT(ctx, {\n\t\toptions,\n\t\tpayload: {\n\t\t\tiat: Math.floor(Date.now() / 1e3),\n\t\t\t...payload,\n\t\t\tsub: await options?.jwt?.getSubject?.(ctx.context.session) ?? ctx.context.session.user.id\n\t\t}\n\t});\n}\n\n//#endregion\n//#region src/plugins/jwt/verify.ts\n/**\n* Verify a JWT token using the JWKS public keys\n* Returns the payload if valid, null otherwise\n*/\nasync function verifyJWT(token, options) {\n\tconst ctx = await getCurrentAuthContext();\n\ttry {\n\t\tconst parts = token.split(\".\");\n\t\tif (parts.length !== 3) return null;\n\t\tconst headerStr = new TextDecoder().decode(base64.decode(parts[0]));\n\t\tconst kid = JSON.parse(headerStr).kid;\n\t\tif (!kid) {\n\t\t\tctx.context.logger.debug(\"JWT missing kid in header\");\n\t\t\treturn null;\n\t\t}\n\t\tconst keys = await getJwksAdapter(ctx.context.adapter, options).getAllKeys(ctx);\n\t\tif (!keys || keys.length === 0) {\n\t\t\tctx.context.logger.debug(\"No JWKS keys available\");\n\t\t\treturn null;\n\t\t}\n\t\tconst key = keys.find((k) => k.id === kid);\n\t\tif (!key) {\n\t\t\tctx.context.logger.debug(`No JWKS key found for kid: ${kid}`);\n\t\t\treturn null;\n\t\t}\n\t\tconst { payload } = await jwtVerify(token, await importJWK(JSON.parse(key.publicKey), key.alg ?? options?.jwks?.keyPairConfig?.alg ?? \"EdDSA\"), { issuer: options?.jwt?.issuer ?? ctx.context.options.baseURL });\n\t\tif (!payload.sub || !payload.aud) return null;\n\t\treturn payload;\n\t} catch (error) {\n\t\tctx.context.logger.debug(\"JWT verification failed\", error);\n\t\treturn null;\n\t}\n}\n\n//#endregion\n//#region src/plugins/jwt/index.ts\nconst jwt = (options) => {\n\tif (options?.jwt?.sign && !options.jwks?.remoteUrl) throw new BetterAuthError(\"jwks_config\", \"jwks.remoteUrl must be set when using jwt.sign\");\n\tif (options?.jwks?.remoteUrl && !options.jwks?.keyPairConfig?.alg) throw new BetterAuthError(\"jwks_config\", \"must specify alg when using the oidc plugin and jwks.remoteUrl\");\n\tconst jwksPath = options?.jwks?.jwksPath ?? \"/jwks\";\n\tif (typeof jwksPath !== \"string\" || jwksPath.length === 0 || !jwksPath.startsWith(\"/\") || jwksPath.includes(\"..\")) throw new BetterAuthError(\"jwks_config\", \"jwksPath must be a non-empty string starting with '/' and not contain '..'\");\n\treturn {\n\t\tid: \"jwt\",\n\t\toptions,\n\t\tendpoints: {\n\t\t\tgetJwks: createAuthEndpoint(jwksPath, {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"getJSONWebKeySet\",\n\t\t\t\t\tdescription: \"Get the JSON Web Key Set\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"JSON Web Key Set retrieved successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { keys: {\n\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\tdescription: \"Array of public JSON Web Keys\",\n\t\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\tkid: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Key ID uniquely identifying the key, corresponds to the 'id' from the stored Jwk\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tkty: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Key type (e.g., 'RSA', 'EC', 'OKP')\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\talg: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Algorithm intended for use with the key (e.g., 'EdDSA', 'RS256')\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tuse: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Intended use of the public key (e.g., 'sig' for signature)\",\n\t\t\t\t\t\t\t\t\t\t\tenum: [\"sig\"],\n\t\t\t\t\t\t\t\t\t\t\tnullable: true\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tn: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Modulus for RSA keys (base64url-encoded)\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\te: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Exponent for RSA keys (base64url-encoded)\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tcrv: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Curve name for elliptic curve keys (e.g., 'Ed25519', 'P-256')\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"X coordinate for elliptic curve keys (base64url-encoded)\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\ty: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Y coordinate for elliptic curve keys (base64url-encoded)\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\"kid\",\n\t\t\t\t\t\t\t\t\t\t\"kty\",\n\t\t\t\t\t\t\t\t\t\t\"alg\"\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} },\n\t\t\t\t\t\t\trequired: [\"keys\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (options?.jwks?.remoteUrl) throw new APIError(\"NOT_FOUND\");\n\t\t\t\tconst adapter = getJwksAdapter(ctx.context.adapter, options);\n\t\t\t\tlet keySets = await adapter.getAllKeys(ctx);\n\t\t\t\tif (!keySets || keySets?.length === 0) {\n\t\t\t\t\tawait createJwk(ctx, options);\n\t\t\t\t\tkeySets = await adapter.getAllKeys(ctx);\n\t\t\t\t}\n\t\t\t\tif (!keySets?.length) throw new BetterAuthError(\"No key sets found. Make sure you have a key in your database.\");\n\t\t\t\tconst now = Date.now();\n\t\t\t\tconst gracePeriod = (options?.jwks?.gracePeriod ?? 3600 * 24 * 30) * 1e3;\n\t\t\t\tconst keys = keySets.filter((key) => {\n\t\t\t\t\tif (!key.expiresAt) return true;\n\t\t\t\t\treturn key.expiresAt.getTime() + gracePeriod > now;\n\t\t\t\t});\n\t\t\t\tconst keyPairConfig = options?.jwks?.keyPairConfig;\n\t\t\t\tconst defaultCrv = keyPairConfig ? \"crv\" in keyPairConfig ? keyPairConfig.crv : void 0 : void 0;\n\t\t\t\treturn ctx.json({ keys: keys.map((keySet) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\talg: keySet.alg ?? options?.jwks?.keyPairConfig?.alg ?? \"EdDSA\",\n\t\t\t\t\t\tcrv: keySet.crv ?? defaultCrv,\n\t\t\t\t\t\t...JSON.parse(keySet.publicKey),\n\t\t\t\t\t\tkid: keySet.id\n\t\t\t\t\t};\n\t\t\t\t}) });\n\t\t\t}),\n\t\t\tgetToken: createAuthEndpoint(\"/token\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\trequireHeaders: true,\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"getJSONWebToken\",\n\t\t\t\t\tdescription: \"Get a JWT token\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { token: { type: \"string\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst jwt$1 = await getJwtToken(ctx, options);\n\t\t\t\treturn ctx.json({ token: jwt$1 });\n\t\t\t}),\n\t\t\tsignJWT: createAuthEndpoint(\"/sign-jwt\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tmetadata: {\n\t\t\t\t\tSERVER_ONLY: true,\n\t\t\t\t\t$Infer: { body: {} }\n\t\t\t\t},\n\t\t\t\tbody: z.object({\n\t\t\t\t\tpayload: z.record(z.string(), z.any()),\n\t\t\t\t\toverrideOptions: z.record(z.string(), z.any()).optional()\n\t\t\t\t})\n\t\t\t}, async (c) => {\n\t\t\t\tconst jwt$1 = await signJWT(c, {\n\t\t\t\t\toptions: {\n\t\t\t\t\t\t...options,\n\t\t\t\t\t\t...c.body.overrideOptions\n\t\t\t\t\t},\n\t\t\t\t\tpayload: c.body.payload\n\t\t\t\t});\n\t\t\t\treturn c.json({ token: jwt$1 });\n\t\t\t}),\n\t\t\tverifyJWT: createAuthEndpoint(\"/verify-jwt\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tmetadata: {\n\t\t\t\t\tSERVER_ONLY: true,\n\t\t\t\t\t$Infer: {\n\t\t\t\t\t\tbody: {},\n\t\t\t\t\t\tresponse: {}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tbody: z.object({\n\t\t\t\t\ttoken: z.string(),\n\t\t\t\t\tissuer: z.string().optional()\n\t\t\t\t})\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst overrideOptions = ctx.body.issuer ? {\n\t\t\t\t\t...options,\n\t\t\t\t\tjwt: {\n\t\t\t\t\t\t...options?.jwt,\n\t\t\t\t\t\tissuer: ctx.body.issuer\n\t\t\t\t\t}\n\t\t\t\t} : options;\n\t\t\t\tconst payload = await verifyJWT(ctx.body.token, overrideOptions);\n\t\t\t\treturn ctx.json({ payload });\n\t\t\t})\n\t\t},\n\t\thooks: { after: [{\n\t\t\tmatcher(context) {\n\t\t\t\treturn context.path === \"/get-session\";\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tif (options?.disableSettingJwtHeader) return;\n\t\t\t\tconst session = ctx.context.session || ctx.context.newSession;\n\t\t\t\tif (session && session.session) {\n\t\t\t\t\tconst jwt$1 = await getJwtToken(ctx, options);\n\t\t\t\t\tconst exposedHeaders = ctx.context.responseHeaders?.get(\"access-control-expose-headers\") || \"\";\n\t\t\t\t\tconst headersSet = new Set(exposedHeaders.split(\",\").map((header) => header.trim()).filter(Boolean));\n\t\t\t\t\theadersSet.add(\"set-auth-jwt\");\n\t\t\t\t\tctx.setHeader(\"set-auth-jwt\", jwt$1);\n\t\t\t\t\tctx.setHeader(\"Access-Control-Expose-Headers\", Array.from(headersSet).join(\", \"));\n\t\t\t\t}\n\t\t\t})\n\t\t}] },\n\t\tschema: mergeSchema(schema, options?.schema)\n\t};\n};\n\n//#endregion\nexport { generateExportedKeyPair as a, createJwk as i, verifyJWT as n, getJwtToken as r, jwt as t };","import { c as symmetricEncodeJWT, l as verifyJWT, o as signJWT, s as symmetricDecodeJWT } from \"./crypto-CFUhAR9W.mjs\";\nimport { l as parseUserOutput, u as getDate } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as safeJSONParse } from \"./json-CnHxKYpj.mjs\";\nimport { t as getBaseURL } from \"./url-CB8xCwz-.mjs\";\nimport { env, isProduction } from \"@better-auth/core/env\";\nimport { BetterAuthError } from \"@better-auth/core/error\";\nimport * as z from \"zod\";\nimport { base64Url } from \"@better-auth/utils/base64\";\nimport { binary } from \"@better-auth/utils/binary\";\nimport { createHMAC } from \"@better-auth/utils/hmac\";\nimport { ms } from \"ms\";\n\n//#region src/cookies/session-store.ts\nconst ALLOWED_COOKIE_SIZE = 4096;\nconst ESTIMATED_EMPTY_COOKIE_SIZE = 200;\nconst CHUNK_SIZE = ALLOWED_COOKIE_SIZE - ESTIMATED_EMPTY_COOKIE_SIZE;\n/**\n* Parse cookies from the request headers\n*/\nfunction parseCookiesFromContext(ctx) {\n\tconst cookieHeader = ctx.headers?.get(\"cookie\");\n\tif (!cookieHeader) return {};\n\tconst cookies = {};\n\tconst pairs = cookieHeader.split(\"; \");\n\tfor (const pair of pairs) {\n\t\tconst [name, ...valueParts] = pair.split(\"=\");\n\t\tif (name && valueParts.length > 0) cookies[name] = valueParts.join(\"=\");\n\t}\n\treturn cookies;\n}\n/**\n* Extract the chunk index from a cookie name\n*/\nfunction getChunkIndex(cookieName) {\n\tconst parts = cookieName.split(\".\");\n\tconst lastPart = parts[parts.length - 1];\n\tconst index = parseInt(lastPart || \"0\", 10);\n\treturn isNaN(index) ? 0 : index;\n}\n/**\n* Read all existing chunks from cookies\n*/\nfunction readExistingChunks(cookieName, ctx) {\n\tconst chunks = {};\n\tconst cookies = parseCookiesFromContext(ctx);\n\tfor (const [name, value] of Object.entries(cookies)) if (name.startsWith(cookieName)) chunks[name] = value;\n\treturn chunks;\n}\n/**\n* Get the full session data by joining all chunks\n*/\nfunction joinChunks(chunks) {\n\treturn Object.keys(chunks).sort((a, b) => {\n\t\treturn getChunkIndex(a) - getChunkIndex(b);\n\t}).map((key) => chunks[key]).join(\"\");\n}\n/**\n* Split a cookie value into chunks if needed\n*/\nfunction chunkCookie(storeName, cookie, chunks, logger$1) {\n\tconst chunkCount = Math.ceil(cookie.value.length / CHUNK_SIZE);\n\tif (chunkCount === 1) {\n\t\tchunks[cookie.name] = cookie.value;\n\t\treturn [cookie];\n\t}\n\tconst cookies = [];\n\tfor (let i = 0; i < chunkCount; i++) {\n\t\tconst name = `${cookie.name}.${i}`;\n\t\tconst start = i * CHUNK_SIZE;\n\t\tconst value = cookie.value.substring(start, start + CHUNK_SIZE);\n\t\tcookies.push({\n\t\t\t...cookie,\n\t\t\tname,\n\t\t\tvalue\n\t\t});\n\t\tchunks[name] = value;\n\t}\n\tlogger$1.debug(`CHUNKING_${storeName.toUpperCase()}_COOKIE`, {\n\t\tmessage: `${storeName} cookie exceeds allowed ${ALLOWED_COOKIE_SIZE} bytes.`,\n\t\temptyCookieSize: ESTIMATED_EMPTY_COOKIE_SIZE,\n\t\tvalueSize: cookie.value.length,\n\t\tchunkCount,\n\t\tchunks: cookies.map((c) => c.value.length + ESTIMATED_EMPTY_COOKIE_SIZE)\n\t});\n\treturn cookies;\n}\n/**\n* Get all cookies that should be cleaned (removed)\n*/\nfunction getCleanCookies(chunks, cookieOptions) {\n\tconst cleanedChunks = {};\n\tfor (const name in chunks) cleanedChunks[name] = {\n\t\tname,\n\t\tvalue: \"\",\n\t\toptions: {\n\t\t\t...cookieOptions,\n\t\t\tmaxAge: 0\n\t\t}\n\t};\n\treturn cleanedChunks;\n}\n/**\n* Create a session store for handling cookie chunking.\n* When session data exceeds 4KB, it automatically splits it into multiple cookies.\n*\n* Based on next-auth's SessionStore implementation.\n* @see https://github.com/nextauthjs/next-auth/blob/27b2519b84b8eb9cf053775dea29d577d2aa0098/packages/next-auth/src/core/lib/cookie.ts\n*/\nconst storeFactory = (storeName) => (cookieName, cookieOptions, ctx) => {\n\tconst chunks = readExistingChunks(cookieName, ctx);\n\tconst logger$1 = ctx.context.logger;\n\treturn {\n\t\tgetValue() {\n\t\t\treturn joinChunks(chunks);\n\t\t},\n\t\thasChunks() {\n\t\t\treturn Object.keys(chunks).length > 0;\n\t\t},\n\t\tchunk(value, options) {\n\t\t\tconst cleanedChunks = getCleanCookies(chunks, cookieOptions);\n\t\t\tfor (const name in chunks) delete chunks[name];\n\t\t\tconst cookies = cleanedChunks;\n\t\t\tconst chunked = chunkCookie(storeName, {\n\t\t\t\tname: cookieName,\n\t\t\t\tvalue,\n\t\t\t\toptions: {\n\t\t\t\t\t...cookieOptions,\n\t\t\t\t\t...options\n\t\t\t\t}\n\t\t\t}, chunks, logger$1);\n\t\t\tfor (const chunk of chunked) cookies[chunk.name] = chunk;\n\t\t\treturn Object.values(cookies);\n\t\t},\n\t\tclean() {\n\t\t\tconst cleanedChunks = getCleanCookies(chunks, cookieOptions);\n\t\t\tfor (const name in chunks) delete chunks[name];\n\t\t\treturn Object.values(cleanedChunks);\n\t\t},\n\t\tsetCookies(cookies) {\n\t\t\tfor (const cookie of cookies) ctx.setCookie(cookie.name, cookie.value, cookie.options);\n\t\t}\n\t};\n};\nconst createSessionStore = storeFactory(\"Session\");\nconst createAccountStore = storeFactory(\"Account\");\nfunction getChunkedCookie(ctx, cookieName) {\n\tconst value = ctx.getCookie(cookieName);\n\tif (value) return value;\n\tconst chunks = [];\n\tconst cookieHeader = ctx.headers?.get(\"cookie\");\n\tif (!cookieHeader) return null;\n\tconst cookies = {};\n\tconst pairs = cookieHeader.split(\"; \");\n\tfor (const pair of pairs) {\n\t\tconst [name, ...valueParts] = pair.split(\"=\");\n\t\tif (name && valueParts.length > 0) cookies[name] = valueParts.join(\"=\");\n\t}\n\tfor (const [name, val] of Object.entries(cookies)) if (name.startsWith(cookieName + \".\")) {\n\t\tconst indexStr = name.split(\".\").at(-1);\n\t\tconst index = parseInt(indexStr || \"0\", 10);\n\t\tif (!isNaN(index)) chunks.push({\n\t\t\tindex,\n\t\t\tvalue: val\n\t\t});\n\t}\n\tif (chunks.length > 0) {\n\t\tchunks.sort((a, b) => a.index - b.index);\n\t\treturn chunks.map((c) => c.value).join(\"\");\n\t}\n\treturn null;\n}\nasync function setAccountCookie(c, accountData) {\n\tconst accountDataCookie = c.context.authCookies.accountData;\n\tconst options = {\n\t\tmaxAge: 300,\n\t\t...accountDataCookie.options\n\t};\n\tconst data = await symmetricEncodeJWT(accountData, c.context.secret, \"better-auth-account\", options.maxAge);\n\tif (data.length > ALLOWED_COOKIE_SIZE) {\n\t\tconst accountStore = createAccountStore(accountDataCookie.name, options, c);\n\t\tconst cookies = accountStore.chunk(data, options);\n\t\taccountStore.setCookies(cookies);\n\t} else {\n\t\tconst accountStore = createAccountStore(accountDataCookie.name, options, c);\n\t\tif (accountStore.hasChunks()) {\n\t\t\tconst cleanCookies = accountStore.clean();\n\t\t\taccountStore.setCookies(cleanCookies);\n\t\t}\n\t\tc.setCookie(accountDataCookie.name, data, options);\n\t}\n}\nasync function getAccountCookie(c) {\n\tconst accountCookie = getChunkedCookie(c, c.context.authCookies.accountData.name);\n\tif (accountCookie) {\n\t\tconst accountData = safeJSONParse(await symmetricDecodeJWT(accountCookie, c.context.secret, \"better-auth-account\"));\n\t\tif (accountData) return accountData;\n\t}\n\treturn null;\n}\nconst getSessionQuerySchema = z.optional(z.object({\n\tdisableCookieCache: z.coerce.boolean().meta({ description: \"Disable cookie cache and fetch session from database\" }).optional(),\n\tdisableRefresh: z.coerce.boolean().meta({ description: \"Disable session refresh. Useful for checking session status, without updating the session\" }).optional()\n}));\n\n//#endregion\n//#region src/cookies/cookie-utils.ts\nfunction parseSetCookieHeader(setCookie) {\n\tconst cookies = /* @__PURE__ */ new Map();\n\tsetCookie.split(\", \").forEach((cookieString) => {\n\t\tconst [nameValue, ...attributes] = cookieString.split(\";\").map((part) => part.trim());\n\t\tconst [name, ...valueParts] = (nameValue || \"\").split(\"=\");\n\t\tconst value = valueParts.join(\"=\");\n\t\tif (!name || value === void 0) return;\n\t\tconst attrObj = { value };\n\t\tattributes.forEach((attribute) => {\n\t\t\tconst [attrName, ...attrValueParts] = attribute.split(\"=\");\n\t\t\tconst attrValue = attrValueParts.join(\"=\");\n\t\t\tconst normalizedAttrName = attrName.trim().toLowerCase();\n\t\t\tswitch (normalizedAttrName) {\n\t\t\t\tcase \"max-age\":\n\t\t\t\t\tattrObj[\"max-age\"] = attrValue ? parseInt(attrValue.trim(), 10) : void 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"expires\":\n\t\t\t\t\tattrObj.expires = attrValue ? new Date(attrValue.trim()) : void 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"domain\":\n\t\t\t\t\tattrObj.domain = attrValue ? attrValue.trim() : void 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"path\":\n\t\t\t\t\tattrObj.path = attrValue ? attrValue.trim() : void 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"secure\":\n\t\t\t\t\tattrObj.secure = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"httponly\":\n\t\t\t\t\tattrObj.httponly = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"samesite\":\n\t\t\t\t\tattrObj.samesite = attrValue ? attrValue.trim().toLowerCase() : void 0;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tattrObj[normalizedAttrName] = attrValue ? attrValue.trim() : true;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t\tcookies.set(name, attrObj);\n\t});\n\treturn cookies;\n}\nfunction setCookieToHeader(headers) {\n\treturn (context) => {\n\t\tconst setCookieHeader = context.response.headers.get(\"set-cookie\");\n\t\tif (!setCookieHeader) return;\n\t\tconst cookieMap = /* @__PURE__ */ new Map();\n\t\t(headers.get(\"cookie\") || \"\").split(\";\").forEach((cookie) => {\n\t\t\tconst [name, ...rest] = cookie.trim().split(\"=\");\n\t\t\tif (name && rest.length > 0) cookieMap.set(name, rest.join(\"=\"));\n\t\t});\n\t\tsetCookieHeader.split(\",\").forEach((header) => {\n\t\t\tparseSetCookieHeader(header).forEach((value, name) => {\n\t\t\t\tcookieMap.set(name, value.value);\n\t\t\t});\n\t\t});\n\t\tconst updatedCookies = Array.from(cookieMap.entries()).map(([name, value]) => `${name}=${value}`).join(\"; \");\n\t\theaders.set(\"cookie\", updatedCookies);\n\t};\n}\n\n//#endregion\n//#region src/cookies/index.ts\nfunction createCookieGetter(options) {\n\tconst secureCookiePrefix = (options.advanced?.useSecureCookies !== void 0 ? options.advanced?.useSecureCookies : options.baseURL !== void 0 ? options.baseURL.startsWith(\"https://\") ? true : false : isProduction) ? \"__Secure-\" : \"\";\n\tconst crossSubdomainEnabled = !!options.advanced?.crossSubDomainCookies?.enabled;\n\tconst domain = crossSubdomainEnabled ? options.advanced?.crossSubDomainCookies?.domain || (options.baseURL ? new URL(options.baseURL).hostname : void 0) : void 0;\n\tif (crossSubdomainEnabled && !domain) throw new BetterAuthError(\"baseURL is required when crossSubdomainCookies are enabled\");\n\tfunction createCookie(cookieName, overrideAttributes = {}) {\n\t\tconst prefix = options.advanced?.cookiePrefix || \"better-auth\";\n\t\tconst name = options.advanced?.cookies?.[cookieName]?.name || `${prefix}.${cookieName}`;\n\t\tconst attributes = options.advanced?.cookies?.[cookieName]?.attributes;\n\t\treturn {\n\t\t\tname: `${secureCookiePrefix}${name}`,\n\t\t\tattributes: {\n\t\t\t\tsecure: !!secureCookiePrefix,\n\t\t\t\tsameSite: \"lax\",\n\t\t\t\tpath: \"/\",\n\t\t\t\thttpOnly: true,\n\t\t\t\t...crossSubdomainEnabled ? { domain } : {},\n\t\t\t\t...options.advanced?.defaultCookieAttributes,\n\t\t\t\t...overrideAttributes,\n\t\t\t\t...attributes\n\t\t\t}\n\t\t};\n\t}\n\treturn createCookie;\n}\nfunction getCookies(options) {\n\tconst createCookie = createCookieGetter(options);\n\tconst sessionToken = createCookie(\"session_token\", { maxAge: options.session?.expiresIn || ms(\"7d\") / 1e3 });\n\tconst sessionData = createCookie(\"session_data\", { maxAge: options.session?.cookieCache?.maxAge || 300 });\n\tconst accountData = createCookie(\"account_data\", { maxAge: options.session?.cookieCache?.maxAge || 300 });\n\tconst dontRememberToken = createCookie(\"dont_remember\");\n\treturn {\n\t\tsessionToken: {\n\t\t\tname: sessionToken.name,\n\t\t\toptions: sessionToken.attributes\n\t\t},\n\t\tsessionData: {\n\t\t\tname: sessionData.name,\n\t\t\toptions: sessionData.attributes\n\t\t},\n\t\tdontRememberToken: {\n\t\t\tname: dontRememberToken.name,\n\t\t\toptions: dontRememberToken.attributes\n\t\t},\n\t\taccountData: {\n\t\t\tname: accountData.name,\n\t\t\toptions: accountData.attributes\n\t\t}\n\t};\n}\nasync function setCookieCache(ctx, session, dontRememberMe) {\n\tif (ctx.context.options.session?.cookieCache?.enabled) {\n\t\tconst filteredSession = Object.entries(session.session).reduce((acc, [key, value]) => {\n\t\t\tconst fieldConfig = ctx.context.options.session?.additionalFields?.[key];\n\t\t\tif (!fieldConfig || fieldConfig.returned !== false) acc[key] = value;\n\t\t\treturn acc;\n\t\t}, {});\n\t\tconst filteredUser = parseUserOutput(ctx.context.options, session.user);\n\t\tconst versionConfig = ctx.context.options.session?.cookieCache?.version;\n\t\tlet version = \"1\";\n\t\tif (versionConfig) {\n\t\t\tif (typeof versionConfig === \"string\") version = versionConfig;\n\t\t\telse if (typeof versionConfig === \"function\") {\n\t\t\t\tconst result = versionConfig(session.session, session.user);\n\t\t\t\tversion = result instanceof Promise ? await result : result;\n\t\t\t}\n\t\t}\n\t\tconst sessionData = {\n\t\t\tsession: filteredSession,\n\t\t\tuser: filteredUser,\n\t\t\tupdatedAt: Date.now(),\n\t\t\tversion\n\t\t};\n\t\tconst options = {\n\t\t\t...ctx.context.authCookies.sessionData.options,\n\t\t\tmaxAge: dontRememberMe ? void 0 : ctx.context.authCookies.sessionData.options.maxAge\n\t\t};\n\t\tconst expiresAtDate = getDate(options.maxAge || 60, \"sec\").getTime();\n\t\tconst strategy = ctx.context.options.session?.cookieCache?.strategy || \"compact\";\n\t\tlet data;\n\t\tif (strategy === \"jwe\") data = await symmetricEncodeJWT(sessionData, ctx.context.secret, \"better-auth-session\", options.maxAge || 300);\n\t\telse if (strategy === \"jwt\") data = await signJWT(sessionData, ctx.context.secret, options.maxAge || 300);\n\t\telse data = base64Url.encode(JSON.stringify({\n\t\t\tsession: sessionData,\n\t\t\texpiresAt: expiresAtDate,\n\t\t\tsignature: await createHMAC(\"SHA-256\", \"base64urlnopad\").sign(ctx.context.secret, JSON.stringify({\n\t\t\t\t...sessionData,\n\t\t\t\texpiresAt: expiresAtDate\n\t\t\t}))\n\t\t}), { padding: false });\n\t\tif (data.length > 4093) {\n\t\t\tconst sessionStore = createSessionStore(ctx.context.authCookies.sessionData.name, options, ctx);\n\t\t\tconst cookies = sessionStore.chunk(data, options);\n\t\t\tsessionStore.setCookies(cookies);\n\t\t} else {\n\t\t\tconst sessionStore = createSessionStore(ctx.context.authCookies.sessionData.name, options, ctx);\n\t\t\tif (sessionStore.hasChunks()) {\n\t\t\t\tconst cleanCookies = sessionStore.clean();\n\t\t\t\tsessionStore.setCookies(cleanCookies);\n\t\t\t}\n\t\t\tctx.setCookie(ctx.context.authCookies.sessionData.name, data, options);\n\t\t}\n\t}\n}\nasync function setSessionCookie(ctx, session, dontRememberMe, overrides) {\n\tconst dontRememberMeCookie = await ctx.getSignedCookie(ctx.context.authCookies.dontRememberToken.name, ctx.context.secret);\n\tdontRememberMe = dontRememberMe !== void 0 ? dontRememberMe : !!dontRememberMeCookie;\n\tconst options = ctx.context.authCookies.sessionToken.options;\n\tconst maxAge = dontRememberMe ? void 0 : ctx.context.sessionConfig.expiresIn;\n\tawait ctx.setSignedCookie(ctx.context.authCookies.sessionToken.name, session.session.token, ctx.context.secret, {\n\t\t...options,\n\t\tmaxAge,\n\t\t...overrides\n\t});\n\tif (dontRememberMe) await ctx.setSignedCookie(ctx.context.authCookies.dontRememberToken.name, \"true\", ctx.context.secret, ctx.context.authCookies.dontRememberToken.options);\n\tawait setCookieCache(ctx, session, dontRememberMe);\n\tctx.context.setNewSession(session);\n\t/**\n\t* If secondary storage is enabled, store the session data in the secondary storage\n\t* This is useful if the session got updated and we want to update the session data in the\n\t* secondary storage\n\t*/\n\tif (ctx.context.options.secondaryStorage) await ctx.context.secondaryStorage?.set(session.session.token, JSON.stringify({\n\t\tuser: session.user,\n\t\tsession: session.session\n\t}), Math.floor((new Date(session.session.expiresAt).getTime() - Date.now()) / 1e3));\n}\nfunction deleteSessionCookie(ctx, skipDontRememberMe) {\n\tctx.setCookie(ctx.context.authCookies.sessionToken.name, \"\", {\n\t\t...ctx.context.authCookies.sessionToken.options,\n\t\tmaxAge: 0\n\t});\n\tconst sessionStore = createSessionStore(ctx.context.authCookies.sessionData.name, ctx.context.authCookies.sessionData.options, ctx);\n\tconst cleanCookies = sessionStore.clean();\n\tsessionStore.setCookies(cleanCookies);\n\tif (!skipDontRememberMe) ctx.setCookie(ctx.context.authCookies.dontRememberToken.name, \"\", {\n\t\t...ctx.context.authCookies.dontRememberToken.options,\n\t\tmaxAge: 0\n\t});\n}\nfunction parseCookies(cookieHeader) {\n\tconst cookies = cookieHeader.split(\"; \");\n\tconst cookieMap = /* @__PURE__ */ new Map();\n\tcookies.forEach((cookie) => {\n\t\tconst [name, value] = cookie.split(\"=\");\n\t\tcookieMap.set(name, value);\n\t});\n\treturn cookieMap;\n}\nconst getSessionCookie = (request, config) => {\n\tif (config?.cookiePrefix) if (config.cookieName) config.cookiePrefix = `${config.cookiePrefix}-`;\n\telse config.cookiePrefix = `${config.cookiePrefix}.`;\n\tconst headers = \"headers\" in request ? request.headers : request;\n\tconst req = request instanceof Request ? request : void 0;\n\tgetBaseURL(req?.url, config?.path, req);\n\tconst cookies = headers.get(\"cookie\");\n\tif (!cookies) return null;\n\tconst { cookieName = \"session_token\", cookiePrefix = \"better-auth.\" } = config || {};\n\tconst name = `${cookiePrefix}${cookieName}`;\n\tconst secureCookieName = `__Secure-${name}`;\n\tconst parsedCookie = parseCookies(cookies);\n\tconst sessionToken = parsedCookie.get(name) || parsedCookie.get(secureCookieName);\n\tif (sessionToken) return sessionToken;\n\treturn null;\n};\nconst getCookieCache = async (request, config) => {\n\tconst cookies = (request instanceof Headers ? request : request.headers).get(\"cookie\");\n\tif (!cookies) return null;\n\tconst { cookieName = \"session_data\", cookiePrefix = \"better-auth\" } = config || {};\n\tconst name = config?.isSecure !== void 0 ? config.isSecure ? `__Secure-${cookiePrefix}.${cookieName}` : `${cookiePrefix}.${cookieName}` : isProduction ? `__Secure-${cookiePrefix}.${cookieName}` : `${cookiePrefix}.${cookieName}`;\n\tconst parsedCookie = parseCookies(cookies);\n\tlet sessionData = parsedCookie.get(name);\n\tif (!sessionData) {\n\t\tconst chunks = [];\n\t\tfor (const [cookieName$1, value] of parsedCookie.entries()) if (cookieName$1.startsWith(name + \".\")) {\n\t\t\tconst parts = cookieName$1.split(\".\");\n\t\t\tconst indexStr = parts[parts.length - 1];\n\t\t\tconst index = parseInt(indexStr || \"0\", 10);\n\t\t\tif (!isNaN(index)) chunks.push({\n\t\t\t\tindex,\n\t\t\t\tvalue\n\t\t\t});\n\t\t}\n\t\tif (chunks.length > 0) {\n\t\t\tchunks.sort((a, b) => a.index - b.index);\n\t\t\tsessionData = chunks.map((c) => c.value).join(\"\");\n\t\t}\n\t}\n\tif (sessionData) {\n\t\tconst secret = config?.secret || env.BETTER_AUTH_SECRET;\n\t\tif (!secret) throw new BetterAuthError(\"getCookieCache requires a secret to be provided. Either pass it as an option or set the BETTER_AUTH_SECRET environment variable\");\n\t\tconst strategy = config?.strategy || \"compact\";\n\t\tif (strategy === \"jwe\") {\n\t\t\tconst payload = await symmetricDecodeJWT(sessionData, secret, \"better-auth-session\");\n\t\t\tif (payload && payload.session && payload.user) {\n\t\t\t\tif (config?.version) {\n\t\t\t\t\tconst cookieVersion = payload.version || \"1\";\n\t\t\t\t\tlet expectedVersion = \"1\";\n\t\t\t\t\tif (typeof config.version === \"string\") expectedVersion = config.version;\n\t\t\t\t\telse if (typeof config.version === \"function\") {\n\t\t\t\t\t\tconst result = config.version(payload.session, payload.user);\n\t\t\t\t\t\texpectedVersion = result instanceof Promise ? await result : result;\n\t\t\t\t\t}\n\t\t\t\t\tif (cookieVersion !== expectedVersion) return null;\n\t\t\t\t}\n\t\t\t\treturn payload;\n\t\t\t}\n\t\t\treturn null;\n\t\t} else if (strategy === \"jwt\") {\n\t\t\tconst payload = await verifyJWT(sessionData, secret);\n\t\t\tif (payload && payload.session && payload.user) {\n\t\t\t\tif (config?.version) {\n\t\t\t\t\tconst cookieVersion = payload.version || \"1\";\n\t\t\t\t\tlet expectedVersion = \"1\";\n\t\t\t\t\tif (typeof config.version === \"string\") expectedVersion = config.version;\n\t\t\t\t\telse if (typeof config.version === \"function\") {\n\t\t\t\t\t\tconst result = config.version(payload.session, payload.user);\n\t\t\t\t\t\texpectedVersion = result instanceof Promise ? await result : result;\n\t\t\t\t\t}\n\t\t\t\t\tif (cookieVersion !== expectedVersion) return null;\n\t\t\t\t}\n\t\t\t\treturn payload;\n\t\t\t}\n\t\t\treturn null;\n\t\t} else {\n\t\t\tconst sessionDataPayload = safeJSONParse(binary.decode(base64Url.decode(sessionData)));\n\t\t\tif (!sessionDataPayload) return null;\n\t\t\tif (!await createHMAC(\"SHA-256\", \"base64urlnopad\").verify(secret, JSON.stringify({\n\t\t\t\t...sessionDataPayload.session,\n\t\t\t\texpiresAt: sessionDataPayload.expiresAt\n\t\t\t}), sessionDataPayload.signature)) return null;\n\t\t\tif (config?.version && sessionDataPayload.session) {\n\t\t\t\tconst cookieVersion = sessionDataPayload.session.version || \"1\";\n\t\t\t\tlet expectedVersion = \"1\";\n\t\t\t\tif (typeof config.version === \"string\") expectedVersion = config.version;\n\t\t\t\telse if (typeof config.version === \"function\") {\n\t\t\t\t\tconst result = config.version(sessionDataPayload.session.session, sessionDataPayload.session.user);\n\t\t\t\t\texpectedVersion = result instanceof Promise ? await result : result;\n\t\t\t\t}\n\t\t\t\tif (cookieVersion !== expectedVersion) return null;\n\t\t\t}\n\t\t\treturn sessionDataPayload.session;\n\t\t}\n\t}\n\treturn null;\n};\n\n//#endregion\nexport { getSessionCookie as a, setSessionCookie as c, createSessionStore as d, getAccountCookie as f, setAccountCookie as h, getCookies as i, parseSetCookieHeader as l, getSessionQuerySchema as m, deleteSessionCookie as n, parseCookies as o, getChunkedCookie as p, getCookieCache as r, setCookieCache as s, createCookieGetter as t, setCookieToHeader as u };","import { entityKind, is } from \"../entity.js\";\nimport { SelectionProxyHandler } from \"../selection-proxy.js\";\nimport { getTableColumns } from \"../utils.js\";\nimport { QueryBuilder } from \"./query-builders/query-builder.js\";\nimport { pgTable } from \"./table.js\";\nimport { PgViewBase } from \"./view-base.js\";\nimport { PgViewConfig } from \"./view-common.js\";\nclass DefaultViewBuilderCore {\n  constructor(name, schema) {\n    this.name = name;\n    this.schema = schema;\n  }\n  static [entityKind] = \"PgDefaultViewBuilderCore\";\n  config = {};\n  with(config) {\n    this.config.with = config;\n    return this;\n  }\n}\nclass ViewBuilder extends DefaultViewBuilderCore {\n  static [entityKind] = \"PgViewBuilder\";\n  as(qb) {\n    if (typeof qb === \"function\") {\n      qb = qb(new QueryBuilder());\n    }\n    const selectionProxy = new SelectionProxyHandler({\n      alias: this.name,\n      sqlBehavior: \"error\",\n      sqlAliasedBehavior: \"alias\",\n      replaceOriginalName: true\n    });\n    const aliasedSelection = new Proxy(qb.getSelectedFields(), selectionProxy);\n    return new Proxy(\n      new PgView({\n        pgConfig: this.config,\n        config: {\n          name: this.name,\n          schema: this.schema,\n          selectedFields: aliasedSelection,\n          query: qb.getSQL().inlineParams()\n        }\n      }),\n      selectionProxy\n    );\n  }\n}\nclass ManualViewBuilder extends DefaultViewBuilderCore {\n  static [entityKind] = \"PgManualViewBuilder\";\n  columns;\n  constructor(name, columns, schema) {\n    super(name, schema);\n    this.columns = getTableColumns(pgTable(name, columns));\n  }\n  existing() {\n    return new Proxy(\n      new PgView({\n        pgConfig: void 0,\n        config: {\n          name: this.name,\n          schema: this.schema,\n          selectedFields: this.columns,\n          query: void 0\n        }\n      }),\n      new SelectionProxyHandler({\n        alias: this.name,\n        sqlBehavior: \"error\",\n        sqlAliasedBehavior: \"alias\",\n        replaceOriginalName: true\n      })\n    );\n  }\n  as(query) {\n    return new Proxy(\n      new PgView({\n        pgConfig: this.config,\n        config: {\n          name: this.name,\n          schema: this.schema,\n          selectedFields: this.columns,\n          query: query.inlineParams()\n        }\n      }),\n      new SelectionProxyHandler({\n        alias: this.name,\n        sqlBehavior: \"error\",\n        sqlAliasedBehavior: \"alias\",\n        replaceOriginalName: true\n      })\n    );\n  }\n}\nclass MaterializedViewBuilderCore {\n  constructor(name, schema) {\n    this.name = name;\n    this.schema = schema;\n  }\n  static [entityKind] = \"PgMaterializedViewBuilderCore\";\n  config = {};\n  using(using) {\n    this.config.using = using;\n    return this;\n  }\n  with(config) {\n    this.config.with = config;\n    return this;\n  }\n  tablespace(tablespace) {\n    this.config.tablespace = tablespace;\n    return this;\n  }\n  withNoData() {\n    this.config.withNoData = true;\n    return this;\n  }\n}\nclass MaterializedViewBuilder extends MaterializedViewBuilderCore {\n  static [entityKind] = \"PgMaterializedViewBuilder\";\n  as(qb) {\n    if (typeof qb === \"function\") {\n      qb = qb(new QueryBuilder());\n    }\n    const selectionProxy = new SelectionProxyHandler({\n      alias: this.name,\n      sqlBehavior: \"error\",\n      sqlAliasedBehavior: \"alias\",\n      replaceOriginalName: true\n    });\n    const aliasedSelection = new Proxy(qb.getSelectedFields(), selectionProxy);\n    return new Proxy(\n      new PgMaterializedView({\n        pgConfig: {\n          with: this.config.with,\n          using: this.config.using,\n          tablespace: this.config.tablespace,\n          withNoData: this.config.withNoData\n        },\n        config: {\n          name: this.name,\n          schema: this.schema,\n          selectedFields: aliasedSelection,\n          query: qb.getSQL().inlineParams()\n        }\n      }),\n      selectionProxy\n    );\n  }\n}\nclass ManualMaterializedViewBuilder extends MaterializedViewBuilderCore {\n  static [entityKind] = \"PgManualMaterializedViewBuilder\";\n  columns;\n  constructor(name, columns, schema) {\n    super(name, schema);\n    this.columns = getTableColumns(pgTable(name, columns));\n  }\n  existing() {\n    return new Proxy(\n      new PgMaterializedView({\n        pgConfig: {\n          tablespace: this.config.tablespace,\n          using: this.config.using,\n          with: this.config.with,\n          withNoData: this.config.withNoData\n        },\n        config: {\n          name: this.name,\n          schema: this.schema,\n          selectedFields: this.columns,\n          query: void 0\n        }\n      }),\n      new SelectionProxyHandler({\n        alias: this.name,\n        sqlBehavior: \"error\",\n        sqlAliasedBehavior: \"alias\",\n        replaceOriginalName: true\n      })\n    );\n  }\n  as(query) {\n    return new Proxy(\n      new PgMaterializedView({\n        pgConfig: {\n          tablespace: this.config.tablespace,\n          using: this.config.using,\n          with: this.config.with,\n          withNoData: this.config.withNoData\n        },\n        config: {\n          name: this.name,\n          schema: this.schema,\n          selectedFields: this.columns,\n          query: query.inlineParams()\n        }\n      }),\n      new SelectionProxyHandler({\n        alias: this.name,\n        sqlBehavior: \"error\",\n        sqlAliasedBehavior: \"alias\",\n        replaceOriginalName: true\n      })\n    );\n  }\n}\nclass PgView extends PgViewBase {\n  static [entityKind] = \"PgView\";\n  [PgViewConfig];\n  constructor({ pgConfig, config }) {\n    super(config);\n    if (pgConfig) {\n      this[PgViewConfig] = {\n        with: pgConfig.with\n      };\n    }\n  }\n}\nconst PgMaterializedViewConfig = Symbol.for(\"drizzle:PgMaterializedViewConfig\");\nclass PgMaterializedView extends PgViewBase {\n  static [entityKind] = \"PgMaterializedView\";\n  [PgMaterializedViewConfig];\n  constructor({ pgConfig, config }) {\n    super(config);\n    this[PgMaterializedViewConfig] = {\n      with: pgConfig?.with,\n      using: pgConfig?.using,\n      tablespace: pgConfig?.tablespace,\n      withNoData: pgConfig?.withNoData\n    };\n  }\n}\nfunction pgViewWithSchema(name, selection, schema) {\n  if (selection) {\n    return new ManualViewBuilder(name, selection, schema);\n  }\n  return new ViewBuilder(name, schema);\n}\nfunction pgMaterializedViewWithSchema(name, selection, schema) {\n  if (selection) {\n    return new ManualMaterializedViewBuilder(name, selection, schema);\n  }\n  return new MaterializedViewBuilder(name, schema);\n}\nfunction pgView(name, columns) {\n  return pgViewWithSchema(name, columns, void 0);\n}\nfunction pgMaterializedView(name, columns) {\n  return pgMaterializedViewWithSchema(name, columns, void 0);\n}\nfunction isPgView(obj) {\n  return is(obj, PgView);\n}\nfunction isPgMaterializedView(obj) {\n  return is(obj, PgMaterializedView);\n}\nexport {\n  DefaultViewBuilderCore,\n  ManualMaterializedViewBuilder,\n  ManualViewBuilder,\n  MaterializedViewBuilder,\n  MaterializedViewBuilderCore,\n  PgMaterializedView,\n  PgMaterializedViewConfig,\n  PgView,\n  ViewBuilder,\n  isPgMaterializedView,\n  isPgView,\n  pgMaterializedView,\n  pgMaterializedViewWithSchema,\n  pgView,\n  pgViewWithSchema\n};\n//# sourceMappingURL=view.js.map","import { ColumnBuilder } from \"../../column-builder.js\";\nimport { Column } from \"../../column.js\";\nimport { entityKind, is } from \"../../entity.js\";\nimport { ForeignKeyBuilder } from \"../foreign-keys.js\";\nimport { iife } from \"../../tracing-utils.js\";\nimport { uniqueKeyName } from \"../unique-constraint.js\";\nimport { makePgArray, parsePgArray } from \"../utils/array.js\";\nclass PgColumnBuilder extends ColumnBuilder {\n  foreignKeyConfigs = [];\n  static [entityKind] = \"PgColumnBuilder\";\n  array(size) {\n    return new PgArrayBuilder(this.config.name, this, size);\n  }\n  references(ref, actions = {}) {\n    this.foreignKeyConfigs.push({ ref, actions });\n    return this;\n  }\n  unique(name, config) {\n    this.config.isUnique = true;\n    this.config.uniqueName = name;\n    this.config.uniqueType = config?.nulls;\n    return this;\n  }\n  generatedAlwaysAs(as) {\n    this.config.generated = {\n      as,\n      type: \"always\",\n      mode: \"stored\"\n    };\n    return this;\n  }\n  /** @internal */\n  buildForeignKeys(column, table) {\n    return this.foreignKeyConfigs.map(({ ref, actions }) => {\n      return iife(\n        (ref2, actions2) => {\n          const builder = new ForeignKeyBuilder(() => {\n            const foreignColumn = ref2();\n            return { columns: [column], foreignColumns: [foreignColumn] };\n          });\n          if (actions2.onUpdate) {\n            builder.onUpdate(actions2.onUpdate);\n          }\n          if (actions2.onDelete) {\n            builder.onDelete(actions2.onDelete);\n          }\n          return builder.build(table);\n        },\n        ref,\n        actions\n      );\n    });\n  }\n  /** @internal */\n  buildExtraConfigColumn(table) {\n    return new ExtraConfigColumn(table, this.config);\n  }\n}\nclass PgColumn extends Column {\n  constructor(table, config) {\n    if (!config.uniqueName) {\n      config.uniqueName = uniqueKeyName(table, [config.name]);\n    }\n    super(table, config);\n    this.table = table;\n  }\n  static [entityKind] = \"PgColumn\";\n}\nclass ExtraConfigColumn extends PgColumn {\n  static [entityKind] = \"ExtraConfigColumn\";\n  getSQLType() {\n    return this.getSQLType();\n  }\n  indexConfig = {\n    order: this.config.order ?? \"asc\",\n    nulls: this.config.nulls ?? \"last\",\n    opClass: this.config.opClass\n  };\n  defaultConfig = {\n    order: \"asc\",\n    nulls: \"last\",\n    opClass: void 0\n  };\n  asc() {\n    this.indexConfig.order = \"asc\";\n    return this;\n  }\n  desc() {\n    this.indexConfig.order = \"desc\";\n    return this;\n  }\n  nullsFirst() {\n    this.indexConfig.nulls = \"first\";\n    return this;\n  }\n  nullsLast() {\n    this.indexConfig.nulls = \"last\";\n    return this;\n  }\n  /**\n   * ### PostgreSQL documentation quote\n   *\n   * > An operator class with optional parameters can be specified for each column of an index.\n   * The operator class identifies the operators to be used by the index for that column.\n   * For example, a B-tree index on four-byte integers would use the int4_ops class;\n   * this operator class includes comparison functions for four-byte integers.\n   * In practice the default operator class for the column's data type is usually sufficient.\n   * The main point of having operator classes is that for some data types, there could be more than one meaningful ordering.\n   * For example, we might want to sort a complex-number data type either by absolute value or by real part.\n   * We could do this by defining two operator classes for the data type and then selecting the proper class when creating an index.\n   * More information about operator classes check:\n   *\n   * ### Useful links\n   * https://www.postgresql.org/docs/current/sql-createindex.html\n   *\n   * https://www.postgresql.org/docs/current/indexes-opclass.html\n   *\n   * https://www.postgresql.org/docs/current/xindex.html\n   *\n   * ### Additional types\n   * If you have the `pg_vector` extension installed in your database, you can use the\n   * `vector_l2_ops`, `vector_ip_ops`, `vector_cosine_ops`, `vector_l1_ops`, `bit_hamming_ops`, `bit_jaccard_ops`, `halfvec_l2_ops`, `sparsevec_l2_ops` options, which are predefined types.\n   *\n   * **You can always specify any string you want in the operator class, in case Drizzle doesn't have it natively in its types**\n   *\n   * @param opClass\n   * @returns\n   */\n  op(opClass) {\n    this.indexConfig.opClass = opClass;\n    return this;\n  }\n}\nclass IndexedColumn {\n  static [entityKind] = \"IndexedColumn\";\n  constructor(name, keyAsName, type, indexConfig) {\n    this.name = name;\n    this.keyAsName = keyAsName;\n    this.type = type;\n    this.indexConfig = indexConfig;\n  }\n  name;\n  keyAsName;\n  type;\n  indexConfig;\n}\nclass PgArrayBuilder extends PgColumnBuilder {\n  static [entityKind] = \"PgArrayBuilder\";\n  constructor(name, baseBuilder, size) {\n    super(name, \"array\", \"PgArray\");\n    this.config.baseBuilder = baseBuilder;\n    this.config.size = size;\n  }\n  /** @internal */\n  build(table) {\n    const baseColumn = this.config.baseBuilder.build(table);\n    return new PgArray(\n      table,\n      this.config,\n      baseColumn\n    );\n  }\n}\nclass PgArray extends PgColumn {\n  constructor(table, config, baseColumn, range) {\n    super(table, config);\n    this.baseColumn = baseColumn;\n    this.range = range;\n    this.size = config.size;\n  }\n  size;\n  static [entityKind] = \"PgArray\";\n  getSQLType() {\n    return `${this.baseColumn.getSQLType()}[${typeof this.size === \"number\" ? this.size : \"\"}]`;\n  }\n  mapFromDriverValue(value) {\n    if (typeof value === \"string\") {\n      value = parsePgArray(value);\n    }\n    return value.map((v) => this.baseColumn.mapFromDriverValue(v));\n  }\n  mapToDriverValue(value, isNestedArray = false) {\n    const a = value.map(\n      (v) => v === null ? null : is(this.baseColumn, PgArray) ? this.baseColumn.mapToDriverValue(v, true) : this.baseColumn.mapToDriverValue(v)\n    );\n    if (isNestedArray) return a;\n    return makePgArray(a);\n  }\n}\nexport {\n  ExtraConfigColumn,\n  IndexedColumn,\n  PgArray,\n  PgArrayBuilder,\n  PgColumn,\n  PgColumnBuilder\n};\n//# sourceMappingURL=common.js.map","import { entityKind } from \"../../entity.js\";\nimport { QueryPromise } from \"../../query-promise.js\";\nimport { SelectionProxyHandler } from \"../../selection-proxy.js\";\nimport { getTableName, Table } from \"../../table.js\";\nimport { tracer } from \"../../tracing.js\";\nimport { orderSelectedFields } from \"../../utils.js\";\nimport { extractUsedTable } from \"../utils.js\";\nclass PgDeleteBase extends QueryPromise {\n  constructor(table, session, dialect, withList) {\n    super();\n    this.session = session;\n    this.dialect = dialect;\n    this.config = { table, withList };\n  }\n  static [entityKind] = \"PgDelete\";\n  config;\n  cacheConfig;\n  /**\n   * Adds a `where` clause to the query.\n   *\n   * Calling this method will delete only those rows that fulfill a specified condition.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/delete}\n   *\n   * @param where the `where` clause.\n   *\n   * @example\n   * You can use conditional operators and `sql function` to filter the rows to be deleted.\n   *\n   * ```ts\n   * // Delete all cars with green color\n   * await db.delete(cars).where(eq(cars.color, 'green'));\n   * // or\n   * await db.delete(cars).where(sql`${cars.color} = 'green'`)\n   * ```\n   *\n   * You can logically combine conditional operators with `and()` and `or()` operators:\n   *\n   * ```ts\n   * // Delete all BMW cars with a green color\n   * await db.delete(cars).where(and(eq(cars.color, 'green'), eq(cars.brand, 'BMW')));\n   *\n   * // Delete all cars with the green or blue color\n   * await db.delete(cars).where(or(eq(cars.color, 'green'), eq(cars.color, 'blue')));\n   * ```\n   */\n  where(where) {\n    this.config.where = where;\n    return this;\n  }\n  returning(fields = this.config.table[Table.Symbol.Columns]) {\n    this.config.returningFields = fields;\n    this.config.returning = orderSelectedFields(fields);\n    return this;\n  }\n  /** @internal */\n  getSQL() {\n    return this.dialect.buildDeleteQuery(this.config);\n  }\n  toSQL() {\n    const { typings: _typings, ...rest } = this.dialect.sqlToQuery(this.getSQL());\n    return rest;\n  }\n  /** @internal */\n  _prepare(name) {\n    return tracer.startActiveSpan(\"drizzle.prepareQuery\", () => {\n      return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()), this.config.returning, name, true, void 0, {\n        type: \"delete\",\n        tables: extractUsedTable(this.config.table)\n      }, this.cacheConfig);\n    });\n  }\n  prepare(name) {\n    return this._prepare(name);\n  }\n  authToken;\n  /** @internal */\n  setToken(token) {\n    this.authToken = token;\n    return this;\n  }\n  execute = (placeholderValues) => {\n    return tracer.startActiveSpan(\"drizzle.operation\", () => {\n      return this._prepare().execute(placeholderValues, this.authToken);\n    });\n  };\n  /** @internal */\n  getSelectedFields() {\n    return this.config.returningFields ? new Proxy(\n      this.config.returningFields,\n      new SelectionProxyHandler({\n        alias: getTableName(this.config.table),\n        sqlAliasedBehavior: \"alias\",\n        sqlBehavior: \"error\"\n      })\n    ) : void 0;\n  }\n  $dynamic() {\n    return this;\n  }\n}\nexport {\n  PgDeleteBase\n};\n//# sourceMappingURL=delete.js.map","import { entityKind, is } from \"../entity.js\";\nimport { isPgEnum } from \"../pg-core/columns/enum.js\";\nimport { Subquery } from \"../subquery.js\";\nimport { tracer } from \"../tracing.js\";\nimport { ViewBaseConfig } from \"../view-common.js\";\nimport { Column } from \"../column.js\";\nimport { IsAlias, Table } from \"../table.js\";\nclass FakePrimitiveParam {\n  static [entityKind] = \"FakePrimitiveParam\";\n}\nfunction isSQLWrapper(value) {\n  return value !== null && value !== void 0 && typeof value.getSQL === \"function\";\n}\nfunction mergeQueries(queries) {\n  const result = { sql: \"\", params: [] };\n  for (const query of queries) {\n    result.sql += query.sql;\n    result.params.push(...query.params);\n    if (query.typings?.length) {\n      if (!result.typings) {\n        result.typings = [];\n      }\n      result.typings.push(...query.typings);\n    }\n  }\n  return result;\n}\nclass StringChunk {\n  static [entityKind] = \"StringChunk\";\n  value;\n  constructor(value) {\n    this.value = Array.isArray(value) ? value : [value];\n  }\n  getSQL() {\n    return new SQL([this]);\n  }\n}\nclass SQL {\n  constructor(queryChunks) {\n    this.queryChunks = queryChunks;\n    for (const chunk of queryChunks) {\n      if (is(chunk, Table)) {\n        const schemaName = chunk[Table.Symbol.Schema];\n        this.usedTables.push(\n          schemaName === void 0 ? chunk[Table.Symbol.Name] : schemaName + \".\" + chunk[Table.Symbol.Name]\n        );\n      }\n    }\n  }\n  static [entityKind] = \"SQL\";\n  /** @internal */\n  decoder = noopDecoder;\n  shouldInlineParams = false;\n  /** @internal */\n  usedTables = [];\n  append(query) {\n    this.queryChunks.push(...query.queryChunks);\n    return this;\n  }\n  toQuery(config) {\n    return tracer.startActiveSpan(\"drizzle.buildSQL\", (span) => {\n      const query = this.buildQueryFromSourceParams(this.queryChunks, config);\n      span?.setAttributes({\n        \"drizzle.query.text\": query.sql,\n        \"drizzle.query.params\": JSON.stringify(query.params)\n      });\n      return query;\n    });\n  }\n  buildQueryFromSourceParams(chunks, _config) {\n    const config = Object.assign({}, _config, {\n      inlineParams: _config.inlineParams || this.shouldInlineParams,\n      paramStartIndex: _config.paramStartIndex || { value: 0 }\n    });\n    const {\n      casing,\n      escapeName,\n      escapeParam,\n      prepareTyping,\n      inlineParams,\n      paramStartIndex\n    } = config;\n    return mergeQueries(chunks.map((chunk) => {\n      if (is(chunk, StringChunk)) {\n        return { sql: chunk.value.join(\"\"), params: [] };\n      }\n      if (is(chunk, Name)) {\n        return { sql: escapeName(chunk.value), params: [] };\n      }\n      if (chunk === void 0) {\n        return { sql: \"\", params: [] };\n      }\n      if (Array.isArray(chunk)) {\n        const result = [new StringChunk(\"(\")];\n        for (const [i, p] of chunk.entries()) {\n          result.push(p);\n          if (i < chunk.length - 1) {\n            result.push(new StringChunk(\", \"));\n          }\n        }\n        result.push(new StringChunk(\")\"));\n        return this.buildQueryFromSourceParams(result, config);\n      }\n      if (is(chunk, SQL)) {\n        return this.buildQueryFromSourceParams(chunk.queryChunks, {\n          ...config,\n          inlineParams: inlineParams || chunk.shouldInlineParams\n        });\n      }\n      if (is(chunk, Table)) {\n        const schemaName = chunk[Table.Symbol.Schema];\n        const tableName = chunk[Table.Symbol.Name];\n        return {\n          sql: schemaName === void 0 || chunk[IsAlias] ? escapeName(tableName) : escapeName(schemaName) + \".\" + escapeName(tableName),\n          params: []\n        };\n      }\n      if (is(chunk, Column)) {\n        const columnName = casing.getColumnCasing(chunk);\n        if (_config.invokeSource === \"indexes\") {\n          return { sql: escapeName(columnName), params: [] };\n        }\n        const schemaName = chunk.table[Table.Symbol.Schema];\n        return {\n          sql: chunk.table[IsAlias] || schemaName === void 0 ? escapeName(chunk.table[Table.Symbol.Name]) + \".\" + escapeName(columnName) : escapeName(schemaName) + \".\" + escapeName(chunk.table[Table.Symbol.Name]) + \".\" + escapeName(columnName),\n          params: []\n        };\n      }\n      if (is(chunk, View)) {\n        const schemaName = chunk[ViewBaseConfig].schema;\n        const viewName = chunk[ViewBaseConfig].name;\n        return {\n          sql: schemaName === void 0 || chunk[ViewBaseConfig].isAlias ? escapeName(viewName) : escapeName(schemaName) + \".\" + escapeName(viewName),\n          params: []\n        };\n      }\n      if (is(chunk, Param)) {\n        if (is(chunk.value, Placeholder)) {\n          return { sql: escapeParam(paramStartIndex.value++, chunk), params: [chunk], typings: [\"none\"] };\n        }\n        const mappedValue = chunk.value === null ? null : chunk.encoder.mapToDriverValue(chunk.value);\n        if (is(mappedValue, SQL)) {\n          return this.buildQueryFromSourceParams([mappedValue], config);\n        }\n        if (inlineParams) {\n          return { sql: this.mapInlineParam(mappedValue, config), params: [] };\n        }\n        let typings = [\"none\"];\n        if (prepareTyping) {\n          typings = [prepareTyping(chunk.encoder)];\n        }\n        return { sql: escapeParam(paramStartIndex.value++, mappedValue), params: [mappedValue], typings };\n      }\n      if (is(chunk, Placeholder)) {\n        return { sql: escapeParam(paramStartIndex.value++, chunk), params: [chunk], typings: [\"none\"] };\n      }\n      if (is(chunk, SQL.Aliased) && chunk.fieldAlias !== void 0) {\n        return { sql: escapeName(chunk.fieldAlias), params: [] };\n      }\n      if (is(chunk, Subquery)) {\n        if (chunk._.isWith) {\n          return { sql: escapeName(chunk._.alias), params: [] };\n        }\n        return this.buildQueryFromSourceParams([\n          new StringChunk(\"(\"),\n          chunk._.sql,\n          new StringChunk(\") \"),\n          new Name(chunk._.alias)\n        ], config);\n      }\n      if (isPgEnum(chunk)) {\n        if (chunk.schema) {\n          return { sql: escapeName(chunk.schema) + \".\" + escapeName(chunk.enumName), params: [] };\n        }\n        return { sql: escapeName(chunk.enumName), params: [] };\n      }\n      if (isSQLWrapper(chunk)) {\n        if (chunk.shouldOmitSQLParens?.()) {\n          return this.buildQueryFromSourceParams([chunk.getSQL()], config);\n        }\n        return this.buildQueryFromSourceParams([\n          new StringChunk(\"(\"),\n          chunk.getSQL(),\n          new StringChunk(\")\")\n        ], config);\n      }\n      if (inlineParams) {\n        return { sql: this.mapInlineParam(chunk, config), params: [] };\n      }\n      return { sql: escapeParam(paramStartIndex.value++, chunk), params: [chunk], typings: [\"none\"] };\n    }));\n  }\n  mapInlineParam(chunk, { escapeString }) {\n    if (chunk === null) {\n      return \"null\";\n    }\n    if (typeof chunk === \"number\" || typeof chunk === \"boolean\") {\n      return chunk.toString();\n    }\n    if (typeof chunk === \"string\") {\n      return escapeString(chunk);\n    }\n    if (typeof chunk === \"object\") {\n      const mappedValueAsString = chunk.toString();\n      if (mappedValueAsString === \"[object Object]\") {\n        return escapeString(JSON.stringify(chunk));\n      }\n      return escapeString(mappedValueAsString);\n    }\n    throw new Error(\"Unexpected param value: \" + chunk);\n  }\n  getSQL() {\n    return this;\n  }\n  as(alias) {\n    if (alias === void 0) {\n      return this;\n    }\n    return new SQL.Aliased(this, alias);\n  }\n  mapWith(decoder) {\n    this.decoder = typeof decoder === \"function\" ? { mapFromDriverValue: decoder } : decoder;\n    return this;\n  }\n  inlineParams() {\n    this.shouldInlineParams = true;\n    return this;\n  }\n  /**\n   * This method is used to conditionally include a part of the query.\n   *\n   * @param condition - Condition to check\n   * @returns itself if the condition is `true`, otherwise `undefined`\n   */\n  if(condition) {\n    return condition ? this : void 0;\n  }\n}\nclass Name {\n  constructor(value) {\n    this.value = value;\n  }\n  static [entityKind] = \"Name\";\n  brand;\n  getSQL() {\n    return new SQL([this]);\n  }\n}\nfunction name(value) {\n  return new Name(value);\n}\nfunction isDriverValueEncoder(value) {\n  return typeof value === \"object\" && value !== null && \"mapToDriverValue\" in value && typeof value.mapToDriverValue === \"function\";\n}\nconst noopDecoder = {\n  mapFromDriverValue: (value) => value\n};\nconst noopEncoder = {\n  mapToDriverValue: (value) => value\n};\nconst noopMapper = {\n  ...noopDecoder,\n  ...noopEncoder\n};\nclass Param {\n  /**\n   * @param value - Parameter value\n   * @param encoder - Encoder to convert the value to a driver parameter\n   */\n  constructor(value, encoder = noopEncoder) {\n    this.value = value;\n    this.encoder = encoder;\n  }\n  static [entityKind] = \"Param\";\n  brand;\n  getSQL() {\n    return new SQL([this]);\n  }\n}\nfunction param(value, encoder) {\n  return new Param(value, encoder);\n}\nfunction sql(strings, ...params) {\n  const queryChunks = [];\n  if (params.length > 0 || strings.length > 0 && strings[0] !== \"\") {\n    queryChunks.push(new StringChunk(strings[0]));\n  }\n  for (const [paramIndex, param2] of params.entries()) {\n    queryChunks.push(param2, new StringChunk(strings[paramIndex + 1]));\n  }\n  return new SQL(queryChunks);\n}\n((sql2) => {\n  function empty() {\n    return new SQL([]);\n  }\n  sql2.empty = empty;\n  function fromList(list) {\n    return new SQL(list);\n  }\n  sql2.fromList = fromList;\n  function raw(str) {\n    return new SQL([new StringChunk(str)]);\n  }\n  sql2.raw = raw;\n  function join(chunks, separator) {\n    const result = [];\n    for (const [i, chunk] of chunks.entries()) {\n      if (i > 0 && separator !== void 0) {\n        result.push(separator);\n      }\n      result.push(chunk);\n    }\n    return new SQL(result);\n  }\n  sql2.join = join;\n  function identifier(value) {\n    return new Name(value);\n  }\n  sql2.identifier = identifier;\n  function placeholder2(name2) {\n    return new Placeholder(name2);\n  }\n  sql2.placeholder = placeholder2;\n  function param2(value, encoder) {\n    return new Param(value, encoder);\n  }\n  sql2.param = param2;\n})(sql || (sql = {}));\n((SQL2) => {\n  class Aliased {\n    constructor(sql2, fieldAlias) {\n      this.sql = sql2;\n      this.fieldAlias = fieldAlias;\n    }\n    static [entityKind] = \"SQL.Aliased\";\n    /** @internal */\n    isSelectionField = false;\n    getSQL() {\n      return this.sql;\n    }\n    /** @internal */\n    clone() {\n      return new Aliased(this.sql, this.fieldAlias);\n    }\n  }\n  SQL2.Aliased = Aliased;\n})(SQL || (SQL = {}));\nclass Placeholder {\n  constructor(name2) {\n    this.name = name2;\n  }\n  static [entityKind] = \"Placeholder\";\n  getSQL() {\n    return new SQL([this]);\n  }\n}\nfunction placeholder(name2) {\n  return new Placeholder(name2);\n}\nfunction fillPlaceholders(params, values) {\n  return params.map((p) => {\n    if (is(p, Placeholder)) {\n      if (!(p.name in values)) {\n        throw new Error(`No value for placeholder \"${p.name}\" was provided`);\n      }\n      return values[p.name];\n    }\n    if (is(p, Param) && is(p.value, Placeholder)) {\n      if (!(p.value.name in values)) {\n        throw new Error(`No value for placeholder \"${p.value.name}\" was provided`);\n      }\n      return p.encoder.mapToDriverValue(values[p.value.name]);\n    }\n    return p;\n  });\n}\nconst IsDrizzleView = Symbol.for(\"drizzle:IsDrizzleView\");\nclass View {\n  static [entityKind] = \"View\";\n  /** @internal */\n  [ViewBaseConfig];\n  /** @internal */\n  [IsDrizzleView] = true;\n  constructor({ name: name2, schema, selectedFields, query }) {\n    this[ViewBaseConfig] = {\n      name: name2,\n      originalName: name2,\n      schema,\n      selectedFields,\n      query,\n      isExisting: !query,\n      isAlias: false\n    };\n  }\n  getSQL() {\n    return new SQL([this]);\n  }\n}\nfunction isView(view) {\n  return typeof view === \"object\" && view !== null && IsDrizzleView in view;\n}\nfunction getViewName(view) {\n  return view[ViewBaseConfig].name;\n}\nColumn.prototype.getSQL = function() {\n  return new SQL([this]);\n};\nTable.prototype.getSQL = function() {\n  return new SQL([this]);\n};\nSubquery.prototype.getSQL = function() {\n  return new SQL([this]);\n};\nexport {\n  FakePrimitiveParam,\n  Name,\n  Param,\n  Placeholder,\n  SQL,\n  StringChunk,\n  View,\n  fillPlaceholders,\n  getViewName,\n  isDriverValueEncoder,\n  isSQLWrapper,\n  isView,\n  name,\n  noopDecoder,\n  noopEncoder,\n  noopMapper,\n  param,\n  placeholder,\n  sql\n};\n//# sourceMappingURL=sql.js.map","import { t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport { c as setSessionCookie, l as parseSetCookieHeader, n as deleteSessionCookie, o as parseCookies } from \"./cookies-D72PbWdz.mjs\";\nimport { u as sessionMiddleware } from \"./session-AaRl3_x-.mjs\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\n\n//#region src/plugins/multi-session/index.ts\nconst ERROR_CODES = defineErrorCodes({ INVALID_SESSION_TOKEN: \"Invalid session token\" });\nconst multiSession = (options) => {\n\tconst opts = {\n\t\tmaximumSessions: 5,\n\t\t...options\n\t};\n\tconst isMultiSessionCookie = (key) => key.includes(\"_multi-\");\n\treturn {\n\t\tid: \"multi-session\",\n\t\tendpoints: {\n\t\t\tlistDeviceSessions: createAuthEndpoint(\"/multi-session/list-device-sessions\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\trequireHeaders: true\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst cookieHeader = ctx.headers?.get(\"cookie\");\n\t\t\t\tif (!cookieHeader) return ctx.json([]);\n\t\t\t\tconst cookies = Object.fromEntries(parseCookies(cookieHeader));\n\t\t\t\tconst sessionTokens = (await Promise.all(Object.entries(cookies).filter(([key]) => isMultiSessionCookie(key)).map(async ([key]) => await ctx.getSignedCookie(key, ctx.context.secret)))).filter((v) => typeof v === \"string\");\n\t\t\t\tif (!sessionTokens.length) return ctx.json([]);\n\t\t\t\tconst uniqueUserSessions = (await ctx.context.internalAdapter.findSessions(sessionTokens)).filter((session) => session && session.session.expiresAt > /* @__PURE__ */ new Date()).reduce((acc, session) => {\n\t\t\t\t\tif (!acc.find((s) => s.user.id === session.user.id)) acc.push(session);\n\t\t\t\t\treturn acc;\n\t\t\t\t}, []);\n\t\t\t\treturn ctx.json(uniqueUserSessions);\n\t\t\t}),\n\t\t\tsetActiveSession: createAuthEndpoint(\"/multi-session/set-active\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ sessionToken: z.string().meta({ description: \"The session token to set as active\" }) }),\n\t\t\t\trequireHeaders: true,\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Set the active session\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { session: { $ref: \"#/components/schemas/Session\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst sessionToken = ctx.body.sessionToken;\n\t\t\t\tconst multiSessionCookieName = `${ctx.context.authCookies.sessionToken.name}_multi-${sessionToken.toLowerCase()}`;\n\t\t\t\tif (!await ctx.getSignedCookie(multiSessionCookieName, ctx.context.secret)) throw new APIError(\"UNAUTHORIZED\", { message: ERROR_CODES.INVALID_SESSION_TOKEN });\n\t\t\t\tconst session = await ctx.context.internalAdapter.findSession(sessionToken);\n\t\t\t\tif (!session || session.session.expiresAt < /* @__PURE__ */ new Date()) {\n\t\t\t\t\tctx.setCookie(multiSessionCookieName, \"\", {\n\t\t\t\t\t\t...ctx.context.authCookies.sessionToken.options,\n\t\t\t\t\t\tmaxAge: 0\n\t\t\t\t\t});\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: ERROR_CODES.INVALID_SESSION_TOKEN });\n\t\t\t\t}\n\t\t\t\tawait setSessionCookie(ctx, session);\n\t\t\t\treturn ctx.json(session);\n\t\t\t}),\n\t\t\trevokeDeviceSession: createAuthEndpoint(\"/multi-session/revoke\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ sessionToken: z.string().meta({ description: \"The session token to revoke\" }) }),\n\t\t\t\trequireHeaders: true,\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Revoke a device session\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { status: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst sessionToken = ctx.body.sessionToken;\n\t\t\t\tconst multiSessionCookieName = `${ctx.context.authCookies.sessionToken.name}_multi-${sessionToken.toLowerCase()}`;\n\t\t\t\tif (!await ctx.getSignedCookie(multiSessionCookieName, ctx.context.secret)) throw new APIError(\"UNAUTHORIZED\", { message: ERROR_CODES.INVALID_SESSION_TOKEN });\n\t\t\t\tawait ctx.context.internalAdapter.deleteSession(sessionToken);\n\t\t\t\tctx.setCookie(multiSessionCookieName, \"\", {\n\t\t\t\t\t...ctx.context.authCookies.sessionToken.options,\n\t\t\t\t\tmaxAge: 0\n\t\t\t\t});\n\t\t\t\tif (!(ctx.context.session?.session.token === sessionToken)) return ctx.json({ status: true });\n\t\t\t\tconst cookieHeader = ctx.headers?.get(\"cookie\");\n\t\t\t\tif (cookieHeader) {\n\t\t\t\t\tconst cookies = Object.fromEntries(parseCookies(cookieHeader));\n\t\t\t\t\tconst sessionTokens = (await Promise.all(Object.entries(cookies).filter(([key]) => isMultiSessionCookie(key)).map(async ([key]) => await ctx.getSignedCookie(key, ctx.context.secret)))).filter((v) => typeof v === \"string\");\n\t\t\t\t\tconst internalAdapter = ctx.context.internalAdapter;\n\t\t\t\t\tif (sessionTokens.length > 0) {\n\t\t\t\t\t\tconst validSessions = (await internalAdapter.findSessions(sessionTokens)).filter((session) => session && session.session.expiresAt > /* @__PURE__ */ new Date());\n\t\t\t\t\t\tif (validSessions.length > 0) {\n\t\t\t\t\t\t\tconst nextSession = validSessions[0];\n\t\t\t\t\t\t\tawait setSessionCookie(ctx, nextSession);\n\t\t\t\t\t\t} else deleteSessionCookie(ctx);\n\t\t\t\t\t} else deleteSessionCookie(ctx);\n\t\t\t\t} else deleteSessionCookie(ctx);\n\t\t\t\treturn ctx.json({ status: true });\n\t\t\t})\n\t\t},\n\t\thooks: { after: [{\n\t\t\tmatcher: () => true,\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst cookieString = ctx.context.responseHeaders?.get(\"set-cookie\");\n\t\t\t\tif (!cookieString) return;\n\t\t\t\tconst setCookies = parseSetCookieHeader(cookieString);\n\t\t\t\tconst sessionCookieConfig = ctx.context.authCookies.sessionToken;\n\t\t\t\tconst sessionToken = ctx.context.newSession?.session.token;\n\t\t\t\tif (!sessionToken) return;\n\t\t\t\tconst cookies = parseCookies(ctx.headers?.get(\"cookie\") || \"\");\n\t\t\t\tconst cookieName = `${sessionCookieConfig.name}_multi-${sessionToken.toLowerCase()}`;\n\t\t\t\tif (setCookies.get(cookieName) || cookies.get(cookieName)) return;\n\t\t\t\tif (Object.keys(Object.fromEntries(cookies)).filter(isMultiSessionCookie).length + (cookieString.includes(\"session_token\") ? 1 : 0) >= opts.maximumSessions) return;\n\t\t\t\tawait ctx.setSignedCookie(cookieName, sessionToken, ctx.context.secret, sessionCookieConfig.options);\n\t\t\t})\n\t\t}, {\n\t\t\tmatcher: (context) => context.path === \"/sign-out\",\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst cookieHeader = ctx.headers?.get(\"cookie\");\n\t\t\t\tif (!cookieHeader) return;\n\t\t\t\tconst cookies = Object.fromEntries(parseCookies(cookieHeader));\n\t\t\t\tconst multiSessionKeys = Object.keys(cookies).filter((key) => isMultiSessionCookie(key));\n\t\t\t\tconst verifiedTokens = (await Promise.all(multiSessionKeys.map(async (key) => {\n\t\t\t\t\tconst verifiedToken = await ctx.getSignedCookie(key, ctx.context.secret);\n\t\t\t\t\tif (verifiedToken) {\n\t\t\t\t\t\tctx.setCookie(key.toLowerCase().replace(\"__secure-\", \"__Secure-\"), \"\", {\n\t\t\t\t\t\t\t...ctx.context.authCookies.sessionToken.options,\n\t\t\t\t\t\t\tmaxAge: 0\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn verifiedToken;\n\t\t\t\t\t}\n\t\t\t\t\treturn null;\n\t\t\t\t}))).filter((v) => typeof v === \"string\");\n\t\t\t\tif (verifiedTokens.length > 0) await ctx.context.internalAdapter.deleteSessions(verifiedTokens);\n\t\t\t})\n\t\t}] },\n\t\t$ERROR_CODES: ERROR_CODES\n\t};\n};\n\n//#endregion\nexport { multiSession as t };","import { r as generateRandomString } from \"./crypto-CFUhAR9W.mjs\";\nimport { u as sessionMiddleware } from \"./session-AaRl3_x-.mjs\";\nimport * as z from \"zod\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { base64Url } from \"@better-auth/utils/base64\";\n\n//#region src/plugins/one-time-token/utils.ts\nconst defaultKeyHasher = async (token) => {\n\tconst hash = await createHash(\"SHA-256\").digest(new TextEncoder().encode(token));\n\treturn base64Url.encode(new Uint8Array(hash), { padding: false });\n};\n\n//#endregion\n//#region src/plugins/one-time-token/index.ts\nconst oneTimeToken = (options) => {\n\tconst opts = {\n\t\tstoreToken: \"plain\",\n\t\t...options\n\t};\n\tasync function storeToken(ctx, token) {\n\t\tif (opts.storeToken === \"hashed\") return await defaultKeyHasher(token);\n\t\tif (typeof opts.storeToken === \"object\" && \"type\" in opts.storeToken && opts.storeToken.type === \"custom-hasher\") return await opts.storeToken.hash(token);\n\t\treturn token;\n\t}\n\treturn {\n\t\tid: \"one-time-token\",\n\t\tendpoints: {\n\t\t\tgenerateOneTimeToken: createAuthEndpoint(\"/one-time-token/generate\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tuse: [sessionMiddleware]\n\t\t\t}, async (c) => {\n\t\t\t\tif (opts?.disableClientRequest && c.request) throw c.error(\"BAD_REQUEST\", { message: \"Client requests are disabled\" });\n\t\t\t\tconst session = c.context.session;\n\t\t\t\tconst token = opts?.generateToken ? await opts.generateToken(session, c) : generateRandomString(32);\n\t\t\t\tconst expiresAt = new Date(Date.now() + (opts?.expiresIn ?? 3) * 60 * 1e3);\n\t\t\t\tconst storedToken = await storeToken(c, token);\n\t\t\t\tawait c.context.internalAdapter.createVerificationValue({\n\t\t\t\t\tvalue: session.session.token,\n\t\t\t\t\tidentifier: `one-time-token:${storedToken}`,\n\t\t\t\t\texpiresAt\n\t\t\t\t});\n\t\t\t\treturn c.json({ token });\n\t\t\t}),\n\t\t\tverifyOneTimeToken: createAuthEndpoint(\"/one-time-token/verify\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ token: z.string().meta({ description: \"The token to verify. Eg: \\\"some-token\\\"\" }) })\n\t\t\t}, async (c) => {\n\t\t\t\tconst { token } = c.body;\n\t\t\t\tconst storedToken = await storeToken(c, token);\n\t\t\t\tconst verificationValue = await c.context.internalAdapter.findVerificationValue(`one-time-token:${storedToken}`);\n\t\t\t\tif (!verificationValue) throw c.error(\"BAD_REQUEST\", { message: \"Invalid token\" });\n\t\t\t\tawait c.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\tif (verificationValue.expiresAt < /* @__PURE__ */ new Date()) throw c.error(\"BAD_REQUEST\", { message: \"Token expired\" });\n\t\t\t\tconst session = await c.context.internalAdapter.findSession(verificationValue.value);\n\t\t\t\tif (!session) throw c.error(\"BAD_REQUEST\", { message: \"Session not found\" });\n\t\t\t\treturn c.json(session);\n\t\t\t})\n\t\t}\n\t};\n};\n\n//#endregion\nexport { oneTimeToken as t };","import \"../crypto-CFUhAR9W.mjs\";\nimport \"../schema-Bb7wzeK_.mjs\";\nimport \"../json-CnHxKYpj.mjs\";\nimport \"../url-CB8xCwz-.mjs\";\nimport { l as parseSetCookieHeader } from \"../cookies-D72PbWdz.mjs\";\nimport { createAuthMiddleware } from \"@better-auth/core/api\";\n\n//#region src/integrations/next-js.ts\nfunction toNextJsHandler(auth) {\n\tconst handler = async (request) => {\n\t\treturn \"handler\" in auth ? auth.handler(request) : auth(request);\n\t};\n\treturn {\n\t\tGET: handler,\n\t\tPOST: handler,\n\t\tPATCH: handler,\n\t\tPUT: handler,\n\t\tDELETE: handler\n\t};\n}\nconst nextCookies = () => {\n\treturn {\n\t\tid: \"next-cookies\",\n\t\thooks: { after: [{\n\t\t\tmatcher(ctx) {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst returned = ctx.context.responseHeaders;\n\t\t\t\tif (\"_flag\" in ctx && ctx._flag === \"router\") return;\n\t\t\t\tif (returned instanceof Headers) {\n\t\t\t\t\tconst setCookies = returned?.get(\"set-cookie\");\n\t\t\t\t\tif (!setCookies) return;\n\t\t\t\t\tconst parsed = parseSetCookieHeader(setCookies);\n\t\t\t\t\tconst { cookies } = await import(\"next/headers\");\n\t\t\t\t\tlet cookieHelper;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tcookieHelper = await cookies();\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tif (error instanceof Error && error.message.startsWith(\"`cookies` was called outside a request scope.\")) return;\n\t\t\t\t\t\tthrow error;\n\t\t\t\t\t}\n\t\t\t\t\tparsed.forEach((value, key) => {\n\t\t\t\t\t\tif (!key) return;\n\t\t\t\t\t\tconst opts = {\n\t\t\t\t\t\t\tsameSite: value.samesite,\n\t\t\t\t\t\t\tsecure: value.secure,\n\t\t\t\t\t\t\tmaxAge: value[\"max-age\"],\n\t\t\t\t\t\t\thttpOnly: value.httponly,\n\t\t\t\t\t\t\tdomain: value.domain,\n\t\t\t\t\t\t\tpath: value.path\n\t\t\t\t\t\t};\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcookieHelper.set(key, decodeURIComponent(value.value), opts);\n\t\t\t\t\t\t} catch (e) {}\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t})\n\t\t}] }\n\t};\n};\n\n//#endregion\nexport { nextCookies, toNextJsHandler };","// http://www.cse.yorku.ca/~oz/hash.html\n// More specifically, 32-bit hash via djbxor\n// (ref: https://gist.github.com/eplawless/52813b1d8ad9af510d85?permalink_comment_id=3367765#gistcomment-3367765)\n// This is due to number type differences between rust for turbopack to js number types,\n// where rust does not have easy way to repreesnt js's 53-bit float number type for the matching\n// overflow behavior. This is more `correct` in terms of having canonical hash across different runtime / implementation\n// as can gaurantee determinstic output from 32bit hash.\nexport function djb2Hash(str) {\n    let hash = 5381;\n    for(let i = 0; i < str.length; i++){\n        const char = str.charCodeAt(i);\n        hash = (hash << 5) + hash + char & 0xffffffff;\n    }\n    return hash >>> 0;\n}\nexport function hexHash(str) {\n    return djb2Hash(str).toString(36).slice(0, 5);\n}\n\n//# sourceMappingURL=hash.js.map","import { parsePath } from './parse-path';\n/**\n * Checks if a given path starts with a given prefix. It ensures it matches\n * exactly without containing extra chars. e.g. prefix /docs should replace\n * for /docs, /docs/, /docs/a but not /docsss\n * @param path The path to check.\n * @param prefix The prefix to check against.\n */ export function pathHasPrefix(path, prefix) {\n    if (typeof path !== 'string') {\n        return false;\n    }\n    const { pathname } = parsePath(path);\n    return pathname === prefix || pathname.startsWith(prefix + '/');\n}\n\n//# sourceMappingURL=path-has-prefix.js.map","import { NoopCache } from \"../cache/core/index.js\";\nimport { entityKind } from \"../entity.js\";\nimport { NoopLogger } from \"../logger.js\";\nimport { PgTransaction } from \"../pg-core/index.js\";\nimport { PgPreparedQuery, PgSession } from \"../pg-core/session.js\";\nimport { fillPlaceholders } from \"../sql/sql.js\";\nimport { tracer } from \"../tracing.js\";\nimport { mapResultRow } from \"../utils.js\";\nclass PostgresJsPreparedQuery extends PgPreparedQuery {\n  constructor(client, queryString, params, logger, cache, queryMetadata, cacheConfig, fields, _isResponseInArrayMode, customResultMapper) {\n    super({ sql: queryString, params }, cache, queryMetadata, cacheConfig);\n    this.client = client;\n    this.queryString = queryString;\n    this.params = params;\n    this.logger = logger;\n    this.fields = fields;\n    this._isResponseInArrayMode = _isResponseInArrayMode;\n    this.customResultMapper = customResultMapper;\n  }\n  static [entityKind] = \"PostgresJsPreparedQuery\";\n  async execute(placeholderValues = {}) {\n    return tracer.startActiveSpan(\"drizzle.execute\", async (span) => {\n      const params = fillPlaceholders(this.params, placeholderValues);\n      span?.setAttributes({\n        \"drizzle.query.text\": this.queryString,\n        \"drizzle.query.params\": JSON.stringify(params)\n      });\n      this.logger.logQuery(this.queryString, params);\n      const { fields, queryString: query, client, joinsNotNullableMap, customResultMapper } = this;\n      if (!fields && !customResultMapper) {\n        return tracer.startActiveSpan(\"drizzle.driver.execute\", () => {\n          return this.queryWithCache(query, params, async () => {\n            return await client.unsafe(query, params);\n          });\n        });\n      }\n      const rows = await tracer.startActiveSpan(\"drizzle.driver.execute\", () => {\n        span?.setAttributes({\n          \"drizzle.query.text\": query,\n          \"drizzle.query.params\": JSON.stringify(params)\n        });\n        return this.queryWithCache(query, params, async () => {\n          return await client.unsafe(query, params).values();\n        });\n      });\n      return tracer.startActiveSpan(\"drizzle.mapResponse\", () => {\n        return customResultMapper ? customResultMapper(rows) : rows.map((row) => mapResultRow(fields, row, joinsNotNullableMap));\n      });\n    });\n  }\n  all(placeholderValues = {}) {\n    return tracer.startActiveSpan(\"drizzle.execute\", async (span) => {\n      const params = fillPlaceholders(this.params, placeholderValues);\n      span?.setAttributes({\n        \"drizzle.query.text\": this.queryString,\n        \"drizzle.query.params\": JSON.stringify(params)\n      });\n      this.logger.logQuery(this.queryString, params);\n      return tracer.startActiveSpan(\"drizzle.driver.execute\", () => {\n        span?.setAttributes({\n          \"drizzle.query.text\": this.queryString,\n          \"drizzle.query.params\": JSON.stringify(params)\n        });\n        return this.queryWithCache(this.queryString, params, async () => {\n          return this.client.unsafe(this.queryString, params);\n        });\n      });\n    });\n  }\n  /** @internal */\n  isResponseInArrayMode() {\n    return this._isResponseInArrayMode;\n  }\n}\nclass PostgresJsSession extends PgSession {\n  constructor(client, dialect, schema, options = {}) {\n    super(dialect);\n    this.client = client;\n    this.schema = schema;\n    this.options = options;\n    this.logger = options.logger ?? new NoopLogger();\n    this.cache = options.cache ?? new NoopCache();\n  }\n  static [entityKind] = \"PostgresJsSession\";\n  logger;\n  cache;\n  prepareQuery(query, fields, name, isResponseInArrayMode, customResultMapper, queryMetadata, cacheConfig) {\n    return new PostgresJsPreparedQuery(\n      this.client,\n      query.sql,\n      query.params,\n      this.logger,\n      this.cache,\n      queryMetadata,\n      cacheConfig,\n      fields,\n      isResponseInArrayMode,\n      customResultMapper\n    );\n  }\n  query(query, params) {\n    this.logger.logQuery(query, params);\n    return this.client.unsafe(query, params).values();\n  }\n  queryObjects(query, params) {\n    return this.client.unsafe(query, params);\n  }\n  transaction(transaction, config) {\n    return this.client.begin(async (client) => {\n      const session = new PostgresJsSession(\n        client,\n        this.dialect,\n        this.schema,\n        this.options\n      );\n      const tx = new PostgresJsTransaction(this.dialect, session, this.schema);\n      if (config) {\n        await tx.setTransaction(config);\n      }\n      return transaction(tx);\n    });\n  }\n}\nclass PostgresJsTransaction extends PgTransaction {\n  constructor(dialect, session, schema, nestedIndex = 0) {\n    super(dialect, session, schema, nestedIndex);\n    this.session = session;\n  }\n  static [entityKind] = \"PostgresJsTransaction\";\n  transaction(transaction) {\n    return this.session.client.savepoint((client) => {\n      const session = new PostgresJsSession(\n        client,\n        this.dialect,\n        this.schema,\n        this.session.options\n      );\n      const tx = new PostgresJsTransaction(this.dialect, session, this.schema);\n      return transaction(tx);\n    });\n  }\n}\nexport {\n  PostgresJsPreparedQuery,\n  PostgresJsSession,\n  PostgresJsTransaction\n};\n//# sourceMappingURL=session.js.map","import { r as generateRandomString } from \"./crypto-CFUhAR9W.mjs\";\nimport { L as originCheck } from \"./api-CkmycQ2x.mjs\";\nimport { c as setSessionCookie } from \"./cookies-D72PbWdz.mjs\";\nimport * as z from \"zod\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { base64Url } from \"@better-auth/utils/base64\";\n\n//#region src/plugins/magic-link/utils.ts\nconst defaultKeyHasher = async (otp) => {\n\tconst hash = await createHash(\"SHA-256\").digest(new TextEncoder().encode(otp));\n\treturn base64Url.encode(new Uint8Array(hash), { padding: false });\n};\n\n//#endregion\n//#region src/plugins/magic-link/index.ts\nconst magicLink = (options) => {\n\tconst opts = {\n\t\tstoreToken: \"plain\",\n\t\t...options\n\t};\n\tasync function storeToken(ctx, token) {\n\t\tif (opts.storeToken === \"hashed\") return await defaultKeyHasher(token);\n\t\tif (typeof opts.storeToken === \"object\" && \"type\" in opts.storeToken && opts.storeToken.type === \"custom-hasher\") return await opts.storeToken.hash(token);\n\t\treturn token;\n\t}\n\treturn {\n\t\tid: \"magic-link\",\n\t\tendpoints: {\n\t\t\tsignInMagicLink: createAuthEndpoint(\"/sign-in/magic-link\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\trequireHeaders: true,\n\t\t\t\tbody: z.object({\n\t\t\t\t\temail: z.email().meta({ description: \"Email address to send the magic link\" }),\n\t\t\t\t\tname: z.string().meta({ description: \"User display name. Only used if the user is registering for the first time. Eg: \\\"my-name\\\"\" }).optional(),\n\t\t\t\t\tcallbackURL: z.string().meta({ description: \"URL to redirect after magic link verification\" }).optional(),\n\t\t\t\t\tnewUserCallbackURL: z.string().meta({ description: \"URL to redirect after new user signup. Only used if the user is registering for the first time.\" }).optional(),\n\t\t\t\t\terrorCallbackURL: z.string().meta({ description: \"URL to redirect after error.\" }).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"signInWithMagicLink\",\n\t\t\t\t\tdescription: \"Sign in with magic link\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { status: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { email } = ctx.body;\n\t\t\t\tconst verificationToken = opts?.generateToken ? await opts.generateToken(email) : generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\tconst storedToken = await storeToken(ctx, verificationToken);\n\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\tidentifier: storedToken,\n\t\t\t\t\tvalue: JSON.stringify({\n\t\t\t\t\t\temail,\n\t\t\t\t\t\tname: ctx.body.name\n\t\t\t\t\t}),\n\t\t\t\t\texpiresAt: new Date(Date.now() + (opts.expiresIn || 300) * 1e3)\n\t\t\t\t});\n\t\t\t\tconst realBaseURL = new URL(ctx.context.baseURL);\n\t\t\t\tconst pathname = realBaseURL.pathname === \"/\" ? \"\" : realBaseURL.pathname;\n\t\t\t\tconst basePath = pathname ? \"\" : ctx.context.options.basePath || \"\";\n\t\t\t\tconst url = new URL(`${pathname}${basePath}/magic-link/verify`, realBaseURL.origin);\n\t\t\t\turl.searchParams.set(\"token\", verificationToken);\n\t\t\t\turl.searchParams.set(\"callbackURL\", ctx.body.callbackURL || \"/\");\n\t\t\t\tif (ctx.body.newUserCallbackURL) url.searchParams.set(\"newUserCallbackURL\", ctx.body.newUserCallbackURL);\n\t\t\t\tif (ctx.body.errorCallbackURL) url.searchParams.set(\"errorCallbackURL\", ctx.body.errorCallbackURL);\n\t\t\t\tawait options.sendMagicLink({\n\t\t\t\t\temail,\n\t\t\t\t\turl: url.toString(),\n\t\t\t\t\ttoken: verificationToken\n\t\t\t\t}, ctx);\n\t\t\t\treturn ctx.json({ status: true });\n\t\t\t}),\n\t\t\tmagicLinkVerify: createAuthEndpoint(\"/magic-link/verify\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tquery: z.object({\n\t\t\t\t\ttoken: z.string().meta({ description: \"Verification token\" }),\n\t\t\t\t\tcallbackURL: z.string().meta({ description: \"URL to redirect after magic link verification, if not provided the user will be redirected to the root URL. Eg: \\\"/dashboard\\\"\" }).optional(),\n\t\t\t\t\terrorCallbackURL: z.string().meta({ description: \"URL to redirect after error.\" }).optional(),\n\t\t\t\t\tnewUserCallbackURL: z.string().meta({ description: \"URL to redirect after new user signup. Only used if the user is registering for the first time.\" }).optional()\n\t\t\t\t}),\n\t\t\t\tuse: [\n\t\t\t\t\toriginCheck((ctx) => {\n\t\t\t\t\t\treturn ctx.query.callbackURL ? decodeURIComponent(ctx.query.callbackURL) : \"/\";\n\t\t\t\t\t}),\n\t\t\t\t\toriginCheck((ctx) => {\n\t\t\t\t\t\treturn ctx.query.newUserCallbackURL ? decodeURIComponent(ctx.query.newUserCallbackURL) : \"/\";\n\t\t\t\t\t}),\n\t\t\t\t\toriginCheck((ctx) => {\n\t\t\t\t\t\treturn ctx.query.errorCallbackURL ? decodeURIComponent(ctx.query.errorCallbackURL) : \"/\";\n\t\t\t\t\t})\n\t\t\t\t],\n\t\t\t\trequireHeaders: true,\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"verifyMagicLink\",\n\t\t\t\t\tdescription: \"Verify magic link\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tsession: { $ref: \"#/components/schemas/Session\" },\n\t\t\t\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst token = ctx.query.token;\n\t\t\t\tconst callbackURL = new URL(ctx.query.callbackURL ? decodeURIComponent(ctx.query.callbackURL) : \"/\", ctx.context.baseURL).toString();\n\t\t\t\tconst errorCallbackURL = new URL(ctx.query.errorCallbackURL ? decodeURIComponent(ctx.query.errorCallbackURL) : callbackURL, ctx.context.baseURL).toString();\n\t\t\t\tconst newUserCallbackURL = new URL(ctx.query.newUserCallbackURL ? decodeURIComponent(ctx.query.newUserCallbackURL) : callbackURL, ctx.context.baseURL).toString();\n\t\t\t\tcallbackURL?.startsWith(\"http\") || (callbackURL ? `${ctx.context.options.baseURL}${callbackURL}` : ctx.context.options.baseURL);\n\t\t\t\tconst storedToken = await storeToken(ctx, token);\n\t\t\t\tconst tokenValue = await ctx.context.internalAdapter.findVerificationValue(storedToken);\n\t\t\t\tif (!tokenValue) throw ctx.redirect(`${errorCallbackURL}?error=INVALID_TOKEN`);\n\t\t\t\tif (tokenValue.expiresAt < /* @__PURE__ */ new Date()) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(tokenValue.id);\n\t\t\t\t\tthrow ctx.redirect(`${errorCallbackURL}?error=EXPIRED_TOKEN`);\n\t\t\t\t}\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(tokenValue.id);\n\t\t\t\tconst { email, name } = JSON.parse(tokenValue.value);\n\t\t\t\tlet isNewUser = false;\n\t\t\t\tlet user = await ctx.context.internalAdapter.findUserByEmail(email).then((res) => res?.user);\n\t\t\t\tif (!user) if (!opts.disableSignUp) {\n\t\t\t\t\tconst newUser = await ctx.context.internalAdapter.createUser({\n\t\t\t\t\t\temail,\n\t\t\t\t\t\temailVerified: true,\n\t\t\t\t\t\tname: name || \"\"\n\t\t\t\t\t});\n\t\t\t\t\tisNewUser = true;\n\t\t\t\t\tuser = newUser;\n\t\t\t\t\tif (!user) throw ctx.redirect(`${errorCallbackURL}?error=failed_to_create_user`);\n\t\t\t\t} else throw ctx.redirect(`${errorCallbackURL}?error=new_user_signup_disabled`);\n\t\t\t\tif (!user.emailVerified) user = await ctx.context.internalAdapter.updateUser(user.id, { emailVerified: true });\n\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(user.id);\n\t\t\t\tif (!session) throw ctx.redirect(`${errorCallbackURL}?error=failed_to_create_session`);\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser\n\t\t\t\t});\n\t\t\t\tif (!ctx.query.callbackURL) return ctx.json({\n\t\t\t\t\ttoken: session.token,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\temailVerified: user.emailVerified,\n\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\timage: user.image,\n\t\t\t\t\t\tcreatedAt: user.createdAt,\n\t\t\t\t\t\tupdatedAt: user.updatedAt\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (isNewUser) throw ctx.redirect(newUserCallbackURL);\n\t\t\t\tthrow ctx.redirect(callbackURL);\n\t\t\t})\n\t\t},\n\t\trateLimit: [{\n\t\t\tpathMatcher(path) {\n\t\t\t\treturn path.startsWith(\"/sign-in/magic-link\") || path.startsWith(\"/magic-link/verify\");\n\t\t\t},\n\t\t\twindow: opts.rateLimit?.window || 60,\n\t\t\tmax: opts.rateLimit?.max || 5\n\t\t}]\n\t};\n};\n\n//#endregion\nexport { magicLink as t };","import { normalizeAppPath } from '../../shared/lib/router/utils/app-paths';\nimport { pathHasPrefix } from '../../shared/lib/router/utils/path-has-prefix';\nimport { removePathPrefix } from '../../shared/lib/router/utils/remove-path-prefix';\nimport { workAsyncStorage } from './work-async-storage.external';\n// This function creates a Flight-acceptable server module map proxy from our\n// Server Reference Manifest similar to our client module map.\n// This is because our manifest contains a lot of internal Next.js data that\n// are relevant to the runtime, workers, etc. that React doesn't need to know.\nexport function createServerModuleMap({ serverActionsManifest }) {\n    return new Proxy({}, {\n        get: (_, id)=>{\n            var _serverActionsManifest__id, _serverActionsManifest_;\n            const workers = (_serverActionsManifest_ = serverActionsManifest[process.env.NEXT_RUNTIME === 'edge' ? 'edge' : 'node']) == null ? void 0 : (_serverActionsManifest__id = _serverActionsManifest_[id]) == null ? void 0 : _serverActionsManifest__id.workers;\n            if (!workers) {\n                return undefined;\n            }\n            const workStore = workAsyncStorage.getStore();\n            let workerEntry;\n            if (workStore) {\n                workerEntry = workers[normalizeWorkerPageName(workStore.page)];\n            } else {\n                // If there's no work store defined, we can assume that a server\n                // module map is needed during module evaluation, e.g. to create a\n                // server action using a higher-order function. Therefore it should be\n                // safe to return any entry from the manifest that matches the action\n                // ID. They all refer to the same module ID, which must also exist in\n                // the current page bundle. TODO: This is currently not guaranteed in\n                // Turbopack, and needs to be fixed.\n                workerEntry = Object.values(workers).at(0);\n            }\n            if (!workerEntry) {\n                return undefined;\n            }\n            const { moduleId, async } = workerEntry;\n            return {\n                id: moduleId,\n                name: id,\n                chunks: [],\n                async\n            };\n        }\n    });\n}\n/**\n * Checks if the requested action has a worker for the current page.\n * If not, it returns the first worker that has a handler for the action.\n */ export function selectWorkerForForwarding(actionId, pageName, serverActionsManifest) {\n    var _serverActionsManifest__actionId;\n    const workers = (_serverActionsManifest__actionId = serverActionsManifest[process.env.NEXT_RUNTIME === 'edge' ? 'edge' : 'node'][actionId]) == null ? void 0 : _serverActionsManifest__actionId.workers;\n    const workerName = normalizeWorkerPageName(pageName);\n    // no workers, nothing to forward to\n    if (!workers) return;\n    // if there is a worker for this page, no need to forward it.\n    if (workers[workerName]) {\n        return;\n    }\n    // otherwise, grab the first worker that has a handler for this action id\n    return denormalizeWorkerPageName(Object.keys(workers)[0]);\n}\n/**\n * The flight entry loader keys actions by bundlePath.\n * bundlePath corresponds with the relative path (including 'app') to the page entrypoint.\n */ function normalizeWorkerPageName(pageName) {\n    if (pathHasPrefix(pageName, 'app')) {\n        return pageName;\n    }\n    return 'app' + pageName;\n}\n/**\n * Converts a bundlePath (relative path to the entrypoint) to a routable page name\n */ function denormalizeWorkerPageName(bundlePath) {\n    return normalizeAppPath(removePathPrefix(bundlePath, 'app'));\n}\n\n//# sourceMappingURL=action-utils.js.map","import { pathHasPrefix } from './path-has-prefix';\n/**\n * Given a path and a prefix it will remove the prefix when it exists in the\n * given path. It ensures it matches exactly without containing extra chars\n * and if the prefix is not there it will be noop.\n *\n * @param path The path to remove the prefix from.\n * @param prefix The prefix to be removed.\n */ export function removePathPrefix(path, prefix) {\n    // If the path doesn't start with the prefix we can return it as is. This\n    // protects us from situations where the prefix is a substring of the path\n    // prefix such as:\n    //\n    // For prefix: /blog\n    //\n    //   /blog -> true\n    //   /blog/ -> true\n    //   /blog/1 -> true\n    //   /blogging -> false\n    //   /blogging/ -> false\n    //   /blogging/1 -> false\n    if (!pathHasPrefix(path, prefix)) {\n        return path;\n    }\n    // Remove the prefix from the path via slicing.\n    const withoutPrefix = path.slice(prefix.length);\n    // If the path without the prefix starts with a `/` we can return it as is.\n    if (withoutPrefix.startsWith('/')) {\n        return withoutPrefix;\n    }\n    // If the path without the prefix doesn't start with a `/` we need to add it\n    // back to the path to make sure it's a valid path.\n    return `/${withoutPrefix}`;\n}\n\n//# sourceMappingURL=remove-path-prefix.js.map","import { t as mergeSchema } from \"./schema-Bb7wzeK_.mjs\";\nimport { C as createEmailVerificationToken } from \"./api-CkmycQ2x.mjs\";\nimport { c as setSessionCookie } from \"./cookies-D72PbWdz.mjs\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\n\n//#region src/plugins/username/error-codes.ts\nconst USERNAME_ERROR_CODES = defineErrorCodes({\n\tINVALID_USERNAME_OR_PASSWORD: \"Invalid username or password\",\n\tEMAIL_NOT_VERIFIED: \"Email not verified\",\n\tUNEXPECTED_ERROR: \"Unexpected error\",\n\tUSERNAME_IS_ALREADY_TAKEN: \"Username is already taken. Please try another.\",\n\tUSERNAME_TOO_SHORT: \"Username is too short\",\n\tUSERNAME_TOO_LONG: \"Username is too long\",\n\tINVALID_USERNAME: \"Username is invalid\",\n\tINVALID_DISPLAY_USERNAME: \"Display username is invalid\"\n});\n\n//#endregion\n//#region src/plugins/username/schema.ts\nconst getSchema = (normalizer) => {\n\treturn { user: { fields: {\n\t\tusername: {\n\t\t\ttype: \"string\",\n\t\t\trequired: false,\n\t\t\tsortable: true,\n\t\t\tunique: true,\n\t\t\treturned: true,\n\t\t\ttransform: { input(value) {\n\t\t\t\treturn typeof value !== \"string\" ? value : normalizer.username(value);\n\t\t\t} }\n\t\t},\n\t\tdisplayUsername: {\n\t\t\ttype: \"string\",\n\t\t\trequired: false,\n\t\t\ttransform: { input(value) {\n\t\t\t\treturn typeof value !== \"string\" ? value : normalizer.displayUsername(value);\n\t\t\t} }\n\t\t}\n\t} } };\n};\n\n//#endregion\n//#region src/plugins/username/index.ts\nfunction defaultUsernameValidator(username$1) {\n\treturn /^[a-zA-Z0-9_.]+$/.test(username$1);\n}\nconst username = (options) => {\n\tconst normalizer = (username$1) => {\n\t\tif (options?.usernameNormalization === false) return username$1;\n\t\tif (options?.usernameNormalization) return options.usernameNormalization(username$1);\n\t\treturn username$1.toLowerCase();\n\t};\n\tconst displayUsernameNormalizer = (displayUsername) => {\n\t\treturn options?.displayUsernameNormalization ? options.displayUsernameNormalization(displayUsername) : displayUsername;\n\t};\n\treturn {\n\t\tid: \"username\",\n\t\tinit(ctx) {\n\t\t\treturn { options: { databaseHooks: { user: {\n\t\t\t\tcreate: { async before(user, context) {\n\t\t\t\t\tconst username$1 = \"username\" in user ? user.username : null;\n\t\t\t\t\tconst displayUsername = \"displayUsername\" in user ? user.displayUsername : null;\n\t\t\t\t\treturn { data: {\n\t\t\t\t\t\t...user,\n\t\t\t\t\t\t...username$1 ? { username: normalizer(username$1) } : {},\n\t\t\t\t\t\t...displayUsername ? { displayUsername: displayUsernameNormalizer(displayUsername) } : {}\n\t\t\t\t\t} };\n\t\t\t\t} },\n\t\t\t\tupdate: { async before(user, context) {\n\t\t\t\t\tconst username$1 = \"username\" in user ? user.username : null;\n\t\t\t\t\tconst displayUsername = \"displayUsername\" in user ? user.displayUsername : null;\n\t\t\t\t\treturn { data: {\n\t\t\t\t\t\t...user,\n\t\t\t\t\t\t...username$1 ? { username: normalizer(username$1) } : {},\n\t\t\t\t\t\t...displayUsername ? { displayUsername: displayUsernameNormalizer(displayUsername) } : {}\n\t\t\t\t\t} };\n\t\t\t\t} }\n\t\t\t} } } };\n\t\t},\n\t\tendpoints: {\n\t\t\tsignInUsername: createAuthEndpoint(\"/sign-in/username\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tusername: z.string().meta({ description: \"The username of the user\" }),\n\t\t\t\t\tpassword: z.string().meta({ description: \"The password of the user\" }),\n\t\t\t\t\trememberMe: z.boolean().meta({ description: \"Remember the user session\" }).optional(),\n\t\t\t\t\tcallbackURL: z.string().meta({ description: \"The URL to redirect to after email verification\" }).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Sign in with username\",\n\t\t\t\t\tdescription: \"Sign in with username\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"Session token for the authenticated session\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" }\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\trequired: [\"token\", \"user\"]\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t},\n\t\t\t\t\t\t422: {\n\t\t\t\t\t\t\tdescription: \"Unprocessable Entity. Validation error\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: { message: { type: \"string\" } }\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!ctx.body.username || !ctx.body.password) {\n\t\t\t\t\tctx.context.logger.error(\"Username or password not found\");\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: USERNAME_ERROR_CODES.INVALID_USERNAME_OR_PASSWORD });\n\t\t\t\t}\n\t\t\t\tconst username$1 = options?.validationOrder?.username === \"pre-normalization\" ? normalizer(ctx.body.username) : ctx.body.username;\n\t\t\t\tconst minUsernameLength = options?.minUsernameLength || 3;\n\t\t\t\tconst maxUsernameLength = options?.maxUsernameLength || 30;\n\t\t\t\tif (username$1.length < minUsernameLength) {\n\t\t\t\t\tctx.context.logger.error(\"Username too short\", { username: username$1 });\n\t\t\t\t\tthrow new APIError(\"UNPROCESSABLE_ENTITY\", {\n\t\t\t\t\t\tcode: \"USERNAME_TOO_SHORT\",\n\t\t\t\t\t\tmessage: USERNAME_ERROR_CODES.USERNAME_TOO_SHORT\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (username$1.length > maxUsernameLength) {\n\t\t\t\t\tctx.context.logger.error(\"Username too long\", { username: username$1 });\n\t\t\t\t\tthrow new APIError(\"UNPROCESSABLE_ENTITY\", { message: USERNAME_ERROR_CODES.USERNAME_TOO_LONG });\n\t\t\t\t}\n\t\t\t\tif (!(options?.usernameValidator || defaultUsernameValidator)(username$1)) throw new APIError(\"UNPROCESSABLE_ENTITY\", { message: USERNAME_ERROR_CODES.INVALID_USERNAME });\n\t\t\t\tconst user = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"username\",\n\t\t\t\t\t\tvalue: normalizer(username$1)\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!user) {\n\t\t\t\t\tawait ctx.context.password.hash(ctx.body.password);\n\t\t\t\t\tctx.context.logger.error(\"User not found\", { username: username$1 });\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: USERNAME_ERROR_CODES.INVALID_USERNAME_OR_PASSWORD });\n\t\t\t\t}\n\t\t\t\tconst account = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"account\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id\n\t\t\t\t\t}, {\n\t\t\t\t\t\tfield: \"providerId\",\n\t\t\t\t\t\tvalue: \"credential\"\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!account) throw new APIError(\"UNAUTHORIZED\", { message: USERNAME_ERROR_CODES.INVALID_USERNAME_OR_PASSWORD });\n\t\t\t\tconst currentPassword = account?.password;\n\t\t\t\tif (!currentPassword) {\n\t\t\t\t\tctx.context.logger.error(\"Password not found\", { username: username$1 });\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: USERNAME_ERROR_CODES.INVALID_USERNAME_OR_PASSWORD });\n\t\t\t\t}\n\t\t\t\tif (!await ctx.context.password.verify({\n\t\t\t\t\thash: currentPassword,\n\t\t\t\t\tpassword: ctx.body.password\n\t\t\t\t})) {\n\t\t\t\t\tctx.context.logger.error(\"Invalid password\");\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: USERNAME_ERROR_CODES.INVALID_USERNAME_OR_PASSWORD });\n\t\t\t\t}\n\t\t\t\tif (ctx.context.options?.emailAndPassword?.requireEmailVerification && !user.emailVerified) {\n\t\t\t\t\tif (!ctx.context.options?.emailVerification?.sendVerificationEmail) throw new APIError(\"FORBIDDEN\", { message: USERNAME_ERROR_CODES.EMAIL_NOT_VERIFIED });\n\t\t\t\t\tif (ctx.context.options?.emailVerification?.sendOnSignIn) {\n\t\t\t\t\t\tconst token = await createEmailVerificationToken(ctx.context.secret, user.email, void 0, ctx.context.options.emailVerification?.expiresIn);\n\t\t\t\t\t\tconst url = `${ctx.context.baseURL}/verify-email?token=${token}&callbackURL=${ctx.body.callbackURL || \"/\"}`;\n\t\t\t\t\t\tawait ctx.context.options.emailVerification.sendVerificationEmail({\n\t\t\t\t\t\t\tuser,\n\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t\ttoken\n\t\t\t\t\t\t}, ctx.request);\n\t\t\t\t\t}\n\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", { message: USERNAME_ERROR_CODES.EMAIL_NOT_VERIFIED });\n\t\t\t\t}\n\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(user.id, ctx.body.rememberMe === false);\n\t\t\t\tif (!session) return ctx.json(null, {\n\t\t\t\t\tstatus: 500,\n\t\t\t\t\tbody: { message: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION }\n\t\t\t\t});\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser\n\t\t\t\t}, ctx.body.rememberMe === false);\n\t\t\t\treturn ctx.json({\n\t\t\t\t\ttoken: session.token,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\temailVerified: user.emailVerified,\n\t\t\t\t\t\tusername: user.username,\n\t\t\t\t\t\tdisplayUsername: user.displayUsername,\n\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\timage: user.image,\n\t\t\t\t\t\tcreatedAt: user.createdAt,\n\t\t\t\t\t\tupdatedAt: user.updatedAt\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}),\n\t\t\tisUsernameAvailable: createAuthEndpoint(\"/is-username-available\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ username: z.string().meta({ description: \"The username to check\" }) })\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst username$1 = ctx.body.username;\n\t\t\t\tif (!username$1) throw new APIError(\"UNPROCESSABLE_ENTITY\", { message: USERNAME_ERROR_CODES.INVALID_USERNAME });\n\t\t\t\tconst minUsernameLength = options?.minUsernameLength || 3;\n\t\t\t\tconst maxUsernameLength = options?.maxUsernameLength || 30;\n\t\t\t\tif (username$1.length < minUsernameLength) throw new APIError(\"UNPROCESSABLE_ENTITY\", {\n\t\t\t\t\tcode: \"USERNAME_TOO_SHORT\",\n\t\t\t\t\tmessage: USERNAME_ERROR_CODES.USERNAME_TOO_SHORT\n\t\t\t\t});\n\t\t\t\tif (username$1.length > maxUsernameLength) throw new APIError(\"UNPROCESSABLE_ENTITY\", { message: USERNAME_ERROR_CODES.USERNAME_TOO_LONG });\n\t\t\t\tif (!await (options?.usernameValidator || defaultUsernameValidator)(username$1)) throw new APIError(\"UNPROCESSABLE_ENTITY\", { message: USERNAME_ERROR_CODES.INVALID_USERNAME });\n\t\t\t\tif (await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"username\",\n\t\t\t\t\t\tvalue: normalizer(username$1)\n\t\t\t\t\t}]\n\t\t\t\t})) return ctx.json({ available: false });\n\t\t\t\treturn ctx.json({ available: true });\n\t\t\t})\n\t\t},\n\t\tschema: mergeSchema(getSchema({\n\t\t\tusername: normalizer,\n\t\t\tdisplayUsername: displayUsernameNormalizer\n\t\t}), options?.schema),\n\t\thooks: { before: [{\n\t\t\tmatcher(context) {\n\t\t\t\treturn context.path === \"/sign-up/email\" || context.path === \"/update-user\";\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst username$1 = typeof ctx.body.username === \"string\" && options?.validationOrder?.username === \"post-normalization\" ? normalizer(ctx.body.username) : ctx.body.username;\n\t\t\t\tif (username$1 !== void 0 && typeof username$1 === \"string\") {\n\t\t\t\t\tconst minUsernameLength = options?.minUsernameLength || 3;\n\t\t\t\t\tconst maxUsernameLength = options?.maxUsernameLength || 30;\n\t\t\t\t\tif (username$1.length < minUsernameLength) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tcode: \"USERNAME_TOO_SHORT\",\n\t\t\t\t\t\tmessage: USERNAME_ERROR_CODES.USERNAME_TOO_SHORT\n\t\t\t\t\t});\n\t\t\t\t\tif (username$1.length > maxUsernameLength) throw new APIError(\"BAD_REQUEST\", { message: USERNAME_ERROR_CODES.USERNAME_TOO_LONG });\n\t\t\t\t\tif (!await (options?.usernameValidator || defaultUsernameValidator)(username$1)) throw new APIError(\"BAD_REQUEST\", { message: USERNAME_ERROR_CODES.INVALID_USERNAME });\n\t\t\t\t\tconst user = await ctx.context.adapter.findOne({\n\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"username\",\n\t\t\t\t\t\t\tvalue: username$1\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t\tconst blockChangeSignUp = ctx.path === \"/sign-up/email\" && user;\n\t\t\t\t\tconst blockChangeUpdateUser = ctx.path === \"/update-user\" && user && ctx.context.session && user.id !== ctx.context.session.session.userId;\n\t\t\t\t\tif (blockChangeSignUp || blockChangeUpdateUser) throw new APIError(\"BAD_REQUEST\", { message: USERNAME_ERROR_CODES.USERNAME_IS_ALREADY_TAKEN });\n\t\t\t\t}\n\t\t\t\tconst displayUsername = typeof ctx.body.displayUsername === \"string\" && options?.validationOrder?.displayUsername === \"post-normalization\" ? displayUsernameNormalizer(ctx.body.displayUsername) : ctx.body.displayUsername;\n\t\t\t\tif (displayUsername !== void 0 && typeof displayUsername === \"string\") {\n\t\t\t\t\tif (options?.displayUsernameValidator) {\n\t\t\t\t\t\tif (!await options.displayUsernameValidator(displayUsername)) throw new APIError(\"BAD_REQUEST\", { message: USERNAME_ERROR_CODES.INVALID_DISPLAY_USERNAME });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}, {\n\t\t\tmatcher(context) {\n\t\t\t\treturn context.path === \"/sign-up/email\" || context.path === \"/update-user\";\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tif (ctx.body.username && !ctx.body.displayUsername) ctx.body.displayUsername = ctx.body.username;\n\t\t\t\tif (ctx.body.displayUsername && !ctx.body.username) ctx.body.username = ctx.body.displayUsername;\n\t\t\t})\n\t\t}] },\n\t\t$ERROR_CODES: USERNAME_ERROR_CODES\n\t};\n};\n\n//#endregion\nexport { USERNAME_ERROR_CODES as n, username as t };","import { entityKind, is } from \"../../entity.js\";\nimport { QueryPromise } from \"../../query-promise.js\";\nimport { SelectionProxyHandler } from \"../../selection-proxy.js\";\nimport { Param, SQL, sql } from \"../../sql/sql.js\";\nimport { Columns, getTableName, Table } from \"../../table.js\";\nimport { tracer } from \"../../tracing.js\";\nimport { haveSameKeys, mapUpdateSet, orderSelectedFields } from \"../../utils.js\";\nimport { extractUsedTable } from \"../utils.js\";\nimport { QueryBuilder } from \"./query-builder.js\";\nclass PgInsertBuilder {\n  constructor(table, session, dialect, withList, overridingSystemValue_) {\n    this.table = table;\n    this.session = session;\n    this.dialect = dialect;\n    this.withList = withList;\n    this.overridingSystemValue_ = overridingSystemValue_;\n  }\n  static [entityKind] = \"PgInsertBuilder\";\n  authToken;\n  /** @internal */\n  setToken(token) {\n    this.authToken = token;\n    return this;\n  }\n  overridingSystemValue() {\n    this.overridingSystemValue_ = true;\n    return this;\n  }\n  values(values) {\n    values = Array.isArray(values) ? values : [values];\n    if (values.length === 0) {\n      throw new Error(\"values() must be called with at least one value\");\n    }\n    const mappedValues = values.map((entry) => {\n      const result = {};\n      const cols = this.table[Table.Symbol.Columns];\n      for (const colKey of Object.keys(entry)) {\n        const colValue = entry[colKey];\n        result[colKey] = is(colValue, SQL) ? colValue : new Param(colValue, cols[colKey]);\n      }\n      return result;\n    });\n    return new PgInsertBase(\n      this.table,\n      mappedValues,\n      this.session,\n      this.dialect,\n      this.withList,\n      false,\n      this.overridingSystemValue_\n    ).setToken(this.authToken);\n  }\n  select(selectQuery) {\n    const select = typeof selectQuery === \"function\" ? selectQuery(new QueryBuilder()) : selectQuery;\n    if (!is(select, SQL) && !haveSameKeys(this.table[Columns], select._.selectedFields)) {\n      throw new Error(\n        \"Insert select error: selected fields are not the same or are in a different order compared to the table definition\"\n      );\n    }\n    return new PgInsertBase(this.table, select, this.session, this.dialect, this.withList, true);\n  }\n}\nclass PgInsertBase extends QueryPromise {\n  constructor(table, values, session, dialect, withList, select, overridingSystemValue_) {\n    super();\n    this.session = session;\n    this.dialect = dialect;\n    this.config = { table, values, withList, select, overridingSystemValue_ };\n  }\n  static [entityKind] = \"PgInsert\";\n  config;\n  cacheConfig;\n  returning(fields = this.config.table[Table.Symbol.Columns]) {\n    this.config.returningFields = fields;\n    this.config.returning = orderSelectedFields(fields);\n    return this;\n  }\n  /**\n   * Adds an `on conflict do nothing` clause to the query.\n   *\n   * Calling this method simply avoids inserting a row as its alternative action.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/insert#on-conflict-do-nothing}\n   *\n   * @param config The `target` and `where` clauses.\n   *\n   * @example\n   * ```ts\n   * // Insert one row and cancel the insert if there's a conflict\n   * await db.insert(cars)\n   *   .values({ id: 1, brand: 'BMW' })\n   *   .onConflictDoNothing();\n   *\n   * // Explicitly specify conflict target\n   * await db.insert(cars)\n   *   .values({ id: 1, brand: 'BMW' })\n   *   .onConflictDoNothing({ target: cars.id });\n   * ```\n   */\n  onConflictDoNothing(config = {}) {\n    if (config.target === void 0) {\n      this.config.onConflict = sql`do nothing`;\n    } else {\n      let targetColumn = \"\";\n      targetColumn = Array.isArray(config.target) ? config.target.map((it) => this.dialect.escapeName(this.dialect.casing.getColumnCasing(it))).join(\",\") : this.dialect.escapeName(this.dialect.casing.getColumnCasing(config.target));\n      const whereSql = config.where ? sql` where ${config.where}` : void 0;\n      this.config.onConflict = sql`(${sql.raw(targetColumn)})${whereSql} do nothing`;\n    }\n    return this;\n  }\n  /**\n   * Adds an `on conflict do update` clause to the query.\n   *\n   * Calling this method will update the existing row that conflicts with the row proposed for insertion as its alternative action.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/insert#upserts-and-conflicts}\n   *\n   * @param config The `target`, `set` and `where` clauses.\n   *\n   * @example\n   * ```ts\n   * // Update the row if there's a conflict\n   * await db.insert(cars)\n   *   .values({ id: 1, brand: 'BMW' })\n   *   .onConflictDoUpdate({\n   *     target: cars.id,\n   *     set: { brand: 'Porsche' }\n   *   });\n   *\n   * // Upsert with 'where' clause\n   * await db.insert(cars)\n   *   .values({ id: 1, brand: 'BMW' })\n   *   .onConflictDoUpdate({\n   *     target: cars.id,\n   *     set: { brand: 'newBMW' },\n   *     targetWhere: sql`${cars.createdAt} > '2023-01-01'::date`,\n   *   });\n   * ```\n   */\n  onConflictDoUpdate(config) {\n    if (config.where && (config.targetWhere || config.setWhere)) {\n      throw new Error(\n        'You cannot use both \"where\" and \"targetWhere\"/\"setWhere\" at the same time - \"where\" is deprecated, use \"targetWhere\" or \"setWhere\" instead.'\n      );\n    }\n    const whereSql = config.where ? sql` where ${config.where}` : void 0;\n    const targetWhereSql = config.targetWhere ? sql` where ${config.targetWhere}` : void 0;\n    const setWhereSql = config.setWhere ? sql` where ${config.setWhere}` : void 0;\n    const setSql = this.dialect.buildUpdateSet(this.config.table, mapUpdateSet(this.config.table, config.set));\n    let targetColumn = \"\";\n    targetColumn = Array.isArray(config.target) ? config.target.map((it) => this.dialect.escapeName(this.dialect.casing.getColumnCasing(it))).join(\",\") : this.dialect.escapeName(this.dialect.casing.getColumnCasing(config.target));\n    this.config.onConflict = sql`(${sql.raw(targetColumn)})${targetWhereSql} do update set ${setSql}${whereSql}${setWhereSql}`;\n    return this;\n  }\n  /** @internal */\n  getSQL() {\n    return this.dialect.buildInsertQuery(this.config);\n  }\n  toSQL() {\n    const { typings: _typings, ...rest } = this.dialect.sqlToQuery(this.getSQL());\n    return rest;\n  }\n  /** @internal */\n  _prepare(name) {\n    return tracer.startActiveSpan(\"drizzle.prepareQuery\", () => {\n      return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()), this.config.returning, name, true, void 0, {\n        type: \"insert\",\n        tables: extractUsedTable(this.config.table)\n      }, this.cacheConfig);\n    });\n  }\n  prepare(name) {\n    return this._prepare(name);\n  }\n  authToken;\n  /** @internal */\n  setToken(token) {\n    this.authToken = token;\n    return this;\n  }\n  execute = (placeholderValues) => {\n    return tracer.startActiveSpan(\"drizzle.operation\", () => {\n      return this._prepare().execute(placeholderValues, this.authToken);\n    });\n  };\n  /** @internal */\n  getSelectedFields() {\n    return this.config.returningFields ? new Proxy(\n      this.config.returningFields,\n      new SelectionProxyHandler({\n        alias: getTableName(this.config.table),\n        sqlAliasedBehavior: \"alias\",\n        sqlBehavior: \"error\"\n      })\n    ) : void 0;\n  }\n  $dynamic() {\n    return this;\n  }\n}\nexport {\n  PgInsertBase,\n  PgInsertBuilder\n};\n//# sourceMappingURL=insert.js.map","import { t as generateId } from \"./utils-db7gNqd-.mjs\";\nimport { t as mergeSchema } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport { c as setSessionCookie, l as parseSetCookieHeader } from \"./cookies-D72PbWdz.mjs\";\nimport { r as getSessionFromCtx } from \"./session-AaRl3_x-.mjs\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\n\n//#region src/plugins/anonymous/error-codes.ts\nconst ANONYMOUS_ERROR_CODES = defineErrorCodes({\n\tINVALID_EMAIL_FORMAT: \"Email was not generated in a valid format\",\n\tFAILED_TO_CREATE_USER: \"Failed to create user\",\n\tCOULD_NOT_CREATE_SESSION: \"Could not create session\",\n\tANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY: \"Anonymous users cannot sign in again anonymously\"\n});\n\n//#endregion\n//#region src/plugins/anonymous/schema.ts\nconst schema = { user: { fields: { isAnonymous: {\n\ttype: \"boolean\",\n\trequired: false,\n\tinput: false,\n\tdefaultValue: false\n} } } };\n\n//#endregion\n//#region src/plugins/anonymous/index.ts\nasync function getAnonUserEmail(options) {\n\tconst customEmail = await options?.generateRandomEmail?.();\n\tif (customEmail) {\n\t\tif (!z.email().safeParse(customEmail).success) throw new APIError(\"BAD_REQUEST\", { message: ANONYMOUS_ERROR_CODES.INVALID_EMAIL_FORMAT });\n\t\treturn customEmail;\n\t}\n\tconst id = generateId();\n\tif (options?.emailDomainName) return `temp-${id}@${options.emailDomainName}`;\n\treturn `temp@${id}.com`;\n}\nconst anonymous = (options) => {\n\treturn {\n\t\tid: \"anonymous\",\n\t\tendpoints: { signInAnonymous: createAuthEndpoint(\"/sign-in/anonymous\", {\n\t\t\tmethod: \"POST\",\n\t\t\tmetadata: { openapi: {\n\t\t\t\tdescription: \"Sign in anonymously\",\n\t\t\t\tresponses: { 200: {\n\t\t\t\t\tdescription: \"Sign in anonymously\",\n\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" },\n\t\t\t\t\t\t\tsession: { $ref: \"#/components/schemas/Session\" }\n\t\t\t\t\t\t}\n\t\t\t\t\t} } }\n\t\t\t\t} }\n\t\t\t} }\n\t\t}, async (ctx) => {\n\t\t\tif ((await getSessionFromCtx(ctx, { disableRefresh: true }))?.user.isAnonymous) throw new APIError(\"BAD_REQUEST\", { message: ANONYMOUS_ERROR_CODES.ANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY });\n\t\t\tconst email = await getAnonUserEmail(options);\n\t\t\tconst name = await options?.generateName?.(ctx) || \"Anonymous\";\n\t\t\tconst newUser = await ctx.context.internalAdapter.createUser({\n\t\t\t\temail,\n\t\t\t\temailVerified: false,\n\t\t\t\tisAnonymous: true,\n\t\t\t\tname,\n\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t});\n\t\t\tif (!newUser) throw ctx.error(\"INTERNAL_SERVER_ERROR\", { message: ANONYMOUS_ERROR_CODES.FAILED_TO_CREATE_USER });\n\t\t\tconst session = await ctx.context.internalAdapter.createSession(newUser.id);\n\t\t\tif (!session) return ctx.json(null, {\n\t\t\t\tstatus: 400,\n\t\t\t\tbody: { message: ANONYMOUS_ERROR_CODES.COULD_NOT_CREATE_SESSION }\n\t\t\t});\n\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\tsession,\n\t\t\t\tuser: newUser\n\t\t\t});\n\t\t\treturn ctx.json({\n\t\t\t\ttoken: session.token,\n\t\t\t\tuser: {\n\t\t\t\t\tid: newUser.id,\n\t\t\t\t\temail: newUser.email,\n\t\t\t\t\temailVerified: newUser.emailVerified,\n\t\t\t\t\tname: newUser.name,\n\t\t\t\t\tcreatedAt: newUser.createdAt,\n\t\t\t\t\tupdatedAt: newUser.updatedAt\n\t\t\t\t}\n\t\t\t});\n\t\t}) },\n\t\thooks: { after: [{\n\t\t\tmatcher(ctx) {\n\t\t\t\treturn ctx.path.startsWith(\"/sign-in\") || ctx.path.startsWith(\"/sign-up\") || ctx.path.startsWith(\"/callback\") || ctx.path.startsWith(\"/oauth2/callback\") || ctx.path.startsWith(\"/magic-link/verify\") || ctx.path.startsWith(\"/email-otp/verify-email\") || ctx.path.startsWith(\"/one-tap/callback\") || ctx.path.startsWith(\"/passkey/verify-authentication\") || ctx.path.startsWith(\"/phone-number/verify\");\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst setCookie = ctx.context.responseHeaders?.get(\"set-cookie\");\n\t\t\t\t/**\n\t\t\t\t* We can consider the user is about to sign in or sign up\n\t\t\t\t* if the response contains a session token.\n\t\t\t\t*/\n\t\t\t\tconst sessionTokenName = ctx.context.authCookies.sessionToken.name;\n\t\t\t\tif (!parseSetCookieHeader(setCookie || \"\").get(sessionTokenName)?.value.split(\".\")[0]) return;\n\t\t\t\t/**\n\t\t\t\t* Make sure the user had an anonymous session.\n\t\t\t\t*/\n\t\t\t\tconst session = await getSessionFromCtx(ctx, { disableRefresh: true });\n\t\t\t\tif (!session || !session.user.isAnonymous) return;\n\t\t\t\tif (ctx.path === \"/sign-in/anonymous\" && !ctx.context.newSession) throw new APIError(\"BAD_REQUEST\", { message: ANONYMOUS_ERROR_CODES.ANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY });\n\t\t\t\tconst newSession = ctx.context.newSession;\n\t\t\t\tif (!newSession) return;\n\t\t\t\tif (options?.onLinkAccount) await options?.onLinkAccount?.({\n\t\t\t\t\tanonymousUser: session,\n\t\t\t\t\tnewUser: newSession,\n\t\t\t\t\tctx\n\t\t\t\t});\n\t\t\t\tif (!options?.disableDeleteAnonymousUser) await ctx.context.internalAdapter.deleteUser(session.user.id);\n\t\t\t})\n\t\t}] },\n\t\tschema: mergeSchema(schema, options?.schema),\n\t\t$ERROR_CODES: ANONYMOUS_ERROR_CODES\n\t};\n};\n\n//#endregion\nexport { anonymous as t };","import { r as generateRandomString } from \"./crypto-CFUhAR9W.mjs\";\nimport { t as mergeSchema } from \"./schema-Bb7wzeK_.mjs\";\nimport { r as getSessionFromCtx } from \"./session-AaRl3_x-.mjs\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { ms } from \"ms\";\n\n//#region src/plugins/device-authorization/error-codes.ts\nconst DEVICE_AUTHORIZATION_ERROR_CODES = defineErrorCodes({\n\tINVALID_DEVICE_CODE: \"Invalid device code\",\n\tEXPIRED_DEVICE_CODE: \"Device code has expired\",\n\tEXPIRED_USER_CODE: \"User code has expired\",\n\tAUTHORIZATION_PENDING: \"Authorization pending\",\n\tACCESS_DENIED: \"Access denied\",\n\tINVALID_USER_CODE: \"Invalid user code\",\n\tDEVICE_CODE_ALREADY_PROCESSED: \"Device code already processed\",\n\tPOLLING_TOO_FREQUENTLY: \"Polling too frequently\",\n\tUSER_NOT_FOUND: \"User not found\",\n\tFAILED_TO_CREATE_SESSION: \"Failed to create session\",\n\tINVALID_DEVICE_CODE_STATUS: \"Invalid device code status\",\n\tAUTHENTICATION_REQUIRED: \"Authentication required\"\n});\n\n//#endregion\n//#region src/plugins/device-authorization/schema.ts\nconst schema = { deviceCode: { fields: {\n\tdeviceCode: {\n\t\ttype: \"string\",\n\t\trequired: true\n\t},\n\tuserCode: {\n\t\ttype: \"string\",\n\t\trequired: true\n\t},\n\tuserId: {\n\t\ttype: \"string\",\n\t\trequired: false\n\t},\n\texpiresAt: {\n\t\ttype: \"date\",\n\t\trequired: true\n\t},\n\tstatus: {\n\t\ttype: \"string\",\n\t\trequired: true\n\t},\n\tlastPolledAt: {\n\t\ttype: \"date\",\n\t\trequired: false\n\t},\n\tpollingInterval: {\n\t\ttype: \"number\",\n\t\trequired: false\n\t},\n\tclientId: {\n\t\ttype: \"string\",\n\t\trequired: false\n\t},\n\tscope: {\n\t\ttype: \"string\",\n\t\trequired: false\n\t}\n} } };\nconst deviceCode = z.object({\n\tid: z.string(),\n\tdeviceCode: z.string(),\n\tuserCode: z.string(),\n\tuserId: z.string().optional(),\n\texpiresAt: z.date(),\n\tstatus: z.string(),\n\tlastPolledAt: z.date().optional(),\n\tpollingInterval: z.number().optional(),\n\tclientId: z.string().optional(),\n\tscope: z.string().optional()\n});\n\n//#endregion\n//#region src/plugins/device-authorization/index.ts\nconst msStringValueSchema = z.custom((val) => {\n\ttry {\n\t\tms(val);\n\t} catch (e) {\n\t\treturn false;\n\t}\n\treturn true;\n}, { message: \"Invalid time string format. Use formats like '30m', '5s', '1h', etc.\" });\nconst deviceAuthorizationOptionsSchema = z.object({\n\texpiresIn: msStringValueSchema.default(\"30m\").describe(\"Time in seconds until the device code expires. Use formats like '30m', '5s', '1h', etc.\"),\n\tinterval: msStringValueSchema.default(\"5s\").describe(\"Time in seconds between polling attempts. Use formats like '30m', '5s', '1h', etc.\"),\n\tdeviceCodeLength: z.number().int().positive().default(40).describe(\"Length of the device code to be generated. Default is 40 characters.\"),\n\tuserCodeLength: z.number().int().positive().default(8).describe(\"Length of the user code to be generated. Default is 8 characters.\"),\n\tgenerateDeviceCode: z.custom((val) => typeof val === \"function\", { message: \"generateDeviceCode must be a function that returns a string or a promise that resolves to a string.\" }).optional().describe(\"Function to generate a device code. If not provided, a default random string generator will be used.\"),\n\tgenerateUserCode: z.custom((val) => typeof val === \"function\", { message: \"generateUserCode must be a function that returns a string or a promise that resolves to a string.\" }).optional().describe(\"Function to generate a user code. If not provided, a default random string generator will be used.\"),\n\tvalidateClient: z.custom((val) => typeof val === \"function\", { message: \"validateClient must be a function that returns a boolean or a promise that resolves to a boolean.\" }).optional().describe(\"Function to validate the client ID. If not provided, no validation will be performed.\"),\n\tonDeviceAuthRequest: z.custom((val) => typeof val === \"function\", { message: \"onDeviceAuthRequest must be a function that returns void or a promise that resolves to void.\" }).optional().describe(\"Function to handle device authorization requests. If not provided, no additional actions will be taken.\"),\n\tverificationUri: z.string().optional().describe(\"The URI where users verify their device code. Can be an absolute URL (https://example.com/device) or relative path (/custom-path). This will be returned as verification_uri in the device code response. If not provided, defaults to /device.\"),\n\tschema: z.custom(() => true)\n});\nconst defaultCharset = \"ABCDEFGHJKLMNPQRSTUVWXYZ23456789\";\n/**\n* @internal\n*/\nconst defaultGenerateDeviceCode = (length) => {\n\treturn generateRandomString(length, \"a-z\", \"A-Z\", \"0-9\");\n};\n/**\n* @internal\n*/\nconst defaultGenerateUserCode = (length) => {\n\tconst chars = new Uint8Array(length);\n\treturn Array.from(crypto.getRandomValues(chars)).map((byte) => defaultCharset[byte % 32]).join(\"\");\n};\n/**\n* @internal\n*/\nconst buildVerificationUris = (verificationUri, baseURL, userCode) => {\n\tconst uri = verificationUri || \"/device\";\n\tlet verificationUrl;\n\ttry {\n\t\tverificationUrl = new URL(uri);\n\t} catch {\n\t\tverificationUrl = new URL(uri, baseURL);\n\t}\n\tconst verificationUriCompleteUrl = new URL(verificationUrl);\n\tverificationUriCompleteUrl.searchParams.set(\"user_code\", userCode);\n\treturn {\n\t\tverificationUri: verificationUrl.toString(),\n\t\tverificationUriComplete: verificationUriCompleteUrl.toString()\n\t};\n};\nconst deviceAuthorization = (options = {}) => {\n\tconst opts = deviceAuthorizationOptionsSchema.parse(options);\n\tconst generateDeviceCode = async () => {\n\t\tif (opts.generateDeviceCode) return opts.generateDeviceCode();\n\t\treturn defaultGenerateDeviceCode(opts.deviceCodeLength);\n\t};\n\tconst generateUserCode = async () => {\n\t\tif (opts.generateUserCode) return opts.generateUserCode();\n\t\treturn defaultGenerateUserCode(opts.userCodeLength);\n\t};\n\treturn {\n\t\tid: \"device-authorization\",\n\t\tschema: mergeSchema(schema, options?.schema),\n\t\tendpoints: {\n\t\t\tdeviceCode: createAuthEndpoint(\"/device/code\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tclient_id: z.string().meta({ description: \"The client ID of the application\" }),\n\t\t\t\t\tscope: z.string().meta({ description: \"Space-separated list of scopes\" }).optional()\n\t\t\t\t}),\n\t\t\t\terror: z.object({\n\t\t\t\t\terror: z.enum([\"invalid_request\", \"invalid_client\"]).meta({ description: \"Error code\" }),\n\t\t\t\t\terror_description: z.string().meta({ description: \"Detailed error description\" })\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: `Request a device and user code\n\nFollow [rfc8628#section-3.2](https://datatracker.ietf.org/doc/html/rfc8628#section-3.2)`,\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\tdevice_code: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The device verification code\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tuser_code: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The user code to display\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tverification_uri: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The URL for user verification. Defaults to /device if not configured.\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tverification_uri_complete: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The complete URL with user code as query parameter.\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\texpires_in: {\n\t\t\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"Lifetime in seconds of the device code\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tinterval: {\n\t\t\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"Minimum polling interval in seconds\"\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t},\n\t\t\t\t\t\t400: {\n\t\t\t\t\t\t\tdescription: \"Error response\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\terror: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tenum: [\"invalid_request\", \"invalid_client\"]\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\terror_description: { type: \"string\" }\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (opts.validateClient) {\n\t\t\t\t\tif (!await opts.validateClient(ctx.body.client_id)) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\terror_description: \"Invalid client ID\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (opts.onDeviceAuthRequest) await opts.onDeviceAuthRequest(ctx.body.client_id, ctx.body.scope);\n\t\t\t\tconst deviceCode$1 = await generateDeviceCode();\n\t\t\t\tconst userCode = await generateUserCode();\n\t\t\t\tconst expiresIn = ms(opts.expiresIn);\n\t\t\t\tconst expiresAt = new Date(Date.now() + expiresIn);\n\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tdeviceCode: deviceCode$1,\n\t\t\t\t\t\tuserCode,\n\t\t\t\t\t\texpiresAt,\n\t\t\t\t\t\tstatus: \"pending\",\n\t\t\t\t\t\tpollingInterval: ms(opts.interval),\n\t\t\t\t\t\tclientId: ctx.body.client_id,\n\t\t\t\t\t\tscope: ctx.body.scope\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tconst { verificationUri, verificationUriComplete } = buildVerificationUris(opts.verificationUri, ctx.context.baseURL, userCode);\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tdevice_code: deviceCode$1,\n\t\t\t\t\tuser_code: userCode,\n\t\t\t\t\tverification_uri: verificationUri,\n\t\t\t\t\tverification_uri_complete: verificationUriComplete,\n\t\t\t\t\texpires_in: Math.floor(expiresIn / 1e3),\n\t\t\t\t\tinterval: Math.floor(ms(opts.interval) / 1e3)\n\t\t\t\t}, { headers: { \"Cache-Control\": \"no-store\" } });\n\t\t\t}),\n\t\t\tdeviceToken: createAuthEndpoint(\"/device/token\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tgrant_type: z.literal(\"urn:ietf:params:oauth:grant-type:device_code\").meta({ description: \"The grant type for device flow\" }),\n\t\t\t\t\tdevice_code: z.string().meta({ description: \"The device verification code\" }),\n\t\t\t\t\tclient_id: z.string().meta({ description: \"The client ID of the application\" })\n\t\t\t\t}),\n\t\t\t\terror: z.object({\n\t\t\t\t\terror: z.enum([\n\t\t\t\t\t\t\"authorization_pending\",\n\t\t\t\t\t\t\"slow_down\",\n\t\t\t\t\t\t\"expired_token\",\n\t\t\t\t\t\t\"access_denied\",\n\t\t\t\t\t\t\"invalid_request\",\n\t\t\t\t\t\t\"invalid_grant\"\n\t\t\t\t\t]).meta({ description: \"Error code\" }),\n\t\t\t\t\terror_description: z.string().meta({ description: \"Detailed error description\" })\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: `Exchange device code for access token\n\nFollow [rfc8628#section-3.4](https://datatracker.ietf.org/doc/html/rfc8628#section-3.4)`,\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\tsession: { $ref: \"#/components/schemas/Session\" },\n\t\t\t\t\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" }\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t},\n\t\t\t\t\t\t400: {\n\t\t\t\t\t\t\tdescription: \"Error response\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\terror: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tenum: [\n\t\t\t\t\t\t\t\t\t\t\t\"authorization_pending\",\n\t\t\t\t\t\t\t\t\t\t\t\"slow_down\",\n\t\t\t\t\t\t\t\t\t\t\t\"expired_token\",\n\t\t\t\t\t\t\t\t\t\t\t\"access_denied\",\n\t\t\t\t\t\t\t\t\t\t\t\"invalid_request\",\n\t\t\t\t\t\t\t\t\t\t\t\"invalid_grant\"\n\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\terror_description: { type: \"string\" }\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { device_code, client_id } = ctx.body;\n\t\t\t\tif (opts.validateClient) {\n\t\t\t\t\tif (!await opts.validateClient(client_id)) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\t\terror_description: \"Invalid client ID\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst deviceCodeRecord = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"deviceCode\",\n\t\t\t\t\t\tvalue: device_code\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!deviceCodeRecord) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.INVALID_DEVICE_CODE\n\t\t\t\t});\n\t\t\t\tif (deviceCodeRecord.clientId && deviceCodeRecord.clientId !== client_id) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\terror_description: \"Client ID mismatch\"\n\t\t\t\t});\n\t\t\t\tif (deviceCodeRecord.lastPolledAt && deviceCodeRecord.pollingInterval) {\n\t\t\t\t\tif (Date.now() - new Date(deviceCodeRecord.lastPolledAt).getTime() < deviceCodeRecord.pollingInterval) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"slow_down\",\n\t\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.POLLING_TOO_FREQUENTLY\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tawait ctx.context.adapter.update({\n\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: deviceCodeRecord.id\n\t\t\t\t\t}],\n\t\t\t\t\tupdate: { lastPolledAt: /* @__PURE__ */ new Date() }\n\t\t\t\t});\n\t\t\t\tif (deviceCodeRecord.expiresAt < /* @__PURE__ */ new Date()) {\n\t\t\t\t\tawait ctx.context.adapter.delete({\n\t\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\tvalue: deviceCodeRecord.id\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"expired_token\",\n\t\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.EXPIRED_DEVICE_CODE\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (deviceCodeRecord.status === \"pending\") throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"authorization_pending\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.AUTHORIZATION_PENDING\n\t\t\t\t});\n\t\t\t\tif (deviceCodeRecord.status === \"denied\") {\n\t\t\t\t\tawait ctx.context.adapter.delete({\n\t\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\tvalue: deviceCodeRecord.id\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"access_denied\",\n\t\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.ACCESS_DENIED\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (deviceCodeRecord.status === \"approved\" && deviceCodeRecord.userId) {\n\t\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(deviceCodeRecord.userId);\n\t\t\t\t\tif (!user) throw new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\t\terror: \"server_error\",\n\t\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.USER_NOT_FOUND\n\t\t\t\t\t});\n\t\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(user.id);\n\t\t\t\t\tif (!session) throw new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\t\terror: \"server_error\",\n\t\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.FAILED_TO_CREATE_SESSION\n\t\t\t\t\t});\n\t\t\t\t\tctx.context.setNewSession({\n\t\t\t\t\t\tsession,\n\t\t\t\t\t\tuser\n\t\t\t\t\t});\n\t\t\t\t\tif (ctx.context.options.secondaryStorage) await ctx.context.secondaryStorage?.set(session.token, JSON.stringify({\n\t\t\t\t\t\tuser,\n\t\t\t\t\t\tsession\n\t\t\t\t\t}), Math.floor((new Date(session.expiresAt).getTime() - Date.now()) / 1e3));\n\t\t\t\t\tawait ctx.context.adapter.delete({\n\t\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\tvalue: deviceCodeRecord.id\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\taccess_token: session.token,\n\t\t\t\t\t\ttoken_type: \"Bearer\",\n\t\t\t\t\t\texpires_in: Math.floor((new Date(session.expiresAt).getTime() - Date.now()) / 1e3),\n\t\t\t\t\t\tscope: deviceCodeRecord.scope || \"\"\n\t\t\t\t\t}, { headers: {\n\t\t\t\t\t\t\"Cache-Control\": \"no-store\",\n\t\t\t\t\t\tPragma: \"no-cache\"\n\t\t\t\t\t} });\n\t\t\t\t}\n\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\terror: \"server_error\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.INVALID_DEVICE_CODE_STATUS\n\t\t\t\t});\n\t\t\t}),\n\t\t\tdeviceVerify: createAuthEndpoint(\"/device\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tquery: z.object({ user_code: z.string().meta({ description: \"The user code to verify\" }) }),\n\t\t\t\terror: z.object({\n\t\t\t\t\terror: z.enum([\"invalid_request\"]).meta({ description: \"Error code\" }),\n\t\t\t\t\terror_description: z.string().meta({ description: \"Detailed error description\" })\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Verify user code and get device authorization status\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Device authorization status\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tuser_code: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"The user code to verify\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tenum: [\n\t\t\t\t\t\t\t\t\t\t\"pending\",\n\t\t\t\t\t\t\t\t\t\t\"approved\",\n\t\t\t\t\t\t\t\t\t\t\"denied\"\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tdescription: \"Current status of the device authorization\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { user_code } = ctx.query;\n\t\t\t\tconst cleanUserCode = user_code.replace(/-/g, \"\");\n\t\t\t\tconst deviceCodeRecord = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userCode\",\n\t\t\t\t\t\tvalue: cleanUserCode\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!deviceCodeRecord) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.INVALID_USER_CODE\n\t\t\t\t});\n\t\t\t\tif (deviceCodeRecord.expiresAt < /* @__PURE__ */ new Date()) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"expired_token\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.EXPIRED_USER_CODE\n\t\t\t\t});\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tuser_code,\n\t\t\t\t\tstatus: deviceCodeRecord.status\n\t\t\t\t});\n\t\t\t}),\n\t\t\tdeviceApprove: createAuthEndpoint(\"/device/approve\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ userCode: z.string().meta({ description: \"The user code to approve\" }) }),\n\t\t\t\terror: z.object({\n\t\t\t\t\terror: z.enum([\n\t\t\t\t\t\t\"invalid_request\",\n\t\t\t\t\t\t\"expired_token\",\n\t\t\t\t\t\t\"device_code_already_processed\"\n\t\t\t\t\t]).meta({ description: \"Error code\" }),\n\t\t\t\t\terror_description: z.string().meta({ description: \"Detailed error description\" })\n\t\t\t\t}),\n\t\t\t\trequireHeaders: true,\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Approve device authorization\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { success: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\t\tif (!session) throw new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\terror: \"unauthorized\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.AUTHENTICATION_REQUIRED\n\t\t\t\t});\n\t\t\t\tconst { userCode } = ctx.body;\n\t\t\t\tconst cleanUserCode = userCode.replace(/-/g, \"\");\n\t\t\t\tconst deviceCodeRecord = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userCode\",\n\t\t\t\t\t\tvalue: cleanUserCode\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!deviceCodeRecord) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.INVALID_USER_CODE\n\t\t\t\t});\n\t\t\t\tif (deviceCodeRecord.expiresAt < /* @__PURE__ */ new Date()) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"expired_token\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.EXPIRED_USER_CODE\n\t\t\t\t});\n\t\t\t\tif (deviceCodeRecord.status !== \"pending\") throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.DEVICE_CODE_ALREADY_PROCESSED\n\t\t\t\t});\n\t\t\t\tawait ctx.context.adapter.update({\n\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: deviceCodeRecord.id\n\t\t\t\t\t}],\n\t\t\t\t\tupdate: {\n\t\t\t\t\t\tstatus: \"approved\",\n\t\t\t\t\t\tuserId: session.user.id\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn ctx.json({ success: true });\n\t\t\t}),\n\t\t\tdeviceDeny: createAuthEndpoint(\"/device/deny\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ userCode: z.string().meta({ description: \"The user code to deny\" }) }),\n\t\t\t\terror: z.object({\n\t\t\t\t\terror: z.enum([\"invalid_request\", \"expired_token\"]).meta({ description: \"Error code\" }),\n\t\t\t\t\terror_description: z.string().meta({ description: \"Detailed error description\" })\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Deny device authorization\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { success: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { userCode } = ctx.body;\n\t\t\t\tconst cleanUserCode = userCode.replace(/-/g, \"\");\n\t\t\t\tconst deviceCodeRecord = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userCode\",\n\t\t\t\t\t\tvalue: cleanUserCode\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!deviceCodeRecord) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.INVALID_USER_CODE\n\t\t\t\t});\n\t\t\t\tif (deviceCodeRecord.expiresAt < /* @__PURE__ */ new Date()) throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"expired_token\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.EXPIRED_USER_CODE\n\t\t\t\t});\n\t\t\t\tif (deviceCodeRecord.status !== \"pending\") throw new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.DEVICE_CODE_ALREADY_PROCESSED\n\t\t\t\t});\n\t\t\t\tawait ctx.context.adapter.update({\n\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: deviceCodeRecord.id\n\t\t\t\t\t}],\n\t\t\t\t\tupdate: { status: \"denied\" }\n\t\t\t\t});\n\t\t\t\treturn ctx.json({ success: true });\n\t\t\t})\n\t\t},\n\t\t$ERROR_CODES: DEVICE_AUTHORIZATION_ERROR_CODES\n\t};\n};\n\n//#endregion\nexport { deviceAuthorizationOptionsSchema as n, deviceAuthorization as t };","import { n as symmetricEncrypt, t as symmetricDecrypt } from \"./crypto-CFUhAR9W.mjs\";\nimport { r as getOrigin } from \"./url-CB8xCwz-.mjs\";\nimport { L as originCheck } from \"./api-CkmycQ2x.mjs\";\nimport { l as parseSetCookieHeader } from \"./cookies-D72PbWdz.mjs\";\nimport { t as parseJSON } from \"./parser-pHp5yoAv.mjs\";\nimport { env } from \"@better-auth/core/env\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\n\n//#region src/plugins/oauth-proxy/utils.ts\n/**\n* Get base URL from vendor-specific environment variables\n*/\nfunction getVendorBaseURL() {\n\tconst vercel = env.VERCEL_URL ? `https://${env.VERCEL_URL}` : void 0;\n\tconst netlify = env.NETLIFY_URL;\n\tconst render = env.RENDER_URL;\n\tconst aws = env.AWS_LAMBDA_FUNCTION_NAME;\n\tconst google = env.GOOGLE_CLOUD_FUNCTION_NAME;\n\tconst azure = env.AZURE_FUNCTION_NAME;\n\treturn vercel || netlify || render || aws || google || azure;\n}\n/**\n* Resolve the current URL from various sources\n*/\nfunction resolveCurrentURL(ctx, opts) {\n\treturn new URL(opts?.currentURL || ctx.request?.url || getVendorBaseURL() || ctx.context.baseURL);\n}\n/**\n* Check if the proxy should be skipped for this request\n*/\nfunction checkSkipProxy(ctx, opts) {\n\tif (ctx.request?.headers.get(\"x-skip-oauth-proxy\")) return true;\n\tconst productionURL = opts?.productionURL || env.BETTER_AUTH_URL;\n\tif (!productionURL) return false;\n\tconst currentURL = ctx.request?.url || getVendorBaseURL();\n\tif (!currentURL) return false;\n\treturn getOrigin(productionURL) === getOrigin(currentURL);\n}\n\n//#endregion\n//#region src/plugins/oauth-proxy/index.ts\nconst oAuthProxy = (opts) => {\n\treturn {\n\t\tid: \"oauth-proxy\",\n\t\toptions: opts,\n\t\tendpoints: { oAuthProxy: createAuthEndpoint(\"/oauth-proxy-callback\", {\n\t\t\tmethod: \"GET\",\n\t\t\toperationId: \"oauthProxyCallback\",\n\t\t\tquery: z.object({\n\t\t\t\tcallbackURL: z.string().meta({ description: \"The URL to redirect to after the proxy\" }),\n\t\t\t\tcookies: z.string().meta({ description: \"The cookies to set after the proxy\" })\n\t\t\t}),\n\t\t\tuse: [originCheck((ctx) => ctx.query.callbackURL)],\n\t\t\tmetadata: { openapi: {\n\t\t\t\toperationId: \"oauthProxyCallback\",\n\t\t\t\tdescription: \"OAuth Proxy Callback\",\n\t\t\t\tparameters: [{\n\t\t\t\t\tin: \"query\",\n\t\t\t\t\tname: \"callbackURL\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tdescription: \"The URL to redirect to after the proxy\"\n\t\t\t\t}, {\n\t\t\t\t\tin: \"query\",\n\t\t\t\t\tname: \"cookies\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tdescription: \"The cookies to set after the proxy\"\n\t\t\t\t}],\n\t\t\t\tresponses: { 302: {\n\t\t\t\t\tdescription: \"Redirect\",\n\t\t\t\t\theaders: { Location: {\n\t\t\t\t\t\tdescription: \"The URL to redirect to\",\n\t\t\t\t\t\tschema: { type: \"string\" }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t} }\n\t\t}, async (ctx) => {\n\t\t\tconst decryptedCookies = await symmetricDecrypt({\n\t\t\t\tkey: ctx.context.secret,\n\t\t\t\tdata: ctx.query.cookies\n\t\t\t}).catch((e) => {\n\t\t\t\tctx.context.logger.error(\"Failed to decrypt OAuth proxy cookies:\", e);\n\t\t\t\treturn null;\n\t\t\t});\n\t\t\tif (!decryptedCookies) {\n\t\t\t\tconst errorURL = ctx.context.options.onAPIError?.errorURL || `${ctx.context.options.baseURL}/api/auth/error`;\n\t\t\t\tthrow ctx.redirect(`${errorURL}?error=OAuthProxy - Invalid cookies or secret`);\n\t\t\t}\n\t\t\tconst isSecureContext = resolveCurrentURL(ctx, opts).protocol === \"https:\";\n\t\t\tconst parsedCookies = parseSetCookieHeader(decryptedCookies);\n\t\t\tconst processedCookies = Array.from(parsedCookies.entries()).map(([name, attrs]) => {\n\t\t\t\tconst options = {};\n\t\t\t\tif (attrs.path) options.path = attrs.path;\n\t\t\t\tif (attrs.expires) options.expires = attrs.expires;\n\t\t\t\tif (attrs.samesite) options.sameSite = attrs.samesite;\n\t\t\t\tif (attrs.httponly) options.httpOnly = true;\n\t\t\t\tif (attrs[\"max-age\"] !== void 0) options.maxAge = attrs[\"max-age\"];\n\t\t\t\tif (isSecureContext) options.secure = true;\n\t\t\t\treturn {\n\t\t\t\t\tname,\n\t\t\t\t\toptions,\n\t\t\t\t\tvalue: decodeURIComponent(attrs.value)\n\t\t\t\t};\n\t\t\t});\n\t\t\tfor (const cookie of processedCookies) ctx.setCookie(cookie.name, cookie.value, cookie.options);\n\t\t\tthrow ctx.redirect(ctx.query.callbackURL);\n\t\t}) },\n\t\thooks: {\n\t\t\tbefore: [\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn !!(context.path?.startsWith(\"/sign-in/social\") || context.path?.startsWith(\"/sign-in/oauth2\"));\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tif (checkSkipProxy(ctx, opts)) return;\n\t\t\t\t\t\tconst currentURL = resolveCurrentURL(ctx, opts);\n\t\t\t\t\t\tconst originalCallbackURL = ctx.body?.callbackURL || ctx.context.baseURL;\n\t\t\t\t\t\tconst newCallbackURL = `${currentURL.origin}${ctx.context.options.basePath || \"/api/auth\"}/oauth-proxy-callback?callbackURL=${encodeURIComponent(originalCallbackURL)}`;\n\t\t\t\t\t\tif (!ctx.body) return;\n\t\t\t\t\t\tctx.body.callbackURL = newCallbackURL;\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn !!(context.path?.startsWith(\"/callback\") || context.path?.startsWith(\"/oauth2/callback\"));\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst state = ctx.query?.state || ctx.body?.state;\n\t\t\t\t\t\tif (!state || typeof state !== \"string\") return;\n\t\t\t\t\t\tlet statePackage;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tstatePackage = parseJSON(await symmetricDecrypt({\n\t\t\t\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\t\t\t\tdata: state\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!statePackage.isOAuthProxy || !statePackage.state || !statePackage.stateCookie) return;\n\t\t\t\t\t\tlet stateCookieValue;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tstateCookieValue = await symmetricDecrypt({\n\t\t\t\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\t\t\t\tdata: statePackage.stateCookie\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tparseJSON(stateCookieValue);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tctx.context.logger.error(\"Failed to decrypt OAuth proxy state cookie:\", e);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tctx.context._oauthProxySnapshot = {\n\t\t\t\t\t\t\tstoreStateStrategy: ctx.context.oauthConfig.storeStateStrategy,\n\t\t\t\t\t\t\tskipStateCookieCheck: ctx.context.oauthConfig.skipStateCookieCheck,\n\t\t\t\t\t\t\tinternalAdapter: ctx.context.internalAdapter\n\t\t\t\t\t\t};\n\t\t\t\t\t\tconst originalAdapter = ctx.context.internalAdapter;\n\t\t\t\t\t\tconst capturedStatePackage = statePackage;\n\t\t\t\t\t\tctx.context.oauthConfig.storeStateStrategy = \"database\";\n\t\t\t\t\t\tctx.context.internalAdapter = {\n\t\t\t\t\t\t\t...ctx.context.internalAdapter,\n\t\t\t\t\t\t\tfindVerificationValue: async (identifier) => {\n\t\t\t\t\t\t\t\tif (identifier === capturedStatePackage.state) return {\n\t\t\t\t\t\t\t\t\tid: `oauth-proxy-${capturedStatePackage.state}`,\n\t\t\t\t\t\t\t\t\tidentifier: capturedStatePackage.state,\n\t\t\t\t\t\t\t\t\tvalue: stateCookieValue,\n\t\t\t\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\t\t\t\texpiresAt: new Date(Date.now() + 600 * 1e3)\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\treturn originalAdapter.findVerificationValue(identifier);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (ctx.query?.state) ctx.query.state = statePackage.state;\n\t\t\t\t\t\tif (ctx.body?.state) ctx.body.state = statePackage.state;\n\t\t\t\t\t\tctx.context.oauthConfig.skipStateCookieCheck = true;\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tmatcher() {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tif (ctx.path !== \"/callback/:id\") return;\n\t\t\t\t\t\tif (ctx.context.oauthConfig.storeStateStrategy === \"cookie\") return;\n\t\t\t\t\t\tif (ctx.context._oauthProxySnapshot) return;\n\t\t\t\t\t\tconst state = ctx.query?.state || ctx.body?.state;\n\t\t\t\t\t\tif (!state) return;\n\t\t\t\t\t\tconst data = await ctx.context.internalAdapter.findVerificationValue(state);\n\t\t\t\t\t\tif (!data) return;\n\t\t\t\t\t\tlet parsedState;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tparsedState = parseJSON(data.value);\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\tparsedState = void 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!parsedState?.callbackURL?.includes(\"/oauth-proxy-callback\")) return;\n\t\t\t\t\t\tctx.context._oauthProxySnapshot = {\n\t\t\t\t\t\t\tstoreStateStrategy: ctx.context.oauthConfig.storeStateStrategy,\n\t\t\t\t\t\t\tskipStateCookieCheck: ctx.context.oauthConfig.skipStateCookieCheck,\n\t\t\t\t\t\t\tinternalAdapter: ctx.context.internalAdapter\n\t\t\t\t\t\t};\n\t\t\t\t\t\tctx.context.oauthConfig.skipStateCookieCheck = true;\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t],\n\t\t\tafter: [\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn !!(context.path?.startsWith(\"/sign-in/social\") || context.path?.startsWith(\"/sign-in/oauth2\"));\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tif (checkSkipProxy(ctx, opts)) return;\n\t\t\t\t\t\tif (ctx.context.oauthConfig.storeStateStrategy !== \"cookie\") return;\n\t\t\t\t\t\tconst signInResponse = ctx.context.returned;\n\t\t\t\t\t\tif (!signInResponse || typeof signInResponse !== \"object\" || !(\"url\" in signInResponse)) return;\n\t\t\t\t\t\tconst { url: providerURL } = signInResponse;\n\t\t\t\t\t\tif (typeof providerURL !== \"string\") return;\n\t\t\t\t\t\tconst oauthURL = new URL(providerURL);\n\t\t\t\t\t\tconst originalState = oauthURL.searchParams.get(\"state\");\n\t\t\t\t\t\tif (!originalState) return;\n\t\t\t\t\t\tconst setCookieHeader = ctx.context.responseHeaders?.get(\"set-cookie\");\n\t\t\t\t\t\tif (!setCookieHeader) return;\n\t\t\t\t\t\tconst stateCookie = ctx.context.createAuthCookie(\"oauth_state\");\n\t\t\t\t\t\tconst stateCookieAttrs = parseSetCookieHeader(setCookieHeader).get(stateCookie.name);\n\t\t\t\t\t\tif (!stateCookieAttrs?.value) return;\n\t\t\t\t\t\tconst stateCookieValue = stateCookieAttrs.value;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst statePackage = {\n\t\t\t\t\t\t\t\tstate: originalState,\n\t\t\t\t\t\t\t\tstateCookie: stateCookieValue,\n\t\t\t\t\t\t\t\tisOAuthProxy: true\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tconst encryptedPackage = await symmetricEncrypt({\n\t\t\t\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\t\t\t\tdata: JSON.stringify(statePackage)\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\toauthURL.searchParams.set(\"state\", encryptedPackage);\n\t\t\t\t\t\t\tctx.context.returned = {\n\t\t\t\t\t\t\t\t...signInResponse,\n\t\t\t\t\t\t\t\turl: oauthURL.toString()\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tctx.context.logger.error(\"Failed to encrypt OAuth proxy state package:\", e);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn !!(context.path?.startsWith(\"/callback\") || context.path?.startsWith(\"/oauth2/callback\"));\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst headers = ctx.context.responseHeaders;\n\t\t\t\t\t\tconst location = headers?.get(\"location\");\n\t\t\t\t\t\tif (!location?.includes(\"/oauth-proxy-callback?callbackURL\") || !location.startsWith(\"http\")) return;\n\t\t\t\t\t\tconst productionOrigin = getOrigin(opts?.productionURL || ctx.context.options.baseURL || ctx.context.baseURL);\n\t\t\t\t\t\tconst locationURL = new URL(location);\n\t\t\t\t\t\tif (locationURL.origin === productionOrigin) {\n\t\t\t\t\t\t\tconst newLocation = locationURL.searchParams.get(\"callbackURL\");\n\t\t\t\t\t\t\tif (!newLocation) return;\n\t\t\t\t\t\t\tctx.setHeader(\"location\", newLocation);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst setCookies = headers?.get(\"set-cookie\");\n\t\t\t\t\t\tif (!setCookies) return;\n\t\t\t\t\t\tconst encryptedCookies = await symmetricEncrypt({\n\t\t\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\t\t\tdata: setCookies\n\t\t\t\t\t\t});\n\t\t\t\t\t\tconst locationWithCookies = `${location}&cookies=${encodeURIComponent(encryptedCookies)}`;\n\t\t\t\t\t\tctx.setHeader(\"location\", locationWithCookies);\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn !!(context.path?.startsWith(\"/callback\") || context.path?.startsWith(\"/oauth2/callback\"));\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst contextWithSnapshot = ctx.context;\n\t\t\t\t\t\tconst snapshot = contextWithSnapshot._oauthProxySnapshot;\n\t\t\t\t\t\tif (snapshot) {\n\t\t\t\t\t\t\tctx.context.oauthConfig.storeStateStrategy = snapshot.storeStateStrategy;\n\t\t\t\t\t\t\tctx.context.oauthConfig.skipStateCookieCheck = snapshot.skipStateCookieCheck;\n\t\t\t\t\t\t\tctx.context.internalAdapter = snapshot.internalAdapter;\n\t\t\t\t\t\t\tcontextWithSnapshot._oauthProxySnapshot = void 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t};\n};\n\n//#endregion\nexport { oAuthProxy as t };","import { NEXT_INTERCEPTION_MARKER_PREFIX, NEXT_QUERY_PARAM_PREFIX } from '../../lib/constants';\n/**\n * Converts a Node.js IncomingHttpHeaders object to a Headers object. Any\n * headers with multiple values will be joined with a comma and space. Any\n * headers that have an undefined value will be ignored and others will be\n * coerced to strings.\n *\n * @param nodeHeaders the headers object to convert\n * @returns the converted headers object\n */ export function fromNodeOutgoingHttpHeaders(nodeHeaders) {\n    const headers = new Headers();\n    for (let [key, value] of Object.entries(nodeHeaders)){\n        const values = Array.isArray(value) ? value : [\n            value\n        ];\n        for (let v of values){\n            if (typeof v === 'undefined') continue;\n            if (typeof v === 'number') {\n                v = v.toString();\n            }\n            headers.append(key, v);\n        }\n    }\n    return headers;\n}\n/*\n  Set-Cookie header field-values are sometimes comma joined in one string. This splits them without choking on commas\n  that are within a single set-cookie field-value, such as in the Expires portion.\n  This is uncommon, but explicitly allowed - see https://tools.ietf.org/html/rfc2616#section-4.2\n  Node.js does this for every header *except* set-cookie - see https://github.com/nodejs/node/blob/d5e363b77ebaf1caf67cd7528224b651c86815c1/lib/_http_incoming.js#L128\n  React Native's fetch does this for *every* header, including set-cookie.\n  \n  Based on: https://github.com/google/j2objc/commit/16820fdbc8f76ca0c33472810ce0cb03d20efe25\n  Credits to: https://github.com/tomball for original and https://github.com/chrusart for JavaScript implementation\n*/ export function splitCookiesString(cookiesString) {\n    var cookiesStrings = [];\n    var pos = 0;\n    var start;\n    var ch;\n    var lastComma;\n    var nextStart;\n    var cookiesSeparatorFound;\n    function skipWhitespace() {\n        while(pos < cookiesString.length && /\\s/.test(cookiesString.charAt(pos))){\n            pos += 1;\n        }\n        return pos < cookiesString.length;\n    }\n    function notSpecialChar() {\n        ch = cookiesString.charAt(pos);\n        return ch !== '=' && ch !== ';' && ch !== ',';\n    }\n    while(pos < cookiesString.length){\n        start = pos;\n        cookiesSeparatorFound = false;\n        while(skipWhitespace()){\n            ch = cookiesString.charAt(pos);\n            if (ch === ',') {\n                // ',' is a cookie separator if we have later first '=', not ';' or ','\n                lastComma = pos;\n                pos += 1;\n                skipWhitespace();\n                nextStart = pos;\n                while(pos < cookiesString.length && notSpecialChar()){\n                    pos += 1;\n                }\n                // currently special character\n                if (pos < cookiesString.length && cookiesString.charAt(pos) === '=') {\n                    // we found cookies separator\n                    cookiesSeparatorFound = true;\n                    // pos is inside the next cookie, so back up and return it.\n                    pos = nextStart;\n                    cookiesStrings.push(cookiesString.substring(start, lastComma));\n                    start = pos;\n                } else {\n                    // in param ',' or param separator ';',\n                    // we continue from that comma\n                    pos = lastComma + 1;\n                }\n            } else {\n                pos += 1;\n            }\n        }\n        if (!cookiesSeparatorFound || pos >= cookiesString.length) {\n            cookiesStrings.push(cookiesString.substring(start, cookiesString.length));\n        }\n    }\n    return cookiesStrings;\n}\n/**\n * Converts a Headers object to a Node.js OutgoingHttpHeaders object. This is\n * required to support the set-cookie header, which may have multiple values.\n *\n * @param headers the headers object to convert\n * @returns the converted headers object\n */ export function toNodeOutgoingHttpHeaders(headers) {\n    const nodeHeaders = {};\n    const cookies = [];\n    if (headers) {\n        for (const [key, value] of headers.entries()){\n            if (key.toLowerCase() === 'set-cookie') {\n                // We may have gotten a comma joined string of cookies, or multiple\n                // set-cookie headers. We need to merge them into one header array\n                // to represent all the cookies.\n                cookies.push(...splitCookiesString(value));\n                nodeHeaders[key] = cookies.length === 1 ? cookies[0] : cookies;\n            } else {\n                nodeHeaders[key] = value;\n            }\n        }\n    }\n    return nodeHeaders;\n}\n/**\n * Validate the correctness of a user-provided URL.\n */ export function validateURL(url) {\n    try {\n        return String(new URL(String(url)));\n    } catch (error) {\n        throw Object.defineProperty(new Error(`URL is malformed \"${String(url)}\". Please use only absolute URLs - https://nextjs.org/docs/messages/middleware-relative-urls`, {\n            cause: error\n        }), \"__NEXT_ERROR_CODE\", {\n            value: \"E61\",\n            enumerable: false,\n            configurable: true\n        });\n    }\n}\n/**\n * Normalizes `nxtP` and `nxtI` query param values to remove the prefix.\n * This function does not mutate the input key.\n */ export function normalizeNextQueryParam(key) {\n    const prefixes = [\n        NEXT_QUERY_PARAM_PREFIX,\n        NEXT_INTERCEPTION_MARKER_PREFIX\n    ];\n    for (const prefix of prefixes){\n        if (key !== prefix && key.startsWith(prefix)) {\n            return key.substring(prefix.length);\n        }\n    }\n    return null;\n}\n\n//# sourceMappingURL=utils.js.map","import { isNodeNextResponse } from './base-http/helpers';\nimport { pipeToNodeResponse } from './pipe-readable';\nimport { splitCookiesString } from './web/utils';\n/**\n * Sends the response on the underlying next response object.\n *\n * @param req the underlying request object\n * @param res the underlying response object\n * @param response the response to send\n */ export async function sendResponse(req, res, response, waitUntil) {\n    if (// The type check here ensures that `req` is correctly typed, and the\n    // environment variable check provides dead code elimination.\n    process.env.NEXT_RUNTIME !== 'edge' && isNodeNextResponse(res)) {\n        var // Copy over the response headers.\n        _response_headers;\n        // Copy over the response status.\n        res.statusCode = response.status;\n        res.statusMessage = response.statusText;\n        // TODO: this is not spec-compliant behavior and we should not restrict\n        // headers that are allowed to appear many times.\n        //\n        // See:\n        // https://github.com/vercel/next.js/pull/70127\n        const headersWithMultipleValuesAllowed = [\n            // can add more headers to this list if needed\n            'set-cookie',\n            'www-authenticate',\n            'proxy-authenticate',\n            'vary'\n        ];\n        (_response_headers = response.headers) == null ? void 0 : _response_headers.forEach((value, name)=>{\n            // `x-middleware-set-cookie` is an internal header not needed for the response\n            if (name.toLowerCase() === 'x-middleware-set-cookie') {\n                return;\n            }\n            // The append handling is special cased for `set-cookie`.\n            if (name.toLowerCase() === 'set-cookie') {\n                // TODO: (wyattjoh) replace with native response iteration when we can upgrade undici\n                for (const cookie of splitCookiesString(value)){\n                    res.appendHeader(name, cookie);\n                }\n            } else {\n                // only append the header if it is either not present in the outbound response\n                // or if the header supports multiple values\n                const isHeaderPresent = typeof res.getHeader(name) !== 'undefined';\n                if (headersWithMultipleValuesAllowed.includes(name.toLowerCase()) || !isHeaderPresent) {\n                    res.appendHeader(name, value);\n                }\n            }\n        });\n        /**\n     * The response can't be directly piped to the underlying response. The\n     * following is duplicated from the edge runtime handler.\n     *\n     * See packages/next/server/next-server.ts\n     */ const { originalResponse } = res;\n        // A response body must not be sent for HEAD requests. See https://httpwg.org/specs/rfc9110.html#HEAD\n        if (response.body && req.method !== 'HEAD') {\n            await pipeToNodeResponse(response.body, originalResponse, waitUntil);\n        } else {\n            originalResponse.end();\n        }\n    }\n}\n\n//# sourceMappingURL=send-response.js.map","import { getTracer } from '../lib/trace/tracer';\nimport { AppRenderSpan } from '../lib/trace/constants';\nimport { DetachedPromise } from '../../lib/detached-promise';\nimport { scheduleImmediate, atLeastOneTask } from '../../lib/scheduler';\nimport { ENCODED_TAGS } from './encoded-tags';\nimport { indexOfUint8Array, isEquivalentUint8Arrays, removeFromUint8Array } from './uint8array-helpers';\nimport { MISSING_ROOT_TAGS_ERROR } from '../../shared/lib/errors/constants';\nimport { insertBuildIdComment } from '../../shared/lib/segment-cache/output-export-prefetch-encoding';\nimport { RSC_HEADER, NEXT_ROUTER_PREFETCH_HEADER, NEXT_ROUTER_SEGMENT_PREFETCH_HEADER, NEXT_RSC_UNION_QUERY } from '../../client/components/app-router-headers';\nimport { computeCacheBustingSearchParam } from '../../shared/lib/router/utils/cache-busting-search-param';\nfunction voidCatch() {\n// this catcher is designed to be used with pipeTo where we expect the underlying\n// pipe implementation to forward errors but we don't want the pipeTo promise to reject\n// and be unhandled\n}\n// We can share the same encoder instance everywhere\n// Notably we cannot do the same for TextDecoder because it is stateful\n// when handling streaming data\nconst encoder = new TextEncoder();\nexport function chainStreams(...streams) {\n    // If we have no streams, return an empty stream. This behavior is\n    // intentional as we're now providing the `RenderResult.EMPTY` value.\n    if (streams.length === 0) {\n        return new ReadableStream({\n            start (controller) {\n                controller.close();\n            }\n        });\n    }\n    // If we only have 1 stream we fast path it by returning just this stream\n    if (streams.length === 1) {\n        return streams[0];\n    }\n    const { readable, writable } = new TransformStream();\n    // We always initiate pipeTo immediately. We know we have at least 2 streams\n    // so we need to avoid closing the writable when this one finishes.\n    let promise = streams[0].pipeTo(writable, {\n        preventClose: true\n    });\n    let i = 1;\n    for(; i < streams.length - 1; i++){\n        const nextStream = streams[i];\n        promise = promise.then(()=>nextStream.pipeTo(writable, {\n                preventClose: true\n            }));\n    }\n    // We can omit the length check because we halted before the last stream and there\n    // is at least two streams so the lastStream here will always be defined\n    const lastStream = streams[i];\n    promise = promise.then(()=>lastStream.pipeTo(writable));\n    // Catch any errors from the streams and ignore them, they will be handled\n    // by whatever is consuming the readable stream.\n    promise.catch(voidCatch);\n    return readable;\n}\nexport function streamFromString(str) {\n    return new ReadableStream({\n        start (controller) {\n            controller.enqueue(encoder.encode(str));\n            controller.close();\n        }\n    });\n}\nexport function streamFromBuffer(chunk) {\n    return new ReadableStream({\n        start (controller) {\n            controller.enqueue(chunk);\n            controller.close();\n        }\n    });\n}\nexport async function streamToBuffer(stream) {\n    const reader = stream.getReader();\n    const chunks = [];\n    while(true){\n        const { done, value } = await reader.read();\n        if (done) {\n            break;\n        }\n        chunks.push(value);\n    }\n    return Buffer.concat(chunks);\n}\nexport async function streamToString(stream, signal) {\n    const decoder = new TextDecoder('utf-8', {\n        fatal: true\n    });\n    let string = '';\n    for await (const chunk of stream){\n        if (signal == null ? void 0 : signal.aborted) {\n            return string;\n        }\n        string += decoder.decode(chunk, {\n            stream: true\n        });\n    }\n    string += decoder.decode();\n    return string;\n}\nexport function createBufferedTransformStream(options = {}) {\n    const { maxBufferByteLength = Infinity } = options;\n    let bufferedChunks = [];\n    let bufferByteLength = 0;\n    let pending;\n    const flush = (controller)=>{\n        try {\n            if (bufferedChunks.length === 0) {\n                return;\n            }\n            const chunk = new Uint8Array(bufferByteLength);\n            let copiedBytes = 0;\n            for(let i = 0; i < bufferedChunks.length; i++){\n                const bufferedChunk = bufferedChunks[i];\n                chunk.set(bufferedChunk, copiedBytes);\n                copiedBytes += bufferedChunk.byteLength;\n            }\n            // We just wrote all the buffered chunks so we need to reset the bufferedChunks array\n            // and our bufferByteLength to prepare for the next round of buffered chunks\n            bufferedChunks.length = 0;\n            bufferByteLength = 0;\n            controller.enqueue(chunk);\n        } catch  {\n        // If an error occurs while enqueuing, it can't be due to this\n        // transformer. It's most likely caused by the controller having been\n        // errored (for example, if the stream was cancelled).\n        }\n    };\n    const scheduleFlush = (controller)=>{\n        if (pending) {\n            return;\n        }\n        const detached = new DetachedPromise();\n        pending = detached;\n        scheduleImmediate(()=>{\n            try {\n                flush(controller);\n            } finally{\n                pending = undefined;\n                detached.resolve();\n            }\n        });\n    };\n    return new TransformStream({\n        transform (chunk, controller) {\n            // Combine the previous buffer with the new chunk.\n            bufferedChunks.push(chunk);\n            bufferByteLength += chunk.byteLength;\n            if (bufferByteLength >= maxBufferByteLength) {\n                flush(controller);\n            } else {\n                scheduleFlush(controller);\n            }\n        },\n        flush () {\n            return pending == null ? void 0 : pending.promise;\n        }\n    });\n}\nfunction createPrefetchCommentStream(isBuildTimePrerendering, buildId) {\n    // Insert an extra comment at the beginning of the HTML document. This must\n    // come after the DOCTYPE, which is inserted by React.\n    //\n    // The first chunk sent by React will contain the doctype. After that, we can\n    // pass through the rest of the chunks as-is.\n    let didTransformFirstChunk = false;\n    return new TransformStream({\n        transform (chunk, controller) {\n            if (isBuildTimePrerendering && !didTransformFirstChunk) {\n                didTransformFirstChunk = true;\n                const decoder = new TextDecoder('utf-8', {\n                    fatal: true\n                });\n                const chunkStr = decoder.decode(chunk, {\n                    stream: true\n                });\n                const updatedChunkStr = insertBuildIdComment(chunkStr, buildId);\n                controller.enqueue(encoder.encode(updatedChunkStr));\n                return;\n            }\n            controller.enqueue(chunk);\n        }\n    });\n}\nexport function renderToInitialFizzStream({ ReactDOMServer, element, streamOptions }) {\n    return getTracer().trace(AppRenderSpan.renderToReadableStream, async ()=>ReactDOMServer.renderToReadableStream(element, streamOptions));\n}\nfunction createMetadataTransformStream(insert) {\n    let chunkIndex = -1;\n    let isMarkRemoved = false;\n    return new TransformStream({\n        async transform (chunk, controller) {\n            let iconMarkIndex = -1;\n            let closedHeadIndex = -1;\n            chunkIndex++;\n            if (isMarkRemoved) {\n                controller.enqueue(chunk);\n                return;\n            }\n            let iconMarkLength = 0;\n            // Only search for the closed head tag once\n            if (iconMarkIndex === -1) {\n                iconMarkIndex = indexOfUint8Array(chunk, ENCODED_TAGS.META.ICON_MARK);\n                if (iconMarkIndex === -1) {\n                    controller.enqueue(chunk);\n                    return;\n                } else {\n                    // When we found the `<meta name=\"nxt-icon\"` tag prefix, we will remove it from the chunk.\n                    // Its close tag could either be `/>` or `>`, checking the next char to ensure we cover both cases.\n                    iconMarkLength = ENCODED_TAGS.META.ICON_MARK.length;\n                    // Check if next char is /, this is for xml mode.\n                    if (chunk[iconMarkIndex + iconMarkLength] === 47) {\n                        iconMarkLength += 2;\n                    } else {\n                        // The last char is `>`\n                        iconMarkLength++;\n                    }\n                }\n            }\n            // Check if icon mark is inside <head> tag in the first chunk.\n            if (chunkIndex === 0) {\n                closedHeadIndex = indexOfUint8Array(chunk, ENCODED_TAGS.CLOSED.HEAD);\n                if (iconMarkIndex !== -1) {\n                    // The mark icon is located in the 1st chunk before the head tag.\n                    // We do not need to insert the script tag in this case because it's in the head.\n                    // Just remove the icon mark from the chunk.\n                    if (iconMarkIndex < closedHeadIndex) {\n                        const replaced = new Uint8Array(chunk.length - iconMarkLength);\n                        // Remove the icon mark from the chunk.\n                        replaced.set(chunk.subarray(0, iconMarkIndex));\n                        replaced.set(chunk.subarray(iconMarkIndex + iconMarkLength), iconMarkIndex);\n                        chunk = replaced;\n                    } else {\n                        // The icon mark is after the head tag, replace and insert the script tag at that position.\n                        const insertion = await insert();\n                        const encodedInsertion = encoder.encode(insertion);\n                        const insertionLength = encodedInsertion.length;\n                        const replaced = new Uint8Array(chunk.length - iconMarkLength + insertionLength);\n                        replaced.set(chunk.subarray(0, iconMarkIndex));\n                        replaced.set(encodedInsertion, iconMarkIndex);\n                        replaced.set(chunk.subarray(iconMarkIndex + iconMarkLength), iconMarkIndex + insertionLength);\n                        chunk = replaced;\n                    }\n                    isMarkRemoved = true;\n                }\n            // If there's no icon mark located, it will be handled later when if present in the following chunks.\n            } else {\n                // When it's appeared in the following chunks, we'll need to\n                // remove the mark and then insert the script tag at that position.\n                const insertion = await insert();\n                const encodedInsertion = encoder.encode(insertion);\n                const insertionLength = encodedInsertion.length;\n                // Replace the icon mark with the hoist script or empty string.\n                const replaced = new Uint8Array(chunk.length - iconMarkLength + insertionLength);\n                // Set the first part of the chunk, before the icon mark.\n                replaced.set(chunk.subarray(0, iconMarkIndex));\n                // Set the insertion after the icon mark.\n                replaced.set(encodedInsertion, iconMarkIndex);\n                // Set the rest of the chunk after the icon mark.\n                replaced.set(chunk.subarray(iconMarkIndex + iconMarkLength), iconMarkIndex + insertionLength);\n                chunk = replaced;\n                isMarkRemoved = true;\n            }\n            controller.enqueue(chunk);\n        }\n    });\n}\nfunction createHeadInsertionTransformStream(insert) {\n    let inserted = false;\n    // We need to track if this transform saw any bytes because if it didn't\n    // we won't want to insert any server HTML at all\n    let hasBytes = false;\n    return new TransformStream({\n        async transform (chunk, controller) {\n            hasBytes = true;\n            const insertion = await insert();\n            if (inserted) {\n                if (insertion) {\n                    const encodedInsertion = encoder.encode(insertion);\n                    controller.enqueue(encodedInsertion);\n                }\n                controller.enqueue(chunk);\n            } else {\n                // TODO (@Ethan-Arrowood): Replace the generic `indexOfUint8Array` method with something finely tuned for the subset of things actually being checked for.\n                const index = indexOfUint8Array(chunk, ENCODED_TAGS.CLOSED.HEAD);\n                // In fully static rendering or non PPR rendering cases:\n                // `/head>` will always be found in the chunk in first chunk rendering.\n                if (index !== -1) {\n                    if (insertion) {\n                        const encodedInsertion = encoder.encode(insertion);\n                        // Get the total count of the bytes in the chunk and the insertion\n                        // e.g.\n                        // chunk = <head><meta charset=\"utf-8\"></head>\n                        // insertion = <script>...</script>\n                        // output = <head><meta charset=\"utf-8\"> [ <script>...</script> ] </head>\n                        const insertedHeadContent = new Uint8Array(chunk.length + encodedInsertion.length);\n                        // Append the first part of the chunk, before the head tag\n                        insertedHeadContent.set(chunk.slice(0, index));\n                        // Append the server inserted content\n                        insertedHeadContent.set(encodedInsertion, index);\n                        // Append the rest of the chunk\n                        insertedHeadContent.set(chunk.slice(index), index + encodedInsertion.length);\n                        controller.enqueue(insertedHeadContent);\n                    } else {\n                        controller.enqueue(chunk);\n                    }\n                    inserted = true;\n                } else {\n                    // This will happens in PPR rendering during next start, when the page is partially rendered.\n                    // When the page resumes, the head tag will be found in the middle of the chunk.\n                    // Where we just need to append the insertion and chunk to the current stream.\n                    // e.g.\n                    // PPR-static: <head>...</head><body> [ resume content ] </body>\n                    // PPR-resume: [ insertion ] [ rest content ]\n                    if (insertion) {\n                        controller.enqueue(encoder.encode(insertion));\n                    }\n                    controller.enqueue(chunk);\n                    inserted = true;\n                }\n            }\n        },\n        async flush (controller) {\n            // Check before closing if there's anything remaining to insert.\n            if (hasBytes) {\n                const insertion = await insert();\n                if (insertion) {\n                    controller.enqueue(encoder.encode(insertion));\n                }\n            }\n        }\n    });\n}\nfunction createClientResumeScriptInsertionTransformStream() {\n    const segmentPath = '/_full';\n    const cacheBustingHeader = computeCacheBustingSearchParam('1', '/_full', undefined, undefined //       headers[NEXT_URL]\n    );\n    const searchStr = `${NEXT_RSC_UNION_QUERY}=${cacheBustingHeader}`;\n    const NEXT_CLIENT_RESUME_SCRIPT = `<script>__NEXT_CLIENT_RESUME=fetch(location.pathname+'?${searchStr}',{credentials:'same-origin',headers:{'${RSC_HEADER}': '1','${NEXT_ROUTER_PREFETCH_HEADER}': '1','${NEXT_ROUTER_SEGMENT_PREFETCH_HEADER}': '${segmentPath}'}})</script>`;\n    let didAlreadyInsert = false;\n    return new TransformStream({\n        transform (chunk, controller) {\n            if (didAlreadyInsert) {\n                // Already inserted the script into the head. Pass through.\n                controller.enqueue(chunk);\n                return;\n            }\n            // TODO (@Ethan-Arrowood): Replace the generic `indexOfUint8Array` method with something finely tuned for the subset of things actually being checked for.\n            const headClosingTagIndex = indexOfUint8Array(chunk, ENCODED_TAGS.CLOSED.HEAD);\n            if (headClosingTagIndex === -1) {\n                // In fully static rendering or non PPR rendering cases:\n                // `/head>` will always be found in the chunk in first chunk rendering.\n                controller.enqueue(chunk);\n                return;\n            }\n            const encodedInsertion = encoder.encode(NEXT_CLIENT_RESUME_SCRIPT);\n            // Get the total count of the bytes in the chunk and the insertion\n            // e.g.\n            // chunk = <head><meta charset=\"utf-8\"></head>\n            // insertion = <script>...</script>\n            // output = <head><meta charset=\"utf-8\"> [ <script>...</script> ] </head>\n            const insertedHeadContent = new Uint8Array(chunk.length + encodedInsertion.length);\n            // Append the first part of the chunk, before the head tag\n            insertedHeadContent.set(chunk.slice(0, headClosingTagIndex));\n            // Append the server inserted content\n            insertedHeadContent.set(encodedInsertion, headClosingTagIndex);\n            // Append the rest of the chunk\n            insertedHeadContent.set(chunk.slice(headClosingTagIndex), headClosingTagIndex + encodedInsertion.length);\n            controller.enqueue(insertedHeadContent);\n            didAlreadyInsert = true;\n        }\n    });\n}\n// Suffix after main body content - scripts before </body>,\n// but wait for the major chunks to be enqueued.\nfunction createDeferredSuffixStream(suffix) {\n    let flushed = false;\n    let pending;\n    const flush = (controller)=>{\n        const detached = new DetachedPromise();\n        pending = detached;\n        scheduleImmediate(()=>{\n            try {\n                controller.enqueue(encoder.encode(suffix));\n            } catch  {\n            // If an error occurs while enqueuing it can't be due to this\n            // transformers fault. It's likely due to the controller being\n            // errored due to the stream being cancelled.\n            } finally{\n                pending = undefined;\n                detached.resolve();\n            }\n        });\n    };\n    return new TransformStream({\n        transform (chunk, controller) {\n            controller.enqueue(chunk);\n            // If we've already flushed, we're done.\n            if (flushed) return;\n            // Schedule the flush to happen.\n            flushed = true;\n            flush(controller);\n        },\n        flush (controller) {\n            if (pending) return pending.promise;\n            if (flushed) return;\n            // Flush now.\n            controller.enqueue(encoder.encode(suffix));\n        }\n    });\n}\nfunction createFlightDataInjectionTransformStream(stream, delayDataUntilFirstHtmlChunk) {\n    let htmlStreamFinished = false;\n    let pull = null;\n    let donePulling = false;\n    function startOrContinuePulling(controller) {\n        if (!pull) {\n            pull = startPulling(controller);\n        }\n        return pull;\n    }\n    async function startPulling(controller) {\n        const reader = stream.getReader();\n        if (delayDataUntilFirstHtmlChunk) {\n            // NOTE: streaming flush\n            // We are buffering here for the inlined data stream because the\n            // \"shell\" stream might be chunkenized again by the underlying stream\n            // implementation, e.g. with a specific high-water mark. To ensure it's\n            // the safe timing to pipe the data stream, this extra tick is\n            // necessary.\n            // We don't start reading until we've left the current Task to ensure\n            // that it's inserted after flushing the shell. Note that this implementation\n            // might get stale if impl details of Fizz change in the future.\n            await atLeastOneTask();\n        }\n        try {\n            while(true){\n                const { done, value } = await reader.read();\n                if (done) {\n                    donePulling = true;\n                    return;\n                }\n                // We want to prioritize HTML over RSC data.\n                // The SSR render is based on the same RSC stream, so when we get a new RSC chunk,\n                // we're likely to produce an HTML chunk as well, so give it a chance to flush first.\n                if (!delayDataUntilFirstHtmlChunk && !htmlStreamFinished) {\n                    await atLeastOneTask();\n                }\n                controller.enqueue(value);\n            }\n        } catch (err) {\n            controller.error(err);\n        }\n    }\n    return new TransformStream({\n        start (controller) {\n            if (!delayDataUntilFirstHtmlChunk) {\n                startOrContinuePulling(controller);\n            }\n        },\n        transform (chunk, controller) {\n            controller.enqueue(chunk);\n            // Start the streaming if it hasn't already been started yet.\n            if (delayDataUntilFirstHtmlChunk) {\n                startOrContinuePulling(controller);\n            }\n        },\n        flush (controller) {\n            htmlStreamFinished = true;\n            if (donePulling) {\n                return;\n            }\n            return startOrContinuePulling(controller);\n        }\n    });\n}\nconst CLOSE_TAG = '</body></html>';\n/**\n * This transform stream moves the suffix to the end of the stream, so results\n * like `</body></html><script>...</script>` will be transformed to\n * `<script>...</script></body></html>`.\n */ function createMoveSuffixStream() {\n    let foundSuffix = false;\n    return new TransformStream({\n        transform (chunk, controller) {\n            if (foundSuffix) {\n                return controller.enqueue(chunk);\n            }\n            const index = indexOfUint8Array(chunk, ENCODED_TAGS.CLOSED.BODY_AND_HTML);\n            if (index > -1) {\n                foundSuffix = true;\n                // If the whole chunk is the suffix, then don't write anything, it will\n                // be written in the flush.\n                if (chunk.length === ENCODED_TAGS.CLOSED.BODY_AND_HTML.length) {\n                    return;\n                }\n                // Write out the part before the suffix.\n                const before = chunk.slice(0, index);\n                controller.enqueue(before);\n                // In the case where the suffix is in the middle of the chunk, we need\n                // to split the chunk into two parts.\n                if (chunk.length > ENCODED_TAGS.CLOSED.BODY_AND_HTML.length + index) {\n                    // Write out the part after the suffix.\n                    const after = chunk.slice(index + ENCODED_TAGS.CLOSED.BODY_AND_HTML.length);\n                    controller.enqueue(after);\n                }\n            } else {\n                controller.enqueue(chunk);\n            }\n        },\n        flush (controller) {\n            // Even if we didn't find the suffix, the HTML is not valid if we don't\n            // add it, so insert it at the end.\n            controller.enqueue(ENCODED_TAGS.CLOSED.BODY_AND_HTML);\n        }\n    });\n}\nfunction createStripDocumentClosingTagsTransform() {\n    return new TransformStream({\n        transform (chunk, controller) {\n            // We rely on the assumption that chunks will never break across a code unit.\n            // This is reasonable because we currently concat all of React's output from a single\n            // flush into one chunk before streaming it forward which means the chunk will represent\n            // a single coherent utf-8 string. This is not safe to use if we change our streaming to no\n            // longer do this large buffered chunk\n            if (isEquivalentUint8Arrays(chunk, ENCODED_TAGS.CLOSED.BODY_AND_HTML) || isEquivalentUint8Arrays(chunk, ENCODED_TAGS.CLOSED.BODY) || isEquivalentUint8Arrays(chunk, ENCODED_TAGS.CLOSED.HTML)) {\n                // the entire chunk is the closing tags; return without enqueueing anything.\n                return;\n            }\n            // We assume these tags will go at together at the end of the document and that\n            // they won't appear anywhere else in the document. This is not really a safe assumption\n            // but until we revamp our streaming infra this is a performant way to string the tags\n            chunk = removeFromUint8Array(chunk, ENCODED_TAGS.CLOSED.BODY);\n            chunk = removeFromUint8Array(chunk, ENCODED_TAGS.CLOSED.HTML);\n            controller.enqueue(chunk);\n        }\n    });\n}\n/*\n * Checks if the root layout is missing the html or body tags\n * and if so, it will inject a script tag to throw an error in the browser, showing the user\n * the error message in the error overlay.\n */ export function createRootLayoutValidatorStream() {\n    let foundHtml = false;\n    let foundBody = false;\n    return new TransformStream({\n        async transform (chunk, controller) {\n            // Peek into the streamed chunk to see if the tags are present.\n            if (!foundHtml && indexOfUint8Array(chunk, ENCODED_TAGS.OPENING.HTML) > -1) {\n                foundHtml = true;\n            }\n            if (!foundBody && indexOfUint8Array(chunk, ENCODED_TAGS.OPENING.BODY) > -1) {\n                foundBody = true;\n            }\n            controller.enqueue(chunk);\n        },\n        flush (controller) {\n            const missingTags = [];\n            if (!foundHtml) missingTags.push('html');\n            if (!foundBody) missingTags.push('body');\n            if (!missingTags.length) return;\n            controller.enqueue(encoder.encode(`<html id=\"__next_error__\">\n            <template\n              data-next-error-message=\"Missing ${missingTags.map((c)=>`<${c}>`).join(missingTags.length > 1 ? ' and ' : '')} tags in the root layout.\\nRead more at https://nextjs.org/docs/messages/missing-root-layout-tags\"\n              data-next-error-digest=\"${MISSING_ROOT_TAGS_ERROR}\"\n              data-next-error-stack=\"\"\n            ></template>\n          `));\n        }\n    });\n}\nfunction chainTransformers(readable, transformers) {\n    let stream = readable;\n    for (const transformer of transformers){\n        if (!transformer) continue;\n        stream = stream.pipeThrough(transformer);\n    }\n    return stream;\n}\nexport async function continueFizzStream(renderStream, { suffix, inlinedDataStream, isStaticGeneration, isBuildTimePrerendering, buildId, getServerInsertedHTML, getServerInsertedMetadata, validateRootLayout }) {\n    // Suffix itself might contain close tags at the end, so we need to split it.\n    const suffixUnclosed = suffix ? suffix.split(CLOSE_TAG, 1)[0] : null;\n    // If we're generating static HTML we need to wait for it to resolve before continuing.\n    if (isStaticGeneration) {\n        await renderStream.allReady;\n    }\n    return chainTransformers(renderStream, [\n        // Buffer everything to avoid flushing too frequently\n        createBufferedTransformStream(),\n        // Add build id comment to start of the HTML document (in export mode)\n        createPrefetchCommentStream(isBuildTimePrerendering, buildId),\n        // Transform metadata\n        createMetadataTransformStream(getServerInsertedMetadata),\n        // Insert suffix content\n        suffixUnclosed != null && suffixUnclosed.length > 0 ? createDeferredSuffixStream(suffixUnclosed) : null,\n        // Insert the inlined data (Flight data, form state, etc.) stream into the HTML\n        inlinedDataStream ? createFlightDataInjectionTransformStream(inlinedDataStream, true) : null,\n        // Validate the root layout for missing html or body tags\n        validateRootLayout ? createRootLayoutValidatorStream() : null,\n        // Close tags should always be deferred to the end\n        createMoveSuffixStream(),\n        // Special head insertions\n        // TODO-APP: Insert server side html to end of head in app layout rendering, to avoid\n        // hydration errors. Remove this once it's ready to be handled by react itself.\n        createHeadInsertionTransformStream(getServerInsertedHTML)\n    ]);\n}\nexport async function continueDynamicPrerender(prerenderStream, { getServerInsertedHTML, getServerInsertedMetadata }) {\n    return prerenderStream// Buffer everything to avoid flushing too frequently\n    .pipeThrough(createBufferedTransformStream()).pipeThrough(createStripDocumentClosingTagsTransform())// Insert generated tags to head\n    .pipeThrough(createHeadInsertionTransformStream(getServerInsertedHTML))// Transform metadata\n    .pipeThrough(createMetadataTransformStream(getServerInsertedMetadata));\n}\nexport async function continueStaticPrerender(prerenderStream, { inlinedDataStream, getServerInsertedHTML, getServerInsertedMetadata, isBuildTimePrerendering, buildId }) {\n    return prerenderStream// Buffer everything to avoid flushing too frequently\n    .pipeThrough(createBufferedTransformStream())// Add build id comment to start of the HTML document (in export mode)\n    .pipeThrough(createPrefetchCommentStream(isBuildTimePrerendering, buildId))// Insert generated tags to head\n    .pipeThrough(createHeadInsertionTransformStream(getServerInsertedHTML))// Transform metadata\n    .pipeThrough(createMetadataTransformStream(getServerInsertedMetadata))// Insert the inlined data (Flight data, form state, etc.) stream into the HTML\n    .pipeThrough(createFlightDataInjectionTransformStream(inlinedDataStream, true))// Close tags should always be deferred to the end\n    .pipeThrough(createMoveSuffixStream());\n}\nexport async function continueStaticFallbackPrerender(prerenderStream, { inlinedDataStream, getServerInsertedHTML, getServerInsertedMetadata, isBuildTimePrerendering, buildId }) {\n    // Same as `continueStaticPrerender`, but also inserts an additional script\n    // to instruct the client to start fetching the hydration data as early\n    // as possible.\n    return prerenderStream// Buffer everything to avoid flushing too frequently\n    .pipeThrough(createBufferedTransformStream())// Add build id comment to start of the HTML document (in export mode)\n    .pipeThrough(createPrefetchCommentStream(isBuildTimePrerendering, buildId))// Insert generated tags to head\n    .pipeThrough(createHeadInsertionTransformStream(getServerInsertedHTML))// Insert the client resume script into the head\n    .pipeThrough(createClientResumeScriptInsertionTransformStream())// Transform metadata\n    .pipeThrough(createMetadataTransformStream(getServerInsertedMetadata))// Insert the inlined data (Flight data, form state, etc.) stream into the HTML\n    .pipeThrough(createFlightDataInjectionTransformStream(inlinedDataStream, true))// Close tags should always be deferred to the end\n    .pipeThrough(createMoveSuffixStream());\n}\nexport async function continueDynamicHTMLResume(renderStream, { delayDataUntilFirstHtmlChunk, inlinedDataStream, getServerInsertedHTML, getServerInsertedMetadata }) {\n    return renderStream// Buffer everything to avoid flushing too frequently\n    .pipeThrough(createBufferedTransformStream())// Insert generated tags to head\n    .pipeThrough(createHeadInsertionTransformStream(getServerInsertedHTML))// Transform metadata\n    .pipeThrough(createMetadataTransformStream(getServerInsertedMetadata))// Insert the inlined data (Flight data, form state, etc.) stream into the HTML\n    .pipeThrough(createFlightDataInjectionTransformStream(inlinedDataStream, delayDataUntilFirstHtmlChunk))// Close tags should always be deferred to the end\n    .pipeThrough(createMoveSuffixStream());\n}\nexport function createDocumentClosingStream() {\n    return streamFromString(CLOSE_TAG);\n}\n\n//# sourceMappingURL=node-web-streams-helper.js.map","import { AppRenderSpan, NextNodeServerSpan } from './trace/constants';\nimport { getTracer, SpanKind } from './trace/tracer';\nimport { CACHE_ONE_YEAR, INFINITE_CACHE, NEXT_CACHE_TAG_MAX_ITEMS, NEXT_CACHE_TAG_MAX_LENGTH } from '../../lib/constants';\nimport { markCurrentScopeAsDynamic } from '../app-render/dynamic-rendering';\nimport { makeHangingPromise } from '../dynamic-rendering-utils';\nimport { createDedupeFetch } from './dedupe-fetch';\nimport { getCacheSignal } from '../app-render/work-unit-async-storage.external';\nimport { CachedRouteKind, IncrementalCacheKind } from '../response-cache';\nimport { cloneResponse } from './clone-response';\nimport { RenderStage } from '../app-render/staged-rendering';\nconst isEdgeRuntime = process.env.NEXT_RUNTIME === 'edge';\nexport const NEXT_PATCH_SYMBOL = Symbol.for('next-patch');\nfunction isFetchPatched() {\n    return globalThis[NEXT_PATCH_SYMBOL] === true;\n}\nexport function validateRevalidate(revalidateVal, route) {\n    try {\n        let normalizedRevalidate = undefined;\n        if (revalidateVal === false) {\n            normalizedRevalidate = INFINITE_CACHE;\n        } else if (typeof revalidateVal === 'number' && !isNaN(revalidateVal) && revalidateVal > -1) {\n            normalizedRevalidate = revalidateVal;\n        } else if (typeof revalidateVal !== 'undefined') {\n            throw Object.defineProperty(new Error(`Invalid revalidate value \"${revalidateVal}\" on \"${route}\", must be a non-negative number or false`), \"__NEXT_ERROR_CODE\", {\n                value: \"E179\",\n                enumerable: false,\n                configurable: true\n            });\n        }\n        return normalizedRevalidate;\n    } catch (err) {\n        // handle client component error from attempting to check revalidate value\n        if (err instanceof Error && err.message.includes('Invalid revalidate')) {\n            throw err;\n        }\n        return undefined;\n    }\n}\nexport function validateTags(tags, description) {\n    const validTags = [];\n    const invalidTags = [];\n    for(let i = 0; i < tags.length; i++){\n        const tag = tags[i];\n        if (typeof tag !== 'string') {\n            invalidTags.push({\n                tag,\n                reason: 'invalid type, must be a string'\n            });\n        } else if (tag.length > NEXT_CACHE_TAG_MAX_LENGTH) {\n            invalidTags.push({\n                tag,\n                reason: `exceeded max length of ${NEXT_CACHE_TAG_MAX_LENGTH}`\n            });\n        } else {\n            validTags.push(tag);\n        }\n        if (validTags.length > NEXT_CACHE_TAG_MAX_ITEMS) {\n            console.warn(`Warning: exceeded max tag count for ${description}, dropped tags:`, tags.slice(i).join(', '));\n            break;\n        }\n    }\n    if (invalidTags.length > 0) {\n        console.warn(`Warning: invalid tags passed to ${description}: `);\n        for (const { tag, reason } of invalidTags){\n            console.log(`tag: \"${tag}\" ${reason}`);\n        }\n    }\n    return validTags;\n}\nfunction trackFetchMetric(workStore, ctx) {\n    if (!workStore.shouldTrackFetchMetrics) {\n        return;\n    }\n    workStore.fetchMetrics ??= [];\n    workStore.fetchMetrics.push({\n        ...ctx,\n        end: performance.timeOrigin + performance.now(),\n        idx: workStore.nextFetchId || 0\n    });\n}\nasync function createCachedPrerenderResponse(res, cacheKey, incrementalCacheContext, incrementalCache, revalidate, handleUnlock) {\n    // We are prerendering at build time or revalidate time with cacheComponents so we\n    // need to buffer the response so we can guarantee it can be read in a\n    // microtask.\n    const bodyBuffer = await res.arrayBuffer();\n    const fetchedData = {\n        headers: Object.fromEntries(res.headers.entries()),\n        body: Buffer.from(bodyBuffer).toString('base64'),\n        status: res.status,\n        url: res.url\n    };\n    // We can skip setting the serverComponentsHmrCache because we aren't in dev\n    // mode.\n    if (incrementalCacheContext) {\n        await incrementalCache.set(cacheKey, {\n            kind: CachedRouteKind.FETCH,\n            data: fetchedData,\n            revalidate\n        }, incrementalCacheContext);\n    }\n    await handleUnlock();\n    // We return a new Response to the caller.\n    return new Response(bodyBuffer, {\n        headers: res.headers,\n        status: res.status,\n        statusText: res.statusText\n    });\n}\nasync function createCachedDynamicResponse(workStore, res, cacheKey, incrementalCacheContext, incrementalCache, serverComponentsHmrCache, revalidate, input, handleUnlock) {\n    // We're cloning the response using this utility because there exists a bug in\n    // the undici library around response cloning. See the following pull request\n    // for more details: https://github.com/vercel/next.js/pull/73274\n    const [cloned1, cloned2] = cloneResponse(res);\n    // We are dynamically rendering including dev mode. We want to return the\n    // response to the caller as soon as possible because it might stream over a\n    // very long time.\n    const cacheSetPromise = cloned1.arrayBuffer().then(async (arrayBuffer)=>{\n        const bodyBuffer = Buffer.from(arrayBuffer);\n        const fetchedData = {\n            headers: Object.fromEntries(cloned1.headers.entries()),\n            body: bodyBuffer.toString('base64'),\n            status: cloned1.status,\n            url: cloned1.url\n        };\n        serverComponentsHmrCache == null ? void 0 : serverComponentsHmrCache.set(cacheKey, fetchedData);\n        if (incrementalCacheContext) {\n            await incrementalCache.set(cacheKey, {\n                kind: CachedRouteKind.FETCH,\n                data: fetchedData,\n                revalidate\n            }, incrementalCacheContext);\n        }\n    }).catch((error)=>console.warn(`Failed to set fetch cache`, input, error)).finally(handleUnlock);\n    const pendingRevalidateKey = `cache-set-${cacheKey}`;\n    workStore.pendingRevalidates ??= {};\n    if (pendingRevalidateKey in workStore.pendingRevalidates) {\n        // there is already a pending revalidate entry that we need to await to\n        // avoid race conditions\n        await workStore.pendingRevalidates[pendingRevalidateKey];\n    }\n    workStore.pendingRevalidates[pendingRevalidateKey] = cacheSetPromise.finally(()=>{\n        var _workStore_pendingRevalidates;\n        // If the pending revalidate is not present in the store, then we have\n        // nothing to delete.\n        if (!((_workStore_pendingRevalidates = workStore.pendingRevalidates) == null ? void 0 : _workStore_pendingRevalidates[pendingRevalidateKey])) {\n            return;\n        }\n        delete workStore.pendingRevalidates[pendingRevalidateKey];\n    });\n    return cloned2;\n}\nexport function createPatchedFetcher(originFetch, { workAsyncStorage, workUnitAsyncStorage }) {\n    // Create the patched fetch function.\n    const patched = async function fetch(input, init) {\n        var _init_method, _init_next;\n        let url;\n        try {\n            url = new URL(input instanceof Request ? input.url : input);\n            url.username = '';\n            url.password = '';\n        } catch  {\n            // Error caused by malformed URL should be handled by native fetch\n            url = undefined;\n        }\n        const fetchUrl = (url == null ? void 0 : url.href) ?? '';\n        const method = (init == null ? void 0 : (_init_method = init.method) == null ? void 0 : _init_method.toUpperCase()) || 'GET';\n        // Do create a new span trace for internal fetches in the\n        // non-verbose mode.\n        const isInternal = (init == null ? void 0 : (_init_next = init.next) == null ? void 0 : _init_next.internal) === true;\n        const hideSpan = process.env.NEXT_OTEL_FETCH_DISABLED === '1';\n        // We don't track fetch metrics for internal fetches\n        // so it's not critical that we have a start time, as it won't be recorded.\n        // This is to workaround a flaky issue where performance APIs might\n        // not be available and will require follow-up investigation.\n        const fetchStart = isInternal ? undefined : performance.timeOrigin + performance.now();\n        const workStore = workAsyncStorage.getStore();\n        const workUnitStore = workUnitAsyncStorage.getStore();\n        let cacheSignal = workUnitStore ? getCacheSignal(workUnitStore) : null;\n        if (cacheSignal) {\n            cacheSignal.beginRead();\n        }\n        const result = getTracer().trace(isInternal ? NextNodeServerSpan.internalFetch : AppRenderSpan.fetch, {\n            hideSpan,\n            kind: SpanKind.CLIENT,\n            spanName: [\n                'fetch',\n                method,\n                fetchUrl\n            ].filter(Boolean).join(' '),\n            attributes: {\n                'http.url': fetchUrl,\n                'http.method': method,\n                'net.peer.name': url == null ? void 0 : url.hostname,\n                'net.peer.port': (url == null ? void 0 : url.port) || undefined\n            }\n        }, async ()=>{\n            var _getRequestMeta;\n            // If this is an internal fetch, we should not do any special treatment.\n            if (isInternal) {\n                return originFetch(input, init);\n            }\n            // If the workStore is not available, we can't do any\n            // special treatment of fetch, therefore fallback to the original\n            // fetch implementation.\n            if (!workStore) {\n                return originFetch(input, init);\n            }\n            // We should also fallback to the original fetch implementation if we\n            // are in draft mode, it does not constitute a static generation.\n            if (workStore.isDraftMode) {\n                return originFetch(input, init);\n            }\n            const isRequestInput = input && typeof input === 'object' && typeof input.method === 'string';\n            const getRequestMeta = (field)=>{\n                // If request input is present but init is not, retrieve from input first.\n                const value = init == null ? void 0 : init[field];\n                return value || (isRequestInput ? input[field] : null);\n            };\n            let finalRevalidate = undefined;\n            const getNextField = (field)=>{\n                var _init_next, _init_next1, _input_next;\n                return typeof (init == null ? void 0 : (_init_next = init.next) == null ? void 0 : _init_next[field]) !== 'undefined' ? init == null ? void 0 : (_init_next1 = init.next) == null ? void 0 : _init_next1[field] : isRequestInput ? (_input_next = input.next) == null ? void 0 : _input_next[field] : undefined;\n            };\n            // RequestInit doesn't keep extra fields e.g. next so it's\n            // only available if init is used separate\n            const originalFetchRevalidate = getNextField('revalidate');\n            let currentFetchRevalidate = originalFetchRevalidate;\n            const tags = validateTags(getNextField('tags') || [], `fetch ${input.toString()}`);\n            let revalidateStore;\n            if (workUnitStore) {\n                switch(workUnitStore.type){\n                    case 'prerender':\n                    case 'prerender-runtime':\n                    // TODO: Stop accumulating tags in client prerender. (fallthrough)\n                    case 'prerender-client':\n                    case 'prerender-ppr':\n                    case 'prerender-legacy':\n                    case 'cache':\n                    case 'private-cache':\n                        revalidateStore = workUnitStore;\n                        break;\n                    case 'request':\n                    case 'unstable-cache':\n                        break;\n                    default:\n                        workUnitStore;\n                }\n            }\n            if (revalidateStore) {\n                if (Array.isArray(tags)) {\n                    // Collect tags onto parent caches or parent prerenders.\n                    const collectedTags = revalidateStore.tags ?? (revalidateStore.tags = []);\n                    for (const tag of tags){\n                        if (!collectedTags.includes(tag)) {\n                            collectedTags.push(tag);\n                        }\n                    }\n                }\n            }\n            const implicitTags = workUnitStore == null ? void 0 : workUnitStore.implicitTags;\n            let pageFetchCacheMode = workStore.fetchCache;\n            if (workUnitStore) {\n                switch(workUnitStore.type){\n                    case 'unstable-cache':\n                        // Inside unstable-cache we treat it the same as force-no-store on\n                        // the page.\n                        pageFetchCacheMode = 'force-no-store';\n                        break;\n                    case 'prerender':\n                    case 'prerender-client':\n                    case 'prerender-runtime':\n                    case 'prerender-ppr':\n                    case 'prerender-legacy':\n                    case 'request':\n                    case 'cache':\n                    case 'private-cache':\n                        break;\n                    default:\n                        workUnitStore;\n                }\n            }\n            const isUsingNoStore = !!workStore.isUnstableNoStore;\n            let currentFetchCacheConfig = getRequestMeta('cache');\n            let cacheReason = '';\n            let cacheWarning;\n            if (typeof currentFetchCacheConfig === 'string' && typeof currentFetchRevalidate !== 'undefined') {\n                // If the revalidate value conflicts with the cache value, we should warn the user and unset the conflicting values.\n                const isConflictingRevalidate = // revalidate: 0 and cache: force-cache\n                currentFetchCacheConfig === 'force-cache' && currentFetchRevalidate === 0 || // revalidate: >0 or revalidate: false and cache: no-store\n                currentFetchCacheConfig === 'no-store' && (currentFetchRevalidate > 0 || currentFetchRevalidate === false);\n                if (isConflictingRevalidate) {\n                    cacheWarning = `Specified \"cache: ${currentFetchCacheConfig}\" and \"revalidate: ${currentFetchRevalidate}\", only one should be specified.`;\n                    currentFetchCacheConfig = undefined;\n                    currentFetchRevalidate = undefined;\n                }\n            }\n            const hasExplicitFetchCacheOptOut = // fetch config itself signals not to cache\n            currentFetchCacheConfig === 'no-cache' || currentFetchCacheConfig === 'no-store' || // the fetch isn't explicitly caching and the segment level cache config signals not to cache\n            // note: `pageFetchCacheMode` is also set by being in an unstable_cache context.\n            pageFetchCacheMode === 'force-no-store' || pageFetchCacheMode === 'only-no-store';\n            // If no explicit fetch cache mode is set, but dynamic = `force-dynamic` is set,\n            // we shouldn't consider caching the fetch. This is because the `dynamic` cache\n            // is considered a \"top-level\" cache mode, whereas something like `fetchCache` is more\n            // fine-grained. Top-level modes are responsible for setting reasonable defaults for the\n            // other configurations.\n            const noFetchConfigAndForceDynamic = !pageFetchCacheMode && !currentFetchCacheConfig && !currentFetchRevalidate && workStore.forceDynamic;\n            if (// force-cache was specified without a revalidate value. We set the revalidate value to false\n            // which will signal the cache to not revalidate\n            currentFetchCacheConfig === 'force-cache' && typeof currentFetchRevalidate === 'undefined') {\n                currentFetchRevalidate = false;\n            } else if (hasExplicitFetchCacheOptOut || noFetchConfigAndForceDynamic) {\n                currentFetchRevalidate = 0;\n            }\n            if (currentFetchCacheConfig === 'no-cache' || currentFetchCacheConfig === 'no-store') {\n                cacheReason = `cache: ${currentFetchCacheConfig}`;\n            }\n            finalRevalidate = validateRevalidate(currentFetchRevalidate, workStore.route);\n            const _headers = getRequestMeta('headers');\n            const initHeaders = typeof (_headers == null ? void 0 : _headers.get) === 'function' ? _headers : new Headers(_headers || {});\n            const hasUnCacheableHeader = initHeaders.get('authorization') || initHeaders.get('cookie');\n            const isUnCacheableMethod = ![\n                'get',\n                'head'\n            ].includes(((_getRequestMeta = getRequestMeta('method')) == null ? void 0 : _getRequestMeta.toLowerCase()) || 'get');\n            /**\n         * We automatically disable fetch caching under the following conditions:\n         * - Fetch cache configs are not set. Specifically:\n         *    - A page fetch cache mode is not set (export const fetchCache=...)\n         *    - A fetch cache mode is not set in the fetch call (fetch(url, { cache: ... }))\n         *      or the fetch cache mode is set to 'default'\n         *    - A fetch revalidate value is not set in the fetch call (fetch(url, { revalidate: ... }))\n         * - OR the fetch comes after a configuration that triggered dynamic rendering (e.g., reading cookies())\n         *   and the fetch was considered uncacheable (e.g., POST method or has authorization headers)\n         */ const hasNoExplicitCacheConfig = // eslint-disable-next-line eqeqeq\n            pageFetchCacheMode == undefined && // eslint-disable-next-line eqeqeq\n            (currentFetchCacheConfig == undefined || // when considering whether to opt into the default \"no-cache\" fetch semantics,\n            // a \"default\" cache config should be treated the same as no cache config\n            currentFetchCacheConfig === 'default') && // eslint-disable-next-line eqeqeq\n            currentFetchRevalidate == undefined;\n            let autoNoCache = Boolean((hasUnCacheableHeader || isUnCacheableMethod) && (revalidateStore == null ? void 0 : revalidateStore.revalidate) === 0);\n            let isImplicitBuildTimeCache = false;\n            if (!autoNoCache && hasNoExplicitCacheConfig) {\n                // We don't enable automatic no-cache behavior during build-time\n                // prerendering so that we can still leverage the fetch cache between\n                // export workers.\n                if (workStore.isBuildTimePrerendering) {\n                    isImplicitBuildTimeCache = true;\n                } else {\n                    autoNoCache = true;\n                }\n            }\n            // If we have no cache config, and we're in Dynamic I/O prerendering,\n            // it'll be a dynamic call. We don't have to issue that dynamic call.\n            if (hasNoExplicitCacheConfig && workUnitStore !== undefined) {\n                switch(workUnitStore.type){\n                    case 'prerender':\n                    case 'prerender-runtime':\n                    // While we don't want to do caching in the client scope we know the\n                    // fetch will be dynamic for cacheComponents so we may as well avoid the\n                    // call here. (fallthrough)\n                    case 'prerender-client':\n                        if (cacheSignal) {\n                            cacheSignal.endRead();\n                            cacheSignal = null;\n                        }\n                        return makeHangingPromise(workUnitStore.renderSignal, workStore.route, 'fetch()');\n                    case 'request':\n                        if (process.env.NODE_ENV === 'development' && workUnitStore.stagedRendering) {\n                            if (cacheSignal) {\n                                cacheSignal.endRead();\n                                cacheSignal = null;\n                            }\n                            await workUnitStore.stagedRendering.waitForStage(RenderStage.Dynamic);\n                        }\n                        break;\n                    case 'prerender-ppr':\n                    case 'prerender-legacy':\n                    case 'cache':\n                    case 'private-cache':\n                    case 'unstable-cache':\n                        break;\n                    default:\n                        workUnitStore;\n                }\n            }\n            switch(pageFetchCacheMode){\n                case 'force-no-store':\n                    {\n                        cacheReason = 'fetchCache = force-no-store';\n                        break;\n                    }\n                case 'only-no-store':\n                    {\n                        if (currentFetchCacheConfig === 'force-cache' || typeof finalRevalidate !== 'undefined' && finalRevalidate > 0) {\n                            throw Object.defineProperty(new Error(`cache: 'force-cache' used on fetch for ${fetchUrl} with 'export const fetchCache = 'only-no-store'`), \"__NEXT_ERROR_CODE\", {\n                                value: \"E448\",\n                                enumerable: false,\n                                configurable: true\n                            });\n                        }\n                        cacheReason = 'fetchCache = only-no-store';\n                        break;\n                    }\n                case 'only-cache':\n                    {\n                        if (currentFetchCacheConfig === 'no-store') {\n                            throw Object.defineProperty(new Error(`cache: 'no-store' used on fetch for ${fetchUrl} with 'export const fetchCache = 'only-cache'`), \"__NEXT_ERROR_CODE\", {\n                                value: \"E521\",\n                                enumerable: false,\n                                configurable: true\n                            });\n                        }\n                        break;\n                    }\n                case 'force-cache':\n                    {\n                        if (typeof currentFetchRevalidate === 'undefined' || currentFetchRevalidate === 0) {\n                            cacheReason = 'fetchCache = force-cache';\n                            finalRevalidate = INFINITE_CACHE;\n                        }\n                        break;\n                    }\n                case 'default-cache':\n                case 'default-no-store':\n                case 'auto':\n                case undefined:\n                    break;\n                default:\n                    pageFetchCacheMode;\n            }\n            if (typeof finalRevalidate === 'undefined') {\n                if (pageFetchCacheMode === 'default-cache' && !isUsingNoStore) {\n                    finalRevalidate = INFINITE_CACHE;\n                    cacheReason = 'fetchCache = default-cache';\n                } else if (pageFetchCacheMode === 'default-no-store') {\n                    finalRevalidate = 0;\n                    cacheReason = 'fetchCache = default-no-store';\n                } else if (isUsingNoStore) {\n                    finalRevalidate = 0;\n                    cacheReason = 'noStore call';\n                } else if (autoNoCache) {\n                    finalRevalidate = 0;\n                    cacheReason = 'auto no cache';\n                } else {\n                    // TODO: should we consider this case an invariant?\n                    cacheReason = 'auto cache';\n                    finalRevalidate = revalidateStore ? revalidateStore.revalidate : INFINITE_CACHE;\n                }\n            } else if (!cacheReason) {\n                cacheReason = `revalidate: ${finalRevalidate}`;\n            }\n            if (// when force static is configured we don't bail from\n            // `revalidate: 0` values\n            !(workStore.forceStatic && finalRevalidate === 0) && // we don't consider autoNoCache to switch to dynamic for ISR\n            !autoNoCache && // If the revalidate value isn't currently set or the value is less\n            // than the current revalidate value, we should update the revalidate\n            // value.\n            revalidateStore && finalRevalidate < revalidateStore.revalidate) {\n                // If we were setting the revalidate value to 0, we should try to\n                // postpone instead first.\n                if (finalRevalidate === 0) {\n                    if (workUnitStore) {\n                        switch(workUnitStore.type){\n                            case 'prerender':\n                            case 'prerender-client':\n                            case 'prerender-runtime':\n                                if (cacheSignal) {\n                                    cacheSignal.endRead();\n                                    cacheSignal = null;\n                                }\n                                return makeHangingPromise(workUnitStore.renderSignal, workStore.route, 'fetch()');\n                            case 'request':\n                                if (process.env.NODE_ENV === 'development' && workUnitStore.stagedRendering) {\n                                    if (cacheSignal) {\n                                        cacheSignal.endRead();\n                                        cacheSignal = null;\n                                    }\n                                    await workUnitStore.stagedRendering.waitForStage(RenderStage.Dynamic);\n                                }\n                                break;\n                            case 'prerender-ppr':\n                            case 'prerender-legacy':\n                            case 'cache':\n                            case 'private-cache':\n                            case 'unstable-cache':\n                                break;\n                            default:\n                                workUnitStore;\n                        }\n                    }\n                    markCurrentScopeAsDynamic(workStore, workUnitStore, `revalidate: 0 fetch ${input} ${workStore.route}`);\n                }\n                // We only want to set the revalidate store's revalidate time if it\n                // was explicitly set for the fetch call, i.e.\n                // originalFetchRevalidate.\n                if (revalidateStore && originalFetchRevalidate === finalRevalidate) {\n                    revalidateStore.revalidate = finalRevalidate;\n                }\n            }\n            const isCacheableRevalidate = typeof finalRevalidate === 'number' && finalRevalidate > 0;\n            let cacheKey;\n            const { incrementalCache } = workStore;\n            let isHmrRefresh = false;\n            let serverComponentsHmrCache;\n            if (workUnitStore) {\n                switch(workUnitStore.type){\n                    case 'request':\n                    case 'cache':\n                    case 'private-cache':\n                        isHmrRefresh = workUnitStore.isHmrRefresh ?? false;\n                        serverComponentsHmrCache = workUnitStore.serverComponentsHmrCache;\n                        break;\n                    case 'prerender':\n                    case 'prerender-client':\n                    case 'prerender-runtime':\n                    case 'prerender-ppr':\n                    case 'prerender-legacy':\n                    case 'unstable-cache':\n                        break;\n                    default:\n                        workUnitStore;\n                }\n            }\n            if (incrementalCache && (isCacheableRevalidate || serverComponentsHmrCache)) {\n                try {\n                    cacheKey = await incrementalCache.generateCacheKey(fetchUrl, isRequestInput ? input : init);\n                } catch (err) {\n                    console.error(`Failed to generate cache key for`, input);\n                }\n            }\n            const fetchIdx = workStore.nextFetchId ?? 1;\n            workStore.nextFetchId = fetchIdx + 1;\n            let handleUnlock = ()=>{};\n            const doOriginalFetch = async (isStale, cacheReasonOverride)=>{\n                const requestInputFields = [\n                    'cache',\n                    'credentials',\n                    'headers',\n                    'integrity',\n                    'keepalive',\n                    'method',\n                    'mode',\n                    'redirect',\n                    'referrer',\n                    'referrerPolicy',\n                    'window',\n                    'duplex',\n                    // don't pass through signal when revalidating\n                    ...isStale ? [] : [\n                        'signal'\n                    ]\n                ];\n                if (isRequestInput) {\n                    const reqInput = input;\n                    const reqOptions = {\n                        body: reqInput._ogBody || reqInput.body\n                    };\n                    for (const field of requestInputFields){\n                        // @ts-expect-error custom fields\n                        reqOptions[field] = reqInput[field];\n                    }\n                    input = new Request(reqInput.url, reqOptions);\n                } else if (init) {\n                    const { _ogBody, body, signal, ...otherInput } = init;\n                    init = {\n                        ...otherInput,\n                        body: _ogBody || body,\n                        signal: isStale ? undefined : signal\n                    };\n                }\n                // add metadata to init without editing the original\n                const clonedInit = {\n                    ...init,\n                    next: {\n                        ...init == null ? void 0 : init.next,\n                        fetchType: 'origin',\n                        fetchIdx\n                    }\n                };\n                return originFetch(input, clonedInit).then(async (res)=>{\n                    if (!isStale && fetchStart) {\n                        trackFetchMetric(workStore, {\n                            start: fetchStart,\n                            url: fetchUrl,\n                            cacheReason: cacheReasonOverride || cacheReason,\n                            cacheStatus: finalRevalidate === 0 || cacheReasonOverride ? 'skip' : 'miss',\n                            cacheWarning,\n                            status: res.status,\n                            method: clonedInit.method || 'GET'\n                        });\n                    }\n                    if (res.status === 200 && incrementalCache && cacheKey && (isCacheableRevalidate || serverComponentsHmrCache)) {\n                        const normalizedRevalidate = finalRevalidate >= INFINITE_CACHE ? CACHE_ONE_YEAR : finalRevalidate;\n                        const incrementalCacheConfig = isCacheableRevalidate ? {\n                            fetchCache: true,\n                            fetchUrl,\n                            fetchIdx,\n                            tags,\n                            isImplicitBuildTimeCache\n                        } : undefined;\n                        switch(workUnitStore == null ? void 0 : workUnitStore.type){\n                            case 'prerender':\n                            case 'prerender-client':\n                            case 'prerender-runtime':\n                                return createCachedPrerenderResponse(res, cacheKey, incrementalCacheConfig, incrementalCache, normalizedRevalidate, handleUnlock);\n                            case 'request':\n                                if (process.env.NODE_ENV === 'development' && workUnitStore.stagedRendering && workUnitStore.cacheSignal) {\n                                    // We're filling caches for a staged render,\n                                    // so we need to wait for the response to finish instead of streaming.\n                                    return createCachedPrerenderResponse(res, cacheKey, incrementalCacheConfig, incrementalCache, normalizedRevalidate, handleUnlock);\n                                }\n                            // fallthrough\n                            case 'prerender-ppr':\n                            case 'prerender-legacy':\n                            case 'cache':\n                            case 'private-cache':\n                            case 'unstable-cache':\n                            case undefined:\n                                return createCachedDynamicResponse(workStore, res, cacheKey, incrementalCacheConfig, incrementalCache, serverComponentsHmrCache, normalizedRevalidate, input, handleUnlock);\n                            default:\n                                workUnitStore;\n                        }\n                    }\n                    // we had response that we determined shouldn't be cached so we return it\n                    // and don't cache it. This also needs to unlock the cache lock we acquired.\n                    await handleUnlock();\n                    return res;\n                }).catch((error)=>{\n                    handleUnlock();\n                    throw error;\n                });\n            };\n            let cacheReasonOverride;\n            let isForegroundRevalidate = false;\n            let isHmrRefreshCache = false;\n            if (cacheKey && incrementalCache) {\n                let cachedFetchData;\n                if (isHmrRefresh && serverComponentsHmrCache) {\n                    cachedFetchData = serverComponentsHmrCache.get(cacheKey);\n                    isHmrRefreshCache = true;\n                }\n                if (isCacheableRevalidate && !cachedFetchData) {\n                    handleUnlock = await incrementalCache.lock(cacheKey);\n                    const entry = workStore.isOnDemandRevalidate ? null : await incrementalCache.get(cacheKey, {\n                        kind: IncrementalCacheKind.FETCH,\n                        revalidate: finalRevalidate,\n                        fetchUrl,\n                        fetchIdx,\n                        tags,\n                        softTags: implicitTags == null ? void 0 : implicitTags.tags\n                    });\n                    if (hasNoExplicitCacheConfig && workUnitStore) {\n                        switch(workUnitStore.type){\n                            case 'prerender':\n                            case 'prerender-client':\n                            case 'prerender-runtime':\n                                // We sometimes use the cache to dedupe fetches that do not\n                                // specify a cache configuration. In these cases we want to\n                                // make sure we still exclude them from prerenders if\n                                // cacheComponents is on so we introduce an artificial task boundary\n                                // here.\n                                await getTimeoutBoundary();\n                                break;\n                            case 'request':\n                                if (process.env.NODE_ENV === 'development' && workUnitStore.stagedRendering) {\n                                    await workUnitStore.stagedRendering.waitForStage(RenderStage.Dynamic);\n                                }\n                                break;\n                            case 'prerender-ppr':\n                            case 'prerender-legacy':\n                            case 'cache':\n                            case 'private-cache':\n                            case 'unstable-cache':\n                                break;\n                            default:\n                                workUnitStore;\n                        }\n                    }\n                    if (entry) {\n                        await handleUnlock();\n                    } else {\n                        // in dev, incremental cache response will be null in case the browser adds `cache-control: no-cache` in the request headers\n                        // TODO: it seems like we also hit this after revalidates in dev?\n                        cacheReasonOverride = 'cache-control: no-cache (hard refresh)';\n                    }\n                    if ((entry == null ? void 0 : entry.value) && entry.value.kind === CachedRouteKind.FETCH) {\n                        // when stale and is revalidating we wait for fresh data\n                        // so the revalidated entry has the updated data\n                        if (workStore.isStaticGeneration && entry.isStale) {\n                            isForegroundRevalidate = true;\n                        } else {\n                            if (entry.isStale) {\n                                workStore.pendingRevalidates ??= {};\n                                if (!workStore.pendingRevalidates[cacheKey]) {\n                                    const pendingRevalidate = doOriginalFetch(true).then(async (response)=>({\n                                            body: await response.arrayBuffer(),\n                                            headers: response.headers,\n                                            status: response.status,\n                                            statusText: response.statusText\n                                        })).finally(()=>{\n                                        workStore.pendingRevalidates ??= {};\n                                        delete workStore.pendingRevalidates[cacheKey || ''];\n                                    });\n                                    // Attach the empty catch here so we don't get a \"unhandled\n                                    // promise rejection\" warning.\n                                    pendingRevalidate.catch(console.error);\n                                    workStore.pendingRevalidates[cacheKey] = pendingRevalidate;\n                                }\n                            }\n                            cachedFetchData = entry.value.data;\n                        }\n                    }\n                }\n                if (cachedFetchData) {\n                    if (fetchStart) {\n                        trackFetchMetric(workStore, {\n                            start: fetchStart,\n                            url: fetchUrl,\n                            cacheReason,\n                            cacheStatus: isHmrRefreshCache ? 'hmr' : 'hit',\n                            cacheWarning,\n                            status: cachedFetchData.status || 200,\n                            method: (init == null ? void 0 : init.method) || 'GET'\n                        });\n                    }\n                    const response = new Response(Buffer.from(cachedFetchData.body, 'base64'), {\n                        headers: cachedFetchData.headers,\n                        status: cachedFetchData.status\n                    });\n                    Object.defineProperty(response, 'url', {\n                        value: cachedFetchData.url\n                    });\n                    return response;\n                }\n            }\n            if ((workStore.isStaticGeneration || process.env.NODE_ENV === 'development' && process.env.__NEXT_CACHE_COMPONENTS && workUnitStore && // eslint-disable-next-line no-restricted-syntax\n            workUnitStore.type === 'request' && workUnitStore.stagedRendering) && init && typeof init === 'object') {\n                const { cache } = init;\n                // Delete `cache` property as Cloudflare Workers will throw an error\n                if (isEdgeRuntime) delete init.cache;\n                if (cache === 'no-store') {\n                    // If enabled, we should bail out of static generation.\n                    if (workUnitStore) {\n                        switch(workUnitStore.type){\n                            case 'prerender':\n                            case 'prerender-client':\n                            case 'prerender-runtime':\n                                if (cacheSignal) {\n                                    cacheSignal.endRead();\n                                    cacheSignal = null;\n                                }\n                                return makeHangingPromise(workUnitStore.renderSignal, workStore.route, 'fetch()');\n                            case 'request':\n                                if (process.env.NODE_ENV === 'development' && workUnitStore.stagedRendering) {\n                                    if (cacheSignal) {\n                                        cacheSignal.endRead();\n                                        cacheSignal = null;\n                                    }\n                                    await workUnitStore.stagedRendering.waitForStage(RenderStage.Dynamic);\n                                }\n                                break;\n                            case 'prerender-ppr':\n                            case 'prerender-legacy':\n                            case 'cache':\n                            case 'private-cache':\n                            case 'unstable-cache':\n                                break;\n                            default:\n                                workUnitStore;\n                        }\n                    }\n                    markCurrentScopeAsDynamic(workStore, workUnitStore, `no-store fetch ${input} ${workStore.route}`);\n                }\n                const hasNextConfig = 'next' in init;\n                const { next = {} } = init;\n                if (typeof next.revalidate === 'number' && revalidateStore && next.revalidate < revalidateStore.revalidate) {\n                    if (next.revalidate === 0) {\n                        // If enabled, we should bail out of static generation.\n                        if (workUnitStore) {\n                            switch(workUnitStore.type){\n                                case 'prerender':\n                                case 'prerender-client':\n                                case 'prerender-runtime':\n                                    return makeHangingPromise(workUnitStore.renderSignal, workStore.route, 'fetch()');\n                                case 'request':\n                                    if (process.env.NODE_ENV === 'development' && workUnitStore.stagedRendering) {\n                                        await workUnitStore.stagedRendering.waitForStage(RenderStage.Dynamic);\n                                    }\n                                    break;\n                                case 'cache':\n                                case 'private-cache':\n                                case 'unstable-cache':\n                                case 'prerender-legacy':\n                                case 'prerender-ppr':\n                                    break;\n                                default:\n                                    workUnitStore;\n                            }\n                        }\n                        markCurrentScopeAsDynamic(workStore, workUnitStore, `revalidate: 0 fetch ${input} ${workStore.route}`);\n                    }\n                    if (!workStore.forceStatic || next.revalidate !== 0) {\n                        revalidateStore.revalidate = next.revalidate;\n                    }\n                }\n                if (hasNextConfig) delete init.next;\n            }\n            // if we are revalidating the whole page via time or on-demand and\n            // the fetch cache entry is stale we should still de-dupe the\n            // origin hit if it's a cache-able entry\n            if (cacheKey && isForegroundRevalidate) {\n                const pendingRevalidateKey = cacheKey;\n                workStore.pendingRevalidates ??= {};\n                let pendingRevalidate = workStore.pendingRevalidates[pendingRevalidateKey];\n                if (pendingRevalidate) {\n                    const revalidatedResult = await pendingRevalidate;\n                    return new Response(revalidatedResult.body, {\n                        headers: revalidatedResult.headers,\n                        status: revalidatedResult.status,\n                        statusText: revalidatedResult.statusText\n                    });\n                }\n                // We used to just resolve the Response and clone it however for\n                // static generation with cacheComponents we need the response to be able to\n                // be resolved in a microtask and cloning the response will never have\n                // a body that can resolve in a microtask in node (as observed through\n                // experimentation) So instead we await the body and then when it is\n                // available we construct manually cloned Response objects with the\n                // body as an ArrayBuffer. This will be resolvable in a microtask\n                // making it compatible with cacheComponents.\n                const pendingResponse = doOriginalFetch(true, cacheReasonOverride)// We're cloning the response using this utility because there\n                // exists a bug in the undici library around response cloning.\n                // See the following pull request for more details:\n                // https://github.com/vercel/next.js/pull/73274\n                .then(cloneResponse);\n                pendingRevalidate = pendingResponse.then(async (responses)=>{\n                    const response = responses[0];\n                    return {\n                        body: await response.arrayBuffer(),\n                        headers: response.headers,\n                        status: response.status,\n                        statusText: response.statusText\n                    };\n                }).finally(()=>{\n                    var _workStore_pendingRevalidates;\n                    // If the pending revalidate is not present in the store, then\n                    // we have nothing to delete.\n                    if (!((_workStore_pendingRevalidates = workStore.pendingRevalidates) == null ? void 0 : _workStore_pendingRevalidates[pendingRevalidateKey])) {\n                        return;\n                    }\n                    delete workStore.pendingRevalidates[pendingRevalidateKey];\n                });\n                // Attach the empty catch here so we don't get a \"unhandled promise\n                // rejection\" warning\n                pendingRevalidate.catch(()=>{});\n                workStore.pendingRevalidates[pendingRevalidateKey] = pendingRevalidate;\n                return pendingResponse.then((responses)=>responses[1]);\n            } else {\n                return doOriginalFetch(false, cacheReasonOverride);\n            }\n        });\n        if (cacheSignal) {\n            try {\n                return await result;\n            } finally{\n                if (cacheSignal) {\n                    cacheSignal.endRead();\n                }\n            }\n        }\n        return result;\n    };\n    // Attach the necessary properties to the patched fetch function.\n    // We don't use this to determine if the fetch function has been patched,\n    // but for external consumers to determine if the fetch function has been\n    // patched.\n    patched.__nextPatched = true;\n    patched.__nextGetStaticStore = ()=>workAsyncStorage;\n    patched._nextOriginalFetch = originFetch;\n    globalThis[NEXT_PATCH_SYMBOL] = true;\n    // Assign the function name also as a name property, so that it's preserved\n    // even when mangling is enabled.\n    Object.defineProperty(patched, 'name', {\n        value: 'fetch',\n        writable: false\n    });\n    return patched;\n}\n// we patch fetch to collect cache information used for\n// determining if a page is static or not\nexport function patchFetch(options) {\n    // If we've already patched fetch, we should not patch it again.\n    if (isFetchPatched()) return;\n    // Grab the original fetch function. We'll attach this so we can use it in\n    // the patched fetch function.\n    const original = createDedupeFetch(globalThis.fetch);\n    // Set the global fetch to the patched fetch.\n    globalThis.fetch = createPatchedFetcher(original, options);\n}\nlet currentTimeoutBoundary = null;\nfunction getTimeoutBoundary() {\n    if (!currentTimeoutBoundary) {\n        currentTimeoutBoundary = new Promise((r)=>{\n            setTimeout(()=>{\n                currentTimeoutBoundary = null;\n                r();\n            }, 0);\n        });\n    }\n    return currentTimeoutBoundary;\n}\n\n//# sourceMappingURL=patch-fetch.js.map","import { r as generateRandomString } from \"./crypto-CFUhAR9W.mjs\";\nimport { t as mergeSchema, u as getDate } from \"./schema-Bb7wzeK_.mjs\";\nimport { c as setSessionCookie } from \"./cookies-D72PbWdz.mjs\";\nimport { r as getSessionFromCtx } from \"./session-AaRl3_x-.mjs\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\n\n//#region src/plugins/phone-number/error-codes.ts\nconst PHONE_NUMBER_ERROR_CODES = defineErrorCodes({\n\tINVALID_PHONE_NUMBER: \"Invalid phone number\",\n\tPHONE_NUMBER_EXIST: \"Phone number already exists\",\n\tPHONE_NUMBER_NOT_EXIST: \"phone number isn't registered\",\n\tINVALID_PHONE_NUMBER_OR_PASSWORD: \"Invalid phone number or password\",\n\tUNEXPECTED_ERROR: \"Unexpected error\",\n\tOTP_NOT_FOUND: \"OTP not found\",\n\tOTP_EXPIRED: \"OTP expired\",\n\tINVALID_OTP: \"Invalid OTP\",\n\tPHONE_NUMBER_NOT_VERIFIED: \"Phone number not verified\",\n\tPHONE_NUMBER_CANNOT_BE_UPDATED: \"Phone number cannot be updated\",\n\tSEND_OTP_NOT_IMPLEMENTED: \"sendOTP not implemented\",\n\tTOO_MANY_ATTEMPTS: \"Too many attempts\"\n});\n\n//#endregion\n//#region src/plugins/phone-number/schema.ts\nconst schema = { user: { fields: {\n\tphoneNumber: {\n\t\ttype: \"string\",\n\t\trequired: false,\n\t\tunique: true,\n\t\tsortable: true,\n\t\treturned: true\n\t},\n\tphoneNumberVerified: {\n\t\ttype: \"boolean\",\n\t\trequired: false,\n\t\treturned: true,\n\t\tinput: false\n\t}\n} } };\n\n//#endregion\n//#region src/plugins/phone-number/index.ts\nfunction generateOTP(size) {\n\treturn generateRandomString(size, \"0-9\");\n}\nconst phoneNumber = (options) => {\n\tconst opts = {\n\t\texpiresIn: options?.expiresIn || 300,\n\t\totpLength: options?.otpLength || 6,\n\t\t...options,\n\t\tphoneNumber: \"phoneNumber\",\n\t\tphoneNumberVerified: \"phoneNumberVerified\",\n\t\tcode: \"code\",\n\t\tcreatedAt: \"createdAt\"\n\t};\n\treturn {\n\t\tid: \"phone-number\",\n\t\thooks: { before: [{\n\t\t\tmatcher: (ctx) => ctx.path === \"/update-user\" && \"phoneNumber\" in ctx.body,\n\t\t\thandler: createAuthMiddleware(async (_ctx) => {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.PHONE_NUMBER_CANNOT_BE_UPDATED });\n\t\t\t})\n\t\t}] },\n\t\tendpoints: {\n\t\t\tsignInPhoneNumber: createAuthEndpoint(\"/sign-in/phone-number\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tphoneNumber: z.string().meta({ description: \"Phone number to sign in. Eg: \\\"+1234567890\\\"\" }),\n\t\t\t\t\tpassword: z.string().meta({ description: \"Password to use for sign in.\" }),\n\t\t\t\t\trememberMe: z.boolean().meta({ description: \"Remember the session. Eg: true\" }).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Sign in with phone number\",\n\t\t\t\t\tdescription: \"Use this endpoint to sign in with phone number\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" },\n\t\t\t\t\t\t\t\t\tsession: { $ref: \"#/components/schemas/Session\" }\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t},\n\t\t\t\t\t\t400: { description: \"Invalid phone number or password\" }\n\t\t\t\t\t}\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { password, phoneNumber: phoneNumber$1 } = ctx.body;\n\t\t\t\tif (opts.phoneNumberValidator) {\n\t\t\t\t\tif (!await opts.phoneNumberValidator(ctx.body.phoneNumber)) throw new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER });\n\t\t\t\t}\n\t\t\t\tconst user = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"phoneNumber\",\n\t\t\t\t\t\tvalue: phoneNumber$1\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!user) throw new APIError(\"UNAUTHORIZED\", { message: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER_OR_PASSWORD });\n\t\t\t\tif (opts.requireVerification) {\n\t\t\t\t\tif (!user.phoneNumberVerified) {\n\t\t\t\t\t\tconst otp = generateOTP(opts.otpLength);\n\t\t\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\t\t\tvalue: otp,\n\t\t\t\t\t\t\tidentifier: phoneNumber$1,\n\t\t\t\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\")\n\t\t\t\t\t\t});\n\t\t\t\t\t\tawait opts.sendOTP?.({\n\t\t\t\t\t\t\tphoneNumber: phoneNumber$1,\n\t\t\t\t\t\t\tcode: otp\n\t\t\t\t\t\t}, ctx);\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: PHONE_NUMBER_ERROR_CODES.PHONE_NUMBER_NOT_VERIFIED });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst credentialAccount = (await ctx.context.internalAdapter.findAccountByUserId(user.id)).find((a) => a.providerId === \"credential\");\n\t\t\t\tif (!credentialAccount) {\n\t\t\t\t\tctx.context.logger.error(\"Credential account not found\", { phoneNumber: phoneNumber$1 });\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER_OR_PASSWORD });\n\t\t\t\t}\n\t\t\t\tconst currentPassword = credentialAccount?.password;\n\t\t\t\tif (!currentPassword) {\n\t\t\t\t\tctx.context.logger.error(\"Password not found\", { phoneNumber: phoneNumber$1 });\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: PHONE_NUMBER_ERROR_CODES.UNEXPECTED_ERROR });\n\t\t\t\t}\n\t\t\t\tif (!await ctx.context.password.verify({\n\t\t\t\t\thash: currentPassword,\n\t\t\t\t\tpassword\n\t\t\t\t})) {\n\t\t\t\t\tctx.context.logger.error(\"Invalid password\");\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER_OR_PASSWORD });\n\t\t\t\t}\n\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(user.id, ctx.body.rememberMe === false);\n\t\t\t\tif (!session) {\n\t\t\t\t\tctx.context.logger.error(\"Failed to create session\");\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION });\n\t\t\t\t}\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser\n\t\t\t\t}, ctx.body.rememberMe === false);\n\t\t\t\treturn ctx.json({\n\t\t\t\t\ttoken: session.token,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\temailVerified: user.emailVerified,\n\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\timage: user.image,\n\t\t\t\t\t\tphoneNumber: user.phoneNumber,\n\t\t\t\t\t\tphoneNumberVerified: user.phoneNumberVerified,\n\t\t\t\t\t\tcreatedAt: user.createdAt,\n\t\t\t\t\t\tupdatedAt: user.updatedAt\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}),\n\t\t\tsendPhoneNumberOTP: createAuthEndpoint(\"/phone-number/send-otp\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ phoneNumber: z.string().meta({ description: \"Phone number to send OTP. Eg: \\\"+1234567890\\\"\" }) }),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Send OTP to phone number\",\n\t\t\t\t\tdescription: \"Use this endpoint to send OTP to phone number\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { message: { type: \"string\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!options?.sendOTP) {\n\t\t\t\t\tctx.context.logger.warn(\"sendOTP not implemented\");\n\t\t\t\t\tthrow new APIError(\"NOT_IMPLEMENTED\", { message: PHONE_NUMBER_ERROR_CODES.SEND_OTP_NOT_IMPLEMENTED });\n\t\t\t\t}\n\t\t\t\tif (opts.phoneNumberValidator) {\n\t\t\t\t\tif (!await opts.phoneNumberValidator(ctx.body.phoneNumber)) throw new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER });\n\t\t\t\t}\n\t\t\t\tconst code = generateOTP(opts.otpLength);\n\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\tvalue: `${code}:0`,\n\t\t\t\t\tidentifier: ctx.body.phoneNumber,\n\t\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\")\n\t\t\t\t});\n\t\t\t\tawait options.sendOTP({\n\t\t\t\t\tphoneNumber: ctx.body.phoneNumber,\n\t\t\t\t\tcode\n\t\t\t\t}, ctx);\n\t\t\t\treturn ctx.json({ message: \"code sent\" });\n\t\t\t}),\n\t\t\tverifyPhoneNumber: createAuthEndpoint(\"/phone-number/verify\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tphoneNumber: z.string().meta({ description: \"Phone number to verify. Eg: \\\"+1234567890\\\"\" }),\n\t\t\t\t\tcode: z.string().meta({ description: \"OTP code. Eg: \\\"123456\\\"\" }),\n\t\t\t\t\tdisableSession: z.boolean().meta({ description: \"Disable session creation after verification. Eg: false\" }).optional(),\n\t\t\t\t\tupdatePhoneNumber: z.boolean().meta({ description: \"Check if there is a session and update the phone number. Eg: true\" }).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Verify phone number\",\n\t\t\t\t\tdescription: \"Use this endpoint to verify phone number\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Phone number verified successfully\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"Indicates if the verification was successful\",\n\t\t\t\t\t\t\t\t\t\tenum: [true]\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\tdescription: \"Session token if session is created, null if disableSession is true or no session is created\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier of the user\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tformat: \"email\",\n\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's email address\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\temailVerified: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the email is verified\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's name\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\timage: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's profile image URL\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tphoneNumber: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's phone number\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tphoneNumberVerified: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the phone number is verified\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the user was created\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the user was last updated\"\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\t\t\t\t\"phoneNumber\",\n\t\t\t\t\t\t\t\t\t\t\t\"phoneNumberVerified\",\n\t\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\tdescription: \"User object with phone number details, null if no user is created or found\"\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\trequired: [\"status\"]\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t},\n\t\t\t\t\t\t400: { description: \"Invalid OTP\" }\n\t\t\t\t\t}\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (options?.verifyOTP) {\n\t\t\t\t\tif (!await options.verifyOTP({\n\t\t\t\t\t\tphoneNumber: ctx.body.phoneNumber,\n\t\t\t\t\t\tcode: ctx.body.code\n\t\t\t\t\t}, ctx)) throw new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.INVALID_OTP });\n\t\t\t\t\tconst otp = await ctx.context.internalAdapter.findVerificationValue(ctx.body.phoneNumber);\n\t\t\t\t\tif (otp) await ctx.context.internalAdapter.deleteVerificationValue(otp.id);\n\t\t\t\t} else {\n\t\t\t\t\tconst otp = await ctx.context.internalAdapter.findVerificationValue(ctx.body.phoneNumber);\n\t\t\t\t\tif (!otp || otp.expiresAt < /* @__PURE__ */ new Date()) {\n\t\t\t\t\t\tif (otp && otp.expiresAt < /* @__PURE__ */ new Date()) throw new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.OTP_EXPIRED });\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.OTP_NOT_FOUND });\n\t\t\t\t\t}\n\t\t\t\t\tconst [otpValue, attempts] = otp.value.split(\":\");\n\t\t\t\t\tconst allowedAttempts = options?.allowedAttempts || 3;\n\t\t\t\t\tif (attempts && parseInt(attempts) >= allowedAttempts) {\n\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(otp.id);\n\t\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", { message: PHONE_NUMBER_ERROR_CODES.TOO_MANY_ATTEMPTS });\n\t\t\t\t\t}\n\t\t\t\t\tif (otpValue !== ctx.body.code) {\n\t\t\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(otp.id, { value: `${otpValue}:${parseInt(attempts || \"0\") + 1}` });\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.INVALID_OTP });\n\t\t\t\t\t}\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(otp.id);\n\t\t\t\t}\n\t\t\t\tif (ctx.body.updatePhoneNumber) {\n\t\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\t\t\tif (!session) throw new APIError(\"UNAUTHORIZED\", { message: BASE_ERROR_CODES.USER_NOT_FOUND });\n\t\t\t\t\tif ((await ctx.context.adapter.findMany({\n\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"phoneNumber\",\n\t\t\t\t\t\t\tvalue: ctx.body.phoneNumber\n\t\t\t\t\t\t}]\n\t\t\t\t\t})).length) throw ctx.error(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.PHONE_NUMBER_EXIST });\n\t\t\t\t\tlet user$1 = await ctx.context.internalAdapter.updateUser(session.user.id, {\n\t\t\t\t\t\t[opts.phoneNumber]: ctx.body.phoneNumber,\n\t\t\t\t\t\t[opts.phoneNumberVerified]: true\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\ttoken: session.session.token,\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tid: user$1.id,\n\t\t\t\t\t\t\temail: user$1.email,\n\t\t\t\t\t\t\temailVerified: user$1.emailVerified,\n\t\t\t\t\t\t\tname: user$1.name,\n\t\t\t\t\t\t\timage: user$1.image,\n\t\t\t\t\t\t\tphoneNumber: user$1.phoneNumber,\n\t\t\t\t\t\t\tphoneNumberVerified: user$1.phoneNumberVerified,\n\t\t\t\t\t\t\tcreatedAt: user$1.createdAt,\n\t\t\t\t\t\t\tupdatedAt: user$1.updatedAt\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tlet user = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tvalue: ctx.body.phoneNumber,\n\t\t\t\t\t\tfield: opts.phoneNumber\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!user) {\n\t\t\t\t\tif (options?.signUpOnVerification) {\n\t\t\t\t\t\tuser = await ctx.context.internalAdapter.createUser({\n\t\t\t\t\t\t\temail: options.signUpOnVerification.getTempEmail(ctx.body.phoneNumber),\n\t\t\t\t\t\t\tname: options.signUpOnVerification.getTempName ? options.signUpOnVerification.getTempName(ctx.body.phoneNumber) : ctx.body.phoneNumber,\n\t\t\t\t\t\t\t[opts.phoneNumber]: ctx.body.phoneNumber,\n\t\t\t\t\t\t\t[opts.phoneNumberVerified]: true\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (!user) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: BASE_ERROR_CODES.FAILED_TO_CREATE_USER });\n\t\t\t\t\t}\n\t\t\t\t} else user = await ctx.context.internalAdapter.updateUser(user.id, { [opts.phoneNumberVerified]: true });\n\t\t\t\tif (!user) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: BASE_ERROR_CODES.FAILED_TO_UPDATE_USER });\n\t\t\t\tawait options?.callbackOnVerification?.({\n\t\t\t\t\tphoneNumber: ctx.body.phoneNumber,\n\t\t\t\t\tuser\n\t\t\t\t}, ctx);\n\t\t\t\tif (!ctx.body.disableSession) {\n\t\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(user.id);\n\t\t\t\t\tif (!session) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION });\n\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\tsession,\n\t\t\t\t\t\tuser\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\ttoken: session.token,\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\t\temailVerified: user.emailVerified,\n\t\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\t\timage: user.image,\n\t\t\t\t\t\t\tphoneNumber: user.phoneNumber,\n\t\t\t\t\t\t\tphoneNumberVerified: user.phoneNumberVerified,\n\t\t\t\t\t\t\tcreatedAt: user.createdAt,\n\t\t\t\t\t\t\tupdatedAt: user.updatedAt\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tstatus: true,\n\t\t\t\t\ttoken: null,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\temailVerified: user.emailVerified,\n\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\timage: user.image,\n\t\t\t\t\t\tphoneNumber: user.phoneNumber,\n\t\t\t\t\t\tphoneNumberVerified: user.phoneNumberVerified,\n\t\t\t\t\t\tcreatedAt: user.createdAt,\n\t\t\t\t\t\tupdatedAt: user.updatedAt\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}),\n\t\t\trequestPasswordResetPhoneNumber: createAuthEndpoint(\"/phone-number/request-password-reset\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ phoneNumber: z.string() }),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Request OTP for password reset via phone number\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"OTP sent successfully for password reset\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { status: {\n\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\tdescription: \"Indicates if the OTP was sent successfully\",\n\t\t\t\t\t\t\t\tenum: [true]\n\t\t\t\t\t\t\t} },\n\t\t\t\t\t\t\trequired: [\"status\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tvalue: ctx.body.phoneNumber,\n\t\t\t\t\t\tfield: opts.phoneNumber\n\t\t\t\t\t}]\n\t\t\t\t})) throw new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.PHONE_NUMBER_NOT_EXIST });\n\t\t\t\tconst code = generateOTP(opts.otpLength);\n\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\tvalue: `${code}:0`,\n\t\t\t\t\tidentifier: `${ctx.body.phoneNumber}-request-password-reset`,\n\t\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\")\n\t\t\t\t});\n\t\t\t\tawait options?.sendPasswordResetOTP?.({\n\t\t\t\t\tphoneNumber: ctx.body.phoneNumber,\n\t\t\t\t\tcode\n\t\t\t\t}, ctx);\n\t\t\t\treturn ctx.json({ status: true });\n\t\t\t}),\n\t\t\tresetPasswordPhoneNumber: createAuthEndpoint(\"/phone-number/reset-password\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\totp: z.string().meta({ description: \"The one time password to reset the password. Eg: \\\"123456\\\"\" }),\n\t\t\t\t\tphoneNumber: z.string().meta({ description: \"The phone number to the account which intends to reset the password for. Eg: \\\"+1234567890\\\"\" }),\n\t\t\t\t\tnewPassword: z.string().meta({ description: `The new password. Eg: \"new-and-secure-password\"` })\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Reset password using phone number OTP\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"Password reset successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { status: {\n\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\tdescription: \"Indicates if the password was reset successfully\",\n\t\t\t\t\t\t\t\tenum: [true]\n\t\t\t\t\t\t\t} },\n\t\t\t\t\t\t\trequired: [\"status\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst verification = await ctx.context.internalAdapter.findVerificationValue(`${ctx.body.phoneNumber}-request-password-reset`);\n\t\t\t\tif (!verification) throw new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.OTP_NOT_FOUND });\n\t\t\t\tif (verification.expiresAt < /* @__PURE__ */ new Date()) throw new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.OTP_EXPIRED });\n\t\t\t\tconst [otpValue, attempts] = verification.value.split(\":\");\n\t\t\t\tconst allowedAttempts = options?.allowedAttempts || 3;\n\t\t\t\tif (attempts && parseInt(attempts) >= allowedAttempts) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verification.id);\n\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", { message: PHONE_NUMBER_ERROR_CODES.TOO_MANY_ATTEMPTS });\n\t\t\t\t}\n\t\t\t\tif (ctx.body.otp !== otpValue) {\n\t\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(verification.id, { value: `${otpValue}:${parseInt(attempts || \"0\") + 1}` });\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.INVALID_OTP });\n\t\t\t\t}\n\t\t\t\tconst user = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"phoneNumber\",\n\t\t\t\t\t\tvalue: ctx.body.phoneNumber\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!user) throw new APIError(\"BAD_REQUEST\", { message: PHONE_NUMBER_ERROR_CODES.UNEXPECTED_ERROR });\n\t\t\t\tconst hashedPassword = await ctx.context.password.hash(ctx.body.newPassword);\n\t\t\t\tawait ctx.context.internalAdapter.updatePassword(user.id, hashedPassword);\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verification.id);\n\t\t\t\treturn ctx.json({ status: true });\n\t\t\t})\n\t\t},\n\t\tschema: mergeSchema(schema, options?.schema),\n\t\trateLimit: [{\n\t\t\tpathMatcher(path) {\n\t\t\t\treturn path.startsWith(\"/phone-number\");\n\t\t\t},\n\t\t\twindow: 60 * 1e3,\n\t\t\tmax: 10\n\t\t}],\n\t\t$ERROR_CODES: PHONE_NUMBER_ERROR_CODES\n\t};\n};\n\n//#endregion\nexport { phoneNumber as t };","/**\n * This file provides some helpers that should be used in conjunction with\n * explicit environment checks. When combined with the environment checks, it\n * will ensure that the correct typings are used as well as enable code\n * elimination.\n */ /**\n * Type guard to determine if a request is a WebNextRequest. This does not\n * actually check the type of the request, but rather the runtime environment.\n * It's expected that when the runtime environment is the edge runtime, that any\n * base request is a WebNextRequest.\n */ export const isWebNextRequest = (req)=>process.env.NEXT_RUNTIME === 'edge';\n/**\n * Type guard to determine if a response is a WebNextResponse. This does not\n * actually check the type of the response, but rather the runtime environment.\n * It's expected that when the runtime environment is the edge runtime, that any\n * base response is a WebNextResponse.\n */ export const isWebNextResponse = (res)=>process.env.NEXT_RUNTIME === 'edge';\n/**\n * Type guard to determine if a request is a NodeNextRequest. This does not\n * actually check the type of the request, but rather the runtime environment.\n * It's expected that when the runtime environment is the node runtime, that any\n * base request is a NodeNextRequest.\n */ export const isNodeNextRequest = (req)=>process.env.NEXT_RUNTIME !== 'edge';\n/**\n * Type guard to determine if a response is a NodeNextResponse. This does not\n * actually check the type of the response, but rather the runtime environment.\n * It's expected that when the runtime environment is the node runtime, that any\n * base response is a NodeNextResponse.\n */ export const isNodeNextResponse = (res)=>process.env.NEXT_RUNTIME !== 'edge';\n\n//# sourceMappingURL=helpers.js.map","import { l as parseUserOutput, t as mergeSchema, u as getDate } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport { c as setSessionCookie, n as deleteSessionCookie } from \"./cookies-D72PbWdz.mjs\";\nimport { r as getSessionFromCtx } from \"./session-AaRl3_x-.mjs\";\nimport { t as hasPermission } from \"./has-permission-qCjQqGds.mjs\";\nimport { t as getEndpointResponse } from \"./plugin-helper-zFdFWLgL.mjs\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\n\n//#region src/plugins/admin/error-codes.ts\nconst ADMIN_ERROR_CODES = defineErrorCodes({\n\tFAILED_TO_CREATE_USER: \"Failed to create user\",\n\tUSER_ALREADY_EXISTS: \"User already exists.\",\n\tUSER_ALREADY_EXISTS_USE_ANOTHER_EMAIL: \"User already exists. Use another email.\",\n\tYOU_CANNOT_BAN_YOURSELF: \"You cannot ban yourself\",\n\tYOU_ARE_NOT_ALLOWED_TO_CHANGE_USERS_ROLE: \"You are not allowed to change users role\",\n\tYOU_ARE_NOT_ALLOWED_TO_CREATE_USERS: \"You are not allowed to create users\",\n\tYOU_ARE_NOT_ALLOWED_TO_LIST_USERS: \"You are not allowed to list users\",\n\tYOU_ARE_NOT_ALLOWED_TO_LIST_USERS_SESSIONS: \"You are not allowed to list users sessions\",\n\tYOU_ARE_NOT_ALLOWED_TO_BAN_USERS: \"You are not allowed to ban users\",\n\tYOU_ARE_NOT_ALLOWED_TO_IMPERSONATE_USERS: \"You are not allowed to impersonate users\",\n\tYOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS: \"You are not allowed to revoke users sessions\",\n\tYOU_ARE_NOT_ALLOWED_TO_DELETE_USERS: \"You are not allowed to delete users\",\n\tYOU_ARE_NOT_ALLOWED_TO_SET_USERS_PASSWORD: \"You are not allowed to set users password\",\n\tBANNED_USER: \"You have been banned from this application\",\n\tYOU_ARE_NOT_ALLOWED_TO_GET_USER: \"You are not allowed to get user\",\n\tNO_DATA_TO_UPDATE: \"No data to update\",\n\tYOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS: \"You are not allowed to update users\",\n\tYOU_CANNOT_REMOVE_YOURSELF: \"You cannot remove yourself\",\n\tYOU_ARE_NOT_ALLOWED_TO_SET_NON_EXISTENT_VALUE: \"You are not allowed to set a non-existent role value\"\n});\n\n//#endregion\n//#region src/plugins/admin/schema.ts\nconst schema = {\n\tuser: { fields: {\n\t\trole: {\n\t\t\ttype: \"string\",\n\t\t\trequired: false,\n\t\t\tinput: false\n\t\t},\n\t\tbanned: {\n\t\t\ttype: \"boolean\",\n\t\t\tdefaultValue: false,\n\t\t\trequired: false,\n\t\t\tinput: false\n\t\t},\n\t\tbanReason: {\n\t\t\ttype: \"string\",\n\t\t\trequired: false,\n\t\t\tinput: false\n\t\t},\n\t\tbanExpires: {\n\t\t\ttype: \"date\",\n\t\t\trequired: false,\n\t\t\tinput: false\n\t\t}\n\t} },\n\tsession: { fields: { impersonatedBy: {\n\t\ttype: \"string\",\n\t\trequired: false\n\t} } }\n};\n\n//#endregion\n//#region src/plugins/admin/admin.ts\nfunction parseRoles(roles) {\n\treturn Array.isArray(roles) ? roles.join(\",\") : roles;\n}\nconst admin = (options) => {\n\tconst opts = {\n\t\tdefaultRole: options?.defaultRole ?? \"user\",\n\t\tadminRoles: options?.adminRoles ?? [\"admin\"],\n\t\tbannedUserMessage: options?.bannedUserMessage ?? \"You have been banned from this application. Please contact support if you believe this is an error.\",\n\t\t...options\n\t};\n\t/**\n\t* Ensures a valid session, if not will throw.\n\t* Will also provide additional types on the user to include role types.\n\t*/\n\tconst adminMiddleware = createAuthMiddleware(async (ctx) => {\n\t\tconst session = await getSessionFromCtx(ctx);\n\t\tif (!session) throw new APIError(\"UNAUTHORIZED\");\n\t\treturn { session };\n\t});\n\treturn {\n\t\tid: \"admin\",\n\t\tinit() {\n\t\t\treturn { options: { databaseHooks: {\n\t\t\t\tuser: { create: { async before(user) {\n\t\t\t\t\treturn { data: {\n\t\t\t\t\t\trole: options?.defaultRole ?? \"user\",\n\t\t\t\t\t\t...user\n\t\t\t\t\t} };\n\t\t\t\t} } },\n\t\t\t\tsession: { create: { async before(session, ctx) {\n\t\t\t\t\tif (!ctx) return;\n\t\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(session.userId);\n\t\t\t\t\tif (user.banned) {\n\t\t\t\t\t\tif (user.banExpires && new Date(user.banExpires).getTime() < Date.now()) {\n\t\t\t\t\t\t\tawait ctx.context.internalAdapter.updateUser(session.userId, {\n\t\t\t\t\t\t\t\tbanned: false,\n\t\t\t\t\t\t\t\tbanReason: null,\n\t\t\t\t\t\t\t\tbanExpires: null\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (ctx && (ctx.path.startsWith(\"/callback\") || ctx.path.startsWith(\"/oauth2/callback\"))) {\n\t\t\t\t\t\t\tconst redirectURI = ctx.context.options.onAPIError?.errorURL || `${ctx.context.baseURL}/error`;\n\t\t\t\t\t\t\tthrow ctx.redirect(`${redirectURI}?error=banned&error_description=${opts.bannedUserMessage}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\t\t\tmessage: opts.bannedUserMessage,\n\t\t\t\t\t\t\tcode: \"BANNED_USER\"\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} } }\n\t\t\t} } };\n\t\t},\n\t\thooks: { after: [{\n\t\t\tmatcher(context) {\n\t\t\t\treturn context.path === \"/list-sessions\";\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst response = await getEndpointResponse(ctx);\n\t\t\t\tif (!response) return;\n\t\t\t\tconst newJson = response.filter((session) => {\n\t\t\t\t\treturn !session.impersonatedBy;\n\t\t\t\t});\n\t\t\t\treturn ctx.json(newJson);\n\t\t\t})\n\t\t}] },\n\t\tendpoints: {\n\t\t\tsetRole: createAuthEndpoint(\"/admin/set-role\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tuserId: z.coerce.string().meta({ description: \"The user id\" }),\n\t\t\t\t\trole: z.union([z.string().meta({ description: \"The role to set. `admin` or `user` by default\" }), z.array(z.string().meta({ description: \"The roles to set. `admin` or `user` by default\" }))]).meta({ description: \"The role to set, this can be a string or an array of strings. Eg: `admin` or `[admin, user]`\" })\n\t\t\t\t}),\n\t\t\t\trequireHeaders: true,\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: {\n\t\t\t\t\topenapi: {\n\t\t\t\t\t\toperationId: \"setUserRole\",\n\t\t\t\t\t\tsummary: \"Set the role of a user\",\n\t\t\t\t\t\tdescription: \"Set the role of a user\",\n\t\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\t\tdescription: \"User role updated\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: { user: { $ref: \"#/components/schemas/User\" } }\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t} }\n\t\t\t\t\t},\n\t\t\t\t\t$Infer: { body: {} }\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: ctx.context.session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { user: [\"set-role\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CHANGE_USERS_ROLE });\n\t\t\t\tconst roles = opts.roles;\n\t\t\t\tif (roles) {\n\t\t\t\t\tconst inputRoles = Array.isArray(ctx.body.role) ? ctx.body.role : [ctx.body.role];\n\t\t\t\t\tfor (const role of inputRoles) if (!roles[role]) throw new APIError(\"BAD_REQUEST\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_SET_NON_EXISTENT_VALUE });\n\t\t\t\t}\n\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(ctx.body.userId, { role: parseRoles(ctx.body.role) });\n\t\t\t\treturn ctx.json({ user: updatedUser });\n\t\t\t}),\n\t\t\tgetUser: createAuthEndpoint(\"/admin/get-user\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tquery: z.object({ id: z.string().meta({ description: \"The id of the User\" }) }),\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"getUser\",\n\t\t\t\t\tsummary: \"Get an existing user\",\n\t\t\t\t\tdescription: \"Get an existing user\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"User\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { user: { $ref: \"#/components/schemas/User\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { id } = ctx.query;\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: ctx.context.session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { user: [\"get\"] }\n\t\t\t\t})) throw ctx.error(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_GET_USER,\n\t\t\t\t\tcode: \"YOU_ARE_NOT_ALLOWED_TO_GET_USER\"\n\t\t\t\t});\n\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(id);\n\t\t\t\tif (!user) throw new APIError(\"NOT_FOUND\", { message: BASE_ERROR_CODES.USER_NOT_FOUND });\n\t\t\t\treturn parseUserOutput(ctx.context.options, user);\n\t\t\t}),\n\t\t\tcreateUser: createAuthEndpoint(\"/admin/create-user\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\temail: z.string().meta({ description: \"The email of the user\" }),\n\t\t\t\t\tpassword: z.string().meta({ description: \"The password of the user\" }),\n\t\t\t\t\tname: z.string().meta({ description: \"The name of the user\" }),\n\t\t\t\t\trole: z.union([z.string().meta({ description: \"The role of the user\" }), z.array(z.string().meta({ description: \"The roles of user\" }))]).optional().meta({ description: `A string or array of strings representing the roles to apply to the new user. Eg: \\\"user\\\"` }),\n\t\t\t\t\tdata: z.record(z.string(), z.any()).optional().meta({ description: \"Extra fields for the user. Including custom additional fields.\" })\n\t\t\t\t}),\n\t\t\t\tmetadata: {\n\t\t\t\t\topenapi: {\n\t\t\t\t\t\toperationId: \"createUser\",\n\t\t\t\t\t\tsummary: \"Create a new user\",\n\t\t\t\t\t\tdescription: \"Create a new user\",\n\t\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\t\tdescription: \"User created\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: { user: { $ref: \"#/components/schemas/User\" } }\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t} }\n\t\t\t\t\t},\n\t\t\t\t\t$Infer: { body: {} }\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\t\tif (!session && (ctx.request || ctx.headers)) throw ctx.error(\"UNAUTHORIZED\");\n\t\t\t\tif (session) {\n\t\t\t\t\tif (!hasPermission({\n\t\t\t\t\t\tuserId: session.user.id,\n\t\t\t\t\t\trole: session.user.role,\n\t\t\t\t\t\toptions: opts,\n\t\t\t\t\t\tpermissions: { user: [\"create\"] }\n\t\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CREATE_USERS });\n\t\t\t\t}\n\t\t\t\tconst email = ctx.body.email.toLowerCase();\n\t\t\t\tif (!z.email().safeParse(email).success) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.INVALID_EMAIL });\n\t\t\t\tif (await ctx.context.internalAdapter.findUserByEmail(email)) throw new APIError(\"BAD_REQUEST\", { message: ADMIN_ERROR_CODES.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL });\n\t\t\t\tconst user = await ctx.context.internalAdapter.createUser({\n\t\t\t\t\temail,\n\t\t\t\t\tname: ctx.body.name,\n\t\t\t\t\trole: (ctx.body.role && parseRoles(ctx.body.role)) ?? options?.defaultRole ?? \"user\",\n\t\t\t\t\t...ctx.body.data\n\t\t\t\t});\n\t\t\t\tif (!user) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: ADMIN_ERROR_CODES.FAILED_TO_CREATE_USER });\n\t\t\t\tconst hashedPassword = await ctx.context.password.hash(ctx.body.password);\n\t\t\t\tawait ctx.context.internalAdapter.linkAccount({\n\t\t\t\t\taccountId: user.id,\n\t\t\t\t\tproviderId: \"credential\",\n\t\t\t\t\tpassword: hashedPassword,\n\t\t\t\t\tuserId: user.id\n\t\t\t\t});\n\t\t\t\treturn ctx.json({ user });\n\t\t\t}),\n\t\t\tadminUpdateUser: createAuthEndpoint(\"/admin/update-user\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tuserId: z.coerce.string().meta({ description: \"The user id\" }),\n\t\t\t\t\tdata: z.record(z.any(), z.any()).meta({ description: \"The user data to update\" })\n\t\t\t\t}),\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"updateUser\",\n\t\t\t\t\tsummary: \"Update a user\",\n\t\t\t\t\tdescription: \"Update a user's details\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"User updated\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { user: { $ref: \"#/components/schemas/User\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: ctx.context.session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { user: [\"update\"] }\n\t\t\t\t})) throw ctx.error(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS,\n\t\t\t\t\tcode: \"YOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS\"\n\t\t\t\t});\n\t\t\t\tif (Object.keys(ctx.body.data).length === 0) throw new APIError(\"BAD_REQUEST\", { message: ADMIN_ERROR_CODES.NO_DATA_TO_UPDATE });\n\t\t\t\tif (ctx.body.data?.role) ctx.body.data.role = parseRoles(ctx.body.data.role);\n\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(ctx.body.userId, ctx.body.data);\n\t\t\t\treturn ctx.json(updatedUser);\n\t\t\t}),\n\t\t\tlistUsers: createAuthEndpoint(\"/admin/list-users\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tquery: z.object({\n\t\t\t\t\tsearchValue: z.string().optional().meta({ description: \"The value to search for. Eg: \\\"some name\\\"\" }),\n\t\t\t\t\tsearchField: z.enum([\"email\", \"name\"]).meta({ description: \"The field to search in, defaults to email. Can be `email` or `name`. Eg: \\\"name\\\"\" }).optional(),\n\t\t\t\t\tsearchOperator: z.enum([\n\t\t\t\t\t\t\"contains\",\n\t\t\t\t\t\t\"starts_with\",\n\t\t\t\t\t\t\"ends_with\"\n\t\t\t\t\t]).meta({ description: \"The operator to use for the search. Can be `contains`, `starts_with` or `ends_with`. Eg: \\\"contains\\\"\" }).optional(),\n\t\t\t\t\tlimit: z.string().meta({ description: \"The number of users to return\" }).or(z.number()).optional(),\n\t\t\t\t\toffset: z.string().meta({ description: \"The offset to start from\" }).or(z.number()).optional(),\n\t\t\t\t\tsortBy: z.string().meta({ description: \"The field to sort by\" }).optional(),\n\t\t\t\t\tsortDirection: z.enum([\"asc\", \"desc\"]).meta({ description: \"The direction to sort by\" }).optional(),\n\t\t\t\t\tfilterField: z.string().meta({ description: \"The field to filter by\" }).optional(),\n\t\t\t\t\tfilterValue: z.string().meta({ description: \"The value to filter by\" }).or(z.number()).or(z.boolean()).optional(),\n\t\t\t\t\tfilterOperator: z.enum([\n\t\t\t\t\t\t\"eq\",\n\t\t\t\t\t\t\"ne\",\n\t\t\t\t\t\t\"lt\",\n\t\t\t\t\t\t\"lte\",\n\t\t\t\t\t\t\"gt\",\n\t\t\t\t\t\t\"gte\",\n\t\t\t\t\t\t\"contains\"\n\t\t\t\t\t]).meta({ description: \"The operator to use for the filter\" }).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"listUsers\",\n\t\t\t\t\tsummary: \"List users\",\n\t\t\t\t\tdescription: \"List users\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"List of users\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tusers: {\n\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\titems: { $ref: \"#/components/schemas/User\" }\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttotal: { type: \"number\" },\n\t\t\t\t\t\t\t\tlimit: { type: \"number\" },\n\t\t\t\t\t\t\t\toffset: { type: \"number\" }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\"users\", \"total\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = ctx.context.session;\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { user: [\"list\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_LIST_USERS });\n\t\t\t\tconst where = [];\n\t\t\t\tif (ctx.query?.searchValue) where.push({\n\t\t\t\t\tfield: ctx.query.searchField || \"email\",\n\t\t\t\t\toperator: ctx.query.searchOperator || \"contains\",\n\t\t\t\t\tvalue: ctx.query.searchValue\n\t\t\t\t});\n\t\t\t\tif (ctx.query?.filterValue) where.push({\n\t\t\t\t\tfield: ctx.query.filterField || \"email\",\n\t\t\t\t\toperator: ctx.query.filterOperator || \"eq\",\n\t\t\t\t\tvalue: ctx.query.filterValue\n\t\t\t\t});\n\t\t\t\ttry {\n\t\t\t\t\tconst users = await ctx.context.internalAdapter.listUsers(Number(ctx.query?.limit) || void 0, Number(ctx.query?.offset) || void 0, ctx.query?.sortBy ? {\n\t\t\t\t\t\tfield: ctx.query.sortBy,\n\t\t\t\t\t\tdirection: ctx.query.sortDirection || \"asc\"\n\t\t\t\t\t} : void 0, where.length ? where : void 0);\n\t\t\t\t\tconst total = await ctx.context.internalAdapter.countTotalUsers(where.length ? where : void 0);\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tusers,\n\t\t\t\t\t\ttotal,\n\t\t\t\t\t\tlimit: Number(ctx.query?.limit) || void 0,\n\t\t\t\t\t\toffset: Number(ctx.query?.offset) || void 0\n\t\t\t\t\t});\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tusers: [],\n\t\t\t\t\t\ttotal: 0\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}),\n\t\t\tlistUserSessions: createAuthEndpoint(\"/admin/list-user-sessions\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tbody: z.object({ userId: z.coerce.string().meta({ description: \"The user id\" }) }),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"listUserSessions\",\n\t\t\t\t\tsummary: \"List user sessions\",\n\t\t\t\t\tdescription: \"List user sessions\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"List of user sessions\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { sessions: {\n\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\titems: { $ref: \"#/components/schemas/Session\" }\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = ctx.context.session;\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { session: [\"list\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_LIST_USERS_SESSIONS });\n\t\t\t\treturn { sessions: await ctx.context.internalAdapter.listSessions(ctx.body.userId) };\n\t\t\t}),\n\t\t\tunbanUser: createAuthEndpoint(\"/admin/unban-user\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ userId: z.coerce.string().meta({ description: \"The user id\" }) }),\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"unbanUser\",\n\t\t\t\t\tsummary: \"Unban a user\",\n\t\t\t\t\tdescription: \"Unban a user\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"User unbanned\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { user: { $ref: \"#/components/schemas/User\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = ctx.context.session;\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { user: [\"ban\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_BAN_USERS });\n\t\t\t\tconst user = await ctx.context.internalAdapter.updateUser(ctx.body.userId, {\n\t\t\t\t\tbanned: false,\n\t\t\t\t\tbanExpires: null,\n\t\t\t\t\tbanReason: null,\n\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t});\n\t\t\t\treturn ctx.json({ user });\n\t\t\t}),\n\t\t\tbanUser: createAuthEndpoint(\"/admin/ban-user\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tuserId: z.coerce.string().meta({ description: \"The user id\" }),\n\t\t\t\t\tbanReason: z.string().meta({ description: \"The reason for the ban\" }).optional(),\n\t\t\t\t\tbanExpiresIn: z.number().meta({ description: \"The number of seconds until the ban expires\" }).optional()\n\t\t\t\t}),\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"banUser\",\n\t\t\t\t\tsummary: \"Ban a user\",\n\t\t\t\t\tdescription: \"Ban a user\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"User banned\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { user: { $ref: \"#/components/schemas/User\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = ctx.context.session;\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { user: [\"ban\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_BAN_USERS });\n\t\t\t\tif (!await ctx.context.internalAdapter.findUserById(ctx.body.userId)) throw new APIError(\"NOT_FOUND\", { message: BASE_ERROR_CODES.USER_NOT_FOUND });\n\t\t\t\tif (ctx.body.userId === ctx.context.session.user.id) throw new APIError(\"BAD_REQUEST\", { message: ADMIN_ERROR_CODES.YOU_CANNOT_BAN_YOURSELF });\n\t\t\t\tconst user = await ctx.context.internalAdapter.updateUser(ctx.body.userId, {\n\t\t\t\t\tbanned: true,\n\t\t\t\t\tbanReason: ctx.body.banReason || options?.defaultBanReason || \"No reason\",\n\t\t\t\t\tbanExpires: ctx.body.banExpiresIn ? getDate(ctx.body.banExpiresIn, \"sec\") : options?.defaultBanExpiresIn ? getDate(options.defaultBanExpiresIn, \"sec\") : void 0,\n\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t});\n\t\t\t\tawait ctx.context.internalAdapter.deleteSessions(ctx.body.userId);\n\t\t\t\treturn ctx.json({ user });\n\t\t\t}),\n\t\t\timpersonateUser: createAuthEndpoint(\"/admin/impersonate-user\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ userId: z.coerce.string().meta({ description: \"The user id\" }) }),\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"impersonateUser\",\n\t\t\t\t\tsummary: \"Impersonate a user\",\n\t\t\t\t\tdescription: \"Impersonate a user\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Impersonation session created\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tsession: { $ref: \"#/components/schemas/Session\" },\n\t\t\t\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: ctx.context.session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { user: [\"impersonate\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_IMPERSONATE_USERS });\n\t\t\t\tconst targetUser = await ctx.context.internalAdapter.findUserById(ctx.body.userId);\n\t\t\t\tif (!targetUser) throw new APIError(\"NOT_FOUND\", { message: \"User not found\" });\n\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(targetUser.id, true, {\n\t\t\t\t\timpersonatedBy: ctx.context.session.user.id,\n\t\t\t\t\texpiresAt: options?.impersonationSessionDuration ? getDate(options.impersonationSessionDuration, \"sec\") : getDate(3600, \"sec\")\n\t\t\t\t}, true);\n\t\t\t\tif (!session) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: ADMIN_ERROR_CODES.FAILED_TO_CREATE_USER });\n\t\t\t\tconst authCookies = ctx.context.authCookies;\n\t\t\t\tdeleteSessionCookie(ctx);\n\t\t\t\tconst dontRememberMeCookie = await ctx.getSignedCookie(ctx.context.authCookies.dontRememberToken.name, ctx.context.secret);\n\t\t\t\tconst adminCookieProp = ctx.context.createAuthCookie(\"admin_session\");\n\t\t\t\tawait ctx.setSignedCookie(adminCookieProp.name, `${ctx.context.session.session.token}:${dontRememberMeCookie || \"\"}`, ctx.context.secret, authCookies.sessionToken.options);\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser: targetUser\n\t\t\t\t}, true);\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tsession,\n\t\t\t\t\tuser: targetUser\n\t\t\t\t});\n\t\t\t}),\n\t\t\tstopImpersonating: createAuthEndpoint(\"/admin/stop-impersonating\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\trequireHeaders: true\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\t\tif (!session) throw new APIError(\"UNAUTHORIZED\");\n\t\t\t\tif (!session.session.impersonatedBy) throw new APIError(\"BAD_REQUEST\", { message: \"You are not impersonating anyone\" });\n\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(session.session.impersonatedBy);\n\t\t\t\tif (!user) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: \"Failed to find user\" });\n\t\t\t\tconst adminCookieName = ctx.context.createAuthCookie(\"admin_session\").name;\n\t\t\t\tconst adminCookie = await ctx.getSignedCookie(adminCookieName, ctx.context.secret);\n\t\t\t\tif (!adminCookie) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: \"Failed to find admin session\" });\n\t\t\t\tconst [adminSessionToken, dontRememberMeCookie] = adminCookie?.split(\":\");\n\t\t\t\tconst adminSession = await ctx.context.internalAdapter.findSession(adminSessionToken);\n\t\t\t\tif (!adminSession || adminSession.session.userId !== user.id) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: \"Failed to find admin session\" });\n\t\t\t\tawait ctx.context.internalAdapter.deleteSession(session.session.token);\n\t\t\t\tawait setSessionCookie(ctx, adminSession, !!dontRememberMeCookie);\n\t\t\t\treturn ctx.json(adminSession);\n\t\t\t}),\n\t\t\trevokeUserSession: createAuthEndpoint(\"/admin/revoke-user-session\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ sessionToken: z.string().meta({ description: \"The session token\" }) }),\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"revokeUserSession\",\n\t\t\t\t\tsummary: \"Revoke a user session\",\n\t\t\t\t\tdescription: \"Revoke a user session\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Session revoked\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { success: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = ctx.context.session;\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { session: [\"revoke\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS });\n\t\t\t\tawait ctx.context.internalAdapter.deleteSession(ctx.body.sessionToken);\n\t\t\t\treturn ctx.json({ success: true });\n\t\t\t}),\n\t\t\trevokeUserSessions: createAuthEndpoint(\"/admin/revoke-user-sessions\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ userId: z.coerce.string().meta({ description: \"The user id\" }) }),\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"revokeUserSessions\",\n\t\t\t\t\tsummary: \"Revoke all user sessions\",\n\t\t\t\t\tdescription: \"Revoke all user sessions\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Sessions revoked\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { success: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = ctx.context.session;\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { session: [\"revoke\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS });\n\t\t\t\tawait ctx.context.internalAdapter.deleteSessions(ctx.body.userId);\n\t\t\t\treturn ctx.json({ success: true });\n\t\t\t}),\n\t\t\tremoveUser: createAuthEndpoint(\"/admin/remove-user\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ userId: z.coerce.string().meta({ description: \"The user id\" }) }),\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"removeUser\",\n\t\t\t\t\tsummary: \"Remove a user\",\n\t\t\t\t\tdescription: \"Delete a user and all their sessions and accounts. Cannot be undone.\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"User removed\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { success: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst session = ctx.context.session;\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { user: [\"delete\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_DELETE_USERS });\n\t\t\t\tif (ctx.body.userId === ctx.context.session.user.id) throw new APIError(\"BAD_REQUEST\", { message: ADMIN_ERROR_CODES.YOU_CANNOT_REMOVE_YOURSELF });\n\t\t\t\tif (!await ctx.context.internalAdapter.findUserById(ctx.body.userId)) throw new APIError(\"NOT_FOUND\", { message: \"User not found\" });\n\t\t\t\tawait ctx.context.internalAdapter.deleteUser(ctx.body.userId);\n\t\t\t\treturn ctx.json({ success: true });\n\t\t\t}),\n\t\t\tsetUserPassword: createAuthEndpoint(\"/admin/set-user-password\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tnewPassword: z.string().nonempty(\"newPassword cannot be empty\").meta({ description: \"The new password\" }),\n\t\t\t\t\tuserId: z.coerce.string().nonempty(\"userId cannot be empty\").meta({ description: \"The user id\" })\n\t\t\t\t}),\n\t\t\t\tuse: [adminMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"setUserPassword\",\n\t\t\t\t\tsummary: \"Set a user's password\",\n\t\t\t\t\tdescription: \"Set a user's password\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Password set\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { status: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: ctx.context.session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: { user: [\"set-password\"] }\n\t\t\t\t})) throw new APIError(\"FORBIDDEN\", { message: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_SET_USERS_PASSWORD });\n\t\t\t\tconst { newPassword, userId } = ctx.body;\n\t\t\t\tconst minPasswordLength = ctx.context.password.config.minPasswordLength;\n\t\t\t\tif (newPassword.length < minPasswordLength) {\n\t\t\t\t\tctx.context.logger.error(\"Password is too short\");\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.PASSWORD_TOO_SHORT });\n\t\t\t\t}\n\t\t\t\tconst maxPasswordLength = ctx.context.password.config.maxPasswordLength;\n\t\t\t\tif (newPassword.length > maxPasswordLength) {\n\t\t\t\t\tctx.context.logger.error(\"Password is too long\");\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.PASSWORD_TOO_LONG });\n\t\t\t\t}\n\t\t\t\tconst hashedPassword = await ctx.context.password.hash(newPassword);\n\t\t\t\tawait ctx.context.internalAdapter.updatePassword(userId, hashedPassword);\n\t\t\t\treturn ctx.json({ status: true });\n\t\t\t}),\n\t\t\tuserHasPermission: createAuthEndpoint(\"/admin/has-permission\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tuserId: z.coerce.string().optional().meta({ description: `The user id. Eg: \"user-id\"` }),\n\t\t\t\t\trole: z.string().optional().meta({ description: `The role to check permission for. Eg: \"admin\"` })\n\t\t\t\t}).and(z.union([z.object({\n\t\t\t\t\tpermission: z.record(z.string(), z.array(z.string())),\n\t\t\t\t\tpermissions: z.undefined()\n\t\t\t\t}), z.object({\n\t\t\t\t\tpermission: z.undefined(),\n\t\t\t\t\tpermissions: z.record(z.string(), z.array(z.string()))\n\t\t\t\t})])),\n\t\t\t\tmetadata: {\n\t\t\t\t\topenapi: {\n\t\t\t\t\t\tdescription: \"Check if the user has permission\",\n\t\t\t\t\t\trequestBody: { content: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tpermission: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tdescription: \"The permission to check\",\n\t\t\t\t\t\t\t\t\tdeprecated: true\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tdescription: \"The permission to check\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\"permissions\"]\n\t\t\t\t\t\t} } } },\n\t\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\terror: { type: \"string\" },\n\t\t\t\t\t\t\t\t\tsuccess: { type: \"boolean\" }\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\trequired: [\"success\"]\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t} }\n\t\t\t\t\t},\n\t\t\t\t\t$Infer: { body: {} }\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!ctx.body?.permission && !ctx.body?.permissions) throw new APIError(\"BAD_REQUEST\", { message: \"invalid permission check. no permission(s) were passed.\" });\n\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\t\tif (!session && (ctx.request || ctx.headers)) throw new APIError(\"UNAUTHORIZED\");\n\t\t\t\tif (!session && !ctx.body.userId && !ctx.body.role) throw new APIError(\"BAD_REQUEST\", { message: \"user id or role is required\" });\n\t\t\t\tconst user = session?.user || (ctx.body.role ? {\n\t\t\t\t\tid: ctx.body.userId || \"\",\n\t\t\t\t\trole: ctx.body.role\n\t\t\t\t} : null) || await ctx.context.internalAdapter.findUserById(ctx.body.userId);\n\t\t\t\tif (!user) throw new APIError(\"BAD_REQUEST\", { message: \"user not found\" });\n\t\t\t\tconst result = hasPermission({\n\t\t\t\t\tuserId: user.id,\n\t\t\t\t\trole: user.role,\n\t\t\t\t\toptions,\n\t\t\t\t\tpermissions: ctx.body.permissions ?? ctx.body.permission\n\t\t\t\t});\n\t\t\t\treturn ctx.json({\n\t\t\t\t\terror: null,\n\t\t\t\t\tsuccess: result\n\t\t\t\t});\n\t\t\t})\n\t\t},\n\t\t$ERROR_CODES: ADMIN_ERROR_CODES,\n\t\tschema: mergeSchema(schema, opts.schema),\n\t\toptions\n\t};\n};\n\n//#endregion\nexport { admin as t };","import pgClient from \"postgres\";\nimport { entityKind } from \"../entity.js\";\nimport { DefaultLogger } from \"../logger.js\";\nimport { PgDatabase } from \"../pg-core/db.js\";\nimport { PgDialect } from \"../pg-core/dialect.js\";\nimport {\n  createTableRelationsHelpers,\n  extractTablesRelationalConfig\n} from \"../relations.js\";\nimport { isConfig } from \"../utils.js\";\nimport { PostgresJsSession } from \"./session.js\";\nclass PostgresJsDatabase extends PgDatabase {\n  static [entityKind] = \"PostgresJsDatabase\";\n}\nfunction construct(client, config = {}) {\n  const transparentParser = (val) => val;\n  for (const type of [\"1184\", \"1082\", \"1083\", \"1114\", \"1182\", \"1185\", \"1115\", \"1231\"]) {\n    client.options.parsers[type] = transparentParser;\n    client.options.serializers[type] = transparentParser;\n  }\n  client.options.serializers[\"114\"] = transparentParser;\n  client.options.serializers[\"3802\"] = transparentParser;\n  const dialect = new PgDialect({ casing: config.casing });\n  let logger;\n  if (config.logger === true) {\n    logger = new DefaultLogger();\n  } else if (config.logger !== false) {\n    logger = config.logger;\n  }\n  let schema;\n  if (config.schema) {\n    const tablesConfig = extractTablesRelationalConfig(\n      config.schema,\n      createTableRelationsHelpers\n    );\n    schema = {\n      fullSchema: config.schema,\n      schema: tablesConfig.tables,\n      tableNamesMap: tablesConfig.tableNamesMap\n    };\n  }\n  const session = new PostgresJsSession(client, dialect, schema, { logger, cache: config.cache });\n  const db = new PostgresJsDatabase(dialect, session, schema);\n  db.$client = client;\n  db.$cache = config.cache;\n  if (db.$cache) {\n    db.$cache[\"invalidate\"] = config.cache?.onMutate;\n  }\n  return db;\n}\nfunction drizzle(...params) {\n  if (typeof params[0] === \"string\") {\n    const instance = pgClient(params[0]);\n    return construct(instance, params[1]);\n  }\n  if (isConfig(params[0])) {\n    const { connection, client, ...drizzleConfig } = params[0];\n    if (client) return construct(client, drizzleConfig);\n    if (typeof connection === \"object\" && connection.url !== void 0) {\n      const { url, ...config } = connection;\n      const instance2 = pgClient(url, config);\n      return construct(instance2, drizzleConfig);\n    }\n    const instance = pgClient(connection);\n    return construct(instance, drizzleConfig);\n  }\n  return construct(params[0], params[1]);\n}\n((drizzle2) => {\n  function mock(config) {\n    return construct({\n      options: {\n        parsers: {},\n        serializers: {}\n      }\n    }, config);\n  }\n  drizzle2.mock = mock;\n})(drizzle || (drizzle = {}));\nexport {\n  PostgresJsDatabase,\n  drizzle\n};\n//# sourceMappingURL=driver.js.map","import { l as verifyJWT, s as symmetricDecodeJWT } from \"./crypto-CFUhAR9W.mjs\";\nimport { l as parseUserOutput, s as parseSessionOutput, u as getDate } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as safeJSONParse } from \"./json-CnHxKYpj.mjs\";\nimport { c as setSessionCookie, m as getSessionQuerySchema, n as deleteSessionCookie, p as getChunkedCookie, s as setCookieCache } from \"./cookies-D72PbWdz.mjs\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\nimport { base64Url } from \"@better-auth/utils/base64\";\nimport { binary } from \"@better-auth/utils/binary\";\nimport { createHMAC } from \"@better-auth/utils/hmac\";\n\n//#region src/api/routes/session.ts\nconst getSession = () => createAuthEndpoint(\"/get-session\", {\n\tmethod: \"GET\",\n\toperationId: \"getSession\",\n\tquery: getSessionQuerySchema,\n\trequireHeaders: true,\n\tmetadata: { openapi: {\n\t\toperationId: \"getSession\",\n\t\tdescription: \"Get the current session\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: {\n\t\t\t\t\tsession: { $ref: \"#/components/schemas/Session\" },\n\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" }\n\t\t\t\t},\n\t\t\t\trequired: [\"session\", \"user\"]\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\ttry {\n\t\tconst sessionCookieToken = await ctx.getSignedCookie(ctx.context.authCookies.sessionToken.name, ctx.context.secret);\n\t\tif (!sessionCookieToken) return null;\n\t\tconst sessionDataCookie = getChunkedCookie(ctx, ctx.context.authCookies.sessionData.name);\n\t\tlet sessionDataPayload = null;\n\t\tif (sessionDataCookie) {\n\t\t\tconst strategy = ctx.context.options.session?.cookieCache?.strategy || \"compact\";\n\t\t\tif (strategy === \"jwe\") {\n\t\t\t\tconst payload = await symmetricDecodeJWT(sessionDataCookie, ctx.context.secret, \"better-auth-session\");\n\t\t\t\tif (payload && payload.session && payload.user) sessionDataPayload = {\n\t\t\t\t\tsession: {\n\t\t\t\t\t\tsession: payload.session,\n\t\t\t\t\t\tuser: payload.user,\n\t\t\t\t\t\tupdatedAt: payload.updatedAt,\n\t\t\t\t\t\tversion: payload.version\n\t\t\t\t\t},\n\t\t\t\t\texpiresAt: payload.exp ? payload.exp * 1e3 : Date.now()\n\t\t\t\t};\n\t\t\t\telse {\n\t\t\t\t\tconst dataCookie = ctx.context.authCookies.sessionData.name;\n\t\t\t\t\tctx.setCookie(dataCookie, \"\", { maxAge: 0 });\n\t\t\t\t\treturn ctx.json(null);\n\t\t\t\t}\n\t\t\t} else if (strategy === \"jwt\") {\n\t\t\t\tconst payload = await verifyJWT(sessionDataCookie, ctx.context.secret);\n\t\t\t\tif (payload && payload.session && payload.user) sessionDataPayload = {\n\t\t\t\t\tsession: {\n\t\t\t\t\t\tsession: payload.session,\n\t\t\t\t\t\tuser: payload.user,\n\t\t\t\t\t\tupdatedAt: payload.updatedAt,\n\t\t\t\t\t\tversion: payload.version\n\t\t\t\t\t},\n\t\t\t\t\texpiresAt: payload.exp ? payload.exp * 1e3 : Date.now()\n\t\t\t\t};\n\t\t\t\telse {\n\t\t\t\t\tconst dataCookie = ctx.context.authCookies.sessionData.name;\n\t\t\t\t\tctx.setCookie(dataCookie, \"\", { maxAge: 0 });\n\t\t\t\t\treturn ctx.json(null);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst parsed = safeJSONParse(binary.decode(base64Url.decode(sessionDataCookie)));\n\t\t\t\tif (parsed) if (await createHMAC(\"SHA-256\", \"base64urlnopad\").verify(ctx.context.secret, JSON.stringify({\n\t\t\t\t\t...parsed.session,\n\t\t\t\t\texpiresAt: parsed.expiresAt\n\t\t\t\t}), parsed.signature)) sessionDataPayload = parsed;\n\t\t\t\telse {\n\t\t\t\t\tconst dataCookie = ctx.context.authCookies.sessionData.name;\n\t\t\t\t\tctx.setCookie(dataCookie, \"\", { maxAge: 0 });\n\t\t\t\t\treturn ctx.json(null);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst dontRememberMe = await ctx.getSignedCookie(ctx.context.authCookies.dontRememberToken.name, ctx.context.secret);\n\t\t/**\n\t\t* If session data is present in the cookie, check if it should be used or refreshed\n\t\t*/\n\t\tif (sessionDataPayload?.session && ctx.context.options.session?.cookieCache?.enabled && !ctx.query?.disableCookieCache) {\n\t\t\tconst session$1 = sessionDataPayload.session;\n\t\t\tconst versionConfig = ctx.context.options.session?.cookieCache?.version;\n\t\t\tlet expectedVersion = \"1\";\n\t\t\tif (versionConfig) {\n\t\t\t\tif (typeof versionConfig === \"string\") expectedVersion = versionConfig;\n\t\t\t\telse if (typeof versionConfig === \"function\") {\n\t\t\t\t\tconst result = versionConfig(session$1.session, session$1.user);\n\t\t\t\t\texpectedVersion = result instanceof Promise ? await result : result;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ((session$1.version || \"1\") !== expectedVersion) {\n\t\t\t\tconst dataCookie = ctx.context.authCookies.sessionData.name;\n\t\t\t\tctx.setCookie(dataCookie, \"\", { maxAge: 0 });\n\t\t\t} else if (sessionDataPayload.expiresAt < Date.now() || session$1.session.expiresAt < /* @__PURE__ */ new Date()) {\n\t\t\t\tconst dataCookie = ctx.context.authCookies.sessionData.name;\n\t\t\t\tctx.setCookie(dataCookie, \"\", { maxAge: 0 });\n\t\t\t} else {\n\t\t\t\tconst cookieRefreshCache = ctx.context.sessionConfig.cookieRefreshCache;\n\t\t\t\tif (cookieRefreshCache === false) {\n\t\t\t\t\tctx.context.session = session$1;\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tsession: session$1.session,\n\t\t\t\t\t\tuser: session$1.user\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (sessionDataPayload.expiresAt - Date.now() < cookieRefreshCache.updateAge * 1e3) {\n\t\t\t\t\tconst newExpiresAt = getDate(ctx.context.options.session?.cookieCache?.maxAge || 300, \"sec\");\n\t\t\t\t\tconst refreshedSession = {\n\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t...session$1.session,\n\t\t\t\t\t\t\texpiresAt: newExpiresAt\n\t\t\t\t\t\t},\n\t\t\t\t\t\tuser: session$1.user,\n\t\t\t\t\t\tupdatedAt: Date.now()\n\t\t\t\t\t};\n\t\t\t\t\tawait setCookieCache(ctx, refreshedSession, false);\n\t\t\t\t\tconst parsedRefreshedSession = parseSessionOutput(ctx.context.options, {\n\t\t\t\t\t\t...refreshedSession.session,\n\t\t\t\t\t\texpiresAt: new Date(refreshedSession.session.expiresAt),\n\t\t\t\t\t\tcreatedAt: new Date(refreshedSession.session.createdAt),\n\t\t\t\t\t\tupdatedAt: new Date(refreshedSession.session.updatedAt)\n\t\t\t\t\t});\n\t\t\t\t\tconst parsedRefreshedUser = parseUserOutput(ctx.context.options, {\n\t\t\t\t\t\t...refreshedSession.user,\n\t\t\t\t\t\tcreatedAt: new Date(refreshedSession.user.createdAt),\n\t\t\t\t\t\tupdatedAt: new Date(refreshedSession.user.updatedAt)\n\t\t\t\t\t});\n\t\t\t\t\tctx.context.session = {\n\t\t\t\t\t\tsession: parsedRefreshedSession,\n\t\t\t\t\t\tuser: parsedRefreshedUser\n\t\t\t\t\t};\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tsession: parsedRefreshedSession,\n\t\t\t\t\t\tuser: parsedRefreshedUser\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst parsedSession = parseSessionOutput(ctx.context.options, {\n\t\t\t\t\t...session$1.session,\n\t\t\t\t\texpiresAt: new Date(session$1.session.expiresAt),\n\t\t\t\t\tcreatedAt: new Date(session$1.session.createdAt),\n\t\t\t\t\tupdatedAt: new Date(session$1.session.updatedAt)\n\t\t\t\t});\n\t\t\t\tconst parsedUser = parseUserOutput(ctx.context.options, {\n\t\t\t\t\t...session$1.user,\n\t\t\t\t\tcreatedAt: new Date(session$1.user.createdAt),\n\t\t\t\t\tupdatedAt: new Date(session$1.user.updatedAt)\n\t\t\t\t});\n\t\t\t\tctx.context.session = {\n\t\t\t\t\tsession: parsedSession,\n\t\t\t\t\tuser: parsedUser\n\t\t\t\t};\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tsession: parsedSession,\n\t\t\t\t\tuser: parsedUser\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tconst session = await ctx.context.internalAdapter.findSession(sessionCookieToken);\n\t\tctx.context.session = session;\n\t\tif (!session || session.session.expiresAt < /* @__PURE__ */ new Date()) {\n\t\t\tdeleteSessionCookie(ctx);\n\t\t\tif (session)\n /**\n\t\t\t* if session expired clean up the session\n\t\t\t*/\n\t\t\tawait ctx.context.internalAdapter.deleteSession(session.session.token);\n\t\t\treturn ctx.json(null);\n\t\t}\n\t\t/**\n\t\t* We don't need to update the session if the user doesn't want to be remembered\n\t\t* or if the session refresh is disabled\n\t\t*/\n\t\tif (dontRememberMe || ctx.query?.disableRefresh) {\n\t\t\tconst parsedSession = parseSessionOutput(ctx.context.options, session.session);\n\t\t\tconst parsedUser = parseUserOutput(ctx.context.options, session.user);\n\t\t\treturn ctx.json({\n\t\t\t\tsession: parsedSession,\n\t\t\t\tuser: parsedUser\n\t\t\t});\n\t\t}\n\t\tconst expiresIn = ctx.context.sessionConfig.expiresIn;\n\t\tconst updateAge = ctx.context.sessionConfig.updateAge;\n\t\tif (session.session.expiresAt.valueOf() - expiresIn * 1e3 + updateAge * 1e3 <= Date.now() && (!ctx.query?.disableRefresh || !ctx.context.options.session?.disableSessionRefresh)) {\n\t\t\tconst updatedSession = await ctx.context.internalAdapter.updateSession(session.session.token, {\n\t\t\t\texpiresAt: getDate(ctx.context.sessionConfig.expiresIn, \"sec\"),\n\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t});\n\t\t\tif (!updatedSession) {\n\t\t\t\t/**\n\t\t\t\t* Handle case where session update fails (e.g., concurrent deletion)\n\t\t\t\t*/\n\t\t\t\tdeleteSessionCookie(ctx);\n\t\t\t\treturn ctx.json(null, { status: 401 });\n\t\t\t}\n\t\t\tconst maxAge = (updatedSession.expiresAt.valueOf() - Date.now()) / 1e3;\n\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\tsession: updatedSession,\n\t\t\t\tuser: session.user\n\t\t\t}, false, { maxAge });\n\t\t\tconst parsedUpdatedSession = parseSessionOutput(ctx.context.options, updatedSession);\n\t\t\tconst parsedUser = parseUserOutput(ctx.context.options, session.user);\n\t\t\treturn ctx.json({\n\t\t\t\tsession: parsedUpdatedSession,\n\t\t\t\tuser: parsedUser\n\t\t\t});\n\t\t}\n\t\tawait setCookieCache(ctx, session, !!dontRememberMe);\n\t\treturn ctx.json(session);\n\t} catch (error) {\n\t\tctx.context.logger.error(\"INTERNAL_SERVER_ERROR\", error);\n\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", { message: BASE_ERROR_CODES.FAILED_TO_GET_SESSION });\n\t}\n});\nconst getSessionFromCtx = async (ctx, config) => {\n\tif (ctx.context.session) return ctx.context.session;\n\tconst session = await getSession()({\n\t\t...ctx,\n\t\tasResponse: false,\n\t\theaders: ctx.headers,\n\t\treturnHeaders: false,\n\t\treturnStatus: false,\n\t\tquery: {\n\t\t\t...config,\n\t\t\t...ctx.query\n\t\t}\n\t}).catch((e) => {\n\t\treturn null;\n\t});\n\tctx.context.session = session;\n\treturn session;\n};\n/**\n* The middleware forces the endpoint to require a valid session.\n*/\nconst sessionMiddleware = createAuthMiddleware(async (ctx) => {\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session?.session) throw new APIError(\"UNAUTHORIZED\");\n\treturn { session };\n});\n/**\n* This middleware forces the endpoint to require a valid session and ignores cookie cache.\n* This should be used for sensitive operations like password changes, account deletion, etc.\n* to ensure that revoked sessions cannot be used even if they're still cached in cookies.\n*/\nconst sensitiveSessionMiddleware = createAuthMiddleware(async (ctx) => {\n\tconst session = await getSessionFromCtx(ctx, { disableCookieCache: true });\n\tif (!session?.session) throw new APIError(\"UNAUTHORIZED\");\n\treturn { session };\n});\n/**\n* This middleware allows you to call the endpoint on the client if session is valid.\n* However, if called on the server, no session is required.\n*/\nconst requestOnlySessionMiddleware = createAuthMiddleware(async (ctx) => {\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session?.session && (ctx.request || ctx.headers)) throw new APIError(\"UNAUTHORIZED\");\n\treturn { session };\n});\n/**\n* This middleware forces the endpoint to require a valid session,\n* as well as making sure the session is fresh before proceeding.\n*\n* Session freshness check will be skipped if the session config's freshAge\n* is set to 0\n*/\nconst freshSessionMiddleware = createAuthMiddleware(async (ctx) => {\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session?.session) throw new APIError(\"UNAUTHORIZED\");\n\tif (ctx.context.sessionConfig.freshAge === 0) return { session };\n\tconst freshAge = ctx.context.sessionConfig.freshAge;\n\tconst lastUpdated = new Date(session.session.updatedAt || session.session.createdAt).getTime();\n\tif (!(Date.now() - lastUpdated < freshAge * 1e3)) throw new APIError(\"FORBIDDEN\", { message: \"Session is not fresh\" });\n\treturn { session };\n});\n/**\n* user active sessions list\n*/\nconst listSessions = () => createAuthEndpoint(\"/list-sessions\", {\n\tmethod: \"GET\",\n\toperationId: \"listUserSessions\",\n\tuse: [sessionMiddleware],\n\trequireHeaders: true,\n\tmetadata: { openapi: {\n\t\toperationId: \"listUserSessions\",\n\t\tdescription: \"List all active sessions for the user\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"array\",\n\t\t\t\titems: { $ref: \"#/components/schemas/Session\" }\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\ttry {\n\t\tconst activeSessions = (await ctx.context.internalAdapter.listSessions(ctx.context.session.user.id)).filter((session) => {\n\t\t\treturn session.expiresAt > /* @__PURE__ */ new Date();\n\t\t});\n\t\treturn ctx.json(activeSessions);\n\t} catch (e) {\n\t\tctx.context.logger.error(e);\n\t\tthrow ctx.error(\"INTERNAL_SERVER_ERROR\");\n\t}\n});\n/**\n* revoke a single session\n*/\nconst revokeSession = createAuthEndpoint(\"/revoke-session\", {\n\tmethod: \"POST\",\n\tbody: z.object({ token: z.string().meta({ description: \"The token to revoke\" }) }),\n\tuse: [sensitiveSessionMiddleware],\n\trequireHeaders: true,\n\tmetadata: { openapi: {\n\t\tdescription: \"Revoke a single session\",\n\t\trequestBody: { content: { \"application/json\": { schema: {\n\t\t\ttype: \"object\",\n\t\t\tproperties: { token: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tdescription: \"The token to revoke\"\n\t\t\t} },\n\t\t\trequired: [\"token\"]\n\t\t} } } },\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { status: {\n\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\tdescription: \"Indicates if the session was revoked successfully\"\n\t\t\t\t} },\n\t\t\t\trequired: [\"status\"]\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tconst token = ctx.body.token;\n\tif ((await ctx.context.internalAdapter.findSession(token))?.session.userId === ctx.context.session.user.id) try {\n\t\tawait ctx.context.internalAdapter.deleteSession(token);\n\t} catch (error) {\n\t\tctx.context.logger.error(error && typeof error === \"object\" && \"name\" in error ? error.name : \"\", error);\n\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\");\n\t}\n\treturn ctx.json({ status: true });\n});\n/**\n* revoke all user sessions\n*/\nconst revokeSessions = createAuthEndpoint(\"/revoke-sessions\", {\n\tmethod: \"POST\",\n\tuse: [sensitiveSessionMiddleware],\n\trequireHeaders: true,\n\tmetadata: { openapi: {\n\t\tdescription: \"Revoke all sessions for the user\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { status: {\n\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\tdescription: \"Indicates if all sessions were revoked successfully\"\n\t\t\t\t} },\n\t\t\t\trequired: [\"status\"]\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\ttry {\n\t\tawait ctx.context.internalAdapter.deleteSessions(ctx.context.session.user.id);\n\t} catch (error) {\n\t\tctx.context.logger.error(error && typeof error === \"object\" && \"name\" in error ? error.name : \"\", error);\n\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\");\n\t}\n\treturn ctx.json({ status: true });\n});\nconst revokeOtherSessions = createAuthEndpoint(\"/revoke-other-sessions\", {\n\tmethod: \"POST\",\n\trequireHeaders: true,\n\tuse: [sensitiveSessionMiddleware],\n\tmetadata: { openapi: {\n\t\tdescription: \"Revoke all other sessions for the user except the current one\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { status: {\n\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\tdescription: \"Indicates if all other sessions were revoked successfully\"\n\t\t\t\t} },\n\t\t\t\trequired: [\"status\"]\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tconst session = ctx.context.session;\n\tif (!session.user) throw new APIError(\"UNAUTHORIZED\");\n\tconst otherSessions = (await ctx.context.internalAdapter.listSessions(session.user.id)).filter((session$1) => {\n\t\treturn session$1.expiresAt > /* @__PURE__ */ new Date();\n\t}).filter((session$1) => session$1.token !== ctx.context.session.session.token);\n\tawait Promise.all(otherSessions.map((session$1) => ctx.context.internalAdapter.deleteSession(session$1.token)));\n\treturn ctx.json({ status: true });\n});\n\n//#endregion\nexport { requestOnlySessionMiddleware as a, revokeSessions as c, listSessions as i, sensitiveSessionMiddleware as l, getSession as n, revokeOtherSessions as o, getSessionFromCtx as r, revokeSession as s, freshSessionMiddleware as t, sessionMiddleware as u };","import { i as parseState, n as HIDE_METADATA, r as generateState } from \"./utils-db7gNqd-.mjs\";\nimport { O as handleOAuthUserInfo } from \"./api-CkmycQ2x.mjs\";\nimport { c as setSessionCookie } from \"./cookies-D72PbWdz.mjs\";\nimport { u as sessionMiddleware } from \"./session-AaRl3_x-.mjs\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { createAuthorizationURL, refreshAccessToken, validateAuthorizationCode } from \"@better-auth/core/oauth2\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { decodeJwt } from \"jose\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { betterFetch } from \"@better-fetch/fetch\";\n\n//#region src/plugins/generic-oauth/error-codes.ts\nconst GENERIC_OAUTH_ERROR_CODES = defineErrorCodes({\n\tINVALID_OAUTH_CONFIGURATION: \"Invalid OAuth configuration\",\n\tTOKEN_URL_NOT_FOUND: \"Invalid OAuth configuration. Token URL not found.\",\n\tPROVIDER_CONFIG_NOT_FOUND: \"No config found for provider\",\n\tPROVIDER_ID_REQUIRED: \"Provider ID is required\",\n\tINVALID_OAUTH_CONFIG: \"Invalid OAuth configuration.\",\n\tSESSION_REQUIRED: \"Session is required\"\n});\n\n//#endregion\n//#region src/plugins/generic-oauth/providers/auth0.ts\n/**\n* Auth0 OAuth provider helper\n*\n* @example\n* ```ts\n* import { genericOAuth, auth0 } from \"better-auth/plugins/generic-oauth\";\n*\n* export const auth = betterAuth({\n*   plugins: [\n*     genericOAuth({\n*       config: [\n*         auth0({\n*           clientId: process.env.AUTH0_CLIENT_ID,\n*           clientSecret: process.env.AUTH0_CLIENT_SECRET,\n*           domain: process.env.AUTH0_DOMAIN,\n*         }),\n*       ],\n*     }),\n*   ],\n* });\n* ```\n*/\nfunction auth0(options) {\n\tconst defaultScopes = [\n\t\t\"openid\",\n\t\t\"profile\",\n\t\t\"email\"\n\t];\n\tconst domain = options.domain.replace(/^https?:\\/\\//, \"\");\n\tconst discoveryUrl = `https://${domain}/.well-known/openid-configuration`;\n\tconst getUserInfo$1 = async (tokens) => {\n\t\tconst { data: profile, error } = await betterFetch(`https://${domain}/userinfo`, { headers: { Authorization: `Bearer ${tokens.accessToken}` } });\n\t\tif (error || !profile) return null;\n\t\treturn {\n\t\t\tid: profile.sub,\n\t\t\tname: profile.name ?? profile.nickname ?? void 0,\n\t\t\temail: profile.email ?? void 0,\n\t\t\timage: profile.picture,\n\t\t\temailVerified: profile.email_verified ?? false\n\t\t};\n\t};\n\treturn {\n\t\tproviderId: \"auth0\",\n\t\tdiscoveryUrl,\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo: getUserInfo$1\n\t};\n}\n\n//#endregion\n//#region src/plugins/generic-oauth/providers/hubspot.ts\n/**\n* HubSpot OAuth provider helper\n*\n* @example\n* ```ts\n* import { genericOAuth, hubspot } from \"better-auth/plugins/generic-oauth\";\n*\n* export const auth = betterAuth({\n*   plugins: [\n*     genericOAuth({\n*       config: [\n*         hubspot({\n*           clientId: process.env.HUBSPOT_CLIENT_ID,\n*           clientSecret: process.env.HUBSPOT_CLIENT_SECRET,\n*           scopes: [\"oauth\", \"contacts\"],\n*         }),\n*       ],\n*     }),\n*   ],\n* });\n* ```\n*/\nfunction hubspot(options) {\n\tconst defaultScopes = [\"oauth\"];\n\tconst getUserInfo$1 = async (tokens) => {\n\t\tconst { data: profile, error } = await betterFetch(`https://api.hubapi.com/oauth/v1/access-tokens/${tokens.accessToken}`, { headers: { \"Content-Type\": \"application/json\" } });\n\t\tif (error || !profile) return null;\n\t\tconst id = profile.user_id ?? profile.signed_access_token?.userId;\n\t\tif (!id) return null;\n\t\treturn {\n\t\t\tid,\n\t\t\tname: profile.user,\n\t\t\temail: profile.user,\n\t\t\timage: void 0,\n\t\t\temailVerified: false\n\t\t};\n\t};\n\treturn {\n\t\tproviderId: \"hubspot\",\n\t\tauthorizationUrl: \"https://app.hubspot.com/oauth/authorize\",\n\t\ttokenUrl: \"https://api.hubapi.com/oauth/v1/token\",\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tauthentication: \"post\",\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo: getUserInfo$1\n\t};\n}\n\n//#endregion\n//#region src/plugins/generic-oauth/providers/keycloak.ts\n/**\n* Keycloak OAuth provider helper\n*\n* @example\n* ```ts\n* import { genericOAuth, keycloak } from \"better-auth/plugins/generic-oauth\";\n*\n* export const auth = betterAuth({\n*   plugins: [\n*     genericOAuth({\n*       config: [\n*         keycloak({\n*           clientId: process.env.KEYCLOAK_CLIENT_ID,\n*           clientSecret: process.env.KEYCLOAK_CLIENT_SECRET,\n*           issuer: process.env.KEYCLOAK_ISSUER,\n*         }),\n*       ],\n*     }),\n*   ],\n* });\n* ```\n*/\nfunction keycloak(options) {\n\tconst defaultScopes = [\n\t\t\"openid\",\n\t\t\"profile\",\n\t\t\"email\"\n\t];\n\tconst issuer = options.issuer.replace(/\\/$/, \"\");\n\tconst discoveryUrl = `${issuer}/.well-known/openid-configuration`;\n\tconst getUserInfo$1 = async (tokens) => {\n\t\tconst { data: profile, error } = await betterFetch(`${issuer}/protocol/openid-connect/userinfo`, { headers: { Authorization: `Bearer ${tokens.accessToken}` } });\n\t\tif (error || !profile) return null;\n\t\treturn {\n\t\t\tid: profile.sub,\n\t\t\tname: profile.name ?? profile.preferred_username ?? void 0,\n\t\t\temail: profile.email ?? void 0,\n\t\t\timage: profile.picture,\n\t\t\temailVerified: profile.email_verified ?? false\n\t\t};\n\t};\n\treturn {\n\t\tproviderId: \"keycloak\",\n\t\tdiscoveryUrl,\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo: getUserInfo$1\n\t};\n}\n\n//#endregion\n//#region src/plugins/generic-oauth/providers/line.ts\n/**\n* LINE OAuth provider helper\n*\n* LINE requires separate channels for different countries (Japan, Thailand, Taiwan, etc.).\n* Each channel has its own clientId and clientSecret. To support multiple countries,\n* call this function multiple times with different providerIds and credentials.\n*\n* @example\n* ```ts\n* import { genericOAuth, line } from \"better-auth/plugins/generic-oauth\";\n*\n* export const auth = betterAuth({\n*   plugins: [\n*     genericOAuth({\n*       config: [\n*         // Japan channel\n*         line({\n*           providerId: \"line-jp\",\n*           clientId: process.env.LINE_JP_CLIENT_ID,\n*           clientSecret: process.env.LINE_JP_CLIENT_SECRET,\n*         }),\n*         // Thailand channel\n*         line({\n*           providerId: \"line-th\",\n*           clientId: process.env.LINE_TH_CLIENT_ID,\n*           clientSecret: process.env.LINE_TH_CLIENT_SECRET,\n*         }),\n*         // Taiwan channel\n*         line({\n*           providerId: \"line-tw\",\n*           clientId: process.env.LINE_TW_CLIENT_ID,\n*           clientSecret: process.env.LINE_TW_CLIENT_SECRET,\n*         }),\n*       ],\n*     }),\n*   ],\n* });\n* ```\n*/\nfunction line(options) {\n\tconst defaultScopes = [\n\t\t\"openid\",\n\t\t\"profile\",\n\t\t\"email\"\n\t];\n\tconst authorizationUrl = \"https://access.line.me/oauth2/v2.1/authorize\";\n\tconst tokenUrl = \"https://api.line.me/oauth2/v2.1/token\";\n\tconst userInfoUrl = \"https://api.line.me/oauth2/v2.1/userinfo\";\n\tconst getUserInfo$1 = async (tokens) => {\n\t\tlet profile = null;\n\t\tif (tokens.idToken) try {\n\t\t\tprofile = decodeJwt(tokens.idToken);\n\t\t} catch {}\n\t\tif (!profile) {\n\t\t\tconst { data, error } = await betterFetch(userInfoUrl, { headers: { Authorization: `Bearer ${tokens.accessToken}` } });\n\t\t\tif (error || !data) return null;\n\t\t\tprofile = data;\n\t\t}\n\t\tif (!profile) return null;\n\t\treturn {\n\t\t\tid: profile.sub,\n\t\t\tname: profile.name,\n\t\t\temail: profile.email,\n\t\t\timage: profile.picture,\n\t\t\temailVerified: false\n\t\t};\n\t};\n\treturn {\n\t\tproviderId: options.providerId ?? \"line\",\n\t\tauthorizationUrl,\n\t\ttokenUrl,\n\t\tuserInfoUrl,\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo: getUserInfo$1\n\t};\n}\n\n//#endregion\n//#region src/plugins/generic-oauth/providers/microsoft-entra-id.ts\n/**\n* Microsoft Entra ID (Azure AD) OAuth provider helper\n*\n* @example\n* ```ts\n* import { genericOAuth, microsoftEntraId } from \"better-auth/plugins/generic-oauth\";\n*\n* export const auth = betterAuth({\n*   plugins: [\n*     genericOAuth({\n*       config: [\n*         microsoftEntraId({\n*           clientId: process.env.MS_APP_ID,\n*           clientSecret: process.env.MS_CLIENT_SECRET,\n*           tenantId: process.env.MS_TENANT_ID,\n*         }),\n*       ],\n*     }),\n*   ],\n* });\n* ```\n*/\nfunction microsoftEntraId(options) {\n\tconst defaultScopes = [\n\t\t\"openid\",\n\t\t\"profile\",\n\t\t\"email\"\n\t];\n\tconst tenantId = options.tenantId;\n\tconst authorizationUrl = `https://login.microsoftonline.com/${tenantId}/oauth2/v2.0/authorize`;\n\tconst tokenUrl = `https://login.microsoftonline.com/${tenantId}/oauth2/v2.0/token`;\n\tconst userInfoUrl = \"https://graph.microsoft.com/oidc/userinfo\";\n\tconst getUserInfo$1 = async (tokens) => {\n\t\tconst { data: profile, error } = await betterFetch(userInfoUrl, { headers: { Authorization: `Bearer ${tokens.accessToken}` } });\n\t\tif (error || !profile) return null;\n\t\treturn {\n\t\t\tid: profile.sub,\n\t\t\tname: profile.name ?? (`${profile.given_name ?? \"\"} ${profile.family_name ?? \"\"}`.trim() || void 0),\n\t\t\temail: profile.email ?? profile.preferred_username ?? void 0,\n\t\t\timage: profile.picture,\n\t\t\temailVerified: profile.email_verified ?? false\n\t\t};\n\t};\n\treturn {\n\t\tproviderId: \"microsoft-entra-id\",\n\t\tauthorizationUrl,\n\t\ttokenUrl,\n\t\tuserInfoUrl,\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo: getUserInfo$1\n\t};\n}\n\n//#endregion\n//#region src/plugins/generic-oauth/providers/okta.ts\n/**\n* Okta OAuth provider helper\n*\n* @example\n* ```ts\n* import { genericOAuth, okta } from \"better-auth/plugins/generic-oauth\";\n*\n* export const auth = betterAuth({\n*   plugins: [\n*     genericOAuth({\n*       config: [\n*         okta({\n*           clientId: process.env.OKTA_CLIENT_ID,\n*           clientSecret: process.env.OKTA_CLIENT_SECRET,\n*           issuer: process.env.OKTA_ISSUER,\n*         }),\n*       ],\n*     }),\n*   ],\n* });\n* ```\n*/\nfunction okta(options) {\n\tconst defaultScopes = [\n\t\t\"openid\",\n\t\t\"profile\",\n\t\t\"email\"\n\t];\n\tconst issuer = options.issuer.replace(/\\/$/, \"\");\n\tconst discoveryUrl = `${issuer}/.well-known/openid-configuration`;\n\tconst getUserInfo$1 = async (tokens) => {\n\t\tconst { data: profile, error } = await betterFetch(`${issuer}/v1/userinfo`, { headers: { Authorization: `Bearer ${tokens.accessToken}` } });\n\t\tif (error || !profile) return null;\n\t\treturn {\n\t\t\tid: profile.sub,\n\t\t\tname: profile.name ?? profile.preferred_username ?? void 0,\n\t\t\temail: profile.email ?? void 0,\n\t\t\timage: profile.picture,\n\t\t\temailVerified: profile.email_verified ?? false\n\t\t};\n\t};\n\treturn {\n\t\tproviderId: \"okta\",\n\t\tdiscoveryUrl,\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo: getUserInfo$1\n\t};\n}\n\n//#endregion\n//#region src/plugins/generic-oauth/providers/slack.ts\n/**\n* Slack OAuth provider helper\n*\n* @example\n* ```ts\n* import { genericOAuth, slack } from \"better-auth/plugins/generic-oauth\";\n*\n* export const auth = betterAuth({\n*   plugins: [\n*     genericOAuth({\n*       config: [\n*         slack({\n*           clientId: process.env.SLACK_CLIENT_ID,\n*           clientSecret: process.env.SLACK_CLIENT_SECRET,\n*         }),\n*       ],\n*     }),\n*   ],\n* });\n* ```\n*/\nfunction slack(options) {\n\tconst defaultScopes = [\n\t\t\"openid\",\n\t\t\"profile\",\n\t\t\"email\"\n\t];\n\tconst getUserInfo$1 = async (tokens) => {\n\t\tconst { data: profile, error } = await betterFetch(\"https://slack.com/api/openid.connect.userInfo\", { headers: { Authorization: `Bearer ${tokens.accessToken}` } });\n\t\tif (error || !profile) return null;\n\t\treturn {\n\t\t\tid: profile[\"https://slack.com/user_id\"] ?? profile.sub,\n\t\t\tname: profile.name,\n\t\t\temail: profile.email,\n\t\t\timage: profile.picture ?? profile[\"https://slack.com/user_image_512\"],\n\t\t\temailVerified: profile.email_verified ?? false\n\t\t};\n\t};\n\treturn {\n\t\tproviderId: \"slack\",\n\t\tauthorizationUrl: \"https://slack.com/openid/connect/authorize\",\n\t\ttokenUrl: \"https://slack.com/api/openid.connect.token\",\n\t\tuserInfoUrl: \"https://slack.com/api/openid.connect.userInfo\",\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo: getUserInfo$1\n\t};\n}\n\n//#endregion\n//#region src/plugins/generic-oauth/index.ts\nasync function getUserInfo(tokens, finalUserInfoUrl) {\n\tif (tokens.idToken) {\n\t\tconst decoded = decodeJwt(tokens.idToken);\n\t\tif (decoded) {\n\t\t\tif (decoded.sub && decoded.email) return {\n\t\t\t\tid: decoded.sub,\n\t\t\t\temailVerified: decoded.email_verified,\n\t\t\t\timage: decoded.picture,\n\t\t\t\t...decoded\n\t\t\t};\n\t\t}\n\t}\n\tif (!finalUserInfoUrl) return null;\n\tconst userInfo = await betterFetch(finalUserInfoUrl, {\n\t\tmethod: \"GET\",\n\t\theaders: { Authorization: `Bearer ${tokens.accessToken}` }\n\t});\n\treturn {\n\t\tid: userInfo.data?.sub ?? \"\",\n\t\temailVerified: userInfo.data?.email_verified ?? false,\n\t\temail: userInfo.data?.email,\n\t\timage: userInfo.data?.picture,\n\t\tname: userInfo.data?.name,\n\t\t...userInfo.data\n\t};\n}\n/**\n* A generic OAuth plugin that can be used to add OAuth support to any provider\n*/\nconst genericOAuth = (options) => {\n\treturn {\n\t\tid: \"generic-oauth\",\n\t\tinit: (ctx) => {\n\t\t\treturn { context: { socialProviders: options.config.map((c) => {\n\t\t\t\tlet finalUserInfoUrl = c.userInfoUrl;\n\t\t\t\treturn {\n\t\t\t\t\tid: c.providerId,\n\t\t\t\t\tname: c.providerId,\n\t\t\t\t\tasync createAuthorizationURL(data) {\n\t\t\t\t\t\tlet finalAuthUrl = c.authorizationUrl;\n\t\t\t\t\t\tif (!finalAuthUrl && c.discoveryUrl) {\n\t\t\t\t\t\t\tconst discovery = await betterFetch(c.discoveryUrl, {\n\t\t\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\t\t\theaders: c.discoveryHeaders\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (discovery.data) {\n\t\t\t\t\t\t\t\tfinalAuthUrl = discovery.data.authorization_endpoint;\n\t\t\t\t\t\t\t\tfinalUserInfoUrl = finalUserInfoUrl ?? discovery.data.userinfo_endpoint;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!finalAuthUrl) throw new APIError(\"BAD_REQUEST\", { message: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIGURATION });\n\t\t\t\t\t\treturn createAuthorizationURL({\n\t\t\t\t\t\t\tid: c.providerId,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tclientId: c.clientId,\n\t\t\t\t\t\t\t\tclientSecret: c.clientSecret,\n\t\t\t\t\t\t\t\tredirectURI: c.redirectURI\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tauthorizationEndpoint: finalAuthUrl,\n\t\t\t\t\t\t\tstate: data.state,\n\t\t\t\t\t\t\tcodeVerifier: c.pkce ? data.codeVerifier : void 0,\n\t\t\t\t\t\t\tscopes: c.scopes || [],\n\t\t\t\t\t\t\tredirectURI: `${ctx.baseURL}/oauth2/callback/${c.providerId}`\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tasync validateAuthorizationCode(data) {\n\t\t\t\t\t\tif (c.getToken) return c.getToken(data);\n\t\t\t\t\t\tlet finalTokenUrl = c.tokenUrl;\n\t\t\t\t\t\tif (c.discoveryUrl) {\n\t\t\t\t\t\t\tconst discovery = await betterFetch(c.discoveryUrl, {\n\t\t\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\t\t\theaders: c.discoveryHeaders\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (discovery.data) {\n\t\t\t\t\t\t\t\tfinalTokenUrl = discovery.data.token_endpoint;\n\t\t\t\t\t\t\t\tfinalUserInfoUrl = discovery.data.userinfo_endpoint;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!finalTokenUrl) throw new APIError(\"BAD_REQUEST\", { message: GENERIC_OAUTH_ERROR_CODES.TOKEN_URL_NOT_FOUND });\n\t\t\t\t\t\treturn validateAuthorizationCode({\n\t\t\t\t\t\t\theaders: c.authorizationHeaders,\n\t\t\t\t\t\t\tcode: data.code,\n\t\t\t\t\t\t\tcodeVerifier: data.codeVerifier,\n\t\t\t\t\t\t\tredirectURI: data.redirectURI,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tclientId: c.clientId,\n\t\t\t\t\t\t\t\tclientSecret: c.clientSecret,\n\t\t\t\t\t\t\t\tredirectURI: c.redirectURI\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttokenEndpoint: finalTokenUrl,\n\t\t\t\t\t\t\tauthentication: c.authentication\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tasync refreshAccessToken(refreshToken) {\n\t\t\t\t\t\tlet finalTokenUrl = c.tokenUrl;\n\t\t\t\t\t\tif (c.discoveryUrl) {\n\t\t\t\t\t\t\tconst discovery = await betterFetch(c.discoveryUrl, {\n\t\t\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\t\t\theaders: c.discoveryHeaders\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (discovery.data) finalTokenUrl = discovery.data.token_endpoint;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!finalTokenUrl) throw new APIError(\"BAD_REQUEST\", { message: GENERIC_OAUTH_ERROR_CODES.TOKEN_URL_NOT_FOUND });\n\t\t\t\t\t\treturn refreshAccessToken({\n\t\t\t\t\t\t\trefreshToken,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tclientId: c.clientId,\n\t\t\t\t\t\t\t\tclientSecret: c.clientSecret\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tauthentication: c.authentication,\n\t\t\t\t\t\t\ttokenEndpoint: finalTokenUrl\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tasync getUserInfo(tokens) {\n\t\t\t\t\t\tconst userInfo = c.getUserInfo ? await c.getUserInfo(tokens) : await getUserInfo(tokens, finalUserInfoUrl);\n\t\t\t\t\t\tif (!userInfo) return null;\n\t\t\t\t\t\tconst userMap = await c.mapProfileToUser?.(userInfo);\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\tid: userInfo?.id,\n\t\t\t\t\t\t\t\temail: userInfo?.email,\n\t\t\t\t\t\t\t\temailVerified: userInfo?.emailVerified,\n\t\t\t\t\t\t\t\timage: userInfo?.image,\n\t\t\t\t\t\t\t\tname: userInfo?.name,\n\t\t\t\t\t\t\t\t...userMap\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdata: userInfo\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t\toptions: { overrideUserInfoOnSignIn: c.overrideUserInfo }\n\t\t\t\t};\n\t\t\t}).concat(ctx.socialProviders) } };\n\t\t},\n\t\tendpoints: {\n\t\t\tsignInWithOAuth2: createAuthEndpoint(\"/sign-in/oauth2\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tproviderId: z.string().meta({ description: \"The provider ID for the OAuth provider\" }),\n\t\t\t\t\tcallbackURL: z.string().meta({ description: \"The URL to redirect to after sign in\" }).optional(),\n\t\t\t\t\terrorCallbackURL: z.string().meta({ description: \"The URL to redirect to if an error occurs\" }).optional(),\n\t\t\t\t\tnewUserCallbackURL: z.string().meta({ description: \"The URL to redirect to after login if the user is new. Eg: \\\"/welcome\\\"\" }).optional(),\n\t\t\t\t\tdisableRedirect: z.boolean().meta({ description: \"Disable redirect\" }).optional(),\n\t\t\t\t\tscopes: z.array(z.string()).meta({ description: \"Scopes to be passed to the provider authorization request.\" }).optional(),\n\t\t\t\t\trequestSignUp: z.boolean().meta({ description: \"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider. Eg: false\" }).optional(),\n\t\t\t\t\tadditionalData: z.record(z.string(), z.any()).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Sign in with OAuth2\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Sign in with OAuth2\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\turl: { type: \"string\" },\n\t\t\t\t\t\t\t\tredirect: { type: \"boolean\" }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { providerId } = ctx.body;\n\t\t\t\tconst config = options.config.find((c) => c.providerId === providerId);\n\t\t\t\tif (!config) throw new APIError(\"BAD_REQUEST\", { message: `${GENERIC_OAUTH_ERROR_CODES.PROVIDER_CONFIG_NOT_FOUND} ${providerId}` });\n\t\t\t\tconst { discoveryUrl, authorizationUrl, tokenUrl, clientId, clientSecret, scopes, redirectURI, responseType, pkce, prompt, accessType, authorizationUrlParams, responseMode, authentication } = config;\n\t\t\t\tlet finalAuthUrl = authorizationUrl;\n\t\t\t\tlet finalTokenUrl = tokenUrl;\n\t\t\t\tif (discoveryUrl) {\n\t\t\t\t\tconst discovery = await betterFetch(discoveryUrl, {\n\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\theaders: config.discoveryHeaders,\n\t\t\t\t\t\tonError(context) {\n\t\t\t\t\t\t\tctx.context.logger.error(context.error.message, context.error, { discoveryUrl });\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (discovery.data) {\n\t\t\t\t\t\tfinalAuthUrl = discovery.data.authorization_endpoint;\n\t\t\t\t\t\tfinalTokenUrl = discovery.data.token_endpoint;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!finalAuthUrl || !finalTokenUrl) throw new APIError(\"BAD_REQUEST\", { message: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIGURATION });\n\t\t\t\tif (authorizationUrlParams) {\n\t\t\t\t\tconst withAdditionalParams = new URL(finalAuthUrl);\n\t\t\t\t\tfor (const [paramName, paramValue] of Object.entries(authorizationUrlParams)) withAdditionalParams.searchParams.set(paramName, paramValue);\n\t\t\t\t\tfinalAuthUrl = withAdditionalParams.toString();\n\t\t\t\t}\n\t\t\t\tconst additionalParams = typeof authorizationUrlParams === \"function\" ? authorizationUrlParams(ctx) : authorizationUrlParams;\n\t\t\t\tconst { state, codeVerifier } = await generateState(ctx, void 0, ctx.body.additionalData);\n\t\t\t\tconst authUrl = await createAuthorizationURL({\n\t\t\t\t\tid: providerId,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tclientId,\n\t\t\t\t\t\tclientSecret,\n\t\t\t\t\t\tredirectURI\n\t\t\t\t\t},\n\t\t\t\t\tauthorizationEndpoint: finalAuthUrl,\n\t\t\t\t\tstate,\n\t\t\t\t\tcodeVerifier: pkce ? codeVerifier : void 0,\n\t\t\t\t\tscopes: ctx.body.scopes ? [...ctx.body.scopes, ...scopes || []] : scopes || [],\n\t\t\t\t\tredirectURI: `${ctx.context.baseURL}/oauth2/callback/${providerId}`,\n\t\t\t\t\tprompt,\n\t\t\t\t\taccessType,\n\t\t\t\t\tresponseType,\n\t\t\t\t\tresponseMode,\n\t\t\t\t\tadditionalParams\n\t\t\t\t});\n\t\t\t\treturn ctx.json({\n\t\t\t\t\turl: authUrl.toString(),\n\t\t\t\t\tredirect: !ctx.body.disableRedirect\n\t\t\t\t});\n\t\t\t}),\n\t\t\toAuth2Callback: createAuthEndpoint(\"/oauth2/callback/:providerId\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tquery: z.object({\n\t\t\t\t\tcode: z.string().meta({ description: \"The OAuth2 code\" }).optional(),\n\t\t\t\t\terror: z.string().meta({ description: \"The error message, if any\" }).optional(),\n\t\t\t\t\terror_description: z.string().meta({ description: \"The error description, if any\" }).optional(),\n\t\t\t\t\tstate: z.string().meta({ description: \"The state parameter from the OAuth2 request\" }).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: {\n\t\t\t\t\t...HIDE_METADATA,\n\t\t\t\t\tallowedMediaTypes: [\"application/x-www-form-urlencoded\", \"application/json\"],\n\t\t\t\t\topenapi: {\n\t\t\t\t\t\tdescription: \"OAuth2 callback\",\n\t\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\t\tdescription: \"OAuth2 callback\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: { url: { type: \"string\" } }\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t} }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst defaultErrorURL = ctx.context.options.onAPIError?.errorURL || `${ctx.context.baseURL}/error`;\n\t\t\t\tif (ctx.query.error || !ctx.query.code) throw ctx.redirect(`${defaultErrorURL}?error=${ctx.query.error || \"oAuth_code_missing\"}&error_description=${ctx.query.error_description}`);\n\t\t\t\tconst providerId = ctx.params?.providerId;\n\t\t\t\tif (!providerId) throw new APIError(\"BAD_REQUEST\", { message: GENERIC_OAUTH_ERROR_CODES.PROVIDER_ID_REQUIRED });\n\t\t\t\tconst providerConfig = options.config.find((p) => p.providerId === providerId);\n\t\t\t\tif (!providerConfig) throw new APIError(\"BAD_REQUEST\", { message: `${GENERIC_OAUTH_ERROR_CODES.PROVIDER_CONFIG_NOT_FOUND} ${providerId}` });\n\t\t\t\tlet tokens = void 0;\n\t\t\t\tconst { callbackURL, codeVerifier, errorURL, requestSignUp, newUserURL, link } = await parseState(ctx);\n\t\t\t\tconst code = ctx.query.code;\n\t\t\t\tfunction redirectOnError(error) {\n\t\t\t\t\tconst defaultErrorURL$1 = ctx.context.options.onAPIError?.errorURL || `${ctx.context.baseURL}/error`;\n\t\t\t\t\tlet url = errorURL || defaultErrorURL$1;\n\t\t\t\t\tif (url.includes(\"?\")) url = `${url}&error=${error}`;\n\t\t\t\t\telse url = `${url}?error=${error}`;\n\t\t\t\t\tthrow ctx.redirect(url);\n\t\t\t\t}\n\t\t\t\tlet finalTokenUrl = providerConfig.tokenUrl;\n\t\t\t\tlet finalUserInfoUrl = providerConfig.userInfoUrl;\n\t\t\t\tif (providerConfig.discoveryUrl) {\n\t\t\t\t\tconst discovery = await betterFetch(providerConfig.discoveryUrl, {\n\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\theaders: providerConfig.discoveryHeaders\n\t\t\t\t\t});\n\t\t\t\t\tif (discovery.data) {\n\t\t\t\t\t\tfinalTokenUrl = discovery.data.token_endpoint;\n\t\t\t\t\t\tfinalUserInfoUrl = discovery.data.userinfo_endpoint;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ttry {\n\t\t\t\t\tif (providerConfig.getToken) tokens = await providerConfig.getToken({\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tredirectURI: `${ctx.context.baseURL}/oauth2/callback/${providerConfig.providerId}`,\n\t\t\t\t\t\tcodeVerifier: providerConfig.pkce ? codeVerifier : void 0\n\t\t\t\t\t});\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (!finalTokenUrl) throw new APIError(\"BAD_REQUEST\", { message: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIG });\n\t\t\t\t\t\tconst additionalParams = typeof providerConfig.tokenUrlParams === \"function\" ? providerConfig.tokenUrlParams(ctx) : providerConfig.tokenUrlParams;\n\t\t\t\t\t\ttokens = await validateAuthorizationCode({\n\t\t\t\t\t\t\theaders: providerConfig.authorizationHeaders,\n\t\t\t\t\t\t\tcode,\n\t\t\t\t\t\t\tcodeVerifier: providerConfig.pkce ? codeVerifier : void 0,\n\t\t\t\t\t\t\tredirectURI: `${ctx.context.baseURL}/oauth2/callback/${providerConfig.providerId}`,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tclientId: providerConfig.clientId,\n\t\t\t\t\t\t\t\tclientSecret: providerConfig.clientSecret,\n\t\t\t\t\t\t\t\tredirectURI: providerConfig.redirectURI\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttokenEndpoint: finalTokenUrl,\n\t\t\t\t\t\t\tauthentication: providerConfig.authentication,\n\t\t\t\t\t\t\tadditionalParams\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tctx.context.logger.error(e && typeof e === \"object\" && \"name\" in e ? e.name : \"\", e);\n\t\t\t\t\tthrow redirectOnError(\"oauth_code_verification_failed\");\n\t\t\t\t}\n\t\t\t\tif (!tokens) throw new APIError(\"BAD_REQUEST\", { message: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIG });\n\t\t\t\tconst userInfo = await (async function handleUserInfo() {\n\t\t\t\t\tconst userInfo$1 = providerConfig.getUserInfo ? await providerConfig.getUserInfo(tokens) : await getUserInfo(tokens, finalUserInfoUrl);\n\t\t\t\t\tif (!userInfo$1) throw redirectOnError(\"user_info_is_missing\");\n\t\t\t\t\tconst mapUser = providerConfig.mapProfileToUser ? await providerConfig.mapProfileToUser(userInfo$1) : userInfo$1;\n\t\t\t\t\tconst email = mapUser.email ? mapUser.email.toLowerCase() : userInfo$1.email?.toLowerCase();\n\t\t\t\t\tif (!email) {\n\t\t\t\t\t\tctx.context.logger.error(\"Unable to get user info\", userInfo$1);\n\t\t\t\t\t\tthrow redirectOnError(\"email_is_missing\");\n\t\t\t\t\t}\n\t\t\t\t\tconst id = mapUser.id ? String(mapUser.id) : String(userInfo$1.id);\n\t\t\t\t\tconst name = mapUser.name ? mapUser.name : userInfo$1.name;\n\t\t\t\t\tif (!name) {\n\t\t\t\t\t\tctx.context.logger.error(\"Unable to get user info\", userInfo$1);\n\t\t\t\t\t\tthrow redirectOnError(\"name_is_missing\");\n\t\t\t\t\t}\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...userInfo$1,\n\t\t\t\t\t\t...mapUser,\n\t\t\t\t\t\temail,\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tname\n\t\t\t\t\t};\n\t\t\t\t})();\n\t\t\t\tif (link) {\n\t\t\t\t\tif (ctx.context.options.account?.accountLinking?.allowDifferentEmails !== true && link.email !== userInfo.email) return redirectOnError(\"email_doesn't_match\");\n\t\t\t\t\tconst existingAccount = await ctx.context.internalAdapter.findAccountByProviderId(String(userInfo.id), providerConfig.providerId);\n\t\t\t\t\tif (existingAccount) {\n\t\t\t\t\t\tif (existingAccount.userId !== link.userId) return redirectOnError(\"account_already_linked_to_different_user\");\n\t\t\t\t\t\tconst updateData = Object.fromEntries(Object.entries({\n\t\t\t\t\t\t\taccessToken: tokens.accessToken,\n\t\t\t\t\t\t\tidToken: tokens.idToken,\n\t\t\t\t\t\t\trefreshToken: tokens.refreshToken,\n\t\t\t\t\t\t\taccessTokenExpiresAt: tokens.accessTokenExpiresAt,\n\t\t\t\t\t\t\trefreshTokenExpiresAt: tokens.refreshTokenExpiresAt,\n\t\t\t\t\t\t\tscope: tokens.scopes?.join(\",\")\n\t\t\t\t\t\t}).filter(([_, value]) => value !== void 0));\n\t\t\t\t\t\tawait ctx.context.internalAdapter.updateAccount(existingAccount.id, updateData);\n\t\t\t\t\t} else if (!await ctx.context.internalAdapter.createAccount({\n\t\t\t\t\t\tuserId: link.userId,\n\t\t\t\t\t\tproviderId: providerConfig.providerId,\n\t\t\t\t\t\taccountId: userInfo.id,\n\t\t\t\t\t\taccessToken: tokens.accessToken,\n\t\t\t\t\t\taccessTokenExpiresAt: tokens.accessTokenExpiresAt,\n\t\t\t\t\t\trefreshTokenExpiresAt: tokens.refreshTokenExpiresAt,\n\t\t\t\t\t\tscope: tokens.scopes?.join(\",\"),\n\t\t\t\t\t\trefreshToken: tokens.refreshToken,\n\t\t\t\t\t\tidToken: tokens.idToken\n\t\t\t\t\t})) return redirectOnError(\"unable_to_link_account\");\n\t\t\t\t\tlet toRedirectTo$1;\n\t\t\t\t\ttry {\n\t\t\t\t\t\ttoRedirectTo$1 = callbackURL.toString();\n\t\t\t\t\t} catch {\n\t\t\t\t\t\ttoRedirectTo$1 = callbackURL;\n\t\t\t\t\t}\n\t\t\t\t\tthrow ctx.redirect(toRedirectTo$1);\n\t\t\t\t}\n\t\t\t\tconst result = await handleOAuthUserInfo(ctx, {\n\t\t\t\t\tuserInfo,\n\t\t\t\t\taccount: {\n\t\t\t\t\t\tproviderId: providerConfig.providerId,\n\t\t\t\t\t\taccountId: userInfo.id,\n\t\t\t\t\t\t...tokens,\n\t\t\t\t\t\tscope: tokens.scopes?.join(\",\")\n\t\t\t\t\t},\n\t\t\t\t\tcallbackURL,\n\t\t\t\t\tdisableSignUp: providerConfig.disableImplicitSignUp && !requestSignUp || providerConfig.disableSignUp,\n\t\t\t\t\toverrideUserInfo: providerConfig.overrideUserInfo\n\t\t\t\t});\n\t\t\t\tif (result.error) return redirectOnError(result.error.split(\" \").join(\"_\"));\n\t\t\t\tconst { session, user } = result.data;\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser\n\t\t\t\t});\n\t\t\t\tlet toRedirectTo;\n\t\t\t\ttry {\n\t\t\t\t\ttoRedirectTo = (result.isRegister ? newUserURL || callbackURL : callbackURL).toString();\n\t\t\t\t} catch {\n\t\t\t\t\ttoRedirectTo = result.isRegister ? newUserURL || callbackURL : callbackURL;\n\t\t\t\t}\n\t\t\t\tthrow ctx.redirect(toRedirectTo);\n\t\t\t}),\n\t\t\toAuth2LinkAccount: createAuthEndpoint(\"/oauth2/link\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tproviderId: z.string(),\n\t\t\t\t\tcallbackURL: z.string(),\n\t\t\t\t\tscopes: z.array(z.string()).meta({ description: \"Additional scopes to request when linking the account\" }).optional(),\n\t\t\t\t\terrorCallbackURL: z.string().meta({ description: \"The URL to redirect to if there is an error during the link process\" }).optional()\n\t\t\t\t}),\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Link an OAuth2 account to the current user session\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"Authorization URL generated successfully for linking an OAuth2 account\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\turl: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\tdescription: \"The authorization URL to redirect the user to for linking the OAuth2 account\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tredirect: {\n\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\tdescription: \"Indicates that the client should redirect to the provided URL\",\n\t\t\t\t\t\t\t\t\tenum: [true]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\"url\", \"redirect\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (c) => {\n\t\t\t\tconst session = c.context.session;\n\t\t\t\tif (!session) throw new APIError(\"UNAUTHORIZED\", { message: GENERIC_OAUTH_ERROR_CODES.SESSION_REQUIRED });\n\t\t\t\tconst provider = options.config.find((p) => p.providerId === c.body.providerId);\n\t\t\t\tif (!provider) throw new APIError(\"NOT_FOUND\", { message: BASE_ERROR_CODES.PROVIDER_NOT_FOUND });\n\t\t\t\tconst { providerId, clientId, clientSecret, redirectURI, authorizationUrl, discoveryUrl, pkce, scopes, prompt, accessType, authorizationUrlParams } = provider;\n\t\t\t\tlet finalAuthUrl = authorizationUrl;\n\t\t\t\tif (!finalAuthUrl) {\n\t\t\t\t\tif (!discoveryUrl) throw new APIError(\"BAD_REQUEST\", { message: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIGURATION });\n\t\t\t\t\tconst discovery = await betterFetch(discoveryUrl, {\n\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\theaders: provider.discoveryHeaders,\n\t\t\t\t\t\tonError(context) {\n\t\t\t\t\t\t\tc.context.logger.error(context.error.message, context.error, { discoveryUrl });\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (discovery.data) finalAuthUrl = discovery.data.authorization_endpoint;\n\t\t\t\t}\n\t\t\t\tif (!finalAuthUrl) throw new APIError(\"BAD_REQUEST\", { message: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIGURATION });\n\t\t\t\tconst state = await generateState(c, {\n\t\t\t\t\tuserId: session.user.id,\n\t\t\t\t\temail: session.user.email\n\t\t\t\t}, void 0);\n\t\t\t\tconst additionalParams = typeof authorizationUrlParams === \"function\" ? authorizationUrlParams(c) : authorizationUrlParams;\n\t\t\t\tconst url = await createAuthorizationURL({\n\t\t\t\t\tid: providerId,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tclientId,\n\t\t\t\t\t\tclientSecret,\n\t\t\t\t\t\tredirectURI: redirectURI || `${c.context.baseURL}/oauth2/callback/${providerId}`\n\t\t\t\t\t},\n\t\t\t\t\tauthorizationEndpoint: finalAuthUrl,\n\t\t\t\t\tstate: state.state,\n\t\t\t\t\tcodeVerifier: pkce ? state.codeVerifier : void 0,\n\t\t\t\t\tscopes: c.body.scopes || scopes || [],\n\t\t\t\t\tredirectURI: redirectURI || `${c.context.baseURL}/oauth2/callback/${providerId}`,\n\t\t\t\t\tprompt,\n\t\t\t\t\taccessType,\n\t\t\t\t\tadditionalParams\n\t\t\t\t});\n\t\t\t\treturn c.json({\n\t\t\t\t\turl: url.toString(),\n\t\t\t\t\tredirect: true\n\t\t\t\t});\n\t\t\t})\n\t\t},\n\t\t$ERROR_CODES: GENERIC_OAUTH_ERROR_CODES\n\t};\n};\n\n//#endregion\nexport { line as a, auth0 as c, microsoftEntraId as i, slack as n, keycloak as o, okta as r, hubspot as s, genericOAuth as t };","import { Column } from \"../../column.js\";\nimport { is } from \"../../entity.js\";\nimport { Table } from \"../../table.js\";\nimport {\n  isDriverValueEncoder,\n  isSQLWrapper,\n  Param,\n  Placeholder,\n  SQL,\n  sql,\n  StringChunk,\n  View\n} from \"../sql.js\";\nfunction bindIfParam(value, column) {\n  if (isDriverValueEncoder(column) && !isSQLWrapper(value) && !is(value, Param) && !is(value, Placeholder) && !is(value, Column) && !is(value, Table) && !is(value, View)) {\n    return new Param(value, column);\n  }\n  return value;\n}\nconst eq = (left, right) => {\n  return sql`${left} = ${bindIfParam(right, left)}`;\n};\nconst ne = (left, right) => {\n  return sql`${left} <> ${bindIfParam(right, left)}`;\n};\nfunction and(...unfilteredConditions) {\n  const conditions = unfilteredConditions.filter(\n    (c) => c !== void 0\n  );\n  if (conditions.length === 0) {\n    return void 0;\n  }\n  if (conditions.length === 1) {\n    return new SQL(conditions);\n  }\n  return new SQL([\n    new StringChunk(\"(\"),\n    sql.join(conditions, new StringChunk(\" and \")),\n    new StringChunk(\")\")\n  ]);\n}\nfunction or(...unfilteredConditions) {\n  const conditions = unfilteredConditions.filter(\n    (c) => c !== void 0\n  );\n  if (conditions.length === 0) {\n    return void 0;\n  }\n  if (conditions.length === 1) {\n    return new SQL(conditions);\n  }\n  return new SQL([\n    new StringChunk(\"(\"),\n    sql.join(conditions, new StringChunk(\" or \")),\n    new StringChunk(\")\")\n  ]);\n}\nfunction not(condition) {\n  return sql`not ${condition}`;\n}\nconst gt = (left, right) => {\n  return sql`${left} > ${bindIfParam(right, left)}`;\n};\nconst gte = (left, right) => {\n  return sql`${left} >= ${bindIfParam(right, left)}`;\n};\nconst lt = (left, right) => {\n  return sql`${left} < ${bindIfParam(right, left)}`;\n};\nconst lte = (left, right) => {\n  return sql`${left} <= ${bindIfParam(right, left)}`;\n};\nfunction inArray(column, values) {\n  if (Array.isArray(values)) {\n    if (values.length === 0) {\n      return sql`false`;\n    }\n    return sql`${column} in ${values.map((v) => bindIfParam(v, column))}`;\n  }\n  return sql`${column} in ${bindIfParam(values, column)}`;\n}\nfunction notInArray(column, values) {\n  if (Array.isArray(values)) {\n    if (values.length === 0) {\n      return sql`true`;\n    }\n    return sql`${column} not in ${values.map((v) => bindIfParam(v, column))}`;\n  }\n  return sql`${column} not in ${bindIfParam(values, column)}`;\n}\nfunction isNull(value) {\n  return sql`${value} is null`;\n}\nfunction isNotNull(value) {\n  return sql`${value} is not null`;\n}\nfunction exists(subquery) {\n  return sql`exists ${subquery}`;\n}\nfunction notExists(subquery) {\n  return sql`not exists ${subquery}`;\n}\nfunction between(column, min, max) {\n  return sql`${column} between ${bindIfParam(min, column)} and ${bindIfParam(\n    max,\n    column\n  )}`;\n}\nfunction notBetween(column, min, max) {\n  return sql`${column} not between ${bindIfParam(\n    min,\n    column\n  )} and ${bindIfParam(max, column)}`;\n}\nfunction like(column, value) {\n  return sql`${column} like ${value}`;\n}\nfunction notLike(column, value) {\n  return sql`${column} not like ${value}`;\n}\nfunction ilike(column, value) {\n  return sql`${column} ilike ${value}`;\n}\nfunction notIlike(column, value) {\n  return sql`${column} not ilike ${value}`;\n}\nfunction arrayContains(column, values) {\n  if (Array.isArray(values)) {\n    if (values.length === 0) {\n      throw new Error(\"arrayContains requires at least one value\");\n    }\n    const array = sql`${bindIfParam(values, column)}`;\n    return sql`${column} @> ${array}`;\n  }\n  return sql`${column} @> ${bindIfParam(values, column)}`;\n}\nfunction arrayContained(column, values) {\n  if (Array.isArray(values)) {\n    if (values.length === 0) {\n      throw new Error(\"arrayContained requires at least one value\");\n    }\n    const array = sql`${bindIfParam(values, column)}`;\n    return sql`${column} <@ ${array}`;\n  }\n  return sql`${column} <@ ${bindIfParam(values, column)}`;\n}\nfunction arrayOverlaps(column, values) {\n  if (Array.isArray(values)) {\n    if (values.length === 0) {\n      throw new Error(\"arrayOverlaps requires at least one value\");\n    }\n    const array = sql`${bindIfParam(values, column)}`;\n    return sql`${column} && ${array}`;\n  }\n  return sql`${column} && ${bindIfParam(values, column)}`;\n}\nexport {\n  and,\n  arrayContained,\n  arrayContains,\n  arrayOverlaps,\n  between,\n  bindIfParam,\n  eq,\n  exists,\n  gt,\n  gte,\n  ilike,\n  inArray,\n  isNotNull,\n  isNull,\n  like,\n  lt,\n  lte,\n  ne,\n  not,\n  notBetween,\n  notExists,\n  notIlike,\n  notInArray,\n  notLike,\n  or\n};\n//# sourceMappingURL=conditions.js.map","import { i as parseState, n as HIDE_METADATA, r as generateState, t as generateId } from \"./utils-db7gNqd-.mjs\";\nimport { n as symmetricEncrypt, o as signJWT, r as generateRandomString, t as symmetricDecrypt } from \"./crypto-CFUhAR9W.mjs\";\nimport { c as parseUserInput, l as parseUserOutput, u as getDate } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as getIp } from \"./get-request-ip-D6st-mto.mjs\";\nimport { t as safeJSONParse } from \"./json-CnHxKYpj.mjs\";\nimport { i as getProtocol, n as getHost, r as getOrigin } from \"./url-CB8xCwz-.mjs\";\nimport { c as setSessionCookie, f as getAccountCookie, h as setAccountCookie, n as deleteSessionCookie } from \"./cookies-D72PbWdz.mjs\";\nimport { c as revokeSessions, i as listSessions, l as sensitiveSessionMiddleware, n as getSession, o as revokeOtherSessions, r as getSessionFromCtx, s as revokeSession, t as freshSessionMiddleware, u as sessionMiddleware } from \"./session-AaRl3_x-.mjs\";\nimport { hasRequestState, runWithEndpointContext, runWithRequestState, runWithTransaction } from \"@better-auth/core/context\";\nimport { isDevelopment, isProduction, logger, shouldPublishLog } from \"@better-auth/core/env\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { APIError, APIError as APIError$1, createRouter, toResponse } from \"better-call\";\nimport * as z from \"zod\";\nimport { jwtVerify } from \"jose\";\nimport { SocialProviderListEnum } from \"@better-auth/core/social-providers\";\nimport { createDefu } from \"defu\";\nimport { createAuthEndpoint, createAuthEndpoint as createAuthEndpoint$1, createAuthMiddleware, createAuthMiddleware as createAuthMiddleware$1, optionsMiddleware } from \"@better-auth/core/api\";\nimport { JWTExpired } from \"jose/errors\";\n\n//#region src/utils/wildcard.ts\n/**\n* Escapes a character if it has a special meaning in regular expressions\n* and returns the character as is if it doesn't\n*/\nfunction escapeRegExpChar(char) {\n\tif (char === \"-\" || char === \"^\" || char === \"$\" || char === \"+\" || char === \".\" || char === \"(\" || char === \")\" || char === \"|\" || char === \"[\" || char === \"]\" || char === \"{\" || char === \"}\" || char === \"*\" || char === \"?\" || char === \"\\\\\") return `\\\\${char}`;\n\telse return char;\n}\n/**\n* Escapes all characters in a given string that have a special meaning in regular expressions\n*/\nfunction escapeRegExpString(str) {\n\tlet result = \"\";\n\tfor (let i = 0; i < str.length; i++) result += escapeRegExpChar(str[i]);\n\treturn result;\n}\n/**\n* Transforms one or more glob patterns into a RegExp pattern\n*/\nfunction transform(pattern, separator = true) {\n\tif (Array.isArray(pattern)) return `(?:${pattern.map((p) => `^${transform(p, separator)}$`).join(\"|\")})`;\n\tlet separatorSplitter = \"\";\n\tlet separatorMatcher = \"\";\n\tlet wildcard = \".\";\n\tif (separator === true) {\n\t\tseparatorSplitter = \"/\";\n\t\tseparatorMatcher = \"[/\\\\\\\\]\";\n\t\twildcard = \"[^/\\\\\\\\]\";\n\t} else if (separator) {\n\t\tseparatorSplitter = separator;\n\t\tseparatorMatcher = escapeRegExpString(separatorSplitter);\n\t\tif (separatorMatcher.length > 1) {\n\t\t\tseparatorMatcher = `(?:${separatorMatcher})`;\n\t\t\twildcard = `((?!${separatorMatcher}).)`;\n\t\t} else wildcard = `[^${separatorMatcher}]`;\n\t}\n\tlet requiredSeparator = separator ? `${separatorMatcher}+?` : \"\";\n\tlet optionalSeparator = separator ? `${separatorMatcher}*?` : \"\";\n\tlet segments = separator ? pattern.split(separatorSplitter) : [pattern];\n\tlet result = \"\";\n\tfor (let s = 0; s < segments.length; s++) {\n\t\tlet segment = segments[s];\n\t\tlet nextSegment = segments[s + 1];\n\t\tlet currentSeparator = \"\";\n\t\tif (!segment && s > 0) continue;\n\t\tif (separator) if (s === segments.length - 1) currentSeparator = optionalSeparator;\n\t\telse if (nextSegment !== \"**\") currentSeparator = requiredSeparator;\n\t\telse currentSeparator = \"\";\n\t\tif (separator && segment === \"**\") {\n\t\t\tif (currentSeparator) {\n\t\t\t\tresult += s === 0 ? \"\" : currentSeparator;\n\t\t\t\tresult += `(?:${wildcard}*?${currentSeparator})*?`;\n\t\t\t}\n\t\t\tcontinue;\n\t\t}\n\t\tfor (let c = 0; c < segment.length; c++) {\n\t\t\tlet char = segment[c];\n\t\t\tif (char === \"\\\\\") {\n\t\t\t\tif (c < segment.length - 1) {\n\t\t\t\t\tresult += escapeRegExpChar(segment[c + 1]);\n\t\t\t\t\tc++;\n\t\t\t\t}\n\t\t\t} else if (char === \"?\") result += wildcard;\n\t\t\telse if (char === \"*\") result += `${wildcard}*?`;\n\t\t\telse result += escapeRegExpChar(char);\n\t\t}\n\t\tresult += currentSeparator;\n\t}\n\treturn result;\n}\nfunction isMatch(regexp, sample) {\n\tif (typeof sample !== \"string\") throw new TypeError(`Sample must be a string, but ${typeof sample} given`);\n\treturn regexp.test(sample);\n}\n/**\n* Compiles one or more glob patterns into a RegExp and returns an isMatch function.\n* The isMatch function takes a sample string as its only argument and returns `true`\n* if the string matches the pattern(s).\n*\n* ```js\n* wildcardMatch('src/*.js')('src/index.js') //=> true\n* ```\n*\n* ```js\n* const isMatch = wildcardMatch('*.example.com', '.')\n* isMatch('foo.example.com') //=> true\n* isMatch('foo.bar.com') //=> false\n* ```\n*/\nfunction wildcardMatch(pattern, options) {\n\tif (typeof pattern !== \"string\" && !Array.isArray(pattern)) throw new TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof pattern} given`);\n\tif (typeof options === \"string\" || typeof options === \"boolean\") options = { separator: options };\n\tif (arguments.length === 2 && !(typeof options === \"undefined\" || typeof options === \"object\" && options !== null && !Array.isArray(options))) throw new TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof options} given`);\n\toptions = options || {};\n\tif (options.separator === \"\\\\\") throw new Error(\"\\\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead\");\n\tlet regexpPattern = transform(pattern, options.separator);\n\tlet regexp = new RegExp(`^${regexpPattern}$`, options.flags);\n\tlet fn = isMatch.bind(null, regexp);\n\tfn.options = options;\n\tfn.pattern = pattern;\n\tfn.regexp = regexp;\n\treturn fn;\n}\n\n//#endregion\n//#region src/api/middlewares/origin-check.ts\n/**\n* A middleware to validate callbackURL and origin against\n* trustedOrigins.\n*/\nconst originCheckMiddleware = createAuthMiddleware(async (ctx) => {\n\tif (ctx.request?.method === \"GET\" || ctx.request?.method === \"OPTIONS\" || ctx.request?.method === \"HEAD\" || !ctx.request) return;\n\tconst headers = ctx.request?.headers;\n\tconst request = ctx.request;\n\tconst { body, query, context } = ctx;\n\tconst originHeader = headers?.get(\"origin\") || headers?.get(\"referer\") || \"\";\n\tconst callbackURL = body?.callbackURL || query?.callbackURL;\n\tconst redirectURL = body?.redirectTo;\n\tconst errorCallbackURL = body?.errorCallbackURL;\n\tconst newUserCallbackURL = body?.newUserCallbackURL;\n\tconst trustedOrigins = Array.isArray(context.options.trustedOrigins) ? context.trustedOrigins : [...context.trustedOrigins, ...await context.options.trustedOrigins?.(request) || []];\n\tconst useCookies = headers?.has(\"cookie\");\n\tconst matchesPattern = (url, pattern) => {\n\t\tif (url.startsWith(\"/\")) return false;\n\t\tif (pattern.includes(\"*\")) {\n\t\t\tif (pattern.includes(\"://\")) return wildcardMatch(pattern)(getOrigin(url) || url);\n\t\t\tconst host = getHost(url);\n\t\t\tif (!host) return false;\n\t\t\treturn wildcardMatch(pattern)(host);\n\t\t}\n\t\tconst protocol = getProtocol(url);\n\t\treturn protocol === \"http:\" || protocol === \"https:\" || !protocol ? pattern === getOrigin(url) : url.startsWith(pattern);\n\t};\n\tconst validateURL = (url, label) => {\n\t\tif (!url) return;\n\t\tif (!trustedOrigins.some((origin) => matchesPattern(url, origin) || url?.startsWith(\"/\") && label !== \"origin\" && /^\\/(?!\\/|\\\\|%2f|%5c)[\\w\\-.\\+/@]*(?:\\?[\\w\\-.\\+/=&%@]*)?$/.test(url))) {\n\t\t\tctx.context.logger.error(`Invalid ${label}: ${url}`);\n\t\t\tctx.context.logger.info(`If it's a valid URL, please add ${url} to trustedOrigins in your auth config\\n`, `Current list of trustedOrigins: ${trustedOrigins}`);\n\t\t\tthrow new APIError(\"FORBIDDEN\", { message: `Invalid ${label}` });\n\t\t}\n\t};\n\tif (useCookies && !ctx.context.skipCSRFCheck && !ctx.context.skipOriginCheck) {\n\t\tif (!originHeader || originHeader === \"null\") throw new APIError(\"FORBIDDEN\", { message: \"Missing or null Origin\" });\n\t\tvalidateURL(originHeader, \"origin\");\n\t}\n\tcallbackURL && validateURL(callbackURL, \"callbackURL\");\n\tredirectURL && validateURL(redirectURL, \"redirectURL\");\n\terrorCallbackURL && validateURL(errorCallbackURL, \"errorCallbackURL\");\n\tnewUserCallbackURL && validateURL(newUserCallbackURL, \"newUserCallbackURL\");\n});\nconst originCheck = (getValue) => createAuthMiddleware(async (ctx) => {\n\tif (!ctx.request) return;\n\tconst { context } = ctx;\n\tconst callbackURL = getValue(ctx);\n\tconst trustedOrigins = Array.isArray(context.options.trustedOrigins) ? context.trustedOrigins : [...context.trustedOrigins, ...await context.options.trustedOrigins?.(ctx.request) || []];\n\tconst matchesPattern = (url, pattern) => {\n\t\tif (url.startsWith(\"/\")) return false;\n\t\tif (pattern.includes(\"*\")) {\n\t\t\tif (pattern.includes(\"://\")) return wildcardMatch(pattern)(getOrigin(url) || url);\n\t\t\tconst host = getHost(url);\n\t\t\tif (!host) return false;\n\t\t\treturn wildcardMatch(pattern)(host);\n\t\t}\n\t\tconst protocol = getProtocol(url);\n\t\treturn protocol === \"http:\" || protocol === \"https:\" || !protocol ? pattern === getOrigin(url) : url.startsWith(pattern);\n\t};\n\tconst validateURL = (url, label) => {\n\t\tif (!url) return;\n\t\tif (!trustedOrigins.some((origin) => matchesPattern(url, origin) || url?.startsWith(\"/\") && label !== \"origin\" && /^\\/(?!\\/|\\\\|%2f|%5c)[\\w\\-.\\+/@]*(?:\\?[\\w\\-.\\+/=&%@]*)?$/.test(url))) {\n\t\t\tctx.context.logger.error(`Invalid ${label}: ${url}`);\n\t\t\tctx.context.logger.info(`If it's a valid URL, please add ${url} to trustedOrigins in your auth config\\n`, `Current list of trustedOrigins: ${trustedOrigins}`);\n\t\t\tthrow new APIError(\"FORBIDDEN\", { message: `Invalid ${label}` });\n\t\t}\n\t};\n\tconst callbacks = Array.isArray(callbackURL) ? callbackURL : [callbackURL];\n\tfor (const url of callbacks) validateURL(url, \"callbackURL\");\n});\n\n//#endregion\n//#region src/api/rate-limiter/index.ts\nfunction shouldRateLimit(max, window, rateLimitData) {\n\tconst now = Date.now();\n\tconst windowInMs = window * 1e3;\n\treturn now - rateLimitData.lastRequest < windowInMs && rateLimitData.count >= max;\n}\nfunction rateLimitResponse(retryAfter) {\n\treturn new Response(JSON.stringify({ message: \"Too many requests. Please try again later.\" }), {\n\t\tstatus: 429,\n\t\tstatusText: \"Too Many Requests\",\n\t\theaders: { \"X-Retry-After\": retryAfter.toString() }\n\t});\n}\nfunction getRetryAfter(lastRequest, window) {\n\tconst now = Date.now();\n\tconst windowInMs = window * 1e3;\n\treturn Math.ceil((lastRequest + windowInMs - now) / 1e3);\n}\nfunction createDBStorage(ctx) {\n\tconst model = \"rateLimit\";\n\tconst db = ctx.adapter;\n\treturn {\n\t\tget: async (key) => {\n\t\t\tconst data = (await db.findMany({\n\t\t\t\tmodel,\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"key\",\n\t\t\t\t\tvalue: key\n\t\t\t\t}]\n\t\t\t}))[0];\n\t\t\tif (typeof data?.lastRequest === \"bigint\") data.lastRequest = Number(data.lastRequest);\n\t\t\treturn data;\n\t\t},\n\t\tset: async (key, value, _update) => {\n\t\t\ttry {\n\t\t\t\tif (_update) await db.updateMany({\n\t\t\t\t\tmodel,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"key\",\n\t\t\t\t\t\tvalue: key\n\t\t\t\t\t}],\n\t\t\t\t\tupdate: {\n\t\t\t\t\t\tcount: value.count,\n\t\t\t\t\t\tlastRequest: value.lastRequest\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\telse await db.create({\n\t\t\t\t\tmodel,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tkey,\n\t\t\t\t\t\tcount: value.count,\n\t\t\t\t\t\tlastRequest: value.lastRequest\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tctx.logger.error(\"Error setting rate limit\", e);\n\t\t\t}\n\t\t}\n\t};\n}\nconst memory = /* @__PURE__ */ new Map();\nfunction getRateLimitStorage(ctx, rateLimitSettings) {\n\tif (ctx.options.rateLimit?.customStorage) return ctx.options.rateLimit.customStorage;\n\tconst storage = ctx.rateLimit.storage;\n\tif (storage === \"secondary-storage\") return {\n\t\tget: async (key) => {\n\t\t\tconst data = await ctx.options.secondaryStorage?.get(key);\n\t\t\treturn data ? safeJSONParse(data) : void 0;\n\t\t},\n\t\tset: async (key, value, _update) => {\n\t\t\tconst ttl = rateLimitSettings?.window ?? ctx.options.rateLimit?.window ?? 10;\n\t\t\tawait ctx.options.secondaryStorage?.set?.(key, JSON.stringify(value), ttl);\n\t\t}\n\t};\n\telse if (storage === \"memory\") return {\n\t\tasync get(key) {\n\t\t\treturn memory.get(key);\n\t\t},\n\t\tasync set(key, value, _update) {\n\t\t\tmemory.set(key, value);\n\t\t}\n\t};\n\treturn createDBStorage(ctx);\n}\nasync function onRequestRateLimit(req, ctx) {\n\tif (!ctx.rateLimit.enabled) return;\n\tconst path = new URL(req.url).pathname.replace(ctx.options.basePath || \"/api/auth\", \"\");\n\tlet window = ctx.rateLimit.window;\n\tlet max = ctx.rateLimit.max;\n\tconst ip = getIp(req, ctx.options);\n\tif (!ip) return;\n\tconst key = ip + path;\n\tconst specialRule = getDefaultSpecialRules().find((rule) => rule.pathMatcher(path));\n\tif (specialRule) {\n\t\twindow = specialRule.window;\n\t\tmax = specialRule.max;\n\t}\n\tfor (const plugin of ctx.options.plugins || []) if (plugin.rateLimit) {\n\t\tconst matchedRule = plugin.rateLimit.find((rule) => rule.pathMatcher(path));\n\t\tif (matchedRule) {\n\t\t\twindow = matchedRule.window;\n\t\t\tmax = matchedRule.max;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (ctx.rateLimit.customRules) {\n\t\tconst _path = Object.keys(ctx.rateLimit.customRules).find((p) => {\n\t\t\tif (p.includes(\"*\")) return wildcardMatch(p)(path);\n\t\t\treturn p === path;\n\t\t});\n\t\tif (_path) {\n\t\t\tconst customRule = ctx.rateLimit.customRules[_path];\n\t\t\tconst resolved = typeof customRule === \"function\" ? await customRule(req) : customRule;\n\t\t\tif (resolved) {\n\t\t\t\twindow = resolved.window;\n\t\t\t\tmax = resolved.max;\n\t\t\t}\n\t\t\tif (resolved === false) return;\n\t\t}\n\t}\n\tconst storage = getRateLimitStorage(ctx, { window });\n\tconst data = await storage.get(key);\n\tconst now = Date.now();\n\tif (!data) await storage.set(key, {\n\t\tkey,\n\t\tcount: 1,\n\t\tlastRequest: now\n\t});\n\telse {\n\t\tconst timeSinceLastRequest = now - data.lastRequest;\n\t\tif (shouldRateLimit(max, window, data)) return rateLimitResponse(getRetryAfter(data.lastRequest, window));\n\t\telse if (timeSinceLastRequest > window * 1e3) await storage.set(key, {\n\t\t\t...data,\n\t\t\tcount: 1,\n\t\t\tlastRequest: now\n\t\t}, true);\n\t\telse await storage.set(key, {\n\t\t\t...data,\n\t\t\tcount: data.count + 1,\n\t\t\tlastRequest: now\n\t\t}, true);\n\t}\n}\nfunction getDefaultSpecialRules() {\n\treturn [{\n\t\tpathMatcher(path) {\n\t\t\treturn path.startsWith(\"/sign-in\") || path.startsWith(\"/sign-up\") || path.startsWith(\"/change-password\") || path.startsWith(\"/change-email\");\n\t\t},\n\t\twindow: 10,\n\t\tmax: 3\n\t}];\n}\n\n//#endregion\n//#region src/oauth2/utils.ts\nfunction decryptOAuthToken(token, ctx) {\n\tif (!token) return token;\n\tif (ctx.options.account?.encryptOAuthTokens) return symmetricDecrypt({\n\t\tkey: ctx.secret,\n\t\tdata: token\n\t});\n\treturn token;\n}\nfunction setTokenUtil(token, ctx) {\n\tif (ctx.options.account?.encryptOAuthTokens && token) return symmetricEncrypt({\n\t\tkey: ctx.secret,\n\t\tdata: token\n\t});\n\treturn token;\n}\n\n//#endregion\n//#region src/api/routes/account.ts\nconst listUserAccounts = createAuthEndpoint(\"/list-accounts\", {\n\tmethod: \"GET\",\n\tuse: [sessionMiddleware],\n\tmetadata: { openapi: {\n\t\toperationId: \"listUserAccounts\",\n\t\tdescription: \"List all accounts linked to the user\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"array\",\n\t\t\t\titems: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tid: { type: \"string\" },\n\t\t\t\t\t\tproviderId: { type: \"string\" },\n\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\taccountId: { type: \"string\" },\n\t\t\t\t\t\tuserId: { type: \"string\" },\n\t\t\t\t\t\tscopes: {\n\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\titems: { type: \"string\" }\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\trequired: [\n\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\"providerId\",\n\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\"updatedAt\",\n\t\t\t\t\t\t\"accountId\",\n\t\t\t\t\t\t\"userId\",\n\t\t\t\t\t\t\"scopes\"\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (c) => {\n\tconst session = c.context.session;\n\tconst accounts = await c.context.internalAdapter.findAccounts(session.user.id);\n\treturn c.json(accounts.map((a) => ({\n\t\tid: a.id,\n\t\tproviderId: a.providerId,\n\t\tcreatedAt: a.createdAt,\n\t\tupdatedAt: a.updatedAt,\n\t\taccountId: a.accountId,\n\t\tuserId: a.userId,\n\t\tscopes: a.scope?.split(\",\") || []\n\t})));\n});\nconst linkSocialAccount = createAuthEndpoint(\"/link-social\", {\n\tmethod: \"POST\",\n\trequireHeaders: true,\n\tbody: z.object({\n\t\tcallbackURL: z.string().meta({ description: \"The URL to redirect to after the user has signed in\" }).optional(),\n\t\tprovider: SocialProviderListEnum,\n\t\tidToken: z.object({\n\t\t\ttoken: z.string(),\n\t\t\tnonce: z.string().optional(),\n\t\t\taccessToken: z.string().optional(),\n\t\t\trefreshToken: z.string().optional(),\n\t\t\tscopes: z.array(z.string()).optional()\n\t\t}).optional(),\n\t\trequestSignUp: z.boolean().optional(),\n\t\tscopes: z.array(z.string()).meta({ description: \"Additional scopes to request from the provider\" }).optional(),\n\t\terrorCallbackURL: z.string().meta({ description: \"The URL to redirect to if there is an error during the link process\" }).optional(),\n\t\tdisableRedirect: z.boolean().meta({ description: \"Disable automatic redirection to the provider. Useful for handling the redirection yourself\" }).optional(),\n\t\tadditionalData: z.record(z.string(), z.any()).optional()\n\t}),\n\tuse: [sessionMiddleware],\n\tmetadata: { openapi: {\n\t\tdescription: \"Link a social account to the user\",\n\t\toperationId: \"linkSocialAccount\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: {\n\t\t\t\t\turl: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tdescription: \"The authorization URL to redirect the user to\"\n\t\t\t\t\t},\n\t\t\t\t\tredirect: {\n\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\tdescription: \"Indicates if the user should be redirected to the authorization URL\"\n\t\t\t\t\t},\n\t\t\t\t\tstatus: { type: \"boolean\" }\n\t\t\t\t},\n\t\t\t\trequired: [\"redirect\"]\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (c) => {\n\tconst session = c.context.session;\n\tconst provider = c.context.socialProviders.find((p) => p.id === c.body.provider);\n\tif (!provider) {\n\t\tc.context.logger.error(\"Provider not found. Make sure to add the provider in your auth config\", { provider: c.body.provider });\n\t\tthrow new APIError(\"NOT_FOUND\", { message: BASE_ERROR_CODES.PROVIDER_NOT_FOUND });\n\t}\n\tif (c.body.idToken) {\n\t\tif (!provider.verifyIdToken) {\n\t\t\tc.context.logger.error(\"Provider does not support id token verification\", { provider: c.body.provider });\n\t\t\tthrow new APIError(\"NOT_FOUND\", { message: BASE_ERROR_CODES.ID_TOKEN_NOT_SUPPORTED });\n\t\t}\n\t\tconst { token, nonce } = c.body.idToken;\n\t\tif (!await provider.verifyIdToken(token, nonce)) {\n\t\t\tc.context.logger.error(\"Invalid id token\", { provider: c.body.provider });\n\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: BASE_ERROR_CODES.INVALID_TOKEN });\n\t\t}\n\t\tconst linkingUserInfo = await provider.getUserInfo({\n\t\t\tidToken: token,\n\t\t\taccessToken: c.body.idToken.accessToken,\n\t\t\trefreshToken: c.body.idToken.refreshToken\n\t\t});\n\t\tif (!linkingUserInfo || !linkingUserInfo?.user) {\n\t\t\tc.context.logger.error(\"Failed to get user info\", { provider: c.body.provider });\n\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: BASE_ERROR_CODES.FAILED_TO_GET_USER_INFO });\n\t\t}\n\t\tconst linkingUserId = String(linkingUserInfo.user.id);\n\t\tif (!linkingUserInfo.user.email) {\n\t\t\tc.context.logger.error(\"User email not found\", { provider: c.body.provider });\n\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: BASE_ERROR_CODES.USER_EMAIL_NOT_FOUND });\n\t\t}\n\t\tif ((await c.context.internalAdapter.findAccounts(session.user.id)).find((a) => a.providerId === provider.id && a.accountId === linkingUserId)) return c.json({\n\t\t\turl: \"\",\n\t\t\tstatus: true,\n\t\t\tredirect: false\n\t\t});\n\t\tif (!(c.context.options.account?.accountLinking?.trustedProviders)?.includes(provider.id) && !linkingUserInfo.user.emailVerified || c.context.options.account?.accountLinking?.enabled === false) throw new APIError(\"UNAUTHORIZED\", { message: \"Account not linked - linking not allowed\" });\n\t\tif (linkingUserInfo.user.email !== session.user.email && c.context.options.account?.accountLinking?.allowDifferentEmails !== true) throw new APIError(\"UNAUTHORIZED\", { message: \"Account not linked - different emails not allowed\" });\n\t\ttry {\n\t\t\tawait c.context.internalAdapter.createAccount({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\tproviderId: provider.id,\n\t\t\t\taccountId: linkingUserId,\n\t\t\t\taccessToken: c.body.idToken.accessToken,\n\t\t\t\tidToken: token,\n\t\t\t\trefreshToken: c.body.idToken.refreshToken,\n\t\t\t\tscope: c.body.idToken.scopes?.join(\",\")\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tthrow new APIError(\"EXPECTATION_FAILED\", { message: \"Account not linked - unable to create account\" });\n\t\t}\n\t\tif (c.context.options.account?.accountLinking?.updateUserInfoOnLink === true) try {\n\t\t\tawait c.context.internalAdapter.updateUser(session.user.id, {\n\t\t\t\tname: linkingUserInfo.user?.name,\n\t\t\t\timage: linkingUserInfo.user?.image\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tconsole.warn(\"Could not update user - \" + e.toString());\n\t\t}\n\t\treturn c.json({\n\t\t\turl: \"\",\n\t\t\tstatus: true,\n\t\t\tredirect: false\n\t\t});\n\t}\n\tconst state = await generateState(c, {\n\t\tuserId: session.user.id,\n\t\temail: session.user.email\n\t}, c.body.additionalData);\n\tconst url = await provider.createAuthorizationURL({\n\t\tstate: state.state,\n\t\tcodeVerifier: state.codeVerifier,\n\t\tredirectURI: `${c.context.baseURL}/callback/${provider.id}`,\n\t\tscopes: c.body.scopes\n\t});\n\treturn c.json({\n\t\turl: url.toString(),\n\t\tredirect: !c.body.disableRedirect\n\t});\n});\nconst unlinkAccount = createAuthEndpoint(\"/unlink-account\", {\n\tmethod: \"POST\",\n\tbody: z.object({\n\t\tproviderId: z.string(),\n\t\taccountId: z.string().optional()\n\t}),\n\tuse: [freshSessionMiddleware],\n\tmetadata: { openapi: {\n\t\tdescription: \"Unlink an account\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { status: { type: \"boolean\" } }\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tconst { providerId, accountId } = ctx.body;\n\tconst accounts = await ctx.context.internalAdapter.findAccounts(ctx.context.session.user.id);\n\tif (accounts.length === 1 && !ctx.context.options.account?.accountLinking?.allowUnlinkingAll) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.FAILED_TO_UNLINK_LAST_ACCOUNT });\n\tconst accountExist = accounts.find((account) => accountId ? account.accountId === accountId && account.providerId === providerId : account.providerId === providerId);\n\tif (!accountExist) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.ACCOUNT_NOT_FOUND });\n\tawait ctx.context.internalAdapter.deleteAccount(accountExist.id);\n\treturn ctx.json({ status: true });\n});\nconst getAccessToken = createAuthEndpoint(\"/get-access-token\", {\n\tmethod: \"POST\",\n\tbody: z.object({\n\t\tproviderId: z.string().meta({ description: \"The provider ID for the OAuth provider\" }),\n\t\taccountId: z.string().meta({ description: \"The account ID associated with the refresh token\" }).optional(),\n\t\tuserId: z.string().meta({ description: \"The user ID associated with the account\" }).optional()\n\t}),\n\tmetadata: { openapi: {\n\t\tdescription: \"Get a valid access token, doing a refresh if needed\",\n\t\tresponses: {\n\t\t\t200: {\n\t\t\t\tdescription: \"A Valid access token\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\ttokenType: { type: \"string\" },\n\t\t\t\t\t\tidToken: { type: \"string\" },\n\t\t\t\t\t\taccessToken: { type: \"string\" },\n\t\t\t\t\t\trefreshToken: { type: \"string\" },\n\t\t\t\t\t\taccessTokenExpiresAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trefreshTokenExpiresAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} } }\n\t\t\t},\n\t\t\t400: { description: \"Invalid refresh token or provider configuration\" }\n\t\t}\n\t} }\n}, async (ctx) => {\n\tconst { providerId, accountId, userId } = ctx.body || {};\n\tconst req = ctx.request;\n\tconst session = await getSessionFromCtx(ctx);\n\tif (req && !session) throw ctx.error(\"UNAUTHORIZED\");\n\tlet resolvedUserId = session?.user?.id || userId;\n\tif (!resolvedUserId) throw ctx.error(\"UNAUTHORIZED\");\n\tif (!ctx.context.socialProviders.find((p) => p.id === providerId)) throw new APIError(\"BAD_REQUEST\", { message: `Provider ${providerId} is not supported.` });\n\tconst accountData = await getAccountCookie(ctx);\n\tlet account = void 0;\n\tif (accountData && providerId === accountData.providerId && (!accountId || accountData.id === accountId)) account = accountData;\n\telse account = (await ctx.context.internalAdapter.findAccounts(resolvedUserId)).find((acc) => accountId ? acc.id === accountId && acc.providerId === providerId : acc.providerId === providerId);\n\tif (!account) throw new APIError(\"BAD_REQUEST\", { message: \"Account not found\" });\n\tconst provider = ctx.context.socialProviders.find((p) => p.id === providerId);\n\tif (!provider) throw new APIError(\"BAD_REQUEST\", { message: `Provider ${providerId} not found.` });\n\ttry {\n\t\tlet newTokens = null;\n\t\tconst accessTokenExpired = account.accessTokenExpiresAt && new Date(account.accessTokenExpiresAt).getTime() - Date.now() < 5e3;\n\t\tif (account.refreshToken && accessTokenExpired && provider.refreshAccessToken) {\n\t\t\tconst refreshToken$1 = await decryptOAuthToken(account.refreshToken, ctx.context);\n\t\t\tnewTokens = await provider.refreshAccessToken(refreshToken$1);\n\t\t\tconst updatedAccount = await ctx.context.internalAdapter.updateAccount(account.id, {\n\t\t\t\taccessToken: await setTokenUtil(newTokens.accessToken, ctx.context),\n\t\t\t\taccessTokenExpiresAt: newTokens.accessTokenExpiresAt,\n\t\t\t\trefreshToken: await setTokenUtil(newTokens.refreshToken, ctx.context),\n\t\t\t\trefreshTokenExpiresAt: newTokens.refreshTokenExpiresAt\n\t\t\t});\n\t\t\tif (ctx.context.options.account?.storeAccountCookie && updatedAccount) await setAccountCookie(ctx, updatedAccount);\n\t\t}\n\t\tconst tokens = {\n\t\t\taccessToken: newTokens?.accessToken ?? await decryptOAuthToken(account.accessToken ?? \"\", ctx.context),\n\t\t\taccessTokenExpiresAt: newTokens?.accessTokenExpiresAt ?? account.accessTokenExpiresAt ?? void 0,\n\t\t\tscopes: account.scope?.split(\",\") ?? [],\n\t\t\tidToken: newTokens?.idToken ?? account.idToken ?? void 0\n\t\t};\n\t\treturn ctx.json(tokens);\n\t} catch (error$1) {\n\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\tmessage: \"Failed to get a valid access token\",\n\t\t\tcause: error$1\n\t\t});\n\t}\n});\nconst refreshToken = createAuthEndpoint(\"/refresh-token\", {\n\tmethod: \"POST\",\n\tbody: z.object({\n\t\tproviderId: z.string().meta({ description: \"The provider ID for the OAuth provider\" }),\n\t\taccountId: z.string().meta({ description: \"The account ID associated with the refresh token\" }).optional(),\n\t\tuserId: z.string().meta({ description: \"The user ID associated with the account\" }).optional()\n\t}),\n\tmetadata: { openapi: {\n\t\tdescription: \"Refresh the access token using a refresh token\",\n\t\tresponses: {\n\t\t\t200: {\n\t\t\t\tdescription: \"Access token refreshed successfully\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\ttokenType: { type: \"string\" },\n\t\t\t\t\t\tidToken: { type: \"string\" },\n\t\t\t\t\t\taccessToken: { type: \"string\" },\n\t\t\t\t\t\trefreshToken: { type: \"string\" },\n\t\t\t\t\t\taccessTokenExpiresAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trefreshTokenExpiresAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} } }\n\t\t\t},\n\t\t\t400: { description: \"Invalid refresh token or provider configuration\" }\n\t\t}\n\t} }\n}, async (ctx) => {\n\tconst { providerId, accountId, userId } = ctx.body;\n\tconst req = ctx.request;\n\tconst session = await getSessionFromCtx(ctx);\n\tif (req && !session) throw ctx.error(\"UNAUTHORIZED\");\n\tlet resolvedUserId = session?.user?.id || userId;\n\tif (!resolvedUserId) throw new APIError(\"BAD_REQUEST\", { message: `Either userId or session is required` });\n\tconst provider = ctx.context.socialProviders.find((p) => p.id === providerId);\n\tif (!provider) throw new APIError(\"BAD_REQUEST\", { message: `Provider ${providerId} not found.` });\n\tif (!provider.refreshAccessToken) throw new APIError(\"BAD_REQUEST\", { message: `Provider ${providerId} does not support token refreshing.` });\n\tlet account = void 0;\n\tconst accountData = await getAccountCookie(ctx);\n\tif (accountData && (!providerId || providerId === accountData?.providerId)) account = accountData;\n\telse account = (await ctx.context.internalAdapter.findAccounts(resolvedUserId)).find((acc) => accountId ? acc.id === accountId && acc.providerId === providerId : acc.providerId === providerId);\n\tif (!account) throw new APIError(\"BAD_REQUEST\", { message: \"Account not found\" });\n\tlet refreshToken$1 = void 0;\n\tif (accountData && providerId === accountData.providerId) refreshToken$1 = accountData.refreshToken ?? void 0;\n\telse refreshToken$1 = account.refreshToken ?? void 0;\n\tif (!refreshToken$1) throw new APIError(\"BAD_REQUEST\", { message: \"Refresh token not found\" });\n\ttry {\n\t\tconst decryptedRefreshToken = await decryptOAuthToken(refreshToken$1, ctx.context);\n\t\tconst tokens = await provider.refreshAccessToken(decryptedRefreshToken);\n\t\tif (account.id) {\n\t\t\tconst updateData = {\n\t\t\t\t...account || {},\n\t\t\t\taccessToken: await setTokenUtil(tokens.accessToken, ctx.context),\n\t\t\t\trefreshToken: await setTokenUtil(tokens.refreshToken, ctx.context),\n\t\t\t\taccessTokenExpiresAt: tokens.accessTokenExpiresAt,\n\t\t\t\trefreshTokenExpiresAt: tokens.refreshTokenExpiresAt,\n\t\t\t\tscope: tokens.scopes?.join(\",\") || account.scope,\n\t\t\t\tidToken: tokens.idToken || account.idToken\n\t\t\t};\n\t\t\tawait ctx.context.internalAdapter.updateAccount(account.id, updateData);\n\t\t}\n\t\tif (accountData && providerId === accountData.providerId && ctx.context.options.account?.storeAccountCookie) await setAccountCookie(ctx, {\n\t\t\t...accountData,\n\t\t\taccessToken: await setTokenUtil(tokens.accessToken, ctx.context),\n\t\t\trefreshToken: await setTokenUtil(tokens.refreshToken, ctx.context),\n\t\t\taccessTokenExpiresAt: tokens.accessTokenExpiresAt,\n\t\t\trefreshTokenExpiresAt: tokens.refreshTokenExpiresAt,\n\t\t\tscope: tokens.scopes?.join(\",\") || accountData.scope,\n\t\t\tidToken: tokens.idToken || accountData.idToken\n\t\t});\n\t\treturn ctx.json({\n\t\t\taccessToken: tokens.accessToken,\n\t\t\trefreshToken: tokens.refreshToken,\n\t\t\taccessTokenExpiresAt: tokens.accessTokenExpiresAt,\n\t\t\trefreshTokenExpiresAt: tokens.refreshTokenExpiresAt,\n\t\t\tscope: tokens.scopes?.join(\",\") || account.scope,\n\t\t\tidToken: tokens.idToken || account.idToken,\n\t\t\tproviderId: account.providerId,\n\t\t\taccountId: account.accountId\n\t\t});\n\t} catch (error$1) {\n\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\tmessage: \"Failed to refresh access token\",\n\t\t\tcause: error$1\n\t\t});\n\t}\n});\nconst accountInfoQuerySchema = z.optional(z.object({ accountId: z.string().meta({ description: \"The provider given account id for which to get the account info\" }).optional() }));\nconst accountInfo = createAuthEndpoint(\"/account-info\", {\n\tmethod: \"GET\",\n\tuse: [sessionMiddleware],\n\tmetadata: { openapi: {\n\t\tdescription: \"Get the account info provided by the provider\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: {\n\t\t\t\t\tuser: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tid: { type: \"string\" },\n\t\t\t\t\t\t\tname: { type: \"string\" },\n\t\t\t\t\t\t\temail: { type: \"string\" },\n\t\t\t\t\t\t\timage: { type: \"string\" },\n\t\t\t\t\t\t\temailVerified: { type: \"boolean\" }\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequired: [\"id\", \"emailVerified\"]\n\t\t\t\t\t},\n\t\t\t\t\tdata: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {},\n\t\t\t\t\t\tadditionalProperties: true\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\trequired: [\"user\", \"data\"],\n\t\t\t\tadditionalProperties: false\n\t\t\t} } }\n\t\t} }\n\t} },\n\tquery: accountInfoQuerySchema\n}, async (ctx) => {\n\tconst providedAccountId = ctx.query?.accountId;\n\tlet account = void 0;\n\tif (!providedAccountId) {\n\t\tif (ctx.context.options.account?.storeAccountCookie) {\n\t\t\tconst accountData = await getAccountCookie(ctx);\n\t\t\tif (accountData) account = accountData;\n\t\t}\n\t} else {\n\t\tconst accountData = await ctx.context.internalAdapter.findAccount(providedAccountId);\n\t\tif (accountData) account = accountData;\n\t}\n\tif (!account || account.userId !== ctx.context.session.user.id) throw new APIError(\"BAD_REQUEST\", { message: \"Account not found\" });\n\tconst provider = ctx.context.socialProviders.find((p) => p.id === account.providerId);\n\tif (!provider) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: `Provider account provider is ${account.providerId} but it is not configured` });\n\tconst tokens = await getAccessToken({\n\t\t...ctx,\n\t\tmethod: \"POST\",\n\t\tbody: {\n\t\t\taccountId: account.id,\n\t\t\tproviderId: account.providerId\n\t\t},\n\t\treturnHeaders: false,\n\t\treturnStatus: false\n\t});\n\tif (!tokens.accessToken) throw new APIError(\"BAD_REQUEST\", { message: \"Access token not found\" });\n\tconst info = await provider.getUserInfo({\n\t\t...tokens,\n\t\taccessToken: tokens.accessToken\n\t});\n\treturn ctx.json(info);\n});\n\n//#endregion\n//#region src/oauth2/link-account.ts\nasync function handleOAuthUserInfo(c, { userInfo, account, callbackURL, disableSignUp, overrideUserInfo }) {\n\tconst dbUser = await c.context.internalAdapter.findOAuthUser(userInfo.email.toLowerCase(), account.accountId, account.providerId).catch((e) => {\n\t\tlogger.error(\"Better auth was unable to query your database.\\nError: \", e);\n\t\tconst errorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;\n\t\tthrow c.redirect(`${errorURL}?error=internal_server_error`);\n\t});\n\tlet user = dbUser?.user;\n\tlet isRegister = !user;\n\tif (dbUser) {\n\t\tconst hasBeenLinked = dbUser.accounts.find((a) => a.providerId === account.providerId && a.accountId === account.accountId);\n\t\tif (!hasBeenLinked) {\n\t\t\tif (!(c.context.options.account?.accountLinking?.trustedProviders)?.includes(account.providerId) && !userInfo.emailVerified || c.context.options.account?.accountLinking?.enabled === false) {\n\t\t\t\tif (isDevelopment()) logger.warn(`User already exist but account isn't linked to ${account.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`);\n\t\t\t\treturn {\n\t\t\t\t\terror: \"account not linked\",\n\t\t\t\t\tdata: null\n\t\t\t\t};\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tawait c.context.internalAdapter.linkAccount({\n\t\t\t\t\tproviderId: account.providerId,\n\t\t\t\t\taccountId: userInfo.id.toString(),\n\t\t\t\t\tuserId: dbUser.user.id,\n\t\t\t\t\taccessToken: await setTokenUtil(account.accessToken, c.context),\n\t\t\t\t\trefreshToken: await setTokenUtil(account.refreshToken, c.context),\n\t\t\t\t\tidToken: account.idToken,\n\t\t\t\t\taccessTokenExpiresAt: account.accessTokenExpiresAt,\n\t\t\t\t\trefreshTokenExpiresAt: account.refreshTokenExpiresAt,\n\t\t\t\t\tscope: account.scope\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tlogger.error(\"Unable to link account\", e);\n\t\t\t\treturn {\n\t\t\t\t\terror: \"unable to link account\",\n\t\t\t\t\tdata: null\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (userInfo.emailVerified && !dbUser.user.emailVerified && userInfo.email.toLowerCase() === dbUser.user.email) await c.context.internalAdapter.updateUser(dbUser.user.id, { emailVerified: true });\n\t\t} else {\n\t\t\tif (c.context.options.account?.updateAccountOnSignIn !== false) {\n\t\t\t\tconst updateData = Object.fromEntries(Object.entries({\n\t\t\t\t\tidToken: account.idToken,\n\t\t\t\t\taccessToken: await setTokenUtil(account.accessToken, c.context),\n\t\t\t\t\trefreshToken: await setTokenUtil(account.refreshToken, c.context),\n\t\t\t\t\taccessTokenExpiresAt: account.accessTokenExpiresAt,\n\t\t\t\t\trefreshTokenExpiresAt: account.refreshTokenExpiresAt,\n\t\t\t\t\tscope: account.scope\n\t\t\t\t}).filter(([_, value]) => value !== void 0));\n\t\t\t\tif (c.context.options.account?.storeAccountCookie) await setAccountCookie(c, updateData);\n\t\t\t\tif (Object.keys(updateData).length > 0) await c.context.internalAdapter.updateAccount(hasBeenLinked.id, updateData);\n\t\t\t}\n\t\t\tif (userInfo.emailVerified && !dbUser.user.emailVerified && userInfo.email.toLowerCase() === dbUser.user.email) await c.context.internalAdapter.updateUser(dbUser.user.id, { emailVerified: true });\n\t\t}\n\t\tif (overrideUserInfo) {\n\t\t\tconst { id: _, ...restUserInfo } = userInfo;\n\t\t\tuser = await c.context.internalAdapter.updateUser(dbUser.user.id, {\n\t\t\t\t...restUserInfo,\n\t\t\t\temail: userInfo.email.toLowerCase(),\n\t\t\t\temailVerified: userInfo.email.toLowerCase() === dbUser.user.email ? dbUser.user.emailVerified || userInfo.emailVerified : userInfo.emailVerified\n\t\t\t});\n\t\t}\n\t} else {\n\t\tif (disableSignUp) return {\n\t\t\terror: \"signup disabled\",\n\t\t\tdata: null,\n\t\t\tisRegister: false\n\t\t};\n\t\ttry {\n\t\t\tconst { id: _, ...restUserInfo } = userInfo;\n\t\t\tconst accountData = {\n\t\t\t\taccessToken: await setTokenUtil(account.accessToken, c.context),\n\t\t\t\trefreshToken: await setTokenUtil(account.refreshToken, c.context),\n\t\t\t\tidToken: account.idToken,\n\t\t\t\taccessTokenExpiresAt: account.accessTokenExpiresAt,\n\t\t\t\trefreshTokenExpiresAt: account.refreshTokenExpiresAt,\n\t\t\t\tscope: account.scope,\n\t\t\t\tproviderId: account.providerId,\n\t\t\t\taccountId: userInfo.id.toString()\n\t\t\t};\n\t\t\tconst { user: createdUser, account: createdAccount } = await c.context.internalAdapter.createOAuthUser({\n\t\t\t\t...restUserInfo,\n\t\t\t\temail: userInfo.email.toLowerCase()\n\t\t\t}, accountData);\n\t\t\tuser = createdUser;\n\t\t\tif (c.context.options.account?.storeAccountCookie) await setAccountCookie(c, createdAccount);\n\t\t\tif (!userInfo.emailVerified && user && c.context.options.emailVerification?.sendOnSignUp) {\n\t\t\t\tconst token = await createEmailVerificationToken(c.context.secret, user.email, void 0, c.context.options.emailVerification?.expiresIn);\n\t\t\t\tconst url = `${c.context.baseURL}/verify-email?token=${token}&callbackURL=${callbackURL}`;\n\t\t\t\tawait c.context.options.emailVerification?.sendVerificationEmail?.({\n\t\t\t\t\tuser,\n\t\t\t\t\turl,\n\t\t\t\t\ttoken\n\t\t\t\t}, c.request);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tlogger.error(e);\n\t\t\tif (e instanceof APIError$1) return {\n\t\t\t\terror: e.message,\n\t\t\t\tdata: null,\n\t\t\t\tisRegister: false\n\t\t\t};\n\t\t\treturn {\n\t\t\t\terror: \"unable to create user\",\n\t\t\t\tdata: null,\n\t\t\t\tisRegister: false\n\t\t\t};\n\t\t}\n\t}\n\tif (!user) return {\n\t\terror: \"unable to create user\",\n\t\tdata: null,\n\t\tisRegister: false\n\t};\n\tconst session = await c.context.internalAdapter.createSession(user.id);\n\tif (!session) return {\n\t\terror: \"unable to create session\",\n\t\tdata: null,\n\t\tisRegister: false\n\t};\n\treturn {\n\t\tdata: {\n\t\t\tsession,\n\t\t\tuser\n\t\t},\n\t\terror: null,\n\t\tisRegister\n\t};\n}\n\n//#endregion\n//#region src/api/routes/callback.ts\nconst schema = z.object({\n\tcode: z.string().optional(),\n\terror: z.string().optional(),\n\tdevice_id: z.string().optional(),\n\terror_description: z.string().optional(),\n\tstate: z.string().optional(),\n\tuser: z.string().optional()\n});\nconst callbackOAuth = createAuthEndpoint(\"/callback/:id\", {\n\tmethod: [\"GET\", \"POST\"],\n\toperationId: \"handleOAuthCallback\",\n\tbody: schema.optional(),\n\tquery: schema.optional(),\n\tmetadata: {\n\t\t...HIDE_METADATA,\n\t\tallowedMediaTypes: [\"application/x-www-form-urlencoded\", \"application/json\"]\n\t}\n}, async (c) => {\n\tlet queryOrBody;\n\tconst defaultErrorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;\n\tif (c.method === \"POST\") {\n\t\tconst postData = c.body ? schema.parse(c.body) : {};\n\t\tconst queryData = c.query ? schema.parse(c.query) : {};\n\t\tconst mergedData = schema.parse({\n\t\t\t...postData,\n\t\t\t...queryData\n\t\t});\n\t\tconst params = new URLSearchParams();\n\t\tfor (const [key, value] of Object.entries(mergedData)) if (value !== void 0 && value !== null) params.set(key, String(value));\n\t\tconst redirectURL = `${c.context.baseURL}/callback/${c.params.id}?${params.toString()}`;\n\t\tthrow c.redirect(redirectURL);\n\t}\n\ttry {\n\t\tif (c.method === \"GET\") queryOrBody = schema.parse(c.query);\n\t\telse if (c.method === \"POST\") queryOrBody = schema.parse(c.body);\n\t\telse throw new Error(\"Unsupported method\");\n\t} catch (e) {\n\t\tc.context.logger.error(\"INVALID_CALLBACK_REQUEST\", e);\n\t\tthrow c.redirect(`${defaultErrorURL}?error=invalid_callback_request`);\n\t}\n\tconst { code, error: error$1, state, error_description, device_id } = queryOrBody;\n\tif (!state) {\n\t\tc.context.logger.error(\"State not found\", error$1);\n\t\tconst url = `${defaultErrorURL}${defaultErrorURL.includes(\"?\") ? \"&\" : \"?\"}state=state_not_found`;\n\t\tthrow c.redirect(url);\n\t}\n\tconst { codeVerifier, callbackURL, link, errorURL, newUserURL, requestSignUp } = await parseState(c);\n\tfunction redirectOnError(error$2, description) {\n\t\tconst baseURL = errorURL ?? defaultErrorURL;\n\t\tconst params = new URLSearchParams({ error: error$2 });\n\t\tif (description) params.set(\"error_description\", description);\n\t\tconst url = `${baseURL}${baseURL.includes(\"?\") ? \"&\" : \"?\"}${params.toString()}`;\n\t\tthrow c.redirect(url);\n\t}\n\tif (error$1) redirectOnError(error$1, error_description);\n\tif (!code) {\n\t\tc.context.logger.error(\"Code not found\");\n\t\tthrow redirectOnError(\"no_code\");\n\t}\n\tconst provider = c.context.socialProviders.find((p) => p.id === c.params.id);\n\tif (!provider) {\n\t\tc.context.logger.error(\"Oauth provider with id\", c.params.id, \"not found\");\n\t\tthrow redirectOnError(\"oauth_provider_not_found\");\n\t}\n\tlet tokens;\n\ttry {\n\t\ttokens = await provider.validateAuthorizationCode({\n\t\t\tcode,\n\t\t\tcodeVerifier,\n\t\t\tdeviceId: device_id,\n\t\t\tredirectURI: `${c.context.baseURL}/callback/${provider.id}`\n\t\t});\n\t} catch (e) {\n\t\tc.context.logger.error(\"\", e);\n\t\tthrow redirectOnError(\"invalid_code\");\n\t}\n\tconst userInfo = await provider.getUserInfo({\n\t\t...tokens,\n\t\tuser: c.body?.user ? safeJSONParse(c.body.user) : void 0\n\t}).then((res) => res?.user);\n\tif (!userInfo) {\n\t\tc.context.logger.error(\"Unable to get user info\");\n\t\treturn redirectOnError(\"unable_to_get_user_info\");\n\t}\n\tif (!callbackURL) {\n\t\tc.context.logger.error(\"No callback URL found\");\n\t\tthrow redirectOnError(\"no_callback_url\");\n\t}\n\tif (link) {\n\t\tif (!(c.context.options.account?.accountLinking?.trustedProviders)?.includes(provider.id) && !userInfo.emailVerified || c.context.options.account?.accountLinking?.enabled === false) {\n\t\t\tc.context.logger.error(\"Unable to link account - untrusted provider\");\n\t\t\treturn redirectOnError(\"unable_to_link_account\");\n\t\t}\n\t\tif (userInfo.email !== link.email && c.context.options.account?.accountLinking?.allowDifferentEmails !== true) return redirectOnError(\"email_doesn't_match\");\n\t\tconst existingAccount = await c.context.internalAdapter.findAccount(String(userInfo.id));\n\t\tif (existingAccount) {\n\t\t\tif (existingAccount.userId.toString() !== link.userId.toString()) return redirectOnError(\"account_already_linked_to_different_user\");\n\t\t\tconst updateData = Object.fromEntries(Object.entries({\n\t\t\t\taccessToken: await setTokenUtil(tokens.accessToken, c.context),\n\t\t\t\trefreshToken: await setTokenUtil(tokens.refreshToken, c.context),\n\t\t\t\tidToken: tokens.idToken,\n\t\t\t\taccessTokenExpiresAt: tokens.accessTokenExpiresAt,\n\t\t\t\trefreshTokenExpiresAt: tokens.refreshTokenExpiresAt,\n\t\t\t\tscope: tokens.scopes?.join(\",\")\n\t\t\t}).filter(([_, value]) => value !== void 0));\n\t\t\tawait c.context.internalAdapter.updateAccount(existingAccount.id, updateData);\n\t\t} else if (!await c.context.internalAdapter.createAccount({\n\t\t\tuserId: link.userId,\n\t\t\tproviderId: provider.id,\n\t\t\taccountId: String(userInfo.id),\n\t\t\t...tokens,\n\t\t\taccessToken: await setTokenUtil(tokens.accessToken, c.context),\n\t\t\trefreshToken: await setTokenUtil(tokens.refreshToken, c.context),\n\t\t\tscope: tokens.scopes?.join(\",\")\n\t\t})) return redirectOnError(\"unable_to_link_account\");\n\t\tlet toRedirectTo$1;\n\t\ttry {\n\t\t\ttoRedirectTo$1 = callbackURL.toString();\n\t\t} catch {\n\t\t\ttoRedirectTo$1 = callbackURL;\n\t\t}\n\t\tthrow c.redirect(toRedirectTo$1);\n\t}\n\tif (!userInfo.email) {\n\t\tc.context.logger.error(\"Provider did not return email. This could be due to misconfiguration in the provider settings.\");\n\t\treturn redirectOnError(\"email_not_found\");\n\t}\n\tconst accountData = {\n\t\tproviderId: provider.id,\n\t\taccountId: String(userInfo.id),\n\t\t...tokens,\n\t\tscope: tokens.scopes?.join(\",\")\n\t};\n\tconst result = await handleOAuthUserInfo(c, {\n\t\tuserInfo: {\n\t\t\t...userInfo,\n\t\t\tid: String(userInfo.id),\n\t\t\temail: userInfo.email,\n\t\t\tname: userInfo.name || userInfo.email\n\t\t},\n\t\taccount: accountData,\n\t\tcallbackURL,\n\t\tdisableSignUp: provider.disableImplicitSignUp && !requestSignUp || provider.options?.disableSignUp,\n\t\toverrideUserInfo: provider.options?.overrideUserInfoOnSignIn\n\t});\n\tif (result.error) {\n\t\tc.context.logger.error(result.error.split(\" \").join(\"_\"));\n\t\treturn redirectOnError(result.error.split(\" \").join(\"_\"));\n\t}\n\tconst { session, user } = result.data;\n\tawait setSessionCookie(c, {\n\t\tsession,\n\t\tuser\n\t});\n\tlet toRedirectTo;\n\ttry {\n\t\ttoRedirectTo = (result.isRegister ? newUserURL || callbackURL : callbackURL).toString();\n\t} catch {\n\t\ttoRedirectTo = result.isRegister ? newUserURL || callbackURL : callbackURL;\n\t}\n\tthrow c.redirect(toRedirectTo);\n});\n\n//#endregion\n//#region src/api/routes/email-verification.ts\nasync function createEmailVerificationToken(secret, email, updateTo, expiresIn = 3600, extraPayload) {\n\treturn await signJWT({\n\t\temail: email.toLowerCase(),\n\t\tupdateTo,\n\t\t...extraPayload\n\t}, secret, expiresIn);\n}\n/**\n* A function to send a verification email to the user\n*/\nasync function sendVerificationEmailFn(ctx, user) {\n\tif (!ctx.context.options.emailVerification?.sendVerificationEmail) {\n\t\tctx.context.logger.error(\"Verification email isn't enabled.\");\n\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"Verification email isn't enabled\" });\n\t}\n\tconst token = await createEmailVerificationToken(ctx.context.secret, user.email, void 0, ctx.context.options.emailVerification?.expiresIn);\n\tconst callbackURL = ctx.body.callbackURL ? encodeURIComponent(ctx.body.callbackURL) : encodeURIComponent(\"/\");\n\tconst url = `${ctx.context.baseURL}/verify-email?token=${token}&callbackURL=${callbackURL}`;\n\tawait ctx.context.options.emailVerification.sendVerificationEmail({\n\t\tuser,\n\t\turl,\n\t\ttoken\n\t}, ctx.request);\n}\nconst sendVerificationEmail = createAuthEndpoint(\"/send-verification-email\", {\n\tmethod: \"POST\",\n\toperationId: \"sendVerificationEmail\",\n\tbody: z.object({\n\t\temail: z.email().meta({ description: \"The email to send the verification email to\" }),\n\t\tcallbackURL: z.string().meta({ description: \"The URL to use for email verification callback\" }).optional()\n\t}),\n\tmetadata: { openapi: {\n\t\toperationId: \"sendVerificationEmail\",\n\t\tdescription: \"Send a verification email to the user\",\n\t\trequestBody: { content: { \"application/json\": { schema: {\n\t\t\ttype: \"object\",\n\t\t\tproperties: {\n\t\t\t\temail: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\tdescription: \"The email to send the verification email to\",\n\t\t\t\t\texample: \"user@example.com\"\n\t\t\t\t},\n\t\t\t\tcallbackURL: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\tdescription: \"The URL to use for email verification callback\",\n\t\t\t\t\texample: \"https://example.com/callback\",\n\t\t\t\t\tnullable: true\n\t\t\t\t}\n\t\t\t},\n\t\t\trequired: [\"email\"]\n\t\t} } } },\n\t\tresponses: {\n\t\t\t\"200\": {\n\t\t\t\tdescription: \"Success\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: { status: {\n\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\tdescription: \"Indicates if the email was sent successfully\",\n\t\t\t\t\t\texample: true\n\t\t\t\t\t} }\n\t\t\t\t} } }\n\t\t\t},\n\t\t\t\"400\": {\n\t\t\t\tdescription: \"Bad Request\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: { message: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tdescription: \"Error message\",\n\t\t\t\t\t\texample: \"Verification email isn't enabled\"\n\t\t\t\t\t} }\n\t\t\t\t} } }\n\t\t\t}\n\t\t}\n\t} }\n}, async (ctx) => {\n\tif (!ctx.context.options.emailVerification?.sendVerificationEmail) {\n\t\tctx.context.logger.error(\"Verification email isn't enabled.\");\n\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"Verification email isn't enabled\" });\n\t}\n\tconst { email } = ctx.body;\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session) {\n\t\tconst user = await ctx.context.internalAdapter.findUserByEmail(email);\n\t\tif (!user) {\n\t\t\tawait createEmailVerificationToken(ctx.context.secret, email, void 0, ctx.context.options.emailVerification?.expiresIn);\n\t\t\treturn ctx.json({ status: true });\n\t\t}\n\t\tawait sendVerificationEmailFn(ctx, user.user);\n\t\treturn ctx.json({ status: true });\n\t}\n\tif (session?.user.emailVerified) throw new APIError(\"BAD_REQUEST\", { message: \"You can only send a verification email to an unverified email\" });\n\tif (session?.user.email !== email) throw new APIError(\"BAD_REQUEST\", { message: \"You can only send a verification email to your own email\" });\n\tawait sendVerificationEmailFn(ctx, session.user);\n\treturn ctx.json({ status: true });\n});\nconst verifyEmail = createAuthEndpoint(\"/verify-email\", {\n\tmethod: \"GET\",\n\toperationId: \"verifyEmail\",\n\tquery: z.object({\n\t\ttoken: z.string().meta({ description: \"The token to verify the email\" }),\n\t\tcallbackURL: z.string().meta({ description: \"The URL to redirect to after email verification\" }).optional()\n\t}),\n\tuse: [originCheck((ctx) => ctx.query.callbackURL)],\n\tmetadata: { openapi: {\n\t\tdescription: \"Verify the email of the user\",\n\t\tparameters: [{\n\t\t\tname: \"token\",\n\t\t\tin: \"query\",\n\t\t\tdescription: \"The token to verify the email\",\n\t\t\trequired: true,\n\t\t\tschema: { type: \"string\" }\n\t\t}, {\n\t\t\tname: \"callbackURL\",\n\t\t\tin: \"query\",\n\t\t\tdescription: \"The URL to redirect to after email verification\",\n\t\t\trequired: false,\n\t\t\tschema: { type: \"string\" }\n\t\t}],\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: {\n\t\t\t\t\tuser: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t$ref: \"#/components/schemas/User\"\n\t\t\t\t\t},\n\t\t\t\t\tstatus: {\n\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\tdescription: \"Indicates if the email was verified successfully\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\trequired: [\"user\", \"status\"]\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tfunction redirectOnError(error$1) {\n\t\tif (ctx.query.callbackURL) {\n\t\t\tif (ctx.query.callbackURL.includes(\"?\")) throw ctx.redirect(`${ctx.query.callbackURL}&error=${error$1}`);\n\t\t\tthrow ctx.redirect(`${ctx.query.callbackURL}?error=${error$1}`);\n\t\t}\n\t\tthrow new APIError(\"UNAUTHORIZED\", { message: error$1 });\n\t}\n\tconst { token } = ctx.query;\n\tlet jwt;\n\ttry {\n\t\tjwt = await jwtVerify(token, new TextEncoder().encode(ctx.context.secret), { algorithms: [\"HS256\"] });\n\t} catch (e) {\n\t\tif (e instanceof JWTExpired) return redirectOnError(\"token_expired\");\n\t\treturn redirectOnError(\"invalid_token\");\n\t}\n\tconst parsed = z.object({\n\t\temail: z.email(),\n\t\tupdateTo: z.string().optional(),\n\t\trequestType: z.string().optional()\n\t}).parse(jwt.payload);\n\tconst user = await ctx.context.internalAdapter.findUserByEmail(parsed.email);\n\tif (!user) return redirectOnError(\"user_not_found\");\n\tif (parsed.updateTo) {\n\t\tlet session = await getSessionFromCtx(ctx);\n\t\tif (session && session.user.email !== parsed.email) return redirectOnError(\"unauthorized\");\n\t\tif (parsed.requestType === \"change-email-confirmation\") {\n\t\t\tconst newToken$1 = await createEmailVerificationToken(ctx.context.secret, parsed.email, parsed.updateTo, ctx.context.options.emailVerification?.expiresIn, { requestType: \"change-email-verification\" });\n\t\t\tconst updateCallbackURL$1 = ctx.query.callbackURL ? encodeURIComponent(ctx.query.callbackURL) : encodeURIComponent(\"/\");\n\t\t\tconst url = `${ctx.context.baseURL}/verify-email?token=${newToken$1}&callbackURL=${updateCallbackURL$1}`;\n\t\t\tawait ctx.context.options.emailVerification?.sendVerificationEmail?.({\n\t\t\t\tuser: {\n\t\t\t\t\t...user.user,\n\t\t\t\t\temail: parsed.updateTo\n\t\t\t\t},\n\t\t\t\turl,\n\t\t\t\ttoken: newToken$1\n\t\t\t}, ctx.request);\n\t\t\tif (ctx.query.callbackURL) throw ctx.redirect(ctx.query.callbackURL);\n\t\t\treturn ctx.json({ status: true });\n\t\t}\n\t\tif (!session) {\n\t\t\tconst newSession = await ctx.context.internalAdapter.createSession(user.user.id);\n\t\t\tif (!newSession) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: \"Failed to create session\" });\n\t\t\tsession = {\n\t\t\t\tsession: newSession,\n\t\t\t\tuser: user.user\n\t\t\t};\n\t\t}\n\t\tif (parsed.requestType === \"change-email-verification\") {\n\t\t\tconst updatedUser$2 = await ctx.context.internalAdapter.updateUserByEmail(parsed.email, {\n\t\t\t\temail: parsed.updateTo,\n\t\t\t\temailVerified: true\n\t\t\t});\n\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\tsession: session.session,\n\t\t\t\tuser: {\n\t\t\t\t\t...session.user,\n\t\t\t\t\temail: parsed.updateTo,\n\t\t\t\t\temailVerified: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (ctx.query.callbackURL) throw ctx.redirect(ctx.query.callbackURL);\n\t\t\treturn ctx.json({\n\t\t\t\tstatus: true,\n\t\t\t\tuser: updatedUser$2\n\t\t\t});\n\t\t}\n\t\tconst updatedUser$1 = await ctx.context.internalAdapter.updateUserByEmail(parsed.email, {\n\t\t\temail: parsed.updateTo,\n\t\t\temailVerified: false\n\t\t});\n\t\tconst newToken = await createEmailVerificationToken(ctx.context.secret, parsed.updateTo);\n\t\tconst updateCallbackURL = ctx.query.callbackURL ? encodeURIComponent(ctx.query.callbackURL) : encodeURIComponent(\"/\");\n\t\tawait ctx.context.options.emailVerification?.sendVerificationEmail?.({\n\t\t\tuser: updatedUser$1,\n\t\t\turl: `${ctx.context.baseURL}/verify-email?token=${newToken}&callbackURL=${updateCallbackURL}`,\n\t\t\ttoken: newToken\n\t\t}, ctx.request);\n\t\tawait setSessionCookie(ctx, {\n\t\t\tsession: session.session,\n\t\t\tuser: {\n\t\t\t\t...session.user,\n\t\t\t\temail: parsed.updateTo,\n\t\t\t\temailVerified: false\n\t\t\t}\n\t\t});\n\t\tif (ctx.query.callbackURL) throw ctx.redirect(ctx.query.callbackURL);\n\t\treturn ctx.json({\n\t\t\tstatus: true,\n\t\t\tuser: {\n\t\t\t\tid: updatedUser$1.id,\n\t\t\t\temail: updatedUser$1.email,\n\t\t\t\tname: updatedUser$1.name,\n\t\t\t\timage: updatedUser$1.image,\n\t\t\t\temailVerified: updatedUser$1.emailVerified,\n\t\t\t\tcreatedAt: updatedUser$1.createdAt,\n\t\t\t\tupdatedAt: updatedUser$1.updatedAt\n\t\t\t}\n\t\t});\n\t}\n\tif (user.user.emailVerified) {\n\t\tif (ctx.query.callbackURL) throw ctx.redirect(ctx.query.callbackURL);\n\t\treturn ctx.json({\n\t\t\tstatus: true,\n\t\t\tuser: null\n\t\t});\n\t}\n\tif (ctx.context.options.emailVerification?.onEmailVerification) await ctx.context.options.emailVerification.onEmailVerification(user.user, ctx.request);\n\tconst updatedUser = await ctx.context.internalAdapter.updateUserByEmail(parsed.email, { emailVerified: true });\n\tif (ctx.context.options.emailVerification?.afterEmailVerification) await ctx.context.options.emailVerification.afterEmailVerification(updatedUser, ctx.request);\n\tif (ctx.context.options.emailVerification?.autoSignInAfterVerification) {\n\t\tconst currentSession = await getSessionFromCtx(ctx);\n\t\tif (!currentSession || currentSession.user.email !== parsed.email) {\n\t\t\tconst session = await ctx.context.internalAdapter.createSession(user.user.id);\n\t\t\tif (!session) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: \"Failed to create session\" });\n\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\tsession,\n\t\t\t\tuser: {\n\t\t\t\t\t...user.user,\n\t\t\t\t\temailVerified: true\n\t\t\t\t}\n\t\t\t});\n\t\t} else await setSessionCookie(ctx, {\n\t\t\tsession: currentSession.session,\n\t\t\tuser: {\n\t\t\t\t...currentSession.user,\n\t\t\t\temailVerified: true\n\t\t\t}\n\t\t});\n\t}\n\tif (ctx.query.callbackURL) throw ctx.redirect(ctx.query.callbackURL);\n\treturn ctx.json({\n\t\tstatus: true,\n\t\tuser: null\n\t});\n});\n\n//#endregion\n//#region src/api/routes/error.ts\nfunction sanitize(input) {\n\treturn input.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\").replace(/'/g, \"&#39;\").replace(/&(?!amp;|lt;|gt;|quot;|#39;|#x[0-9a-fA-F]+;|#[0-9]+;)/g, \"&amp;\");\n}\nconst html = (options, code = \"Unknown\", description = null) => {\n\tconst custom = options.onAPIError?.customizeDefaultErrorPage;\n\treturn `<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    <title>Error</title>\n    <style>\n      * {\n        box-sizing: border-box;\n      }\n      body {\n        font-family: ${custom?.font?.defaultFamily || \"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif\"};\n        background: ${custom?.colors?.background || \"var(--background)\"};\n        color: var(--foreground);\n        margin: 0;\n      }\n      :root,\n      :host {\n        --spacing: 0.25rem;\n        --container-md: 28rem;\n        --text-sm: ${custom?.size?.textSm || \"0.875rem\"};\n        --text-sm--line-height: calc(1.25 / 0.875);\n        --text-2xl: ${custom?.size?.text2xl || \"1.5rem\"};\n        --text-2xl--line-height: calc(2 / 1.5);\n        --text-4xl: ${custom?.size?.text4xl || \"2.25rem\"};\n        --text-4xl--line-height: calc(2.5 / 2.25);\n        --text-6xl: ${custom?.size?.text6xl || \"3rem\"};\n        --text-6xl--line-height: 1;\n        --font-weight-medium: 500;\n        --font-weight-semibold: 600;\n        --font-weight-bold: 700;\n        --default-transition-duration: 150ms;\n        --default-transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n        --radius: ${custom?.size?.radiusSm || \"0.625rem\"};\n        --default-mono-font-family: ${custom?.font?.monoFamily || \"var(--font-geist-mono)\"};\n        --primary: ${custom?.colors?.primary || \"black\"};\n        --primary-foreground: ${custom?.colors?.primaryForeground || \"white\"};\n        --background: ${custom?.colors?.background || \"white\"};\n        --foreground: ${custom?.colors?.foreground || \"oklch(0.271 0 0)\"};\n        --border: ${custom?.colors?.border || \"oklch(0.89 0 0)\"};\n        --destructive: ${custom?.colors?.destructive || \"oklch(0.55 0.15 25.723)\"};\n        --muted-foreground: ${custom?.colors?.mutedForeground || \"oklch(0.545 0 0)\"};\n        --corner-border: ${custom?.colors?.cornerBorder || \"#404040\"};\n      }\n\n      button, .btn {\n        cursor: pointer;\n        background: none;\n        border: none;\n        color: inherit;\n        font: inherit;\n        transition: all var(--default-transition-duration)\n          var(--default-transition-timing-function);\n      }\n      button:hover, .btn:hover {\n        opacity: 0.8;\n      }\n\n      @media (prefers-color-scheme: dark) {\n        :root,\n        :host {\n          --primary: ${custom?.colors?.primary || \"white\"};\n          --primary-foreground: ${custom?.colors?.primaryForeground || \"black\"};\n          --background: ${custom?.colors?.background || \"oklch(0.15 0 0)\"};\n          --foreground: ${custom?.colors?.foreground || \"oklch(0.98 0 0)\"};\n          --border: ${custom?.colors?.border || \"oklch(0.27 0 0)\"};\n          --destructive: ${custom?.colors?.destructive || \"oklch(0.65 0.15 25.723)\"};\n          --muted-foreground: ${custom?.colors?.mutedForeground || \"oklch(0.65 0 0)\"};\n          --corner-border: ${custom?.colors?.cornerBorder || \"#a0a0a0\"};\n        }\n      }\n      @media (max-width: 640px) {\n        :root, :host {\n          --text-6xl: 2.5rem;\n          --text-2xl: 1.25rem;\n          --text-sm: 0.8125rem;\n        }\n      }\n      @media (max-width: 480px) {\n        :root, :host {\n          --text-6xl: 2rem;\n          --text-2xl: 1.125rem;\n        }\n      }\n    </style>\n  </head>\n  <body style=\"width: 100vw; min-height: 100vh; overflow-x: hidden; overflow-y: auto;\">\n    <div\n        style=\"\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            gap: 1.5rem;\n            position: relative;\n            width: 100%;\n            min-height: 100vh;\n            padding: 1rem;\n        \"\n        >\n${custom?.disableBackgroundGrid ? \"\" : `\n      <div\n        style=\"\n          position: absolute;\n          inset: 0;\n          background-image: linear-gradient(to right, ${custom?.colors?.gridColor || \"var(--border)\"} 1px, transparent 1px),\n            linear-gradient(to bottom, ${custom?.colors?.gridColor || \"var(--border)\"} 1px, transparent 1px);\n          background-size: 40px 40px;\n          opacity: 0.6;\n          pointer-events: none;\n          width: 100vw;\n          height: 100vh;\n        \"\n      ></div>\n      <div\n        style=\"\n          position: absolute;\n          inset: 0;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          background: ${custom?.colors?.background || \"var(--background)\"};\n          mask-image: radial-gradient(ellipse at center, transparent 20%, black);\n          -webkit-mask-image: radial-gradient(ellipse at center, transparent 20%, black);\n          pointer-events: none;\n        \"\n      ></div>\n`}\n\n<div\n  style=\"\n    position: relative;\n    z-index: 10;\n    border: 2px solid var(--border);\n    background: ${custom?.colors?.cardBackground || \"var(--background)\"};\n    padding: 1.5rem;\n    max-width: 42rem;\n    width: 100%;\n  \"\n>\n    ${custom?.disableCornerDecorations ? \"\" : `\n        <!-- Corner decorations -->\n        <div\n          style=\"\n            position: absolute;\n            top: -2px;\n            left: -2px;\n            width: 2rem;\n            height: 2rem;\n            border-top: 4px solid var(--corner-border);\n            border-left: 4px solid var(--corner-border);\n          \"\n        ></div>\n        <div\n          style=\"\n            position: absolute;\n            top: -2px;\n            right: -2px;\n            width: 2rem;\n            height: 2rem;\n            border-top: 4px solid var(--corner-border);\n            border-right: 4px solid var(--corner-border);\n          \"\n        ></div>\n  \n        <div\n          style=\"\n            position: absolute;\n            bottom: -2px;\n            left: -2px;\n            width: 2rem;\n            height: 2rem;\n            border-bottom: 4px solid var(--corner-border);\n            border-left: 4px solid var(--corner-border);\n          \"\n        ></div>\n        <div\n          style=\"\n            position: absolute;\n            bottom: -2px;\n            right: -2px;\n            width: 2rem;\n            height: 2rem;\n            border-bottom: 4px solid var(--corner-border);\n            border-right: 4px solid var(--corner-border);\n          \"\n        ></div>`}\n\n        <div style=\"text-align: center; margin-bottom: 1.5rem;\">\n          <div style=\"margin-bottom: 1.5rem;\">\n            <div\n              style=\"\n                display: inline-block;\n                border: 2px solid ${custom?.disableTitleBorder ? \"transparent\" : custom?.colors?.titleBorder || \"var(--destructive)\"};\n                padding: 0.375rem 1rem;\n              \"\n            >\n              <h1\n                style=\"\n                  font-size: var(--text-6xl);\n                  font-weight: var(--font-weight-semibold);\n                  color: ${custom?.colors?.titleColor || \"var(--foreground)\"};\n                  letter-spacing: -0.02em;\n                  margin: 0;\n                \"\n              >\n                ERROR\n              </h1>\n            </div>\n            <div\n              style=\"\n                height: 2px;\n                background-color: var(--border);\n                width: calc(100% + 3rem);\n                margin-left: -1.5rem;\n                margin-top: 1.5rem;\n              \"\n            ></div>\n          </div>\n\n          <h2\n            style=\"\n              font-size: var(--text-2xl);\n              font-weight: var(--font-weight-semibold);\n              color: var(--foreground);\n              margin: 0 0 1rem;\n            \"\n          >\n            Something went wrong\n          </h2>\n\n          <div\n            style=\"\n                display: inline-flex;\n                align-items: center;\n                gap: 0.5rem;\n                border: 2px solid var(--border);\n                background-color: var(--muted);\n                padding: 0.375rem 0.75rem;\n                margin: 0 0 1rem;\n                flex-wrap: wrap;\n                justify-content: center;\n            \"\n            >\n            <span\n                style=\"\n                font-size: 0.75rem;\n                color: var(--muted-foreground);\n                font-weight: var(--font-weight-semibold);\n                \"\n            >\n                CODE:\n            </span>\n            <span\n                style=\"\n                font-size: var(--text-sm);\n                font-family: var(--default-mono-font-family, monospace);\n                color: var(--foreground);\n                word-break: break-all;\n                \"\n            >\n                ${sanitize(code)}\n            </span>\n            </div>\n\n          <p\n            style=\"\n              color: var(--muted-foreground);\n              max-width: 28rem;\n              margin: 0 auto;\n              font-size: var(--text-sm);\n              line-height: 1.5;\n              text-wrap: pretty;\n            \"\n          >\n            ${!description ? `We encountered an unexpected error. Please try again or return to the home page. If you're a developer, you can find more information about the error <a href='https://better-auth.com/docs/errors/${encodeURIComponent(code)}' target='_blank' rel=\"noopener noreferrer\" style='color: var(--foreground); text-decoration: underline;'>here</a>.` : description}\n          </p>\n        </div>\n\n        <div\n          style=\"\n            display: flex;\n            gap: 0.75rem;\n            margin-top: 1.5rem;\n            justify-content: center;\n            flex-wrap: wrap;\n          \"\n        >\n          <a\n            href=\"/\"\n            style=\"\n              text-decoration: none;\n            \"\n          >\n            <div\n              style=\"\n                border: 2px solid var(--border);\n                background: var(--primary);\n                color: var(--primary-foreground);\n                padding: 0.5rem 1rem;\n                border-radius: 0;\n                white-space: nowrap;\n              \"\n              class=\"btn\"\n            >\n              Go Home\n            </div>\n          </a>\n          <a\n            href=\"https://better-auth.com/docs/errors/${encodeURIComponent(code)}?askai=${encodeURIComponent(`What does the error code ${code} mean?`)}\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            style=\"\n              text-decoration: none;\n            \"\n          >\n            <div\n              style=\"\n                border: 2px solid var(--border);\n                background: transparent;\n                color: var(--foreground);\n                padding: 0.5rem 1rem;\n                border-radius: 0;\n                white-space: nowrap;\n              \"\n              class=\"btn\"\n            >\n              Ask AI\n            </div>\n          </a>\n        </div>\n      </div>\n    </div>\n  </body>\n</html>`;\n};\nconst error = createAuthEndpoint(\"/error\", {\n\tmethod: \"GET\",\n\tmetadata: {\n\t\t...HIDE_METADATA,\n\t\topenapi: {\n\t\t\tdescription: \"Displays an error page\",\n\t\t\tresponses: { \"200\": {\n\t\t\t\tdescription: \"Success\",\n\t\t\t\tcontent: { \"text/html\": { schema: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\tdescription: \"The HTML content of the error page\"\n\t\t\t\t} } }\n\t\t\t} }\n\t\t}\n\t}\n}, async (c) => {\n\tconst url = new URL(c.request?.url || \"\");\n\tconst unsanitizedCode = url.searchParams.get(\"error\") || \"UNKNOWN\";\n\tconst unsanitizedDescription = url.searchParams.get(\"error_description\") || null;\n\tconst safeCode = /^[\\'A-Za-z0-9_-]+$/.test(unsanitizedCode || \"\") ? unsanitizedCode : \"UNKNOWN\";\n\tconst safeDescription = unsanitizedDescription ? sanitize(unsanitizedDescription) : null;\n\tconst queryParams = new URLSearchParams();\n\tqueryParams.set(\"error\", safeCode);\n\tif (unsanitizedDescription) queryParams.set(\"error_description\", unsanitizedDescription);\n\tconst options = c.context.options;\n\tconst errorURL = options.onAPIError?.errorURL;\n\tif (errorURL) return new Response(null, {\n\t\tstatus: 302,\n\t\theaders: { Location: `${errorURL}${errorURL.includes(\"?\") ? \"&\" : \"?\"}${queryParams.toString()}` }\n\t});\n\tif (isProduction && !options.onAPIError?.customizeDefaultErrorPage) return new Response(null, {\n\t\tstatus: 302,\n\t\theaders: { Location: `/?${queryParams.toString()}` }\n\t});\n\treturn new Response(html(c.context.options, safeCode, safeDescription), { headers: { \"Content-Type\": \"text/html\" } });\n});\n\n//#endregion\n//#region src/api/routes/ok.ts\nconst ok = createAuthEndpoint(\"/ok\", {\n\tmethod: \"GET\",\n\tmetadata: {\n\t\t...HIDE_METADATA,\n\t\topenapi: {\n\t\t\tdescription: \"Check if the API is working\",\n\t\t\tresponses: { \"200\": {\n\t\t\t\tdescription: \"API is working\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: { ok: {\n\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\tdescription: \"Indicates if the API is working\"\n\t\t\t\t\t} },\n\t\t\t\t\trequired: [\"ok\"]\n\t\t\t\t} } }\n\t\t\t} }\n\t\t}\n\t}\n}, async (ctx) => {\n\treturn ctx.json({ ok: true });\n});\n\n//#endregion\n//#region src/api/routes/reset-password.ts\nfunction redirectError(ctx, callbackURL, query) {\n\tconst url = callbackURL ? new URL(callbackURL, ctx.baseURL) : new URL(`${ctx.baseURL}/error`);\n\tif (query) Object.entries(query).forEach(([k, v]) => url.searchParams.set(k, v));\n\treturn url.href;\n}\nfunction redirectCallback(ctx, callbackURL, query) {\n\tconst url = new URL(callbackURL, ctx.baseURL);\n\tif (query) Object.entries(query).forEach(([k, v]) => url.searchParams.set(k, v));\n\treturn url.href;\n}\nconst requestPasswordReset = createAuthEndpoint(\"/request-password-reset\", {\n\tmethod: \"POST\",\n\tbody: z.object({\n\t\temail: z.email().meta({ description: \"The email address of the user to send a password reset email to\" }),\n\t\tredirectTo: z.string().meta({ description: \"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN\" }).optional()\n\t}),\n\tmetadata: { openapi: {\n\t\toperationId: \"requestPasswordReset\",\n\t\tdescription: \"Send a password reset email to the user\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: {\n\t\t\t\t\tstatus: { type: \"boolean\" },\n\t\t\t\t\tmessage: { type: \"string\" }\n\t\t\t\t}\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tif (!ctx.context.options.emailAndPassword?.sendResetPassword) {\n\t\tctx.context.logger.error(\"Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!\");\n\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"Reset password isn't enabled\" });\n\t}\n\tconst { email, redirectTo } = ctx.body;\n\tconst user = await ctx.context.internalAdapter.findUserByEmail(email, { includeAccounts: true });\n\tif (!user) {\n\t\t/**\n\t\t* We simulate the verification token generation and the database lookup\n\t\t* to mitigate timing attacks.\n\t\t*/\n\t\tgenerateId(24);\n\t\tawait ctx.context.internalAdapter.findVerificationValue(\"dummy-verification-token\");\n\t\tctx.context.logger.error(\"Reset Password: User not found\", { email });\n\t\treturn ctx.json({\n\t\t\tstatus: true,\n\t\t\tmessage: \"If this email exists in our system, check your email for the reset link\"\n\t\t});\n\t}\n\tconst expiresAt = getDate(ctx.context.options.emailAndPassword.resetPasswordTokenExpiresIn || 3600 * 1, \"sec\");\n\tconst verificationToken = generateId(24);\n\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\tvalue: user.user.id,\n\t\tidentifier: `reset-password:${verificationToken}`,\n\t\texpiresAt\n\t});\n\tconst callbackURL = redirectTo ? encodeURIComponent(redirectTo) : \"\";\n\tconst url = `${ctx.context.baseURL}/reset-password/${verificationToken}?callbackURL=${callbackURL}`;\n\tawait ctx.context.options.emailAndPassword.sendResetPassword({\n\t\tuser: user.user,\n\t\turl,\n\t\ttoken: verificationToken\n\t}, ctx.request).catch((e) => {\n\t\tctx.context.logger.error(\"Failed to send reset password email\", e);\n\t});\n\treturn ctx.json({\n\t\tstatus: true,\n\t\tmessage: \"If this email exists in our system, check your email for the reset link\"\n\t});\n});\nconst requestPasswordResetCallback = createAuthEndpoint(\"/reset-password/:token\", {\n\tmethod: \"GET\",\n\toperationId: \"forgetPasswordCallback\",\n\tquery: z.object({ callbackURL: z.string().meta({ description: \"The URL to redirect the user to reset their password\" }) }),\n\tuse: [originCheck((ctx) => ctx.query.callbackURL)],\n\tmetadata: { openapi: {\n\t\toperationId: \"resetPasswordCallback\",\n\t\tdescription: \"Redirects the user to the callback URL with the token\",\n\t\tparameters: [{\n\t\t\tname: \"token\",\n\t\t\tin: \"path\",\n\t\t\trequired: true,\n\t\t\tdescription: \"The token to reset the password\",\n\t\t\tschema: { type: \"string\" }\n\t\t}, {\n\t\t\tname: \"callbackURL\",\n\t\t\tin: \"query\",\n\t\t\trequired: true,\n\t\t\tdescription: \"The URL to redirect the user to reset their password\",\n\t\t\tschema: { type: \"string\" }\n\t\t}],\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { token: { type: \"string\" } }\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tconst { token } = ctx.params;\n\tconst { callbackURL } = ctx.query;\n\tif (!token || !callbackURL) throw ctx.redirect(redirectError(ctx.context, callbackURL, { error: \"INVALID_TOKEN\" }));\n\tconst verification = await ctx.context.internalAdapter.findVerificationValue(`reset-password:${token}`);\n\tif (!verification || verification.expiresAt < /* @__PURE__ */ new Date()) throw ctx.redirect(redirectError(ctx.context, callbackURL, { error: \"INVALID_TOKEN\" }));\n\tthrow ctx.redirect(redirectCallback(ctx.context, callbackURL, { token }));\n});\nconst resetPassword = createAuthEndpoint(\"/reset-password\", {\n\tmethod: \"POST\",\n\toperationId: \"resetPassword\",\n\tquery: z.object({ token: z.string().optional() }).optional(),\n\tbody: z.object({\n\t\tnewPassword: z.string().meta({ description: \"The new password to set\" }),\n\t\ttoken: z.string().meta({ description: \"The token to reset the password\" }).optional()\n\t}),\n\tmetadata: { openapi: {\n\t\toperationId: \"resetPassword\",\n\t\tdescription: \"Reset the password for a user\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { status: { type: \"boolean\" } }\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tconst token = ctx.body.token || ctx.query?.token;\n\tif (!token) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.INVALID_TOKEN });\n\tconst { newPassword } = ctx.body;\n\tconst minLength = ctx.context.password?.config.minPasswordLength;\n\tconst maxLength = ctx.context.password?.config.maxPasswordLength;\n\tif (newPassword.length < minLength) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.PASSWORD_TOO_SHORT });\n\tif (newPassword.length > maxLength) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.PASSWORD_TOO_LONG });\n\tconst id = `reset-password:${token}`;\n\tconst verification = await ctx.context.internalAdapter.findVerificationValue(id);\n\tif (!verification || verification.expiresAt < /* @__PURE__ */ new Date()) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.INVALID_TOKEN });\n\tconst userId = verification.value;\n\tconst hashedPassword = await ctx.context.password.hash(newPassword);\n\tif (!(await ctx.context.internalAdapter.findAccounts(userId)).find((ac) => ac.providerId === \"credential\")) await ctx.context.internalAdapter.createAccount({\n\t\tuserId,\n\t\tproviderId: \"credential\",\n\t\tpassword: hashedPassword,\n\t\taccountId: userId\n\t});\n\telse await ctx.context.internalAdapter.updatePassword(userId, hashedPassword);\n\tawait ctx.context.internalAdapter.deleteVerificationValue(verification.id);\n\tif (ctx.context.options.emailAndPassword?.onPasswordReset) {\n\t\tconst user = await ctx.context.internalAdapter.findUserById(userId);\n\t\tif (user) await ctx.context.options.emailAndPassword.onPasswordReset({ user }, ctx.request);\n\t}\n\tif (ctx.context.options.emailAndPassword?.revokeSessionsOnPasswordReset) await ctx.context.internalAdapter.deleteSessions(userId);\n\treturn ctx.json({ status: true });\n});\n\n//#endregion\n//#region src/api/routes/sign-in.ts\nconst socialSignInBodySchema = z.object({\n\tcallbackURL: z.string().meta({ description: \"Callback URL to redirect to after the user has signed in\" }).optional(),\n\tnewUserCallbackURL: z.string().optional(),\n\terrorCallbackURL: z.string().meta({ description: \"Callback URL to redirect to if an error happens\" }).optional(),\n\tprovider: SocialProviderListEnum,\n\tdisableRedirect: z.boolean().meta({ description: \"Disable automatic redirection to the provider. Useful for handling the redirection yourself\" }).optional(),\n\tidToken: z.optional(z.object({\n\t\ttoken: z.string().meta({ description: \"ID token from the provider\" }),\n\t\tnonce: z.string().meta({ description: \"Nonce used to generate the token\" }).optional(),\n\t\taccessToken: z.string().meta({ description: \"Access token from the provider\" }).optional(),\n\t\trefreshToken: z.string().meta({ description: \"Refresh token from the provider\" }).optional(),\n\t\texpiresAt: z.number().meta({ description: \"Expiry date of the token\" }).optional()\n\t})),\n\tscopes: z.array(z.string()).meta({ description: \"Array of scopes to request from the provider. This will override the default scopes passed.\" }).optional(),\n\trequestSignUp: z.boolean().meta({ description: \"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider\" }).optional(),\n\tloginHint: z.string().meta({ description: \"The login hint to use for the authorization code request\" }).optional(),\n\tadditionalData: z.record(z.string(), z.any()).optional().meta({ description: \"Additional data to be passed through the OAuth flow\" })\n});\nconst signInSocial = () => createAuthEndpoint(\"/sign-in/social\", {\n\tmethod: \"POST\",\n\toperationId: \"socialSignIn\",\n\tbody: socialSignInBodySchema,\n\tmetadata: {\n\t\t$Infer: {\n\t\t\tbody: {},\n\t\t\treturned: {}\n\t\t},\n\t\topenapi: {\n\t\t\tdescription: \"Sign in with a social provider\",\n\t\t\toperationId: \"socialSignIn\",\n\t\t\tresponses: { \"200\": {\n\t\t\t\tdescription: \"Success - Returns either session details or redirect URL\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tdescription: \"Session response when idToken is provided\",\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\ttoken: { type: \"string\" },\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t$ref: \"#/components/schemas/User\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\turl: { type: \"string\" },\n\t\t\t\t\t\tredirect: {\n\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\tenum: [false]\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\trequired: [\n\t\t\t\t\t\t\"redirect\",\n\t\t\t\t\t\t\"token\",\n\t\t\t\t\t\t\"user\"\n\t\t\t\t\t]\n\t\t\t\t} } }\n\t\t\t} }\n\t\t}\n\t}\n}, async (c) => {\n\tconst provider = c.context.socialProviders.find((p) => p.id === c.body.provider);\n\tif (!provider) {\n\t\tc.context.logger.error(\"Provider not found. Make sure to add the provider in your auth config\", { provider: c.body.provider });\n\t\tthrow new APIError(\"NOT_FOUND\", { message: BASE_ERROR_CODES.PROVIDER_NOT_FOUND });\n\t}\n\tif (c.body.idToken) {\n\t\tif (!provider.verifyIdToken) {\n\t\t\tc.context.logger.error(\"Provider does not support id token verification\", { provider: c.body.provider });\n\t\t\tthrow new APIError(\"NOT_FOUND\", { message: BASE_ERROR_CODES.ID_TOKEN_NOT_SUPPORTED });\n\t\t}\n\t\tconst { token, nonce } = c.body.idToken;\n\t\tif (!await provider.verifyIdToken(token, nonce)) {\n\t\t\tc.context.logger.error(\"Invalid id token\", { provider: c.body.provider });\n\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: BASE_ERROR_CODES.INVALID_TOKEN });\n\t\t}\n\t\tconst userInfo = await provider.getUserInfo({\n\t\t\tidToken: token,\n\t\t\taccessToken: c.body.idToken.accessToken,\n\t\t\trefreshToken: c.body.idToken.refreshToken\n\t\t});\n\t\tif (!userInfo || !userInfo?.user) {\n\t\t\tc.context.logger.error(\"Failed to get user info\", { provider: c.body.provider });\n\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: BASE_ERROR_CODES.FAILED_TO_GET_USER_INFO });\n\t\t}\n\t\tif (!userInfo.user.email) {\n\t\t\tc.context.logger.error(\"User email not found\", { provider: c.body.provider });\n\t\t\tthrow new APIError(\"UNAUTHORIZED\", { message: BASE_ERROR_CODES.USER_EMAIL_NOT_FOUND });\n\t\t}\n\t\tconst data = await handleOAuthUserInfo(c, {\n\t\t\tuserInfo: {\n\t\t\t\t...userInfo.user,\n\t\t\t\temail: userInfo.user.email,\n\t\t\t\tid: String(userInfo.user.id),\n\t\t\t\tname: userInfo.user.name || \"\",\n\t\t\t\timage: userInfo.user.image,\n\t\t\t\temailVerified: userInfo.user.emailVerified || false\n\t\t\t},\n\t\t\taccount: {\n\t\t\t\tproviderId: provider.id,\n\t\t\t\taccountId: String(userInfo.user.id),\n\t\t\t\taccessToken: c.body.idToken.accessToken\n\t\t\t},\n\t\t\tcallbackURL: c.body.callbackURL,\n\t\t\tdisableSignUp: provider.disableImplicitSignUp && !c.body.requestSignUp || provider.disableSignUp\n\t\t});\n\t\tif (data.error) throw new APIError(\"UNAUTHORIZED\", { message: data.error });\n\t\tawait setSessionCookie(c, data.data);\n\t\treturn c.json({\n\t\t\tredirect: false,\n\t\t\ttoken: data.data.session.token,\n\t\t\turl: void 0,\n\t\t\tuser: parseUserOutput(c.context.options, data.data.user)\n\t\t});\n\t}\n\tconst { codeVerifier, state } = await generateState(c, void 0, c.body.additionalData);\n\tconst url = await provider.createAuthorizationURL({\n\t\tstate,\n\t\tcodeVerifier,\n\t\tredirectURI: `${c.context.baseURL}/callback/${provider.id}`,\n\t\tscopes: c.body.scopes,\n\t\tloginHint: c.body.loginHint\n\t});\n\treturn c.json({\n\t\turl: url.toString(),\n\t\tredirect: !c.body.disableRedirect\n\t});\n});\nconst signInEmail = () => createAuthEndpoint(\"/sign-in/email\", {\n\tmethod: \"POST\",\n\toperationId: \"signInEmail\",\n\tbody: z.object({\n\t\temail: z.string().meta({ description: \"Email of the user\" }),\n\t\tpassword: z.string().meta({ description: \"Password of the user\" }),\n\t\tcallbackURL: z.string().meta({ description: \"Callback URL to use as a redirect for email verification\" }).optional(),\n\t\trememberMe: z.boolean().meta({ description: \"If this is false, the session will not be remembered. Default is `true`.\" }).default(true).optional()\n\t}),\n\tmetadata: {\n\t\t$Infer: {\n\t\t\tbody: {},\n\t\t\treturned: {}\n\t\t},\n\t\topenapi: {\n\t\t\toperationId: \"signInEmail\",\n\t\t\tdescription: \"Sign in with email and password\",\n\t\t\tresponses: { \"200\": {\n\t\t\t\tdescription: \"Success - Returns either session details or redirect URL\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tdescription: \"Session response when idToken is provided\",\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tredirect: {\n\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\tenum: [false]\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"Session token\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\turl: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true\n\t\t\t\t\t\t},\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t$ref: \"#/components/schemas/User\"\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\trequired: [\n\t\t\t\t\t\t\"redirect\",\n\t\t\t\t\t\t\"token\",\n\t\t\t\t\t\t\"user\"\n\t\t\t\t\t]\n\t\t\t\t} } }\n\t\t\t} }\n\t\t}\n\t}\n}, async (ctx) => {\n\tif (!ctx.context.options?.emailAndPassword?.enabled) {\n\t\tctx.context.logger.error(\"Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!\");\n\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"Email and password is not enabled\" });\n\t}\n\tconst { email, password } = ctx.body;\n\tif (!z.email().safeParse(email).success) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.INVALID_EMAIL });\n\tconst user = await ctx.context.internalAdapter.findUserByEmail(email, { includeAccounts: true });\n\tif (!user) {\n\t\tawait ctx.context.password.hash(password);\n\t\tctx.context.logger.error(\"User not found\", { email });\n\t\tthrow new APIError(\"UNAUTHORIZED\", { message: BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD });\n\t}\n\tconst credentialAccount = user.accounts.find((a) => a.providerId === \"credential\");\n\tif (!credentialAccount) {\n\t\tawait ctx.context.password.hash(password);\n\t\tctx.context.logger.error(\"Credential account not found\", { email });\n\t\tthrow new APIError(\"UNAUTHORIZED\", { message: BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD });\n\t}\n\tconst currentPassword = credentialAccount?.password;\n\tif (!currentPassword) {\n\t\tawait ctx.context.password.hash(password);\n\t\tctx.context.logger.error(\"Password not found\", { email });\n\t\tthrow new APIError(\"UNAUTHORIZED\", { message: BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD });\n\t}\n\tif (!await ctx.context.password.verify({\n\t\thash: currentPassword,\n\t\tpassword\n\t})) {\n\t\tctx.context.logger.error(\"Invalid password\");\n\t\tthrow new APIError(\"UNAUTHORIZED\", { message: BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD });\n\t}\n\tif (ctx.context.options?.emailAndPassword?.requireEmailVerification && !user.user.emailVerified) {\n\t\tif (!ctx.context.options?.emailVerification?.sendVerificationEmail) throw new APIError(\"FORBIDDEN\", { message: BASE_ERROR_CODES.EMAIL_NOT_VERIFIED });\n\t\tif (ctx.context.options?.emailVerification?.sendOnSignIn) {\n\t\t\tconst token = await createEmailVerificationToken(ctx.context.secret, user.user.email, void 0, ctx.context.options.emailVerification?.expiresIn);\n\t\t\tconst callbackURL = ctx.body.callbackURL ? encodeURIComponent(ctx.body.callbackURL) : encodeURIComponent(\"/\");\n\t\t\tconst url = `${ctx.context.baseURL}/verify-email?token=${token}&callbackURL=${callbackURL}`;\n\t\t\tawait ctx.context.options.emailVerification.sendVerificationEmail({\n\t\t\t\tuser: user.user,\n\t\t\t\turl,\n\t\t\t\ttoken\n\t\t\t}, ctx.request);\n\t\t}\n\t\tthrow new APIError(\"FORBIDDEN\", { message: BASE_ERROR_CODES.EMAIL_NOT_VERIFIED });\n\t}\n\tconst session = await ctx.context.internalAdapter.createSession(user.user.id, ctx.body.rememberMe === false);\n\tif (!session) {\n\t\tctx.context.logger.error(\"Failed to create session\");\n\t\tthrow new APIError(\"UNAUTHORIZED\", { message: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION });\n\t}\n\tawait setSessionCookie(ctx, {\n\t\tsession,\n\t\tuser: user.user\n\t}, ctx.body.rememberMe === false);\n\treturn ctx.json({\n\t\tredirect: !!ctx.body.callbackURL,\n\t\ttoken: session.token,\n\t\turl: ctx.body.callbackURL,\n\t\tuser: parseUserOutput(ctx.context.options, user.user)\n\t});\n});\n\n//#endregion\n//#region src/api/routes/sign-out.ts\nconst signOut = createAuthEndpoint(\"/sign-out\", {\n\tmethod: \"POST\",\n\toperationId: \"signOut\",\n\trequireHeaders: true,\n\tmetadata: { openapi: {\n\t\toperationId: \"signOut\",\n\t\tdescription: \"Sign out the current user\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { success: { type: \"boolean\" } }\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tconst sessionCookieToken = await ctx.getSignedCookie(ctx.context.authCookies.sessionToken.name, ctx.context.secret);\n\tif (sessionCookieToken) try {\n\t\tawait ctx.context.internalAdapter.deleteSession(sessionCookieToken);\n\t} catch (e) {\n\t\tctx.context.logger.error(\"Failed to delete session from database\", e);\n\t}\n\tdeleteSessionCookie(ctx);\n\treturn ctx.json({ success: true });\n});\n\n//#endregion\n//#region src/api/routes/sign-up.ts\nconst signUpEmail = () => createAuthEndpoint(\"/sign-up/email\", {\n\tmethod: \"POST\",\n\toperationId: \"signUpWithEmailAndPassword\",\n\tbody: z.record(z.string(), z.any()),\n\tmetadata: {\n\t\t$Infer: {\n\t\t\tbody: {},\n\t\t\treturned: {}\n\t\t},\n\t\topenapi: {\n\t\t\toperationId: \"signUpWithEmailAndPassword\",\n\t\t\tdescription: \"Sign up a user using email and password\",\n\t\t\trequestBody: { content: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: {\n\t\t\t\t\tname: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tdescription: \"The name of the user\"\n\t\t\t\t\t},\n\t\t\t\t\temail: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tdescription: \"The email of the user\"\n\t\t\t\t\t},\n\t\t\t\t\tpassword: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tdescription: \"The password of the user\"\n\t\t\t\t\t},\n\t\t\t\t\timage: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tdescription: \"The profile image URL of the user\"\n\t\t\t\t\t},\n\t\t\t\t\tcallbackURL: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tdescription: \"The URL to use for email verification callback\"\n\t\t\t\t\t},\n\t\t\t\t\trememberMe: {\n\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\tdescription: \"If this is false, the session will not be remembered. Default is `true`.\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\trequired: [\n\t\t\t\t\t\"name\",\n\t\t\t\t\t\"email\",\n\t\t\t\t\t\"password\"\n\t\t\t\t]\n\t\t\t} } } },\n\t\t\tresponses: {\n\t\t\t\t\"200\": {\n\t\t\t\t\tdescription: \"Successfully created user\",\n\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"Authentication token for the session\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The unique identifier of the user\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tformat: \"email\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The email address of the user\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The name of the user\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\timage: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\tdescription: \"The profile image URL of the user\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\temailVerified: {\n\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the email has been verified\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"When the user was created\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"When the user was last updated\"\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\t\t\"email\",\n\t\t\t\t\t\t\t\t\t\"name\",\n\t\t\t\t\t\t\t\t\t\"emailVerified\",\n\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequired: [\"user\"]\n\t\t\t\t\t} } }\n\t\t\t\t},\n\t\t\t\t\"422\": {\n\t\t\t\t\tdescription: \"Unprocessable Entity. User already exists or failed to create user.\",\n\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: { message: { type: \"string\" } }\n\t\t\t\t\t} } }\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}, async (ctx) => {\n\treturn runWithTransaction(ctx.context.adapter, async () => {\n\t\tif (!ctx.context.options.emailAndPassword?.enabled || ctx.context.options.emailAndPassword?.disableSignUp) throw new APIError(\"BAD_REQUEST\", { message: \"Email and password sign up is not enabled\" });\n\t\tconst body = ctx.body;\n\t\tconst { name, email, password, image, callbackURL, rememberMe, ...rest } = body;\n\t\tif (!z.email().safeParse(email).success) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.INVALID_EMAIL });\n\t\tconst minPasswordLength = ctx.context.password.config.minPasswordLength;\n\t\tif (password.length < minPasswordLength) {\n\t\t\tctx.context.logger.error(\"Password is too short\");\n\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.PASSWORD_TOO_SHORT });\n\t\t}\n\t\tconst maxPasswordLength = ctx.context.password.config.maxPasswordLength;\n\t\tif (password.length > maxPasswordLength) {\n\t\t\tctx.context.logger.error(\"Password is too long\");\n\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.PASSWORD_TOO_LONG });\n\t\t}\n\t\tif ((await ctx.context.internalAdapter.findUserByEmail(email))?.user) {\n\t\t\tctx.context.logger.info(`Sign-up attempt for existing email: ${email}`);\n\t\t\tthrow new APIError(\"UNPROCESSABLE_ENTITY\", { message: BASE_ERROR_CODES.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL });\n\t\t}\n\t\t/**\n\t\t* Hash the password\n\t\t*\n\t\t* This is done prior to creating the user\n\t\t* to ensure that any plugin that\n\t\t* may break the hashing should break\n\t\t* before the user is created.\n\t\t*/\n\t\tconst hash = await ctx.context.password.hash(password);\n\t\tlet createdUser;\n\t\ttry {\n\t\t\tconst data = parseUserInput(ctx.context.options, rest, \"create\");\n\t\t\tcreatedUser = await ctx.context.internalAdapter.createUser({\n\t\t\t\temail: email.toLowerCase(),\n\t\t\t\tname,\n\t\t\t\timage,\n\t\t\t\t...data,\n\t\t\t\temailVerified: false\n\t\t\t});\n\t\t\tif (!createdUser) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.FAILED_TO_CREATE_USER });\n\t\t} catch (e) {\n\t\t\tif (isDevelopment()) ctx.context.logger.error(\"Failed to create user\", e);\n\t\t\tif (e instanceof APIError) throw e;\n\t\t\tctx.context.logger?.error(\"Failed to create user\", e);\n\t\t\tthrow new APIError(\"UNPROCESSABLE_ENTITY\", {\n\t\t\t\tmessage: BASE_ERROR_CODES.FAILED_TO_CREATE_USER,\n\t\t\t\tdetails: e\n\t\t\t});\n\t\t}\n\t\tif (!createdUser) throw new APIError(\"UNPROCESSABLE_ENTITY\", { message: BASE_ERROR_CODES.FAILED_TO_CREATE_USER });\n\t\tawait ctx.context.internalAdapter.linkAccount({\n\t\t\tuserId: createdUser.id,\n\t\t\tproviderId: \"credential\",\n\t\t\taccountId: createdUser.id,\n\t\t\tpassword: hash\n\t\t});\n\t\tif (ctx.context.options.emailVerification?.sendOnSignUp || ctx.context.options.emailAndPassword.requireEmailVerification) {\n\t\t\tconst token = await createEmailVerificationToken(ctx.context.secret, createdUser.email, void 0, ctx.context.options.emailVerification?.expiresIn);\n\t\t\tconst callbackURL$1 = body.callbackURL ? encodeURIComponent(body.callbackURL) : encodeURIComponent(\"/\");\n\t\t\tconst url = `${ctx.context.baseURL}/verify-email?token=${token}&callbackURL=${callbackURL$1}`;\n\t\t\tconst args = ctx.request ? [{\n\t\t\t\tuser: createdUser,\n\t\t\t\turl,\n\t\t\t\ttoken\n\t\t\t}, ctx.request] : [{\n\t\t\t\tuser: createdUser,\n\t\t\t\turl,\n\t\t\t\ttoken\n\t\t\t}];\n\t\t\tawait ctx.context.options.emailVerification?.sendVerificationEmail?.(...args);\n\t\t}\n\t\tif (ctx.context.options.emailAndPassword.autoSignIn === false || ctx.context.options.emailAndPassword.requireEmailVerification) return ctx.json({\n\t\t\ttoken: null,\n\t\t\tuser: parseUserOutput(ctx.context.options, createdUser)\n\t\t});\n\t\tconst session = await ctx.context.internalAdapter.createSession(createdUser.id, rememberMe === false);\n\t\tif (!session) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION });\n\t\tawait setSessionCookie(ctx, {\n\t\t\tsession,\n\t\t\tuser: createdUser\n\t\t}, rememberMe === false);\n\t\treturn ctx.json({\n\t\t\ttoken: session.token,\n\t\t\tuser: parseUserOutput(ctx.context.options, createdUser)\n\t\t});\n\t});\n});\n\n//#endregion\n//#region src/api/routes/update-user.ts\nconst updateUser = () => createAuthEndpoint(\"/update-user\", {\n\tmethod: \"POST\",\n\toperationId: \"updateUser\",\n\tbody: z.record(z.string().meta({ description: \"Field name must be a string\" }), z.any()),\n\tuse: [sessionMiddleware],\n\tmetadata: {\n\t\t$Infer: { body: {} },\n\t\topenapi: {\n\t\t\toperationId: \"updateUser\",\n\t\t\tdescription: \"Update the current user\",\n\t\t\trequestBody: { content: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: {\n\t\t\t\t\tname: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tdescription: \"The name of the user\"\n\t\t\t\t\t},\n\t\t\t\t\timage: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tdescription: \"The image of the user\",\n\t\t\t\t\t\tnullable: true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} } } },\n\t\t\tresponses: { \"200\": {\n\t\t\t\tdescription: \"Success\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: { user: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t$ref: \"#/components/schemas/User\"\n\t\t\t\t\t} }\n\t\t\t\t} } }\n\t\t\t} }\n\t\t}\n\t}\n}, async (ctx) => {\n\tconst body = ctx.body;\n\tif (body.email) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.EMAIL_CAN_NOT_BE_UPDATED });\n\tconst { name, image, ...rest } = body;\n\tconst session = ctx.context.session;\n\tconst additionalFields = parseUserInput(ctx.context.options, rest, \"update\");\n\tif (image === void 0 && name === void 0 && Object.keys(additionalFields).length === 0) throw new APIError(\"BAD_REQUEST\", { message: \"No fields to update\" });\n\tconst user = await ctx.context.internalAdapter.updateUser(session.user.id, {\n\t\tname,\n\t\timage,\n\t\t...additionalFields\n\t});\n\t/**\n\t* Update the session cookie with the new user data\n\t*/\n\tawait setSessionCookie(ctx, {\n\t\tsession: session.session,\n\t\tuser\n\t});\n\treturn ctx.json({ status: true });\n});\nconst changePassword = createAuthEndpoint(\"/change-password\", {\n\tmethod: \"POST\",\n\toperationId: \"changePassword\",\n\tbody: z.object({\n\t\tnewPassword: z.string().meta({ description: \"The new password to set\" }),\n\t\tcurrentPassword: z.string().meta({ description: \"The current password is required\" }),\n\t\trevokeOtherSessions: z.boolean().meta({ description: \"Must be a boolean value\" }).optional()\n\t}),\n\tuse: [sensitiveSessionMiddleware],\n\tmetadata: { openapi: {\n\t\toperationId: \"changePassword\",\n\t\tdescription: \"Change the password of the user\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Password successfully changed\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: {\n\t\t\t\t\ttoken: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\tdescription: \"New session token if other sessions were revoked\"\n\t\t\t\t\t},\n\t\t\t\t\tuser: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tdescription: \"The unique identifier of the user\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"email\",\n\t\t\t\t\t\t\t\tdescription: \"The email address of the user\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tdescription: \"The name of the user\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\timage: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"The profile image URL of the user\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\temailVerified: {\n\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\tdescription: \"Whether the email has been verified\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\tdescription: \"When the user was created\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\tdescription: \"When the user was last updated\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\"email\",\n\t\t\t\t\t\t\t\"name\",\n\t\t\t\t\t\t\t\"emailVerified\",\n\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\trequired: [\"user\"]\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tconst { newPassword, currentPassword, revokeOtherSessions: revokeOtherSessions$1 } = ctx.body;\n\tconst session = ctx.context.session;\n\tconst minPasswordLength = ctx.context.password.config.minPasswordLength;\n\tif (newPassword.length < minPasswordLength) {\n\t\tctx.context.logger.error(\"Password is too short\");\n\t\tthrow new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.PASSWORD_TOO_SHORT });\n\t}\n\tconst maxPasswordLength = ctx.context.password.config.maxPasswordLength;\n\tif (newPassword.length > maxPasswordLength) {\n\t\tctx.context.logger.error(\"Password is too long\");\n\t\tthrow new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.PASSWORD_TOO_LONG });\n\t}\n\tconst account = (await ctx.context.internalAdapter.findAccounts(session.user.id)).find((account$1) => account$1.providerId === \"credential\" && account$1.password);\n\tif (!account || !account.password) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.CREDENTIAL_ACCOUNT_NOT_FOUND });\n\tconst passwordHash = await ctx.context.password.hash(newPassword);\n\tif (!await ctx.context.password.verify({\n\t\thash: account.password,\n\t\tpassword: currentPassword\n\t})) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.INVALID_PASSWORD });\n\tawait ctx.context.internalAdapter.updateAccount(account.id, { password: passwordHash });\n\tlet token = null;\n\tif (revokeOtherSessions$1) {\n\t\tawait ctx.context.internalAdapter.deleteSessions(session.user.id);\n\t\tconst newSession = await ctx.context.internalAdapter.createSession(session.user.id);\n\t\tif (!newSession) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: BASE_ERROR_CODES.FAILED_TO_GET_SESSION });\n\t\tawait setSessionCookie(ctx, {\n\t\t\tsession: newSession,\n\t\t\tuser: session.user\n\t\t});\n\t\ttoken = newSession.token;\n\t}\n\treturn ctx.json({\n\t\ttoken,\n\t\tuser: {\n\t\t\tid: session.user.id,\n\t\t\temail: session.user.email,\n\t\t\tname: session.user.name,\n\t\t\timage: session.user.image,\n\t\t\temailVerified: session.user.emailVerified,\n\t\t\tcreatedAt: session.user.createdAt,\n\t\t\tupdatedAt: session.user.updatedAt\n\t\t}\n\t});\n});\nconst setPassword = createAuthEndpoint(\"/set-password\", {\n\tmethod: \"POST\",\n\tbody: z.object({ newPassword: z.string().meta({ description: \"The new password to set is required\" }) }),\n\tmetadata: { SERVER_ONLY: true },\n\tuse: [sensitiveSessionMiddleware]\n}, async (ctx) => {\n\tconst { newPassword } = ctx.body;\n\tconst session = ctx.context.session;\n\tconst minPasswordLength = ctx.context.password.config.minPasswordLength;\n\tif (newPassword.length < minPasswordLength) {\n\t\tctx.context.logger.error(\"Password is too short\");\n\t\tthrow new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.PASSWORD_TOO_SHORT });\n\t}\n\tconst maxPasswordLength = ctx.context.password.config.maxPasswordLength;\n\tif (newPassword.length > maxPasswordLength) {\n\t\tctx.context.logger.error(\"Password is too long\");\n\t\tthrow new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.PASSWORD_TOO_LONG });\n\t}\n\tconst account = (await ctx.context.internalAdapter.findAccounts(session.user.id)).find((account$1) => account$1.providerId === \"credential\" && account$1.password);\n\tconst passwordHash = await ctx.context.password.hash(newPassword);\n\tif (!account) {\n\t\tawait ctx.context.internalAdapter.linkAccount({\n\t\t\tuserId: session.user.id,\n\t\t\tproviderId: \"credential\",\n\t\t\taccountId: session.user.id,\n\t\t\tpassword: passwordHash\n\t\t});\n\t\treturn ctx.json({ status: true });\n\t}\n\tthrow new APIError(\"BAD_REQUEST\", { message: \"user already has a password\" });\n});\nconst deleteUser = createAuthEndpoint(\"/delete-user\", {\n\tmethod: \"POST\",\n\tuse: [sensitiveSessionMiddleware],\n\tbody: z.object({\n\t\tcallbackURL: z.string().meta({ description: \"The callback URL to redirect to after the user is deleted\" }).optional(),\n\t\tpassword: z.string().meta({ description: \"The password of the user is required to delete the user\" }).optional(),\n\t\ttoken: z.string().meta({ description: \"The token to delete the user is required\" }).optional()\n\t}),\n\tmetadata: { openapi: {\n\t\toperationId: \"deleteUser\",\n\t\tdescription: \"Delete the user\",\n\t\trequestBody: { content: { \"application/json\": { schema: {\n\t\t\ttype: \"object\",\n\t\t\tproperties: {\n\t\t\t\tcallbackURL: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\tdescription: \"The callback URL to redirect to after the user is deleted\"\n\t\t\t\t},\n\t\t\t\tpassword: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\tdescription: \"The user's password. Required if session is not fresh\"\n\t\t\t\t},\n\t\t\t\ttoken: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\tdescription: \"The deletion verification token\"\n\t\t\t\t}\n\t\t\t}\n\t\t} } } },\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"User deletion processed successfully\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: {\n\t\t\t\t\tsuccess: {\n\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\tdescription: \"Indicates if the operation was successful\"\n\t\t\t\t\t},\n\t\t\t\t\tmessage: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tenum: [\"User deleted\", \"Verification email sent\"],\n\t\t\t\t\t\tdescription: \"Status message of the deletion process\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\trequired: [\"success\", \"message\"]\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tif (!ctx.context.options.user?.deleteUser?.enabled) {\n\t\tctx.context.logger.error(\"Delete user is disabled. Enable it in the options\");\n\t\tthrow new APIError(\"NOT_FOUND\");\n\t}\n\tconst session = ctx.context.session;\n\tif (ctx.body.password) {\n\t\tconst account = (await ctx.context.internalAdapter.findAccounts(session.user.id)).find((account$1) => account$1.providerId === \"credential\" && account$1.password);\n\t\tif (!account || !account.password) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.CREDENTIAL_ACCOUNT_NOT_FOUND });\n\t\tif (!await ctx.context.password.verify({\n\t\t\thash: account.password,\n\t\t\tpassword: ctx.body.password\n\t\t})) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.INVALID_PASSWORD });\n\t}\n\tif (ctx.body.token) {\n\t\tawait deleteUserCallback({\n\t\t\t...ctx,\n\t\t\tquery: { token: ctx.body.token }\n\t\t});\n\t\treturn ctx.json({\n\t\t\tsuccess: true,\n\t\t\tmessage: \"User deleted\"\n\t\t});\n\t}\n\tif (ctx.context.options.user.deleteUser?.sendDeleteAccountVerification) {\n\t\tconst token = generateRandomString(32, \"0-9\", \"a-z\");\n\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\tvalue: session.user.id,\n\t\t\tidentifier: `delete-account-${token}`,\n\t\t\texpiresAt: new Date(Date.now() + (ctx.context.options.user.deleteUser?.deleteTokenExpiresIn || 3600 * 24) * 1e3)\n\t\t});\n\t\tconst url = `${ctx.context.baseURL}/delete-user/callback?token=${token}&callbackURL=${ctx.body.callbackURL || \"/\"}`;\n\t\tawait ctx.context.options.user.deleteUser.sendDeleteAccountVerification({\n\t\t\tuser: session.user,\n\t\t\turl,\n\t\t\ttoken\n\t\t}, ctx.request);\n\t\treturn ctx.json({\n\t\t\tsuccess: true,\n\t\t\tmessage: \"Verification email sent\"\n\t\t});\n\t}\n\tif (!ctx.body.password && ctx.context.sessionConfig.freshAge !== 0) {\n\t\tconst currentAge = new Date(session.session.createdAt).getTime();\n\t\tconst freshAge = ctx.context.sessionConfig.freshAge * 1e3;\n\t\tif (Date.now() - currentAge > freshAge * 1e3) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.SESSION_EXPIRED });\n\t}\n\tconst beforeDelete = ctx.context.options.user.deleteUser?.beforeDelete;\n\tif (beforeDelete) await beforeDelete(session.user, ctx.request);\n\tawait ctx.context.internalAdapter.deleteUser(session.user.id);\n\tawait ctx.context.internalAdapter.deleteSessions(session.user.id);\n\tdeleteSessionCookie(ctx);\n\tconst afterDelete = ctx.context.options.user.deleteUser?.afterDelete;\n\tif (afterDelete) await afterDelete(session.user, ctx.request);\n\treturn ctx.json({\n\t\tsuccess: true,\n\t\tmessage: \"User deleted\"\n\t});\n});\nconst deleteUserCallback = createAuthEndpoint(\"/delete-user/callback\", {\n\tmethod: \"GET\",\n\tquery: z.object({\n\t\ttoken: z.string().meta({ description: \"The token to verify the deletion request\" }),\n\t\tcallbackURL: z.string().meta({ description: \"The URL to redirect to after deletion\" }).optional()\n\t}),\n\tuse: [originCheck((ctx) => ctx.query.callbackURL)],\n\tmetadata: { openapi: {\n\t\tdescription: \"Callback to complete user deletion with verification token\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"User successfully deleted\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: {\n\t\t\t\t\tsuccess: {\n\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\tdescription: \"Indicates if the deletion was successful\"\n\t\t\t\t\t},\n\t\t\t\t\tmessage: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tenum: [\"User deleted\"],\n\t\t\t\t\t\tdescription: \"Confirmation message\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\trequired: [\"success\", \"message\"]\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tif (!ctx.context.options.user?.deleteUser?.enabled) {\n\t\tctx.context.logger.error(\"Delete user is disabled. Enable it in the options\");\n\t\tthrow new APIError(\"NOT_FOUND\");\n\t}\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session) throw new APIError(\"NOT_FOUND\", { message: BASE_ERROR_CODES.FAILED_TO_GET_USER_INFO });\n\tconst token = await ctx.context.internalAdapter.findVerificationValue(`delete-account-${ctx.query.token}`);\n\tif (!token || token.expiresAt < /* @__PURE__ */ new Date()) throw new APIError(\"NOT_FOUND\", { message: BASE_ERROR_CODES.INVALID_TOKEN });\n\tif (token.value !== session.user.id) throw new APIError(\"NOT_FOUND\", { message: BASE_ERROR_CODES.INVALID_TOKEN });\n\tconst beforeDelete = ctx.context.options.user.deleteUser?.beforeDelete;\n\tif (beforeDelete) await beforeDelete(session.user, ctx.request);\n\tawait ctx.context.internalAdapter.deleteUser(session.user.id);\n\tawait ctx.context.internalAdapter.deleteSessions(session.user.id);\n\tawait ctx.context.internalAdapter.deleteAccounts(session.user.id);\n\tawait ctx.context.internalAdapter.deleteVerificationValue(token.id);\n\tdeleteSessionCookie(ctx);\n\tconst afterDelete = ctx.context.options.user.deleteUser?.afterDelete;\n\tif (afterDelete) await afterDelete(session.user, ctx.request);\n\tif (ctx.query.callbackURL) throw ctx.redirect(ctx.query.callbackURL || \"/\");\n\treturn ctx.json({\n\t\tsuccess: true,\n\t\tmessage: \"User deleted\"\n\t});\n});\nconst changeEmail = createAuthEndpoint(\"/change-email\", {\n\tmethod: \"POST\",\n\tbody: z.object({\n\t\tnewEmail: z.email().meta({ description: \"The new email address to set must be a valid email address\" }),\n\t\tcallbackURL: z.string().meta({ description: \"The URL to redirect to after email verification\" }).optional()\n\t}),\n\tuse: [sensitiveSessionMiddleware],\n\tmetadata: { openapi: {\n\t\toperationId: \"changeEmail\",\n\t\tresponses: {\n\t\t\t\"200\": {\n\t\t\t\tdescription: \"Email change request processed successfully\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t$ref: \"#/components/schemas/User\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\tdescription: \"Indicates if the request was successful\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmessage: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tenum: [\"Email updated\", \"Verification email sent\"],\n\t\t\t\t\t\t\tdescription: \"Status message of the email change process\",\n\t\t\t\t\t\t\tnullable: true\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\trequired: [\"status\"]\n\t\t\t\t} } }\n\t\t\t},\n\t\t\t\"422\": {\n\t\t\t\tdescription: \"Unprocessable Entity. Email already exists\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: { message: { type: \"string\" } }\n\t\t\t\t} } }\n\t\t\t}\n\t\t}\n\t} }\n}, async (ctx) => {\n\tif (!ctx.context.options.user?.changeEmail?.enabled) {\n\t\tctx.context.logger.error(\"Change email is disabled.\");\n\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"Change email is disabled\" });\n\t}\n\tconst newEmail = ctx.body.newEmail.toLowerCase();\n\tif (newEmail === ctx.context.session.user.email) {\n\t\tctx.context.logger.error(\"Email is the same\");\n\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"Email is the same\" });\n\t}\n\tif (await ctx.context.internalAdapter.findUserByEmail(newEmail)) {\n\t\tctx.context.logger.error(\"Email already exists\");\n\t\tthrow new APIError(\"UNPROCESSABLE_ENTITY\", { message: BASE_ERROR_CODES.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL });\n\t}\n\t/**\n\t* If the email is not verified, we can update the email if the option is enabled\n\t*/\n\tif (ctx.context.session.user.emailVerified !== true && ctx.context.options.user.changeEmail.updateEmailWithoutVerification) {\n\t\tawait ctx.context.internalAdapter.updateUserByEmail(ctx.context.session.user.email, { email: newEmail });\n\t\tawait setSessionCookie(ctx, {\n\t\t\tsession: ctx.context.session.session,\n\t\t\tuser: {\n\t\t\t\t...ctx.context.session.user,\n\t\t\t\temail: newEmail\n\t\t\t}\n\t\t});\n\t\tif (ctx.context.options.emailVerification?.sendVerificationEmail) {\n\t\t\tconst token$1 = await createEmailVerificationToken(ctx.context.secret, newEmail, void 0, ctx.context.options.emailVerification?.expiresIn);\n\t\t\tconst url$1 = `${ctx.context.baseURL}/verify-email?token=${token$1}&callbackURL=${ctx.body.callbackURL || \"/\"}`;\n\t\t\tawait ctx.context.options.emailVerification.sendVerificationEmail({\n\t\t\t\tuser: {\n\t\t\t\t\t...ctx.context.session.user,\n\t\t\t\t\temail: newEmail\n\t\t\t\t},\n\t\t\t\turl: url$1,\n\t\t\t\ttoken: token$1\n\t\t\t}, ctx.request);\n\t\t}\n\t\treturn ctx.json({ status: true });\n\t}\n\tif (ctx.context.session.user.emailVerified && (ctx.context.options.user.changeEmail.sendChangeEmailConfirmation || ctx.context.options.user.changeEmail.sendChangeEmailVerification)) {\n\t\tconst token$1 = await createEmailVerificationToken(ctx.context.secret, ctx.context.session.user.email, newEmail, ctx.context.options.emailVerification?.expiresIn, { requestType: \"change-email-confirmation\" });\n\t\tconst url$1 = `${ctx.context.baseURL}/verify-email?token=${token$1}&callbackURL=${ctx.body.callbackURL || \"/\"}`;\n\t\tconst sendFn = ctx.context.options.user.changeEmail.sendChangeEmailConfirmation || ctx.context.options.user.changeEmail.sendChangeEmailVerification;\n\t\tif (sendFn) await sendFn({\n\t\t\tuser: ctx.context.session.user,\n\t\t\tnewEmail,\n\t\t\turl: url$1,\n\t\t\ttoken: token$1\n\t\t}, ctx.request);\n\t\treturn ctx.json({ status: true });\n\t}\n\tif (!ctx.context.options.emailVerification?.sendVerificationEmail) {\n\t\tctx.context.logger.error(\"Verification email isn't enabled.\");\n\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"Verification email isn't enabled\" });\n\t}\n\tconst token = await createEmailVerificationToken(ctx.context.secret, ctx.context.session.user.email, newEmail, ctx.context.options.emailVerification?.expiresIn, { requestType: \"change-email-verification\" });\n\tconst url = `${ctx.context.baseURL}/verify-email?token=${token}&callbackURL=${ctx.body.callbackURL || \"/\"}`;\n\tawait ctx.context.options.emailVerification.sendVerificationEmail({\n\t\tuser: {\n\t\t\t...ctx.context.session.user,\n\t\t\temail: newEmail\n\t\t},\n\t\turl,\n\t\ttoken\n\t}, ctx.request);\n\treturn ctx.json({ status: true });\n});\n\n//#endregion\n//#region src/api/to-auth-endpoints.ts\nconst defuReplaceArrays = createDefu((obj, key, value) => {\n\tif (Array.isArray(obj[key]) && Array.isArray(value)) {\n\t\tobj[key] = value;\n\t\treturn true;\n\t}\n});\nfunction toAuthEndpoints(endpoints, ctx) {\n\tconst api = {};\n\tfor (const [key, endpoint] of Object.entries(endpoints)) {\n\t\tapi[key] = async (context) => {\n\t\t\tconst run = async () => {\n\t\t\t\tconst authContext = await ctx;\n\t\t\t\tlet internalContext = {\n\t\t\t\t\t...context,\n\t\t\t\t\tcontext: {\n\t\t\t\t\t\t...authContext,\n\t\t\t\t\t\treturned: void 0,\n\t\t\t\t\t\tresponseHeaders: void 0,\n\t\t\t\t\t\tsession: null\n\t\t\t\t\t},\n\t\t\t\t\tpath: endpoint.path,\n\t\t\t\t\theaders: context?.headers ? new Headers(context?.headers) : void 0\n\t\t\t\t};\n\t\t\t\treturn runWithEndpointContext(internalContext, async () => {\n\t\t\t\t\tconst { beforeHooks, afterHooks } = getHooks(authContext);\n\t\t\t\t\tconst before = await runBeforeHooks(internalContext, beforeHooks);\n\t\t\t\t\t/**\n\t\t\t\t\t* If `before.context` is returned, it should\n\t\t\t\t\t* get merged with the original context\n\t\t\t\t\t*/\n\t\t\t\t\tif (\"context\" in before && before.context && typeof before.context === \"object\") {\n\t\t\t\t\t\tconst { headers, ...rest } = before.context;\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t* Headers should be merged differently\n\t\t\t\t\t\t* so the hook doesn't override the whole\n\t\t\t\t\t\t* header\n\t\t\t\t\t\t*/\n\t\t\t\t\t\tif (headers) headers.forEach((value, key$1) => {\n\t\t\t\t\t\t\tinternalContext.headers.set(key$1, value);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tinternalContext = defuReplaceArrays(rest, internalContext);\n\t\t\t\t\t} else if (before) return context?.asResponse ? toResponse(before, { headers: context?.headers }) : context?.returnHeaders ? {\n\t\t\t\t\t\theaders: context?.headers,\n\t\t\t\t\t\tresponse: before\n\t\t\t\t\t} : before;\n\t\t\t\t\tinternalContext.asResponse = false;\n\t\t\t\t\tinternalContext.returnHeaders = true;\n\t\t\t\t\tinternalContext.returnStatus = true;\n\t\t\t\t\tconst result = await runWithEndpointContext(internalContext, () => endpoint(internalContext)).catch((e) => {\n\t\t\t\t\t\tif (e instanceof APIError)\n /**\n\t\t\t\t\t\t* API Errors from response are caught\n\t\t\t\t\t\t* and returned to hooks\n\t\t\t\t\t\t*/\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tresponse: e,\n\t\t\t\t\t\t\tstatus: e.statusCode,\n\t\t\t\t\t\t\theaders: e.headers ? new Headers(e.headers) : null\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t});\n\t\t\t\t\tif (result && result instanceof Response) return result;\n\t\t\t\t\tinternalContext.context.returned = result.response;\n\t\t\t\t\tinternalContext.context.responseHeaders = result.headers;\n\t\t\t\t\tconst after = await runAfterHooks(internalContext, afterHooks);\n\t\t\t\t\tif (after.response) result.response = after.response;\n\t\t\t\t\tif (result.response instanceof APIError && shouldPublishLog(authContext.logger.level, \"debug\")) result.response.stack = result.response.errorStack;\n\t\t\t\t\tif (result.response instanceof APIError && !context?.asResponse) throw result.response;\n\t\t\t\t\treturn context?.asResponse ? toResponse(result.response, {\n\t\t\t\t\t\theaders: result.headers,\n\t\t\t\t\t\tstatus: result.status\n\t\t\t\t\t}) : context?.returnHeaders ? context?.returnStatus ? {\n\t\t\t\t\t\theaders: result.headers,\n\t\t\t\t\t\tresponse: result.response,\n\t\t\t\t\t\tstatus: result.status\n\t\t\t\t\t} : {\n\t\t\t\t\t\theaders: result.headers,\n\t\t\t\t\t\tresponse: result.response\n\t\t\t\t\t} : context?.returnStatus ? {\n\t\t\t\t\t\tresponse: result.response,\n\t\t\t\t\t\tstatus: result.status\n\t\t\t\t\t} : result.response;\n\t\t\t\t});\n\t\t\t};\n\t\t\tif (await hasRequestState()) return run();\n\t\t\telse return runWithRequestState(/* @__PURE__ */ new WeakMap(), run);\n\t\t};\n\t\tapi[key].path = endpoint.path;\n\t\tapi[key].options = endpoint.options;\n\t}\n\treturn api;\n}\nasync function runBeforeHooks(context, hooks) {\n\tlet modifiedContext = {};\n\tfor (const hook of hooks) if (hook.matcher(context)) {\n\t\tconst result = await hook.handler({\n\t\t\t...context,\n\t\t\treturnHeaders: false\n\t\t}).catch((e) => {\n\t\t\tif (e instanceof APIError && shouldPublishLog(context.context.logger.level, \"debug\")) e.stack = e.errorStack;\n\t\t\tthrow e;\n\t\t});\n\t\tif (result && typeof result === \"object\") {\n\t\t\tif (\"context\" in result && typeof result.context === \"object\") {\n\t\t\t\tconst { headers, ...rest } = result.context;\n\t\t\t\tif (headers instanceof Headers) if (modifiedContext.headers) headers.forEach((value, key) => {\n\t\t\t\t\tmodifiedContext.headers?.set(key, value);\n\t\t\t\t});\n\t\t\t\telse modifiedContext.headers = headers;\n\t\t\t\tmodifiedContext = defuReplaceArrays(rest, modifiedContext);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t}\n\treturn { context: modifiedContext };\n}\nasync function runAfterHooks(context, hooks) {\n\tfor (const hook of hooks) if (hook.matcher(context)) {\n\t\tconst result = await hook.handler(context).catch((e) => {\n\t\t\tif (e instanceof APIError) {\n\t\t\t\tif (shouldPublishLog(context.context.logger.level, \"debug\")) e.stack = e.errorStack;\n\t\t\t\treturn {\n\t\t\t\t\tresponse: e,\n\t\t\t\t\theaders: e.headers ? new Headers(e.headers) : null\n\t\t\t\t};\n\t\t\t}\n\t\t\tthrow e;\n\t\t});\n\t\tif (result.headers) result.headers.forEach((value, key) => {\n\t\t\tif (!context.context.responseHeaders) context.context.responseHeaders = new Headers({ [key]: value });\n\t\t\telse if (key.toLowerCase() === \"set-cookie\") context.context.responseHeaders.append(key, value);\n\t\t\telse context.context.responseHeaders.set(key, value);\n\t\t});\n\t\tif (result.response) context.context.returned = result.response;\n\t}\n\treturn {\n\t\tresponse: context.context.returned,\n\t\theaders: context.context.responseHeaders\n\t};\n}\nfunction getHooks(authContext) {\n\tconst plugins = authContext.options.plugins || [];\n\tconst beforeHooks = [];\n\tconst afterHooks = [];\n\tif (authContext.options.hooks?.before) beforeHooks.push({\n\t\tmatcher: () => true,\n\t\thandler: authContext.options.hooks.before\n\t});\n\tif (authContext.options.hooks?.after) afterHooks.push({\n\t\tmatcher: () => true,\n\t\thandler: authContext.options.hooks.after\n\t});\n\tconst pluginBeforeHooks = plugins.map((plugin) => {\n\t\tif (plugin.hooks?.before) return plugin.hooks.before;\n\t}).filter((plugin) => plugin !== void 0).flat();\n\tconst pluginAfterHooks = plugins.map((plugin) => {\n\t\tif (plugin.hooks?.after) return plugin.hooks.after;\n\t}).filter((plugin) => plugin !== void 0).flat();\n\t/**\n\t* Add plugin added hooks at last\n\t*/\n\tif (pluginBeforeHooks.length) beforeHooks.push(...pluginBeforeHooks);\n\tif (pluginAfterHooks.length) afterHooks.push(...pluginAfterHooks);\n\treturn {\n\t\tbeforeHooks,\n\t\tafterHooks\n\t};\n}\n\n//#endregion\n//#region src/api/index.ts\nfunction checkEndpointConflicts(options, logger$1) {\n\tconst endpointRegistry = /* @__PURE__ */ new Map();\n\toptions.plugins?.forEach((plugin) => {\n\t\tif (plugin.endpoints) {\n\t\t\tfor (const [key, endpoint] of Object.entries(plugin.endpoints)) if (endpoint && \"path\" in endpoint) {\n\t\t\t\tconst path = endpoint.path;\n\t\t\t\tlet methods = [];\n\t\t\t\tif (endpoint.options && \"method\" in endpoint.options) {\n\t\t\t\t\tif (Array.isArray(endpoint.options.method)) methods = endpoint.options.method;\n\t\t\t\t\telse if (typeof endpoint.options.method === \"string\") methods = [endpoint.options.method];\n\t\t\t\t}\n\t\t\t\tif (methods.length === 0) methods = [\"*\"];\n\t\t\t\tif (!endpointRegistry.has(path)) endpointRegistry.set(path, []);\n\t\t\t\tendpointRegistry.get(path).push({\n\t\t\t\t\tpluginId: plugin.id,\n\t\t\t\t\tendpointKey: key,\n\t\t\t\t\tmethods\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n\tconst conflicts = [];\n\tfor (const [path, entries] of endpointRegistry.entries()) if (entries.length > 1) {\n\t\tconst methodMap = /* @__PURE__ */ new Map();\n\t\tlet hasConflict = false;\n\t\tfor (const entry of entries) for (const method of entry.methods) {\n\t\t\tif (!methodMap.has(method)) methodMap.set(method, []);\n\t\t\tmethodMap.get(method).push(entry.pluginId);\n\t\t\tif (methodMap.get(method).length > 1) hasConflict = true;\n\t\t\tif (method === \"*\" && entries.length > 1) hasConflict = true;\n\t\t\telse if (method !== \"*\" && methodMap.has(\"*\")) hasConflict = true;\n\t\t}\n\t\tif (hasConflict) {\n\t\t\tconst uniquePlugins = [...new Set(entries.map((e) => e.pluginId))];\n\t\t\tconst conflictingMethods = [];\n\t\t\tfor (const [method, plugins] of methodMap.entries()) if (plugins.length > 1 || method === \"*\" && entries.length > 1 || method !== \"*\" && methodMap.has(\"*\")) conflictingMethods.push(method);\n\t\t\tconflicts.push({\n\t\t\t\tpath,\n\t\t\t\tplugins: uniquePlugins,\n\t\t\t\tconflictingMethods\n\t\t\t});\n\t\t}\n\t}\n\tif (conflicts.length > 0) {\n\t\tconst conflictMessages = conflicts.map((conflict) => `  - \"${conflict.path}\" [${conflict.conflictingMethods.join(\", \")}] used by plugins: ${conflict.plugins.join(\", \")}`).join(\"\\n\");\n\t\tlogger$1.error(`Endpoint path conflicts detected! Multiple plugins are trying to use the same endpoint paths with conflicting HTTP methods:\n${conflictMessages}\n\nTo resolve this, you can:\n\t1. Use only one of the conflicting plugins\n\t2. Configure the plugins to use different paths (if supported)\n\t3. Ensure plugins use different HTTP methods for the same path\n`);\n\t}\n}\nfunction getEndpoints(ctx, options) {\n\tconst pluginEndpoints = options.plugins?.reduce((acc, plugin) => {\n\t\treturn {\n\t\t\t...acc,\n\t\t\t...plugin.endpoints\n\t\t};\n\t}, {}) ?? {};\n\tconst middlewares = options.plugins?.map((plugin) => plugin.middlewares?.map((m) => {\n\t\tconst middleware = (async (context) => {\n\t\t\tconst authContext = await ctx;\n\t\t\treturn m.middleware({\n\t\t\t\t...context,\n\t\t\t\tcontext: {\n\t\t\t\t\t...authContext,\n\t\t\t\t\t...context.context\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\tmiddleware.options = m.middleware.options;\n\t\treturn {\n\t\t\tpath: m.path,\n\t\t\tmiddleware\n\t\t};\n\t})).filter((plugin) => plugin !== void 0).flat() || [];\n\treturn {\n\t\tapi: toAuthEndpoints({\n\t\t\tsignInSocial: signInSocial(),\n\t\t\tcallbackOAuth,\n\t\t\tgetSession: getSession(),\n\t\t\tsignOut,\n\t\t\tsignUpEmail: signUpEmail(),\n\t\t\tsignInEmail: signInEmail(),\n\t\t\tresetPassword,\n\t\t\tverifyEmail,\n\t\t\tsendVerificationEmail,\n\t\t\tchangeEmail,\n\t\t\tchangePassword,\n\t\t\tsetPassword,\n\t\t\tupdateUser: updateUser(),\n\t\t\tdeleteUser,\n\t\t\trequestPasswordReset,\n\t\t\trequestPasswordResetCallback,\n\t\t\tlistSessions: listSessions(),\n\t\t\trevokeSession,\n\t\t\trevokeSessions,\n\t\t\trevokeOtherSessions,\n\t\t\tlinkSocialAccount,\n\t\t\tlistUserAccounts,\n\t\t\tdeleteUserCallback,\n\t\t\tunlinkAccount,\n\t\t\trefreshToken,\n\t\t\tgetAccessToken,\n\t\t\taccountInfo,\n\t\t\t...pluginEndpoints,\n\t\t\tok,\n\t\t\terror\n\t\t}, ctx),\n\t\tmiddlewares\n\t};\n}\nconst router = (ctx, options) => {\n\tconst { api, middlewares } = getEndpoints(ctx, options);\n\tconst basePath = new URL(ctx.baseURL).pathname;\n\treturn createRouter(api, {\n\t\trouterContext: ctx,\n\t\topenapi: { disabled: true },\n\t\tbasePath,\n\t\trouterMiddleware: [{\n\t\t\tpath: \"/**\",\n\t\t\tmiddleware: originCheckMiddleware\n\t\t}, ...middlewares],\n\t\tallowedMediaTypes: [\"application/json\"],\n\t\tasync onRequest(req) {\n\t\t\tconst disabledPaths = ctx.options.disabledPaths || [];\n\t\t\tconst path = new URL(req.url).pathname.replace(basePath, \"\");\n\t\t\tif (disabledPaths.includes(path)) return new Response(\"Not Found\", { status: 404 });\n\t\t\tfor (const plugin of ctx.options.plugins || []) if (plugin.onRequest) {\n\t\t\t\tconst response = await plugin.onRequest(req, ctx);\n\t\t\t\tif (response && \"response\" in response) return response.response;\n\t\t\t\tif (response && \"request\" in response) {\n\t\t\t\t\tconst rateLimitResponse$1 = await onRequestRateLimit(response.request, ctx);\n\t\t\t\t\tif (rateLimitResponse$1) return rateLimitResponse$1;\n\t\t\t\t\treturn response.request;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn onRequestRateLimit(req, ctx);\n\t\t},\n\t\tasync onResponse(res) {\n\t\t\tfor (const plugin of ctx.options.plugins || []) if (plugin.onResponse) {\n\t\t\t\tconst response = await plugin.onResponse(res, ctx);\n\t\t\t\tif (response) return response.response;\n\t\t\t}\n\t\t\treturn res;\n\t\t},\n\t\tonError(e) {\n\t\t\tif (e instanceof APIError && e.status === \"FOUND\") return;\n\t\t\tif (options.onAPIError?.throw) throw e;\n\t\t\tif (options.onAPIError?.onError) {\n\t\t\t\toptions.onAPIError.onError(e, ctx);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst optLogLevel = options.logger?.level;\n\t\t\tconst log = optLogLevel === \"error\" || optLogLevel === \"warn\" || optLogLevel === \"debug\" ? logger : void 0;\n\t\t\tif (options.logger?.disabled !== true) {\n\t\t\t\tif (e && typeof e === \"object\" && \"message\" in e && typeof e.message === \"string\") {\n\t\t\t\t\tif (e.message.includes(\"no column\") || e.message.includes(\"column\") || e.message.includes(\"relation\") || e.message.includes(\"table\") || e.message.includes(\"does not exist\")) {\n\t\t\t\t\t\tctx.logger?.error(e.message);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (e instanceof APIError) {\n\t\t\t\t\tif (e.status === \"INTERNAL_SERVER_ERROR\") ctx.logger.error(e.status, e);\n\t\t\t\t\tlog?.error(e.message);\n\t\t\t\t} else ctx.logger?.error(e && typeof e === \"object\" && \"name\" in e ? e.name : \"\", e);\n\t\t\t}\n\t\t}\n\t});\n};\n\n//#endregion\nexport { getAccessToken as A, createEmailVerificationToken as C, callbackOAuth as D, verifyEmail as E, decryptOAuthToken as F, setTokenUtil as I, originCheck as L, listUserAccounts as M, refreshToken as N, handleOAuthUserInfo as O, unlinkAccount as P, originCheckMiddleware as R, error as S, sendVerificationEmailFn as T, signInSocial as _, getEndpoints as a, resetPassword as b, changeEmail as c, deleteUserCallback as d, setPassword as f, signInEmail as g, signOut as h, createAuthMiddleware$1 as i, linkSocialAccount as j, accountInfo as k, changePassword as l, signUpEmail as m, checkEndpointConflicts as n, optionsMiddleware as o, updateUser as p, createAuthEndpoint$1 as r, router as s, APIError$1 as t, deleteUser as u, requestPasswordReset as v, sendVerificationEmail as w, ok as x, requestPasswordResetCallback as y };","import { n as symmetricEncrypt, r as generateRandomString, t as symmetricDecrypt, u as constantTimeEqual } from \"./crypto-CFUhAR9W.mjs\";\nimport { u as getDate } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as APIError } from \"./api-CkmycQ2x.mjs\";\nimport { c as setSessionCookie, s as setCookieCache } from \"./cookies-D72PbWdz.mjs\";\nimport { r as getSessionFromCtx } from \"./session-AaRl3_x-.mjs\";\nimport { t as getEndpointResponse } from \"./plugin-helper-zFdFWLgL.mjs\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport * as z from \"zod\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\nimport { base64Url } from \"@better-auth/utils/base64\";\n\n//#region src/plugins/email-otp/utils.ts\nconst defaultKeyHasher = async (otp) => {\n\tconst hash = await createHash(\"SHA-256\").digest(new TextEncoder().encode(otp));\n\treturn base64Url.encode(new Uint8Array(hash), { padding: false });\n};\nfunction splitAtLastColon(input) {\n\tconst idx = input.lastIndexOf(\":\");\n\tif (idx === -1) return [input, \"\"];\n\treturn [input.slice(0, idx), input.slice(idx + 1)];\n}\n\n//#endregion\n//#region src/plugins/email-otp/index.ts\nconst types = [\n\t\"email-verification\",\n\t\"sign-in\",\n\t\"forget-password\"\n];\nconst defaultOTPGenerator = (options) => generateRandomString(options.otpLength ?? 6, \"0-9\");\nconst ERROR_CODES = defineErrorCodes({\n\tOTP_EXPIRED: \"OTP expired\",\n\tINVALID_OTP: \"Invalid OTP\",\n\tTOO_MANY_ATTEMPTS: \"Too many attempts\"\n});\nconst emailOTP = (options) => {\n\tconst opts = {\n\t\texpiresIn: 300,\n\t\tgenerateOTP: () => defaultOTPGenerator(options),\n\t\tstoreOTP: \"plain\",\n\t\t...options\n\t};\n\tasync function storeOTP(ctx, otp) {\n\t\tif (opts.storeOTP === \"encrypted\") return await symmetricEncrypt({\n\t\t\tkey: ctx.context.secret,\n\t\t\tdata: otp\n\t\t});\n\t\tif (opts.storeOTP === \"hashed\") return await defaultKeyHasher(otp);\n\t\tif (typeof opts.storeOTP === \"object\" && \"hash\" in opts.storeOTP) return await opts.storeOTP.hash(otp);\n\t\tif (typeof opts.storeOTP === \"object\" && \"encrypt\" in opts.storeOTP) return await opts.storeOTP.encrypt(otp);\n\t\treturn otp;\n\t}\n\tasync function verifyStoredOTP(ctx, storedOtp, otp) {\n\t\tif (opts.storeOTP === \"encrypted\") return constantTimeEqual(await symmetricDecrypt({\n\t\t\tkey: ctx.context.secret,\n\t\t\tdata: storedOtp\n\t\t}), otp);\n\t\tif (opts.storeOTP === \"hashed\") return constantTimeEqual(await defaultKeyHasher(otp), storedOtp);\n\t\tif (typeof opts.storeOTP === \"object\" && \"hash\" in opts.storeOTP) return constantTimeEqual(await opts.storeOTP.hash(otp), storedOtp);\n\t\tif (typeof opts.storeOTP === \"object\" && \"decrypt\" in opts.storeOTP) return constantTimeEqual(await opts.storeOTP.decrypt(storedOtp), otp);\n\t\treturn constantTimeEqual(otp, storedOtp);\n\t}\n\tconst endpoints = { sendVerificationOTP: createAuthEndpoint(\"/email-otp/send-verification-otp\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({\n\t\t\temail: z.string({}).meta({ description: \"Email address to send the OTP\" }),\n\t\t\ttype: z.enum(types).meta({ description: \"Type of the OTP\" })\n\t\t}),\n\t\tmetadata: { openapi: {\n\t\t\toperationId: \"sendEmailVerificationOTP\",\n\t\t\tdescription: \"Send a verification OTP to an email\",\n\t\t\tresponses: { 200: {\n\t\t\t\tdescription: \"Success\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: { success: { type: \"boolean\" } }\n\t\t\t\t} } }\n\t\t\t} }\n\t\t} }\n\t}, async (ctx) => {\n\t\tif (!options?.sendVerificationOTP) {\n\t\t\tctx.context.logger.error(\"send email verification is not implemented\");\n\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"send email verification is not implemented\" });\n\t\t}\n\t\tconst email = ctx.body.email.toLowerCase();\n\t\tif (!z.email().safeParse(email).success) throw ctx.error(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.INVALID_EMAIL });\n\t\tlet otp = opts.generateOTP({\n\t\t\temail,\n\t\t\ttype: ctx.body.type\n\t\t}, ctx) || defaultOTPGenerator(opts);\n\t\tlet storedOTP = await storeOTP(ctx, otp);\n\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\tvalue: `${storedOTP}:0`,\n\t\t\tidentifier: `${ctx.body.type}-otp-${email}`,\n\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\")\n\t\t}).catch(async (error) => {\n\t\t\tawait ctx.context.internalAdapter.deleteVerificationByIdentifier(`${ctx.body.type}-otp-${email}`);\n\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\tvalue: `${storedOTP}:0`,\n\t\t\t\tidentifier: `${ctx.body.type}-otp-${email}`,\n\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\")\n\t\t\t});\n\t\t});\n\t\tif (!await ctx.context.internalAdapter.findUserByEmail(email)) if (ctx.body.type === \"sign-in\" && !opts.disableSignUp) {} else {\n\t\t\tawait ctx.context.internalAdapter.deleteVerificationByIdentifier(`${ctx.body.type}-otp-${email}`);\n\t\t\treturn ctx.json({ success: true });\n\t\t}\n\t\tawait options.sendVerificationOTP({\n\t\t\temail,\n\t\t\totp,\n\t\t\ttype: ctx.body.type\n\t\t}, ctx);\n\t\treturn ctx.json({ success: true });\n\t}) };\n\treturn {\n\t\tid: \"email-otp\",\n\t\tinit(ctx) {\n\t\t\tif (!opts.overrideDefaultEmailVerification) return;\n\t\t\treturn { options: { emailVerification: { async sendVerificationEmail(data, request) {\n\t\t\t\tawait endpoints.sendVerificationOTP({\n\t\t\t\t\tcontext: ctx,\n\t\t\t\t\trequest,\n\t\t\t\t\tbody: {\n\t\t\t\t\t\temail: data.user.email,\n\t\t\t\t\t\ttype: \"email-verification\"\n\t\t\t\t\t},\n\t\t\t\t\tctx\n\t\t\t\t});\n\t\t\t} } } };\n\t\t},\n\t\tendpoints: {\n\t\t\t...endpoints,\n\t\t\tcreateVerificationOTP: createAuthEndpoint(\"/email-otp/create-verification-otp\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\temail: z.string({}).meta({ description: \"Email address to send the OTP\" }),\n\t\t\t\t\ttype: z.enum(types).meta({\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tdescription: \"Type of the OTP\"\n\t\t\t\t\t})\n\t\t\t\t}),\n\t\t\t\tmetadata: {\n\t\t\t\t\tSERVER_ONLY: true,\n\t\t\t\t\topenapi: {\n\t\t\t\t\t\toperationId: \"createEmailVerificationOTP\",\n\t\t\t\t\t\tdescription: \"Create a verification OTP for an email\",\n\t\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: { type: \"string\" } } }\n\t\t\t\t\t\t} }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst email = ctx.body.email.toLowerCase();\n\t\t\t\tconst otp = opts.generateOTP({\n\t\t\t\t\temail,\n\t\t\t\t\ttype: ctx.body.type\n\t\t\t\t}, ctx) || defaultOTPGenerator(opts);\n\t\t\t\tlet storedOTP = await storeOTP(ctx, otp);\n\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\tvalue: `${storedOTP}:0`,\n\t\t\t\t\tidentifier: `${ctx.body.type}-otp-${email}`,\n\t\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\")\n\t\t\t\t});\n\t\t\t\treturn otp;\n\t\t\t}),\n\t\t\tgetVerificationOTP: createAuthEndpoint(\"/email-otp/get-verification-otp\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tquery: z.object({\n\t\t\t\t\temail: z.string({}).meta({ description: \"Email address the OTP was sent to\" }),\n\t\t\t\t\ttype: z.enum(types).meta({\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tdescription: \"Type of the OTP\"\n\t\t\t\t\t})\n\t\t\t\t}),\n\t\t\t\tmetadata: {\n\t\t\t\t\tSERVER_ONLY: true,\n\t\t\t\t\topenapi: {\n\t\t\t\t\t\toperationId: \"getEmailVerificationOTP\",\n\t\t\t\t\t\tdescription: \"Get a verification OTP for an email\",\n\t\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\t\tdescription: \"OTP retrieved successfully or not found/expired\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: { otp: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\tdescription: \"The stored OTP, or null if not found or expired\"\n\t\t\t\t\t\t\t\t} },\n\t\t\t\t\t\t\t\trequired: [\"otp\"]\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t} }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst email = ctx.query.email.toLowerCase();\n\t\t\t\tconst verificationValue = await ctx.context.internalAdapter.findVerificationValue(`${ctx.query.type}-otp-${email}`);\n\t\t\t\tif (!verificationValue || verificationValue.expiresAt < /* @__PURE__ */ new Date()) return ctx.json({ otp: null });\n\t\t\t\tif (opts.storeOTP === \"hashed\" || typeof opts.storeOTP === \"object\" && \"hash\" in opts.storeOTP) throw new APIError(\"BAD_REQUEST\", { message: \"OTP is hashed, cannot return the plain text OTP\" });\n\t\t\t\tlet [storedOtp, _attempts] = splitAtLastColon(verificationValue.value);\n\t\t\t\tlet otp = storedOtp;\n\t\t\t\tif (opts.storeOTP === \"encrypted\") otp = await symmetricDecrypt({\n\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\tdata: storedOtp\n\t\t\t\t});\n\t\t\t\tif (typeof opts.storeOTP === \"object\" && \"decrypt\" in opts.storeOTP) otp = await opts.storeOTP.decrypt(storedOtp);\n\t\t\t\treturn ctx.json({ otp });\n\t\t\t}),\n\t\t\tcheckVerificationOTP: createAuthEndpoint(\"/email-otp/check-verification-otp\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\temail: z.string().meta({ description: \"Email address the OTP was sent to\" }),\n\t\t\t\t\ttype: z.enum(types).meta({\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tdescription: \"Type of the OTP\"\n\t\t\t\t\t}),\n\t\t\t\t\totp: z.string().meta({\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tdescription: \"OTP to verify\"\n\t\t\t\t\t})\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"verifyEmailWithOTP\",\n\t\t\t\t\tdescription: \"Verify an email with an OTP\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { success: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst email = ctx.body.email.toLowerCase();\n\t\t\t\tif (!z.email().safeParse(email).success) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.INVALID_EMAIL });\n\t\t\t\tif (!await ctx.context.internalAdapter.findUserByEmail(email)) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.USER_NOT_FOUND });\n\t\t\t\tconst verificationValue = await ctx.context.internalAdapter.findVerificationValue(`${ctx.body.type}-otp-${email}`);\n\t\t\t\tif (!verificationValue) throw new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_OTP });\n\t\t\t\tif (verificationValue.expiresAt < /* @__PURE__ */ new Date()) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.OTP_EXPIRED });\n\t\t\t\t}\n\t\t\t\tconst [otpValue, attempts] = splitAtLastColon(verificationValue.value);\n\t\t\t\tconst allowedAttempts = options?.allowedAttempts || 3;\n\t\t\t\tif (attempts && parseInt(attempts) >= allowedAttempts) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", { message: ERROR_CODES.TOO_MANY_ATTEMPTS });\n\t\t\t\t}\n\t\t\t\tif (!await verifyStoredOTP(ctx, otpValue, ctx.body.otp)) {\n\t\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(verificationValue.id, { value: `${otpValue}:${parseInt(attempts || \"0\") + 1}` });\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_OTP });\n\t\t\t\t}\n\t\t\t\treturn ctx.json({ success: true });\n\t\t\t}),\n\t\t\tverifyEmailOTP: createAuthEndpoint(\"/email-otp/verify-email\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\temail: z.string({}).meta({ description: \"Email address to verify\" }),\n\t\t\t\t\totp: z.string().meta({\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tdescription: \"OTP to verify\"\n\t\t\t\t\t})\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Verify email with OTP\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\tdescription: \"Indicates if the verification was successful\",\n\t\t\t\t\t\t\t\t\tenum: [true]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\tdescription: \"Session token if autoSignInAfterVerification is enabled, otherwise null\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\"status\",\n\t\t\t\t\t\t\t\t\"token\",\n\t\t\t\t\t\t\t\t\"user\"\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst email = ctx.body.email.toLowerCase();\n\t\t\t\tif (!z.email().safeParse(email).success) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.INVALID_EMAIL });\n\t\t\t\tconst verificationValue = await ctx.context.internalAdapter.findVerificationValue(`email-verification-otp-${email}`);\n\t\t\t\tif (!verificationValue) throw new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_OTP });\n\t\t\t\tif (verificationValue.expiresAt < /* @__PURE__ */ new Date()) throw new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.OTP_EXPIRED });\n\t\t\t\tconst [otpValue, attempts] = splitAtLastColon(verificationValue.value);\n\t\t\t\tconst allowedAttempts = options?.allowedAttempts || 3;\n\t\t\t\tif (attempts && parseInt(attempts) >= allowedAttempts) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", { message: ERROR_CODES.TOO_MANY_ATTEMPTS });\n\t\t\t\t}\n\t\t\t\tif (!await verifyStoredOTP(ctx, otpValue, ctx.body.otp)) {\n\t\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(verificationValue.id, { value: `${otpValue}:${parseInt(attempts || \"0\") + 1}` });\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_OTP });\n\t\t\t\t}\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\tconst user = await ctx.context.internalAdapter.findUserByEmail(email);\n\t\t\t\tif (!user)\n /**\n\t\t\t\t* safe to leak the existence of a user, given the user has already the OTP from the\n\t\t\t\t* email\n\t\t\t\t*/\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.USER_NOT_FOUND });\n\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(user.user.id, {\n\t\t\t\t\temail,\n\t\t\t\t\temailVerified: true\n\t\t\t\t});\n\t\t\t\tawait ctx.context.options.emailVerification?.onEmailVerification?.(updatedUser, ctx.request);\n\t\t\t\tif (ctx.context.options.emailVerification?.autoSignInAfterVerification) {\n\t\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(updatedUser.id);\n\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\tsession,\n\t\t\t\t\t\tuser: updatedUser\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\ttoken: session.token,\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tid: updatedUser.id,\n\t\t\t\t\t\t\temail: updatedUser.email,\n\t\t\t\t\t\t\temailVerified: updatedUser.emailVerified,\n\t\t\t\t\t\t\tname: updatedUser.name,\n\t\t\t\t\t\t\timage: updatedUser.image,\n\t\t\t\t\t\t\tcreatedAt: updatedUser.createdAt,\n\t\t\t\t\t\t\tupdatedAt: updatedUser.updatedAt\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst currentSession = await getSessionFromCtx(ctx);\n\t\t\t\tif (currentSession && updatedUser.emailVerified) {\n\t\t\t\t\tconst dontRememberMeCookie = await ctx.getSignedCookie(ctx.context.authCookies.dontRememberToken.name, ctx.context.secret);\n\t\t\t\t\tawait setCookieCache(ctx, {\n\t\t\t\t\t\tsession: currentSession.session,\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t...currentSession.user,\n\t\t\t\t\t\t\temailVerified: true\n\t\t\t\t\t\t}\n\t\t\t\t\t}, !!dontRememberMeCookie);\n\t\t\t\t}\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tstatus: true,\n\t\t\t\t\ttoken: null,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: updatedUser.id,\n\t\t\t\t\t\temail: updatedUser.email,\n\t\t\t\t\t\temailVerified: updatedUser.emailVerified,\n\t\t\t\t\t\tname: updatedUser.name,\n\t\t\t\t\t\timage: updatedUser.image,\n\t\t\t\t\t\tcreatedAt: updatedUser.createdAt,\n\t\t\t\t\t\tupdatedAt: updatedUser.updatedAt\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}),\n\t\t\tsignInEmailOTP: createAuthEndpoint(\"/sign-in/email-otp\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\temail: z.string({}).meta({ description: \"Email address to sign in\" }),\n\t\t\t\t\totp: z.string().meta({\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tdescription: \"OTP sent to the email\"\n\t\t\t\t\t})\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"signInWithEmailOTP\",\n\t\t\t\t\tdescription: \"Sign in with email and OTP\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Session token for the authenticated session\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuser: { $ref: \"#/components/schemas/User\" }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\"token\", \"user\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst email = ctx.body.email.toLowerCase();\n\t\t\t\tconst verificationValue = await ctx.context.internalAdapter.findVerificationValue(`sign-in-otp-${email}`);\n\t\t\t\tif (!verificationValue) throw new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_OTP });\n\t\t\t\tif (verificationValue.expiresAt < /* @__PURE__ */ new Date()) throw new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.OTP_EXPIRED });\n\t\t\t\tconst [otpValue, attempts] = splitAtLastColon(verificationValue.value);\n\t\t\t\tconst allowedAttempts = options?.allowedAttempts || 3;\n\t\t\t\tif (attempts && parseInt(attempts) >= allowedAttempts) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", { message: ERROR_CODES.TOO_MANY_ATTEMPTS });\n\t\t\t\t}\n\t\t\t\tif (!await verifyStoredOTP(ctx, otpValue, ctx.body.otp)) {\n\t\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(verificationValue.id, { value: `${otpValue}:${parseInt(attempts || \"0\") + 1}` });\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_OTP });\n\t\t\t\t}\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\tconst user = await ctx.context.internalAdapter.findUserByEmail(email);\n\t\t\t\tif (!user) {\n\t\t\t\t\tif (opts.disableSignUp) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.USER_NOT_FOUND });\n\t\t\t\t\tconst newUser = await ctx.context.internalAdapter.createUser({\n\t\t\t\t\t\temail,\n\t\t\t\t\t\temailVerified: true,\n\t\t\t\t\t\tname: \"\"\n\t\t\t\t\t});\n\t\t\t\t\tconst session$1 = await ctx.context.internalAdapter.createSession(newUser.id);\n\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\tsession: session$1,\n\t\t\t\t\t\tuser: newUser\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\ttoken: session$1.token,\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tid: newUser.id,\n\t\t\t\t\t\t\temail: newUser.email,\n\t\t\t\t\t\t\temailVerified: newUser.emailVerified,\n\t\t\t\t\t\t\tname: newUser.name,\n\t\t\t\t\t\t\timage: newUser.image,\n\t\t\t\t\t\t\tcreatedAt: newUser.createdAt,\n\t\t\t\t\t\t\tupdatedAt: newUser.updatedAt\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (!user.user.emailVerified) await ctx.context.internalAdapter.updateUser(user.user.id, { emailVerified: true });\n\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(user.user.id);\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser: user.user\n\t\t\t\t});\n\t\t\t\treturn ctx.json({\n\t\t\t\t\ttoken: session.token,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: user.user.id,\n\t\t\t\t\t\temail: user.user.email,\n\t\t\t\t\t\temailVerified: user.user.emailVerified,\n\t\t\t\t\t\tname: user.user.name,\n\t\t\t\t\t\timage: user.user.image,\n\t\t\t\t\t\tcreatedAt: user.user.createdAt,\n\t\t\t\t\t\tupdatedAt: user.user.updatedAt\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}),\n\t\t\tforgetPasswordEmailOTP: createAuthEndpoint(\"/forget-password/email-otp\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ email: z.string().meta({ description: \"Email address to send the OTP\" }) }),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"forgetPasswordWithEmailOTP\",\n\t\t\t\t\tdescription: \"Forget password with email and OTP\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { success: {\n\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\tdescription: \"Indicates if the OTP was sent successfully\"\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst email = ctx.body.email;\n\t\t\t\tconst otp = opts.generateOTP({\n\t\t\t\t\temail,\n\t\t\t\t\ttype: \"forget-password\"\n\t\t\t\t}, ctx) || defaultOTPGenerator(opts);\n\t\t\t\tlet storedOTP = await storeOTP(ctx, otp);\n\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\tvalue: `${storedOTP}:0`,\n\t\t\t\t\tidentifier: `forget-password-otp-${email}`,\n\t\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\")\n\t\t\t\t});\n\t\t\t\tif (!await ctx.context.internalAdapter.findUserByEmail(email)) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationByIdentifier(`forget-password-otp-${email}`);\n\t\t\t\t\treturn ctx.json({ success: true });\n\t\t\t\t}\n\t\t\t\tawait options.sendVerificationOTP({\n\t\t\t\t\temail,\n\t\t\t\t\totp,\n\t\t\t\t\ttype: \"forget-password\"\n\t\t\t\t}, ctx).catch((e) => {\n\t\t\t\t\tctx.context.logger.error(\"Failed to send OTP\", e);\n\t\t\t\t});\n\t\t\t\treturn ctx.json({ success: true });\n\t\t\t}),\n\t\t\tresetPasswordEmailOTP: createAuthEndpoint(\"/email-otp/reset-password\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\temail: z.string().meta({ description: \"Email address to reset the password\" }),\n\t\t\t\t\totp: z.string().meta({ description: \"OTP sent to the email\" }),\n\t\t\t\t\tpassword: z.string().meta({ description: \"New password\" })\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\toperationId: \"resetPasswordWithEmailOTP\",\n\t\t\t\t\tdescription: \"Reset password with email and OTP\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontnt: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { success: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst email = ctx.body.email;\n\t\t\t\tconst verificationValue = await ctx.context.internalAdapter.findVerificationValue(`forget-password-otp-${email}`);\n\t\t\t\tif (!verificationValue) throw new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_OTP });\n\t\t\t\tif (verificationValue.expiresAt < /* @__PURE__ */ new Date()) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.OTP_EXPIRED });\n\t\t\t\t}\n\t\t\t\tconst [otpValue, attempts] = splitAtLastColon(verificationValue.value);\n\t\t\t\tconst allowedAttempts = options?.allowedAttempts || 3;\n\t\t\t\tif (attempts && parseInt(attempts) >= allowedAttempts) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", { message: ERROR_CODES.TOO_MANY_ATTEMPTS });\n\t\t\t\t}\n\t\t\t\tif (!await verifyStoredOTP(ctx, otpValue, ctx.body.otp)) {\n\t\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(verificationValue.id, { value: `${otpValue}:${parseInt(attempts || \"0\") + 1}` });\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_OTP });\n\t\t\t\t}\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\tconst user = await ctx.context.internalAdapter.findUserByEmail(email, { includeAccounts: true });\n\t\t\t\tif (!user) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.USER_NOT_FOUND });\n\t\t\t\tconst minPasswordLength = ctx.context.password.config.minPasswordLength;\n\t\t\t\tif (ctx.body.password.length < minPasswordLength) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.PASSWORD_TOO_SHORT });\n\t\t\t\tconst maxPasswordLength = ctx.context.password.config.maxPasswordLength;\n\t\t\t\tif (ctx.body.password.length > maxPasswordLength) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.PASSWORD_TOO_LONG });\n\t\t\t\tconst passwordHash = await ctx.context.password.hash(ctx.body.password);\n\t\t\t\tif (!user.accounts?.find((account) => account.providerId === \"credential\")) await ctx.context.internalAdapter.createAccount({\n\t\t\t\t\tuserId: user.user.id,\n\t\t\t\t\tproviderId: \"credential\",\n\t\t\t\t\taccountId: user.user.id,\n\t\t\t\t\tpassword: passwordHash\n\t\t\t\t});\n\t\t\t\telse await ctx.context.internalAdapter.updatePassword(user.user.id, passwordHash);\n\t\t\t\tif (ctx.context.options.emailAndPassword?.onPasswordReset) await ctx.context.options.emailAndPassword.onPasswordReset({ user: user.user }, ctx.request);\n\t\t\t\tif (!user.user.emailVerified) await ctx.context.internalAdapter.updateUser(user.user.id, { emailVerified: true });\n\t\t\t\tif (ctx.context.options.emailAndPassword?.revokeSessionsOnPasswordReset) await ctx.context.internalAdapter.deleteSessions(user.user.id);\n\t\t\t\treturn ctx.json({ success: true });\n\t\t\t})\n\t\t},\n\t\thooks: { after: [{\n\t\t\tmatcher(context) {\n\t\t\t\treturn !!(context.path?.startsWith(\"/sign-up\") && opts.sendVerificationOnSignUp && !opts.overrideDefaultEmailVerification);\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst email = (await getEndpointResponse(ctx))?.user.email;\n\t\t\t\tif (email) {\n\t\t\t\t\tconst otp = opts.generateOTP({\n\t\t\t\t\t\temail,\n\t\t\t\t\t\ttype: ctx.body.type\n\t\t\t\t\t}, ctx) || defaultOTPGenerator(opts);\n\t\t\t\t\tlet storedOTP = await storeOTP(ctx, otp);\n\t\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\t\tvalue: `${storedOTP}:0`,\n\t\t\t\t\t\tidentifier: `email-verification-otp-${email}`,\n\t\t\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\")\n\t\t\t\t\t});\n\t\t\t\t\tawait options.sendVerificationOTP({\n\t\t\t\t\t\temail,\n\t\t\t\t\t\totp,\n\t\t\t\t\t\ttype: \"email-verification\"\n\t\t\t\t\t}, ctx);\n\t\t\t\t}\n\t\t\t})\n\t\t}] },\n\t\t$ERROR_CODES: ERROR_CODES,\n\t\trateLimit: [\n\t\t\t{\n\t\t\t\tpathMatcher(path) {\n\t\t\t\t\treturn path === \"/email-otp/send-verification-otp\";\n\t\t\t\t},\n\t\t\t\twindow: 60,\n\t\t\t\tmax: 3\n\t\t\t},\n\t\t\t{\n\t\t\t\tpathMatcher(path) {\n\t\t\t\t\treturn path === \"/email-otp/check-verification-otp\";\n\t\t\t\t},\n\t\t\t\twindow: 60,\n\t\t\t\tmax: 3\n\t\t\t},\n\t\t\t{\n\t\t\t\tpathMatcher(path) {\n\t\t\t\t\treturn path === \"/email-otp/verify-email\";\n\t\t\t\t},\n\t\t\t\twindow: 60,\n\t\t\t\tmax: 3\n\t\t\t},\n\t\t\t{\n\t\t\t\tpathMatcher(path) {\n\t\t\t\t\treturn path === \"/sign-in/email-otp\";\n\t\t\t\t},\n\t\t\t\twindow: 60,\n\t\t\t\tmax: 3\n\t\t\t}\n\t\t]\n\t};\n};\n\n//#endregion\nexport { emailOTP as t };","import { n as symmetricEncrypt, r as generateRandomString, t as symmetricDecrypt } from \"./crypto-CFUhAR9W.mjs\";\nimport { t as mergeSchema } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as APIError$1 } from \"./api-CkmycQ2x.mjs\";\nimport { l as parseSetCookieHeader } from \"./cookies-D72PbWdz.mjs\";\nimport { r as getSessionFromCtx, u as sessionMiddleware } from \"./session-AaRl3_x-.mjs\";\nimport { n as verifyJWT, r as getJwtToken } from \"./jwt-Ar1sciI2.mjs\";\nimport { getCurrentAuthContext } from \"@better-auth/core/context\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport { SignJWT, jwtVerify } from \"jose\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\nimport { base64, base64Url } from \"@better-auth/utils/base64\";\n\n//#region src/plugins/oidc-provider/error.ts\nvar OIDCProviderError = class extends APIError {};\nvar InvalidRequest = class extends OIDCProviderError {\n\tconstructor(error_description, error_detail) {\n\t\tsuper(\"BAD_REQUEST\", {\n\t\t\tmessage: \"invalid_request\",\n\t\t\terror_description,\n\t\t\terror_detail\n\t\t});\n\t}\n};\n\n//#endregion\n//#region src/plugins/oidc-provider/utils/prompt.ts\n/**\n* Parse space-separated prompt string into a set of prompts\n*\n* @param prompt\n*/\nfunction parsePrompt(prompt) {\n\tconst prompts = prompt.split(\" \").map((p) => p.trim());\n\tconst set = /* @__PURE__ */ new Set();\n\tfor (const p of prompts) if (p === \"login\" || p === \"consent\" || p === \"select_account\" || p === \"none\") set.add(p);\n\tif (set.has(\"none\") && set.size > 1) throw new InvalidRequest(\"prompt none must only be used alone\");\n\treturn new Set(set);\n}\n\n//#endregion\n//#region src/plugins/oidc-provider/authorize.ts\nfunction formatErrorURL(url, error, description) {\n\treturn `${url.includes(\"?\") ? \"&\" : \"?\"}error=${error}&error_description=${description}`;\n}\nfunction getErrorURL(ctx, error, description) {\n\treturn formatErrorURL(ctx.context.options.onAPIError?.errorURL || `${ctx.context.baseURL}/error`, error, description);\n}\nasync function authorize(ctx, options) {\n\tconst handleRedirect = (url) => {\n\t\tif (ctx.request?.headers.get(\"sec-fetch-mode\") === \"cors\") return ctx.json({\n\t\t\tredirect: true,\n\t\t\turl\n\t\t});\n\t\telse throw ctx.redirect(url);\n\t};\n\tconst opts = {\n\t\tcodeExpiresIn: 600,\n\t\tdefaultScope: \"openid\",\n\t\t...options,\n\t\tscopes: [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\",\n\t\t\t...options?.scopes || []\n\t\t]\n\t};\n\tif (!ctx.request) throw new APIError(\"UNAUTHORIZED\", {\n\t\terror_description: \"request not found\",\n\t\terror: \"invalid_request\"\n\t});\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session) {\n\t\tconst query$1 = ctx.query;\n\t\tif (parsePrompt(query$1.prompt ?? \"\").has(\"none\") && query$1.redirect_uri) return handleRedirect(formatErrorURL(query$1.redirect_uri, \"login_required\", \"Authentication required but prompt is none\"));\n\t\t/**\n\t\t* If the user is not logged in, we need to redirect them to the\n\t\t* login page.\n\t\t*/\n\t\tawait ctx.setSignedCookie(\"oidc_login_prompt\", JSON.stringify(ctx.query), ctx.context.secret, {\n\t\t\tmaxAge: 600,\n\t\t\tpath: \"/\",\n\t\t\tsameSite: \"lax\"\n\t\t});\n\t\tconst queryFromURL = ctx.request.url?.split(\"?\")[1];\n\t\treturn handleRedirect(`${options.loginPage}?${queryFromURL}`);\n\t}\n\tconst query = ctx.query;\n\tif (!query.client_id) {\n\t\tconst errorURL = getErrorURL(ctx, \"invalid_client\", \"client_id is required\");\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\tif (!query.response_type) {\n\t\tconst errorURL = getErrorURL(ctx, \"invalid_request\", \"response_type is required\");\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\tconst client = await getClient(ctx.query.client_id, options.trustedClients || []);\n\tif (!client) {\n\t\tconst errorURL = getErrorURL(ctx, \"invalid_client\", \"client_id is required\");\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\tconst redirectURI = client.redirectUrls.find((url) => url === ctx.query.redirect_uri);\n\tif (!redirectURI || !query.redirect_uri)\n /**\n\t* show UI error here warning the user that the redirect URI is invalid\n\t*/\n\tthrow new APIError(\"BAD_REQUEST\", { message: \"Invalid redirect URI\" });\n\tif (client.disabled) {\n\t\tconst errorURL = getErrorURL(ctx, \"client_disabled\", \"client is disabled\");\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\tif (query.response_type !== \"code\") {\n\t\tconst errorURL = getErrorURL(ctx, \"unsupported_response_type\", \"unsupported response type\");\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\tconst requestScope = query.scope?.split(\" \").filter((s) => s) || opts.defaultScope.split(\" \");\n\tconst invalidScopes = requestScope.filter((scope) => {\n\t\treturn !opts.scopes.includes(scope);\n\t});\n\tif (invalidScopes.length) return handleRedirect(formatErrorURL(query.redirect_uri, \"invalid_scope\", `The following scopes are invalid: ${invalidScopes.join(\", \")}`));\n\tif ((!query.code_challenge || !query.code_challenge_method) && options.requirePKCE) return handleRedirect(formatErrorURL(query.redirect_uri, \"invalid_request\", \"pkce is required\"));\n\tif (!query.code_challenge_method) query.code_challenge_method = \"plain\";\n\tif (![\"s256\", options.allowPlainCodeChallengeMethod ? \"plain\" : \"s256\"].includes(query.code_challenge_method?.toLowerCase() || \"\")) return handleRedirect(formatErrorURL(query.redirect_uri, \"invalid_request\", \"invalid code_challenge method\"));\n\tconst code = generateRandomString(32, \"a-z\", \"A-Z\", \"0-9\");\n\tconst codeExpiresInMs = opts.codeExpiresIn * 1e3;\n\tconst expiresAt = new Date(Date.now() + codeExpiresInMs);\n\tconst skipConsentForTrustedClient = client.skipConsent;\n\tconst hasAlreadyConsented = await ctx.context.adapter.findOne({\n\t\tmodel: \"oauthConsent\",\n\t\twhere: [{\n\t\t\tfield: \"clientId\",\n\t\t\tvalue: client.clientId\n\t\t}, {\n\t\t\tfield: \"userId\",\n\t\t\tvalue: session.user.id\n\t\t}]\n\t}).then((res) => {\n\t\tif (!res?.consentGiven) return false;\n\t\tconst consentedScopes = res.scopes ? res.scopes.split(\" \") : [];\n\t\treturn requestScope.every((scope) => consentedScopes.includes(scope));\n\t});\n\tconst promptSet = parsePrompt(query.prompt ?? \"\");\n\tif (promptSet.has(\"none\")) {\n\t\tif (!skipConsentForTrustedClient && !hasAlreadyConsented) return handleRedirect(formatErrorURL(query.redirect_uri, \"consent_required\", \"Consent required but prompt is none\"));\n\t}\n\tlet requireLogin = promptSet.has(\"login\");\n\tif (query.max_age !== void 0) {\n\t\tconst maxAge = Number(query.max_age);\n\t\tif (Number.isInteger(maxAge) && maxAge >= 0) {\n\t\t\tif ((Date.now() - new Date(session.session.createdAt).getTime()) / 1e3 > maxAge) requireLogin = true;\n\t\t}\n\t}\n\tconst requireConsent = !skipConsentForTrustedClient && (!hasAlreadyConsented || promptSet.has(\"consent\"));\n\ttry {\n\t\t/**\n\t\t* Save the code in the database\n\t\t*/\n\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\tvalue: JSON.stringify({\n\t\t\t\tclientId: client.clientId,\n\t\t\t\tredirectURI: query.redirect_uri,\n\t\t\t\tscope: requestScope,\n\t\t\t\tuserId: session.user.id,\n\t\t\t\tauthTime: new Date(session.session.createdAt).getTime(),\n\t\t\t\trequireConsent,\n\t\t\t\tstate: requireConsent ? query.state : null,\n\t\t\t\tcodeChallenge: query.code_challenge,\n\t\t\t\tcodeChallengeMethod: query.code_challenge_method,\n\t\t\t\tnonce: query.nonce\n\t\t\t}),\n\t\t\tidentifier: code,\n\t\t\texpiresAt\n\t\t});\n\t} catch (e) {\n\t\treturn handleRedirect(formatErrorURL(query.redirect_uri, \"server_error\", \"An error occurred while processing the request\"));\n\t}\n\tif (requireLogin) {\n\t\tawait ctx.setSignedCookie(\"oidc_login_prompt\", JSON.stringify(ctx.query), ctx.context.secret, {\n\t\t\tmaxAge: 600,\n\t\t\tpath: \"/\",\n\t\t\tsameSite: \"lax\"\n\t\t});\n\t\tawait ctx.setSignedCookie(\"oidc_consent_prompt\", code, ctx.context.secret, {\n\t\t\tmaxAge: 600,\n\t\t\tpath: \"/\",\n\t\t\tsameSite: \"lax\"\n\t\t});\n\t\treturn handleRedirect(`${options.loginPage}?${new URLSearchParams({\n\t\t\tclient_id: client.clientId,\n\t\t\tcode,\n\t\t\tstate: query.state\n\t\t}).toString()}`);\n\t}\n\tif (!requireConsent) {\n\t\tconst redirectURIWithCode = new URL(redirectURI);\n\t\tredirectURIWithCode.searchParams.set(\"code\", code);\n\t\tredirectURIWithCode.searchParams.set(\"state\", ctx.query.state);\n\t\treturn handleRedirect(redirectURIWithCode.toString());\n\t}\n\tif (options?.consentPage) {\n\t\tawait ctx.setSignedCookie(\"oidc_consent_prompt\", code, ctx.context.secret, {\n\t\t\tmaxAge: 600,\n\t\t\tpath: \"/\",\n\t\t\tsameSite: \"lax\"\n\t\t});\n\t\tconst urlParams = new URLSearchParams();\n\t\turlParams.set(\"consent_code\", code);\n\t\turlParams.set(\"client_id\", client.clientId);\n\t\turlParams.set(\"scope\", requestScope.join(\" \"));\n\t\treturn handleRedirect(`${options.consentPage}?${urlParams.toString()}`);\n\t}\n\tconst htmlFn = options?.getConsentHTML;\n\tif (!htmlFn) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: \"No consent page provided\" });\n\treturn new Response(htmlFn({\n\t\tscopes: requestScope,\n\t\tclientMetadata: client.metadata,\n\t\tclientIcon: client?.icon,\n\t\tclientId: client.clientId,\n\t\tclientName: client.name,\n\t\tcode\n\t}), { headers: { \"content-type\": \"text/html\" } });\n}\n\n//#endregion\n//#region src/plugins/oidc-provider/schema.ts\nconst oAuthApplicationSchema = z.object({\n\tclientId: z.string(),\n\tclientSecret: z.string().optional(),\n\ttype: z.enum([\n\t\t\"web\",\n\t\t\"native\",\n\t\t\"user-agent-based\",\n\t\t\"public\"\n\t]),\n\tname: z.string(),\n\ticon: z.string().optional(),\n\tmetadata: z.string().optional(),\n\tdisabled: z.boolean().optional().default(false),\n\tredirectUrls: z.string(),\n\tuserId: z.string().optional(),\n\tcreatedAt: z.date(),\n\tupdatedAt: z.date()\n});\nconst schema = {\n\toauthApplication: {\n\t\tmodelName: \"oauthApplication\",\n\t\tfields: {\n\t\t\tname: { type: \"string\" },\n\t\t\ticon: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false\n\t\t\t},\n\t\t\tmetadata: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false\n\t\t\t},\n\t\t\tclientId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tunique: true\n\t\t\t},\n\t\t\tclientSecret: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false\n\t\t\t},\n\t\t\tredirectUrls: { type: \"string\" },\n\t\t\ttype: { type: \"string\" },\n\t\t\tdisabled: {\n\t\t\t\ttype: \"boolean\",\n\t\t\t\trequired: false,\n\t\t\t\tdefaultValue: false\n\t\t\t},\n\t\t\tuserId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tonDelete: \"cascade\"\n\t\t\t\t},\n\t\t\t\tindex: true\n\t\t\t},\n\t\t\tcreatedAt: { type: \"date\" },\n\t\t\tupdatedAt: { type: \"date\" }\n\t\t}\n\t},\n\toauthAccessToken: {\n\t\tmodelName: \"oauthAccessToken\",\n\t\tfields: {\n\t\t\taccessToken: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tunique: true\n\t\t\t},\n\t\t\trefreshToken: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tunique: true\n\t\t\t},\n\t\t\taccessTokenExpiresAt: { type: \"date\" },\n\t\t\trefreshTokenExpiresAt: { type: \"date\" },\n\t\t\tclientId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"oauthApplication\",\n\t\t\t\t\tfield: \"clientId\",\n\t\t\t\t\tonDelete: \"cascade\"\n\t\t\t\t},\n\t\t\t\tindex: true\n\t\t\t},\n\t\t\tuserId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tonDelete: \"cascade\"\n\t\t\t\t},\n\t\t\t\tindex: true\n\t\t\t},\n\t\t\tscopes: { type: \"string\" },\n\t\t\tcreatedAt: { type: \"date\" },\n\t\t\tupdatedAt: { type: \"date\" }\n\t\t}\n\t},\n\toauthConsent: {\n\t\tmodelName: \"oauthConsent\",\n\t\tfields: {\n\t\t\tclientId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"oauthApplication\",\n\t\t\t\t\tfield: \"clientId\",\n\t\t\t\t\tonDelete: \"cascade\"\n\t\t\t\t},\n\t\t\t\tindex: true\n\t\t\t},\n\t\t\tuserId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tonDelete: \"cascade\"\n\t\t\t\t},\n\t\t\t\tindex: true\n\t\t\t},\n\t\t\tscopes: { type: \"string\" },\n\t\t\tcreatedAt: { type: \"date\" },\n\t\t\tupdatedAt: { type: \"date\" },\n\t\t\tconsentGiven: { type: \"boolean\" }\n\t\t}\n\t}\n};\n\n//#endregion\n//#region src/plugins/oidc-provider/utils.ts\n/**\n* Default client secret hasher using SHA-256\n*/\nconst defaultClientSecretHasher = async (clientSecret) => {\n\tconst hash = await createHash(\"SHA-256\").digest(new TextEncoder().encode(clientSecret));\n\treturn base64Url.encode(new Uint8Array(hash), { padding: false });\n};\n\n//#endregion\n//#region src/plugins/oidc-provider/index.ts\nconst getJwtPlugin = (ctx) => {\n\treturn ctx.context.options.plugins?.find((plugin) => plugin.id === \"jwt\");\n};\n/**\n* Get a client by ID, checking trusted clients first, then database\n*/\nasync function getClient(clientId, trustedClients = []) {\n\tconst { context: { adapter } } = await getCurrentAuthContext();\n\tconst trustedClient = trustedClients.find((client) => client.clientId === clientId);\n\tif (trustedClient) return trustedClient;\n\treturn adapter.findOne({\n\t\tmodel: \"oauthApplication\",\n\t\twhere: [{\n\t\t\tfield: \"clientId\",\n\t\t\tvalue: clientId\n\t\t}]\n\t}).then((res) => {\n\t\tif (!res) return null;\n\t\treturn {\n\t\t\tclientId: res.clientId,\n\t\t\tclientSecret: res.clientSecret,\n\t\t\ttype: res.type,\n\t\t\tname: res.name,\n\t\t\ticon: res.icon,\n\t\t\tdisabled: res.disabled,\n\t\t\tredirectUrls: (res.redirectUrls ?? \"\").split(\",\"),\n\t\t\tmetadata: res.metadata ? JSON.parse(res.metadata) : {}\n\t\t};\n\t});\n}\nconst getMetadata = (ctx, options) => {\n\tconst jwtPlugin = getJwtPlugin(ctx);\n\tconst issuer = jwtPlugin && jwtPlugin.options?.jwt && jwtPlugin.options.jwt.issuer ? jwtPlugin.options.jwt.issuer : ctx.context.options.baseURL;\n\tconst baseURL = ctx.context.baseURL;\n\tconst supportedAlgs = options?.useJWTPlugin ? [\n\t\t\"RS256\",\n\t\t\"EdDSA\",\n\t\t\"none\"\n\t] : [\"HS256\", \"none\"];\n\treturn {\n\t\tissuer,\n\t\tauthorization_endpoint: `${baseURL}/oauth2/authorize`,\n\t\ttoken_endpoint: `${baseURL}/oauth2/token`,\n\t\tuserinfo_endpoint: `${baseURL}/oauth2/userinfo`,\n\t\tjwks_uri: `${baseURL}/jwks`,\n\t\tregistration_endpoint: `${baseURL}/oauth2/register`,\n\t\tend_session_endpoint: `${baseURL}/oauth2/endsession`,\n\t\tscopes_supported: [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\"\n\t\t],\n\t\tresponse_types_supported: [\"code\"],\n\t\tresponse_modes_supported: [\"query\"],\n\t\tgrant_types_supported: [\"authorization_code\", \"refresh_token\"],\n\t\tacr_values_supported: [\"urn:mace:incommon:iap:silver\", \"urn:mace:incommon:iap:bronze\"],\n\t\tsubject_types_supported: [\"public\"],\n\t\tid_token_signing_alg_values_supported: supportedAlgs,\n\t\ttoken_endpoint_auth_methods_supported: [\n\t\t\t\"client_secret_basic\",\n\t\t\t\"client_secret_post\",\n\t\t\t\"none\"\n\t\t],\n\t\tcode_challenge_methods_supported: [\"S256\"],\n\t\tclaims_supported: [\n\t\t\t\"sub\",\n\t\t\t\"iss\",\n\t\t\t\"aud\",\n\t\t\t\"exp\",\n\t\t\t\"nbf\",\n\t\t\t\"iat\",\n\t\t\t\"jti\",\n\t\t\t\"email\",\n\t\t\t\"email_verified\",\n\t\t\t\"name\"\n\t\t],\n\t\t...options?.metadata\n\t};\n};\n/**\n* OpenID Connect (OIDC) plugin for Better Auth. This plugin implements the\n* authorization code flow and the token exchange flow. It also implements the\n* userinfo endpoint.\n*\n* @param options - The options for the OIDC plugin.\n* @returns A Better Auth plugin.\n*/\nconst oidcProvider = (options) => {\n\tconst modelName = {\n\t\toauthClient: \"oauthApplication\",\n\t\toauthAccessToken: \"oauthAccessToken\",\n\t\toauthConsent: \"oauthConsent\"\n\t};\n\tconst opts = {\n\t\tcodeExpiresIn: 600,\n\t\tdefaultScope: \"openid\",\n\t\taccessTokenExpiresIn: 3600,\n\t\trefreshTokenExpiresIn: 604800,\n\t\tallowPlainCodeChallengeMethod: true,\n\t\tstoreClientSecret: \"plain\",\n\t\t...options,\n\t\tscopes: [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\",\n\t\t\t...options?.scopes || []\n\t\t]\n\t};\n\tconst trustedClients = options.trustedClients || [];\n\t/**\n\t* Store client secret according to the configured storage method\n\t*/\n\tasync function storeClientSecret(ctx, clientSecret) {\n\t\tif (opts.storeClientSecret === \"encrypted\") return await symmetricEncrypt({\n\t\t\tkey: ctx.context.secret,\n\t\t\tdata: clientSecret\n\t\t});\n\t\tif (opts.storeClientSecret === \"hashed\") return await defaultClientSecretHasher(clientSecret);\n\t\tif (typeof opts.storeClientSecret === \"object\" && \"hash\" in opts.storeClientSecret) return await opts.storeClientSecret.hash(clientSecret);\n\t\tif (typeof opts.storeClientSecret === \"object\" && \"encrypt\" in opts.storeClientSecret) return await opts.storeClientSecret.encrypt(clientSecret);\n\t\treturn clientSecret;\n\t}\n\t/**\n\t* Verify stored client secret against provided client secret\n\t*/\n\tasync function verifyStoredClientSecret(ctx, storedClientSecret, clientSecret) {\n\t\tif (opts.storeClientSecret === \"encrypted\") return await symmetricDecrypt({\n\t\t\tkey: ctx.context.secret,\n\t\t\tdata: storedClientSecret\n\t\t}) === clientSecret;\n\t\tif (opts.storeClientSecret === \"hashed\") return await defaultClientSecretHasher(clientSecret) === storedClientSecret;\n\t\tif (typeof opts.storeClientSecret === \"object\" && \"hash\" in opts.storeClientSecret) return await opts.storeClientSecret.hash(clientSecret) === storedClientSecret;\n\t\tif (typeof opts.storeClientSecret === \"object\" && \"decrypt\" in opts.storeClientSecret) return await opts.storeClientSecret.decrypt(storedClientSecret) === clientSecret;\n\t\treturn clientSecret === storedClientSecret;\n\t}\n\treturn {\n\t\tid: \"oidc\",\n\t\thooks: { after: [{\n\t\t\tmatcher() {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst loginPromptCookie = await ctx.getSignedCookie(\"oidc_login_prompt\", ctx.context.secret);\n\t\t\t\tconst cookieName = ctx.context.authCookies.sessionToken.name;\n\t\t\t\tconst parsedSetCookieHeader = parseSetCookieHeader(ctx.context.responseHeaders?.get(\"set-cookie\") || \"\");\n\t\t\t\tconst hasSessionToken = parsedSetCookieHeader.has(cookieName);\n\t\t\t\tif (!loginPromptCookie || !hasSessionToken) return;\n\t\t\t\tctx.setCookie(\"oidc_login_prompt\", \"\", { maxAge: 0 });\n\t\t\t\tconst sessionToken = (parsedSetCookieHeader.get(cookieName)?.value)?.split(\".\")[0];\n\t\t\t\tif (!sessionToken) return;\n\t\t\t\tconst session = await ctx.context.internalAdapter.findSession(sessionToken) || ctx.context.newSession;\n\t\t\t\tif (!session) return;\n\t\t\t\tctx.query = JSON.parse(loginPromptCookie);\n\t\t\t\tconst promptSet = parsePrompt(String(ctx.query?.prompt));\n\t\t\t\tif (promptSet.has(\"login\")) {\n\t\t\t\t\tconst newPromptSet = new Set(promptSet);\n\t\t\t\t\tnewPromptSet.delete(\"login\");\n\t\t\t\t\tctx.query = {\n\t\t\t\t\t\t...ctx.query,\n\t\t\t\t\t\tprompt: Array.from(newPromptSet).join(\" \")\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tctx.context.session = session;\n\t\t\t\treturn await authorize(ctx, opts);\n\t\t\t})\n\t\t}] },\n\t\tendpoints: {\n\t\t\tgetOpenIdConfig: createAuthEndpoint(\"/.well-known/openid-configuration\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\toperationId: \"getOpenIdConfig\",\n\t\t\t\tmetadata: { isAction: false }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst metadata = getMetadata(ctx, options);\n\t\t\t\treturn ctx.json(metadata);\n\t\t\t}),\n\t\t\toAuth2authorize: createAuthEndpoint(\"/oauth2/authorize\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\toperationId: \"oauth2Authorize\",\n\t\t\t\tquery: z.record(z.string(), z.any()),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Authorize an OAuth2 request\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"Authorization response generated successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\tdescription: \"Authorization response, contents depend on the authorize function implementation\"\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\treturn authorize(ctx, opts);\n\t\t\t}),\n\t\t\toAuthConsent: createAuthEndpoint(\"/oauth2/consent\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\toperationId: \"oauth2Consent\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\taccept: z.boolean(),\n\t\t\t\t\tconsent_code: z.string().optional().nullish()\n\t\t\t\t}),\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Handle OAuth2 consent. Supports both URL parameter-based flows (consent_code in body) and cookie-based flows (signed cookie).\",\n\t\t\t\t\trequestBody: {\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\taccept: {\n\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\tdescription: \"Whether the user accepts or denies the consent request\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tconsent_code: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"The consent code from the authorization request. Optional if using cookie-based flow.\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\"accept\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t},\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"Consent processed successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { redirectURI: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\tdescription: \"The URI to redirect to, either with an authorization code or an error\"\n\t\t\t\t\t\t\t} },\n\t\t\t\t\t\t\trequired: [\"redirectURI\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tlet consentCode = ctx.body.consent_code || null;\n\t\t\t\tif (!consentCode) {\n\t\t\t\t\tconst cookieValue = await ctx.getSignedCookie(\"oidc_consent_prompt\", ctx.context.secret);\n\t\t\t\t\tif (cookieValue) consentCode = cookieValue;\n\t\t\t\t}\n\t\t\t\tif (!consentCode) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"consent_code is required (either in body or cookie)\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tconst verification = await ctx.context.internalAdapter.findVerificationValue(consentCode);\n\t\t\t\tif (!verification) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"Invalid code\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif (verification.expiresAt < /* @__PURE__ */ new Date()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"Code expired\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tctx.setCookie(\"oidc_consent_prompt\", \"\", { maxAge: 0 });\n\t\t\t\tconst value = JSON.parse(verification.value);\n\t\t\t\tif (!value.requireConsent) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"Consent not required\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif (!ctx.body.accept) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verification.id);\n\t\t\t\t\treturn ctx.json({ redirectURI: `${value.redirectURI}?error=access_denied&error_description=User denied access` });\n\t\t\t\t}\n\t\t\t\tconst code = generateRandomString(32, \"a-z\", \"A-Z\", \"0-9\");\n\t\t\t\tconst codeExpiresInMs = opts.codeExpiresIn * 1e3;\n\t\t\t\tconst expiresAt = new Date(Date.now() + codeExpiresInMs);\n\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(verification.id, {\n\t\t\t\t\tvalue: JSON.stringify({\n\t\t\t\t\t\t...value,\n\t\t\t\t\t\trequireConsent: false\n\t\t\t\t\t}),\n\t\t\t\t\tidentifier: code,\n\t\t\t\t\texpiresAt\n\t\t\t\t});\n\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\tmodel: modelName.oauthConsent,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tclientId: value.clientId,\n\t\t\t\t\t\tuserId: value.userId,\n\t\t\t\t\t\tscopes: value.scope.join(\" \"),\n\t\t\t\t\t\tconsentGiven: true,\n\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tconst redirectURI = new URL(value.redirectURI);\n\t\t\t\tredirectURI.searchParams.set(\"code\", code);\n\t\t\t\tif (value.state) redirectURI.searchParams.set(\"state\", value.state);\n\t\t\t\treturn ctx.json({ redirectURI: redirectURI.toString() });\n\t\t\t}),\n\t\t\toAuth2token: createAuthEndpoint(\"/oauth2/token\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\toperationId: \"oauth2Token\",\n\t\t\t\tbody: z.record(z.any(), z.any()),\n\t\t\t\tmetadata: {\n\t\t\t\t\tisAction: false,\n\t\t\t\t\tallowedMediaTypes: [\"application/x-www-form-urlencoded\", \"application/json\"]\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tlet { body } = ctx;\n\t\t\t\tif (!body) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"request body not found\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif (body instanceof FormData) body = Object.fromEntries(body.entries());\n\t\t\t\tif (!(body instanceof Object)) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"request body is not an object\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tlet { client_id, client_secret } = body;\n\t\t\t\tconst authorization = ctx.request?.headers.get(\"authorization\") || null;\n\t\t\t\tif (authorization && !client_id && !client_secret && authorization.startsWith(\"Basic \")) try {\n\t\t\t\t\tconst encoded = authorization.replace(\"Basic \", \"\");\n\t\t\t\t\tconst decoded = new TextDecoder().decode(base64.decode(encoded));\n\t\t\t\t\tif (!decoded.includes(\":\")) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t\tconst [id, secret] = decoded.split(\":\");\n\t\t\t\t\tif (!id || !secret) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t\tclient_id = id;\n\t\t\t\t\tclient_secret = secret;\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthrow new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst now = Date.now();\n\t\t\t\tconst iat = Math.floor(now / 1e3);\n\t\t\t\tconst exp = iat + (opts.accessTokenExpiresIn ?? 3600);\n\t\t\t\tconst accessTokenExpiresAt = /* @__PURE__ */ new Date(exp * 1e3);\n\t\t\t\tconst refreshTokenExpiresAt = /* @__PURE__ */ new Date((iat + (opts.refreshTokenExpiresIn ?? 604800)) * 1e3);\n\t\t\t\tconst { grant_type, code, redirect_uri, refresh_token, code_verifier } = body;\n\t\t\t\tif (grant_type === \"refresh_token\") {\n\t\t\t\t\tif (!refresh_token) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror_description: \"refresh_token is required\",\n\t\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t\t});\n\t\t\t\t\tconst token = await ctx.context.adapter.findOne({\n\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"refreshToken\",\n\t\t\t\t\t\t\tvalue: refresh_token.toString()\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t\tif (!token) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid refresh token\",\n\t\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t\t});\n\t\t\t\t\tif (token.clientId !== client_id?.toString()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t\tif (token.refreshTokenExpiresAt < /* @__PURE__ */ new Date()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"refresh token expired\",\n\t\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t\t});\n\t\t\t\t\tconst accessToken$1 = generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\t\tconst newRefreshToken = generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\taccessToken: accessToken$1,\n\t\t\t\t\t\t\trefreshToken: newRefreshToken,\n\t\t\t\t\t\t\taccessTokenExpiresAt,\n\t\t\t\t\t\t\trefreshTokenExpiresAt,\n\t\t\t\t\t\t\tclientId: client_id.toString(),\n\t\t\t\t\t\t\tuserId: token.userId,\n\t\t\t\t\t\t\tscopes: token.scopes,\n\t\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(iat * 1e3),\n\t\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(iat * 1e3)\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\taccess_token: accessToken$1,\n\t\t\t\t\t\ttoken_type: \"Bearer\",\n\t\t\t\t\t\texpires_in: opts.accessTokenExpiresIn,\n\t\t\t\t\t\trefresh_token: newRefreshToken,\n\t\t\t\t\t\tscope: token.scopes\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (!code) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"code is required\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif (options.requirePKCE && !code_verifier) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"code verifier is missing\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\t/**\n\t\t\t\t* We need to check if the code is valid before we can proceed\n\t\t\t\t* with the rest of the request.\n\t\t\t\t*/\n\t\t\t\tconst verificationValue = await ctx.context.internalAdapter.findVerificationValue(code.toString());\n\t\t\t\tif (!verificationValue) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"invalid code\",\n\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t});\n\t\t\t\tif (verificationValue.expiresAt < /* @__PURE__ */ new Date()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"code expired\",\n\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t});\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\tif (!client_id) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"client_id is required\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tif (!grant_type) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"grant_type is required\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif (grant_type !== \"authorization_code\") throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"grant_type must be 'authorization_code'\",\n\t\t\t\t\terror: \"unsupported_grant_type\"\n\t\t\t\t});\n\t\t\t\tif (!redirect_uri) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"redirect_uri is required\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tconst client = await getClient(client_id.toString(), trustedClients);\n\t\t\t\tif (!client) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tif (client.disabled) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"client is disabled\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tconst value = JSON.parse(verificationValue.value);\n\t\t\t\tif (value.clientId !== client_id.toString()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tif (value.redirectURI !== redirect_uri.toString()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"invalid redirect_uri\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tif (value.codeChallenge && !code_verifier) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"code verifier is missing\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif (client.type === \"public\") {\n\t\t\t\t\tif (!code_verifier) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror_description: \"code verifier is required for public clients\",\n\t\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tif (!client.clientSecret || !client_secret) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"client_secret is required for confidential clients\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t\tif (!await verifyStoredClientSecret(ctx, client.clientSecret, client_secret.toString())) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid client_secret\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif ((value.codeChallengeMethod === \"plain\" ? code_verifier : await createHash(\"SHA-256\", \"base64urlnopad\").digest(code_verifier)) !== value.codeChallenge) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"code verification failed\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tconst requestedScopes = value.scope;\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\tconst accessToken = generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\tconst refreshToken = generateRandomString(32, \"A-Z\", \"a-z\");\n\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\taccessToken,\n\t\t\t\t\t\trefreshToken,\n\t\t\t\t\t\taccessTokenExpiresAt,\n\t\t\t\t\t\trefreshTokenExpiresAt,\n\t\t\t\t\t\tclientId: client_id.toString(),\n\t\t\t\t\t\tuserId: value.userId,\n\t\t\t\t\t\tscopes: requestedScopes.join(\" \"),\n\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(iat * 1e3),\n\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(iat * 1e3)\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(value.userId);\n\t\t\t\tif (!user) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"user not found\",\n\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t});\n\t\t\t\tconst profile = {\n\t\t\t\t\tgiven_name: user.name.split(\" \")[0],\n\t\t\t\t\tfamily_name: user.name.split(\" \")[1],\n\t\t\t\t\tname: user.name,\n\t\t\t\t\tprofile: user.image,\n\t\t\t\t\tupdated_at: new Date(user.updatedAt).toISOString()\n\t\t\t\t};\n\t\t\t\tconst email = {\n\t\t\t\t\temail: user.email,\n\t\t\t\t\temail_verified: user.emailVerified\n\t\t\t\t};\n\t\t\t\tconst userClaims = {\n\t\t\t\t\t...requestedScopes.includes(\"profile\") ? profile : {},\n\t\t\t\t\t...requestedScopes.includes(\"email\") ? email : {}\n\t\t\t\t};\n\t\t\t\tconst additionalUserClaims = options.getAdditionalUserInfoClaim ? await options.getAdditionalUserInfoClaim(user, requestedScopes, client) : {};\n\t\t\t\tconst payload = {\n\t\t\t\t\tsub: user.id,\n\t\t\t\t\taud: client_id.toString(),\n\t\t\t\t\tiat,\n\t\t\t\t\tauth_time: ctx.context.session ? new Date(ctx.context.session.session.createdAt).getTime() : void 0,\n\t\t\t\t\tnonce: value.nonce,\n\t\t\t\t\tacr: \"urn:mace:incommon:iap:silver\",\n\t\t\t\t\t...userClaims,\n\t\t\t\t\t...additionalUserClaims\n\t\t\t\t};\n\t\t\t\tconst expirationTime = Math.floor(Date.now() / 1e3) + opts.accessTokenExpiresIn;\n\t\t\t\tlet idToken;\n\t\t\t\tif (options.useJWTPlugin) {\n\t\t\t\t\tconst jwtPlugin = getJwtPlugin(ctx);\n\t\t\t\t\tif (!jwtPlugin) {\n\t\t\t\t\t\tctx.context.logger.error(\"OIDC: `useJWTPlugin` is enabled but the JWT plugin is not available. Make sure you have the JWT Plugin in your plugins array or set `useJWTPlugin` to false.\");\n\t\t\t\t\t\tthrow new APIError$1(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\t\t\terror_description: \"JWT plugin is not enabled\",\n\t\t\t\t\t\t\terror: \"internal_server_error\"\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tidToken = await getJwtToken({\n\t\t\t\t\t\t...ctx,\n\t\t\t\t\t\tcontext: {\n\t\t\t\t\t\t\t...ctx.context,\n\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\t\tid: generateRandomString(32, \"a-z\", \"A-Z\"),\n\t\t\t\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(iat * 1e3),\n\t\t\t\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(iat * 1e3),\n\t\t\t\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\t\t\t\texpiresAt: accessTokenExpiresAt,\n\t\t\t\t\t\t\t\t\ttoken: accessToken,\n\t\t\t\t\t\t\t\t\tipAddress: ctx.request?.headers.get(\"x-forwarded-for\")\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuser\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\t...jwtPlugin.options,\n\t\t\t\t\t\tjwt: {\n\t\t\t\t\t\t\t...jwtPlugin.options?.jwt,\n\t\t\t\t\t\t\tgetSubject: () => user.id,\n\t\t\t\t\t\t\taudience: client_id.toString(),\n\t\t\t\t\t\t\tissuer: jwtPlugin.options?.jwt?.issuer ?? ctx.context.options.baseURL,\n\t\t\t\t\t\t\texpirationTime,\n\t\t\t\t\t\t\tdefinePayload: () => payload\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else idToken = await new SignJWT(payload).setProtectedHeader({ alg: \"HS256\" }).setIssuedAt(iat).setExpirationTime(accessTokenExpiresAt).sign(new TextEncoder().encode(client.clientSecret));\n\t\t\t\treturn ctx.json({\n\t\t\t\t\taccess_token: accessToken,\n\t\t\t\t\ttoken_type: \"Bearer\",\n\t\t\t\t\texpires_in: opts.accessTokenExpiresIn,\n\t\t\t\t\trefresh_token: requestedScopes.includes(\"offline_access\") ? refreshToken : void 0,\n\t\t\t\t\tscope: requestedScopes.join(\" \"),\n\t\t\t\t\tid_token: requestedScopes.includes(\"openid\") ? idToken : void 0\n\t\t\t\t}, { headers: {\n\t\t\t\t\t\"Cache-Control\": \"no-store\",\n\t\t\t\t\tPragma: \"no-cache\"\n\t\t\t\t} });\n\t\t\t}),\n\t\t\toAuth2userInfo: createAuthEndpoint(\"/oauth2/userinfo\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\toperationId: \"oauth2Userinfo\",\n\t\t\t\tmetadata: {\n\t\t\t\t\tisAction: false,\n\t\t\t\t\topenapi: {\n\t\t\t\t\t\tdescription: \"Get OAuth2 user information\",\n\t\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\t\tdescription: \"User information retrieved successfully\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\tsub: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"Subject identifier (user ID)\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tformat: \"email\",\n\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\tdescription: \"User's email address, included if 'email' scope is granted\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\tdescription: \"User's full name, included if 'profile' scope is granted\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tpicture: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\tdescription: \"User's profile picture URL, included if 'profile' scope is granted\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tgiven_name: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\tdescription: \"User's given name, included if 'profile' scope is granted\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tfamily_name: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\tdescription: \"User's family name, included if 'profile' scope is granted\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\temail_verified: {\n\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the email is verified, included if 'email' scope is granted\"\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\trequired: [\"sub\"]\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t} }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!ctx.request) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"request not found\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tconst authorization = ctx.request.headers.get(\"authorization\");\n\t\t\t\tif (!authorization) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"authorization header not found\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tconst token = authorization.replace(\"Bearer \", \"\");\n\t\t\t\tconst accessToken = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"accessToken\",\n\t\t\t\t\t\tvalue: token\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!accessToken) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"invalid access token\",\n\t\t\t\t\terror: \"invalid_token\"\n\t\t\t\t});\n\t\t\t\tif (accessToken.accessTokenExpiresAt < /* @__PURE__ */ new Date()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"The Access Token expired\",\n\t\t\t\t\terror: \"invalid_token\"\n\t\t\t\t});\n\t\t\t\tconst client = await getClient(accessToken.clientId, trustedClients);\n\t\t\t\tif (!client) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"client not found\",\n\t\t\t\t\terror: \"invalid_token\"\n\t\t\t\t});\n\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(accessToken.userId);\n\t\t\t\tif (!user) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"user not found\",\n\t\t\t\t\terror: \"invalid_token\"\n\t\t\t\t});\n\t\t\t\tconst requestedScopes = accessToken.scopes.split(\" \");\n\t\t\t\tconst baseUserClaims = {\n\t\t\t\t\tsub: user.id,\n\t\t\t\t\temail: requestedScopes.includes(\"email\") ? user.email : void 0,\n\t\t\t\t\tname: requestedScopes.includes(\"profile\") ? user.name : void 0,\n\t\t\t\t\tpicture: requestedScopes.includes(\"profile\") ? user.image : void 0,\n\t\t\t\t\tgiven_name: requestedScopes.includes(\"profile\") ? user.name.split(\" \")[0] : void 0,\n\t\t\t\t\tfamily_name: requestedScopes.includes(\"profile\") ? user.name.split(\" \")[1] : void 0,\n\t\t\t\t\temail_verified: requestedScopes.includes(\"email\") ? user.emailVerified : void 0\n\t\t\t\t};\n\t\t\t\tconst userClaims = options.getAdditionalUserInfoClaim ? await options.getAdditionalUserInfoClaim(user, requestedScopes, client) : baseUserClaims;\n\t\t\t\treturn ctx.json({\n\t\t\t\t\t...baseUserClaims,\n\t\t\t\t\t...userClaims\n\t\t\t\t});\n\t\t\t}),\n\t\t\tregisterOAuthApplication: createAuthEndpoint(\"/oauth2/register\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tredirect_uris: z.array(z.string()).meta({ description: \"A list of redirect URIs. Eg: [\\\"https://client.example.com/callback\\\"]\" }),\n\t\t\t\t\ttoken_endpoint_auth_method: z.enum([\n\t\t\t\t\t\t\"none\",\n\t\t\t\t\t\t\"client_secret_basic\",\n\t\t\t\t\t\t\"client_secret_post\"\n\t\t\t\t\t]).meta({ description: \"The authentication method for the token endpoint. Eg: \\\"client_secret_basic\\\"\" }).default(\"client_secret_basic\").optional(),\n\t\t\t\t\tgrant_types: z.array(z.enum([\n\t\t\t\t\t\t\"authorization_code\",\n\t\t\t\t\t\t\"implicit\",\n\t\t\t\t\t\t\"password\",\n\t\t\t\t\t\t\"client_credentials\",\n\t\t\t\t\t\t\"refresh_token\",\n\t\t\t\t\t\t\"urn:ietf:params:oauth:grant-type:jwt-bearer\",\n\t\t\t\t\t\t\"urn:ietf:params:oauth:grant-type:saml2-bearer\"\n\t\t\t\t\t])).meta({ description: \"The grant types supported by the application. Eg: [\\\"authorization_code\\\"]\" }).default([\"authorization_code\"]).optional(),\n\t\t\t\t\tresponse_types: z.array(z.enum([\"code\", \"token\"])).meta({ description: \"The response types supported by the application. Eg: [\\\"code\\\"]\" }).default([\"code\"]).optional(),\n\t\t\t\t\tclient_name: z.string().meta({ description: \"The name of the application. Eg: \\\"My App\\\"\" }).optional(),\n\t\t\t\t\tclient_uri: z.string().meta({ description: \"The URI of the application. Eg: \\\"https://client.example.com\\\"\" }).optional(),\n\t\t\t\t\tlogo_uri: z.string().meta({ description: \"The URI of the application logo. Eg: \\\"https://client.example.com/logo.png\\\"\" }).optional(),\n\t\t\t\t\tscope: z.string().meta({ description: \"The scopes supported by the application. Separated by spaces. Eg: \\\"profile email\\\"\" }).optional(),\n\t\t\t\t\tcontacts: z.array(z.string()).meta({ description: \"The contact information for the application. Eg: [\\\"admin@example.com\\\"]\" }).optional(),\n\t\t\t\t\ttos_uri: z.string().meta({ description: \"The URI of the application terms of service. Eg: \\\"https://client.example.com/tos\\\"\" }).optional(),\n\t\t\t\t\tpolicy_uri: z.string().meta({ description: \"The URI of the application privacy policy. Eg: \\\"https://client.example.com/policy\\\"\" }).optional(),\n\t\t\t\t\tjwks_uri: z.string().meta({ description: \"The URI of the application JWKS. Eg: \\\"https://client.example.com/jwks\\\"\" }).optional(),\n\t\t\t\t\tjwks: z.record(z.any(), z.any()).meta({ description: \"The JWKS of the application. Eg: {\\\"keys\\\": [{\\\"kty\\\": \\\"RSA\\\", \\\"alg\\\": \\\"RS256\\\", \\\"use\\\": \\\"sig\\\", \\\"n\\\": \\\"...\\\", \\\"e\\\": \\\"...\\\"}]}\" }).optional(),\n\t\t\t\t\tmetadata: z.record(z.any(), z.any()).meta({ description: \"The metadata of the application. Eg: {\\\"key\\\": \\\"value\\\"}\" }).optional(),\n\t\t\t\t\tsoftware_id: z.string().meta({ description: \"The software ID of the application. Eg: \\\"my-software\\\"\" }).optional(),\n\t\t\t\t\tsoftware_version: z.string().meta({ description: \"The software version of the application. Eg: \\\"1.0.0\\\"\" }).optional(),\n\t\t\t\t\tsoftware_statement: z.string().meta({ description: \"The software statement of the application.\" }).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Register an OAuth2 application\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"OAuth2 application registered successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Name of the OAuth2 application\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ticon: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\tdescription: \"Icon URL for the application\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\tdescription: \"Additional metadata for the application\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tclientId: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier for the client\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tclientSecret: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Secret key for the client\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tredirectURLs: {\n\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tformat: \"uri\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdescription: \"List of allowed redirect URLs\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttype: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Type of the client\",\n\t\t\t\t\t\t\t\t\tenum: [\"web\"]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tauthenticationScheme: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Authentication scheme used by the client\",\n\t\t\t\t\t\t\t\t\tenum: [\"client_secret\"]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdisabled: {\n\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\tdescription: \"Whether the client is disabled\",\n\t\t\t\t\t\t\t\t\tenum: [false]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\tdescription: \"ID of the user who registered the client, null if registered anonymously\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\tdescription: \"Creation timestamp\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\tdescription: \"Last update timestamp\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\"name\",\n\t\t\t\t\t\t\t\t\"clientId\",\n\t\t\t\t\t\t\t\t\"clientSecret\",\n\t\t\t\t\t\t\t\t\"redirectURLs\",\n\t\t\t\t\t\t\t\t\"type\",\n\t\t\t\t\t\t\t\t\"authenticationScheme\",\n\t\t\t\t\t\t\t\t\"disabled\",\n\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst body = ctx.body;\n\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\t\tif (!session && !options.allowDynamicClientRegistration) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror: \"invalid_token\",\n\t\t\t\t\terror_description: \"Authentication required for client registration\"\n\t\t\t\t});\n\t\t\t\tif ((!body.grant_types || body.grant_types.includes(\"authorization_code\") || body.grant_types.includes(\"implicit\")) && (!body.redirect_uris || body.redirect_uris.length === 0)) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_redirect_uri\",\n\t\t\t\t\terror_description: \"Redirect URIs are required for authorization_code and implicit grant types\"\n\t\t\t\t});\n\t\t\t\tif (body.grant_types && body.response_types) {\n\t\t\t\t\tif (body.grant_types.includes(\"authorization_code\") && !body.response_types.includes(\"code\")) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_client_metadata\",\n\t\t\t\t\t\terror_description: \"When 'authorization_code' grant type is used, 'code' response type must be included\"\n\t\t\t\t\t});\n\t\t\t\t\tif (body.grant_types.includes(\"implicit\") && !body.response_types.includes(\"token\")) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_client_metadata\",\n\t\t\t\t\t\terror_description: \"When 'implicit' grant type is used, 'token' response type must be included\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst clientId = options.generateClientId?.() || generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\tconst clientSecret = options.generateClientSecret?.() || generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\tconst storedClientSecret = await storeClientSecret(ctx, clientSecret);\n\t\t\t\tconst client = await ctx.context.adapter.create({\n\t\t\t\t\tmodel: modelName.oauthClient,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tname: body.client_name,\n\t\t\t\t\t\ticon: body.logo_uri,\n\t\t\t\t\t\tmetadata: body.metadata ? JSON.stringify(body.metadata) : null,\n\t\t\t\t\t\tclientId,\n\t\t\t\t\t\tclientSecret: storedClientSecret,\n\t\t\t\t\t\tredirectUrls: body.redirect_uris.join(\",\"),\n\t\t\t\t\t\ttype: \"web\",\n\t\t\t\t\t\tauthenticationScheme: body.token_endpoint_auth_method || \"client_secret_basic\",\n\t\t\t\t\t\tdisabled: false,\n\t\t\t\t\t\tuserId: session?.session.userId,\n\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tclient_id: clientId,\n\t\t\t\t\t...client.type !== \"public\" ? {\n\t\t\t\t\t\tclient_secret: clientSecret,\n\t\t\t\t\t\tclient_secret_expires_at: 0\n\t\t\t\t\t} : {},\n\t\t\t\t\tclient_id_issued_at: Math.floor(Date.now() / 1e3),\n\t\t\t\t\tclient_secret_expires_at: 0,\n\t\t\t\t\tredirect_uris: body.redirect_uris,\n\t\t\t\t\ttoken_endpoint_auth_method: body.token_endpoint_auth_method || \"client_secret_basic\",\n\t\t\t\t\tgrant_types: body.grant_types || [\"authorization_code\"],\n\t\t\t\t\tresponse_types: body.response_types || [\"code\"],\n\t\t\t\t\tclient_name: body.client_name,\n\t\t\t\t\tclient_uri: body.client_uri,\n\t\t\t\t\tlogo_uri: body.logo_uri,\n\t\t\t\t\tscope: body.scope,\n\t\t\t\t\tcontacts: body.contacts,\n\t\t\t\t\ttos_uri: body.tos_uri,\n\t\t\t\t\tpolicy_uri: body.policy_uri,\n\t\t\t\t\tjwks_uri: body.jwks_uri,\n\t\t\t\t\tjwks: body.jwks,\n\t\t\t\t\tsoftware_id: body.software_id,\n\t\t\t\t\tsoftware_version: body.software_version,\n\t\t\t\t\tsoftware_statement: body.software_statement,\n\t\t\t\t\tmetadata: body.metadata\n\t\t\t\t}, {\n\t\t\t\t\tstatus: 201,\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"Cache-Control\": \"no-store\",\n\t\t\t\t\t\tPragma: \"no-cache\"\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}),\n\t\t\tgetOAuthClient: createAuthEndpoint(\"/oauth2/client/:id\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Get OAuth2 client details\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"OAuth2 client retrieved successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tclientId: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier for the client\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Name of the OAuth2 application\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ticon: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\tdescription: \"Icon URL for the application\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\"clientId\", \"name\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst client = await getClient(ctx.params.id, trustedClients);\n\t\t\t\tif (!client) throw new APIError$1(\"NOT_FOUND\", {\n\t\t\t\t\terror_description: \"client not found\",\n\t\t\t\t\terror: \"not_found\"\n\t\t\t\t});\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tclientId: client.clientId,\n\t\t\t\t\tname: client.name,\n\t\t\t\t\ticon: client.icon || null\n\t\t\t\t});\n\t\t\t}),\n\t\t\tendSession: createAuthEndpoint(\"/oauth2/endsession\", {\n\t\t\t\tmethod: [\"GET\", \"POST\"],\n\t\t\t\toperationId: \"oauth2EndSession\",\n\t\t\t\tquery: z.object({\n\t\t\t\t\tid_token_hint: z.string().optional(),\n\t\t\t\t\tlogout_hint: z.string().optional(),\n\t\t\t\t\tclient_id: z.string().optional(),\n\t\t\t\t\tpost_logout_redirect_uri: z.string().optional(),\n\t\t\t\t\tstate: z.string().optional(),\n\t\t\t\t\tui_locales: z.string().optional()\n\t\t\t\t}).optional(),\n\t\t\t\tmetadata: {\n\t\t\t\t\tisAction: false,\n\t\t\t\t\topenapi: {\n\t\t\t\t\t\tdescription: \"RP-Initiated Logout endpoint. Logs out the end-user and optionally redirects to a post-logout URI.\",\n\t\t\t\t\t\tparameters: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: \"id_token_hint\",\n\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\tdescription: \"Previously issued ID Token passed as a hint about the End-User's current authenticated session\",\n\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\tschema: { type: \"string\" }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: \"logout_hint\",\n\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\tdescription: \"Hint to the Authorization Server about the End-User that is logging out\",\n\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\tschema: { type: \"string\" }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: \"client_id\",\n\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\tdescription: \"OAuth 2.0 Client Identifier. Required if post_logout_redirect_uri is used without id_token_hint\",\n\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\tschema: { type: \"string\" }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: \"post_logout_redirect_uri\",\n\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\tdescription: \"URL to which the RP is requesting that the End-User's User Agent be redirected after a logout has been performed\",\n\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tformat: \"uri\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: \"state\",\n\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\tdescription: \"Opaque value used by the RP to maintain state between the logout request and the callback\",\n\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\tschema: { type: \"string\" }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: \"ui_locales\",\n\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\tdescription: \"End-User's preferred languages and scripts for the user interface\",\n\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\tschema: { type: \"string\" }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t],\n\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\"302\": { description: \"Redirect to post_logout_redirect_uri or logout confirmation page\" },\n\t\t\t\t\t\t\t\"200\": { description: \"Logout completed successfully\" }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { id_token_hint, logout_hint, client_id, post_logout_redirect_uri, state, ui_locales } = ctx.query || {};\n\t\t\t\tlet validatedClientId = null;\n\t\t\t\tlet validatedUserId = null;\n\t\t\t\tif (id_token_hint) try {\n\t\t\t\t\tconst jwtPlugin = getJwtPlugin(ctx);\n\t\t\t\t\tif (jwtPlugin && jwtPlugin.options && options?.useJWTPlugin) {\n\t\t\t\t\t\tconst verified = await verifyJWT(id_token_hint, jwtPlugin.options);\n\t\t\t\t\t\tif (verified) {\n\t\t\t\t\t\t\tvalidatedUserId = verified.sub;\n\t\t\t\t\t\t\tvalidatedClientId = verified.aud ? typeof verified.aud === \"string\" ? verified.aud : verified.aud[0] : null;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (client_id) {\n\t\t\t\t\t\tconst client = await getClient(client_id, trustedClients);\n\t\t\t\t\t\tif (client && client.clientSecret) try {\n\t\t\t\t\t\t\tconst { payload } = await jwtVerify(id_token_hint, new TextEncoder().encode(client.clientSecret));\n\t\t\t\t\t\t\tvalidatedUserId = payload.sub;\n\t\t\t\t\t\t\tvalidatedClientId = payload.aud;\n\t\t\t\t\t\t} catch (error) {}\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tctx.context.logger.debug(\"Invalid id_token_hint provided to end_session endpoint\");\n\t\t\t\t}\n\t\t\t\tif (client_id) {\n\t\t\t\t\tif (!await getClient(client_id, trustedClients)) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\terror_description: \"Invalid client_id\"\n\t\t\t\t\t});\n\t\t\t\t\tif (validatedClientId && validatedClientId !== client_id) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\terror_description: \"client_id does not match the ID Token's audience\"\n\t\t\t\t\t});\n\t\t\t\t\tvalidatedClientId = client_id;\n\t\t\t\t}\n\t\t\t\tif (post_logout_redirect_uri) {\n\t\t\t\t\tif (!validatedClientId) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\terror_description: \"client_id is required when using post_logout_redirect_uri without a valid id_token_hint\"\n\t\t\t\t\t});\n\t\t\t\t\tconst client = await getClient(validatedClientId, trustedClients);\n\t\t\t\t\tif (!client) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\terror_description: \"Invalid client\"\n\t\t\t\t\t});\n\t\t\t\t\tif (!client.redirectUrls.some((registeredUri) => post_logout_redirect_uri === registeredUri)) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\terror_description: \"post_logout_redirect_uri is not registered for this client\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\t\tif (validatedUserId || session) {\n\t\t\t\t\tconst userId = validatedUserId || session?.user.id;\n\t\t\t\t\tif (userId) await ctx.context.adapter.deleteMany({\n\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\t\tvalue: userId\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (session) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteSession(session.session.token);\n\t\t\t\t\tctx.setSignedCookie(ctx.context.authCookies.sessionToken.name, \"\", ctx.context.secret, { maxAge: 0 });\n\t\t\t\t}\n\t\t\t\tif (post_logout_redirect_uri) try {\n\t\t\t\t\tconst redirectUrl = new URL(post_logout_redirect_uri);\n\t\t\t\t\tif (state) redirectUrl.searchParams.set(\"state\", state);\n\t\t\t\t\treturn ctx.redirect(redirectUrl.toString());\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthrow new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\terror_description: \"Invalid post_logout_redirect_uri format\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tsuccess: true,\n\t\t\t\t\tmessage: \"Logout successful\"\n\t\t\t\t});\n\t\t\t})\n\t\t},\n\t\tschema: mergeSchema(schema, options?.schema),\n\t\tget options() {\n\t\t\treturn opts;\n\t\t}\n\t};\n};\n\n//#endregion\nexport { parsePrompt as a, schema as i, getMetadata as n, oidcProvider as r, getClient as t };","import { is } from \"../entity.js\";\nimport { PgTable } from \"./table.js\";\nimport { SQL } from \"../sql/sql.js\";\nimport { Subquery } from \"../subquery.js\";\nimport { Schema, Table } from \"../table.js\";\nimport { ViewBaseConfig } from \"../view-common.js\";\nimport { CheckBuilder } from \"./checks.js\";\nimport { ForeignKeyBuilder } from \"./foreign-keys.js\";\nimport { IndexBuilder } from \"./indexes.js\";\nimport { PgPolicy } from \"./policies.js\";\nimport { PrimaryKeyBuilder } from \"./primary-keys.js\";\nimport { UniqueConstraintBuilder } from \"./unique-constraint.js\";\nimport { PgViewConfig } from \"./view-common.js\";\nimport { PgMaterializedViewConfig } from \"./view.js\";\nfunction getTableConfig(table) {\n  const columns = Object.values(table[Table.Symbol.Columns]);\n  const indexes = [];\n  const checks = [];\n  const primaryKeys = [];\n  const foreignKeys = Object.values(table[PgTable.Symbol.InlineForeignKeys]);\n  const uniqueConstraints = [];\n  const name = table[Table.Symbol.Name];\n  const schema = table[Table.Symbol.Schema];\n  const policies = [];\n  const enableRLS = table[PgTable.Symbol.EnableRLS];\n  const extraConfigBuilder = table[PgTable.Symbol.ExtraConfigBuilder];\n  if (extraConfigBuilder !== void 0) {\n    const extraConfig = extraConfigBuilder(table[Table.Symbol.ExtraConfigColumns]);\n    const extraValues = Array.isArray(extraConfig) ? extraConfig.flat(1) : Object.values(extraConfig);\n    for (const builder of extraValues) {\n      if (is(builder, IndexBuilder)) {\n        indexes.push(builder.build(table));\n      } else if (is(builder, CheckBuilder)) {\n        checks.push(builder.build(table));\n      } else if (is(builder, UniqueConstraintBuilder)) {\n        uniqueConstraints.push(builder.build(table));\n      } else if (is(builder, PrimaryKeyBuilder)) {\n        primaryKeys.push(builder.build(table));\n      } else if (is(builder, ForeignKeyBuilder)) {\n        foreignKeys.push(builder.build(table));\n      } else if (is(builder, PgPolicy)) {\n        policies.push(builder);\n      }\n    }\n  }\n  return {\n    columns,\n    indexes,\n    foreignKeys,\n    checks,\n    primaryKeys,\n    uniqueConstraints,\n    name,\n    schema,\n    policies,\n    enableRLS\n  };\n}\nfunction extractUsedTable(table) {\n  if (is(table, PgTable)) {\n    return [table[Schema] ? `${table[Schema]}.${table[Table.Symbol.BaseName]}` : table[Table.Symbol.BaseName]];\n  }\n  if (is(table, Subquery)) {\n    return table._.usedTables ?? [];\n  }\n  if (is(table, SQL)) {\n    return table.usedTables ?? [];\n  }\n  return [];\n}\nfunction getViewConfig(view) {\n  return {\n    ...view[ViewBaseConfig],\n    ...view[PgViewConfig]\n  };\n}\nfunction getMaterializedViewConfig(view) {\n  return {\n    ...view[ViewBaseConfig],\n    ...view[PgMaterializedViewConfig]\n  };\n}\nexport {\n  extractUsedTable,\n  getMaterializedViewConfig,\n  getTableConfig,\n  getViewConfig\n};\n//# sourceMappingURL=utils.js.map","import { entityKind, is } from \"../../entity.js\";\nimport { PgTable } from \"../table.js\";\nimport { QueryPromise } from \"../../query-promise.js\";\nimport { SelectionProxyHandler } from \"../../selection-proxy.js\";\nimport { SQL } from \"../../sql/sql.js\";\nimport { Subquery } from \"../../subquery.js\";\nimport { getTableName, Table } from \"../../table.js\";\nimport {\n  getTableLikeName,\n  mapUpdateSet,\n  orderSelectedFields\n} from \"../../utils.js\";\nimport { ViewBaseConfig } from \"../../view-common.js\";\nimport { extractUsedTable } from \"../utils.js\";\nclass PgUpdateBuilder {\n  constructor(table, session, dialect, withList) {\n    this.table = table;\n    this.session = session;\n    this.dialect = dialect;\n    this.withList = withList;\n  }\n  static [entityKind] = \"PgUpdateBuilder\";\n  authToken;\n  setToken(token) {\n    this.authToken = token;\n    return this;\n  }\n  set(values) {\n    return new PgUpdateBase(\n      this.table,\n      mapUpdateSet(this.table, values),\n      this.session,\n      this.dialect,\n      this.withList\n    ).setToken(this.authToken);\n  }\n}\nclass PgUpdateBase extends QueryPromise {\n  constructor(table, set, session, dialect, withList) {\n    super();\n    this.session = session;\n    this.dialect = dialect;\n    this.config = { set, table, withList, joins: [] };\n    this.tableName = getTableLikeName(table);\n    this.joinsNotNullableMap = typeof this.tableName === \"string\" ? { [this.tableName]: true } : {};\n  }\n  static [entityKind] = \"PgUpdate\";\n  config;\n  tableName;\n  joinsNotNullableMap;\n  cacheConfig;\n  from(source) {\n    const src = source;\n    const tableName = getTableLikeName(src);\n    if (typeof tableName === \"string\") {\n      this.joinsNotNullableMap[tableName] = true;\n    }\n    this.config.from = src;\n    return this;\n  }\n  getTableLikeFields(table) {\n    if (is(table, PgTable)) {\n      return table[Table.Symbol.Columns];\n    } else if (is(table, Subquery)) {\n      return table._.selectedFields;\n    }\n    return table[ViewBaseConfig].selectedFields;\n  }\n  createJoin(joinType) {\n    return (table, on) => {\n      const tableName = getTableLikeName(table);\n      if (typeof tableName === \"string\" && this.config.joins.some((join) => join.alias === tableName)) {\n        throw new Error(`Alias \"${tableName}\" is already used in this query`);\n      }\n      if (typeof on === \"function\") {\n        const from = this.config.from && !is(this.config.from, SQL) ? this.getTableLikeFields(this.config.from) : void 0;\n        on = on(\n          new Proxy(\n            this.config.table[Table.Symbol.Columns],\n            new SelectionProxyHandler({ sqlAliasedBehavior: \"sql\", sqlBehavior: \"sql\" })\n          ),\n          from && new Proxy(\n            from,\n            new SelectionProxyHandler({ sqlAliasedBehavior: \"sql\", sqlBehavior: \"sql\" })\n          )\n        );\n      }\n      this.config.joins.push({ on, table, joinType, alias: tableName });\n      if (typeof tableName === \"string\") {\n        switch (joinType) {\n          case \"left\": {\n            this.joinsNotNullableMap[tableName] = false;\n            break;\n          }\n          case \"right\": {\n            this.joinsNotNullableMap = Object.fromEntries(\n              Object.entries(this.joinsNotNullableMap).map(([key]) => [key, false])\n            );\n            this.joinsNotNullableMap[tableName] = true;\n            break;\n          }\n          case \"inner\": {\n            this.joinsNotNullableMap[tableName] = true;\n            break;\n          }\n          case \"full\": {\n            this.joinsNotNullableMap = Object.fromEntries(\n              Object.entries(this.joinsNotNullableMap).map(([key]) => [key, false])\n            );\n            this.joinsNotNullableMap[tableName] = false;\n            break;\n          }\n        }\n      }\n      return this;\n    };\n  }\n  leftJoin = this.createJoin(\"left\");\n  rightJoin = this.createJoin(\"right\");\n  innerJoin = this.createJoin(\"inner\");\n  fullJoin = this.createJoin(\"full\");\n  /**\n   * Adds a 'where' clause to the query.\n   *\n   * Calling this method will update only those rows that fulfill a specified condition.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/update}\n   *\n   * @param where the 'where' clause.\n   *\n   * @example\n   * You can use conditional operators and `sql function` to filter the rows to be updated.\n   *\n   * ```ts\n   * // Update all cars with green color\n   * await db.update(cars).set({ color: 'red' })\n   *   .where(eq(cars.color, 'green'));\n   * // or\n   * await db.update(cars).set({ color: 'red' })\n   *   .where(sql`${cars.color} = 'green'`)\n   * ```\n   *\n   * You can logically combine conditional operators with `and()` and `or()` operators:\n   *\n   * ```ts\n   * // Update all BMW cars with a green color\n   * await db.update(cars).set({ color: 'red' })\n   *   .where(and(eq(cars.color, 'green'), eq(cars.brand, 'BMW')));\n   *\n   * // Update all cars with the green or blue color\n   * await db.update(cars).set({ color: 'red' })\n   *   .where(or(eq(cars.color, 'green'), eq(cars.color, 'blue')));\n   * ```\n   */\n  where(where) {\n    this.config.where = where;\n    return this;\n  }\n  returning(fields) {\n    if (!fields) {\n      fields = Object.assign({}, this.config.table[Table.Symbol.Columns]);\n      if (this.config.from) {\n        const tableName = getTableLikeName(this.config.from);\n        if (typeof tableName === \"string\" && this.config.from && !is(this.config.from, SQL)) {\n          const fromFields = this.getTableLikeFields(this.config.from);\n          fields[tableName] = fromFields;\n        }\n        for (const join of this.config.joins) {\n          const tableName2 = getTableLikeName(join.table);\n          if (typeof tableName2 === \"string\" && !is(join.table, SQL)) {\n            const fromFields = this.getTableLikeFields(join.table);\n            fields[tableName2] = fromFields;\n          }\n        }\n      }\n    }\n    this.config.returningFields = fields;\n    this.config.returning = orderSelectedFields(fields);\n    return this;\n  }\n  /** @internal */\n  getSQL() {\n    return this.dialect.buildUpdateQuery(this.config);\n  }\n  toSQL() {\n    const { typings: _typings, ...rest } = this.dialect.sqlToQuery(this.getSQL());\n    return rest;\n  }\n  /** @internal */\n  _prepare(name) {\n    const query = this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()), this.config.returning, name, true, void 0, {\n      type: \"insert\",\n      tables: extractUsedTable(this.config.table)\n    }, this.cacheConfig);\n    query.joinsNotNullableMap = this.joinsNotNullableMap;\n    return query;\n  }\n  prepare(name) {\n    return this._prepare(name);\n  }\n  authToken;\n  /** @internal */\n  setToken(token) {\n    this.authToken = token;\n    return this;\n  }\n  execute = (placeholderValues) => {\n    return this._prepare().execute(placeholderValues, this.authToken);\n  };\n  /** @internal */\n  getSelectedFields() {\n    return this.config.returningFields ? new Proxy(\n      this.config.returningFields,\n      new SelectionProxyHandler({\n        alias: getTableName(this.config.table),\n        sqlAliasedBehavior: \"alias\",\n        sqlBehavior: \"error\"\n      })\n    ) : void 0;\n  }\n  $dynamic() {\n    return this;\n  }\n}\nexport {\n  PgUpdateBase,\n  PgUpdateBuilder\n};\n//# sourceMappingURL=update.js.map","import { a as getAuthTables } from \"./get-model-name-D4DUV7S2.mjs\";\nimport { a as createInternalAdapter } from \"./get-migration-Bf0TuCzm.mjs\";\nimport { t as generateId } from \"./utils-db7gNqd-.mjs\";\nimport { a as verifyPassword, i as hashPassword } from \"./crypto-CFUhAR9W.mjs\";\nimport { r as getOrigin, t as getBaseURL } from \"./url-CB8xCwz-.mjs\";\nimport { a as getEndpoints, n as checkEndpointConflicts, s as router } from \"./api-CkmycQ2x.mjs\";\nimport { i as getCookies, t as createCookieGetter } from \"./cookies-D72PbWdz.mjs\";\nimport { t as checkPassword } from \"./password-BFQK0cLg.mjs\";\nimport { runWithAdapter } from \"@better-auth/core/context\";\nimport { createLogger, env, isProduction, isTest } from \"@better-auth/core/env\";\nimport { BASE_ERROR_CODES, BetterAuthError } from \"@better-auth/core/error\";\nimport { socialProviders } from \"@better-auth/core/social-providers\";\nimport { createTelemetry } from \"@better-auth/telemetry\";\nimport defu$1, { defu } from \"defu\";\n\n//#region src/utils/constants.ts\nconst DEFAULT_SECRET = \"better-auth-secret-12345678901234567890\";\n\n//#endregion\n//#region src/utils/is-promise.ts\nfunction isPromise(obj) {\n\treturn !!obj && (typeof obj === \"object\" || typeof obj === \"function\") && typeof obj.then === \"function\";\n}\n\n//#endregion\n//#region src/context/helpers.ts\nasync function runPluginInit(ctx) {\n\tlet options = ctx.options;\n\tconst plugins = options.plugins || [];\n\tlet context = ctx;\n\tconst dbHooks = [];\n\tfor (const plugin of plugins) if (plugin.init) {\n\t\tlet initPromise = plugin.init(context);\n\t\tlet result;\n\t\tif (isPromise(initPromise)) result = await initPromise;\n\t\telse result = initPromise;\n\t\tif (typeof result === \"object\") {\n\t\t\tif (result.options) {\n\t\t\t\tconst { databaseHooks, ...restOpts } = result.options;\n\t\t\t\tif (databaseHooks) dbHooks.push(databaseHooks);\n\t\t\t\toptions = defu(options, restOpts);\n\t\t\t}\n\t\t\tif (result.context) context = {\n\t\t\t\t...context,\n\t\t\t\t...result.context\n\t\t\t};\n\t\t}\n\t}\n\tdbHooks.push(options.databaseHooks);\n\tcontext.internalAdapter = createInternalAdapter(context.adapter, {\n\t\toptions,\n\t\tlogger: context.logger,\n\t\thooks: dbHooks.filter((u) => u !== void 0),\n\t\tgenerateId: context.generateId\n\t});\n\tcontext.options = options;\n\treturn { context };\n}\nfunction getInternalPlugins(options) {\n\tconst plugins = [];\n\tif (options.advanced?.crossSubDomainCookies?.enabled) {}\n\treturn plugins;\n}\nfunction getTrustedOrigins(options) {\n\tconst baseURL = getBaseURL(options.baseURL, options.basePath);\n\tif (!baseURL) return [];\n\tconst trustedOrigins = [new URL(baseURL).origin];\n\tif (options.trustedOrigins && Array.isArray(options.trustedOrigins)) trustedOrigins.push(...options.trustedOrigins);\n\tconst envTrustedOrigins = env.BETTER_AUTH_TRUSTED_ORIGINS;\n\tif (envTrustedOrigins) trustedOrigins.push(...envTrustedOrigins.split(\",\"));\n\tif (trustedOrigins.filter((x) => !x).length) throw new BetterAuthError(\"A provided trusted origin is invalid, make sure your trusted origins list is properly defined.\");\n\treturn trustedOrigins;\n}\n\n//#endregion\n//#region src/context/create-context.ts\n/**\n* Estimates the entropy of a string in bits.\n* This is a simple approximation that helps detect low-entropy secrets.\n*/\nfunction estimateEntropy(str) {\n\tconst unique = new Set(str).size;\n\tif (unique === 0) return 0;\n\treturn Math.log2(Math.pow(unique, str.length));\n}\n/**\n* Validates that the secret meets minimum security requirements.\n* Throws BetterAuthError if the secret is invalid.\n* Skips validation for DEFAULT_SECRET in test environments only.\n* Only throws for DEFAULT_SECRET in production environment.\n*/\nfunction validateSecret(secret, logger$1) {\n\tconst isDefaultSecret = secret === DEFAULT_SECRET;\n\tif (isTest()) return;\n\tif (isDefaultSecret && isProduction) throw new BetterAuthError(\"You are using the default secret. Please set `BETTER_AUTH_SECRET` in your environment variables or pass `secret` in your auth config.\");\n\tif (!secret) throw new BetterAuthError(\"BETTER_AUTH_SECRET is missing. Set it in your environment or pass `secret` to betterAuth({ secret }).\");\n\tif (secret.length < 32) throw new BetterAuthError(`Invalid BETTER_AUTH_SECRET: must be at least 32 characters long for adequate security. Generate one with \\`npx @better-auth/cli secret\\` or \\`openssl rand -base64 32\\`.`);\n\tif (estimateEntropy(secret) < 120) logger$1.warn(\"[better-auth] Warning: your BETTER_AUTH_SECRET appears low-entropy. Use a randomly generated secret for production.\");\n}\nasync function createAuthContext(adapter, options, getDatabaseType) {\n\tif (!options.database) options = defu$1(options, {\n\t\tsession: { cookieCache: {\n\t\t\tenabled: true,\n\t\t\tstrategy: \"jwe\",\n\t\t\trefreshCache: true\n\t\t} },\n\t\taccount: {\n\t\t\tstoreStateStrategy: \"cookie\",\n\t\t\tstoreAccountCookie: true\n\t\t}\n\t});\n\tconst plugins = options.plugins || [];\n\tconst internalPlugins = getInternalPlugins(options);\n\tconst logger$1 = createLogger(options.logger);\n\tconst baseURL = getBaseURL(options.baseURL, options.basePath);\n\tconst secret = options.secret || env.BETTER_AUTH_SECRET || env.AUTH_SECRET || DEFAULT_SECRET;\n\tvalidateSecret(secret, logger$1);\n\toptions = {\n\t\t...options,\n\t\tsecret,\n\t\tbaseURL: baseURL ? new URL(baseURL).origin : \"\",\n\t\tbasePath: options.basePath || \"/api/auth\",\n\t\tplugins: plugins.concat(internalPlugins)\n\t};\n\tcheckEndpointConflicts(options, logger$1);\n\tconst cookies = getCookies(options);\n\tconst tables = getAuthTables(options);\n\tconst providers = Object.entries(options.socialProviders || {}).map(([key, config]) => {\n\t\tif (config == null) return null;\n\t\tif (config.enabled === false) return null;\n\t\tif (!config.clientId) logger$1.warn(`Social provider ${key} is missing clientId or clientSecret`);\n\t\tconst provider = socialProviders[key](config);\n\t\tprovider.disableImplicitSignUp = config.disableImplicitSignUp;\n\t\treturn provider;\n\t}).filter((x) => x !== null);\n\tconst generateIdFunc = ({ model, size }) => {\n\t\tif (typeof options.advanced?.generateId === \"function\") return options.advanced.generateId({\n\t\t\tmodel,\n\t\t\tsize\n\t\t});\n\t\tif (typeof options?.advanced?.database?.generateId === \"function\") return options.advanced.database.generateId({\n\t\t\tmodel,\n\t\t\tsize\n\t\t});\n\t\treturn generateId(size);\n\t};\n\tconst { publish } = await createTelemetry(options, {\n\t\tadapter: adapter.id,\n\t\tdatabase: typeof options.database === \"function\" ? \"adapter\" : getDatabaseType(options.database)\n\t});\n\tconst initOrPromise = runPluginInit({\n\t\tappName: options.appName || \"Better Auth\",\n\t\tsocialProviders: providers,\n\t\toptions,\n\t\toauthConfig: {\n\t\t\tstoreStateStrategy: options.account?.storeStateStrategy || \"database\",\n\t\t\tskipStateCookieCheck: !!options.account?.skipStateCookieCheck\n\t\t},\n\t\ttables,\n\t\ttrustedOrigins: getTrustedOrigins(options),\n\t\tbaseURL: baseURL || \"\",\n\t\tsessionConfig: {\n\t\t\tupdateAge: options.session?.updateAge !== void 0 ? options.session.updateAge : 1440 * 60,\n\t\t\texpiresIn: options.session?.expiresIn || 3600 * 24 * 7,\n\t\t\tfreshAge: options.session?.freshAge === void 0 ? 3600 * 24 : options.session.freshAge,\n\t\t\tcookieRefreshCache: (() => {\n\t\t\t\tconst refreshCache = options.session?.cookieCache?.refreshCache;\n\t\t\t\tconst maxAge = options.session?.cookieCache?.maxAge || 300;\n\t\t\t\tif (refreshCache === false || refreshCache === void 0) return false;\n\t\t\t\tif (refreshCache === true) return {\n\t\t\t\t\tenabled: true,\n\t\t\t\t\tupdateAge: Math.floor(maxAge * .2)\n\t\t\t\t};\n\t\t\t\treturn {\n\t\t\t\t\tenabled: true,\n\t\t\t\t\tupdateAge: refreshCache.updateAge !== void 0 ? refreshCache.updateAge : Math.floor(maxAge * .2)\n\t\t\t\t};\n\t\t\t})()\n\t\t},\n\t\tsecret,\n\t\trateLimit: {\n\t\t\t...options.rateLimit,\n\t\t\tenabled: options.rateLimit?.enabled ?? isProduction,\n\t\t\twindow: options.rateLimit?.window || 10,\n\t\t\tmax: options.rateLimit?.max || 100,\n\t\t\tstorage: options.rateLimit?.storage || (options.secondaryStorage ? \"secondary-storage\" : \"memory\")\n\t\t},\n\t\tauthCookies: cookies,\n\t\tlogger: logger$1,\n\t\tgenerateId: generateIdFunc,\n\t\tsession: null,\n\t\tsecondaryStorage: options.secondaryStorage,\n\t\tpassword: {\n\t\t\thash: options.emailAndPassword?.password?.hash || hashPassword,\n\t\t\tverify: options.emailAndPassword?.password?.verify || verifyPassword,\n\t\t\tconfig: {\n\t\t\t\tminPasswordLength: options.emailAndPassword?.minPasswordLength || 8,\n\t\t\t\tmaxPasswordLength: options.emailAndPassword?.maxPasswordLength || 128\n\t\t\t},\n\t\t\tcheckPassword\n\t\t},\n\t\tsetNewSession(session) {\n\t\t\tthis.newSession = session;\n\t\t},\n\t\tnewSession: null,\n\t\tadapter,\n\t\tinternalAdapter: createInternalAdapter(adapter, {\n\t\t\toptions,\n\t\t\tlogger: logger$1,\n\t\t\thooks: options.databaseHooks ? [options.databaseHooks] : [],\n\t\t\tgenerateId: generateIdFunc\n\t\t}),\n\t\tcreateAuthCookie: createCookieGetter(options),\n\t\tasync runMigrations() {\n\t\t\tthrow new BetterAuthError(\"runMigrations will be set by the specific init implementation\");\n\t\t},\n\t\tpublishTelemetry: publish,\n\t\tskipCSRFCheck: !!options.advanced?.disableCSRFCheck,\n\t\tskipOriginCheck: options.advanced?.disableOriginCheck !== void 0 ? options.advanced.disableOriginCheck : isTest() ? true : false\n\t});\n\tlet context;\n\tif (isPromise(initOrPromise)) ({context} = await initOrPromise);\n\telse ({context} = initOrPromise);\n\treturn context;\n}\n\n//#endregion\n//#region src/auth/base.ts\nconst createBetterAuth = (options, initFn) => {\n\tconst authContext = initFn(options);\n\tconst { api } = getEndpoints(authContext, options);\n\treturn {\n\t\thandler: async (request) => {\n\t\t\tconst ctx = await authContext;\n\t\t\tconst basePath = ctx.options.basePath || \"/api/auth\";\n\t\t\tif (!ctx.options.baseURL) {\n\t\t\t\tconst baseURL = getBaseURL(void 0, basePath, request, void 0, ctx.options.advanced?.trustedProxyHeaders);\n\t\t\t\tif (baseURL) {\n\t\t\t\t\tctx.baseURL = baseURL;\n\t\t\t\t\tctx.options.baseURL = getOrigin(ctx.baseURL) || void 0;\n\t\t\t\t} else throw new BetterAuthError(\"Could not get base URL from request. Please provide a valid base URL.\");\n\t\t\t}\n\t\t\tctx.trustedOrigins = [...options.trustedOrigins ? Array.isArray(options.trustedOrigins) ? options.trustedOrigins : await options.trustedOrigins(request) : [], ctx.options.baseURL];\n\t\t\tconst { handler } = router(ctx, options);\n\t\t\treturn runWithAdapter(ctx.adapter, () => handler(request));\n\t\t},\n\t\tapi,\n\t\toptions,\n\t\t$context: authContext,\n\t\t$ERROR_CODES: {\n\t\t\t...options.plugins?.reduce((acc, plugin) => {\n\t\t\t\tif (plugin.$ERROR_CODES) return {\n\t\t\t\t\t...acc,\n\t\t\t\t\t...plugin.$ERROR_CODES\n\t\t\t\t};\n\t\t\t\treturn acc;\n\t\t\t}, {}),\n\t\t\t...BASE_ERROR_CODES\n\t\t}\n\t};\n};\n\n//#endregion\nexport { createAuthContext as n, createBetterAuth as t };","import { entityKind } from \"../entity.js\";\nimport {\n  PgDeleteBase,\n  PgInsertBuilder,\n  PgSelectBuilder,\n  PgUpdateBuilder,\n  QueryBuilder\n} from \"./query-builders/index.js\";\nimport { SelectionProxyHandler } from \"../selection-proxy.js\";\nimport { sql } from \"../sql/sql.js\";\nimport { WithSubquery } from \"../subquery.js\";\nimport { PgCountBuilder } from \"./query-builders/count.js\";\nimport { RelationalQueryBuilder } from \"./query-builders/query.js\";\nimport { PgRaw } from \"./query-builders/raw.js\";\nimport { PgRefreshMaterializedView } from \"./query-builders/refresh-materialized-view.js\";\nclass PgDatabase {\n  constructor(dialect, session, schema) {\n    this.dialect = dialect;\n    this.session = session;\n    this._ = schema ? {\n      schema: schema.schema,\n      fullSchema: schema.fullSchema,\n      tableNamesMap: schema.tableNamesMap,\n      session\n    } : {\n      schema: void 0,\n      fullSchema: {},\n      tableNamesMap: {},\n      session\n    };\n    this.query = {};\n    if (this._.schema) {\n      for (const [tableName, columns] of Object.entries(this._.schema)) {\n        this.query[tableName] = new RelationalQueryBuilder(\n          schema.fullSchema,\n          this._.schema,\n          this._.tableNamesMap,\n          schema.fullSchema[tableName],\n          columns,\n          dialect,\n          session\n        );\n      }\n    }\n    this.$cache = { invalidate: async (_params) => {\n    } };\n  }\n  static [entityKind] = \"PgDatabase\";\n  query;\n  /**\n   * Creates a subquery that defines a temporary named result set as a CTE.\n   *\n   * It is useful for breaking down complex queries into simpler parts and for reusing the result set in subsequent parts of the query.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/select#with-clause}\n   *\n   * @param alias The alias for the subquery.\n   *\n   * Failure to provide an alias will result in a DrizzleTypeError, preventing the subquery from being referenced in other queries.\n   *\n   * @example\n   *\n   * ```ts\n   * // Create a subquery with alias 'sq' and use it in the select query\n   * const sq = db.$with('sq').as(db.select().from(users).where(eq(users.id, 42)));\n   *\n   * const result = await db.with(sq).select().from(sq);\n   * ```\n   *\n   * To select arbitrary SQL values as fields in a CTE and reference them in other CTEs or in the main query, you need to add aliases to them:\n   *\n   * ```ts\n   * // Select an arbitrary SQL value as a field in a CTE and reference it in the main query\n   * const sq = db.$with('sq').as(db.select({\n   *   name: sql<string>`upper(${users.name})`.as('name'),\n   * })\n   * .from(users));\n   *\n   * const result = await db.with(sq).select({ name: sq.name }).from(sq);\n   * ```\n   */\n  $with = (alias, selection) => {\n    const self = this;\n    const as = (qb) => {\n      if (typeof qb === \"function\") {\n        qb = qb(new QueryBuilder(self.dialect));\n      }\n      return new Proxy(\n        new WithSubquery(\n          qb.getSQL(),\n          selection ?? (\"getSelectedFields\" in qb ? qb.getSelectedFields() ?? {} : {}),\n          alias,\n          true\n        ),\n        new SelectionProxyHandler({ alias, sqlAliasedBehavior: \"alias\", sqlBehavior: \"error\" })\n      );\n    };\n    return { as };\n  };\n  $count(source, filters) {\n    return new PgCountBuilder({ source, filters, session: this.session });\n  }\n  $cache;\n  /**\n   * Incorporates a previously defined CTE (using `$with`) into the main query.\n   *\n   * This method allows the main query to reference a temporary named result set.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/select#with-clause}\n   *\n   * @param queries The CTEs to incorporate into the main query.\n   *\n   * @example\n   *\n   * ```ts\n   * // Define a subquery 'sq' as a CTE using $with\n   * const sq = db.$with('sq').as(db.select().from(users).where(eq(users.id, 42)));\n   *\n   * // Incorporate the CTE 'sq' into the main query and select from it\n   * const result = await db.with(sq).select().from(sq);\n   * ```\n   */\n  with(...queries) {\n    const self = this;\n    function select(fields) {\n      return new PgSelectBuilder({\n        fields: fields ?? void 0,\n        session: self.session,\n        dialect: self.dialect,\n        withList: queries\n      });\n    }\n    function selectDistinct(fields) {\n      return new PgSelectBuilder({\n        fields: fields ?? void 0,\n        session: self.session,\n        dialect: self.dialect,\n        withList: queries,\n        distinct: true\n      });\n    }\n    function selectDistinctOn(on, fields) {\n      return new PgSelectBuilder({\n        fields: fields ?? void 0,\n        session: self.session,\n        dialect: self.dialect,\n        withList: queries,\n        distinct: { on }\n      });\n    }\n    function update(table) {\n      return new PgUpdateBuilder(table, self.session, self.dialect, queries);\n    }\n    function insert(table) {\n      return new PgInsertBuilder(table, self.session, self.dialect, queries);\n    }\n    function delete_(table) {\n      return new PgDeleteBase(table, self.session, self.dialect, queries);\n    }\n    return { select, selectDistinct, selectDistinctOn, update, insert, delete: delete_ };\n  }\n  select(fields) {\n    return new PgSelectBuilder({\n      fields: fields ?? void 0,\n      session: this.session,\n      dialect: this.dialect\n    });\n  }\n  selectDistinct(fields) {\n    return new PgSelectBuilder({\n      fields: fields ?? void 0,\n      session: this.session,\n      dialect: this.dialect,\n      distinct: true\n    });\n  }\n  selectDistinctOn(on, fields) {\n    return new PgSelectBuilder({\n      fields: fields ?? void 0,\n      session: this.session,\n      dialect: this.dialect,\n      distinct: { on }\n    });\n  }\n  /**\n   * Creates an update query.\n   *\n   * Calling this method without `.where()` clause will update all rows in a table. The `.where()` clause specifies which rows should be updated.\n   *\n   * Use `.set()` method to specify which values to update.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/update}\n   *\n   * @param table The table to update.\n   *\n   * @example\n   *\n   * ```ts\n   * // Update all rows in the 'cars' table\n   * await db.update(cars).set({ color: 'red' });\n   *\n   * // Update rows with filters and conditions\n   * await db.update(cars).set({ color: 'red' }).where(eq(cars.brand, 'BMW'));\n   *\n   * // Update with returning clause\n   * const updatedCar: Car[] = await db.update(cars)\n   *   .set({ color: 'red' })\n   *   .where(eq(cars.id, 1))\n   *   .returning();\n   * ```\n   */\n  update(table) {\n    return new PgUpdateBuilder(table, this.session, this.dialect);\n  }\n  /**\n   * Creates an insert query.\n   *\n   * Calling this method will create new rows in a table. Use `.values()` method to specify which values to insert.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/insert}\n   *\n   * @param table The table to insert into.\n   *\n   * @example\n   *\n   * ```ts\n   * // Insert one row\n   * await db.insert(cars).values({ brand: 'BMW' });\n   *\n   * // Insert multiple rows\n   * await db.insert(cars).values([{ brand: 'BMW' }, { brand: 'Porsche' }]);\n   *\n   * // Insert with returning clause\n   * const insertedCar: Car[] = await db.insert(cars)\n   *   .values({ brand: 'BMW' })\n   *   .returning();\n   * ```\n   */\n  insert(table) {\n    return new PgInsertBuilder(table, this.session, this.dialect);\n  }\n  /**\n   * Creates a delete query.\n   *\n   * Calling this method without `.where()` clause will delete all rows in a table. The `.where()` clause specifies which rows should be deleted.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/delete}\n   *\n   * @param table The table to delete from.\n   *\n   * @example\n   *\n   * ```ts\n   * // Delete all rows in the 'cars' table\n   * await db.delete(cars);\n   *\n   * // Delete rows with filters and conditions\n   * await db.delete(cars).where(eq(cars.color, 'green'));\n   *\n   * // Delete with returning clause\n   * const deletedCar: Car[] = await db.delete(cars)\n   *   .where(eq(cars.id, 1))\n   *   .returning();\n   * ```\n   */\n  delete(table) {\n    return new PgDeleteBase(table, this.session, this.dialect);\n  }\n  refreshMaterializedView(view) {\n    return new PgRefreshMaterializedView(view, this.session, this.dialect);\n  }\n  authToken;\n  execute(query) {\n    const sequel = typeof query === \"string\" ? sql.raw(query) : query.getSQL();\n    const builtQuery = this.dialect.sqlToQuery(sequel);\n    const prepared = this.session.prepareQuery(\n      builtQuery,\n      void 0,\n      void 0,\n      false\n    );\n    return new PgRaw(\n      () => prepared.execute(void 0, this.authToken),\n      sequel,\n      builtQuery,\n      (result) => prepared.mapResult(result, true)\n    );\n  }\n  transaction(transaction, config) {\n    return this.session.transaction(transaction, config);\n  }\n}\nconst withReplicas = (primary, replicas, getReplica = () => replicas[Math.floor(Math.random() * replicas.length)]) => {\n  const select = (...args) => getReplica(replicas).select(...args);\n  const selectDistinct = (...args) => getReplica(replicas).selectDistinct(...args);\n  const selectDistinctOn = (...args) => getReplica(replicas).selectDistinctOn(...args);\n  const $count = (...args) => getReplica(replicas).$count(...args);\n  const _with = (...args) => getReplica(replicas).with(...args);\n  const $with = (arg) => getReplica(replicas).$with(arg);\n  const update = (...args) => primary.update(...args);\n  const insert = (...args) => primary.insert(...args);\n  const $delete = (...args) => primary.delete(...args);\n  const execute = (...args) => primary.execute(...args);\n  const transaction = (...args) => primary.transaction(...args);\n  const refreshMaterializedView = (...args) => primary.refreshMaterializedView(...args);\n  return {\n    ...primary,\n    update,\n    insert,\n    delete: $delete,\n    execute,\n    transaction,\n    refreshMaterializedView,\n    $primary: primary,\n    $replicas: replicas,\n    select,\n    selectDistinct,\n    selectDistinctOn,\n    $count,\n    $with,\n    with: _with,\n    get query() {\n      return getReplica(replicas).query;\n    }\n  };\n};\nexport {\n  PgDatabase,\n  withReplicas\n};\n//# sourceMappingURL=db.js.map","import { n as symmetricEncrypt, r as generateRandomString, t as symmetricDecrypt, u as constantTimeEqual } from \"./crypto-CFUhAR9W.mjs\";\nimport { t as mergeSchema } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as safeJSONParse } from \"./json-CnHxKYpj.mjs\";\nimport { c as setSessionCookie, n as deleteSessionCookie } from \"./cookies-D72PbWdz.mjs\";\nimport { r as getSessionFromCtx, u as sessionMiddleware } from \"./session-AaRl3_x-.mjs\";\nimport { n as validatePassword } from \"./password-BFQK0cLg.mjs\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\nimport { base64Url } from \"@better-auth/utils/base64\";\nimport { createHMAC } from \"@better-auth/utils/hmac\";\nimport { createOTP } from \"@better-auth/utils/otp\";\n\n//#region src/plugins/two-factor/error-code.ts\nconst TWO_FACTOR_ERROR_CODES = defineErrorCodes({\n\tOTP_NOT_ENABLED: \"OTP not enabled\",\n\tOTP_HAS_EXPIRED: \"OTP has expired\",\n\tTOTP_NOT_ENABLED: \"TOTP not enabled\",\n\tTWO_FACTOR_NOT_ENABLED: \"Two factor isn't enabled\",\n\tBACKUP_CODES_NOT_ENABLED: \"Backup codes aren't enabled\",\n\tINVALID_BACKUP_CODE: \"Invalid backup code\",\n\tINVALID_CODE: \"Invalid code\",\n\tTOO_MANY_ATTEMPTS_REQUEST_NEW_CODE: \"Too many attempts. Please request a new code.\",\n\tINVALID_TWO_FACTOR_COOKIE: \"Invalid two factor cookie\"\n});\n\n//#endregion\n//#region src/plugins/two-factor/constant.ts\nconst TWO_FACTOR_COOKIE_NAME = \"two_factor\";\nconst TRUST_DEVICE_COOKIE_NAME = \"trust_device\";\nconst TRUST_DEVICE_COOKIE_MAX_AGE = 720 * 60 * 60;\n\n//#endregion\n//#region src/plugins/two-factor/verify-two-factor.ts\nasync function verifyTwoFactor(ctx) {\n\tconst invalid = (errorKey) => {\n\t\tthrow new APIError(\"UNAUTHORIZED\", { message: TWO_FACTOR_ERROR_CODES[errorKey] });\n\t};\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session) {\n\t\tconst cookieName = ctx.context.createAuthCookie(TWO_FACTOR_COOKIE_NAME);\n\t\tconst twoFactorCookie = await ctx.getSignedCookie(cookieName.name, ctx.context.secret);\n\t\tif (!twoFactorCookie) throw new APIError(\"UNAUTHORIZED\", { message: TWO_FACTOR_ERROR_CODES.INVALID_TWO_FACTOR_COOKIE });\n\t\tconst verificationToken = await ctx.context.internalAdapter.findVerificationValue(twoFactorCookie);\n\t\tif (!verificationToken) throw new APIError(\"UNAUTHORIZED\", { message: TWO_FACTOR_ERROR_CODES.INVALID_TWO_FACTOR_COOKIE });\n\t\tconst user = await ctx.context.internalAdapter.findUserById(verificationToken.value);\n\t\tif (!user) throw new APIError(\"UNAUTHORIZED\", { message: TWO_FACTOR_ERROR_CODES.INVALID_TWO_FACTOR_COOKIE });\n\t\tconst dontRememberMe = await ctx.getSignedCookie(ctx.context.authCookies.dontRememberToken.name, ctx.context.secret);\n\t\treturn {\n\t\t\tvalid: async (ctx$1) => {\n\t\t\t\tconst session$1 = await ctx$1.context.internalAdapter.createSession(verificationToken.value, !!dontRememberMe);\n\t\t\t\tif (!session$1) throw new APIError(\"INTERNAL_SERVER_ERROR\", { message: \"failed to create session\" });\n\t\t\t\tawait setSessionCookie(ctx$1, {\n\t\t\t\t\tsession: session$1,\n\t\t\t\t\tuser\n\t\t\t\t});\n\t\t\t\tif (ctx$1.body.trustDevice) {\n\t\t\t\t\tconst trustDeviceCookie = ctx$1.context.createAuthCookie(TRUST_DEVICE_COOKIE_NAME, { maxAge: TRUST_DEVICE_COOKIE_MAX_AGE });\n\t\t\t\t\t/**\n\t\t\t\t\t* create a token that will be used to\n\t\t\t\t\t* verify the device\n\t\t\t\t\t*/\n\t\t\t\t\tconst token = await createHMAC(\"SHA-256\", \"base64urlnopad\").sign(ctx$1.context.secret, `${user.id}!${session$1.token}`);\n\t\t\t\t\tawait ctx$1.setSignedCookie(trustDeviceCookie.name, `${token}!${session$1.token}`, ctx$1.context.secret, trustDeviceCookie.attributes);\n\t\t\t\t\tctx$1.setCookie(ctx$1.context.authCookies.dontRememberToken.name, \"\", { maxAge: 0 });\n\t\t\t\t\tctx$1.setCookie(cookieName.name, \"\", { maxAge: 0 });\n\t\t\t\t}\n\t\t\t\treturn ctx$1.json({\n\t\t\t\t\ttoken: session$1.token,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\temailVerified: user.emailVerified,\n\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\timage: user.image,\n\t\t\t\t\t\tcreatedAt: user.createdAt,\n\t\t\t\t\t\tupdatedAt: user.updatedAt\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tinvalid,\n\t\t\tsession: {\n\t\t\t\tsession: null,\n\t\t\t\tuser\n\t\t\t},\n\t\t\tkey: twoFactorCookie\n\t\t};\n\t}\n\treturn {\n\t\tvalid: async (ctx$1) => {\n\t\t\treturn ctx$1.json({\n\t\t\t\ttoken: session.session.token,\n\t\t\t\tuser: {\n\t\t\t\t\tid: session.user.id,\n\t\t\t\t\temail: session.user.email,\n\t\t\t\t\temailVerified: session.user.emailVerified,\n\t\t\t\t\tname: session.user.name,\n\t\t\t\t\timage: session.user.image,\n\t\t\t\t\tcreatedAt: session.user.createdAt,\n\t\t\t\t\tupdatedAt: session.user.updatedAt\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tinvalid,\n\t\tsession,\n\t\tkey: `${session.user.id}!${session.session.id}`\n\t};\n}\n\n//#endregion\n//#region src/plugins/two-factor/backup-codes/index.ts\nfunction generateBackupCodesFn(options) {\n\treturn Array.from({ length: options?.amount ?? 10 }).fill(null).map(() => generateRandomString(options?.length ?? 10, \"a-z\", \"0-9\", \"A-Z\")).map((code) => `${code.slice(0, 5)}-${code.slice(5)}`);\n}\nasync function generateBackupCodes(secret, options) {\n\tconst backupCodes = options?.customBackupCodesGenerate ? options.customBackupCodesGenerate() : generateBackupCodesFn(options);\n\tif (options?.storeBackupCodes === \"encrypted\") return {\n\t\tbackupCodes,\n\t\tencryptedBackupCodes: await symmetricEncrypt({\n\t\t\tdata: JSON.stringify(backupCodes),\n\t\t\tkey: secret\n\t\t})\n\t};\n\tif (typeof options?.storeBackupCodes === \"object\" && \"encrypt\" in options?.storeBackupCodes) return {\n\t\tbackupCodes,\n\t\tencryptedBackupCodes: await options?.storeBackupCodes.encrypt(JSON.stringify(backupCodes))\n\t};\n\treturn {\n\t\tbackupCodes,\n\t\tencryptedBackupCodes: JSON.stringify(backupCodes)\n\t};\n}\nasync function verifyBackupCode(data, key, options) {\n\tconst codes = await getBackupCodes(data.backupCodes, key, options);\n\tif (!codes) return {\n\t\tstatus: false,\n\t\tupdated: null\n\t};\n\treturn {\n\t\tstatus: codes.includes(data.code),\n\t\tupdated: codes.filter((code) => code !== data.code)\n\t};\n}\nasync function getBackupCodes(backupCodes, key, options) {\n\tif (options?.storeBackupCodes === \"encrypted\") return safeJSONParse(await symmetricDecrypt({\n\t\tkey,\n\t\tdata: backupCodes\n\t}));\n\tif (typeof options?.storeBackupCodes === \"object\" && \"decrypt\" in options?.storeBackupCodes) return safeJSONParse(await options?.storeBackupCodes.decrypt(backupCodes));\n\treturn safeJSONParse(backupCodes);\n}\nconst backupCode2fa = (opts) => {\n\tconst twoFactorTable = \"twoFactor\";\n\treturn {\n\t\tid: \"backup_code\",\n\t\tendpoints: {\n\t\t\tverifyBackupCode: createAuthEndpoint(\"/two-factor/verify-backup-code\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tcode: z.string().meta({ description: `A backup code to verify. Eg: \"123456\"` }),\n\t\t\t\t\tdisableSession: z.boolean().meta({ description: \"If true, the session cookie will not be set.\" }).optional(),\n\t\t\t\t\ttrustDevice: z.boolean().meta({ description: \"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true\" }).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Verify a backup code for two-factor authentication\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"Backup code verified successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier of the user\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"email\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's email address\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\temailVerified: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the email is verified\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's name\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\timage: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's profile image URL\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\ttwoFactorEnabled: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Whether two-factor authentication is enabled for the user\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the user was created\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the user was last updated\"\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\t\t\t\"twoFactorEnabled\",\n\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tdescription: \"The authenticated user object with two-factor details\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Session token\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"ID of the user associated with the session\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the session was created\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\texpiresAt: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the session expires\"\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\"token\",\n\t\t\t\t\t\t\t\t\t\t\"userId\",\n\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\"expiresAt\"\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tdescription: \"The current session object, included unless disableSession is true\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\"user\", \"session\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { session, valid } = await verifyTwoFactor(ctx);\n\t\t\t\tconst user = session.user;\n\t\t\t\tconst twoFactor$1 = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!twoFactor$1) throw new APIError(\"BAD_REQUEST\", { message: TWO_FACTOR_ERROR_CODES.BACKUP_CODES_NOT_ENABLED });\n\t\t\t\tconst validate = await verifyBackupCode({\n\t\t\t\t\tbackupCodes: twoFactor$1.backupCodes,\n\t\t\t\t\tcode: ctx.body.code\n\t\t\t\t}, ctx.context.secret, opts);\n\t\t\t\tif (!validate.status) throw new APIError(\"UNAUTHORIZED\", { message: TWO_FACTOR_ERROR_CODES.INVALID_BACKUP_CODE });\n\t\t\t\tconst updatedBackupCodes = await symmetricEncrypt({\n\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\tdata: JSON.stringify(validate.updated)\n\t\t\t\t});\n\t\t\t\tif (!await ctx.context.adapter.updateMany({\n\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\tupdate: { backupCodes: updatedBackupCodes },\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id\n\t\t\t\t\t}, {\n\t\t\t\t\t\tfield: \"backupCodes\",\n\t\t\t\t\t\tvalue: twoFactor$1.backupCodes\n\t\t\t\t\t}]\n\t\t\t\t})) throw new APIError(\"CONFLICT\", { message: \"Failed to verify backup code. Please try again.\" });\n\t\t\t\tif (!ctx.body.disableSession) return valid(ctx);\n\t\t\t\treturn ctx.json({\n\t\t\t\t\ttoken: session.session?.token,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: session.user?.id,\n\t\t\t\t\t\temail: session.user.email,\n\t\t\t\t\t\temailVerified: session.user.emailVerified,\n\t\t\t\t\t\tname: session.user.name,\n\t\t\t\t\t\timage: session.user.image,\n\t\t\t\t\t\tcreatedAt: session.user.createdAt,\n\t\t\t\t\t\tupdatedAt: session.user.updatedAt\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}),\n\t\t\tgenerateBackupCodes: createAuthEndpoint(\"/two-factor/generate-backup-codes\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ password: z.string().meta({ description: \"The users password.\" }) }),\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Generate new backup codes for two-factor authentication\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"Backup codes generated successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\tdescription: \"Indicates if the backup codes were generated successfully\",\n\t\t\t\t\t\t\t\t\tenum: [true]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbackupCodes: {\n\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\titems: { type: \"string\" },\n\t\t\t\t\t\t\t\t\tdescription: \"Array of generated backup codes in plain text\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\"status\", \"backupCodes\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst user = ctx.context.session.user;\n\t\t\t\tif (!user.twoFactorEnabled) throw new APIError(\"BAD_REQUEST\", { message: TWO_FACTOR_ERROR_CODES.TWO_FACTOR_NOT_ENABLED });\n\t\t\t\tawait ctx.context.password.checkPassword(user.id, ctx);\n\t\t\t\tconst backupCodes = await generateBackupCodes(ctx.context.secret, opts);\n\t\t\t\tawait ctx.context.adapter.updateMany({\n\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\tupdate: { backupCodes: backupCodes.encryptedBackupCodes },\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: ctx.context.session.user.id\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tstatus: true,\n\t\t\t\t\tbackupCodes: backupCodes.backupCodes\n\t\t\t\t});\n\t\t\t}),\n\t\t\tviewBackupCodes: createAuthEndpoint(\"/two-factor/view-backup-codes\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ userId: z.coerce.string().meta({ description: `The user ID to view all backup codes. Eg: \"user-id\"` }) }),\n\t\t\t\tmetadata: { SERVER_ONLY: true }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst twoFactor$1 = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: ctx.body.userId\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!twoFactor$1) throw new APIError(\"BAD_REQUEST\", { message: TWO_FACTOR_ERROR_CODES.BACKUP_CODES_NOT_ENABLED });\n\t\t\t\tconst decryptedBackupCodes = await getBackupCodes(twoFactor$1.backupCodes, ctx.context.secret, opts);\n\t\t\t\tif (!decryptedBackupCodes) throw new APIError(\"BAD_REQUEST\", { message: TWO_FACTOR_ERROR_CODES.INVALID_BACKUP_CODE });\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tstatus: true,\n\t\t\t\t\tbackupCodes: decryptedBackupCodes\n\t\t\t\t});\n\t\t\t})\n\t\t}\n\t};\n};\n\n//#endregion\n//#region src/plugins/two-factor/utils.ts\nconst defaultKeyHasher = async (token) => {\n\tconst hash = await createHash(\"SHA-256\").digest(new TextEncoder().encode(token));\n\treturn base64Url.encode(new Uint8Array(hash), { padding: false });\n};\n\n//#endregion\n//#region src/plugins/two-factor/otp/index.ts\n/**\n* The otp adapter is created from the totp adapter.\n*/\nconst otp2fa = (options) => {\n\tconst opts = {\n\t\tstoreOTP: \"plain\",\n\t\tdigits: 6,\n\t\t...options,\n\t\tperiod: (options?.period || 3) * 60 * 1e3\n\t};\n\tasync function storeOTP(ctx, otp) {\n\t\tif (opts.storeOTP === \"hashed\") return await defaultKeyHasher(otp);\n\t\tif (typeof opts.storeOTP === \"object\" && \"hash\" in opts.storeOTP) return await opts.storeOTP.hash(otp);\n\t\tif (typeof opts.storeOTP === \"object\" && \"encrypt\" in opts.storeOTP) return await opts.storeOTP.encrypt(otp);\n\t\tif (opts.storeOTP === \"encrypted\") return await symmetricEncrypt({\n\t\t\tkey: ctx.context.secret,\n\t\t\tdata: otp\n\t\t});\n\t\treturn otp;\n\t}\n\tasync function decryptOTP(ctx, otp) {\n\t\tif (opts.storeOTP === \"hashed\") return await defaultKeyHasher(otp);\n\t\tif (opts.storeOTP === \"encrypted\") return await symmetricDecrypt({\n\t\t\tkey: ctx.context.secret,\n\t\t\tdata: otp\n\t\t});\n\t\tif (typeof opts.storeOTP === \"object\" && \"encrypt\" in opts.storeOTP) return await opts.storeOTP.decrypt(otp);\n\t\tif (typeof opts.storeOTP === \"object\" && \"hash\" in opts.storeOTP) return await opts.storeOTP.hash(otp);\n\t\treturn otp;\n\t}\n\treturn {\n\t\tid: \"otp\",\n\t\tendpoints: {\n\t\t\tsendTwoFactorOTP: createAuthEndpoint(\"/two-factor/send-otp\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ trustDevice: z.boolean().optional().meta({ description: \"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true\" }) }).optional(),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Send two factor OTP\",\n\t\t\t\t\tdescription: \"Send two factor OTP to the user\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { status: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (!options || !options.sendOTP) {\n\t\t\t\t\tctx.context.logger.error(\"send otp isn't configured. Please configure the send otp function on otp options.\");\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"otp isn't configured\" });\n\t\t\t\t}\n\t\t\t\tconst { session, key } = await verifyTwoFactor(ctx);\n\t\t\t\tconst code = generateRandomString(opts.digits, \"0-9\");\n\t\t\t\tconst hashedCode = await storeOTP(ctx, code);\n\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\tvalue: `${hashedCode}:0`,\n\t\t\t\t\tidentifier: `2fa-otp-${key}`,\n\t\t\t\t\texpiresAt: new Date(Date.now() + opts.period)\n\t\t\t\t});\n\t\t\t\tawait options.sendOTP({\n\t\t\t\t\tuser: session.user,\n\t\t\t\t\totp: code\n\t\t\t\t}, ctx);\n\t\t\t\treturn ctx.json({ status: true });\n\t\t\t}),\n\t\t\tverifyTwoFactorOTP: createAuthEndpoint(\"/two-factor/verify-otp\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tcode: z.string().meta({ description: \"The otp code to verify. Eg: \\\"012345\\\"\" }),\n\t\t\t\t\ttrustDevice: z.boolean().optional().meta({ description: \"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true\" })\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Verify two factor OTP\",\n\t\t\t\t\tdescription: \"Verify two factor OTP\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"Two-factor OTP verified successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Session token for the authenticated session\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier of the user\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"email\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's email address\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\temailVerified: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the email is verified\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's name\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\timage: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's profile image URL\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the user was created\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the user was last updated\"\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tdescription: \"The authenticated user object\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\"token\", \"user\"]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst { session, key, valid, invalid } = await verifyTwoFactor(ctx);\n\t\t\t\tconst toCheckOtp = await ctx.context.internalAdapter.findVerificationValue(`2fa-otp-${key}`);\n\t\t\t\tconst [otp, counter] = toCheckOtp?.value?.split(\":\") ?? [];\n\t\t\t\tconst decryptedOtp = await decryptOTP(ctx, otp);\n\t\t\t\tif (!toCheckOtp || toCheckOtp.expiresAt < /* @__PURE__ */ new Date()) {\n\t\t\t\t\tif (toCheckOtp) await ctx.context.internalAdapter.deleteVerificationValue(toCheckOtp.id);\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: TWO_FACTOR_ERROR_CODES.OTP_HAS_EXPIRED });\n\t\t\t\t}\n\t\t\t\tconst allowedAttempts = options?.allowedAttempts || 5;\n\t\t\t\tif (parseInt(counter) >= allowedAttempts) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(toCheckOtp.id);\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: TWO_FACTOR_ERROR_CODES.TOO_MANY_ATTEMPTS_REQUEST_NEW_CODE });\n\t\t\t\t}\n\t\t\t\tif (constantTimeEqual(new TextEncoder().encode(decryptedOtp), new TextEncoder().encode(ctx.body.code))) {\n\t\t\t\t\tif (!session.user.twoFactorEnabled) {\n\t\t\t\t\t\tif (!session.session) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION });\n\t\t\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(session.user.id, { twoFactorEnabled: true });\n\t\t\t\t\t\tconst newSession = await ctx.context.internalAdapter.createSession(session.user.id, false, session.session);\n\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteSession(session.session.token);\n\t\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\t\tsession: newSession,\n\t\t\t\t\t\t\tuser: updatedUser\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\t\ttoken: newSession.token,\n\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\tid: updatedUser.id,\n\t\t\t\t\t\t\t\temail: updatedUser.email,\n\t\t\t\t\t\t\t\temailVerified: updatedUser.emailVerified,\n\t\t\t\t\t\t\t\tname: updatedUser.name,\n\t\t\t\t\t\t\t\timage: updatedUser.image,\n\t\t\t\t\t\t\t\tcreatedAt: updatedUser.createdAt,\n\t\t\t\t\t\t\t\tupdatedAt: updatedUser.updatedAt\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn valid(ctx);\n\t\t\t\t} else {\n\t\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(toCheckOtp.id, { value: `${otp}:${(parseInt(counter, 10) || 0) + 1}` });\n\t\t\t\t\treturn invalid(\"INVALID_CODE\");\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t};\n};\n\n//#endregion\n//#region src/plugins/two-factor/schema.ts\nconst schema = {\n\tuser: { fields: { twoFactorEnabled: {\n\t\ttype: \"boolean\",\n\t\trequired: false,\n\t\tdefaultValue: false,\n\t\tinput: false\n\t} } },\n\ttwoFactor: { fields: {\n\t\tsecret: {\n\t\t\ttype: \"string\",\n\t\t\trequired: true,\n\t\t\treturned: false,\n\t\t\tindex: true\n\t\t},\n\t\tbackupCodes: {\n\t\t\ttype: \"string\",\n\t\t\trequired: true,\n\t\t\treturned: false\n\t\t},\n\t\tuserId: {\n\t\t\ttype: \"string\",\n\t\t\trequired: true,\n\t\t\treturned: false,\n\t\t\treferences: {\n\t\t\t\tmodel: \"user\",\n\t\t\t\tfield: \"id\"\n\t\t\t},\n\t\t\tindex: true\n\t\t}\n\t} }\n};\n\n//#endregion\n//#region src/plugins/two-factor/totp/index.ts\nconst totp2fa = (options) => {\n\tconst opts = {\n\t\t...options,\n\t\tdigits: options?.digits || 6,\n\t\tperiod: options?.period || 30\n\t};\n\tconst twoFactorTable = \"twoFactor\";\n\treturn {\n\t\tid: \"totp\",\n\t\tendpoints: {\n\t\t\tgenerateTOTP: createAuthEndpoint(\"/totp/generate\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ secret: z.string().meta({ description: \"The secret to generate the TOTP code\" }) }),\n\t\t\t\tmetadata: {\n\t\t\t\t\topenapi: {\n\t\t\t\t\t\tsummary: \"Generate TOTP code\",\n\t\t\t\t\t\tdescription: \"Use this endpoint to generate a TOTP code\",\n\t\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tproperties: { code: { type: \"string\" } }\n\t\t\t\t\t\t\t} } }\n\t\t\t\t\t\t} }\n\t\t\t\t\t},\n\t\t\t\t\tSERVER_ONLY: true\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (options?.disable) {\n\t\t\t\t\tctx.context.logger.error(\"totp isn't configured. please pass totp option on two factor plugin to enable totp\");\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"totp isn't configured\" });\n\t\t\t\t}\n\t\t\t\treturn { code: await createOTP(ctx.body.secret, {\n\t\t\t\t\tperiod: opts.period,\n\t\t\t\t\tdigits: opts.digits\n\t\t\t\t}).totp() };\n\t\t\t}),\n\t\t\tgetTOTPURI: createAuthEndpoint(\"/two-factor/get-totp-uri\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tbody: z.object({ password: z.string().meta({ description: \"User password\" }) }),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Get TOTP URI\",\n\t\t\t\t\tdescription: \"Use this endpoint to get the TOTP URI\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { totpURI: { type: \"string\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (options?.disable) {\n\t\t\t\t\tctx.context.logger.error(\"totp isn't configured. please pass totp option on two factor plugin to enable totp\");\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"totp isn't configured\" });\n\t\t\t\t}\n\t\t\t\tconst user = ctx.context.session.user;\n\t\t\t\tconst twoFactor$1 = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!twoFactor$1) throw new APIError(\"BAD_REQUEST\", { message: TWO_FACTOR_ERROR_CODES.TOTP_NOT_ENABLED });\n\t\t\t\tconst secret = await symmetricDecrypt({\n\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\tdata: twoFactor$1.secret\n\t\t\t\t});\n\t\t\t\tawait ctx.context.password.checkPassword(user.id, ctx);\n\t\t\t\treturn { totpURI: createOTP(secret, {\n\t\t\t\t\tdigits: opts.digits,\n\t\t\t\t\tperiod: opts.period\n\t\t\t\t}).url(options?.issuer || ctx.context.appName, user.email) };\n\t\t\t}),\n\t\t\tverifyTOTP: createAuthEndpoint(\"/two-factor/verify-totp\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tcode: z.string().meta({ description: \"The otp code to verify. Eg: \\\"012345\\\"\" }),\n\t\t\t\t\ttrustDevice: z.boolean().meta({ description: \"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true\" }).optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Verify two factor TOTP\",\n\t\t\t\t\tdescription: \"Verify two factor TOTP\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { status: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tif (options?.disable) {\n\t\t\t\t\tctx.context.logger.error(\"totp isn't configured. please pass totp option on two factor plugin to enable totp\");\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"totp isn't configured\" });\n\t\t\t\t}\n\t\t\t\tconst { session, valid, invalid } = await verifyTwoFactor(ctx);\n\t\t\t\tconst user = session.user;\n\t\t\t\tconst twoFactor$1 = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!twoFactor$1) throw new APIError(\"BAD_REQUEST\", { message: TWO_FACTOR_ERROR_CODES.TOTP_NOT_ENABLED });\n\t\t\t\tif (!await createOTP(await symmetricDecrypt({\n\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\tdata: twoFactor$1.secret\n\t\t\t\t}), {\n\t\t\t\t\tperiod: opts.period,\n\t\t\t\t\tdigits: opts.digits\n\t\t\t\t}).verify(ctx.body.code)) return invalid(\"INVALID_CODE\");\n\t\t\t\tif (!user.twoFactorEnabled) {\n\t\t\t\t\tif (!session.session) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION });\n\t\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(user.id, { twoFactorEnabled: true });\n\t\t\t\t\tconst newSession = await ctx.context.internalAdapter.createSession(user.id, false, session.session).catch((e) => {\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t});\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteSession(session.session.token);\n\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\tsession: newSession,\n\t\t\t\t\t\tuser: updatedUser\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn valid(ctx);\n\t\t\t})\n\t\t}\n\t};\n};\n\n//#endregion\n//#region src/plugins/two-factor/index.ts\nconst twoFactor = (options) => {\n\tconst opts = { twoFactorTable: \"twoFactor\" };\n\tconst backupCodeOptions = {\n\t\tstoreBackupCodes: \"encrypted\",\n\t\t...options?.backupCodeOptions\n\t};\n\tconst totp = totp2fa(options?.totpOptions);\n\tconst backupCode = backupCode2fa(backupCodeOptions);\n\tconst otp = otp2fa(options?.otpOptions);\n\treturn {\n\t\tid: \"two-factor\",\n\t\tendpoints: {\n\t\t\t...totp.endpoints,\n\t\t\t...otp.endpoints,\n\t\t\t...backupCode.endpoints,\n\t\t\tenableTwoFactor: createAuthEndpoint(\"/two-factor/enable\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tpassword: z.string().meta({ description: \"User password\" }),\n\t\t\t\t\tissuer: z.string().meta({ description: \"Custom issuer for the TOTP URI\" }).optional()\n\t\t\t\t}),\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Enable two factor authentication\",\n\t\t\t\t\tdescription: \"Use this endpoint to enable two factor authentication. This will generate a TOTP URI and backup codes. Once the user verifies the TOTP URI, the two factor authentication will be enabled.\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\ttotpURI: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"TOTP URI\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbackupCodes: {\n\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\titems: { type: \"string\" },\n\t\t\t\t\t\t\t\t\tdescription: \"Backup codes\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst user = ctx.context.session.user;\n\t\t\t\tconst { password, issuer } = ctx.body;\n\t\t\t\tif (!await validatePassword(ctx, {\n\t\t\t\t\tpassword,\n\t\t\t\t\tuserId: user.id\n\t\t\t\t})) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.INVALID_PASSWORD });\n\t\t\t\tconst secret = generateRandomString(32);\n\t\t\t\tconst encryptedSecret = await symmetricEncrypt({\n\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\tdata: secret\n\t\t\t\t});\n\t\t\t\tconst backupCodes = await generateBackupCodes(ctx.context.secret, backupCodeOptions);\n\t\t\t\tif (options?.skipVerificationOnEnable) {\n\t\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(user.id, { twoFactorEnabled: true });\n\t\t\t\t\t/**\n\t\t\t\t\t* Update the session cookie with the new user data\n\t\t\t\t\t*/\n\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\tsession: await ctx.context.internalAdapter.createSession(updatedUser.id, false, ctx.context.session.session),\n\t\t\t\t\t\tuser: updatedUser\n\t\t\t\t\t});\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteSession(ctx.context.session.session.token);\n\t\t\t\t}\n\t\t\t\tawait ctx.context.adapter.deleteMany({\n\t\t\t\t\tmodel: opts.twoFactorTable,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\tmodel: opts.twoFactorTable,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tsecret: encryptedSecret,\n\t\t\t\t\t\tbackupCodes: backupCodes.encryptedBackupCodes,\n\t\t\t\t\t\tuserId: user.id\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tconst totpURI = createOTP(secret, {\n\t\t\t\t\tdigits: options?.totpOptions?.digits || 6,\n\t\t\t\t\tperiod: options?.totpOptions?.period\n\t\t\t\t}).url(issuer || options?.issuer || ctx.context.appName, user.email);\n\t\t\t\treturn ctx.json({\n\t\t\t\t\ttotpURI,\n\t\t\t\t\tbackupCodes: backupCodes.backupCodes\n\t\t\t\t});\n\t\t\t}),\n\t\t\tdisableTwoFactor: createAuthEndpoint(\"/two-factor/disable\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({ password: z.string().meta({ description: \"User password\" }) }),\n\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tsummary: \"Disable two factor authentication\",\n\t\t\t\t\tdescription: \"Use this endpoint to disable two factor authentication.\",\n\t\t\t\t\tresponses: { 200: {\n\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: { status: { type: \"boolean\" } }\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst user = ctx.context.session.user;\n\t\t\t\tconst { password } = ctx.body;\n\t\t\t\tif (!await validatePassword(ctx, {\n\t\t\t\t\tpassword,\n\t\t\t\t\tuserId: user.id\n\t\t\t\t})) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.INVALID_PASSWORD });\n\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(user.id, { twoFactorEnabled: false });\n\t\t\t\tawait ctx.context.adapter.delete({\n\t\t\t\t\tmodel: opts.twoFactorTable,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: updatedUser.id\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\t/**\n\t\t\t\t* Update the session cookie with the new user data\n\t\t\t\t*/\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession: await ctx.context.internalAdapter.createSession(updatedUser.id, false, ctx.context.session.session),\n\t\t\t\t\tuser: updatedUser\n\t\t\t\t});\n\t\t\t\tawait ctx.context.internalAdapter.deleteSession(ctx.context.session.session.token);\n\t\t\t\treturn ctx.json({ status: true });\n\t\t\t})\n\t\t},\n\t\toptions,\n\t\thooks: { after: [{\n\t\t\tmatcher(context) {\n\t\t\t\treturn context.path === \"/sign-in/email\" || context.path === \"/sign-in/username\" || context.path === \"/sign-in/phone-number\";\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst data = ctx.context.newSession;\n\t\t\t\tif (!data) return;\n\t\t\t\tif (!data?.user.twoFactorEnabled) return;\n\t\t\t\tconst trustDeviceCookieAttrs = ctx.context.createAuthCookie(TRUST_DEVICE_COOKIE_NAME, { maxAge: TRUST_DEVICE_COOKIE_MAX_AGE });\n\t\t\t\tconst trustDeviceCookie = await ctx.getSignedCookie(trustDeviceCookieAttrs.name, ctx.context.secret);\n\t\t\t\tif (trustDeviceCookie) {\n\t\t\t\t\tconst [token, sessionToken] = trustDeviceCookie.split(\"!\");\n\t\t\t\t\tif (token === await createHMAC(\"SHA-256\", \"base64urlnopad\").sign(ctx.context.secret, `${data.user.id}!${sessionToken}`)) {\n\t\t\t\t\t\tconst newTrustDeviceCookie = ctx.context.createAuthCookie(TRUST_DEVICE_COOKIE_NAME, { maxAge: TRUST_DEVICE_COOKIE_MAX_AGE });\n\t\t\t\t\t\tconst newToken = await createHMAC(\"SHA-256\", \"base64urlnopad\").sign(ctx.context.secret, `${data.user.id}!${data.session.token}`);\n\t\t\t\t\t\tawait ctx.setSignedCookie(newTrustDeviceCookie.name, `${newToken}!${data.session.token}`, ctx.context.secret, trustDeviceCookieAttrs.attributes);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t/**\n\t\t\t\t* remove the session cookie. It's set by the sign in credential\n\t\t\t\t*/\n\t\t\t\tdeleteSessionCookie(ctx, true);\n\t\t\t\tawait ctx.context.internalAdapter.deleteSession(data.session.token);\n\t\t\t\tconst maxAge = (options?.otpOptions?.period ?? 3) * 60;\n\t\t\t\tconst twoFactorCookie = ctx.context.createAuthCookie(TWO_FACTOR_COOKIE_NAME, { maxAge });\n\t\t\t\tconst identifier = `2fa-${generateRandomString(20)}`;\n\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\tvalue: data.user.id,\n\t\t\t\t\tidentifier,\n\t\t\t\t\texpiresAt: new Date(Date.now() + maxAge * 1e3)\n\t\t\t\t});\n\t\t\t\tawait ctx.setSignedCookie(twoFactorCookie.name, identifier, ctx.context.secret, twoFactorCookie.attributes);\n\t\t\t\treturn ctx.json({ twoFactorRedirect: true });\n\t\t\t})\n\t\t}] },\n\t\tschema: mergeSchema(schema, options?.schema),\n\t\trateLimit: [{\n\t\t\tpathMatcher(path) {\n\t\t\t\treturn path.startsWith(\"/two-factor/\");\n\t\t\t},\n\t\t\twindow: 10,\n\t\t\tmax: 3\n\t\t}],\n\t\t$ERROR_CODES: TWO_FACTOR_ERROR_CODES\n\t};\n};\n\n//#endregion\nexport { TWO_FACTOR_ERROR_CODES as n, twoFactor as t };","import { i as toZodSchema } from \"./get-migration-Bf0TuCzm.mjs\";\nimport { t as generateId } from \"./utils-db7gNqd-.mjs\";\nimport { u as getDate } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as APIError$1 } from \"./api-CkmycQ2x.mjs\";\nimport { c as setSessionCookie } from \"./cookies-D72PbWdz.mjs\";\nimport { a as requestOnlySessionMiddleware, r as getSessionFromCtx, u as sessionMiddleware } from \"./session-AaRl3_x-.mjs\";\nimport { n as parser_default } from \"./parser-pHp5yoAv.mjs\";\nimport { r as defaultRoles } from \"./access-vPNO48H4.mjs\";\nimport { n as hasPermissionFn, t as cacheAllRoles } from \"./permission-JwliMugl.mjs\";\nimport { getCurrentAdapter } from \"@better-auth/core/context\";\nimport { BASE_ERROR_CODES, BetterAuthError } from \"@better-auth/core/error\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { createAuthEndpoint, createAuthMiddleware } from \"@better-auth/core/api\";\n\n//#region src/utils/shim.ts\nconst shimContext = (originalObject, newContext) => {\n\tconst shimmedObj = {};\n\tfor (const [key, value] of Object.entries(originalObject)) {\n\t\tshimmedObj[key] = (ctx) => {\n\t\t\treturn value({\n\t\t\t\t...ctx,\n\t\t\t\tcontext: {\n\t\t\t\t\t...newContext,\n\t\t\t\t\t...ctx.context\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\tshimmedObj[key].path = value.path;\n\t\tshimmedObj[key].method = value.method;\n\t\tshimmedObj[key].options = value.options;\n\t\tshimmedObj[key].headers = value.headers;\n\t}\n\treturn shimmedObj;\n};\n\n//#endregion\n//#region src/plugins/organization/adapter.ts\nconst getOrgAdapter = (context, options) => {\n\tconst baseAdapter = context.adapter;\n\treturn {\n\t\tfindOrganizationBySlug: async (slug) => {\n\t\t\treturn await (await getCurrentAdapter(baseAdapter)).findOne({\n\t\t\t\tmodel: \"organization\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"slug\",\n\t\t\t\t\tvalue: slug\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tcreateOrganization: async (data) => {\n\t\t\tconst organization$1 = await (await getCurrentAdapter(baseAdapter)).create({\n\t\t\t\tmodel: \"organization\",\n\t\t\t\tdata: {\n\t\t\t\t\t...data.organization,\n\t\t\t\t\tmetadata: data.organization.metadata ? JSON.stringify(data.organization.metadata) : void 0\n\t\t\t\t},\n\t\t\t\tforceAllowId: true\n\t\t\t});\n\t\t\treturn {\n\t\t\t\t...organization$1,\n\t\t\t\tmetadata: organization$1.metadata && typeof organization$1.metadata === \"string\" ? JSON.parse(organization$1.metadata) : void 0\n\t\t\t};\n\t\t},\n\t\tfindMemberByEmail: async (data) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst user = await adapter.findOne({\n\t\t\t\tmodel: \"user\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"email\",\n\t\t\t\t\tvalue: data.email.toLowerCase()\n\t\t\t\t}]\n\t\t\t});\n\t\t\tif (!user) return null;\n\t\t\tconst member = await adapter.findOne({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\tvalue: data.organizationId\n\t\t\t\t}, {\n\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\tvalue: user.id\n\t\t\t\t}]\n\t\t\t});\n\t\t\tif (!member) return null;\n\t\t\treturn {\n\t\t\t\t...member,\n\t\t\t\tuser: {\n\t\t\t\t\tid: user.id,\n\t\t\t\t\tname: user.name,\n\t\t\t\t\temail: user.email,\n\t\t\t\t\timage: user.image\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tlistMembers: async (data) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst members = await Promise.all([adapter.findMany({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\tvalue: data.organizationId\n\t\t\t\t}, ...data.filter?.field ? [{\n\t\t\t\t\tfield: data.filter?.field,\n\t\t\t\t\tvalue: data.filter?.value\n\t\t\t\t}] : []],\n\t\t\t\tlimit: data.limit || options?.membershipLimit || 100,\n\t\t\t\toffset: data.offset || 0,\n\t\t\t\tsortBy: data.sortBy ? {\n\t\t\t\t\tfield: data.sortBy,\n\t\t\t\t\tdirection: data.sortOrder || \"asc\"\n\t\t\t\t} : void 0\n\t\t\t}), adapter.count({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\tvalue: data.organizationId\n\t\t\t\t}, ...data.filter?.field ? [{\n\t\t\t\t\tfield: data.filter?.field,\n\t\t\t\t\tvalue: data.filter?.value\n\t\t\t\t}] : []]\n\t\t\t})]);\n\t\t\tconst users = await adapter.findMany({\n\t\t\t\tmodel: \"user\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: members[0].map((member) => member.userId),\n\t\t\t\t\toperator: \"in\"\n\t\t\t\t}]\n\t\t\t});\n\t\t\treturn {\n\t\t\t\tmembers: members[0].map((member) => {\n\t\t\t\t\tconst user = users.find((user$1) => user$1.id === member.userId);\n\t\t\t\t\tif (!user) throw new BetterAuthError(\"Unexpected error: User not found for member\");\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...member,\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\t\timage: user.image\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t\ttotal: members[1]\n\t\t\t};\n\t\t},\n\t\tfindMemberByOrgId: async (data) => {\n\t\t\tconst result = await (await getCurrentAdapter(baseAdapter)).findOne({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\tvalue: data.userId\n\t\t\t\t}, {\n\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\tvalue: data.organizationId\n\t\t\t\t}],\n\t\t\t\tjoin: { user: true }\n\t\t\t});\n\t\t\tif (!result || !result.user) return null;\n\t\t\tconst { user, ...member } = result;\n\t\t\treturn {\n\t\t\t\t...member,\n\t\t\t\tuser: {\n\t\t\t\t\tid: user.id,\n\t\t\t\t\tname: user.name,\n\t\t\t\t\temail: user.email,\n\t\t\t\t\timage: user.image\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tfindMemberById: async (memberId) => {\n\t\t\tconst result = await (await getCurrentAdapter(baseAdapter)).findOne({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: memberId\n\t\t\t\t}],\n\t\t\t\tjoin: { user: true }\n\t\t\t});\n\t\t\tif (!result) return null;\n\t\t\tconst { user, ...member } = result;\n\t\t\treturn {\n\t\t\t\t...member,\n\t\t\t\tuser: {\n\t\t\t\t\tid: user.id,\n\t\t\t\t\tname: user.name,\n\t\t\t\t\temail: user.email,\n\t\t\t\t\timage: user.image\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tcreateMember: async (data) => {\n\t\t\treturn await (await getCurrentAdapter(baseAdapter)).create({\n\t\t\t\tmodel: \"member\",\n\t\t\t\tdata: {\n\t\t\t\t\t...data,\n\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tupdateMember: async (memberId, role) => {\n\t\t\treturn await (await getCurrentAdapter(baseAdapter)).update({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: memberId\n\t\t\t\t}],\n\t\t\t\tupdate: { role }\n\t\t\t});\n\t\t},\n\t\tdeleteMember: async ({ memberId, organizationId, userId: _userId }) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tlet userId;\n\t\t\tif (!_userId) {\n\t\t\t\tconst member$1 = await adapter.findOne({\n\t\t\t\t\tmodel: \"member\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: memberId\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!member$1) throw new BetterAuthError(\"Member not found\");\n\t\t\t\tuserId = member$1.userId;\n\t\t\t} else userId = _userId;\n\t\t\tconst member = await adapter.delete({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: memberId\n\t\t\t\t}]\n\t\t\t});\n\t\t\tif (options?.teams?.enabled) {\n\t\t\t\tconst teams = await adapter.findMany({\n\t\t\t\t\tmodel: \"team\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: organizationId\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tawait Promise.all(teams.map((team) => adapter.deleteMany({\n\t\t\t\t\tmodel: \"teamMember\",\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"teamId\",\n\t\t\t\t\t\tvalue: team.id\n\t\t\t\t\t}, {\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: userId\n\t\t\t\t\t}]\n\t\t\t\t})));\n\t\t\t}\n\t\t\treturn member;\n\t\t},\n\t\tupdateOrganization: async (organizationId, data) => {\n\t\t\tconst organization$1 = await (await getCurrentAdapter(baseAdapter)).update({\n\t\t\t\tmodel: \"organization\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: organizationId\n\t\t\t\t}],\n\t\t\t\tupdate: {\n\t\t\t\t\t...data,\n\t\t\t\t\tmetadata: typeof data.metadata === \"object\" ? JSON.stringify(data.metadata) : data.metadata\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (!organization$1) return null;\n\t\t\treturn {\n\t\t\t\t...organization$1,\n\t\t\t\tmetadata: organization$1.metadata ? parser_default(organization$1.metadata) : void 0\n\t\t\t};\n\t\t},\n\t\tdeleteOrganization: async (organizationId) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tawait adapter.deleteMany({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\tvalue: organizationId\n\t\t\t\t}]\n\t\t\t});\n\t\t\tawait adapter.deleteMany({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\tvalue: organizationId\n\t\t\t\t}]\n\t\t\t});\n\t\t\tawait adapter.delete({\n\t\t\t\tmodel: \"organization\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: organizationId\n\t\t\t\t}]\n\t\t\t});\n\t\t\treturn organizationId;\n\t\t},\n\t\tsetActiveOrganization: async (sessionToken, organizationId, ctx) => {\n\t\t\treturn await context.internalAdapter.updateSession(sessionToken, { activeOrganizationId: organizationId });\n\t\t},\n\t\tfindOrganizationById: async (organizationId) => {\n\t\t\treturn await (await getCurrentAdapter(baseAdapter)).findOne({\n\t\t\t\tmodel: \"organization\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: organizationId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tcheckMembership: async ({ userId, organizationId }) => {\n\t\t\treturn await (await getCurrentAdapter(baseAdapter)).findOne({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\tvalue: userId\n\t\t\t\t}, {\n\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\tvalue: organizationId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tfindFullOrganization: async ({ organizationId, isSlug, includeTeams, membersLimit }) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst result = await adapter.findOne({\n\t\t\t\tmodel: \"organization\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: isSlug ? \"slug\" : \"id\",\n\t\t\t\t\tvalue: organizationId\n\t\t\t\t}],\n\t\t\t\tjoin: {\n\t\t\t\t\tinvitation: true,\n\t\t\t\t\tmember: membersLimit ? { limit: membersLimit } : true,\n\t\t\t\t\t...includeTeams ? { team: true } : {}\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (!result) return null;\n\t\t\tconst { invitation: invitations, member: members, team: teams, ...org } = result;\n\t\t\tconst userIds = members.map((member) => member.userId);\n\t\t\tconst users = userIds.length > 0 ? await adapter.findMany({\n\t\t\t\tmodel: \"user\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: userIds,\n\t\t\t\t\toperator: \"in\"\n\t\t\t\t}],\n\t\t\t\tlimit: options?.membershipLimit || 100\n\t\t\t}) : [];\n\t\t\tconst userMap = new Map(users.map((user) => [user.id, user]));\n\t\t\tconst membersWithUsers = members.map((member) => {\n\t\t\t\tconst user = userMap.get(member.userId);\n\t\t\t\tif (!user) throw new BetterAuthError(\"Unexpected error: User not found for member\");\n\t\t\t\treturn {\n\t\t\t\t\t...member,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\timage: user.image\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t\treturn {\n\t\t\t\t...org,\n\t\t\t\tinvitations,\n\t\t\t\tmembers: membersWithUsers,\n\t\t\t\tteams\n\t\t\t};\n\t\t},\n\t\tlistOrganizations: async (userId) => {\n\t\t\tconst result = await (await getCurrentAdapter(baseAdapter)).findMany({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\tvalue: userId\n\t\t\t\t}],\n\t\t\t\tjoin: { organization: true }\n\t\t\t});\n\t\t\tif (!result || result.length === 0) return [];\n\t\t\treturn result.map((member) => member.organization);\n\t\t},\n\t\tcreateTeam: async (data) => {\n\t\t\treturn await (await getCurrentAdapter(baseAdapter)).create({\n\t\t\t\tmodel: \"team\",\n\t\t\t\tdata\n\t\t\t});\n\t\t},\n\t\tfindTeamById: async ({ teamId, organizationId, includeTeamMembers }) => {\n\t\t\tconst result = await (await getCurrentAdapter(baseAdapter)).findOne({\n\t\t\t\tmodel: \"team\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: teamId\n\t\t\t\t}, ...organizationId ? [{\n\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\tvalue: organizationId\n\t\t\t\t}] : []],\n\t\t\t\tjoin: { ...includeTeamMembers ? { teamMember: true } : {} }\n\t\t\t});\n\t\t\tif (!result) return null;\n\t\t\tconst { teamMember, ...team } = result;\n\t\t\treturn {\n\t\t\t\t...team,\n\t\t\t\t...includeTeamMembers ? { members: teamMember } : {}\n\t\t\t};\n\t\t},\n\t\tupdateTeam: async (teamId, data) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tif (\"id\" in data) data.id = void 0;\n\t\t\treturn await adapter.update({\n\t\t\t\tmodel: \"team\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: teamId\n\t\t\t\t}],\n\t\t\t\tupdate: { ...data }\n\t\t\t});\n\t\t},\n\t\tdeleteTeam: async (teamId) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tawait adapter.deleteMany({\n\t\t\t\tmodel: \"teamMember\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"teamId\",\n\t\t\t\t\tvalue: teamId\n\t\t\t\t}]\n\t\t\t});\n\t\t\treturn await adapter.delete({\n\t\t\t\tmodel: \"team\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: teamId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tlistTeams: async (organizationId) => {\n\t\t\treturn await (await getCurrentAdapter(baseAdapter)).findMany({\n\t\t\t\tmodel: \"team\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\tvalue: organizationId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tcreateTeamInvitation: async ({ email, role, teamId, organizationId, inviterId, expiresIn = 1e3 * 60 * 60 * 48 }) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst expiresAt = getDate(expiresIn);\n\t\t\treturn await adapter.create({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\tdata: {\n\t\t\t\t\temail,\n\t\t\t\t\trole,\n\t\t\t\t\torganizationId,\n\t\t\t\t\tteamId,\n\t\t\t\t\tinviterId,\n\t\t\t\t\tstatus: \"pending\",\n\t\t\t\t\texpiresAt\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tsetActiveTeam: async (sessionToken, teamId, ctx) => {\n\t\t\treturn await context.internalAdapter.updateSession(sessionToken, { activeTeamId: teamId });\n\t\t},\n\t\tlistTeamMembers: async (data) => {\n\t\t\treturn await (await getCurrentAdapter(baseAdapter)).findMany({\n\t\t\t\tmodel: \"teamMember\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"teamId\",\n\t\t\t\t\tvalue: data.teamId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tcountTeamMembers: async (data) => {\n\t\t\treturn await (await getCurrentAdapter(baseAdapter)).count({\n\t\t\t\tmodel: \"teamMember\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"teamId\",\n\t\t\t\t\tvalue: data.teamId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tcountMembers: async (data) => {\n\t\t\treturn await (await getCurrentAdapter(baseAdapter)).count({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\tvalue: data.organizationId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tlistTeamsByUser: async (data) => {\n\t\t\treturn (await (await getCurrentAdapter(baseAdapter)).findMany({\n\t\t\t\tmodel: \"teamMember\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\tvalue: data.userId\n\t\t\t\t}],\n\t\t\t\tjoin: { team: true }\n\t\t\t})).map((result) => result.team);\n\t\t},\n\t\tfindTeamMember: async (data) => {\n\t\t\treturn await (await getCurrentAdapter(baseAdapter)).findOne({\n\t\t\t\tmodel: \"teamMember\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"teamId\",\n\t\t\t\t\tvalue: data.teamId\n\t\t\t\t}, {\n\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\tvalue: data.userId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tfindOrCreateTeamMember: async (data) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst member = await adapter.findOne({\n\t\t\t\tmodel: \"teamMember\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"teamId\",\n\t\t\t\t\tvalue: data.teamId\n\t\t\t\t}, {\n\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\tvalue: data.userId\n\t\t\t\t}]\n\t\t\t});\n\t\t\tif (member) return member;\n\t\t\treturn await adapter.create({\n\t\t\t\tmodel: \"teamMember\",\n\t\t\t\tdata: {\n\t\t\t\t\tteamId: data.teamId,\n\t\t\t\t\tuserId: data.userId,\n\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tremoveTeamMember: async (data) => {\n\t\t\tawait (await getCurrentAdapter(baseAdapter)).deleteMany({\n\t\t\t\tmodel: \"teamMember\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"teamId\",\n\t\t\t\t\tvalue: data.teamId\n\t\t\t\t}, {\n\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\tvalue: data.userId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tfindInvitationsByTeamId: async (teamId) => {\n\t\t\treturn await (await getCurrentAdapter(baseAdapter)).findMany({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"teamId\",\n\t\t\t\t\tvalue: teamId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tlistUserInvitations: async (email) => {\n\t\t\treturn await (await getCurrentAdapter(baseAdapter)).findMany({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"email\",\n\t\t\t\t\tvalue: email.toLowerCase()\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tcreateInvitation: async ({ invitation, user }) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst expiresAt = getDate(options?.invitationExpiresIn || 3600 * 48, \"sec\");\n\t\t\treturn await adapter.create({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\tdata: {\n\t\t\t\t\tstatus: \"pending\",\n\t\t\t\t\texpiresAt,\n\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\tinviterId: user.id,\n\t\t\t\t\t...invitation,\n\t\t\t\t\tteamId: invitation.teamIds.length > 0 ? invitation.teamIds.join(\",\") : null\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tfindInvitationById: async (id) => {\n\t\t\treturn await (await getCurrentAdapter(baseAdapter)).findOne({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: id\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tfindPendingInvitation: async (data) => {\n\t\t\treturn (await (await getCurrentAdapter(baseAdapter)).findMany({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"email\",\n\t\t\t\t\t\tvalue: data.email.toLowerCase()\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: data.organizationId\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"status\",\n\t\t\t\t\t\tvalue: \"pending\"\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t})).filter((invite) => new Date(invite.expiresAt) > /* @__PURE__ */ new Date());\n\t\t},\n\t\tfindPendingInvitations: async (data) => {\n\t\t\treturn (await (await getCurrentAdapter(baseAdapter)).findMany({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\tvalue: data.organizationId\n\t\t\t\t}, {\n\t\t\t\t\tfield: \"status\",\n\t\t\t\t\tvalue: \"pending\"\n\t\t\t\t}]\n\t\t\t})).filter((invite) => new Date(invite.expiresAt) > /* @__PURE__ */ new Date());\n\t\t},\n\t\tlistInvitations: async (data) => {\n\t\t\treturn await (await getCurrentAdapter(baseAdapter)).findMany({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\tvalue: data.organizationId\n\t\t\t\t}]\n\t\t\t});\n\t\t},\n\t\tupdateInvitation: async (data) => {\n\t\t\treturn await (await getCurrentAdapter(baseAdapter)).update({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: data.invitationId\n\t\t\t\t}],\n\t\t\t\tupdate: { status: data.status }\n\t\t\t});\n\t\t}\n\t};\n};\n\n//#endregion\n//#region src/plugins/organization/call.ts\nconst orgMiddleware = createAuthMiddleware(async () => {\n\treturn {};\n});\n/**\n* The middleware forces the endpoint to require a valid session by utilizing the `sessionMiddleware`.\n* It also appends additional types to the session type regarding organizations.\n*/\nconst orgSessionMiddleware = createAuthMiddleware({ use: [sessionMiddleware] }, async (ctx) => {\n\treturn { session: ctx.context.session };\n});\n\n//#endregion\n//#region src/plugins/organization/error-codes.ts\nconst ORGANIZATION_ERROR_CODES = defineErrorCodes({\n\tYOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_ORGANIZATION: \"You are not allowed to create a new organization\",\n\tYOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_ORGANIZATIONS: \"You have reached the maximum number of organizations\",\n\tORGANIZATION_ALREADY_EXISTS: \"Organization already exists\",\n\tORGANIZATION_SLUG_ALREADY_TAKEN: \"Organization slug already taken\",\n\tORGANIZATION_NOT_FOUND: \"Organization not found\",\n\tUSER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION: \"User is not a member of the organization\",\n\tYOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_ORGANIZATION: \"You are not allowed to update this organization\",\n\tYOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_ORGANIZATION: \"You are not allowed to delete this organization\",\n\tNO_ACTIVE_ORGANIZATION: \"No active organization\",\n\tUSER_IS_ALREADY_A_MEMBER_OF_THIS_ORGANIZATION: \"User is already a member of this organization\",\n\tMEMBER_NOT_FOUND: \"Member not found\",\n\tROLE_NOT_FOUND: \"Role not found\",\n\tYOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_TEAM: \"You are not allowed to create a new team\",\n\tTEAM_ALREADY_EXISTS: \"Team already exists\",\n\tTEAM_NOT_FOUND: \"Team not found\",\n\tYOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER: \"You cannot leave the organization as the only owner\",\n\tYOU_CANNOT_LEAVE_THE_ORGANIZATION_WITHOUT_AN_OWNER: \"You cannot leave the organization without an owner\",\n\tYOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_MEMBER: \"You are not allowed to delete this member\",\n\tYOU_ARE_NOT_ALLOWED_TO_INVITE_USERS_TO_THIS_ORGANIZATION: \"You are not allowed to invite users to this organization\",\n\tUSER_IS_ALREADY_INVITED_TO_THIS_ORGANIZATION: \"User is already invited to this organization\",\n\tINVITATION_NOT_FOUND: \"Invitation not found\",\n\tYOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION: \"You are not the recipient of the invitation\",\n\tEMAIL_VERIFICATION_REQUIRED_BEFORE_ACCEPTING_OR_REJECTING_INVITATION: \"Email verification required before accepting or rejecting invitation\",\n\tYOU_ARE_NOT_ALLOWED_TO_CANCEL_THIS_INVITATION: \"You are not allowed to cancel this invitation\",\n\tINVITER_IS_NO_LONGER_A_MEMBER_OF_THE_ORGANIZATION: \"Inviter is no longer a member of the organization\",\n\tYOU_ARE_NOT_ALLOWED_TO_INVITE_USER_WITH_THIS_ROLE: \"You are not allowed to invite a user with this role\",\n\tFAILED_TO_RETRIEVE_INVITATION: \"Failed to retrieve invitation\",\n\tYOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_TEAMS: \"You have reached the maximum number of teams\",\n\tUNABLE_TO_REMOVE_LAST_TEAM: \"Unable to remove last team\",\n\tYOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_MEMBER: \"You are not allowed to update this member\",\n\tORGANIZATION_MEMBERSHIP_LIMIT_REACHED: \"Organization membership limit reached\",\n\tYOU_ARE_NOT_ALLOWED_TO_CREATE_TEAMS_IN_THIS_ORGANIZATION: \"You are not allowed to create teams in this organization\",\n\tYOU_ARE_NOT_ALLOWED_TO_DELETE_TEAMS_IN_THIS_ORGANIZATION: \"You are not allowed to delete teams in this organization\",\n\tYOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_TEAM: \"You are not allowed to update this team\",\n\tYOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_TEAM: \"You are not allowed to delete this team\",\n\tINVITATION_LIMIT_REACHED: \"Invitation limit reached\",\n\tTEAM_MEMBER_LIMIT_REACHED: \"Team member limit reached\",\n\tUSER_IS_NOT_A_MEMBER_OF_THE_TEAM: \"User is not a member of the team\",\n\tYOU_CAN_NOT_ACCESS_THE_MEMBERS_OF_THIS_TEAM: \"You are not allowed to list the members of this team\",\n\tYOU_DO_NOT_HAVE_AN_ACTIVE_TEAM: \"You do not have an active team\",\n\tYOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_TEAM_MEMBER: \"You are not allowed to create a new member\",\n\tYOU_ARE_NOT_ALLOWED_TO_REMOVE_A_TEAM_MEMBER: \"You are not allowed to remove a team member\",\n\tYOU_ARE_NOT_ALLOWED_TO_ACCESS_THIS_ORGANIZATION: \"You are not allowed to access this organization as an owner\",\n\tYOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION: \"You are not a member of this organization\",\n\tMISSING_AC_INSTANCE: \"Dynamic Access Control requires a pre-defined ac instance on the server auth plugin. Read server logs for more information\",\n\tYOU_MUST_BE_IN_AN_ORGANIZATION_TO_CREATE_A_ROLE: \"You must be in an organization to create a role\",\n\tYOU_ARE_NOT_ALLOWED_TO_CREATE_A_ROLE: \"You are not allowed to create a role\",\n\tYOU_ARE_NOT_ALLOWED_TO_UPDATE_A_ROLE: \"You are not allowed to update a role\",\n\tYOU_ARE_NOT_ALLOWED_TO_DELETE_A_ROLE: \"You are not allowed to delete a role\",\n\tYOU_ARE_NOT_ALLOWED_TO_READ_A_ROLE: \"You are not allowed to read a role\",\n\tYOU_ARE_NOT_ALLOWED_TO_LIST_A_ROLE: \"You are not allowed to list a role\",\n\tYOU_ARE_NOT_ALLOWED_TO_GET_A_ROLE: \"You are not allowed to get a role\",\n\tTOO_MANY_ROLES: \"This organization has too many roles\",\n\tINVALID_RESOURCE: \"The provided permission includes an invalid resource\",\n\tROLE_NAME_IS_ALREADY_TAKEN: \"That role name is already taken\",\n\tCANNOT_DELETE_A_PRE_DEFINED_ROLE: \"Cannot delete a pre-defined role\"\n});\n\n//#endregion\n//#region src/plugins/organization/has-permission.ts\nconst hasPermission = async (input, ctx) => {\n\tlet acRoles = { ...input.options.roles || defaultRoles };\n\tif (ctx && input.organizationId && input.options.dynamicAccessControl?.enabled && input.options.ac && !input.useMemoryCache) {\n\t\tconst roles = await ctx.context.adapter.findMany({\n\t\t\tmodel: \"organizationRole\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"organizationId\",\n\t\t\t\tvalue: input.organizationId\n\t\t\t}]\n\t\t});\n\t\tfor (const { role, permission: permissionsString } of roles) {\n\t\t\tif (role in acRoles) continue;\n\t\t\tconst result = z.record(z.string(), z.array(z.string())).safeParse(JSON.parse(permissionsString));\n\t\t\tif (!result.success) {\n\t\t\t\tctx.context.logger.error(\"[hasPermission] Invalid permissions for role \" + role, { permissions: JSON.parse(permissionsString) });\n\t\t\t\tthrow new APIError$1(\"INTERNAL_SERVER_ERROR\", { message: \"Invalid permissions for role \" + role });\n\t\t\t}\n\t\t\tacRoles[role] = input.options.ac.newRole(result.data);\n\t\t}\n\t}\n\tif (input.useMemoryCache) acRoles = cacheAllRoles.get(input.organizationId) || acRoles;\n\tcacheAllRoles.set(input.organizationId, acRoles);\n\treturn hasPermissionFn(input, acRoles);\n};\n\n//#endregion\n//#region src/plugins/organization/routes/crud-access-control.ts\nconst normalizeRoleName = (role) => role.toLowerCase();\nconst DEFAULT_MAXIMUM_ROLES_PER_ORGANIZATION = Number.POSITIVE_INFINITY;\nconst getAdditionalFields = (options, shouldBePartial = false) => {\n\tlet additionalFields = options?.schema?.organizationRole?.additionalFields || {};\n\tif (shouldBePartial) for (const key in additionalFields) additionalFields[key].required = false;\n\treturn {\n\t\tadditionalFieldsSchema: toZodSchema({\n\t\t\tfields: additionalFields,\n\t\t\tisClientSide: true\n\t\t}),\n\t\t$AdditionalFields: {},\n\t\t$ReturnAdditionalFields: {}\n\t};\n};\nconst createOrgRole = (options) => {\n\tconst { additionalFieldsSchema, $AdditionalFields, $ReturnAdditionalFields } = getAdditionalFields(options, false);\n\treturn createAuthEndpoint(\"/organization/create-role\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({\n\t\t\torganizationId: z.string().optional().meta({ description: \"The id of the organization to create the role in. If not provided, the user's active organization will be used.\" }),\n\t\t\trole: z.string().meta({ description: \"The name of the role to create\" }),\n\t\t\tpermission: z.record(z.string(), z.array(z.string())).meta({ description: \"The permission to assign to the role\" }),\n\t\t\tadditionalFields: z.object({ ...additionalFieldsSchema.shape }).optional()\n\t\t}),\n\t\tmetadata: { $Infer: { body: {} } },\n\t\trequireHeaders: true,\n\t\tuse: [orgSessionMiddleware]\n\t}, async (ctx) => {\n\t\tconst { session, user } = ctx.context.session;\n\t\tlet roleName = ctx.body.role;\n\t\tconst permission = ctx.body.permission;\n\t\tconst additionalFields = ctx.body.additionalFields;\n\t\tconst ac = options.ac;\n\t\tif (!ac) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The organization plugin is missing a pre-defined ac instance.`, `\\nPlease refer to the documentation here: https://better-auth.com/docs/plugins/organization#dynamic-access-control`);\n\t\t\tthrow new APIError$1(\"NOT_IMPLEMENTED\", { message: ORGANIZATION_ERROR_CODES.MISSING_AC_INSTANCE });\n\t\t}\n\t\tconst organizationId = ctx.body.organizationId ?? session.activeOrganizationId;\n\t\tif (!organizationId) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The session is missing an active organization id to create a role. Either set an active org id, or pass an organizationId in the request body.`);\n\t\t\tthrow new APIError$1(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.YOU_MUST_BE_IN_AN_ORGANIZATION_TO_CREATE_A_ROLE });\n\t\t}\n\t\troleName = normalizeRoleName(roleName);\n\t\tawait checkIfRoleNameIsTakenByPreDefinedRole({\n\t\t\trole: roleName,\n\t\t\torganizationId,\n\t\t\toptions,\n\t\t\tctx\n\t\t});\n\t\tconst member = await ctx.context.adapter.findOne({\n\t\t\tmodel: \"member\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"organizationId\",\n\t\t\t\tvalue: organizationId,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\"\n\t\t\t}, {\n\t\t\t\tfield: \"userId\",\n\t\t\t\tvalue: user.id,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\"\n\t\t\t}]\n\t\t});\n\t\tif (!member) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The user is not a member of the organization to create a role.`, {\n\t\t\t\tuserId: user.id,\n\t\t\t\torganizationId\n\t\t\t});\n\t\t\tthrow new APIError$1(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION });\n\t\t}\n\t\tif (!await hasPermission({\n\t\t\toptions,\n\t\t\torganizationId,\n\t\t\tpermissions: { ac: [\"create\"] },\n\t\t\trole: member.role\n\t\t}, ctx)) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The user is not permitted to create a role. If this is unexpected, please make sure the role associated to that member has the \"ac\" resource with the \"create\" permission.`, {\n\t\t\t\tuserId: user.id,\n\t\t\t\torganizationId,\n\t\t\t\trole: member.role\n\t\t\t});\n\t\t\tthrow new APIError$1(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CREATE_A_ROLE });\n\t\t}\n\t\tconst maximumRolesPerOrganization = typeof options.dynamicAccessControl?.maximumRolesPerOrganization === \"function\" ? await options.dynamicAccessControl.maximumRolesPerOrganization(organizationId) : options.dynamicAccessControl?.maximumRolesPerOrganization ?? DEFAULT_MAXIMUM_ROLES_PER_ORGANIZATION;\n\t\tconst rolesInDB = await ctx.context.adapter.count({\n\t\t\tmodel: \"organizationRole\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"organizationId\",\n\t\t\t\tvalue: organizationId,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\"\n\t\t\t}]\n\t\t});\n\t\tif (rolesInDB >= maximumRolesPerOrganization) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] Failed to create a new role, the organization has too many roles. Maximum allowed roles is ${maximumRolesPerOrganization}.`, {\n\t\t\t\torganizationId,\n\t\t\t\tmaximumRolesPerOrganization,\n\t\t\t\trolesInDB\n\t\t\t});\n\t\t\tthrow new APIError$1(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.TOO_MANY_ROLES });\n\t\t}\n\t\tawait checkForInvalidResources({\n\t\t\tac,\n\t\t\tctx,\n\t\t\tpermission\n\t\t});\n\t\tawait checkIfMemberHasPermission({\n\t\t\tctx,\n\t\t\tmember,\n\t\t\toptions,\n\t\t\torganizationId,\n\t\t\tpermissionRequired: permission,\n\t\t\tuser,\n\t\t\taction: \"create\"\n\t\t});\n\t\tawait checkIfRoleNameIsTakenByRoleInDB({\n\t\t\tctx,\n\t\t\torganizationId,\n\t\t\trole: roleName\n\t\t});\n\t\tconst newRole = ac.newRole(permission);\n\t\tconst data = {\n\t\t\t...await ctx.context.adapter.create({\n\t\t\t\tmodel: \"organizationRole\",\n\t\t\t\tdata: {\n\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\torganizationId,\n\t\t\t\t\tpermission: JSON.stringify(permission),\n\t\t\t\t\trole: roleName,\n\t\t\t\t\t...additionalFields\n\t\t\t\t}\n\t\t\t}),\n\t\t\tpermission\n\t\t};\n\t\treturn ctx.json({\n\t\t\tsuccess: true,\n\t\t\troleData: data,\n\t\t\tstatements: newRole.statements\n\t\t});\n\t});\n};\nconst deleteOrgRole = (options) => {\n\treturn createAuthEndpoint(\"/organization/delete-role\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({ organizationId: z.string().optional().meta({ description: \"The id of the organization to create the role in. If not provided, the user's active organization will be used.\" }) }).and(z.union([z.object({ roleName: z.string().nonempty().meta({ description: \"The name of the role to delete\" }) }), z.object({ roleId: z.string().nonempty().meta({ description: \"The id of the role to delete\" }) })])),\n\t\trequireHeaders: true,\n\t\tuse: [orgSessionMiddleware],\n\t\tmetadata: { $Infer: { body: {} } }\n\t}, async (ctx) => {\n\t\tconst { session, user } = ctx.context.session;\n\t\tconst organizationId = ctx.body.organizationId ?? session.activeOrganizationId;\n\t\tif (!organizationId) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The session is missing an active organization id to delete a role. Either set an active org id, or pass an organizationId in the request body.`);\n\t\t\tthrow new APIError$1(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION });\n\t\t}\n\t\tconst member = await ctx.context.adapter.findOne({\n\t\t\tmodel: \"member\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"organizationId\",\n\t\t\t\tvalue: organizationId,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\"\n\t\t\t}, {\n\t\t\t\tfield: \"userId\",\n\t\t\t\tvalue: user.id,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\"\n\t\t\t}]\n\t\t});\n\t\tif (!member) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The user is not a member of the organization to delete a role.`, {\n\t\t\t\tuserId: user.id,\n\t\t\t\torganizationId\n\t\t\t});\n\t\t\tthrow new APIError$1(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION });\n\t\t}\n\t\tif (!await hasPermission({\n\t\t\toptions,\n\t\t\torganizationId,\n\t\t\tpermissions: { ac: [\"delete\"] },\n\t\t\trole: member.role\n\t\t}, ctx)) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The user is not permitted to delete a role. If this is unexpected, please make sure the role associated to that member has the \"ac\" resource with the \"delete\" permission.`, {\n\t\t\t\tuserId: user.id,\n\t\t\t\torganizationId,\n\t\t\t\trole: member.role\n\t\t\t});\n\t\t\tthrow new APIError$1(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_DELETE_A_ROLE });\n\t\t}\n\t\tif (ctx.body.roleName) {\n\t\t\tconst roleName = ctx.body.roleName;\n\t\t\tconst defaultRoles$2 = options.roles ? Object.keys(options.roles) : [\n\t\t\t\t\"owner\",\n\t\t\t\t\"admin\",\n\t\t\t\t\"member\"\n\t\t\t];\n\t\t\tif (defaultRoles$2.includes(roleName)) {\n\t\t\t\tctx.context.logger.error(`[Dynamic Access Control] Cannot delete a pre-defined role.`, {\n\t\t\t\t\troleName,\n\t\t\t\t\torganizationId,\n\t\t\t\t\tdefaultRoles: defaultRoles$2\n\t\t\t\t});\n\t\t\t\tthrow new APIError$1(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.CANNOT_DELETE_A_PRE_DEFINED_ROLE });\n\t\t\t}\n\t\t}\n\t\tlet condition;\n\t\tif (ctx.body.roleName) condition = {\n\t\t\tfield: \"role\",\n\t\t\tvalue: ctx.body.roleName,\n\t\t\toperator: \"eq\",\n\t\t\tconnector: \"AND\"\n\t\t};\n\t\telse if (ctx.body.roleId) condition = {\n\t\t\tfield: \"id\",\n\t\t\tvalue: ctx.body.roleId,\n\t\t\toperator: \"eq\",\n\t\t\tconnector: \"AND\"\n\t\t};\n\t\telse {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The role name/id is not provided in the request body.`);\n\t\t\tthrow new APIError$1(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ROLE_NOT_FOUND });\n\t\t}\n\t\tconst existingRoleInDB = await ctx.context.adapter.findOne({\n\t\t\tmodel: \"organizationRole\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"organizationId\",\n\t\t\t\tvalue: organizationId,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\"\n\t\t\t}, condition]\n\t\t});\n\t\tif (!existingRoleInDB) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The role name/id does not exist in the database.`, {\n\t\t\t\t...\"roleName\" in ctx.body ? { roleName: ctx.body.roleName } : { roleId: ctx.body.roleId },\n\t\t\t\torganizationId\n\t\t\t});\n\t\t\tthrow new APIError$1(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ROLE_NOT_FOUND });\n\t\t}\n\t\texistingRoleInDB.permission = JSON.parse(existingRoleInDB.permission);\n\t\tawait ctx.context.adapter.delete({\n\t\t\tmodel: \"organizationRole\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"organizationId\",\n\t\t\t\tvalue: organizationId,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\"\n\t\t\t}, condition]\n\t\t});\n\t\treturn ctx.json({ success: true });\n\t});\n};\nconst listOrgRoles = (options) => {\n\tconst { $ReturnAdditionalFields } = getAdditionalFields(options, false);\n\treturn createAuthEndpoint(\"/organization/list-roles\", {\n\t\tmethod: \"GET\",\n\t\trequireHeaders: true,\n\t\tuse: [orgSessionMiddleware],\n\t\tquery: z.object({ organizationId: z.string().optional().meta({ description: \"The id of the organization to list roles for. If not provided, the user's active organization will be used.\" }) }).optional()\n\t}, async (ctx) => {\n\t\tconst { session, user } = ctx.context.session;\n\t\tconst organizationId = ctx.query?.organizationId ?? session.activeOrganizationId;\n\t\tif (!organizationId) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The session is missing an active organization id to list roles. Either set an active org id, or pass an organizationId in the request query.`);\n\t\t\tthrow new APIError$1(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION });\n\t\t}\n\t\tconst member = await ctx.context.adapter.findOne({\n\t\t\tmodel: \"member\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"organizationId\",\n\t\t\t\tvalue: organizationId,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\"\n\t\t\t}, {\n\t\t\t\tfield: \"userId\",\n\t\t\t\tvalue: user.id,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\"\n\t\t\t}]\n\t\t});\n\t\tif (!member) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The user is not a member of the organization to list roles.`, {\n\t\t\t\tuserId: user.id,\n\t\t\t\torganizationId\n\t\t\t});\n\t\t\tthrow new APIError$1(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION });\n\t\t}\n\t\tif (!await hasPermission({\n\t\t\toptions,\n\t\t\torganizationId,\n\t\t\tpermissions: { ac: [\"read\"] },\n\t\t\trole: member.role\n\t\t}, ctx)) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The user is not permitted to list roles.`, {\n\t\t\t\tuserId: user.id,\n\t\t\t\torganizationId,\n\t\t\t\trole: member.role\n\t\t\t});\n\t\t\tthrow new APIError$1(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_LIST_A_ROLE });\n\t\t}\n\t\tlet roles = await ctx.context.adapter.findMany({\n\t\t\tmodel: \"organizationRole\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"organizationId\",\n\t\t\t\tvalue: organizationId,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\"\n\t\t\t}]\n\t\t});\n\t\troles = roles.map((x) => ({\n\t\t\t...x,\n\t\t\tpermission: JSON.parse(x.permission)\n\t\t}));\n\t\treturn ctx.json(roles);\n\t});\n};\nconst getOrgRole = (options) => {\n\tconst { $ReturnAdditionalFields } = getAdditionalFields(options, false);\n\treturn createAuthEndpoint(\"/organization/get-role\", {\n\t\tmethod: \"GET\",\n\t\trequireHeaders: true,\n\t\tuse: [orgSessionMiddleware],\n\t\tquery: z.object({ organizationId: z.string().optional().meta({ description: \"The id of the organization to read a role for. If not provided, the user's active organization will be used.\" }) }).and(z.union([z.object({ roleName: z.string().nonempty().meta({ description: \"The name of the role to read\" }) }), z.object({ roleId: z.string().nonempty().meta({ description: \"The id of the role to read\" }) })])).optional(),\n\t\tmetadata: { $Infer: { query: {} } }\n\t}, async (ctx) => {\n\t\tconst { session, user } = ctx.context.session;\n\t\tconst organizationId = ctx.query?.organizationId ?? session.activeOrganizationId;\n\t\tif (!organizationId) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The session is missing an active organization id to read a role. Either set an active org id, or pass an organizationId in the request query.`);\n\t\t\tthrow new APIError$1(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION });\n\t\t}\n\t\tconst member = await ctx.context.adapter.findOne({\n\t\t\tmodel: \"member\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"organizationId\",\n\t\t\t\tvalue: organizationId,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\"\n\t\t\t}, {\n\t\t\t\tfield: \"userId\",\n\t\t\t\tvalue: user.id,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\"\n\t\t\t}]\n\t\t});\n\t\tif (!member) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The user is not a member of the organization to read a role.`, {\n\t\t\t\tuserId: user.id,\n\t\t\t\torganizationId\n\t\t\t});\n\t\t\tthrow new APIError$1(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION });\n\t\t}\n\t\tif (!await hasPermission({\n\t\t\toptions,\n\t\t\torganizationId,\n\t\t\tpermissions: { ac: [\"read\"] },\n\t\t\trole: member.role\n\t\t}, ctx)) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The user is not permitted to read a role.`, {\n\t\t\t\tuserId: user.id,\n\t\t\t\torganizationId,\n\t\t\t\trole: member.role\n\t\t\t});\n\t\t\tthrow new APIError$1(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_READ_A_ROLE });\n\t\t}\n\t\tlet condition;\n\t\tif (ctx.query.roleName) condition = {\n\t\t\tfield: \"role\",\n\t\t\tvalue: ctx.query.roleName,\n\t\t\toperator: \"eq\",\n\t\t\tconnector: \"AND\"\n\t\t};\n\t\telse if (ctx.query.roleId) condition = {\n\t\t\tfield: \"id\",\n\t\t\tvalue: ctx.query.roleId,\n\t\t\toperator: \"eq\",\n\t\t\tconnector: \"AND\"\n\t\t};\n\t\telse {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The role name/id is not provided in the request query.`);\n\t\t\tthrow new APIError$1(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ROLE_NOT_FOUND });\n\t\t}\n\t\tlet role = await ctx.context.adapter.findOne({\n\t\t\tmodel: \"organizationRole\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"organizationId\",\n\t\t\t\tvalue: organizationId,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\"\n\t\t\t}, condition]\n\t\t});\n\t\tif (!role) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The role name/id does not exist in the database.`, {\n\t\t\t\t...\"roleName\" in ctx.query ? { roleName: ctx.query.roleName } : { roleId: ctx.query.roleId },\n\t\t\t\torganizationId\n\t\t\t});\n\t\t\tthrow new APIError$1(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ROLE_NOT_FOUND });\n\t\t}\n\t\trole.permission = JSON.parse(role.permission);\n\t\treturn ctx.json(role);\n\t});\n};\nconst updateOrgRole = (options) => {\n\tconst { additionalFieldsSchema, $AdditionalFields, $ReturnAdditionalFields } = getAdditionalFields(options, true);\n\treturn createAuthEndpoint(\"/organization/update-role\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({\n\t\t\torganizationId: z.string().optional().meta({ description: \"The id of the organization to update the role in. If not provided, the user's active organization will be used.\" }),\n\t\t\tdata: z.object({\n\t\t\t\tpermission: z.record(z.string(), z.array(z.string())).optional().meta({ description: \"The permission to update the role with\" }),\n\t\t\t\troleName: z.string().optional().meta({ description: \"The name of the role to update\" }),\n\t\t\t\t...additionalFieldsSchema.shape\n\t\t\t})\n\t\t}).and(z.union([z.object({ roleName: z.string().nonempty().meta({ description: \"The name of the role to update\" }) }), z.object({ roleId: z.string().nonempty().meta({ description: \"The id of the role to update\" }) })])),\n\t\tmetadata: { $Infer: { body: {} } },\n\t\trequireHeaders: true,\n\t\tuse: [orgSessionMiddleware]\n\t}, async (ctx) => {\n\t\tconst { session, user } = ctx.context.session;\n\t\tconst ac = options.ac;\n\t\tif (!ac) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The organization plugin is missing a pre-defined ac instance.`, `\\nPlease refer to the documentation here: https://better-auth.com/docs/plugins/organization#dynamic-access-control`);\n\t\t\tthrow new APIError$1(\"NOT_IMPLEMENTED\", { message: ORGANIZATION_ERROR_CODES.MISSING_AC_INSTANCE });\n\t\t}\n\t\tconst organizationId = ctx.body.organizationId ?? session.activeOrganizationId;\n\t\tif (!organizationId) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The session is missing an active organization id to update a role. Either set an active org id, or pass an organizationId in the request body.`);\n\t\t\tthrow new APIError$1(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION });\n\t\t}\n\t\tconst member = await ctx.context.adapter.findOne({\n\t\t\tmodel: \"member\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"organizationId\",\n\t\t\t\tvalue: organizationId,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\"\n\t\t\t}, {\n\t\t\t\tfield: \"userId\",\n\t\t\t\tvalue: user.id,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\"\n\t\t\t}]\n\t\t});\n\t\tif (!member) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The user is not a member of the organization to update a role.`, {\n\t\t\t\tuserId: user.id,\n\t\t\t\torganizationId\n\t\t\t});\n\t\t\tthrow new APIError$1(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION });\n\t\t}\n\t\tif (!await hasPermission({\n\t\t\toptions,\n\t\t\torganizationId,\n\t\t\trole: member.role,\n\t\t\tpermissions: { ac: [\"update\"] }\n\t\t}, ctx)) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The user is not permitted to update a role.`);\n\t\t\tthrow new APIError$1(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_A_ROLE });\n\t\t}\n\t\tlet condition;\n\t\tif (ctx.body.roleName) condition = {\n\t\t\tfield: \"role\",\n\t\t\tvalue: ctx.body.roleName,\n\t\t\toperator: \"eq\",\n\t\t\tconnector: \"AND\"\n\t\t};\n\t\telse if (ctx.body.roleId) condition = {\n\t\t\tfield: \"id\",\n\t\t\tvalue: ctx.body.roleId,\n\t\t\toperator: \"eq\",\n\t\t\tconnector: \"AND\"\n\t\t};\n\t\telse {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The role name/id is not provided in the request body.`);\n\t\t\tthrow new APIError$1(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ROLE_NOT_FOUND });\n\t\t}\n\t\tlet role = await ctx.context.adapter.findOne({\n\t\t\tmodel: \"organizationRole\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"organizationId\",\n\t\t\t\tvalue: organizationId,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\"\n\t\t\t}, condition]\n\t\t});\n\t\tif (!role) {\n\t\t\tctx.context.logger.error(`[Dynamic Access Control] The role name/id does not exist in the database.`, {\n\t\t\t\t...\"roleName\" in ctx.body ? { roleName: ctx.body.roleName } : { roleId: ctx.body.roleId },\n\t\t\t\torganizationId\n\t\t\t});\n\t\t\tthrow new APIError$1(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ROLE_NOT_FOUND });\n\t\t}\n\t\trole.permission = role.permission ? JSON.parse(role.permission) : void 0;\n\t\tconst { permission: _, roleName: __, ...additionalFields } = ctx.body.data;\n\t\tlet updateData = { ...additionalFields };\n\t\tif (ctx.body.data.permission) {\n\t\t\tlet newPermission = ctx.body.data.permission;\n\t\t\tawait checkForInvalidResources({\n\t\t\t\tac,\n\t\t\t\tctx,\n\t\t\t\tpermission: newPermission\n\t\t\t});\n\t\t\tawait checkIfMemberHasPermission({\n\t\t\t\tctx,\n\t\t\t\tmember,\n\t\t\t\toptions,\n\t\t\t\torganizationId,\n\t\t\t\tpermissionRequired: newPermission,\n\t\t\t\tuser,\n\t\t\t\taction: \"update\"\n\t\t\t});\n\t\t\tupdateData.permission = newPermission;\n\t\t}\n\t\tif (ctx.body.data.roleName) {\n\t\t\tlet newRoleName = ctx.body.data.roleName;\n\t\t\tnewRoleName = normalizeRoleName(newRoleName);\n\t\t\tawait checkIfRoleNameIsTakenByPreDefinedRole({\n\t\t\t\trole: newRoleName,\n\t\t\t\torganizationId,\n\t\t\t\toptions,\n\t\t\t\tctx\n\t\t\t});\n\t\t\tawait checkIfRoleNameIsTakenByRoleInDB({\n\t\t\t\trole: newRoleName,\n\t\t\t\torganizationId,\n\t\t\t\tctx\n\t\t\t});\n\t\t\tupdateData.role = newRoleName;\n\t\t}\n\t\tconst update = {\n\t\t\t...updateData,\n\t\t\t...updateData.permission ? { permission: JSON.stringify(updateData.permission) } : {}\n\t\t};\n\t\tawait ctx.context.adapter.update({\n\t\t\tmodel: \"organizationRole\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"organizationId\",\n\t\t\t\tvalue: organizationId,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\"\n\t\t\t}, condition],\n\t\t\tupdate\n\t\t});\n\t\treturn ctx.json({\n\t\t\tsuccess: true,\n\t\t\troleData: {\n\t\t\t\t...role,\n\t\t\t\t...update,\n\t\t\t\tpermission: updateData.permission || role.permission || null\n\t\t\t}\n\t\t});\n\t});\n};\nasync function checkForInvalidResources({ ac, ctx, permission }) {\n\tconst validResources = Object.keys(ac.statements);\n\tconst providedResources = Object.keys(permission);\n\tif (providedResources.some((r) => !validResources.includes(r))) {\n\t\tctx.context.logger.error(`[Dynamic Access Control] The provided permission includes an invalid resource.`, {\n\t\t\tprovidedResources,\n\t\t\tvalidResources\n\t\t});\n\t\tthrow new APIError$1(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.INVALID_RESOURCE });\n\t}\n}\nasync function checkIfMemberHasPermission({ ctx, permissionRequired: permission, options, organizationId, member, user, action }) {\n\tconst hasNecessaryPermissions = [];\n\tconst permissionEntries = Object.entries(permission);\n\tfor await (const [resource, permissions] of permissionEntries) for await (const perm of permissions) hasNecessaryPermissions.push({\n\t\tresource: { [resource]: [perm] },\n\t\thasPermission: await hasPermission({\n\t\t\toptions,\n\t\t\torganizationId,\n\t\t\tpermissions: { [resource]: [perm] },\n\t\t\tuseMemoryCache: true,\n\t\t\trole: member.role\n\t\t}, ctx)\n\t});\n\tconst missingPermissions = hasNecessaryPermissions.filter((x) => x.hasPermission === false).map((x) => {\n\t\tconst key = Object.keys(x.resource)[0];\n\t\treturn `${key}:${x.resource[key][0]}`;\n\t});\n\tif (missingPermissions.length > 0) {\n\t\tctx.context.logger.error(`[Dynamic Access Control] The user is missing permissions necessary to ${action} a role with those set of permissions.\\n`, {\n\t\t\tuserId: user.id,\n\t\t\torganizationId,\n\t\t\trole: member.role,\n\t\t\tmissingPermissions\n\t\t});\n\t\tlet errorMessage;\n\t\tif (action === \"create\") errorMessage = ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CREATE_A_ROLE;\n\t\telse if (action === \"update\") errorMessage = ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_A_ROLE;\n\t\telse if (action === \"delete\") errorMessage = ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_DELETE_A_ROLE;\n\t\telse if (action === \"read\") errorMessage = ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_READ_A_ROLE;\n\t\telse if (action === \"list\") errorMessage = ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_LIST_A_ROLE;\n\t\telse errorMessage = ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_GET_A_ROLE;\n\t\tthrow new APIError$1(\"FORBIDDEN\", {\n\t\t\tmessage: errorMessage,\n\t\t\tmissingPermissions\n\t\t});\n\t}\n}\nasync function checkIfRoleNameIsTakenByPreDefinedRole({ options, organizationId, role, ctx }) {\n\tconst defaultRoles$2 = options.roles ? Object.keys(options.roles) : [\n\t\t\"owner\",\n\t\t\"admin\",\n\t\t\"member\"\n\t];\n\tif (defaultRoles$2.includes(role)) {\n\t\tctx.context.logger.error(`[Dynamic Access Control] The role name \"${role}\" is already taken by a pre-defined role.`, {\n\t\t\trole,\n\t\t\torganizationId,\n\t\t\tdefaultRoles: defaultRoles$2\n\t\t});\n\t\tthrow new APIError$1(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ROLE_NAME_IS_ALREADY_TAKEN });\n\t}\n}\nasync function checkIfRoleNameIsTakenByRoleInDB({ organizationId, role, ctx }) {\n\tif (await ctx.context.adapter.findOne({\n\t\tmodel: \"organizationRole\",\n\t\twhere: [{\n\t\t\tfield: \"organizationId\",\n\t\t\tvalue: organizationId,\n\t\t\toperator: \"eq\",\n\t\t\tconnector: \"AND\"\n\t\t}, {\n\t\t\tfield: \"role\",\n\t\t\tvalue: role,\n\t\t\toperator: \"eq\",\n\t\t\tconnector: \"AND\"\n\t\t}]\n\t})) {\n\t\tctx.context.logger.error(`[Dynamic Access Control] The role name \"${role}\" is already taken by a role in the database.`, {\n\t\t\trole,\n\t\t\torganizationId\n\t\t});\n\t\tthrow new APIError$1(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ROLE_NAME_IS_ALREADY_TAKEN });\n\t}\n}\n\n//#endregion\n//#region src/plugins/organization/routes/crud-invites.ts\nconst createInvitation = (option) => {\n\tconst additionalFieldsSchema = toZodSchema({\n\t\tfields: option?.schema?.invitation?.additionalFields || {},\n\t\tisClientSide: true\n\t});\n\tconst baseSchema = z.object({\n\t\temail: z.string().meta({ description: \"The email address of the user to invite\" }),\n\t\trole: z.union([z.string().meta({ description: \"The role to assign to the user\" }), z.array(z.string().meta({ description: \"The roles to assign to the user\" }))]).meta({ description: \"The role(s) to assign to the user. It can be `admin`, `member`, owner. Eg: \\\"member\\\"\" }),\n\t\torganizationId: z.string().meta({ description: \"The organization ID to invite the user to\" }).optional(),\n\t\tresend: z.boolean().meta({ description: \"Resend the invitation email, if the user is already invited. Eg: true\" }).optional(),\n\t\tteamId: z.union([z.string().meta({ description: \"The team ID to invite the user to\" }).optional(), z.array(z.string()).meta({ description: \"The team IDs to invite the user to\" }).optional()])\n\t});\n\treturn createAuthEndpoint(\"/organization/invite-member\", {\n\t\tmethod: \"POST\",\n\t\trequireHeaders: true,\n\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\tbody: z.object({\n\t\t\t...baseSchema.shape,\n\t\t\t...additionalFieldsSchema.shape\n\t\t}),\n\t\tmetadata: {\n\t\t\t$Infer: { body: {} },\n\t\t\topenapi: {\n\t\t\t\toperationId: \"createOrganizationInvitation\",\n\t\t\t\tdescription: \"Create an invitation to an organization\",\n\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tid: { type: \"string\" },\n\t\t\t\t\t\t\temail: { type: \"string\" },\n\t\t\t\t\t\t\trole: { type: \"string\" },\n\t\t\t\t\t\t\torganizationId: { type: \"string\" },\n\t\t\t\t\t\t\tinviterId: { type: \"string\" },\n\t\t\t\t\t\t\tstatus: { type: \"string\" },\n\t\t\t\t\t\t\texpiresAt: { type: \"string\" },\n\t\t\t\t\t\t\tcreatedAt: { type: \"string\" }\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\"email\",\n\t\t\t\t\t\t\t\"role\",\n\t\t\t\t\t\t\t\"organizationId\",\n\t\t\t\t\t\t\t\"inviterId\",\n\t\t\t\t\t\t\t\"status\",\n\t\t\t\t\t\t\t\"expiresAt\",\n\t\t\t\t\t\t\t\"createdAt\"\n\t\t\t\t\t\t]\n\t\t\t\t\t} } }\n\t\t\t\t} }\n\t\t\t}\n\t\t}\n\t}, async (ctx) => {\n\t\tconst session = ctx.context.session;\n\t\tconst organizationId = ctx.body.organizationId || session.session.activeOrganizationId;\n\t\tif (!organizationId) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\t\tconst email = ctx.body.email.toLowerCase();\n\t\tif (!z.email().safeParse(email).success) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.INVALID_EMAIL });\n\t\tconst adapter = getOrgAdapter(ctx.context, option);\n\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\tuserId: session.user.id,\n\t\t\torganizationId\n\t\t});\n\t\tif (!member) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND });\n\t\tif (!await hasPermission({\n\t\t\trole: member.role,\n\t\t\toptions: ctx.context.orgOptions,\n\t\t\tpermissions: { invitation: [\"create\"] },\n\t\t\torganizationId\n\t\t}, ctx)) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_INVITE_USERS_TO_THIS_ORGANIZATION });\n\t\tconst creatorRole = ctx.context.orgOptions.creatorRole || \"owner\";\n\t\tconst roles = parseRoles(ctx.body.role);\n\t\tif (member.role !== creatorRole && roles.split(\",\").includes(creatorRole)) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_INVITE_USER_WITH_THIS_ROLE });\n\t\tif (await adapter.findMemberByEmail({\n\t\t\temail,\n\t\t\torganizationId\n\t\t})) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.USER_IS_ALREADY_A_MEMBER_OF_THIS_ORGANIZATION });\n\t\tconst alreadyInvited = await adapter.findPendingInvitation({\n\t\t\temail,\n\t\t\torganizationId\n\t\t});\n\t\tif (alreadyInvited.length && !ctx.body.resend) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.USER_IS_ALREADY_INVITED_TO_THIS_ORGANIZATION });\n\t\tconst organization$1 = await adapter.findOrganizationById(organizationId);\n\t\tif (!organization$1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\t\tif (alreadyInvited.length && ctx.body.resend) {\n\t\t\tconst existingInvitation = alreadyInvited[0];\n\t\t\tconst newExpiresAt = getDate(ctx.context.orgOptions.invitationExpiresIn || 3600 * 48, \"sec\");\n\t\t\tawait ctx.context.adapter.update({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: existingInvitation.id\n\t\t\t\t}],\n\t\t\t\tupdate: { expiresAt: newExpiresAt }\n\t\t\t});\n\t\t\tconst updatedInvitation = {\n\t\t\t\t...existingInvitation,\n\t\t\t\texpiresAt: newExpiresAt\n\t\t\t};\n\t\t\tawait ctx.context.orgOptions.sendInvitationEmail?.({\n\t\t\t\tid: updatedInvitation.id,\n\t\t\t\trole: updatedInvitation.role,\n\t\t\t\temail: updatedInvitation.email.toLowerCase(),\n\t\t\t\torganization: organization$1,\n\t\t\t\tinviter: {\n\t\t\t\t\t...member,\n\t\t\t\t\tuser: session.user\n\t\t\t\t},\n\t\t\t\tinvitation: updatedInvitation\n\t\t\t}, ctx.request);\n\t\t\treturn ctx.json(updatedInvitation);\n\t\t}\n\t\tif (alreadyInvited.length && ctx.context.orgOptions.cancelPendingInvitationsOnReInvite) await adapter.updateInvitation({\n\t\t\tinvitationId: alreadyInvited[0].id,\n\t\t\tstatus: \"canceled\"\n\t\t});\n\t\tconst invitationLimit = typeof ctx.context.orgOptions.invitationLimit === \"function\" ? await ctx.context.orgOptions.invitationLimit({\n\t\t\tuser: session.user,\n\t\t\torganization: organization$1,\n\t\t\tmember\n\t\t}, ctx.context) : ctx.context.orgOptions.invitationLimit ?? 100;\n\t\tif ((await adapter.findPendingInvitations({ organizationId })).length >= invitationLimit) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.INVITATION_LIMIT_REACHED });\n\t\tif (ctx.context.orgOptions.teams && ctx.context.orgOptions.teams.enabled && typeof ctx.context.orgOptions.teams.maximumMembersPerTeam !== \"undefined\" && \"teamId\" in ctx.body && ctx.body.teamId) {\n\t\t\tconst teamIds$1 = typeof ctx.body.teamId === \"string\" ? [ctx.body.teamId] : ctx.body.teamId;\n\t\t\tfor (const teamId of teamIds$1) {\n\t\t\t\tconst team = await adapter.findTeamById({\n\t\t\t\t\tteamId,\n\t\t\t\t\torganizationId,\n\t\t\t\t\tincludeTeamMembers: true\n\t\t\t\t});\n\t\t\t\tif (!team) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.TEAM_NOT_FOUND });\n\t\t\t\tconst maximumMembersPerTeam = typeof ctx.context.orgOptions.teams.maximumMembersPerTeam === \"function\" ? await ctx.context.orgOptions.teams.maximumMembersPerTeam({\n\t\t\t\t\tteamId,\n\t\t\t\t\tsession,\n\t\t\t\t\torganizationId\n\t\t\t\t}) : ctx.context.orgOptions.teams.maximumMembersPerTeam;\n\t\t\t\tif (team.members.length >= maximumMembersPerTeam) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.TEAM_MEMBER_LIMIT_REACHED });\n\t\t\t}\n\t\t}\n\t\tconst teamIds = \"teamId\" in ctx.body ? typeof ctx.body.teamId === \"string\" ? [ctx.body.teamId] : ctx.body.teamId ?? [] : [];\n\t\tconst { email: _, role: __, organizationId: ___, resend: ____, ...additionalFields } = ctx.body;\n\t\tlet invitationData = {\n\t\t\trole: roles,\n\t\t\temail,\n\t\t\torganizationId,\n\t\t\tteamIds,\n\t\t\t...additionalFields ? additionalFields : {}\n\t\t};\n\t\tif (option?.organizationHooks?.beforeCreateInvitation) {\n\t\t\tconst response = await option?.organizationHooks.beforeCreateInvitation({\n\t\t\t\tinvitation: {\n\t\t\t\t\t...invitationData,\n\t\t\t\t\tinviterId: session.user.id,\n\t\t\t\t\tteamId: teamIds.length > 0 ? teamIds[0] : void 0\n\t\t\t\t},\n\t\t\t\tinviter: session.user,\n\t\t\t\torganization: organization$1\n\t\t\t});\n\t\t\tif (response && typeof response === \"object\" && \"data\" in response) invitationData = {\n\t\t\t\t...invitationData,\n\t\t\t\t...response.data\n\t\t\t};\n\t\t}\n\t\tconst invitation = await adapter.createInvitation({\n\t\t\tinvitation: invitationData,\n\t\t\tuser: session.user\n\t\t});\n\t\tawait ctx.context.orgOptions.sendInvitationEmail?.({\n\t\t\tid: invitation.id,\n\t\t\trole: invitation.role,\n\t\t\temail: invitation.email.toLowerCase(),\n\t\t\torganization: organization$1,\n\t\t\tinviter: {\n\t\t\t\t...member,\n\t\t\t\tuser: session.user\n\t\t\t},\n\t\t\tinvitation\n\t\t}, ctx.request);\n\t\tif (option?.organizationHooks?.afterCreateInvitation) await option?.organizationHooks.afterCreateInvitation({\n\t\t\tinvitation,\n\t\t\tinviter: session.user,\n\t\t\torganization: organization$1\n\t\t});\n\t\treturn ctx.json(invitation);\n\t});\n};\nconst acceptInvitation = (options) => createAuthEndpoint(\"/organization/accept-invitation\", {\n\tmethod: \"POST\",\n\tbody: z.object({ invitationId: z.string().meta({ description: \"The ID of the invitation to accept\" }) }),\n\trequireHeaders: true,\n\tuse: [orgMiddleware, orgSessionMiddleware],\n\tmetadata: { openapi: {\n\t\tdescription: \"Accept an invitation to an organization\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: {\n\t\t\t\t\tinvitation: { type: \"object\" },\n\t\t\t\t\tmember: { type: \"object\" }\n\t\t\t\t}\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tconst session = ctx.context.session;\n\tconst adapter = getOrgAdapter(ctx.context, options);\n\tconst invitation = await adapter.findInvitationById(ctx.body.invitationId);\n\tif (!invitation || invitation.expiresAt < /* @__PURE__ */ new Date() || invitation.status !== \"pending\") throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.INVITATION_NOT_FOUND });\n\tif (invitation.email.toLowerCase() !== session.user.email.toLowerCase()) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION });\n\tif (ctx.context.orgOptions.requireEmailVerificationOnInvitation && !session.user.emailVerified) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.EMAIL_VERIFICATION_REQUIRED_BEFORE_ACCEPTING_OR_REJECTING_INVITATION });\n\tconst membershipLimit = ctx.context.orgOptions?.membershipLimit || 100;\n\tif (await adapter.countMembers({ organizationId: invitation.organizationId }) >= membershipLimit) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_MEMBERSHIP_LIMIT_REACHED });\n\tconst organization$1 = await adapter.findOrganizationById(invitation.organizationId);\n\tif (!organization$1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\tif (options?.organizationHooks?.beforeAcceptInvitation) await options?.organizationHooks.beforeAcceptInvitation({\n\t\tinvitation,\n\t\tuser: session.user,\n\t\torganization: organization$1\n\t});\n\tconst acceptedI = await adapter.updateInvitation({\n\t\tinvitationId: ctx.body.invitationId,\n\t\tstatus: \"accepted\"\n\t});\n\tif (!acceptedI) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.FAILED_TO_RETRIEVE_INVITATION });\n\tif (ctx.context.orgOptions.teams && ctx.context.orgOptions.teams.enabled && \"teamId\" in acceptedI && acceptedI.teamId) {\n\t\tconst teamIds = acceptedI.teamId.split(\",\");\n\t\tconst onlyOne = teamIds.length === 1;\n\t\tfor (const teamId of teamIds) {\n\t\t\tawait adapter.findOrCreateTeamMember({\n\t\t\t\tteamId,\n\t\t\t\tuserId: session.user.id\n\t\t\t});\n\t\t\tif (typeof ctx.context.orgOptions.teams.maximumMembersPerTeam !== \"undefined\") {\n\t\t\t\tif (await adapter.countTeamMembers({ teamId }) >= (typeof ctx.context.orgOptions.teams.maximumMembersPerTeam === \"function\" ? await ctx.context.orgOptions.teams.maximumMembersPerTeam({\n\t\t\t\t\tteamId,\n\t\t\t\t\tsession,\n\t\t\t\t\torganizationId: invitation.organizationId\n\t\t\t\t}) : ctx.context.orgOptions.teams.maximumMembersPerTeam)) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.TEAM_MEMBER_LIMIT_REACHED });\n\t\t\t}\n\t\t}\n\t\tif (onlyOne) {\n\t\t\tconst teamId = teamIds[0];\n\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\tsession: await adapter.setActiveTeam(session.session.token, teamId, ctx),\n\t\t\t\tuser: session.user\n\t\t\t});\n\t\t}\n\t}\n\tconst member = await adapter.createMember({\n\t\torganizationId: invitation.organizationId,\n\t\tuserId: session.user.id,\n\t\trole: invitation.role,\n\t\tcreatedAt: /* @__PURE__ */ new Date()\n\t});\n\tawait adapter.setActiveOrganization(session.session.token, invitation.organizationId, ctx);\n\tif (!acceptedI) return ctx.json(null, {\n\t\tstatus: 400,\n\t\tbody: { message: ORGANIZATION_ERROR_CODES.INVITATION_NOT_FOUND }\n\t});\n\tif (options?.organizationHooks?.afterAcceptInvitation) await options?.organizationHooks.afterAcceptInvitation({\n\t\tinvitation: acceptedI,\n\t\tmember,\n\t\tuser: session.user,\n\t\torganization: organization$1\n\t});\n\treturn ctx.json({\n\t\tinvitation: acceptedI,\n\t\tmember\n\t});\n});\nconst rejectInvitation = (options) => createAuthEndpoint(\"/organization/reject-invitation\", {\n\tmethod: \"POST\",\n\tbody: z.object({ invitationId: z.string().meta({ description: \"The ID of the invitation to reject\" }) }),\n\trequireHeaders: true,\n\tuse: [orgMiddleware, orgSessionMiddleware],\n\tmetadata: { openapi: {\n\t\tdescription: \"Reject an invitation to an organization\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: {\n\t\t\t\t\tinvitation: { type: \"object\" },\n\t\t\t\t\tmember: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tnullable: true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tconst session = ctx.context.session;\n\tconst adapter = getOrgAdapter(ctx.context, ctx.context.orgOptions);\n\tconst invitation = await adapter.findInvitationById(ctx.body.invitationId);\n\tif (!invitation || invitation.expiresAt < /* @__PURE__ */ new Date() || invitation.status !== \"pending\") throw new APIError(\"BAD_REQUEST\", { message: \"Invitation not found!\" });\n\tif (invitation.email.toLowerCase() !== session.user.email.toLowerCase()) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION });\n\tif (ctx.context.orgOptions.requireEmailVerificationOnInvitation && !session.user.emailVerified) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.EMAIL_VERIFICATION_REQUIRED_BEFORE_ACCEPTING_OR_REJECTING_INVITATION });\n\tconst organization$1 = await adapter.findOrganizationById(invitation.organizationId);\n\tif (!organization$1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\tif (options?.organizationHooks?.beforeRejectInvitation) await options?.organizationHooks.beforeRejectInvitation({\n\t\tinvitation,\n\t\tuser: session.user,\n\t\torganization: organization$1\n\t});\n\tconst rejectedI = await adapter.updateInvitation({\n\t\tinvitationId: ctx.body.invitationId,\n\t\tstatus: \"rejected\"\n\t});\n\tif (options?.organizationHooks?.afterRejectInvitation) await options?.organizationHooks.afterRejectInvitation({\n\t\tinvitation: rejectedI || invitation,\n\t\tuser: session.user,\n\t\torganization: organization$1\n\t});\n\treturn ctx.json({\n\t\tinvitation: rejectedI,\n\t\tmember: null\n\t});\n});\nconst cancelInvitation = (options) => createAuthEndpoint(\"/organization/cancel-invitation\", {\n\tmethod: \"POST\",\n\tbody: z.object({ invitationId: z.string().meta({ description: \"The ID of the invitation to cancel\" }) }),\n\trequireHeaders: true,\n\tuse: [orgMiddleware, orgSessionMiddleware],\n\topenapi: {\n\t\toperationId: \"cancelOrganizationInvitation\",\n\t\tdescription: \"Cancel an invitation to an organization\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { invitation: { type: \"object\" } }\n\t\t\t} } }\n\t\t} }\n\t}\n}, async (ctx) => {\n\tconst session = ctx.context.session;\n\tconst adapter = getOrgAdapter(ctx.context, options);\n\tconst invitation = await adapter.findInvitationById(ctx.body.invitationId);\n\tif (!invitation) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.INVITATION_NOT_FOUND });\n\tconst member = await adapter.findMemberByOrgId({\n\t\tuserId: session.user.id,\n\t\torganizationId: invitation.organizationId\n\t});\n\tif (!member) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND });\n\tif (!await hasPermission({\n\t\trole: member.role,\n\t\toptions: ctx.context.orgOptions,\n\t\tpermissions: { invitation: [\"cancel\"] },\n\t\torganizationId: invitation.organizationId\n\t}, ctx)) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CANCEL_THIS_INVITATION });\n\tconst organization$1 = await adapter.findOrganizationById(invitation.organizationId);\n\tif (!organization$1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\tif (options?.organizationHooks?.beforeCancelInvitation) await options?.organizationHooks.beforeCancelInvitation({\n\t\tinvitation,\n\t\tcancelledBy: session.user,\n\t\torganization: organization$1\n\t});\n\tconst canceledI = await adapter.updateInvitation({\n\t\tinvitationId: ctx.body.invitationId,\n\t\tstatus: \"canceled\"\n\t});\n\tif (options?.organizationHooks?.afterCancelInvitation) await options?.organizationHooks.afterCancelInvitation({\n\t\tinvitation: canceledI || invitation,\n\t\tcancelledBy: session.user,\n\t\torganization: organization$1\n\t});\n\treturn ctx.json(canceledI);\n});\nconst getInvitation = (options) => createAuthEndpoint(\"/organization/get-invitation\", {\n\tmethod: \"GET\",\n\tuse: [orgMiddleware],\n\trequireHeaders: true,\n\tquery: z.object({ id: z.string().meta({ description: \"The ID of the invitation to get\" }) }),\n\tmetadata: { openapi: {\n\t\tdescription: \"Get an invitation by ID\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: {\n\t\t\t\t\tid: { type: \"string\" },\n\t\t\t\t\temail: { type: \"string\" },\n\t\t\t\t\trole: { type: \"string\" },\n\t\t\t\t\torganizationId: { type: \"string\" },\n\t\t\t\t\tinviterId: { type: \"string\" },\n\t\t\t\t\tstatus: { type: \"string\" },\n\t\t\t\t\texpiresAt: { type: \"string\" },\n\t\t\t\t\torganizationName: { type: \"string\" },\n\t\t\t\t\torganizationSlug: { type: \"string\" },\n\t\t\t\t\tinviterEmail: { type: \"string\" }\n\t\t\t\t},\n\t\t\t\trequired: [\n\t\t\t\t\t\"id\",\n\t\t\t\t\t\"email\",\n\t\t\t\t\t\"role\",\n\t\t\t\t\t\"organizationId\",\n\t\t\t\t\t\"inviterId\",\n\t\t\t\t\t\"status\",\n\t\t\t\t\t\"expiresAt\",\n\t\t\t\t\t\"organizationName\",\n\t\t\t\t\t\"organizationSlug\",\n\t\t\t\t\t\"inviterEmail\"\n\t\t\t\t]\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session) throw new APIError(\"UNAUTHORIZED\", { message: \"Not authenticated\" });\n\tconst adapter = getOrgAdapter(ctx.context, options);\n\tconst invitation = await adapter.findInvitationById(ctx.query.id);\n\tif (!invitation || invitation.status !== \"pending\" || invitation.expiresAt < /* @__PURE__ */ new Date()) throw new APIError(\"BAD_REQUEST\", { message: \"Invitation not found!\" });\n\tif (invitation.email.toLowerCase() !== session.user.email.toLowerCase()) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION });\n\tconst organization$1 = await adapter.findOrganizationById(invitation.organizationId);\n\tif (!organization$1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\tconst member = await adapter.findMemberByOrgId({\n\t\tuserId: invitation.inviterId,\n\t\torganizationId: invitation.organizationId\n\t});\n\tif (!member) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.INVITER_IS_NO_LONGER_A_MEMBER_OF_THE_ORGANIZATION });\n\treturn ctx.json({\n\t\t...invitation,\n\t\torganizationName: organization$1.name,\n\t\torganizationSlug: organization$1.slug,\n\t\tinviterEmail: member.user.email\n\t});\n});\nconst listInvitations = (options) => createAuthEndpoint(\"/organization/list-invitations\", {\n\tmethod: \"GET\",\n\trequireHeaders: true,\n\tuse: [orgMiddleware, orgSessionMiddleware],\n\tquery: z.object({ organizationId: z.string().meta({ description: \"The ID of the organization to list invitations for\" }).optional() }).optional()\n}, async (ctx) => {\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session) throw new APIError(\"UNAUTHORIZED\", { message: \"Not authenticated\" });\n\tconst orgId = ctx.query?.organizationId || session.session.activeOrganizationId;\n\tif (!orgId) throw new APIError(\"BAD_REQUEST\", { message: \"Organization ID is required\" });\n\tconst adapter = getOrgAdapter(ctx.context, options);\n\tif (!await adapter.findMemberByOrgId({\n\t\tuserId: session.user.id,\n\t\torganizationId: orgId\n\t})) throw new APIError(\"FORBIDDEN\", { message: \"You are not a member of this organization\" });\n\tconst invitations = await adapter.listInvitations({ organizationId: orgId });\n\treturn ctx.json(invitations);\n});\n/**\n* List all invitations a user has received\n*/\nconst listUserInvitations = (options) => createAuthEndpoint(\"/organization/list-user-invitations\", {\n\tmethod: \"GET\",\n\tuse: [orgMiddleware],\n\tquery: z.object({ email: z.string().meta({ description: \"The email of the user to list invitations for. This only works for server side API calls.\" }).optional() }).optional()\n}, async (ctx) => {\n\tconst session = await getSessionFromCtx(ctx);\n\tif (ctx.request && ctx.query?.email) throw new APIError(\"BAD_REQUEST\", { message: \"User email cannot be passed for client side API calls.\" });\n\tconst userEmail = session?.user.email || ctx.query?.email;\n\tif (!userEmail) throw new APIError(\"BAD_REQUEST\", { message: \"Missing session headers, or email query parameter.\" });\n\tconst invitations = await getOrgAdapter(ctx.context, options).listUserInvitations(userEmail);\n\treturn ctx.json(invitations);\n});\n\n//#endregion\n//#region src/plugins/organization/routes/crud-members.ts\nconst addMember = (option) => {\n\tconst additionalFieldsSchema = toZodSchema({\n\t\tfields: option?.schema?.member?.additionalFields || {},\n\t\tisClientSide: true\n\t});\n\tconst baseSchema = z.object({\n\t\tuserId: z.coerce.string().meta({ description: \"The user Id which represents the user to be added as a member. If `null` is provided, then it's expected to provide session headers. Eg: \\\"user-id\\\"\" }),\n\t\trole: z.union([z.string(), z.array(z.string())]).meta({ description: \"The role(s) to assign to the new member. Eg: [\\\"admin\\\", \\\"sale\\\"]\" }),\n\t\torganizationId: z.string().meta({ description: \"An optional organization ID to pass. If not provided, will default to the user's active organization. Eg: \\\"org-id\\\"\" }).optional(),\n\t\tteamId: z.string().meta({ description: \"An optional team ID to add the member to. Eg: \\\"team-id\\\"\" }).optional()\n\t});\n\treturn createAuthEndpoint(\"/organization/add-member\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({\n\t\t\t...baseSchema.shape,\n\t\t\t...additionalFieldsSchema.shape\n\t\t}),\n\t\tuse: [orgMiddleware],\n\t\tmetadata: {\n\t\t\tSERVER_ONLY: true,\n\t\t\t$Infer: { body: {} },\n\t\t\topenapi: {\n\t\t\t\toperationId: \"addOrganizationMember\",\n\t\t\t\tdescription: \"Add a member to an organization\"\n\t\t\t}\n\t\t}\n\t}, async (ctx) => {\n\t\tconst session = ctx.body.userId ? await getSessionFromCtx(ctx).catch((e) => null) : null;\n\t\tconst orgId = ctx.body.organizationId || session?.session.activeOrganizationId;\n\t\tif (!orgId) return ctx.json(null, {\n\t\t\tstatus: 400,\n\t\t\tbody: { message: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION }\n\t\t});\n\t\tconst teamId = \"teamId\" in ctx.body ? ctx.body.teamId : void 0;\n\t\tif (teamId && !ctx.context.orgOptions.teams?.enabled) {\n\t\t\tctx.context.logger.error(\"Teams are not enabled\");\n\t\t\tthrow new APIError(\"BAD_REQUEST\", { message: \"Teams are not enabled\" });\n\t\t}\n\t\tconst adapter = getOrgAdapter(ctx.context, option);\n\t\tconst user = await ctx.context.internalAdapter.findUserById(ctx.body.userId);\n\t\tif (!user) throw new APIError(\"BAD_REQUEST\", { message: BASE_ERROR_CODES.USER_NOT_FOUND });\n\t\tif (await adapter.findMemberByEmail({\n\t\t\temail: user.email,\n\t\t\torganizationId: orgId\n\t\t})) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.USER_IS_ALREADY_A_MEMBER_OF_THIS_ORGANIZATION });\n\t\tif (teamId) {\n\t\t\tconst team = await adapter.findTeamById({\n\t\t\t\tteamId,\n\t\t\t\torganizationId: orgId\n\t\t\t});\n\t\t\tif (!team || team.organizationId !== orgId) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.TEAM_NOT_FOUND });\n\t\t}\n\t\tconst membershipLimit = ctx.context.orgOptions?.membershipLimit || 100;\n\t\tif (await adapter.countMembers({ organizationId: orgId }) >= membershipLimit) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_MEMBERSHIP_LIMIT_REACHED });\n\t\tconst { role: _, userId: __, organizationId: ___, ...additionalFields } = ctx.body;\n\t\tconst organization$1 = await adapter.findOrganizationById(orgId);\n\t\tif (!organization$1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\t\tlet memberData = {\n\t\t\torganizationId: orgId,\n\t\t\tuserId: user.id,\n\t\t\trole: parseRoles(ctx.body.role),\n\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t...additionalFields ? additionalFields : {}\n\t\t};\n\t\tif (option?.organizationHooks?.beforeAddMember) {\n\t\t\tconst response = await option?.organizationHooks.beforeAddMember({\n\t\t\t\tmember: {\n\t\t\t\t\tuserId: user.id,\n\t\t\t\t\torganizationId: orgId,\n\t\t\t\t\trole: parseRoles(ctx.body.role),\n\t\t\t\t\t...additionalFields\n\t\t\t\t},\n\t\t\t\tuser,\n\t\t\t\torganization: organization$1\n\t\t\t});\n\t\t\tif (response && typeof response === \"object\" && \"data\" in response) memberData = {\n\t\t\t\t...memberData,\n\t\t\t\t...response.data\n\t\t\t};\n\t\t}\n\t\tconst createdMember = await adapter.createMember(memberData);\n\t\tif (teamId) await adapter.findOrCreateTeamMember({\n\t\t\tuserId: user.id,\n\t\t\tteamId\n\t\t});\n\t\tif (option?.organizationHooks?.afterAddMember) await option?.organizationHooks.afterAddMember({\n\t\t\tmember: createdMember,\n\t\t\tuser,\n\t\t\torganization: organization$1\n\t\t});\n\t\treturn ctx.json(createdMember);\n\t});\n};\nconst removeMember = (options) => createAuthEndpoint(\"/organization/remove-member\", {\n\tmethod: \"POST\",\n\tbody: z.object({\n\t\tmemberIdOrEmail: z.string().meta({ description: \"The ID or email of the member to remove\" }),\n\t\torganizationId: z.string().meta({ description: \"The ID of the organization to remove the member from. If not provided, the active organization will be used. Eg: \\\"org-id\\\"\" }).optional()\n\t}),\n\trequireHeaders: true,\n\tuse: [orgMiddleware, orgSessionMiddleware],\n\tmetadata: { openapi: {\n\t\tdescription: \"Remove a member from an organization\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { member: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tid: { type: \"string\" },\n\t\t\t\t\t\tuserId: { type: \"string\" },\n\t\t\t\t\t\torganizationId: { type: \"string\" },\n\t\t\t\t\t\trole: { type: \"string\" }\n\t\t\t\t\t},\n\t\t\t\t\trequired: [\n\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\"userId\",\n\t\t\t\t\t\t\"organizationId\",\n\t\t\t\t\t\t\"role\"\n\t\t\t\t\t]\n\t\t\t\t} },\n\t\t\t\trequired: [\"member\"]\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tconst session = ctx.context.session;\n\tconst organizationId = ctx.body.organizationId || session.session.activeOrganizationId;\n\tif (!organizationId) return ctx.json(null, {\n\t\tstatus: 400,\n\t\tbody: { message: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION }\n\t});\n\tconst adapter = getOrgAdapter(ctx.context, options);\n\tconst member = await adapter.findMemberByOrgId({\n\t\tuserId: session.user.id,\n\t\torganizationId\n\t});\n\tif (!member) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND });\n\tlet toBeRemovedMember = null;\n\tif (ctx.body.memberIdOrEmail.includes(\"@\")) toBeRemovedMember = await adapter.findMemberByEmail({\n\t\temail: ctx.body.memberIdOrEmail,\n\t\torganizationId\n\t});\n\telse {\n\t\tconst result = await adapter.findMemberById(ctx.body.memberIdOrEmail);\n\t\tif (!result) toBeRemovedMember = null;\n\t\telse {\n\t\t\tconst { user: _user, ...member$1 } = result;\n\t\t\ttoBeRemovedMember = member$1;\n\t\t}\n\t}\n\tif (!toBeRemovedMember) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND });\n\tconst roles = toBeRemovedMember.role.split(\",\");\n\tconst creatorRole = ctx.context.orgOptions?.creatorRole || \"owner\";\n\tif (roles.includes(creatorRole)) {\n\t\tif (member.role !== creatorRole) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.YOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER });\n\t\tconst { members } = await adapter.listMembers({ organizationId });\n\t\tif (members.filter((member$1) => {\n\t\t\treturn member$1.role.split(\",\").includes(creatorRole);\n\t\t}).length <= 1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.YOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER });\n\t}\n\tif (!await hasPermission({\n\t\trole: member.role,\n\t\toptions: ctx.context.orgOptions,\n\t\tpermissions: { member: [\"delete\"] },\n\t\torganizationId\n\t}, ctx)) throw new APIError(\"UNAUTHORIZED\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_MEMBER });\n\tif (toBeRemovedMember?.organizationId !== organizationId) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND });\n\tconst organization$1 = await adapter.findOrganizationById(organizationId);\n\tif (!organization$1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\tconst userBeingRemoved = await ctx.context.internalAdapter.findUserById(toBeRemovedMember.userId);\n\tif (!userBeingRemoved) throw new APIError(\"BAD_REQUEST\", { message: \"User not found\" });\n\tif (options?.organizationHooks?.beforeRemoveMember) await options?.organizationHooks.beforeRemoveMember({\n\t\tmember: toBeRemovedMember,\n\t\tuser: userBeingRemoved,\n\t\torganization: organization$1\n\t});\n\tawait adapter.deleteMember({\n\t\tmemberId: toBeRemovedMember.id,\n\t\torganizationId,\n\t\tuserId: toBeRemovedMember.userId\n\t});\n\tif (session.user.id === toBeRemovedMember.userId && session.session.activeOrganizationId === toBeRemovedMember.organizationId) await adapter.setActiveOrganization(session.session.token, null, ctx);\n\tif (options?.organizationHooks?.afterRemoveMember) await options?.organizationHooks.afterRemoveMember({\n\t\tmember: toBeRemovedMember,\n\t\tuser: userBeingRemoved,\n\t\torganization: organization$1\n\t});\n\treturn ctx.json({ member: toBeRemovedMember });\n});\nconst updateMemberRole = (option) => createAuthEndpoint(\"/organization/update-member-role\", {\n\tmethod: \"POST\",\n\tbody: z.object({\n\t\trole: z.union([z.string(), z.array(z.string())]).meta({ description: \"The new role to be applied. This can be a string or array of strings representing the roles. Eg: [\\\"admin\\\", \\\"sale\\\"]\" }),\n\t\tmemberId: z.string().meta({ description: \"The member id to apply the role update to. Eg: \\\"member-id\\\"\" }),\n\t\torganizationId: z.string().meta({ description: \"An optional organization ID which the member is a part of to apply the role update. If not provided, you must provide session headers to get the active organization. Eg: \\\"organization-id\\\"\" }).optional()\n\t}),\n\tuse: [orgMiddleware, orgSessionMiddleware],\n\trequireHeaders: true,\n\tmetadata: {\n\t\t$Infer: { body: {} },\n\t\topenapi: {\n\t\t\toperationId: \"updateOrganizationMemberRole\",\n\t\t\tdescription: \"Update the role of a member in an organization\",\n\t\t\tresponses: { \"200\": {\n\t\t\t\tdescription: \"Success\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: { member: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tid: { type: \"string\" },\n\t\t\t\t\t\t\tuserId: { type: \"string\" },\n\t\t\t\t\t\t\torganizationId: { type: \"string\" },\n\t\t\t\t\t\t\trole: { type: \"string\" }\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\"userId\",\n\t\t\t\t\t\t\t\"organizationId\",\n\t\t\t\t\t\t\t\"role\"\n\t\t\t\t\t\t]\n\t\t\t\t\t} },\n\t\t\t\t\trequired: [\"member\"]\n\t\t\t\t} } }\n\t\t\t} }\n\t\t}\n\t}\n}, async (ctx) => {\n\tconst session = ctx.context.session;\n\tif (!ctx.body.role) throw new APIError(\"BAD_REQUEST\");\n\tconst organizationId = ctx.body.organizationId || session.session.activeOrganizationId;\n\tif (!organizationId) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION });\n\tconst adapter = getOrgAdapter(ctx.context, ctx.context.orgOptions);\n\tconst roleToSet = Array.isArray(ctx.body.role) ? ctx.body.role : ctx.body.role ? [ctx.body.role] : [];\n\tconst member = await adapter.findMemberByOrgId({\n\t\tuserId: session.user.id,\n\t\torganizationId\n\t});\n\tif (!member) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND });\n\tconst toBeUpdatedMember = member.id !== ctx.body.memberId ? await adapter.findMemberById(ctx.body.memberId) : member;\n\tif (!toBeUpdatedMember) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND });\n\tif (!(toBeUpdatedMember.organizationId === organizationId)) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_MEMBER });\n\tconst creatorRole = ctx.context.orgOptions?.creatorRole || \"owner\";\n\tconst updatingMemberRoles = member.role.split(\",\");\n\tconst isUpdatingCreator = toBeUpdatedMember.role.split(\",\").includes(creatorRole);\n\tconst updaterIsCreator = updatingMemberRoles.includes(creatorRole);\n\tconst isSettingCreatorRole = roleToSet.includes(creatorRole);\n\tconst memberIsUpdatingThemselves = member.id === toBeUpdatedMember.id;\n\tif (isUpdatingCreator && !updaterIsCreator || isSettingCreatorRole && !updaterIsCreator) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_MEMBER });\n\tif (updaterIsCreator && memberIsUpdatingThemselves) {\n\t\tif ((await ctx.context.adapter.findMany({\n\t\t\tmodel: \"member\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"organizationId\",\n\t\t\t\tvalue: organizationId\n\t\t\t}]\n\t\t})).filter((member$1) => {\n\t\t\treturn member$1.role.split(\",\").includes(creatorRole);\n\t\t}).length <= 1 && !isSettingCreatorRole) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.YOU_CANNOT_LEAVE_THE_ORGANIZATION_WITHOUT_AN_OWNER });\n\t}\n\tif (!await hasPermission({\n\t\trole: member.role,\n\t\toptions: ctx.context.orgOptions,\n\t\tpermissions: { member: [\"update\"] },\n\t\tallowCreatorAllPermissions: true,\n\t\torganizationId\n\t}, ctx)) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_MEMBER });\n\tconst organization$1 = await adapter.findOrganizationById(organizationId);\n\tif (!organization$1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\tconst userBeingUpdated = await ctx.context.internalAdapter.findUserById(toBeUpdatedMember.userId);\n\tif (!userBeingUpdated) throw new APIError(\"BAD_REQUEST\", { message: \"User not found\" });\n\tconst previousRole = toBeUpdatedMember.role;\n\tconst newRole = parseRoles(ctx.body.role);\n\tif (option?.organizationHooks?.beforeUpdateMemberRole) {\n\t\tconst response = await option?.organizationHooks.beforeUpdateMemberRole({\n\t\t\tmember: toBeUpdatedMember,\n\t\t\tnewRole,\n\t\t\tuser: userBeingUpdated,\n\t\t\torganization: organization$1\n\t\t});\n\t\tif (response && typeof response === \"object\" && \"data\" in response) {\n\t\t\tconst updatedMember$1 = await adapter.updateMember(ctx.body.memberId, response.data.role || newRole);\n\t\t\tif (!updatedMember$1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND });\n\t\t\tif (option?.organizationHooks?.afterUpdateMemberRole) await option?.organizationHooks.afterUpdateMemberRole({\n\t\t\t\tmember: updatedMember$1,\n\t\t\t\tpreviousRole,\n\t\t\t\tuser: userBeingUpdated,\n\t\t\t\torganization: organization$1\n\t\t\t});\n\t\t\treturn ctx.json(updatedMember$1);\n\t\t}\n\t}\n\tconst updatedMember = await adapter.updateMember(ctx.body.memberId, newRole);\n\tif (!updatedMember) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND });\n\tif (option?.organizationHooks?.afterUpdateMemberRole) await option?.organizationHooks.afterUpdateMemberRole({\n\t\tmember: updatedMember,\n\t\tpreviousRole,\n\t\tuser: userBeingUpdated,\n\t\torganization: organization$1\n\t});\n\treturn ctx.json(updatedMember);\n});\nconst getActiveMember = (options) => createAuthEndpoint(\"/organization/get-active-member\", {\n\tmethod: \"GET\",\n\tuse: [orgMiddleware, orgSessionMiddleware],\n\trequireHeaders: true,\n\tmetadata: { openapi: {\n\t\tdescription: \"Get the member details of the active organization\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: {\n\t\t\t\t\tid: { type: \"string\" },\n\t\t\t\t\tuserId: { type: \"string\" },\n\t\t\t\t\torganizationId: { type: \"string\" },\n\t\t\t\t\trole: { type: \"string\" }\n\t\t\t\t},\n\t\t\t\trequired: [\n\t\t\t\t\t\"id\",\n\t\t\t\t\t\"userId\",\n\t\t\t\t\t\"organizationId\",\n\t\t\t\t\t\"role\"\n\t\t\t\t]\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tconst session = ctx.context.session;\n\tconst organizationId = session.session.activeOrganizationId;\n\tif (!organizationId) return ctx.json(null, {\n\t\tstatus: 400,\n\t\tbody: { message: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION }\n\t});\n\tconst member = await getOrgAdapter(ctx.context, options).findMemberByOrgId({\n\t\tuserId: session.user.id,\n\t\torganizationId\n\t});\n\tif (!member) return ctx.json(null, {\n\t\tstatus: 400,\n\t\tbody: { message: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND }\n\t});\n\treturn ctx.json(member);\n});\nconst leaveOrganization = (options) => createAuthEndpoint(\"/organization/leave\", {\n\tmethod: \"POST\",\n\tbody: z.object({ organizationId: z.string().meta({ description: \"The organization Id for the member to leave. Eg: \\\"organization-id\\\"\" }) }),\n\trequireHeaders: true,\n\tuse: [sessionMiddleware, orgMiddleware]\n}, async (ctx) => {\n\tconst session = ctx.context.session;\n\tconst adapter = getOrgAdapter(ctx.context, options);\n\tconst member = await adapter.findMemberByOrgId({\n\t\tuserId: session.user.id,\n\t\torganizationId: ctx.body.organizationId\n\t});\n\tif (!member) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND });\n\tconst creatorRole = ctx.context.orgOptions?.creatorRole || \"owner\";\n\tif (member.role.split(\",\").includes(creatorRole)) {\n\t\tif ((await ctx.context.adapter.findMany({\n\t\t\tmodel: \"member\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"organizationId\",\n\t\t\t\tvalue: ctx.body.organizationId\n\t\t\t}]\n\t\t})).filter((member$1) => member$1.role.split(\",\").includes(creatorRole)).length <= 1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.YOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER });\n\t}\n\tawait adapter.deleteMember({\n\t\tmemberId: member.id,\n\t\torganizationId: ctx.body.organizationId,\n\t\tuserId: session.user.id\n\t});\n\tif (session.session.activeOrganizationId === ctx.body.organizationId) await adapter.setActiveOrganization(session.session.token, null, ctx);\n\treturn ctx.json(member);\n});\nconst listMembers = (options) => createAuthEndpoint(\"/organization/list-members\", {\n\tmethod: \"GET\",\n\tquery: z.object({\n\t\tlimit: z.string().meta({ description: \"The number of users to return\" }).or(z.number()).optional(),\n\t\toffset: z.string().meta({ description: \"The offset to start from\" }).or(z.number()).optional(),\n\t\tsortBy: z.string().meta({ description: \"The field to sort by\" }).optional(),\n\t\tsortDirection: z.enum([\"asc\", \"desc\"]).meta({ description: \"The direction to sort by\" }).optional(),\n\t\tfilterField: z.string().meta({ description: \"The field to filter by\" }).optional(),\n\t\tfilterValue: z.string().meta({ description: \"The value to filter by\" }).or(z.number()).or(z.boolean()).optional(),\n\t\tfilterOperator: z.enum([\n\t\t\t\"eq\",\n\t\t\t\"ne\",\n\t\t\t\"lt\",\n\t\t\t\"lte\",\n\t\t\t\"gt\",\n\t\t\t\"gte\",\n\t\t\t\"contains\"\n\t\t]).meta({ description: \"The operator to use for the filter\" }).optional(),\n\t\torganizationId: z.string().meta({ description: \"The organization ID to list members for. If not provided, will default to the user's active organization. Eg: \\\"organization-id\\\"\" }).optional(),\n\t\torganizationSlug: z.string().meta({ description: \"The organization slug to list members for. If not provided, will default to the user's active organization. Eg: \\\"organization-slug\\\"\" }).optional()\n\t}).optional(),\n\trequireHeaders: true,\n\tuse: [orgMiddleware, orgSessionMiddleware]\n}, async (ctx) => {\n\tconst session = ctx.context.session;\n\tlet organizationId = ctx.query?.organizationId || session.session.activeOrganizationId;\n\tconst adapter = getOrgAdapter(ctx.context, options);\n\tif (ctx.query?.organizationSlug) {\n\t\tconst organization$1 = await adapter.findOrganizationBySlug(ctx.query?.organizationSlug);\n\t\tif (!organization$1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\t\torganizationId = organization$1.id;\n\t}\n\tif (!organizationId) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION });\n\tif (!await adapter.findMemberByOrgId({\n\t\tuserId: session.user.id,\n\t\torganizationId\n\t})) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION });\n\tconst { members, total } = await adapter.listMembers({\n\t\torganizationId,\n\t\tlimit: ctx.query?.limit ? Number(ctx.query.limit) : void 0,\n\t\toffset: ctx.query?.offset ? Number(ctx.query.offset) : void 0,\n\t\tsortBy: ctx.query?.sortBy,\n\t\tsortOrder: ctx.query?.sortDirection,\n\t\tfilter: ctx.query?.filterField ? {\n\t\t\tfield: ctx.query?.filterField,\n\t\t\toperator: ctx.query.filterOperator,\n\t\t\tvalue: ctx.query.filterValue\n\t\t} : void 0\n\t});\n\treturn ctx.json({\n\t\tmembers,\n\t\ttotal\n\t});\n});\nconst getActiveMemberRole = (options) => createAuthEndpoint(\"/organization/get-active-member-role\", {\n\tmethod: \"GET\",\n\tquery: z.object({\n\t\tuserId: z.string().meta({ description: \"The user ID to get the role for. If not provided, will default to the current user's\" }).optional(),\n\t\torganizationId: z.string().meta({ description: \"The organization ID to list members for. If not provided, will default to the user's active organization. Eg: \\\"organization-id\\\"\" }).optional(),\n\t\torganizationSlug: z.string().meta({ description: \"The organization slug to list members for. If not provided, will default to the user's active organization. Eg: \\\"organization-slug\\\"\" }).optional()\n\t}).optional(),\n\trequireHeaders: true,\n\tuse: [orgMiddleware, orgSessionMiddleware]\n}, async (ctx) => {\n\tconst session = ctx.context.session;\n\tlet organizationId = ctx.query?.organizationId || session.session.activeOrganizationId;\n\tconst adapter = getOrgAdapter(ctx.context, options);\n\tif (ctx.query?.organizationSlug) {\n\t\tconst organization$1 = await adapter.findOrganizationBySlug(ctx.query?.organizationSlug);\n\t\tif (!organization$1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\t\torganizationId = organization$1.id;\n\t}\n\tif (!organizationId) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION });\n\tconst isMember = await adapter.findMemberByOrgId({\n\t\tuserId: session.user.id,\n\t\torganizationId\n\t});\n\tif (!isMember) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION });\n\tif (!ctx.query?.userId) return ctx.json({ role: isMember.role });\n\tconst userIdToGetRole = ctx.query?.userId;\n\tconst member = await adapter.findMemberByOrgId({\n\t\tuserId: userIdToGetRole,\n\t\torganizationId\n\t});\n\tif (!member) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION });\n\treturn ctx.json({ role: member?.role });\n});\n\n//#endregion\n//#region src/plugins/organization/routes/crud-org.ts\nconst createOrganization = (options) => {\n\tconst additionalFieldsSchema = toZodSchema({\n\t\tfields: options?.schema?.organization?.additionalFields || {},\n\t\tisClientSide: true\n\t});\n\tconst baseSchema = z.object({\n\t\tname: z.string().min(1).meta({ description: \"The name of the organization\" }),\n\t\tslug: z.string().min(1).meta({ description: \"The slug of the organization\" }),\n\t\tuserId: z.coerce.string().meta({ description: \"The user id of the organization creator. If not provided, the current user will be used. Should only be used by admins or when called by the server. server-only. Eg: \\\"user-id\\\"\" }).optional(),\n\t\tlogo: z.string().meta({ description: \"The logo of the organization\" }).optional(),\n\t\tmetadata: z.record(z.string(), z.any()).meta({ description: \"The metadata of the organization\" }).optional(),\n\t\tkeepCurrentActiveOrganization: z.boolean().meta({ description: \"Whether to keep the current active organization active after creating a new one. Eg: true\" }).optional()\n\t});\n\treturn createAuthEndpoint(\"/organization/create\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({\n\t\t\t...baseSchema.shape,\n\t\t\t...additionalFieldsSchema.shape\n\t\t}),\n\t\tuse: [orgMiddleware],\n\t\tmetadata: {\n\t\t\t$Infer: { body: {} },\n\t\t\topenapi: {\n\t\t\t\tdescription: \"Create an organization\",\n\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tdescription: \"The organization that was created\",\n\t\t\t\t\t\t$ref: \"#/components/schemas/Organization\"\n\t\t\t\t\t} } }\n\t\t\t\t} }\n\t\t\t}\n\t\t}\n\t}, async (ctx) => {\n\t\tconst session = await getSessionFromCtx(ctx);\n\t\tif (!session && (ctx.request || ctx.headers)) throw new APIError(\"UNAUTHORIZED\");\n\t\tlet user = session?.user || null;\n\t\tif (!user) {\n\t\t\tif (!ctx.body.userId) throw new APIError(\"UNAUTHORIZED\");\n\t\t\tuser = await ctx.context.internalAdapter.findUserById(ctx.body.userId);\n\t\t}\n\t\tif (!user) return ctx.json(null, { status: 401 });\n\t\tconst options$1 = ctx.context.orgOptions;\n\t\tif (!(typeof options$1?.allowUserToCreateOrganization === \"function\" ? await options$1.allowUserToCreateOrganization(user) : options$1?.allowUserToCreateOrganization === void 0 ? true : options$1.allowUserToCreateOrganization)) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_ORGANIZATION });\n\t\tconst adapter = getOrgAdapter(ctx.context, options$1);\n\t\tconst userOrganizations = await adapter.listOrganizations(user.id);\n\t\tif (typeof options$1.organizationLimit === \"number\" ? userOrganizations.length >= options$1.organizationLimit : typeof options$1.organizationLimit === \"function\" ? await options$1.organizationLimit(user) : false) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_ORGANIZATIONS });\n\t\tif (await adapter.findOrganizationBySlug(ctx.body.slug)) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_ALREADY_EXISTS });\n\t\tlet { keepCurrentActiveOrganization: _, userId: __, ...orgData } = ctx.body;\n\t\tif (options$1.organizationCreation?.beforeCreate) {\n\t\t\tconst response = await options$1.organizationCreation.beforeCreate({\n\t\t\t\torganization: {\n\t\t\t\t\t...orgData,\n\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t},\n\t\t\t\tuser\n\t\t\t}, ctx.request);\n\t\t\tif (response && typeof response === \"object\" && \"data\" in response) orgData = {\n\t\t\t\t...ctx.body,\n\t\t\t\t...response.data\n\t\t\t};\n\t\t}\n\t\tif (options$1?.organizationHooks?.beforeCreateOrganization) {\n\t\t\tconst response = await options$1?.organizationHooks.beforeCreateOrganization({\n\t\t\t\torganization: orgData,\n\t\t\t\tuser\n\t\t\t});\n\t\t\tif (response && typeof response === \"object\" && \"data\" in response) orgData = {\n\t\t\t\t...ctx.body,\n\t\t\t\t...response.data\n\t\t\t};\n\t\t}\n\t\tconst organization$1 = await adapter.createOrganization({ organization: {\n\t\t\t...orgData,\n\t\t\tcreatedAt: /* @__PURE__ */ new Date()\n\t\t} });\n\t\tlet member;\n\t\tlet teamMember = null;\n\t\tlet data = {\n\t\t\tuserId: user.id,\n\t\t\torganizationId: organization$1.id,\n\t\t\trole: ctx.context.orgOptions.creatorRole || \"owner\"\n\t\t};\n\t\tif (options$1?.organizationHooks?.beforeAddMember) {\n\t\t\tconst response = await options$1?.organizationHooks.beforeAddMember({\n\t\t\t\tmember: {\n\t\t\t\t\tuserId: user.id,\n\t\t\t\t\torganizationId: organization$1.id,\n\t\t\t\t\trole: ctx.context.orgOptions.creatorRole || \"owner\"\n\t\t\t\t},\n\t\t\t\tuser,\n\t\t\t\torganization: organization$1\n\t\t\t});\n\t\t\tif (response && typeof response === \"object\" && \"data\" in response) data = {\n\t\t\t\t...data,\n\t\t\t\t...response.data\n\t\t\t};\n\t\t}\n\t\tmember = await adapter.createMember(data);\n\t\tif (options$1?.organizationHooks?.afterAddMember) await options$1?.organizationHooks.afterAddMember({\n\t\t\tmember,\n\t\t\tuser,\n\t\t\torganization: organization$1\n\t\t});\n\t\tif (options$1?.teams?.enabled && options$1.teams.defaultTeam?.enabled !== false) {\n\t\t\tlet teamData = {\n\t\t\t\torganizationId: organization$1.id,\n\t\t\t\tname: `${organization$1.name}`,\n\t\t\t\tcreatedAt: /* @__PURE__ */ new Date()\n\t\t\t};\n\t\t\tif (options$1?.organizationHooks?.beforeCreateTeam) {\n\t\t\t\tconst response = await options$1?.organizationHooks.beforeCreateTeam({\n\t\t\t\t\tteam: {\n\t\t\t\t\t\torganizationId: organization$1.id,\n\t\t\t\t\t\tname: `${organization$1.name}`\n\t\t\t\t\t},\n\t\t\t\t\tuser,\n\t\t\t\t\torganization: organization$1\n\t\t\t\t});\n\t\t\t\tif (response && typeof response === \"object\" && \"data\" in response) teamData = {\n\t\t\t\t\t...teamData,\n\t\t\t\t\t...response.data\n\t\t\t\t};\n\t\t\t}\n\t\t\tconst defaultTeam = await options$1.teams.defaultTeam?.customCreateDefaultTeam?.(organization$1, ctx) || await adapter.createTeam(teamData);\n\t\t\tteamMember = await adapter.findOrCreateTeamMember({\n\t\t\t\tteamId: defaultTeam.id,\n\t\t\t\tuserId: user.id\n\t\t\t});\n\t\t\tif (options$1?.organizationHooks?.afterCreateTeam) await options$1?.organizationHooks.afterCreateTeam({\n\t\t\t\tteam: defaultTeam,\n\t\t\t\tuser,\n\t\t\t\torganization: organization$1\n\t\t\t});\n\t\t}\n\t\tif (options$1.organizationCreation?.afterCreate) await options$1.organizationCreation.afterCreate({\n\t\t\torganization: organization$1,\n\t\t\tuser,\n\t\t\tmember\n\t\t}, ctx.request);\n\t\tif (options$1?.organizationHooks?.afterCreateOrganization) await options$1?.organizationHooks.afterCreateOrganization({\n\t\t\torganization: organization$1,\n\t\t\tuser,\n\t\t\tmember\n\t\t});\n\t\tif (ctx.context.session && !ctx.body.keepCurrentActiveOrganization) await adapter.setActiveOrganization(ctx.context.session.session.token, organization$1.id, ctx);\n\t\tif (teamMember && ctx.context.session && !ctx.body.keepCurrentActiveOrganization) await adapter.setActiveTeam(ctx.context.session.session.token, teamMember.teamId, ctx);\n\t\treturn ctx.json({\n\t\t\t...organization$1,\n\t\t\tmetadata: organization$1.metadata && typeof organization$1.metadata === \"string\" ? JSON.parse(organization$1.metadata) : organization$1.metadata,\n\t\t\tmembers: [member]\n\t\t});\n\t});\n};\nconst checkOrganizationSlug = (options) => createAuthEndpoint(\"/organization/check-slug\", {\n\tmethod: \"POST\",\n\tbody: z.object({ slug: z.string().meta({ description: \"The organization slug to check. Eg: \\\"my-org\\\"\" }) }),\n\tuse: [requestOnlySessionMiddleware, orgMiddleware]\n}, async (ctx) => {\n\tif (!await getOrgAdapter(ctx.context, options).findOrganizationBySlug(ctx.body.slug)) return ctx.json({ status: true });\n\tthrow new APIError(\"BAD_REQUEST\", { message: \"slug is taken\" });\n});\nconst updateOrganization = (options) => {\n\tconst additionalFieldsSchema = toZodSchema({\n\t\tfields: options?.schema?.organization?.additionalFields || {},\n\t\tisClientSide: true\n\t});\n\treturn createAuthEndpoint(\"/organization/update\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({\n\t\t\tdata: z.object({\n\t\t\t\t...additionalFieldsSchema.shape,\n\t\t\t\tname: z.string().min(1).meta({ description: \"The name of the organization\" }).optional(),\n\t\t\t\tslug: z.string().min(1).meta({ description: \"The slug of the organization\" }).optional(),\n\t\t\t\tlogo: z.string().meta({ description: \"The logo of the organization\" }).optional(),\n\t\t\t\tmetadata: z.record(z.string(), z.any()).meta({ description: \"The metadata of the organization\" }).optional()\n\t\t\t}).partial(),\n\t\t\torganizationId: z.string().meta({ description: \"The organization ID. Eg: \\\"org-id\\\"\" }).optional()\n\t\t}),\n\t\trequireHeaders: true,\n\t\tuse: [orgMiddleware],\n\t\tmetadata: {\n\t\t\t$Infer: { body: {} },\n\t\t\topenapi: {\n\t\t\t\tdescription: \"Update an organization\",\n\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tdescription: \"The updated organization\",\n\t\t\t\t\t\t$ref: \"#/components/schemas/Organization\"\n\t\t\t\t\t} } }\n\t\t\t\t} }\n\t\t\t}\n\t\t}\n\t}, async (ctx) => {\n\t\tconst session = await ctx.context.getSession(ctx);\n\t\tif (!session) throw new APIError(\"UNAUTHORIZED\", { message: \"User not found\" });\n\t\tconst organizationId = ctx.body.organizationId || session.session.activeOrganizationId;\n\t\tif (!organizationId) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\t\tconst adapter = getOrgAdapter(ctx.context, options);\n\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\tuserId: session.user.id,\n\t\t\torganizationId\n\t\t});\n\t\tif (!member) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION });\n\t\tif (!await hasPermission({\n\t\t\tpermissions: { organization: [\"update\"] },\n\t\t\trole: member.role,\n\t\t\toptions: ctx.context.orgOptions,\n\t\t\torganizationId\n\t\t}, ctx)) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_ORGANIZATION });\n\t\tif (typeof ctx.body.data.slug === \"string\") {\n\t\t\tconst existingOrganization = await adapter.findOrganizationBySlug(ctx.body.data.slug);\n\t\t\tif (existingOrganization && existingOrganization.id !== organizationId) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_SLUG_ALREADY_TAKEN });\n\t\t}\n\t\tif (options?.organizationHooks?.beforeUpdateOrganization) {\n\t\t\tconst response = await options.organizationHooks.beforeUpdateOrganization({\n\t\t\t\torganization: ctx.body.data,\n\t\t\t\tuser: session.user,\n\t\t\t\tmember\n\t\t\t});\n\t\t\tif (response && typeof response === \"object\" && \"data\" in response) ctx.body.data = {\n\t\t\t\t...ctx.body.data,\n\t\t\t\t...response.data\n\t\t\t};\n\t\t}\n\t\tconst updatedOrg = await adapter.updateOrganization(organizationId, ctx.body.data);\n\t\tif (options?.organizationHooks?.afterUpdateOrganization) await options.organizationHooks.afterUpdateOrganization({\n\t\t\torganization: updatedOrg,\n\t\t\tuser: session.user,\n\t\t\tmember\n\t\t});\n\t\treturn ctx.json(updatedOrg);\n\t});\n};\nconst deleteOrganization = (options) => {\n\treturn createAuthEndpoint(\"/organization/delete\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({ organizationId: z.string().meta({ description: \"The organization id to delete\" }) }),\n\t\trequireHeaders: true,\n\t\tuse: [orgMiddleware],\n\t\tmetadata: { openapi: {\n\t\t\tdescription: \"Delete an organization\",\n\t\t\tresponses: { \"200\": {\n\t\t\t\tdescription: \"Success\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\tdescription: \"The organization id that was deleted\"\n\t\t\t\t} } }\n\t\t\t} }\n\t\t} }\n\t}, async (ctx) => {\n\t\tif (ctx.context.orgOptions.organizationDeletion?.disabled || ctx.context.orgOptions.disableOrganizationDeletion) {\n\t\t\tif (ctx.context.orgOptions.organizationDeletion?.disabled) ctx.context.logger.info(\"`organizationDeletion.disabled` is deprecated. Use `disableOrganizationDeletion` instead\");\n\t\t\tthrow new APIError(\"NOT_FOUND\", { message: \"Organization deletion is disabled\" });\n\t\t}\n\t\tconst session = await ctx.context.getSession(ctx);\n\t\tif (!session) throw new APIError(\"UNAUTHORIZED\", { status: 401 });\n\t\tconst organizationId = ctx.body.organizationId;\n\t\tif (!organizationId) return ctx.json(null, {\n\t\t\tstatus: 400,\n\t\t\tbody: { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND }\n\t\t});\n\t\tconst adapter = getOrgAdapter(ctx.context, options);\n\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\tuserId: session.user.id,\n\t\t\torganizationId\n\t\t});\n\t\tif (!member) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION });\n\t\tif (!await hasPermission({\n\t\t\trole: member.role,\n\t\t\tpermissions: { organization: [\"delete\"] },\n\t\t\torganizationId,\n\t\t\toptions: ctx.context.orgOptions\n\t\t}, ctx)) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_ORGANIZATION });\n\t\tif (organizationId === session.session.activeOrganizationId)\n /**\n\t\t* If the organization is deleted, we set the active organization to null\n\t\t*/\n\t\tawait adapter.setActiveOrganization(session.session.token, null, ctx);\n\t\tconst org = await adapter.findOrganizationById(organizationId);\n\t\tif (!org) throw new APIError(\"BAD_REQUEST\");\n\t\tif (options?.organizationHooks?.beforeDeleteOrganization) await options.organizationHooks.beforeDeleteOrganization({\n\t\t\torganization: org,\n\t\t\tuser: session.user\n\t\t});\n\t\tawait adapter.deleteOrganization(organizationId);\n\t\tif (options?.organizationHooks?.afterDeleteOrganization) await options.organizationHooks.afterDeleteOrganization({\n\t\t\torganization: org,\n\t\t\tuser: session.user\n\t\t});\n\t\treturn ctx.json(org);\n\t});\n};\nconst getFullOrganization = (options) => createAuthEndpoint(\"/organization/get-full-organization\", {\n\tmethod: \"GET\",\n\tquery: z.optional(z.object({\n\t\torganizationId: z.string().meta({ description: \"The organization id to get\" }).optional(),\n\t\torganizationSlug: z.string().meta({ description: \"The organization slug to get\" }).optional(),\n\t\tmembersLimit: z.number().or(z.string().transform((val) => parseInt(val))).meta({ description: \"The limit of members to get. By default, it uses the membershipLimit option which defaults to 100.\" }).optional()\n\t})),\n\trequireHeaders: true,\n\tuse: [orgMiddleware, orgSessionMiddleware],\n\tmetadata: { openapi: {\n\t\toperationId: \"getOrganization\",\n\t\tdescription: \"Get the full organization\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tdescription: \"The organization\",\n\t\t\t\t$ref: \"#/components/schemas/Organization\"\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tconst session = ctx.context.session;\n\tconst organizationId = ctx.query?.organizationSlug || ctx.query?.organizationId || session.session.activeOrganizationId;\n\tif (!organizationId) return ctx.json(null, { status: 200 });\n\tconst adapter = getOrgAdapter(ctx.context, options);\n\tconst organization$1 = await adapter.findFullOrganization({\n\t\torganizationId,\n\t\tisSlug: !!ctx.query?.organizationSlug,\n\t\tincludeTeams: ctx.context.orgOptions.teams?.enabled,\n\t\tmembersLimit: ctx.query?.membersLimit\n\t});\n\tif (!organization$1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\tif (!await adapter.checkMembership({\n\t\tuserId: session.user.id,\n\t\torganizationId: organization$1.id\n\t})) {\n\t\tawait adapter.setActiveOrganization(session.session.token, null, ctx);\n\t\tthrow new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION });\n\t}\n\treturn ctx.json(organization$1);\n});\nconst setActiveOrganization = (options) => {\n\treturn createAuthEndpoint(\"/organization/set-active\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({\n\t\t\torganizationId: z.string().meta({ description: \"The organization id to set as active. It can be null to unset the active organization. Eg: \\\"org-id\\\"\" }).nullable().optional(),\n\t\t\torganizationSlug: z.string().meta({ description: \"The organization slug to set as active. It can be null to unset the active organization if organizationId is not provided. Eg: \\\"org-slug\\\"\" }).optional()\n\t\t}),\n\t\tuse: [orgSessionMiddleware, orgMiddleware],\n\t\trequireHeaders: true,\n\t\tmetadata: { openapi: {\n\t\t\toperationId: \"setActiveOrganization\",\n\t\t\tdescription: \"Set the active organization\",\n\t\t\tresponses: { \"200\": {\n\t\t\t\tdescription: \"Success\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tdescription: \"The organization\",\n\t\t\t\t\t$ref: \"#/components/schemas/Organization\"\n\t\t\t\t} } }\n\t\t\t} }\n\t\t} }\n\t}, async (ctx) => {\n\t\tconst adapter = getOrgAdapter(ctx.context, options);\n\t\tconst session = ctx.context.session;\n\t\tlet organizationId = ctx.body.organizationId;\n\t\tlet organizationSlug = ctx.body.organizationSlug;\n\t\tif (organizationId === null) {\n\t\t\tif (!session.session.activeOrganizationId) return ctx.json(null);\n\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\tsession: await adapter.setActiveOrganization(session.session.token, null, ctx),\n\t\t\t\tuser: session.user\n\t\t\t});\n\t\t\treturn ctx.json(null);\n\t\t}\n\t\tif (!organizationId && !organizationSlug) {\n\t\t\tconst sessionOrgId = session.session.activeOrganizationId;\n\t\t\tif (!sessionOrgId) return ctx.json(null);\n\t\t\torganizationId = sessionOrgId;\n\t\t}\n\t\tif (organizationSlug && !organizationId) {\n\t\t\tconst organization$2 = await adapter.findOrganizationBySlug(organizationSlug);\n\t\t\tif (!organization$2) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\t\t\torganizationId = organization$2.id;\n\t\t}\n\t\tif (!organizationId) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\t\tif (!await adapter.checkMembership({\n\t\t\tuserId: session.user.id,\n\t\t\torganizationId\n\t\t})) {\n\t\t\tawait adapter.setActiveOrganization(session.session.token, null, ctx);\n\t\t\tthrow new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION });\n\t\t}\n\t\tlet organization$1 = await adapter.findOrganizationById(organizationId);\n\t\tif (!organization$1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\t\tawait setSessionCookie(ctx, {\n\t\t\tsession: await adapter.setActiveOrganization(session.session.token, organization$1.id, ctx),\n\t\t\tuser: session.user\n\t\t});\n\t\treturn ctx.json(organization$1);\n\t});\n};\nconst listOrganizations = (options) => createAuthEndpoint(\"/organization/list\", {\n\tmethod: \"GET\",\n\tuse: [orgMiddleware, orgSessionMiddleware],\n\trequireHeaders: true,\n\tmetadata: { openapi: {\n\t\tdescription: \"List all organizations\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"array\",\n\t\t\t\titems: { $ref: \"#/components/schemas/Organization\" }\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tconst organizations = await getOrgAdapter(ctx.context, options).listOrganizations(ctx.context.session.user.id);\n\treturn ctx.json(organizations);\n});\n\n//#endregion\n//#region src/plugins/organization/schema.ts\nconst roleSchema = z.string();\nconst invitationStatus = z.enum([\n\t\"pending\",\n\t\"accepted\",\n\t\"rejected\",\n\t\"canceled\"\n]).default(\"pending\");\nconst organizationSchema = z.object({\n\tid: z.string().default(generateId),\n\tname: z.string(),\n\tslug: z.string(),\n\tlogo: z.string().nullish().optional(),\n\tmetadata: z.record(z.string(), z.unknown()).or(z.string().transform((v) => JSON.parse(v))).optional(),\n\tcreatedAt: z.date()\n});\nconst memberSchema = z.object({\n\tid: z.string().default(generateId),\n\torganizationId: z.string(),\n\tuserId: z.coerce.string(),\n\trole: roleSchema,\n\tcreatedAt: z.date().default(() => /* @__PURE__ */ new Date())\n});\nconst invitationSchema = z.object({\n\tid: z.string().default(generateId),\n\torganizationId: z.string(),\n\temail: z.string(),\n\trole: roleSchema,\n\tstatus: invitationStatus,\n\tteamId: z.string().nullish(),\n\tinviterId: z.string(),\n\texpiresAt: z.date(),\n\tcreatedAt: z.date().default(() => /* @__PURE__ */ new Date())\n});\nconst teamSchema = z.object({\n\tid: z.string().default(generateId),\n\tname: z.string().min(1),\n\torganizationId: z.string(),\n\tcreatedAt: z.date(),\n\tupdatedAt: z.date().optional()\n});\nconst teamMemberSchema = z.object({\n\tid: z.string().default(generateId),\n\tteamId: z.string(),\n\tuserId: z.string(),\n\tcreatedAt: z.date().default(() => /* @__PURE__ */ new Date())\n});\nconst organizationRoleSchema = z.object({\n\tid: z.string().default(generateId),\n\torganizationId: z.string(),\n\trole: z.string(),\n\tpermission: z.record(z.string(), z.array(z.string())),\n\tcreatedAt: z.date().default(() => /* @__PURE__ */ new Date()),\n\tupdatedAt: z.date().optional()\n});\nconst defaultRoles$1 = [\n\t\"admin\",\n\t\"member\",\n\t\"owner\"\n];\nconst defaultRolesSchema = z.union([z.enum(defaultRoles$1), z.array(z.enum(defaultRoles$1))]);\n\n//#endregion\n//#region src/plugins/organization/routes/crud-team.ts\nconst createTeam = (options) => {\n\tconst additionalFieldsSchema = toZodSchema({\n\t\tfields: options?.schema?.team?.additionalFields ?? {},\n\t\tisClientSide: true\n\t});\n\tconst baseSchema = z.object({\n\t\tname: z.string().meta({ description: \"The name of the team. Eg: \\\"my-team\\\"\" }),\n\t\torganizationId: z.string().meta({ description: \"The organization ID which the team will be created in. Defaults to the active organization. Eg: \\\"organization-id\\\"\" }).optional()\n\t});\n\treturn createAuthEndpoint(\"/organization/create-team\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({\n\t\t\t...baseSchema.shape,\n\t\t\t...additionalFieldsSchema.shape\n\t\t}),\n\t\tuse: [orgMiddleware],\n\t\tmetadata: {\n\t\t\t$Infer: { body: {} },\n\t\t\topenapi: {\n\t\t\t\tdescription: \"Create a new team within an organization\",\n\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\tdescription: \"Team created successfully\",\n\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tdescription: \"Unique identifier of the created team\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tdescription: \"Name of the team\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\torganizationId: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tdescription: \"ID of the organization the team belongs to\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\tdescription: \"Timestamp when the team was created\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\tdescription: \"Timestamp when the team was last updated\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\"name\",\n\t\t\t\t\t\t\t\"organizationId\",\n\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t\t]\n\t\t\t\t\t} } }\n\t\t\t\t} }\n\t\t\t}\n\t\t}\n\t}, async (ctx) => {\n\t\tconst session = await getSessionFromCtx(ctx);\n\t\tconst organizationId = ctx.body.organizationId || session?.session.activeOrganizationId;\n\t\tif (!session && (ctx.request || ctx.headers)) throw new APIError(\"UNAUTHORIZED\");\n\t\tif (!organizationId) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION });\n\t\tconst adapter = getOrgAdapter(ctx.context, options);\n\t\tif (session) {\n\t\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId\n\t\t\t});\n\t\t\tif (!member) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_INVITE_USERS_TO_THIS_ORGANIZATION });\n\t\t\tif (!await hasPermission({\n\t\t\t\trole: member.role,\n\t\t\t\toptions: ctx.context.orgOptions,\n\t\t\t\tpermissions: { team: [\"create\"] },\n\t\t\t\torganizationId\n\t\t\t}, ctx)) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CREATE_TEAMS_IN_THIS_ORGANIZATION });\n\t\t}\n\t\tconst existingTeams = await adapter.listTeams(organizationId);\n\t\tconst maximum = typeof ctx.context.orgOptions.teams?.maximumTeams === \"function\" ? await ctx.context.orgOptions.teams?.maximumTeams({\n\t\t\torganizationId,\n\t\t\tsession\n\t\t}, ctx) : ctx.context.orgOptions.teams?.maximumTeams;\n\t\tif (maximum ? existingTeams.length >= maximum : false) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.YOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_TEAMS });\n\t\tconst { name, organizationId: _, ...additionalFields } = ctx.body;\n\t\tconst organization$1 = await adapter.findOrganizationById(organizationId);\n\t\tif (!organization$1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\t\tlet teamData = {\n\t\t\tname,\n\t\t\torganizationId,\n\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\tupdatedAt: /* @__PURE__ */ new Date(),\n\t\t\t...additionalFields\n\t\t};\n\t\tif (options?.organizationHooks?.beforeCreateTeam) {\n\t\t\tconst response = await options?.organizationHooks.beforeCreateTeam({\n\t\t\t\tteam: {\n\t\t\t\t\tname,\n\t\t\t\t\torganizationId,\n\t\t\t\t\t...additionalFields\n\t\t\t\t},\n\t\t\t\tuser: session?.user,\n\t\t\t\torganization: organization$1\n\t\t\t});\n\t\t\tif (response && typeof response === \"object\" && \"data\" in response) teamData = {\n\t\t\t\t...teamData,\n\t\t\t\t...response.data\n\t\t\t};\n\t\t}\n\t\tconst createdTeam = await adapter.createTeam(teamData);\n\t\tif (options?.organizationHooks?.afterCreateTeam) await options?.organizationHooks.afterCreateTeam({\n\t\t\tteam: createdTeam,\n\t\t\tuser: session?.user,\n\t\t\torganization: organization$1\n\t\t});\n\t\treturn ctx.json(createdTeam);\n\t});\n};\nconst removeTeam = (options) => createAuthEndpoint(\"/organization/remove-team\", {\n\tmethod: \"POST\",\n\tbody: z.object({\n\t\tteamId: z.string().meta({ description: `The team ID of the team to remove. Eg: \"team-id\"` }),\n\t\torganizationId: z.string().meta({ description: `The organization ID which the team falls under. If not provided, it will default to the user's active organization. Eg: \"organization-id\"` }).optional()\n\t}),\n\tuse: [orgMiddleware],\n\tmetadata: { openapi: {\n\t\tdescription: \"Remove a team from an organization\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Team removed successfully\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { message: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\tdescription: \"Confirmation message indicating successful removal\",\n\t\t\t\t\tenum: [\"Team removed successfully.\"]\n\t\t\t\t} },\n\t\t\t\trequired: [\"message\"]\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tconst session = await getSessionFromCtx(ctx);\n\tconst organizationId = ctx.body.organizationId || session?.session.activeOrganizationId;\n\tif (!organizationId) return ctx.json(null, {\n\t\tstatus: 400,\n\t\tbody: { message: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION }\n\t});\n\tif (!session && (ctx.request || ctx.headers)) throw new APIError(\"UNAUTHORIZED\");\n\tconst adapter = getOrgAdapter(ctx.context, options);\n\tif (session) {\n\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\tuserId: session.user.id,\n\t\t\torganizationId\n\t\t});\n\t\tif (!member || session.session?.activeTeamId === ctx.body.teamId) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_TEAM });\n\t\tif (!await hasPermission({\n\t\t\trole: member.role,\n\t\t\toptions: ctx.context.orgOptions,\n\t\t\tpermissions: { team: [\"delete\"] },\n\t\t\torganizationId\n\t\t}, ctx)) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_DELETE_TEAMS_IN_THIS_ORGANIZATION });\n\t}\n\tconst team = await adapter.findTeamById({\n\t\tteamId: ctx.body.teamId,\n\t\torganizationId\n\t});\n\tif (!team || team.organizationId !== organizationId) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.TEAM_NOT_FOUND });\n\tif (!ctx.context.orgOptions.teams?.allowRemovingAllTeams) {\n\t\tif ((await adapter.listTeams(organizationId)).length <= 1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.UNABLE_TO_REMOVE_LAST_TEAM });\n\t}\n\tconst organization$1 = await adapter.findOrganizationById(organizationId);\n\tif (!organization$1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\tif (options?.organizationHooks?.beforeDeleteTeam) await options?.organizationHooks.beforeDeleteTeam({\n\t\tteam,\n\t\tuser: session?.user,\n\t\torganization: organization$1\n\t});\n\tawait adapter.deleteTeam(team.id);\n\tif (options?.organizationHooks?.afterDeleteTeam) await options?.organizationHooks.afterDeleteTeam({\n\t\tteam,\n\t\tuser: session?.user,\n\t\torganization: organization$1\n\t});\n\treturn ctx.json({ message: \"Team removed successfully.\" });\n});\nconst updateTeam = (options) => {\n\tconst additionalFieldsSchema = toZodSchema({\n\t\tfields: options?.schema?.team?.additionalFields ?? {},\n\t\tisClientSide: true\n\t});\n\treturn createAuthEndpoint(\"/organization/update-team\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({\n\t\t\tteamId: z.string().meta({ description: `The ID of the team to be updated. Eg: \"team-id\"` }),\n\t\t\tdata: z.object({\n\t\t\t\t...teamSchema.shape,\n\t\t\t\t...additionalFieldsSchema.shape\n\t\t\t}).partial()\n\t\t}),\n\t\trequireHeaders: true,\n\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\tmetadata: {\n\t\t\t$Infer: { body: {} },\n\t\t\topenapi: {\n\t\t\t\tdescription: \"Update an existing team in an organization\",\n\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\tdescription: \"Team updated successfully\",\n\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tdescription: \"Unique identifier of the updated team\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tdescription: \"Updated name of the team\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\torganizationId: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tdescription: \"ID of the organization the team belongs to\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\tdescription: \"Timestamp when the team was created\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\tdescription: \"Timestamp when the team was last updated\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\"name\",\n\t\t\t\t\t\t\t\"organizationId\",\n\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t\t]\n\t\t\t\t\t} } }\n\t\t\t\t} }\n\t\t\t}\n\t\t}\n\t}, async (ctx) => {\n\t\tconst session = ctx.context.session;\n\t\tconst organizationId = ctx.body.data.organizationId || session.session.activeOrganizationId;\n\t\tif (!organizationId) return ctx.json(null, {\n\t\t\tstatus: 400,\n\t\t\tbody: { message: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION }\n\t\t});\n\t\tconst adapter = getOrgAdapter(ctx.context, options);\n\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\tuserId: session.user.id,\n\t\t\torganizationId\n\t\t});\n\t\tif (!member) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_TEAM });\n\t\tif (!await hasPermission({\n\t\t\trole: member.role,\n\t\t\toptions: ctx.context.orgOptions,\n\t\t\tpermissions: { team: [\"update\"] },\n\t\t\torganizationId\n\t\t}, ctx)) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_TEAM });\n\t\tconst team = await adapter.findTeamById({\n\t\t\tteamId: ctx.body.teamId,\n\t\t\torganizationId\n\t\t});\n\t\tif (!team || team.organizationId !== organizationId) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.TEAM_NOT_FOUND });\n\t\tconst { name, organizationId: __, ...additionalFields } = ctx.body.data;\n\t\tconst organization$1 = await adapter.findOrganizationById(organizationId);\n\t\tif (!organization$1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\t\tconst updates = {\n\t\t\tname,\n\t\t\t...additionalFields\n\t\t};\n\t\tif (options?.organizationHooks?.beforeUpdateTeam) {\n\t\t\tconst response = await options?.organizationHooks.beforeUpdateTeam({\n\t\t\t\tteam,\n\t\t\t\tupdates,\n\t\t\t\tuser: session.user,\n\t\t\t\torganization: organization$1\n\t\t\t});\n\t\t\tif (response && typeof response === \"object\" && \"data\" in response) {\n\t\t\t\tconst modifiedUpdates = response.data;\n\t\t\t\tconst updatedTeam$1 = await adapter.updateTeam(team.id, modifiedUpdates);\n\t\t\t\tif (options?.organizationHooks?.afterUpdateTeam) await options?.organizationHooks.afterUpdateTeam({\n\t\t\t\t\tteam: updatedTeam$1,\n\t\t\t\t\tuser: session.user,\n\t\t\t\t\torganization: organization$1\n\t\t\t\t});\n\t\t\t\treturn ctx.json(updatedTeam$1);\n\t\t\t}\n\t\t}\n\t\tconst updatedTeam = await adapter.updateTeam(team.id, updates);\n\t\tif (options?.organizationHooks?.afterUpdateTeam) await options?.organizationHooks.afterUpdateTeam({\n\t\t\tteam: updatedTeam,\n\t\t\tuser: session.user,\n\t\t\torganization: organization$1\n\t\t});\n\t\treturn ctx.json(updatedTeam);\n\t});\n};\nconst listOrganizationTeams = (options) => createAuthEndpoint(\"/organization/list-teams\", {\n\tmethod: \"GET\",\n\tquery: z.optional(z.object({ organizationId: z.string().meta({ description: `The organization ID which the teams are under to list. Defaults to the users active organization. Eg: \"organization-id\"` }).optional() })),\n\tmetadata: { openapi: {\n\t\tdescription: \"List all teams in an organization\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Teams retrieved successfully\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"array\",\n\t\t\t\titems: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"Unique identifier of the team\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"Name of the team\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\torganizationId: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"ID of the organization the team belongs to\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tdescription: \"Timestamp when the team was created\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tdescription: \"Timestamp when the team was last updated\"\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\trequired: [\n\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\"name\",\n\t\t\t\t\t\t\"organizationId\",\n\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tdescription: \"Array of team objects within the organization\"\n\t\t\t} } }\n\t\t} }\n\t} },\n\trequireHeaders: true,\n\tuse: [orgMiddleware, orgSessionMiddleware]\n}, async (ctx) => {\n\tconst session = ctx.context.session;\n\tconst organizationId = ctx.query?.organizationId || session?.session.activeOrganizationId;\n\tif (!organizationId) throw ctx.error(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION });\n\tconst adapter = getOrgAdapter(ctx.context, options);\n\tif (!await adapter.findMemberByOrgId({\n\t\tuserId: session.user.id,\n\t\torganizationId: organizationId || \"\"\n\t})) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_ACCESS_THIS_ORGANIZATION });\n\tconst teams = await adapter.listTeams(organizationId);\n\treturn ctx.json(teams);\n});\nconst setActiveTeam = (options) => createAuthEndpoint(\"/organization/set-active-team\", {\n\tmethod: \"POST\",\n\tbody: z.object({ teamId: z.string().meta({ description: \"The team id to set as active. It can be null to unset the active team\" }).nullable().optional() }),\n\trequireHeaders: true,\n\tuse: [orgSessionMiddleware, orgMiddleware],\n\tmetadata: { openapi: {\n\t\tdescription: \"Set the active team\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Success\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tdescription: \"The team\",\n\t\t\t\t$ref: \"#/components/schemas/Team\"\n\t\t\t} } }\n\t\t} }\n\t} }\n}, async (ctx) => {\n\tconst adapter = getOrgAdapter(ctx.context, ctx.context.orgOptions);\n\tconst session = ctx.context.session;\n\tif (ctx.body.teamId === null) {\n\t\tif (!session.session.activeTeamId) return ctx.json(null);\n\t\tawait setSessionCookie(ctx, {\n\t\t\tsession: await adapter.setActiveTeam(session.session.token, null, ctx),\n\t\t\tuser: session.user\n\t\t});\n\t\treturn ctx.json(null);\n\t}\n\tlet teamId;\n\tif (!ctx.body.teamId) {\n\t\tconst sessionTeamId = session.session.activeTeamId;\n\t\tif (!sessionTeamId) return ctx.json(null);\n\t\telse teamId = sessionTeamId;\n\t} else teamId = ctx.body.teamId;\n\tconst team = await adapter.findTeamById({ teamId });\n\tif (!team) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.TEAM_NOT_FOUND });\n\tif (!await adapter.findTeamMember({\n\t\tteamId,\n\t\tuserId: session.user.id\n\t})) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_TEAM });\n\tawait setSessionCookie(ctx, {\n\t\tsession: await adapter.setActiveTeam(session.session.token, team.id, ctx),\n\t\tuser: session.user\n\t});\n\treturn ctx.json(team);\n});\nconst listUserTeams = (options) => createAuthEndpoint(\"/organization/list-user-teams\", {\n\tmethod: \"GET\",\n\tmetadata: { openapi: {\n\t\tdescription: \"List all teams that the current user is a part of.\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Teams retrieved successfully\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"array\",\n\t\t\t\titems: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tdescription: \"The team\",\n\t\t\t\t\t$ref: \"#/components/schemas/Team\"\n\t\t\t\t},\n\t\t\t\tdescription: \"Array of team objects within the organization\"\n\t\t\t} } }\n\t\t} }\n\t} },\n\trequireHeaders: true,\n\tuse: [orgMiddleware, orgSessionMiddleware]\n}, async (ctx) => {\n\tconst session = ctx.context.session;\n\tconst teams = await getOrgAdapter(ctx.context, ctx.context.orgOptions).listTeamsByUser({ userId: session.user.id });\n\treturn ctx.json(teams);\n});\nconst listTeamMembers = (options) => createAuthEndpoint(\"/organization/list-team-members\", {\n\tmethod: \"GET\",\n\tquery: z.optional(z.object({ teamId: z.string().optional().meta({ description: \"The team whose members we should return. If this is not provided the members of the current active team get returned.\" }) })),\n\tmetadata: { openapi: {\n\t\tdescription: \"List the members of the given team.\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Teams retrieved successfully\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"array\",\n\t\t\t\titems: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tdescription: \"The team member\",\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"Unique identifier of the team member\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"The user ID of the team member\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tteamId: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"The team ID of the team the team member is in\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tdescription: \"Timestamp when the team member was created\"\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\trequired: [\n\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\"userId\",\n\t\t\t\t\t\t\"teamId\",\n\t\t\t\t\t\t\"createdAt\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tdescription: \"Array of team member objects within the team\"\n\t\t\t} } }\n\t\t} }\n\t} },\n\trequireHeaders: true,\n\tuse: [orgMiddleware, orgSessionMiddleware]\n}, async (ctx) => {\n\tconst session = ctx.context.session;\n\tconst adapter = getOrgAdapter(ctx.context, ctx.context.orgOptions);\n\tlet teamId = ctx.query?.teamId || session?.session.activeTeamId;\n\tif (!teamId) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.YOU_DO_NOT_HAVE_AN_ACTIVE_TEAM });\n\tif (!await adapter.findTeamMember({\n\t\tuserId: session.user.id,\n\t\tteamId\n\t})) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_TEAM });\n\tconst members = await adapter.listTeamMembers({ teamId });\n\treturn ctx.json(members);\n});\nconst addTeamMember = (options) => createAuthEndpoint(\"/organization/add-team-member\", {\n\tmethod: \"POST\",\n\tbody: z.object({\n\t\tteamId: z.string().meta({ description: \"The team the user should be a member of.\" }),\n\t\tuserId: z.coerce.string().meta({ description: \"The user Id which represents the user to be added as a member.\" })\n\t}),\n\tmetadata: { openapi: {\n\t\tdescription: \"The newly created member\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Team member created successfully\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tdescription: \"The team member\",\n\t\t\t\tproperties: {\n\t\t\t\t\tid: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tdescription: \"Unique identifier of the team member\"\n\t\t\t\t\t},\n\t\t\t\t\tuserId: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tdescription: \"The user ID of the team member\"\n\t\t\t\t\t},\n\t\t\t\t\tteamId: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tdescription: \"The team ID of the team the team member is in\"\n\t\t\t\t\t},\n\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\tdescription: \"Timestamp when the team member was created\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\trequired: [\n\t\t\t\t\t\"id\",\n\t\t\t\t\t\"userId\",\n\t\t\t\t\t\"teamId\",\n\t\t\t\t\t\"createdAt\"\n\t\t\t\t]\n\t\t\t} } }\n\t\t} }\n\t} },\n\trequireHeaders: true,\n\tuse: [orgMiddleware, orgSessionMiddleware]\n}, async (ctx) => {\n\tconst session = ctx.context.session;\n\tconst adapter = getOrgAdapter(ctx.context, ctx.context.orgOptions);\n\tif (!session.session.activeOrganizationId) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION });\n\tconst currentMember = await adapter.findMemberByOrgId({\n\t\tuserId: session.user.id,\n\t\torganizationId: session.session.activeOrganizationId\n\t});\n\tif (!currentMember) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION });\n\tif (!await hasPermission({\n\t\trole: currentMember.role,\n\t\toptions: ctx.context.orgOptions,\n\t\tpermissions: { member: [\"update\"] },\n\t\torganizationId: session.session.activeOrganizationId\n\t}, ctx)) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_TEAM_MEMBER });\n\tif (!await adapter.findMemberByOrgId({\n\t\tuserId: ctx.body.userId,\n\t\torganizationId: session.session.activeOrganizationId\n\t})) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION });\n\tconst team = await adapter.findTeamById({\n\t\tteamId: ctx.body.teamId,\n\t\torganizationId: session.session.activeOrganizationId\n\t});\n\tif (!team) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.TEAM_NOT_FOUND });\n\tconst organization$1 = await adapter.findOrganizationById(session.session.activeOrganizationId);\n\tif (!organization$1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\tconst userBeingAdded = await ctx.context.internalAdapter.findUserById(ctx.body.userId);\n\tif (!userBeingAdded) throw new APIError(\"BAD_REQUEST\", { message: \"User not found\" });\n\tif (options?.organizationHooks?.beforeAddTeamMember) {\n\t\tconst response = await options?.organizationHooks.beforeAddTeamMember({\n\t\t\tteamMember: {\n\t\t\t\tteamId: ctx.body.teamId,\n\t\t\t\tuserId: ctx.body.userId\n\t\t\t},\n\t\t\tteam,\n\t\t\tuser: userBeingAdded,\n\t\t\torganization: organization$1\n\t\t});\n\t\tif (response && typeof response === \"object\" && \"data\" in response) {}\n\t}\n\tconst teamMember = await adapter.findOrCreateTeamMember({\n\t\tteamId: ctx.body.teamId,\n\t\tuserId: ctx.body.userId\n\t});\n\tif (options?.organizationHooks?.afterAddTeamMember) await options?.organizationHooks.afterAddTeamMember({\n\t\tteamMember,\n\t\tteam,\n\t\tuser: userBeingAdded,\n\t\torganization: organization$1\n\t});\n\treturn ctx.json(teamMember);\n});\nconst removeTeamMember = (options) => createAuthEndpoint(\"/organization/remove-team-member\", {\n\tmethod: \"POST\",\n\tbody: z.object({\n\t\tteamId: z.string().meta({ description: \"The team the user should be removed from.\" }),\n\t\tuserId: z.coerce.string().meta({ description: \"The user which should be removed from the team.\" })\n\t}),\n\tmetadata: { openapi: {\n\t\tdescription: \"Remove a member from a team\",\n\t\tresponses: { \"200\": {\n\t\t\tdescription: \"Team member removed successfully\",\n\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { message: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\tdescription: \"Confirmation message indicating successful removal\",\n\t\t\t\t\tenum: [\"Team member removed successfully.\"]\n\t\t\t\t} },\n\t\t\t\trequired: [\"message\"]\n\t\t\t} } }\n\t\t} }\n\t} },\n\trequireHeaders: true,\n\tuse: [orgMiddleware, orgSessionMiddleware]\n}, async (ctx) => {\n\tconst session = ctx.context.session;\n\tconst adapter = getOrgAdapter(ctx.context, ctx.context.orgOptions);\n\tif (!session.session.activeOrganizationId) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION });\n\tconst currentMember = await adapter.findMemberByOrgId({\n\t\tuserId: session.user.id,\n\t\torganizationId: session.session.activeOrganizationId\n\t});\n\tif (!currentMember) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION });\n\tif (!await hasPermission({\n\t\trole: currentMember.role,\n\t\toptions: ctx.context.orgOptions,\n\t\tpermissions: { member: [\"delete\"] },\n\t\torganizationId: session.session.activeOrganizationId\n\t}, ctx)) throw new APIError(\"FORBIDDEN\", { message: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_REMOVE_A_TEAM_MEMBER });\n\tif (!await adapter.findMemberByOrgId({\n\t\tuserId: ctx.body.userId,\n\t\torganizationId: session.session.activeOrganizationId\n\t})) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION });\n\tconst team = await adapter.findTeamById({\n\t\tteamId: ctx.body.teamId,\n\t\torganizationId: session.session.activeOrganizationId\n\t});\n\tif (!team) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.TEAM_NOT_FOUND });\n\tconst organization$1 = await adapter.findOrganizationById(session.session.activeOrganizationId);\n\tif (!organization$1) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND });\n\tconst userBeingRemoved = await ctx.context.internalAdapter.findUserById(ctx.body.userId);\n\tif (!userBeingRemoved) throw new APIError(\"BAD_REQUEST\", { message: \"User not found\" });\n\tconst teamMember = await adapter.findTeamMember({\n\t\tteamId: ctx.body.teamId,\n\t\tuserId: ctx.body.userId\n\t});\n\tif (!teamMember) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_TEAM });\n\tif (options?.organizationHooks?.beforeRemoveTeamMember) await options?.organizationHooks.beforeRemoveTeamMember({\n\t\tteamMember,\n\t\tteam,\n\t\tuser: userBeingRemoved,\n\t\torganization: organization$1\n\t});\n\tawait adapter.removeTeamMember({\n\t\tteamId: ctx.body.teamId,\n\t\tuserId: ctx.body.userId\n\t});\n\tif (options?.organizationHooks?.afterRemoveTeamMember) await options?.organizationHooks.afterRemoveTeamMember({\n\t\tteamMember,\n\t\tteam,\n\t\tuser: userBeingRemoved,\n\t\torganization: organization$1\n\t});\n\treturn ctx.json({ message: \"Team member removed successfully.\" });\n});\n\n//#endregion\n//#region src/plugins/organization/organization.ts\nfunction parseRoles(roles) {\n\treturn Array.isArray(roles) ? roles.join(\",\") : roles;\n}\nconst createHasPermission = (options) => {\n\treturn createAuthEndpoint(\"/organization/has-permission\", {\n\t\tmethod: \"POST\",\n\t\trequireHeaders: true,\n\t\tbody: z.object({ organizationId: z.string().optional() }).and(z.union([z.object({\n\t\t\tpermission: z.record(z.string(), z.array(z.string())),\n\t\t\tpermissions: z.undefined()\n\t\t}), z.object({\n\t\t\tpermission: z.undefined(),\n\t\t\tpermissions: z.record(z.string(), z.array(z.string()))\n\t\t})])),\n\t\tuse: [orgSessionMiddleware],\n\t\tmetadata: {\n\t\t\t$Infer: { body: {} },\n\t\t\topenapi: {\n\t\t\t\tdescription: \"Check if the user has permission\",\n\t\t\t\trequestBody: { content: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tpermission: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tdescription: \"The permission to check\",\n\t\t\t\t\t\t\tdeprecated: true\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tdescription: \"The permission to check\"\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\trequired: [\"permissions\"]\n\t\t\t\t} } } },\n\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\terror: { type: \"string\" },\n\t\t\t\t\t\t\tsuccess: { type: \"boolean\" }\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequired: [\"success\"]\n\t\t\t\t\t} } }\n\t\t\t\t} }\n\t\t\t}\n\t\t}\n\t}, async (ctx) => {\n\t\tconst activeOrganizationId = ctx.body.organizationId || ctx.context.session.session.activeOrganizationId;\n\t\tif (!activeOrganizationId) throw new APIError(\"BAD_REQUEST\", { message: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION });\n\t\tconst member = await getOrgAdapter(ctx.context, options).findMemberByOrgId({\n\t\t\tuserId: ctx.context.session.user.id,\n\t\t\torganizationId: activeOrganizationId\n\t\t});\n\t\tif (!member) throw new APIError(\"UNAUTHORIZED\", { message: ORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION });\n\t\tconst result = await hasPermission({\n\t\t\trole: member.role,\n\t\t\toptions: options || {},\n\t\t\tpermissions: ctx.body.permissions ?? ctx.body.permission,\n\t\t\torganizationId: activeOrganizationId\n\t\t}, ctx);\n\t\treturn ctx.json({\n\t\t\terror: null,\n\t\t\tsuccess: result\n\t\t});\n\t});\n};\nfunction organization(options) {\n\tlet endpoints = {\n\t\tcreateOrganization: createOrganization(options),\n\t\tupdateOrganization: updateOrganization(options),\n\t\tdeleteOrganization: deleteOrganization(options),\n\t\tsetActiveOrganization: setActiveOrganization(options),\n\t\tgetFullOrganization: getFullOrganization(options),\n\t\tlistOrganizations: listOrganizations(options),\n\t\tcreateInvitation: createInvitation(options),\n\t\tcancelInvitation: cancelInvitation(options),\n\t\tacceptInvitation: acceptInvitation(options),\n\t\tgetInvitation: getInvitation(options),\n\t\trejectInvitation: rejectInvitation(options),\n\t\tlistInvitations: listInvitations(options),\n\t\tgetActiveMember: getActiveMember(options),\n\t\tcheckOrganizationSlug: checkOrganizationSlug(options),\n\t\taddMember: addMember(options),\n\t\tremoveMember: removeMember(options),\n\t\tupdateMemberRole: updateMemberRole(options),\n\t\tleaveOrganization: leaveOrganization(options),\n\t\tlistUserInvitations: listUserInvitations(options),\n\t\tlistMembers: listMembers(options),\n\t\tgetActiveMemberRole: getActiveMemberRole(options)\n\t};\n\tconst teamSupport = options?.teams?.enabled;\n\tconst teamEndpoints = {\n\t\tcreateTeam: createTeam(options),\n\t\tlistOrganizationTeams: listOrganizationTeams(options),\n\t\tremoveTeam: removeTeam(options),\n\t\tupdateTeam: updateTeam(options),\n\t\tsetActiveTeam: setActiveTeam(options),\n\t\tlistUserTeams: listUserTeams(options),\n\t\tlistTeamMembers: listTeamMembers(options),\n\t\taddTeamMember: addTeamMember(options),\n\t\tremoveTeamMember: removeTeamMember(options)\n\t};\n\tif (teamSupport) endpoints = {\n\t\t...endpoints,\n\t\t...teamEndpoints\n\t};\n\tconst dynamicAccessControlEndpoints = {\n\t\tcreateOrgRole: createOrgRole(options),\n\t\tdeleteOrgRole: deleteOrgRole(options),\n\t\tlistOrgRoles: listOrgRoles(options),\n\t\tgetOrgRole: getOrgRole(options),\n\t\tupdateOrgRole: updateOrgRole(options)\n\t};\n\tif (options?.dynamicAccessControl?.enabled) endpoints = {\n\t\t...endpoints,\n\t\t...dynamicAccessControlEndpoints\n\t};\n\tconst roles = {\n\t\t...defaultRoles,\n\t\t...options?.roles\n\t};\n\tconst teamSchema$1 = teamSupport ? {\n\t\tteam: {\n\t\t\tmodelName: options?.schema?.team?.modelName,\n\t\t\tfields: {\n\t\t\t\tname: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options?.schema?.team?.fields?.name\n\t\t\t\t},\n\t\t\t\torganizationId: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\treferences: {\n\t\t\t\t\t\tmodel: \"organization\",\n\t\t\t\t\t\tfield: \"id\"\n\t\t\t\t\t},\n\t\t\t\t\tfieldName: options?.schema?.team?.fields?.organizationId,\n\t\t\t\t\tindex: true\n\t\t\t\t},\n\t\t\t\tcreatedAt: {\n\t\t\t\t\ttype: \"date\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options?.schema?.team?.fields?.createdAt\n\t\t\t\t},\n\t\t\t\tupdatedAt: {\n\t\t\t\t\ttype: \"date\",\n\t\t\t\t\trequired: false,\n\t\t\t\t\tfieldName: options?.schema?.team?.fields?.updatedAt,\n\t\t\t\t\tonUpdate: () => /* @__PURE__ */ new Date()\n\t\t\t\t},\n\t\t\t\t...options?.schema?.team?.additionalFields || {}\n\t\t\t}\n\t\t},\n\t\tteamMember: {\n\t\t\tmodelName: options?.schema?.teamMember?.modelName,\n\t\t\tfields: {\n\t\t\t\tteamId: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\treferences: {\n\t\t\t\t\t\tmodel: \"team\",\n\t\t\t\t\t\tfield: \"id\"\n\t\t\t\t\t},\n\t\t\t\t\tfieldName: options?.schema?.teamMember?.fields?.teamId,\n\t\t\t\t\tindex: true\n\t\t\t\t},\n\t\t\t\tuserId: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\treferences: {\n\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\tfield: \"id\"\n\t\t\t\t\t},\n\t\t\t\t\tfieldName: options?.schema?.teamMember?.fields?.userId,\n\t\t\t\t\tindex: true\n\t\t\t\t},\n\t\t\t\tcreatedAt: {\n\t\t\t\t\ttype: \"date\",\n\t\t\t\t\trequired: false,\n\t\t\t\t\tfieldName: options?.schema?.teamMember?.fields?.createdAt\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} : {};\n\tconst organizationRoleSchema$1 = options?.dynamicAccessControl?.enabled ? { organizationRole: {\n\t\tfields: {\n\t\t\torganizationId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: true,\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"organization\",\n\t\t\t\t\tfield: \"id\"\n\t\t\t\t},\n\t\t\t\tfieldName: options?.schema?.organizationRole?.fields?.organizationId,\n\t\t\t\tindex: true\n\t\t\t},\n\t\t\trole: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: true,\n\t\t\t\tfieldName: options?.schema?.organizationRole?.fields?.role,\n\t\t\t\tindex: true\n\t\t\t},\n\t\t\tpermission: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: true,\n\t\t\t\tfieldName: options?.schema?.organizationRole?.fields?.permission\n\t\t\t},\n\t\t\tcreatedAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t\trequired: true,\n\t\t\t\tdefaultValue: () => /* @__PURE__ */ new Date(),\n\t\t\t\tfieldName: options?.schema?.organizationRole?.fields?.createdAt\n\t\t\t},\n\t\t\tupdatedAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t\trequired: false,\n\t\t\t\tfieldName: options?.schema?.organizationRole?.fields?.updatedAt,\n\t\t\t\tonUpdate: () => /* @__PURE__ */ new Date()\n\t\t\t},\n\t\t\t...options?.schema?.organizationRole?.additionalFields || {}\n\t\t},\n\t\tmodelName: options?.schema?.organizationRole?.modelName\n\t} } : {};\n\tconst schema = {\n\t\torganization: {\n\t\t\tmodelName: options?.schema?.organization?.modelName,\n\t\t\tfields: {\n\t\t\t\tname: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tsortable: true,\n\t\t\t\t\tfieldName: options?.schema?.organization?.fields?.name\n\t\t\t\t},\n\t\t\t\tslug: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tunique: true,\n\t\t\t\t\tsortable: true,\n\t\t\t\t\tfieldName: options?.schema?.organization?.fields?.slug\n\t\t\t\t},\n\t\t\t\tlogo: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: false,\n\t\t\t\t\tfieldName: options?.schema?.organization?.fields?.logo\n\t\t\t\t},\n\t\t\t\tcreatedAt: {\n\t\t\t\t\ttype: \"date\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options?.schema?.organization?.fields?.createdAt\n\t\t\t\t},\n\t\t\t\tmetadata: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: false,\n\t\t\t\t\tfieldName: options?.schema?.organization?.fields?.metadata\n\t\t\t\t},\n\t\t\t\t...options?.schema?.organization?.additionalFields || {}\n\t\t\t}\n\t\t},\n\t\t...organizationRoleSchema$1,\n\t\t...teamSchema$1,\n\t\tmember: {\n\t\t\tmodelName: options?.schema?.member?.modelName,\n\t\t\tfields: {\n\t\t\t\torganizationId: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\treferences: {\n\t\t\t\t\t\tmodel: \"organization\",\n\t\t\t\t\t\tfield: \"id\"\n\t\t\t\t\t},\n\t\t\t\t\tfieldName: options?.schema?.member?.fields?.organizationId,\n\t\t\t\t\tindex: true\n\t\t\t\t},\n\t\t\t\tuserId: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options?.schema?.member?.fields?.userId,\n\t\t\t\t\treferences: {\n\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\tfield: \"id\"\n\t\t\t\t\t},\n\t\t\t\t\tindex: true\n\t\t\t\t},\n\t\t\t\trole: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tsortable: true,\n\t\t\t\t\tdefaultValue: \"member\",\n\t\t\t\t\tfieldName: options?.schema?.member?.fields?.role\n\t\t\t\t},\n\t\t\t\tcreatedAt: {\n\t\t\t\t\ttype: \"date\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options?.schema?.member?.fields?.createdAt\n\t\t\t\t},\n\t\t\t\t...options?.schema?.member?.additionalFields || {}\n\t\t\t}\n\t\t},\n\t\tinvitation: {\n\t\t\tmodelName: options?.schema?.invitation?.modelName,\n\t\t\tfields: {\n\t\t\t\torganizationId: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\treferences: {\n\t\t\t\t\t\tmodel: \"organization\",\n\t\t\t\t\t\tfield: \"id\"\n\t\t\t\t\t},\n\t\t\t\t\tfieldName: options?.schema?.invitation?.fields?.organizationId,\n\t\t\t\t\tindex: true\n\t\t\t\t},\n\t\t\t\temail: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tsortable: true,\n\t\t\t\t\tfieldName: options?.schema?.invitation?.fields?.email,\n\t\t\t\t\tindex: true\n\t\t\t\t},\n\t\t\t\trole: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: false,\n\t\t\t\t\tsortable: true,\n\t\t\t\t\tfieldName: options?.schema?.invitation?.fields?.role\n\t\t\t\t},\n\t\t\t\t...teamSupport ? { teamId: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: false,\n\t\t\t\t\tsortable: true,\n\t\t\t\t\tfieldName: options?.schema?.invitation?.fields?.teamId\n\t\t\t\t} } : {},\n\t\t\t\tstatus: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tsortable: true,\n\t\t\t\t\tdefaultValue: \"pending\",\n\t\t\t\t\tfieldName: options?.schema?.invitation?.fields?.status\n\t\t\t\t},\n\t\t\t\texpiresAt: {\n\t\t\t\t\ttype: \"date\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options?.schema?.invitation?.fields?.expiresAt\n\t\t\t\t},\n\t\t\t\tcreatedAt: {\n\t\t\t\t\ttype: \"date\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\tfieldName: options?.schema?.invitation?.fields?.createdAt,\n\t\t\t\t\tdefaultValue: () => /* @__PURE__ */ new Date()\n\t\t\t\t},\n\t\t\t\tinviterId: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\treferences: {\n\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\tfield: \"id\"\n\t\t\t\t\t},\n\t\t\t\t\tfieldName: options?.schema?.invitation?.fields?.inviterId,\n\t\t\t\t\trequired: true\n\t\t\t\t},\n\t\t\t\t...options?.schema?.invitation?.additionalFields || {}\n\t\t\t}\n\t\t}\n\t};\n\treturn {\n\t\tid: \"organization\",\n\t\tendpoints: {\n\t\t\t...shimContext(endpoints, {\n\t\t\t\torgOptions: options || {},\n\t\t\t\troles,\n\t\t\t\tgetSession: async (context) => {\n\t\t\t\t\treturn await getSessionFromCtx(context);\n\t\t\t\t}\n\t\t\t}),\n\t\t\thasPermission: createHasPermission(options)\n\t\t},\n\t\tschema: {\n\t\t\t...schema,\n\t\t\tsession: { fields: {\n\t\t\t\tactiveOrganizationId: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: false,\n\t\t\t\t\tfieldName: options?.schema?.session?.fields?.activeOrganizationId\n\t\t\t\t},\n\t\t\t\t...teamSupport ? { activeTeamId: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: false,\n\t\t\t\t\tfieldName: options?.schema?.session?.fields?.activeTeamId\n\t\t\t\t} } : {}\n\t\t\t} }\n\t\t},\n\t\t$Infer: {\n\t\t\tOrganization: {},\n\t\t\tInvitation: {},\n\t\t\tMember: {},\n\t\t\tTeam: teamSupport ? {} : {},\n\t\t\tTeamMember: teamSupport ? {} : {},\n\t\t\tActiveOrganization: {}\n\t\t},\n\t\t$ERROR_CODES: ORGANIZATION_ERROR_CODES,\n\t\toptions\n\t};\n}\n\n//#endregion\nexport { parseRoles as n, organization as t };","import { entityKind, is } from \"../../entity.js\";\nimport { PgViewBase } from \"../view-base.js\";\nimport { TypedQueryBuilder } from \"../../query-builders/query-builder.js\";\nimport { QueryPromise } from \"../../query-promise.js\";\nimport { SelectionProxyHandler } from \"../../selection-proxy.js\";\nimport { SQL, View } from \"../../sql/sql.js\";\nimport { Subquery } from \"../../subquery.js\";\nimport { Table } from \"../../table.js\";\nimport { tracer } from \"../../tracing.js\";\nimport {\n  applyMixins,\n  getTableColumns,\n  getTableLikeName,\n  haveSameKeys\n} from \"../../utils.js\";\nimport { orderSelectedFields } from \"../../utils.js\";\nimport { ViewBaseConfig } from \"../../view-common.js\";\nimport { extractUsedTable } from \"../utils.js\";\nclass PgSelectBuilder {\n  static [entityKind] = \"PgSelectBuilder\";\n  fields;\n  session;\n  dialect;\n  withList = [];\n  distinct;\n  constructor(config) {\n    this.fields = config.fields;\n    this.session = config.session;\n    this.dialect = config.dialect;\n    if (config.withList) {\n      this.withList = config.withList;\n    }\n    this.distinct = config.distinct;\n  }\n  authToken;\n  /** @internal */\n  setToken(token) {\n    this.authToken = token;\n    return this;\n  }\n  /**\n   * Specify the table, subquery, or other target that you're\n   * building a select query against.\n   *\n   * {@link https://www.postgresql.org/docs/current/sql-select.html#SQL-FROM | Postgres from documentation}\n   */\n  from(source) {\n    const isPartialSelect = !!this.fields;\n    const src = source;\n    let fields;\n    if (this.fields) {\n      fields = this.fields;\n    } else if (is(src, Subquery)) {\n      fields = Object.fromEntries(\n        Object.keys(src._.selectedFields).map((key) => [key, src[key]])\n      );\n    } else if (is(src, PgViewBase)) {\n      fields = src[ViewBaseConfig].selectedFields;\n    } else if (is(src, SQL)) {\n      fields = {};\n    } else {\n      fields = getTableColumns(src);\n    }\n    return new PgSelectBase({\n      table: src,\n      fields,\n      isPartialSelect,\n      session: this.session,\n      dialect: this.dialect,\n      withList: this.withList,\n      distinct: this.distinct\n    }).setToken(this.authToken);\n  }\n}\nclass PgSelectQueryBuilderBase extends TypedQueryBuilder {\n  static [entityKind] = \"PgSelectQueryBuilder\";\n  _;\n  config;\n  joinsNotNullableMap;\n  tableName;\n  isPartialSelect;\n  session;\n  dialect;\n  cacheConfig = void 0;\n  usedTables = /* @__PURE__ */ new Set();\n  constructor({ table, fields, isPartialSelect, session, dialect, withList, distinct }) {\n    super();\n    this.config = {\n      withList,\n      table,\n      fields: { ...fields },\n      distinct,\n      setOperators: []\n    };\n    this.isPartialSelect = isPartialSelect;\n    this.session = session;\n    this.dialect = dialect;\n    this._ = {\n      selectedFields: fields,\n      config: this.config\n    };\n    this.tableName = getTableLikeName(table);\n    this.joinsNotNullableMap = typeof this.tableName === \"string\" ? { [this.tableName]: true } : {};\n    for (const item of extractUsedTable(table)) this.usedTables.add(item);\n  }\n  /** @internal */\n  getUsedTables() {\n    return [...this.usedTables];\n  }\n  createJoin(joinType, lateral) {\n    return (table, on) => {\n      const baseTableName = this.tableName;\n      const tableName = getTableLikeName(table);\n      for (const item of extractUsedTable(table)) this.usedTables.add(item);\n      if (typeof tableName === \"string\" && this.config.joins?.some((join) => join.alias === tableName)) {\n        throw new Error(`Alias \"${tableName}\" is already used in this query`);\n      }\n      if (!this.isPartialSelect) {\n        if (Object.keys(this.joinsNotNullableMap).length === 1 && typeof baseTableName === \"string\") {\n          this.config.fields = {\n            [baseTableName]: this.config.fields\n          };\n        }\n        if (typeof tableName === \"string\" && !is(table, SQL)) {\n          const selection = is(table, Subquery) ? table._.selectedFields : is(table, View) ? table[ViewBaseConfig].selectedFields : table[Table.Symbol.Columns];\n          this.config.fields[tableName] = selection;\n        }\n      }\n      if (typeof on === \"function\") {\n        on = on(\n          new Proxy(\n            this.config.fields,\n            new SelectionProxyHandler({ sqlAliasedBehavior: \"sql\", sqlBehavior: \"sql\" })\n          )\n        );\n      }\n      if (!this.config.joins) {\n        this.config.joins = [];\n      }\n      this.config.joins.push({ on, table, joinType, alias: tableName, lateral });\n      if (typeof tableName === \"string\") {\n        switch (joinType) {\n          case \"left\": {\n            this.joinsNotNullableMap[tableName] = false;\n            break;\n          }\n          case \"right\": {\n            this.joinsNotNullableMap = Object.fromEntries(\n              Object.entries(this.joinsNotNullableMap).map(([key]) => [key, false])\n            );\n            this.joinsNotNullableMap[tableName] = true;\n            break;\n          }\n          case \"cross\":\n          case \"inner\": {\n            this.joinsNotNullableMap[tableName] = true;\n            break;\n          }\n          case \"full\": {\n            this.joinsNotNullableMap = Object.fromEntries(\n              Object.entries(this.joinsNotNullableMap).map(([key]) => [key, false])\n            );\n            this.joinsNotNullableMap[tableName] = false;\n            break;\n          }\n        }\n      }\n      return this;\n    };\n  }\n  /**\n   * Executes a `left join` operation by adding another table to the current query.\n   *\n   * Calling this method associates each row of the table with the corresponding row from the joined table, if a match is found. If no matching row exists, it sets all columns of the joined table to null.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/joins#left-join}\n   *\n   * @param table the table to join.\n   * @param on the `on` clause.\n   *\n   * @example\n   *\n   * ```ts\n   * // Select all users and their pets\n   * const usersWithPets: { user: User; pets: Pet | null; }[] = await db.select()\n   *   .from(users)\n   *   .leftJoin(pets, eq(users.id, pets.ownerId))\n   *\n   * // Select userId and petId\n   * const usersIdsAndPetIds: { userId: number; petId: number | null; }[] = await db.select({\n   *   userId: users.id,\n   *   petId: pets.id,\n   * })\n   *   .from(users)\n   *   .leftJoin(pets, eq(users.id, pets.ownerId))\n   * ```\n   */\n  leftJoin = this.createJoin(\"left\", false);\n  /**\n   * Executes a `left join lateral` operation by adding subquery to the current query.\n   *\n   * A `lateral` join allows the right-hand expression to refer to columns from the left-hand side.\n   *\n   * Calling this method associates each row of the table with the corresponding row from the joined table, if a match is found. If no matching row exists, it sets all columns of the joined table to null.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/joins#left-join-lateral}\n   *\n   * @param table the subquery to join.\n   * @param on the `on` clause.\n   */\n  leftJoinLateral = this.createJoin(\"left\", true);\n  /**\n   * Executes a `right join` operation by adding another table to the current query.\n   *\n   * Calling this method associates each row of the joined table with the corresponding row from the main table, if a match is found. If no matching row exists, it sets all columns of the main table to null.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/joins#right-join}\n   *\n   * @param table the table to join.\n   * @param on the `on` clause.\n   *\n   * @example\n   *\n   * ```ts\n   * // Select all users and their pets\n   * const usersWithPets: { user: User | null; pets: Pet; }[] = await db.select()\n   *   .from(users)\n   *   .rightJoin(pets, eq(users.id, pets.ownerId))\n   *\n   * // Select userId and petId\n   * const usersIdsAndPetIds: { userId: number | null; petId: number; }[] = await db.select({\n   *   userId: users.id,\n   *   petId: pets.id,\n   * })\n   *   .from(users)\n   *   .rightJoin(pets, eq(users.id, pets.ownerId))\n   * ```\n   */\n  rightJoin = this.createJoin(\"right\", false);\n  /**\n   * Executes an `inner join` operation, creating a new table by combining rows from two tables that have matching values.\n   *\n   * Calling this method retrieves rows that have corresponding entries in both joined tables. Rows without matching entries in either table are excluded, resulting in a table that includes only matching pairs.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/joins#inner-join}\n   *\n   * @param table the table to join.\n   * @param on the `on` clause.\n   *\n   * @example\n   *\n   * ```ts\n   * // Select all users and their pets\n   * const usersWithPets: { user: User; pets: Pet; }[] = await db.select()\n   *   .from(users)\n   *   .innerJoin(pets, eq(users.id, pets.ownerId))\n   *\n   * // Select userId and petId\n   * const usersIdsAndPetIds: { userId: number; petId: number; }[] = await db.select({\n   *   userId: users.id,\n   *   petId: pets.id,\n   * })\n   *   .from(users)\n   *   .innerJoin(pets, eq(users.id, pets.ownerId))\n   * ```\n   */\n  innerJoin = this.createJoin(\"inner\", false);\n  /**\n   * Executes an `inner join lateral` operation, creating a new table by combining rows from two queries that have matching values.\n   *\n   * A `lateral` join allows the right-hand expression to refer to columns from the left-hand side.\n   *\n   * Calling this method retrieves rows that have corresponding entries in both joined tables. Rows without matching entries in either table are excluded, resulting in a table that includes only matching pairs.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/joins#inner-join-lateral}\n   *\n   * @param table the subquery to join.\n   * @param on the `on` clause.\n   */\n  innerJoinLateral = this.createJoin(\"inner\", true);\n  /**\n   * Executes a `full join` operation by combining rows from two tables into a new table.\n   *\n   * Calling this method retrieves all rows from both main and joined tables, merging rows with matching values and filling in `null` for non-matching columns.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/joins#full-join}\n   *\n   * @param table the table to join.\n   * @param on the `on` clause.\n   *\n   * @example\n   *\n   * ```ts\n   * // Select all users and their pets\n   * const usersWithPets: { user: User | null; pets: Pet | null; }[] = await db.select()\n   *   .from(users)\n   *   .fullJoin(pets, eq(users.id, pets.ownerId))\n   *\n   * // Select userId and petId\n   * const usersIdsAndPetIds: { userId: number | null; petId: number | null; }[] = await db.select({\n   *   userId: users.id,\n   *   petId: pets.id,\n   * })\n   *   .from(users)\n   *   .fullJoin(pets, eq(users.id, pets.ownerId))\n   * ```\n   */\n  fullJoin = this.createJoin(\"full\", false);\n  /**\n   * Executes a `cross join` operation by combining rows from two tables into a new table.\n   *\n   * Calling this method retrieves all rows from both main and joined tables, merging all rows from each table.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/joins#cross-join}\n   *\n   * @param table the table to join.\n   *\n   * @example\n   *\n   * ```ts\n   * // Select all users, each user with every pet\n   * const usersWithPets: { user: User; pets: Pet; }[] = await db.select()\n   *   .from(users)\n   *   .crossJoin(pets)\n   *\n   * // Select userId and petId\n   * const usersIdsAndPetIds: { userId: number; petId: number; }[] = await db.select({\n   *   userId: users.id,\n   *   petId: pets.id,\n   * })\n   *   .from(users)\n   *   .crossJoin(pets)\n   * ```\n   */\n  crossJoin = this.createJoin(\"cross\", false);\n  /**\n   * Executes a `cross join lateral` operation by combining rows from two queries into a new table.\n   *\n   * A `lateral` join allows the right-hand expression to refer to columns from the left-hand side.\n   *\n   * Calling this method retrieves all rows from both main and joined queries, merging all rows from each query.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/joins#cross-join-lateral}\n   *\n   * @param table the query to join.\n   */\n  crossJoinLateral = this.createJoin(\"cross\", true);\n  createSetOperator(type, isAll) {\n    return (rightSelection) => {\n      const rightSelect = typeof rightSelection === \"function\" ? rightSelection(getPgSetOperators()) : rightSelection;\n      if (!haveSameKeys(this.getSelectedFields(), rightSelect.getSelectedFields())) {\n        throw new Error(\n          \"Set operator error (union / intersect / except): selected fields are not the same or are in a different order\"\n        );\n      }\n      this.config.setOperators.push({ type, isAll, rightSelect });\n      return this;\n    };\n  }\n  /**\n   * Adds `union` set operator to the query.\n   *\n   * Calling this method will combine the result sets of the `select` statements and remove any duplicate rows that appear across them.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/set-operations#union}\n   *\n   * @example\n   *\n   * ```ts\n   * // Select all unique names from customers and users tables\n   * await db.select({ name: users.name })\n   *   .from(users)\n   *   .union(\n   *     db.select({ name: customers.name }).from(customers)\n   *   );\n   * // or\n   * import { union } from 'drizzle-orm/pg-core'\n   *\n   * await union(\n   *   db.select({ name: users.name }).from(users),\n   *   db.select({ name: customers.name }).from(customers)\n   * );\n   * ```\n   */\n  union = this.createSetOperator(\"union\", false);\n  /**\n   * Adds `union all` set operator to the query.\n   *\n   * Calling this method will combine the result-set of the `select` statements and keep all duplicate rows that appear across them.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/set-operations#union-all}\n   *\n   * @example\n   *\n   * ```ts\n   * // Select all transaction ids from both online and in-store sales\n   * await db.select({ transaction: onlineSales.transactionId })\n   *   .from(onlineSales)\n   *   .unionAll(\n   *     db.select({ transaction: inStoreSales.transactionId }).from(inStoreSales)\n   *   );\n   * // or\n   * import { unionAll } from 'drizzle-orm/pg-core'\n   *\n   * await unionAll(\n   *   db.select({ transaction: onlineSales.transactionId }).from(onlineSales),\n   *   db.select({ transaction: inStoreSales.transactionId }).from(inStoreSales)\n   * );\n   * ```\n   */\n  unionAll = this.createSetOperator(\"union\", true);\n  /**\n   * Adds `intersect` set operator to the query.\n   *\n   * Calling this method will retain only the rows that are present in both result sets and eliminate duplicates.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/set-operations#intersect}\n   *\n   * @example\n   *\n   * ```ts\n   * // Select course names that are offered in both departments A and B\n   * await db.select({ courseName: depA.courseName })\n   *   .from(depA)\n   *   .intersect(\n   *     db.select({ courseName: depB.courseName }).from(depB)\n   *   );\n   * // or\n   * import { intersect } from 'drizzle-orm/pg-core'\n   *\n   * await intersect(\n   *   db.select({ courseName: depA.courseName }).from(depA),\n   *   db.select({ courseName: depB.courseName }).from(depB)\n   * );\n   * ```\n   */\n  intersect = this.createSetOperator(\"intersect\", false);\n  /**\n   * Adds `intersect all` set operator to the query.\n   *\n   * Calling this method will retain only the rows that are present in both result sets including all duplicates.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/set-operations#intersect-all}\n   *\n   * @example\n   *\n   * ```ts\n   * // Select all products and quantities that are ordered by both regular and VIP customers\n   * await db.select({\n   *   productId: regularCustomerOrders.productId,\n   *   quantityOrdered: regularCustomerOrders.quantityOrdered\n   * })\n   * .from(regularCustomerOrders)\n   * .intersectAll(\n   *   db.select({\n   *     productId: vipCustomerOrders.productId,\n   *     quantityOrdered: vipCustomerOrders.quantityOrdered\n   *   })\n   *   .from(vipCustomerOrders)\n   * );\n   * // or\n   * import { intersectAll } from 'drizzle-orm/pg-core'\n   *\n   * await intersectAll(\n   *   db.select({\n   *     productId: regularCustomerOrders.productId,\n   *     quantityOrdered: regularCustomerOrders.quantityOrdered\n   *   })\n   *   .from(regularCustomerOrders),\n   *   db.select({\n   *     productId: vipCustomerOrders.productId,\n   *     quantityOrdered: vipCustomerOrders.quantityOrdered\n   *   })\n   *   .from(vipCustomerOrders)\n   * );\n   * ```\n   */\n  intersectAll = this.createSetOperator(\"intersect\", true);\n  /**\n   * Adds `except` set operator to the query.\n   *\n   * Calling this method will retrieve all unique rows from the left query, except for the rows that are present in the result set of the right query.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/set-operations#except}\n   *\n   * @example\n   *\n   * ```ts\n   * // Select all courses offered in department A but not in department B\n   * await db.select({ courseName: depA.courseName })\n   *   .from(depA)\n   *   .except(\n   *     db.select({ courseName: depB.courseName }).from(depB)\n   *   );\n   * // or\n   * import { except } from 'drizzle-orm/pg-core'\n   *\n   * await except(\n   *   db.select({ courseName: depA.courseName }).from(depA),\n   *   db.select({ courseName: depB.courseName }).from(depB)\n   * );\n   * ```\n   */\n  except = this.createSetOperator(\"except\", false);\n  /**\n   * Adds `except all` set operator to the query.\n   *\n   * Calling this method will retrieve all rows from the left query, except for the rows that are present in the result set of the right query.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/set-operations#except-all}\n   *\n   * @example\n   *\n   * ```ts\n   * // Select all products that are ordered by regular customers but not by VIP customers\n   * await db.select({\n   *   productId: regularCustomerOrders.productId,\n   *   quantityOrdered: regularCustomerOrders.quantityOrdered,\n   * })\n   * .from(regularCustomerOrders)\n   * .exceptAll(\n   *   db.select({\n   *     productId: vipCustomerOrders.productId,\n   *     quantityOrdered: vipCustomerOrders.quantityOrdered,\n   *   })\n   *   .from(vipCustomerOrders)\n   * );\n   * // or\n   * import { exceptAll } from 'drizzle-orm/pg-core'\n   *\n   * await exceptAll(\n   *   db.select({\n   *     productId: regularCustomerOrders.productId,\n   *     quantityOrdered: regularCustomerOrders.quantityOrdered\n   *   })\n   *   .from(regularCustomerOrders),\n   *   db.select({\n   *     productId: vipCustomerOrders.productId,\n   *     quantityOrdered: vipCustomerOrders.quantityOrdered\n   *   })\n   *   .from(vipCustomerOrders)\n   * );\n   * ```\n   */\n  exceptAll = this.createSetOperator(\"except\", true);\n  /** @internal */\n  addSetOperators(setOperators) {\n    this.config.setOperators.push(...setOperators);\n    return this;\n  }\n  /**\n   * Adds a `where` clause to the query.\n   *\n   * Calling this method will select only those rows that fulfill a specified condition.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/select#filtering}\n   *\n   * @param where the `where` clause.\n   *\n   * @example\n   * You can use conditional operators and `sql function` to filter the rows to be selected.\n   *\n   * ```ts\n   * // Select all cars with green color\n   * await db.select().from(cars).where(eq(cars.color, 'green'));\n   * // or\n   * await db.select().from(cars).where(sql`${cars.color} = 'green'`)\n   * ```\n   *\n   * You can logically combine conditional operators with `and()` and `or()` operators:\n   *\n   * ```ts\n   * // Select all BMW cars with a green color\n   * await db.select().from(cars).where(and(eq(cars.color, 'green'), eq(cars.brand, 'BMW')));\n   *\n   * // Select all cars with the green or blue color\n   * await db.select().from(cars).where(or(eq(cars.color, 'green'), eq(cars.color, 'blue')));\n   * ```\n   */\n  where(where) {\n    if (typeof where === \"function\") {\n      where = where(\n        new Proxy(\n          this.config.fields,\n          new SelectionProxyHandler({ sqlAliasedBehavior: \"sql\", sqlBehavior: \"sql\" })\n        )\n      );\n    }\n    this.config.where = where;\n    return this;\n  }\n  /**\n   * Adds a `having` clause to the query.\n   *\n   * Calling this method will select only those rows that fulfill a specified condition. It is typically used with aggregate functions to filter the aggregated data based on a specified condition.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/select#aggregations}\n   *\n   * @param having the `having` clause.\n   *\n   * @example\n   *\n   * ```ts\n   * // Select all brands with more than one car\n   * await db.select({\n   * \tbrand: cars.brand,\n   * \tcount: sql<number>`cast(count(${cars.id}) as int)`,\n   * })\n   *   .from(cars)\n   *   .groupBy(cars.brand)\n   *   .having(({ count }) => gt(count, 1));\n   * ```\n   */\n  having(having) {\n    if (typeof having === \"function\") {\n      having = having(\n        new Proxy(\n          this.config.fields,\n          new SelectionProxyHandler({ sqlAliasedBehavior: \"sql\", sqlBehavior: \"sql\" })\n        )\n      );\n    }\n    this.config.having = having;\n    return this;\n  }\n  groupBy(...columns) {\n    if (typeof columns[0] === \"function\") {\n      const groupBy = columns[0](\n        new Proxy(\n          this.config.fields,\n          new SelectionProxyHandler({ sqlAliasedBehavior: \"alias\", sqlBehavior: \"sql\" })\n        )\n      );\n      this.config.groupBy = Array.isArray(groupBy) ? groupBy : [groupBy];\n    } else {\n      this.config.groupBy = columns;\n    }\n    return this;\n  }\n  orderBy(...columns) {\n    if (typeof columns[0] === \"function\") {\n      const orderBy = columns[0](\n        new Proxy(\n          this.config.fields,\n          new SelectionProxyHandler({ sqlAliasedBehavior: \"alias\", sqlBehavior: \"sql\" })\n        )\n      );\n      const orderByArray = Array.isArray(orderBy) ? orderBy : [orderBy];\n      if (this.config.setOperators.length > 0) {\n        this.config.setOperators.at(-1).orderBy = orderByArray;\n      } else {\n        this.config.orderBy = orderByArray;\n      }\n    } else {\n      const orderByArray = columns;\n      if (this.config.setOperators.length > 0) {\n        this.config.setOperators.at(-1).orderBy = orderByArray;\n      } else {\n        this.config.orderBy = orderByArray;\n      }\n    }\n    return this;\n  }\n  /**\n   * Adds a `limit` clause to the query.\n   *\n   * Calling this method will set the maximum number of rows that will be returned by this query.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/select#limit--offset}\n   *\n   * @param limit the `limit` clause.\n   *\n   * @example\n   *\n   * ```ts\n   * // Get the first 10 people from this query.\n   * await db.select().from(people).limit(10);\n   * ```\n   */\n  limit(limit) {\n    if (this.config.setOperators.length > 0) {\n      this.config.setOperators.at(-1).limit = limit;\n    } else {\n      this.config.limit = limit;\n    }\n    return this;\n  }\n  /**\n   * Adds an `offset` clause to the query.\n   *\n   * Calling this method will skip a number of rows when returning results from this query.\n   *\n   * See docs: {@link https://orm.drizzle.team/docs/select#limit--offset}\n   *\n   * @param offset the `offset` clause.\n   *\n   * @example\n   *\n   * ```ts\n   * // Get the 10th-20th people from this query.\n   * await db.select().from(people).offset(10).limit(10);\n   * ```\n   */\n  offset(offset) {\n    if (this.config.setOperators.length > 0) {\n      this.config.setOperators.at(-1).offset = offset;\n    } else {\n      this.config.offset = offset;\n    }\n    return this;\n  }\n  /**\n   * Adds a `for` clause to the query.\n   *\n   * Calling this method will specify a lock strength for this query that controls how strictly it acquires exclusive access to the rows being queried.\n   *\n   * See docs: {@link https://www.postgresql.org/docs/current/sql-select.html#SQL-FOR-UPDATE-SHARE}\n   *\n   * @param strength the lock strength.\n   * @param config the lock configuration.\n   */\n  for(strength, config = {}) {\n    this.config.lockingClause = { strength, config };\n    return this;\n  }\n  /** @internal */\n  getSQL() {\n    return this.dialect.buildSelectQuery(this.config);\n  }\n  toSQL() {\n    const { typings: _typings, ...rest } = this.dialect.sqlToQuery(this.getSQL());\n    return rest;\n  }\n  as(alias) {\n    const usedTables = [];\n    usedTables.push(...extractUsedTable(this.config.table));\n    if (this.config.joins) {\n      for (const it of this.config.joins) usedTables.push(...extractUsedTable(it.table));\n    }\n    return new Proxy(\n      new Subquery(this.getSQL(), this.config.fields, alias, false, [...new Set(usedTables)]),\n      new SelectionProxyHandler({ alias, sqlAliasedBehavior: \"alias\", sqlBehavior: \"error\" })\n    );\n  }\n  /** @internal */\n  getSelectedFields() {\n    return new Proxy(\n      this.config.fields,\n      new SelectionProxyHandler({ alias: this.tableName, sqlAliasedBehavior: \"alias\", sqlBehavior: \"error\" })\n    );\n  }\n  $dynamic() {\n    return this;\n  }\n  $withCache(config) {\n    this.cacheConfig = config === void 0 ? { config: {}, enable: true, autoInvalidate: true } : config === false ? { enable: false } : { enable: true, autoInvalidate: true, ...config };\n    return this;\n  }\n}\nclass PgSelectBase extends PgSelectQueryBuilderBase {\n  static [entityKind] = \"PgSelect\";\n  /** @internal */\n  _prepare(name) {\n    const { session, config, dialect, joinsNotNullableMap, authToken, cacheConfig, usedTables } = this;\n    if (!session) {\n      throw new Error(\"Cannot execute a query on a query builder. Please use a database instance instead.\");\n    }\n    const { fields } = config;\n    return tracer.startActiveSpan(\"drizzle.prepareQuery\", () => {\n      const fieldsList = orderSelectedFields(fields);\n      const query = session.prepareQuery(dialect.sqlToQuery(this.getSQL()), fieldsList, name, true, void 0, {\n        type: \"select\",\n        tables: [...usedTables]\n      }, cacheConfig);\n      query.joinsNotNullableMap = joinsNotNullableMap;\n      return query.setToken(authToken);\n    });\n  }\n  /**\n   * Create a prepared statement for this query. This allows\n   * the database to remember this query for the given session\n   * and call it by name, rather than specifying the full query.\n   *\n   * {@link https://www.postgresql.org/docs/current/sql-prepare.html | Postgres prepare documentation}\n   */\n  prepare(name) {\n    return this._prepare(name);\n  }\n  authToken;\n  /** @internal */\n  setToken(token) {\n    this.authToken = token;\n    return this;\n  }\n  execute = (placeholderValues) => {\n    return tracer.startActiveSpan(\"drizzle.operation\", () => {\n      return this._prepare().execute(placeholderValues, this.authToken);\n    });\n  };\n}\napplyMixins(PgSelectBase, [QueryPromise]);\nfunction createSetOperator(type, isAll) {\n  return (leftSelect, rightSelect, ...restSelects) => {\n    const setOperators = [rightSelect, ...restSelects].map((select) => ({\n      type,\n      isAll,\n      rightSelect: select\n    }));\n    for (const setOperator of setOperators) {\n      if (!haveSameKeys(leftSelect.getSelectedFields(), setOperator.rightSelect.getSelectedFields())) {\n        throw new Error(\n          \"Set operator error (union / intersect / except): selected fields are not the same or are in a different order\"\n        );\n      }\n    }\n    return leftSelect.addSetOperators(setOperators);\n  };\n}\nconst getPgSetOperators = () => ({\n  union,\n  unionAll,\n  intersect,\n  intersectAll,\n  except,\n  exceptAll\n});\nconst union = createSetOperator(\"union\", false);\nconst unionAll = createSetOperator(\"union\", true);\nconst intersect = createSetOperator(\"intersect\", false);\nconst intersectAll = createSetOperator(\"intersect\", true);\nconst except = createSetOperator(\"except\", false);\nconst exceptAll = createSetOperator(\"except\", true);\nexport {\n  PgSelectBase,\n  PgSelectBuilder,\n  PgSelectQueryBuilderBase,\n  except,\n  exceptAll,\n  intersect,\n  intersectAll,\n  union,\n  unionAll\n};\n//# sourceMappingURL=select.js.map","import { ensureLeadingSlash } from '../../page-path/ensure-leading-slash';\nimport { isGroupSegment } from '../../segment';\n/**\n * Normalizes an app route so it represents the actual request path. Essentially\n * performing the following transformations:\n *\n * - `/(dashboard)/user/[id]/page` to `/user/[id]`\n * - `/(dashboard)/account/page` to `/account`\n * - `/user/[id]/page` to `/user/[id]`\n * - `/account/page` to `/account`\n * - `/page` to `/`\n * - `/(dashboard)/user/[id]/route` to `/user/[id]`\n * - `/(dashboard)/account/route` to `/account`\n * - `/user/[id]/route` to `/user/[id]`\n * - `/account/route` to `/account`\n * - `/route` to `/`\n * - `/` to `/`\n *\n * @param route the app route to normalize\n * @returns the normalized pathname\n */ export function normalizeAppPath(route) {\n    return ensureLeadingSlash(route.split('/').reduce((pathname, segment, index, segments)=>{\n        // Empty segments are ignored.\n        if (!segment) {\n            return pathname;\n        }\n        // Groups are ignored.\n        if (isGroupSegment(segment)) {\n            return pathname;\n        }\n        // Parallel segments are ignored.\n        if (segment[0] === '@') {\n            return pathname;\n        }\n        // The last segment (if it's a leaf) should be ignored.\n        if ((segment === 'page' || segment === 'route') && index === segments.length - 1) {\n            return pathname;\n        }\n        return `${pathname}/${segment}`;\n    }, ''));\n}\n/**\n * Strips the `.rsc` extension if it's in the pathname.\n * Since this function is used on full urls it checks `?` for searchParams handling.\n */ export function normalizeRscURL(url) {\n    return url.replace(/\\.rsc($|\\?)/, // $1 ensures `?` is preserved\n    '$1');\n}\n\n//# sourceMappingURL=app-paths.js.map","import { n as HIDE_METADATA, t as generateId } from \"./utils-db7gNqd-.mjs\";\nimport { r as generateRandomString } from \"./crypto-CFUhAR9W.mjs\";\nimport { t as mergeSchema, u as getDate } from \"./schema-Bb7wzeK_.mjs\";\nimport { t as getIp } from \"./get-request-ip-D6st-mto.mjs\";\nimport { t as safeJSONParse } from \"./json-CnHxKYpj.mjs\";\nimport { t as getBaseURL } from \"./url-CB8xCwz-.mjs\";\nimport { t as APIError$1 } from \"./api-CkmycQ2x.mjs\";\nimport { l as parseSetCookieHeader } from \"./cookies-D72PbWdz.mjs\";\nimport { r as getSessionFromCtx, u as sessionMiddleware } from \"./session-AaRl3_x-.mjs\";\nimport { n as parser_default } from \"./parser-pHp5yoAv.mjs\";\nimport { n as role } from \"./access-Dx8TLKnw.mjs\";\nimport { a as parsePrompt, i as schema, r as oidcProvider } from \"./oidc-provider-B9SsN23J.mjs\";\nimport { isProduction, logger } from \"@better-auth/core/env\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport { SignJWT } from \"jose\";\nimport { createAuthEndpoint, createAuthEndpoint as createAuthEndpoint$1, createAuthMiddleware, createAuthMiddleware as createAuthMiddleware$1, optionsMiddleware } from \"@better-auth/core/api\";\nimport { base64, base64Url } from \"@better-auth/utils/base64\";\nimport { getWebcryptoSubtle } from \"@better-auth/utils\";\n\n//#region src/plugins/api-key/adapter.ts\n/**\n* Generate storage key for API key by hashed key\n*/\nfunction getStorageKeyByHashedKey(hashedKey) {\n\treturn `api-key:${hashedKey}`;\n}\n/**\n* Generate storage key for API key by ID\n*/\nfunction getStorageKeyById(id) {\n\treturn `api-key:by-id:${id}`;\n}\n/**\n* Generate storage key for user's API key list\n*/\nfunction getStorageKeyByUserId(userId) {\n\treturn `api-key:by-user:${userId}`;\n}\n/**\n* Serialize API key for storage\n*/\nfunction serializeApiKey(apiKey$1) {\n\treturn JSON.stringify({\n\t\t...apiKey$1,\n\t\tcreatedAt: apiKey$1.createdAt.toISOString(),\n\t\tupdatedAt: apiKey$1.updatedAt.toISOString(),\n\t\texpiresAt: apiKey$1.expiresAt?.toISOString() ?? null,\n\t\tlastRefillAt: apiKey$1.lastRefillAt?.toISOString() ?? null,\n\t\tlastRequest: apiKey$1.lastRequest?.toISOString() ?? null\n\t});\n}\n/**\n* Deserialize API key from storage\n*/\nfunction deserializeApiKey(data) {\n\tif (!data || typeof data !== \"string\") return null;\n\ttry {\n\t\tconst parsed = JSON.parse(data);\n\t\treturn {\n\t\t\t...parsed,\n\t\t\tcreatedAt: new Date(parsed.createdAt),\n\t\t\tupdatedAt: new Date(parsed.updatedAt),\n\t\t\texpiresAt: parsed.expiresAt ? new Date(parsed.expiresAt) : null,\n\t\t\tlastRefillAt: parsed.lastRefillAt ? new Date(parsed.lastRefillAt) : null,\n\t\t\tlastRequest: parsed.lastRequest ? new Date(parsed.lastRequest) : null\n\t\t};\n\t} catch {\n\t\treturn null;\n\t}\n}\n/**\n* Get the storage instance to use (custom methods take precedence)\n*/\nfunction getStorageInstance(ctx, opts) {\n\tif (opts.customStorage) return opts.customStorage;\n\treturn ctx.context.secondaryStorage || null;\n}\n/**\n* Calculate TTL in seconds for an API key\n*/\nfunction calculateTTL(apiKey$1) {\n\tif (apiKey$1.expiresAt) {\n\t\tconst now = Date.now();\n\t\tconst expiresAt = new Date(apiKey$1.expiresAt).getTime();\n\t\tconst ttlSeconds = Math.floor((expiresAt - now) / 1e3);\n\t\tif (ttlSeconds > 0) return ttlSeconds;\n\t}\n}\n/**\n* Get API key from secondary storage by hashed key\n*/\nasync function getApiKeyFromStorage(ctx, hashedKey, storage) {\n\tconst key = getStorageKeyByHashedKey(hashedKey);\n\treturn deserializeApiKey(await storage.get(key));\n}\n/**\n* Get API key from secondary storage by ID\n*/\nasync function getApiKeyByIdFromStorage(ctx, id, storage) {\n\tconst key = getStorageKeyById(id);\n\treturn deserializeApiKey(await storage.get(key));\n}\n/**\n* Store API key in secondary storage\n*/\nasync function setApiKeyInStorage(ctx, apiKey$1, storage, ttl) {\n\tconst serialized = serializeApiKey(apiKey$1);\n\tconst hashedKey = apiKey$1.key;\n\tconst id = apiKey$1.id;\n\tawait storage.set(getStorageKeyByHashedKey(hashedKey), serialized, ttl);\n\tawait storage.set(getStorageKeyById(id), serialized, ttl);\n\tconst userKey = getStorageKeyByUserId(apiKey$1.userId);\n\tconst userListData = await storage.get(userKey);\n\tlet userIds = [];\n\tif (userListData && typeof userListData === \"string\") try {\n\t\tuserIds = JSON.parse(userListData);\n\t} catch {\n\t\tuserIds = [];\n\t}\n\telse if (Array.isArray(userListData)) userIds = userListData;\n\tif (!userIds.includes(id)) {\n\t\tuserIds.push(id);\n\t\tawait storage.set(userKey, JSON.stringify(userIds));\n\t}\n}\n/**\n* Delete API key from secondary storage\n*/\nasync function deleteApiKeyFromStorage(ctx, apiKey$1, storage) {\n\tconst hashedKey = apiKey$1.key;\n\tconst id = apiKey$1.id;\n\tconst userId = apiKey$1.userId;\n\tawait storage.delete(getStorageKeyByHashedKey(hashedKey));\n\tawait storage.delete(getStorageKeyById(id));\n\tconst userKey = getStorageKeyByUserId(userId);\n\tconst userListData = await storage.get(userKey);\n\tlet userIds = [];\n\tif (userListData && typeof userListData === \"string\") try {\n\t\tuserIds = JSON.parse(userListData);\n\t} catch {\n\t\tuserIds = [];\n\t}\n\telse if (Array.isArray(userListData)) userIds = userListData;\n\tconst filteredIds = userIds.filter((keyId) => keyId !== id);\n\tif (filteredIds.length === 0) await storage.delete(userKey);\n\telse await storage.set(userKey, JSON.stringify(filteredIds));\n}\n/**\n* Unified getter for API keys with support for all storage modes\n*/\nasync function getApiKey$1(ctx, hashedKey, opts) {\n\tconst storage = getStorageInstance(ctx, opts);\n\tif (opts.storage === \"database\") return await ctx.context.adapter.findOne({\n\t\tmodel: \"apikey\",\n\t\twhere: [{\n\t\t\tfield: \"key\",\n\t\t\tvalue: hashedKey\n\t\t}]\n\t});\n\tif (opts.storage === \"secondary-storage\" && opts.fallbackToDatabase) {\n\t\tif (storage) {\n\t\t\tconst cached = await getApiKeyFromStorage(ctx, hashedKey, storage);\n\t\t\tif (cached) return cached;\n\t\t}\n\t\tconst dbKey = await ctx.context.adapter.findOne({\n\t\t\tmodel: \"apikey\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"key\",\n\t\t\t\tvalue: hashedKey\n\t\t\t}]\n\t\t});\n\t\tif (dbKey && storage) await setApiKeyInStorage(ctx, dbKey, storage, calculateTTL(dbKey));\n\t\treturn dbKey;\n\t}\n\tif (opts.storage === \"secondary-storage\") {\n\t\tif (!storage) return null;\n\t\treturn await getApiKeyFromStorage(ctx, hashedKey, storage);\n\t}\n\treturn await ctx.context.adapter.findOne({\n\t\tmodel: \"apikey\",\n\t\twhere: [{\n\t\t\tfield: \"key\",\n\t\t\tvalue: hashedKey\n\t\t}]\n\t});\n}\n/**\n* Unified getter for API keys by ID\n*/\nasync function getApiKeyById(ctx, id, opts) {\n\tconst storage = getStorageInstance(ctx, opts);\n\tif (opts.storage === \"database\") return await ctx.context.adapter.findOne({\n\t\tmodel: \"apikey\",\n\t\twhere: [{\n\t\t\tfield: \"id\",\n\t\t\tvalue: id\n\t\t}]\n\t});\n\tif (opts.storage === \"secondary-storage\" && opts.fallbackToDatabase) {\n\t\tif (storage) {\n\t\t\tconst cached = await getApiKeyByIdFromStorage(ctx, id, storage);\n\t\t\tif (cached) return cached;\n\t\t}\n\t\tconst dbKey = await ctx.context.adapter.findOne({\n\t\t\tmodel: \"apikey\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"id\",\n\t\t\t\tvalue: id\n\t\t\t}]\n\t\t});\n\t\tif (dbKey && storage) await setApiKeyInStorage(ctx, dbKey, storage, calculateTTL(dbKey));\n\t\treturn dbKey;\n\t}\n\tif (opts.storage === \"secondary-storage\") {\n\t\tif (!storage) return null;\n\t\treturn await getApiKeyByIdFromStorage(ctx, id, storage);\n\t}\n\treturn await ctx.context.adapter.findOne({\n\t\tmodel: \"apikey\",\n\t\twhere: [{\n\t\t\tfield: \"id\",\n\t\t\tvalue: id\n\t\t}]\n\t});\n}\n/**\n* Unified setter for API keys with support for all storage modes\n*/\nasync function setApiKey(ctx, apiKey$1, opts) {\n\tconst storage = getStorageInstance(ctx, opts);\n\tconst ttl = calculateTTL(apiKey$1);\n\tif (opts.storage === \"database\") return;\n\tif (opts.storage === \"secondary-storage\") {\n\t\tif (!storage) throw new Error(\"Secondary storage is required when storage mode is 'secondary-storage'\");\n\t\tawait setApiKeyInStorage(ctx, apiKey$1, storage, ttl);\n\t\treturn;\n\t}\n}\n/**\n* Unified deleter for API keys with support for all storage modes\n*/\nasync function deleteApiKey$1(ctx, apiKey$1, opts) {\n\tconst storage = getStorageInstance(ctx, opts);\n\tif (opts.storage === \"database\") return;\n\tif (opts.storage === \"secondary-storage\") {\n\t\tif (!storage) throw new Error(\"Secondary storage is required when storage mode is 'secondary-storage'\");\n\t\tawait deleteApiKeyFromStorage(ctx, apiKey$1, storage);\n\t\treturn;\n\t}\n}\n/**\n* List API keys for a user with support for all storage modes\n*/\nasync function listApiKeys$1(ctx, userId, opts) {\n\tconst storage = getStorageInstance(ctx, opts);\n\tif (opts.storage === \"database\") return await ctx.context.adapter.findMany({\n\t\tmodel: \"apikey\",\n\t\twhere: [{\n\t\t\tfield: \"userId\",\n\t\t\tvalue: userId\n\t\t}]\n\t});\n\tif (opts.storage === \"secondary-storage\" && opts.fallbackToDatabase) {\n\t\tconst userKey = getStorageKeyByUserId(userId);\n\t\tif (storage) {\n\t\t\tconst userListData = await storage.get(userKey);\n\t\t\tlet userIds = [];\n\t\t\tif (userListData && typeof userListData === \"string\") try {\n\t\t\t\tuserIds = JSON.parse(userListData);\n\t\t\t} catch {\n\t\t\t\tuserIds = [];\n\t\t\t}\n\t\t\telse if (Array.isArray(userListData)) userIds = userListData;\n\t\t\tif (userIds.length > 0) {\n\t\t\t\tconst apiKeys = [];\n\t\t\t\tfor (const id of userIds) {\n\t\t\t\t\tconst apiKey$1 = await getApiKeyByIdFromStorage(ctx, id, storage);\n\t\t\t\t\tif (apiKey$1) apiKeys.push(apiKey$1);\n\t\t\t\t}\n\t\t\t\treturn apiKeys;\n\t\t\t}\n\t\t}\n\t\tconst dbKeys = await ctx.context.adapter.findMany({\n\t\t\tmodel: \"apikey\",\n\t\t\twhere: [{\n\t\t\t\tfield: \"userId\",\n\t\t\t\tvalue: userId\n\t\t\t}]\n\t\t});\n\t\tif (storage && dbKeys.length > 0) {\n\t\t\tconst userIds = [];\n\t\t\tfor (const apiKey$1 of dbKeys) {\n\t\t\t\tawait setApiKeyInStorage(ctx, apiKey$1, storage, calculateTTL(apiKey$1));\n\t\t\t\tuserIds.push(apiKey$1.id);\n\t\t\t}\n\t\t\tawait storage.set(userKey, JSON.stringify(userIds));\n\t\t}\n\t\treturn dbKeys;\n\t}\n\tif (opts.storage === \"secondary-storage\") {\n\t\tif (!storage) return [];\n\t\tconst userKey = getStorageKeyByUserId(userId);\n\t\tconst userListData = await storage.get(userKey);\n\t\tlet userIds = [];\n\t\tif (userListData && typeof userListData === \"string\") try {\n\t\t\tuserIds = JSON.parse(userListData);\n\t\t} catch {\n\t\t\treturn [];\n\t\t}\n\t\telse if (Array.isArray(userListData)) userIds = userListData;\n\t\telse return [];\n\t\tconst apiKeys = [];\n\t\tfor (const id of userIds) {\n\t\t\tconst apiKey$1 = await getApiKeyByIdFromStorage(ctx, id, storage);\n\t\t\tif (apiKey$1) apiKeys.push(apiKey$1);\n\t\t}\n\t\treturn apiKeys;\n\t}\n\treturn await ctx.context.adapter.findMany({\n\t\tmodel: \"apikey\",\n\t\twhere: [{\n\t\t\tfield: \"userId\",\n\t\t\tvalue: userId\n\t\t}]\n\t});\n}\n\n//#endregion\n//#region src/plugins/api-key/routes/create-api-key.ts\nfunction createApiKey({ keyGenerator, opts, schema: schema$1, deleteAllExpiredApiKeys: deleteAllExpiredApiKeys$1 }) {\n\treturn createAuthEndpoint(\"/api-key/create\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({\n\t\t\tname: z.string().meta({ description: \"Name of the Api Key\" }).optional(),\n\t\t\texpiresIn: z.number().meta({ description: \"Expiration time of the Api Key in seconds\" }).min(1).optional().nullable().default(null),\n\t\t\tuserId: z.coerce.string().meta({ description: \"User Id of the user that the Api Key belongs to. server-only. Eg: \\\"user-id\\\"\" }).optional(),\n\t\t\tprefix: z.string().meta({ description: \"Prefix of the Api Key\" }).regex(/^[a-zA-Z0-9_-]+$/, { message: \"Invalid prefix format, must be alphanumeric and contain only underscores and hyphens.\" }).optional(),\n\t\t\tremaining: z.number().meta({ description: \"Remaining number of requests. Server side only\" }).min(0).optional().nullable().default(null),\n\t\t\tmetadata: z.any().optional(),\n\t\t\trefillAmount: z.number().meta({ description: \"Amount to refill the remaining count of the Api Key. server-only. Eg: 100\" }).min(1).optional(),\n\t\t\trefillInterval: z.number().meta({ description: \"Interval to refill the Api Key in milliseconds. server-only. Eg: 1000\" }).optional(),\n\t\t\trateLimitTimeWindow: z.number().meta({ description: \"The duration in milliseconds where each request is counted. Once the `maxRequests` is reached, the request will be rejected until the `timeWindow` has passed, at which point the `timeWindow` will be reset. server-only. Eg: 1000\" }).optional(),\n\t\t\trateLimitMax: z.number().meta({ description: \"Maximum amount of requests allowed within a window. Once the `maxRequests` is reached, the request will be rejected until the `timeWindow` has passed, at which point the `timeWindow` will be reset. server-only. Eg: 100\" }).optional(),\n\t\t\trateLimitEnabled: z.boolean().meta({ description: \"Whether the key has rate limiting enabled. server-only. Eg: true\" }).optional(),\n\t\t\tpermissions: z.record(z.string(), z.array(z.string())).meta({ description: \"Permissions of the Api Key.\" }).optional()\n\t\t}),\n\t\tmetadata: { openapi: {\n\t\t\tdescription: \"Create a new API key for a user\",\n\t\t\tresponses: { \"200\": {\n\t\t\t\tdescription: \"API key created successfully\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"Unique identifier of the API key\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tdescription: \"Creation timestamp\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tdescription: \"Last update timestamp\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Name of the API key\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tprefix: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Prefix of the API key\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstart: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Starting characters of the key (if configured)\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tkey: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"The full API key (only returned on creation)\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tenabled: {\n\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\tdescription: \"Whether the key is enabled\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\texpiresAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Expiration timestamp\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"ID of the user owning the key\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlastRefillAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Last refill timestamp\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlastRequest: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Last request timestamp\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\tdescription: \"Metadata associated with the key\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trateLimitMax: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Maximum requests in time window\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trateLimitTimeWindow: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Rate limit time window in milliseconds\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tremaining: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Remaining requests\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trefillAmount: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Amount to refill\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trefillInterval: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Refill interval in milliseconds\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trateLimitEnabled: {\n\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\tdescription: \"Whether rate limiting is enabled\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequestCount: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tdescription: \"Current request count in window\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tadditionalProperties: {\n\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\titems: { type: \"string\" }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdescription: \"Permissions associated with the key\"\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\trequired: [\n\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\"updatedAt\",\n\t\t\t\t\t\t\"key\",\n\t\t\t\t\t\t\"enabled\",\n\t\t\t\t\t\t\"userId\",\n\t\t\t\t\t\t\"rateLimitEnabled\",\n\t\t\t\t\t\t\"requestCount\"\n\t\t\t\t\t]\n\t\t\t\t} } }\n\t\t\t} }\n\t\t} }\n\t}, async (ctx) => {\n\t\tconst { name, expiresIn, prefix, remaining, metadata, refillAmount, refillInterval, permissions, rateLimitMax, rateLimitTimeWindow, rateLimitEnabled } = ctx.body;\n\t\tconst session = await getSessionFromCtx(ctx);\n\t\tconst authRequired = ctx.request || ctx.headers;\n\t\tconst user = authRequired && !session ? null : session?.user || { id: ctx.body.userId };\n\t\tif (!user?.id) throw new APIError$1(\"UNAUTHORIZED\", { message: ERROR_CODES.UNAUTHORIZED_SESSION });\n\t\tif (session && ctx.body.userId && session?.user.id !== ctx.body.userId) throw new APIError$1(\"UNAUTHORIZED\", { message: ERROR_CODES.UNAUTHORIZED_SESSION });\n\t\tif (authRequired) {\n\t\t\tif (refillAmount !== void 0 || refillInterval !== void 0 || rateLimitMax !== void 0 || rateLimitTimeWindow !== void 0 || rateLimitEnabled !== void 0 || permissions !== void 0 || remaining !== null) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.SERVER_ONLY_PROPERTY });\n\t\t}\n\t\tif (metadata) {\n\t\t\tif (opts.enableMetadata === false) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.METADATA_DISABLED });\n\t\t\tif (typeof metadata !== \"object\") throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_METADATA_TYPE });\n\t\t}\n\t\tif (refillAmount && !refillInterval) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.REFILL_AMOUNT_AND_INTERVAL_REQUIRED });\n\t\tif (refillInterval && !refillAmount) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.REFILL_INTERVAL_AND_AMOUNT_REQUIRED });\n\t\tif (expiresIn) {\n\t\t\tif (opts.keyExpiration.disableCustomExpiresTime === true) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.KEY_DISABLED_EXPIRATION });\n\t\t\tconst expiresIn_in_days = expiresIn / (3600 * 24);\n\t\t\tif (opts.keyExpiration.minExpiresIn > expiresIn_in_days) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.EXPIRES_IN_IS_TOO_SMALL });\n\t\t\telse if (opts.keyExpiration.maxExpiresIn < expiresIn_in_days) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.EXPIRES_IN_IS_TOO_LARGE });\n\t\t}\n\t\tif (prefix) {\n\t\t\tif (prefix.length < opts.minimumPrefixLength) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_PREFIX_LENGTH });\n\t\t\tif (prefix.length > opts.maximumPrefixLength) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_PREFIX_LENGTH });\n\t\t}\n\t\tif (name) {\n\t\t\tif (name.length < opts.minimumNameLength) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_NAME_LENGTH });\n\t\t\tif (name.length > opts.maximumNameLength) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_NAME_LENGTH });\n\t\t} else if (opts.requireName) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.NAME_REQUIRED });\n\t\tdeleteAllExpiredApiKeys$1(ctx.context);\n\t\tconst key = await keyGenerator({\n\t\t\tlength: opts.defaultKeyLength,\n\t\t\tprefix: prefix || opts.defaultPrefix\n\t\t});\n\t\tconst hashed = opts.disableKeyHashing ? key : await defaultKeyHasher(key);\n\t\tlet start = null;\n\t\tif (opts.startingCharactersConfig.shouldStore) start = key.substring(0, opts.startingCharactersConfig.charactersLength);\n\t\tconst defaultPermissions = opts.permissions?.defaultPermissions ? typeof opts.permissions.defaultPermissions === \"function\" ? await opts.permissions.defaultPermissions(user.id, ctx) : opts.permissions.defaultPermissions : void 0;\n\t\tconst permissionsToApply = permissions ? JSON.stringify(permissions) : defaultPermissions ? JSON.stringify(defaultPermissions) : void 0;\n\t\tlet data = {\n\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\tupdatedAt: /* @__PURE__ */ new Date(),\n\t\t\tname: name ?? null,\n\t\t\tprefix: prefix ?? opts.defaultPrefix ?? null,\n\t\t\tstart,\n\t\t\tkey: hashed,\n\t\t\tenabled: true,\n\t\t\texpiresAt: expiresIn ? getDate(expiresIn, \"sec\") : opts.keyExpiration.defaultExpiresIn ? getDate(opts.keyExpiration.defaultExpiresIn, \"sec\") : null,\n\t\t\tuserId: user.id,\n\t\t\tlastRefillAt: null,\n\t\t\tlastRequest: null,\n\t\t\tmetadata: null,\n\t\t\trateLimitMax: rateLimitMax ?? opts.rateLimit.maxRequests ?? null,\n\t\t\trateLimitTimeWindow: rateLimitTimeWindow ?? opts.rateLimit.timeWindow ?? null,\n\t\t\tremaining: remaining === null ? remaining : remaining ?? refillAmount ?? null,\n\t\t\trefillAmount: refillAmount ?? null,\n\t\t\trefillInterval: refillInterval ?? null,\n\t\t\trateLimitEnabled: rateLimitEnabled === void 0 ? opts.rateLimit.enabled ?? true : rateLimitEnabled,\n\t\t\trequestCount: 0,\n\t\t\tpermissions: permissionsToApply\n\t\t};\n\t\tif (metadata) data.metadata = schema$1.apikey.fields.metadata.transform.input(metadata);\n\t\tlet apiKey$1;\n\t\tif (opts.storage === \"secondary-storage\" && opts.fallbackToDatabase) {\n\t\t\tapiKey$1 = await ctx.context.adapter.create({\n\t\t\t\tmodel: API_KEY_TABLE_NAME,\n\t\t\t\tdata\n\t\t\t});\n\t\t\tawait setApiKey(ctx, apiKey$1, opts);\n\t\t} else if (opts.storage === \"secondary-storage\") {\n\t\t\tconst id = ctx.context.generateId({ model: API_KEY_TABLE_NAME }) ?? generateId();\n\t\t\tapiKey$1 = {\n\t\t\t\t...data,\n\t\t\t\tid\n\t\t\t};\n\t\t\tawait setApiKey(ctx, apiKey$1, opts);\n\t\t} else apiKey$1 = await ctx.context.adapter.create({\n\t\t\tmodel: API_KEY_TABLE_NAME,\n\t\t\tdata\n\t\t});\n\t\treturn ctx.json({\n\t\t\t...apiKey$1,\n\t\t\tkey,\n\t\t\tmetadata: metadata ?? null,\n\t\t\tpermissions: apiKey$1.permissions ? safeJSONParse(apiKey$1.permissions) : null\n\t\t});\n\t});\n}\n\n//#endregion\n//#region src/plugins/api-key/routes/delete-all-expired-api-keys.ts\nfunction deleteAllExpiredApiKeysEndpoint({ deleteAllExpiredApiKeys: deleteAllExpiredApiKeys$1 }) {\n\treturn createAuthEndpoint(\"/api-key/delete-all-expired-api-keys\", {\n\t\tmethod: \"POST\",\n\t\tmetadata: { SERVER_ONLY: true }\n\t}, async (ctx) => {\n\t\ttry {\n\t\t\tawait deleteAllExpiredApiKeys$1(ctx.context, true);\n\t\t} catch (error) {\n\t\t\tctx.context.logger.error(\"[API KEY PLUGIN] Failed to delete expired API keys:\", error);\n\t\t\treturn ctx.json({\n\t\t\t\tsuccess: false,\n\t\t\t\terror\n\t\t\t});\n\t\t}\n\t\treturn ctx.json({\n\t\t\tsuccess: true,\n\t\t\terror: null\n\t\t});\n\t});\n}\n\n//#endregion\n//#region src/plugins/api-key/routes/delete-api-key.ts\nfunction deleteApiKey({ opts, schema: schema$1, deleteAllExpiredApiKeys: deleteAllExpiredApiKeys$1 }) {\n\treturn createAuthEndpoint(\"/api-key/delete\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({ keyId: z.string().meta({ description: \"The id of the Api Key\" }) }),\n\t\tuse: [sessionMiddleware],\n\t\tmetadata: { openapi: {\n\t\t\tdescription: \"Delete an existing API key\",\n\t\t\trequestBody: { content: { \"application/json\": { schema: {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties: { keyId: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\tdescription: \"The id of the API key to delete\"\n\t\t\t\t} },\n\t\t\t\trequired: [\"keyId\"]\n\t\t\t} } } },\n\t\t\tresponses: { \"200\": {\n\t\t\t\tdescription: \"API key deleted successfully\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: { success: {\n\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\tdescription: \"Indicates if the API key was successfully deleted\"\n\t\t\t\t\t} },\n\t\t\t\t\trequired: [\"success\"]\n\t\t\t\t} } }\n\t\t\t} }\n\t\t} }\n\t}, async (ctx) => {\n\t\tconst { keyId } = ctx.body;\n\t\tconst session = ctx.context.session;\n\t\tif (session.user.banned === true) throw new APIError$1(\"UNAUTHORIZED\", { message: ERROR_CODES.USER_BANNED });\n\t\tlet apiKey$1 = null;\n\t\tapiKey$1 = await getApiKeyById(ctx, keyId, opts);\n\t\tif (!apiKey$1 || apiKey$1.userId !== session.user.id) throw new APIError$1(\"NOT_FOUND\", { message: ERROR_CODES.KEY_NOT_FOUND });\n\t\ttry {\n\t\t\tif (opts.storage === \"secondary-storage\" && opts.fallbackToDatabase) {\n\t\t\t\tawait deleteApiKey$1(ctx, apiKey$1, opts);\n\t\t\t\tawait ctx.context.adapter.delete({\n\t\t\t\t\tmodel: API_KEY_TABLE_NAME,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: apiKey$1.id\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t} else if (opts.storage === \"database\") await ctx.context.adapter.delete({\n\t\t\t\tmodel: API_KEY_TABLE_NAME,\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: apiKey$1.id\n\t\t\t\t}]\n\t\t\t});\n\t\t\telse await deleteApiKey$1(ctx, apiKey$1, opts);\n\t\t} catch (error) {\n\t\t\tthrow new APIError$1(\"INTERNAL_SERVER_ERROR\", { message: error?.message });\n\t\t}\n\t\tdeleteAllExpiredApiKeys$1(ctx.context);\n\t\treturn ctx.json({ success: true });\n\t});\n}\n\n//#endregion\n//#region src/plugins/api-key/routes/get-api-key.ts\nfunction getApiKey({ opts, schema: schema$1, deleteAllExpiredApiKeys: deleteAllExpiredApiKeys$1 }) {\n\treturn createAuthEndpoint(\"/api-key/get\", {\n\t\tmethod: \"GET\",\n\t\tquery: z.object({ id: z.string().meta({ description: \"The id of the Api Key\" }) }),\n\t\tuse: [sessionMiddleware],\n\t\tmetadata: { openapi: {\n\t\t\tdescription: \"Retrieve an existing API key by ID\",\n\t\t\tresponses: { \"200\": {\n\t\t\t\tdescription: \"API key retrieved successfully\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"ID\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The name of the key\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstart: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Shows the first few characters of the API key, including the prefix. This allows you to show those few characters in the UI to make it easier for users to identify the API key.\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tprefix: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The API Key prefix. Stored as plain text.\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"The owner of the user id\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trefillInterval: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The interval in milliseconds between refills of the `remaining` count. Example: 3600000 // refill every hour (3600000ms = 1h)\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trefillAmount: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The amount to refill\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlastRefillAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The last refill date\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tenabled: {\n\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\tdescription: \"Sets if key is enabled or disabled\",\n\t\t\t\t\t\t\tdefault: true\n\t\t\t\t\t\t},\n\t\t\t\t\t\trateLimitEnabled: {\n\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\tdescription: \"Whether the key has rate limiting enabled\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trateLimitTimeWindow: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The duration in milliseconds\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trateLimitMax: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Maximum amount of requests allowed within a window\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequestCount: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tdescription: \"The number of requests made within the rate limit time window\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tremaining: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Remaining requests (every time api key is used this should updated and should be updated on refill as well)\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlastRequest: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"When last request occurred\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\texpiresAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Expiry date of a key\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tdescription: \"created at\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tdescription: \"updated at\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\tdescription: \"Extra metadata about the apiKey\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Permissions for the api key (stored as JSON string)\"\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\trequired: [\n\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\"userId\",\n\t\t\t\t\t\t\"enabled\",\n\t\t\t\t\t\t\"rateLimitEnabled\",\n\t\t\t\t\t\t\"requestCount\",\n\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t]\n\t\t\t\t} } }\n\t\t\t} }\n\t\t} }\n\t}, async (ctx) => {\n\t\tconst { id } = ctx.query;\n\t\tconst session = ctx.context.session;\n\t\tlet apiKey$1 = null;\n\t\tapiKey$1 = await getApiKeyById(ctx, id, opts);\n\t\tif (apiKey$1 && apiKey$1.userId !== session.user.id) apiKey$1 = null;\n\t\tif (!apiKey$1) throw new APIError$1(\"NOT_FOUND\", { message: ERROR_CODES.KEY_NOT_FOUND });\n\t\tdeleteAllExpiredApiKeys$1(ctx.context);\n\t\tapiKey$1.metadata = schema$1.apikey.fields.metadata.transform.output(apiKey$1.metadata);\n\t\tconst { key, ...returningApiKey } = apiKey$1;\n\t\treturn ctx.json({\n\t\t\t...returningApiKey,\n\t\t\tpermissions: returningApiKey.permissions ? safeJSONParse(returningApiKey.permissions) : null\n\t\t});\n\t});\n}\n\n//#endregion\n//#region src/plugins/api-key/routes/list-api-keys.ts\nfunction listApiKeys({ opts, schema: schema$1, deleteAllExpiredApiKeys: deleteAllExpiredApiKeys$1 }) {\n\treturn createAuthEndpoint(\"/api-key/list\", {\n\t\tmethod: \"GET\",\n\t\tuse: [sessionMiddleware],\n\t\tmetadata: { openapi: {\n\t\t\tdescription: \"List all API keys for the authenticated user\",\n\t\t\tresponses: { \"200\": {\n\t\t\t\tdescription: \"API keys retrieved successfully\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"array\",\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tdescription: \"ID\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"The name of the key\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tstart: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"Shows the first few characters of the API key, including the prefix. This allows you to show those few characters in the UI to make it easier for users to identify the API key.\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tprefix: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"The API Key prefix. Stored as plain text.\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tdescription: \"The owner of the user id\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trefillInterval: {\n\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"The interval in milliseconds between refills of the `remaining` count. Example: 3600000 // refill every hour (3600000ms = 1h)\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trefillAmount: {\n\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"The amount to refill\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tlastRefillAt: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"The last refill date\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tenabled: {\n\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\tdescription: \"Sets if key is enabled or disabled\",\n\t\t\t\t\t\t\t\tdefault: true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trateLimitEnabled: {\n\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\tdescription: \"Whether the key has rate limiting enabled\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trateLimitTimeWindow: {\n\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"The duration in milliseconds\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trateLimitMax: {\n\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"Maximum amount of requests allowed within a window\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequestCount: {\n\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\tdescription: \"The number of requests made within the rate limit time window\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tremaining: {\n\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"Remaining requests (every time api key is used this should updated and should be updated on refill as well)\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tlastRequest: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"When last request occurred\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\texpiresAt: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"Expiry date of a key\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\tdescription: \"created at\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\tdescription: \"updated at\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\t\tdescription: \"Extra metadata about the apiKey\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\tdescription: \"Permissions for the api key (stored as JSON string)\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\"userId\",\n\t\t\t\t\t\t\t\"enabled\",\n\t\t\t\t\t\t\t\"rateLimitEnabled\",\n\t\t\t\t\t\t\t\"requestCount\",\n\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t} } }\n\t\t\t} }\n\t\t} }\n\t}, async (ctx) => {\n\t\tconst session = ctx.context.session;\n\t\tlet apiKeys;\n\t\tapiKeys = await listApiKeys$1(ctx, session.user.id, opts);\n\t\tdeleteAllExpiredApiKeys$1(ctx.context);\n\t\tapiKeys = apiKeys.map((apiKey$1) => {\n\t\t\treturn {\n\t\t\t\t...apiKey$1,\n\t\t\t\tmetadata: schema$1.apikey.fields.metadata.transform.output(apiKey$1.metadata)\n\t\t\t};\n\t\t});\n\t\tlet returningApiKey = apiKeys.map((x) => {\n\t\t\tconst { key, ...returningApiKey$1 } = x;\n\t\t\treturn {\n\t\t\t\t...returningApiKey$1,\n\t\t\t\tpermissions: returningApiKey$1.permissions ? safeJSONParse(returningApiKey$1.permissions) : null\n\t\t\t};\n\t\t});\n\t\treturn ctx.json(returningApiKey);\n\t});\n}\n\n//#endregion\n//#region src/plugins/api-key/routes/update-api-key.ts\nfunction updateApiKey({ opts, schema: schema$1, deleteAllExpiredApiKeys: deleteAllExpiredApiKeys$1 }) {\n\treturn createAuthEndpoint(\"/api-key/update\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({\n\t\t\tkeyId: z.string().meta({ description: \"The id of the Api Key\" }),\n\t\t\tuserId: z.coerce.string().meta({ description: \"The id of the user which the api key belongs to. server-only. Eg: \\\"some-user-id\\\"\" }).optional(),\n\t\t\tname: z.string().meta({ description: \"The name of the key\" }).optional(),\n\t\t\tenabled: z.boolean().meta({ description: \"Whether the Api Key is enabled or not\" }).optional(),\n\t\t\tremaining: z.number().meta({ description: \"The number of remaining requests\" }).min(1).optional(),\n\t\t\trefillAmount: z.number().meta({ description: \"The refill amount\" }).optional(),\n\t\t\trefillInterval: z.number().meta({ description: \"The refill interval\" }).optional(),\n\t\t\tmetadata: z.any().optional(),\n\t\t\texpiresIn: z.number().meta({ description: \"Expiration time of the Api Key in seconds\" }).min(1).optional().nullable(),\n\t\t\trateLimitEnabled: z.boolean().meta({ description: \"Whether the key has rate limiting enabled.\" }).optional(),\n\t\t\trateLimitTimeWindow: z.number().meta({ description: \"The duration in milliseconds where each request is counted. server-only. Eg: 1000\" }).optional(),\n\t\t\trateLimitMax: z.number().meta({ description: \"Maximum amount of requests allowed within a window. Once the `maxRequests` is reached, the request will be rejected until the `timeWindow` has passed, at which point the `timeWindow` will be reset. server-only. Eg: 100\" }).optional(),\n\t\t\tpermissions: z.record(z.string(), z.array(z.string())).meta({ description: \"Update the permissions on the API Key. server-only.\" }).optional().nullable()\n\t\t}),\n\t\tmetadata: { openapi: {\n\t\t\tdescription: \"Update an existing API key by ID\",\n\t\t\tresponses: { \"200\": {\n\t\t\t\tdescription: \"API key updated successfully\",\n\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"ID\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The name of the key\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstart: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Shows the first few characters of the API key, including the prefix. This allows you to show those few characters in the UI to make it easier for users to identify the API key.\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tprefix: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The API Key prefix. Stored as plain text.\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tdescription: \"The owner of the user id\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trefillInterval: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The interval in milliseconds between refills of the `remaining` count. Example: 3600000 // refill every hour (3600000ms = 1h)\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trefillAmount: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The amount to refill\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlastRefillAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The last refill date\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tenabled: {\n\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\tdescription: \"Sets if key is enabled or disabled\",\n\t\t\t\t\t\t\tdefault: true\n\t\t\t\t\t\t},\n\t\t\t\t\t\trateLimitEnabled: {\n\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\tdescription: \"Whether the key has rate limiting enabled\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trateLimitTimeWindow: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"The duration in milliseconds\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trateLimitMax: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Maximum amount of requests allowed within a window\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequestCount: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tdescription: \"The number of requests made within the rate limit time window\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tremaining: {\n\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Remaining requests (every time api key is used this should updated and should be updated on refill as well)\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlastRequest: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"When last request occurred\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\texpiresAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Expiry date of a key\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tdescription: \"created at\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\tdescription: \"updated at\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\tdescription: \"Extra metadata about the apiKey\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\tdescription: \"Permissions for the api key (stored as JSON string)\"\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\trequired: [\n\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\"userId\",\n\t\t\t\t\t\t\"enabled\",\n\t\t\t\t\t\t\"rateLimitEnabled\",\n\t\t\t\t\t\t\"requestCount\",\n\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t]\n\t\t\t\t} } }\n\t\t\t} }\n\t\t} }\n\t}, async (ctx) => {\n\t\tconst { keyId, expiresIn, enabled, metadata, refillAmount, refillInterval, remaining, name, permissions, rateLimitEnabled, rateLimitTimeWindow, rateLimitMax } = ctx.body;\n\t\tconst session = await getSessionFromCtx(ctx);\n\t\tconst authRequired = ctx.request || ctx.headers;\n\t\tconst user = authRequired && !session ? null : session?.user || { id: ctx.body.userId };\n\t\tif (!user?.id) throw new APIError$1(\"UNAUTHORIZED\", { message: ERROR_CODES.UNAUTHORIZED_SESSION });\n\t\tif (session && ctx.body.userId && session?.user.id !== ctx.body.userId) throw new APIError$1(\"UNAUTHORIZED\", { message: ERROR_CODES.UNAUTHORIZED_SESSION });\n\t\tif (authRequired) {\n\t\t\tif (refillAmount !== void 0 || refillInterval !== void 0 || rateLimitMax !== void 0 || rateLimitTimeWindow !== void 0 || rateLimitEnabled !== void 0 || remaining !== void 0 || permissions !== void 0) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.SERVER_ONLY_PROPERTY });\n\t\t}\n\t\tlet apiKey$1 = null;\n\t\tapiKey$1 = await getApiKeyById(ctx, keyId, opts);\n\t\tif (apiKey$1 && apiKey$1.userId !== user.id) apiKey$1 = null;\n\t\tif (!apiKey$1) throw new APIError$1(\"NOT_FOUND\", { message: ERROR_CODES.KEY_NOT_FOUND });\n\t\tlet newValues = {};\n\t\tif (name !== void 0) {\n\t\t\tif (name.length < opts.minimumNameLength) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_NAME_LENGTH });\n\t\t\telse if (name.length > opts.maximumNameLength) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_NAME_LENGTH });\n\t\t\tnewValues.name = name;\n\t\t}\n\t\tif (enabled !== void 0) newValues.enabled = enabled;\n\t\tif (expiresIn !== void 0) {\n\t\t\tif (opts.keyExpiration.disableCustomExpiresTime === true) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.KEY_DISABLED_EXPIRATION });\n\t\t\tif (expiresIn !== null) {\n\t\t\t\tconst expiresIn_in_days = expiresIn / (3600 * 24);\n\t\t\t\tif (expiresIn_in_days < opts.keyExpiration.minExpiresIn) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.EXPIRES_IN_IS_TOO_SMALL });\n\t\t\t\telse if (expiresIn_in_days > opts.keyExpiration.maxExpiresIn) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.EXPIRES_IN_IS_TOO_LARGE });\n\t\t\t}\n\t\t\tnewValues.expiresAt = expiresIn ? getDate(expiresIn, \"sec\") : null;\n\t\t}\n\t\tif (metadata !== void 0) {\n\t\t\tif (typeof metadata !== \"object\") throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_METADATA_TYPE });\n\t\t\tnewValues.metadata = schema$1.apikey.fields.metadata.transform.input(metadata);\n\t\t}\n\t\tif (remaining !== void 0) newValues.remaining = remaining;\n\t\tif (refillAmount !== void 0 || refillInterval !== void 0) {\n\t\t\tif (refillAmount !== void 0 && refillInterval === void 0) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.REFILL_AMOUNT_AND_INTERVAL_REQUIRED });\n\t\t\telse if (refillInterval !== void 0 && refillAmount === void 0) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.REFILL_INTERVAL_AND_AMOUNT_REQUIRED });\n\t\t\tnewValues.refillAmount = refillAmount;\n\t\t\tnewValues.refillInterval = refillInterval;\n\t\t}\n\t\tif (rateLimitEnabled !== void 0) newValues.rateLimitEnabled = rateLimitEnabled;\n\t\tif (rateLimitTimeWindow !== void 0) newValues.rateLimitTimeWindow = rateLimitTimeWindow;\n\t\tif (rateLimitMax !== void 0) newValues.rateLimitMax = rateLimitMax;\n\t\tif (permissions !== void 0) newValues.permissions = JSON.stringify(permissions);\n\t\tif (Object.keys(newValues).length === 0) throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.NO_VALUES_TO_UPDATE });\n\t\tlet newApiKey = apiKey$1;\n\t\ttry {\n\t\t\tif (opts.storage === \"secondary-storage\" && opts.fallbackToDatabase) {\n\t\t\t\tconst dbUpdated = await ctx.context.adapter.update({\n\t\t\t\t\tmodel: API_KEY_TABLE_NAME,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: apiKey$1.id\n\t\t\t\t\t}],\n\t\t\t\t\tupdate: newValues\n\t\t\t\t});\n\t\t\t\tif (dbUpdated) {\n\t\t\t\t\tawait setApiKey(ctx, dbUpdated, opts);\n\t\t\t\t\tnewApiKey = dbUpdated;\n\t\t\t\t}\n\t\t\t} else if (opts.storage === \"database\") {\n\t\t\t\tconst result = await ctx.context.adapter.update({\n\t\t\t\t\tmodel: API_KEY_TABLE_NAME,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: apiKey$1.id\n\t\t\t\t\t}],\n\t\t\t\t\tupdate: newValues\n\t\t\t\t});\n\t\t\t\tif (result) newApiKey = result;\n\t\t\t} else {\n\t\t\t\tconst updated = {\n\t\t\t\t\t...apiKey$1,\n\t\t\t\t\t...newValues,\n\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t};\n\t\t\t\tawait setApiKey(ctx, updated, opts);\n\t\t\t\tnewApiKey = updated;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthrow new APIError$1(\"INTERNAL_SERVER_ERROR\", { message: error?.message });\n\t\t}\n\t\tdeleteAllExpiredApiKeys$1(ctx.context);\n\t\tnewApiKey.metadata = schema$1.apikey.fields.metadata.transform.output(newApiKey.metadata);\n\t\tconst { key, ...returningApiKey } = newApiKey;\n\t\treturn ctx.json({\n\t\t\t...returningApiKey,\n\t\t\tpermissions: returningApiKey.permissions ? safeJSONParse(returningApiKey.permissions) : null\n\t\t});\n\t});\n}\n\n//#endregion\n//#region src/plugins/api-key/rate-limit.ts\n/**\n* Determines if a request is allowed based on rate limiting parameters.\n*\n* @returns An object indicating whether the request is allowed and, if not,\n*          a message and updated ApiKey data.\n*/\nfunction isRateLimited(apiKey$1, opts) {\n\tconst now = /* @__PURE__ */ new Date();\n\tconst lastRequest = apiKey$1.lastRequest;\n\tconst rateLimitTimeWindow = apiKey$1.rateLimitTimeWindow;\n\tconst rateLimitMax = apiKey$1.rateLimitMax;\n\tlet requestCount = apiKey$1.requestCount;\n\tif (opts.rateLimit.enabled === false) return {\n\t\tsuccess: true,\n\t\tmessage: null,\n\t\tupdate: { lastRequest: now },\n\t\ttryAgainIn: null\n\t};\n\tif (apiKey$1.rateLimitEnabled === false) return {\n\t\tsuccess: true,\n\t\tmessage: null,\n\t\tupdate: { lastRequest: now },\n\t\ttryAgainIn: null\n\t};\n\tif (rateLimitTimeWindow === null || rateLimitMax === null) return {\n\t\tsuccess: true,\n\t\tmessage: null,\n\t\tupdate: null,\n\t\ttryAgainIn: null\n\t};\n\tif (lastRequest === null) return {\n\t\tsuccess: true,\n\t\tmessage: null,\n\t\tupdate: {\n\t\t\tlastRequest: now,\n\t\t\trequestCount: 1\n\t\t},\n\t\ttryAgainIn: null\n\t};\n\tconst timeSinceLastRequest = now.getTime() - new Date(lastRequest).getTime();\n\tif (timeSinceLastRequest > rateLimitTimeWindow) return {\n\t\tsuccess: true,\n\t\tmessage: null,\n\t\tupdate: {\n\t\t\tlastRequest: now,\n\t\t\trequestCount: 1\n\t\t},\n\t\ttryAgainIn: null\n\t};\n\tif (requestCount >= rateLimitMax) return {\n\t\tsuccess: false,\n\t\tmessage: ERROR_CODES.RATE_LIMIT_EXCEEDED,\n\t\tupdate: null,\n\t\ttryAgainIn: Math.ceil(rateLimitTimeWindow - timeSinceLastRequest)\n\t};\n\trequestCount++;\n\treturn {\n\t\tsuccess: true,\n\t\tmessage: null,\n\t\ttryAgainIn: null,\n\t\tupdate: {\n\t\t\tlastRequest: now,\n\t\t\trequestCount\n\t\t}\n\t};\n}\n\n//#endregion\n//#region src/plugins/api-key/routes/verify-api-key.ts\nasync function validateApiKey({ hashedKey, ctx, opts, schema: schema$1, permissions }) {\n\tconst apiKey$1 = await getApiKey$1(ctx, hashedKey, opts);\n\tif (!apiKey$1) throw new APIError$1(\"UNAUTHORIZED\", { message: ERROR_CODES.INVALID_API_KEY });\n\tif (apiKey$1.enabled === false) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\tmessage: ERROR_CODES.KEY_DISABLED,\n\t\tcode: \"KEY_DISABLED\"\n\t});\n\tif (apiKey$1.expiresAt) {\n\t\tif (Date.now() > new Date(apiKey$1.expiresAt).getTime()) {\n\t\t\ttry {\n\t\t\t\tif (opts.storage === \"secondary-storage\" && opts.fallbackToDatabase) {\n\t\t\t\t\tawait deleteApiKey$1(ctx, apiKey$1, opts);\n\t\t\t\t\tawait ctx.context.adapter.delete({\n\t\t\t\t\t\tmodel: API_KEY_TABLE_NAME,\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\tvalue: apiKey$1.id\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t} else if (opts.storage === \"secondary-storage\") await deleteApiKey$1(ctx, apiKey$1, opts);\n\t\t\t\telse await ctx.context.adapter.delete({\n\t\t\t\t\tmodel: API_KEY_TABLE_NAME,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: apiKey$1.id\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\tctx.context.logger.error(`Failed to delete expired API keys:`, error);\n\t\t\t}\n\t\t\tthrow new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\tmessage: ERROR_CODES.KEY_EXPIRED,\n\t\t\t\tcode: \"KEY_EXPIRED\"\n\t\t\t});\n\t\t}\n\t}\n\tif (permissions) {\n\t\tconst apiKeyPermissions = apiKey$1.permissions ? safeJSONParse(apiKey$1.permissions) : null;\n\t\tif (!apiKeyPermissions) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\tmessage: ERROR_CODES.KEY_NOT_FOUND,\n\t\t\tcode: \"KEY_NOT_FOUND\"\n\t\t});\n\t\tif (!role(apiKeyPermissions).authorize(permissions).success) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\tmessage: ERROR_CODES.KEY_NOT_FOUND,\n\t\t\tcode: \"KEY_NOT_FOUND\"\n\t\t});\n\t}\n\tlet remaining = apiKey$1.remaining;\n\tlet lastRefillAt = apiKey$1.lastRefillAt;\n\tif (apiKey$1.remaining === 0 && apiKey$1.refillAmount === null) {\n\t\ttry {\n\t\t\tif (opts.storage === \"secondary-storage\") await deleteApiKey$1(ctx, apiKey$1, opts);\n\t\t\telse await ctx.context.adapter.delete({\n\t\t\t\tmodel: API_KEY_TABLE_NAME,\n\t\t\t\twhere: [{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: apiKey$1.id\n\t\t\t\t}]\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tctx.context.logger.error(`Failed to delete expired API keys:`, error);\n\t\t}\n\t\tthrow new APIError$1(\"TOO_MANY_REQUESTS\", {\n\t\t\tmessage: ERROR_CODES.USAGE_EXCEEDED,\n\t\t\tcode: \"USAGE_EXCEEDED\"\n\t\t});\n\t} else if (remaining !== null) {\n\t\tlet now = Date.now();\n\t\tconst refillInterval = apiKey$1.refillInterval;\n\t\tconst refillAmount = apiKey$1.refillAmount;\n\t\tlet lastTime = new Date(lastRefillAt ?? apiKey$1.createdAt).getTime();\n\t\tif (refillInterval && refillAmount) {\n\t\t\tif (now - lastTime > refillInterval) {\n\t\t\t\tremaining = refillAmount;\n\t\t\t\tlastRefillAt = /* @__PURE__ */ new Date();\n\t\t\t}\n\t\t}\n\t\tif (remaining === 0) throw new APIError$1(\"TOO_MANY_REQUESTS\", {\n\t\t\tmessage: ERROR_CODES.USAGE_EXCEEDED,\n\t\t\tcode: \"USAGE_EXCEEDED\"\n\t\t});\n\t\telse remaining--;\n\t}\n\tconst { message, success, update, tryAgainIn } = isRateLimited(apiKey$1, opts);\n\tlet newApiKey = null;\n\tconst updated = {\n\t\t...apiKey$1,\n\t\t...update,\n\t\tremaining,\n\t\tlastRefillAt,\n\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t};\n\tif (opts.storage === \"database\") newApiKey = await ctx.context.adapter.update({\n\t\tmodel: API_KEY_TABLE_NAME,\n\t\twhere: [{\n\t\t\tfield: \"id\",\n\t\t\tvalue: apiKey$1.id\n\t\t}],\n\t\tupdate: updated\n\t});\n\telse {\n\t\tawait setApiKey(ctx, updated, opts);\n\t\tnewApiKey = updated;\n\t}\n\tif (!newApiKey) throw new APIError$1(\"INTERNAL_SERVER_ERROR\", {\n\t\tmessage: ERROR_CODES.FAILED_TO_UPDATE_API_KEY,\n\t\tcode: \"INTERNAL_SERVER_ERROR\"\n\t});\n\tif (success === false) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\tmessage: message ?? void 0,\n\t\tcode: \"RATE_LIMITED\",\n\t\tdetails: { tryAgainIn }\n\t});\n\treturn newApiKey;\n}\nfunction verifyApiKey({ opts, schema: schema$1, deleteAllExpiredApiKeys: deleteAllExpiredApiKeys$1 }) {\n\treturn createAuthEndpoint(\"/api-key/verify\", {\n\t\tmethod: \"POST\",\n\t\tbody: z.object({\n\t\t\tkey: z.string().meta({ description: \"The key to verify\" }),\n\t\t\tpermissions: z.record(z.string(), z.array(z.string())).meta({ description: \"The permissions to verify.\" }).optional()\n\t\t}),\n\t\tmetadata: { SERVER_ONLY: true }\n\t}, async (ctx) => {\n\t\tconst { key } = ctx.body;\n\t\tif (key.length < opts.defaultKeyLength) return ctx.json({\n\t\t\tvalid: false,\n\t\t\terror: {\n\t\t\t\tmessage: ERROR_CODES.INVALID_API_KEY,\n\t\t\t\tcode: \"KEY_NOT_FOUND\"\n\t\t\t},\n\t\t\tkey: null\n\t\t});\n\t\tif (opts.customAPIKeyValidator) {\n\t\t\tif (!await opts.customAPIKeyValidator({\n\t\t\t\tctx,\n\t\t\t\tkey\n\t\t\t})) return ctx.json({\n\t\t\t\tvalid: false,\n\t\t\t\terror: {\n\t\t\t\t\tmessage: ERROR_CODES.INVALID_API_KEY,\n\t\t\t\t\tcode: \"KEY_NOT_FOUND\"\n\t\t\t\t},\n\t\t\t\tkey: null\n\t\t\t});\n\t\t}\n\t\tconst hashed = opts.disableKeyHashing ? key : await defaultKeyHasher(key);\n\t\tlet apiKey$1 = null;\n\t\ttry {\n\t\t\tapiKey$1 = await validateApiKey({\n\t\t\t\thashedKey: hashed,\n\t\t\t\tpermissions: ctx.body.permissions,\n\t\t\t\tctx,\n\t\t\t\topts,\n\t\t\t\tschema: schema$1\n\t\t\t});\n\t\t\tawait deleteAllExpiredApiKeys$1(ctx.context);\n\t\t} catch (error) {\n\t\t\tif (error instanceof APIError$1) return ctx.json({\n\t\t\t\tvalid: false,\n\t\t\t\terror: {\n\t\t\t\t\tmessage: error.body?.message,\n\t\t\t\t\tcode: error.body?.code\n\t\t\t\t},\n\t\t\t\tkey: null\n\t\t\t});\n\t\t\treturn ctx.json({\n\t\t\t\tvalid: false,\n\t\t\t\terror: {\n\t\t\t\t\tmessage: ERROR_CODES.INVALID_API_KEY,\n\t\t\t\t\tcode: \"INVALID_API_KEY\"\n\t\t\t\t},\n\t\t\t\tkey: null\n\t\t\t});\n\t\t}\n\t\tconst { key: _, ...returningApiKey } = apiKey$1 ?? {\n\t\t\tkey: 1,\n\t\t\tpermissions: void 0\n\t\t};\n\t\tif (\"metadata\" in returningApiKey) returningApiKey.metadata = schema$1.apikey.fields.metadata.transform.output(returningApiKey.metadata);\n\t\treturningApiKey.permissions = returningApiKey.permissions ? safeJSONParse(returningApiKey.permissions) : null;\n\t\treturn ctx.json({\n\t\t\tvalid: true,\n\t\t\terror: null,\n\t\t\tkey: apiKey$1 === null ? null : returningApiKey\n\t\t});\n\t});\n}\n\n//#endregion\n//#region src/plugins/api-key/routes/index.ts\nlet lastChecked = null;\nasync function deleteAllExpiredApiKeys(ctx, byPassLastCheckTime = false) {\n\tif (lastChecked && !byPassLastCheckTime) {\n\t\tif ((/* @__PURE__ */ new Date()).getTime() - lastChecked.getTime() < 1e4) return;\n\t}\n\tlastChecked = /* @__PURE__ */ new Date();\n\tawait ctx.adapter.deleteMany({\n\t\tmodel: API_KEY_TABLE_NAME,\n\t\twhere: [{\n\t\t\tfield: \"expiresAt\",\n\t\t\toperator: \"lt\",\n\t\t\tvalue: /* @__PURE__ */ new Date()\n\t\t}, {\n\t\t\tfield: \"expiresAt\",\n\t\t\toperator: \"ne\",\n\t\t\tvalue: null\n\t\t}]\n\t}).catch((error) => {\n\t\tctx.logger.error(`Failed to delete expired API keys:`, error);\n\t});\n}\nfunction createApiKeyRoutes({ keyGenerator, opts, schema: schema$1 }) {\n\treturn {\n\t\tcreateApiKey: createApiKey({\n\t\t\tkeyGenerator,\n\t\t\topts,\n\t\t\tschema: schema$1,\n\t\t\tdeleteAllExpiredApiKeys\n\t\t}),\n\t\tverifyApiKey: verifyApiKey({\n\t\t\topts,\n\t\t\tschema: schema$1,\n\t\t\tdeleteAllExpiredApiKeys\n\t\t}),\n\t\tgetApiKey: getApiKey({\n\t\t\topts,\n\t\t\tschema: schema$1,\n\t\t\tdeleteAllExpiredApiKeys\n\t\t}),\n\t\tupdateApiKey: updateApiKey({\n\t\t\topts,\n\t\t\tschema: schema$1,\n\t\t\tdeleteAllExpiredApiKeys\n\t\t}),\n\t\tdeleteApiKey: deleteApiKey({\n\t\t\topts,\n\t\t\tschema: schema$1,\n\t\t\tdeleteAllExpiredApiKeys\n\t\t}),\n\t\tlistApiKeys: listApiKeys({\n\t\t\topts,\n\t\t\tschema: schema$1,\n\t\t\tdeleteAllExpiredApiKeys\n\t\t}),\n\t\tdeleteAllExpiredApiKeys: deleteAllExpiredApiKeysEndpoint({ deleteAllExpiredApiKeys })\n\t};\n}\n\n//#endregion\n//#region src/plugins/api-key/schema.ts\nconst apiKeySchema = ({ timeWindow, rateLimitMax }) => ({ apikey: { fields: {\n\tname: {\n\t\ttype: \"string\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\tstart: {\n\t\ttype: \"string\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\tprefix: {\n\t\ttype: \"string\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\tkey: {\n\t\ttype: \"string\",\n\t\trequired: true,\n\t\tinput: false,\n\t\tindex: true\n\t},\n\tuserId: {\n\t\ttype: \"string\",\n\t\treferences: {\n\t\t\tmodel: \"user\",\n\t\t\tfield: \"id\",\n\t\t\tonDelete: \"cascade\"\n\t\t},\n\t\trequired: true,\n\t\tinput: false,\n\t\tindex: true\n\t},\n\trefillInterval: {\n\t\ttype: \"number\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\trefillAmount: {\n\t\ttype: \"number\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\tlastRefillAt: {\n\t\ttype: \"date\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\tenabled: {\n\t\ttype: \"boolean\",\n\t\trequired: false,\n\t\tinput: false,\n\t\tdefaultValue: true\n\t},\n\trateLimitEnabled: {\n\t\ttype: \"boolean\",\n\t\trequired: false,\n\t\tinput: false,\n\t\tdefaultValue: true\n\t},\n\trateLimitTimeWindow: {\n\t\ttype: \"number\",\n\t\trequired: false,\n\t\tinput: false,\n\t\tdefaultValue: timeWindow\n\t},\n\trateLimitMax: {\n\t\ttype: \"number\",\n\t\trequired: false,\n\t\tinput: false,\n\t\tdefaultValue: rateLimitMax\n\t},\n\trequestCount: {\n\t\ttype: \"number\",\n\t\trequired: false,\n\t\tinput: false,\n\t\tdefaultValue: 0\n\t},\n\tremaining: {\n\t\ttype: \"number\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\tlastRequest: {\n\t\ttype: \"date\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\texpiresAt: {\n\t\ttype: \"date\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\tcreatedAt: {\n\t\ttype: \"date\",\n\t\trequired: true,\n\t\tinput: false\n\t},\n\tupdatedAt: {\n\t\ttype: \"date\",\n\t\trequired: true,\n\t\tinput: false\n\t},\n\tpermissions: {\n\t\ttype: \"string\",\n\t\trequired: false,\n\t\tinput: false\n\t},\n\tmetadata: {\n\t\ttype: \"string\",\n\t\trequired: false,\n\t\tinput: true,\n\t\ttransform: {\n\t\t\tinput(value) {\n\t\t\t\treturn JSON.stringify(value);\n\t\t\t},\n\t\t\toutput(value) {\n\t\t\t\tif (!value) return null;\n\t\t\t\treturn parser_default(value);\n\t\t\t}\n\t\t}\n\t}\n} } });\n\n//#endregion\n//#region src/plugins/api-key/index.ts\nconst defaultKeyHasher = async (key) => {\n\tconst hash = await createHash(\"SHA-256\").digest(new TextEncoder().encode(key));\n\treturn base64Url.encode(new Uint8Array(hash), { padding: false });\n};\nconst ERROR_CODES = defineErrorCodes({\n\tINVALID_METADATA_TYPE: \"metadata must be an object or undefined\",\n\tREFILL_AMOUNT_AND_INTERVAL_REQUIRED: \"refillAmount is required when refillInterval is provided\",\n\tREFILL_INTERVAL_AND_AMOUNT_REQUIRED: \"refillInterval is required when refillAmount is provided\",\n\tUSER_BANNED: \"User is banned\",\n\tUNAUTHORIZED_SESSION: \"Unauthorized or invalid session\",\n\tKEY_NOT_FOUND: \"API Key not found\",\n\tKEY_DISABLED: \"API Key is disabled\",\n\tKEY_EXPIRED: \"API Key has expired\",\n\tUSAGE_EXCEEDED: \"API Key has reached its usage limit\",\n\tKEY_NOT_RECOVERABLE: \"API Key is not recoverable\",\n\tEXPIRES_IN_IS_TOO_SMALL: \"The expiresIn is smaller than the predefined minimum value.\",\n\tEXPIRES_IN_IS_TOO_LARGE: \"The expiresIn is larger than the predefined maximum value.\",\n\tINVALID_REMAINING: \"The remaining count is either too large or too small.\",\n\tINVALID_PREFIX_LENGTH: \"The prefix length is either too large or too small.\",\n\tINVALID_NAME_LENGTH: \"The name length is either too large or too small.\",\n\tMETADATA_DISABLED: \"Metadata is disabled.\",\n\tRATE_LIMIT_EXCEEDED: \"Rate limit exceeded.\",\n\tNO_VALUES_TO_UPDATE: \"No values to update.\",\n\tKEY_DISABLED_EXPIRATION: \"Custom key expiration values are disabled.\",\n\tINVALID_API_KEY: \"Invalid API key.\",\n\tINVALID_USER_ID_FROM_API_KEY: \"The user id from the API key is invalid.\",\n\tINVALID_API_KEY_GETTER_RETURN_TYPE: \"API Key getter returned an invalid key type. Expected string.\",\n\tSERVER_ONLY_PROPERTY: \"The property you're trying to set can only be set from the server auth instance only.\",\n\tFAILED_TO_UPDATE_API_KEY: \"Failed to update API key\",\n\tNAME_REQUIRED: \"API Key name is required.\"\n});\nconst API_KEY_TABLE_NAME = \"apikey\";\nconst apiKey = (options) => {\n\tconst opts = {\n\t\t...options,\n\t\tapiKeyHeaders: options?.apiKeyHeaders ?? \"x-api-key\",\n\t\tdefaultKeyLength: options?.defaultKeyLength || 64,\n\t\tmaximumPrefixLength: options?.maximumPrefixLength ?? 32,\n\t\tminimumPrefixLength: options?.minimumPrefixLength ?? 1,\n\t\tmaximumNameLength: options?.maximumNameLength ?? 32,\n\t\tminimumNameLength: options?.minimumNameLength ?? 1,\n\t\tenableMetadata: options?.enableMetadata ?? false,\n\t\tdisableKeyHashing: options?.disableKeyHashing ?? false,\n\t\trequireName: options?.requireName ?? false,\n\t\tstorage: options?.storage ?? \"database\",\n\t\trateLimit: {\n\t\t\tenabled: options?.rateLimit?.enabled === void 0 ? true : options?.rateLimit?.enabled,\n\t\t\ttimeWindow: options?.rateLimit?.timeWindow ?? 1e3 * 60 * 60 * 24,\n\t\t\tmaxRequests: options?.rateLimit?.maxRequests ?? 10\n\t\t},\n\t\tkeyExpiration: {\n\t\t\tdefaultExpiresIn: options?.keyExpiration?.defaultExpiresIn ?? null,\n\t\t\tdisableCustomExpiresTime: options?.keyExpiration?.disableCustomExpiresTime ?? false,\n\t\t\tmaxExpiresIn: options?.keyExpiration?.maxExpiresIn ?? 365,\n\t\t\tminExpiresIn: options?.keyExpiration?.minExpiresIn ?? 1\n\t\t},\n\t\tstartingCharactersConfig: {\n\t\t\tshouldStore: options?.startingCharactersConfig?.shouldStore ?? true,\n\t\t\tcharactersLength: options?.startingCharactersConfig?.charactersLength ?? 6\n\t\t},\n\t\tenableSessionForAPIKeys: options?.enableSessionForAPIKeys ?? false,\n\t\tfallbackToDatabase: options?.fallbackToDatabase ?? false,\n\t\tcustomStorage: options?.customStorage\n\t};\n\tconst schema$1 = mergeSchema(apiKeySchema({\n\t\trateLimitMax: opts.rateLimit.maxRequests,\n\t\ttimeWindow: opts.rateLimit.timeWindow\n\t}), opts.schema);\n\tconst getter = opts.customAPIKeyGetter || ((ctx) => {\n\t\tif (Array.isArray(opts.apiKeyHeaders)) for (const header of opts.apiKeyHeaders) {\n\t\t\tconst value = ctx.headers?.get(header);\n\t\t\tif (value) return value;\n\t\t}\n\t\telse return ctx.headers?.get(opts.apiKeyHeaders);\n\t});\n\tconst routes = createApiKeyRoutes({\n\t\tkeyGenerator: opts.customKeyGenerator || (async (options$1) => {\n\t\t\tconst key = generateRandomString(options$1.length, \"a-z\", \"A-Z\");\n\t\t\treturn `${options$1.prefix || \"\"}${key}`;\n\t\t}),\n\t\topts,\n\t\tschema: schema$1\n\t});\n\treturn {\n\t\tid: \"api-key\",\n\t\t$ERROR_CODES: ERROR_CODES,\n\t\thooks: { before: [{\n\t\t\tmatcher: (ctx) => !!getter(ctx) && opts.enableSessionForAPIKeys,\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst key = getter(ctx);\n\t\t\t\tif (typeof key !== \"string\") throw new APIError$1(\"BAD_REQUEST\", { message: ERROR_CODES.INVALID_API_KEY_GETTER_RETURN_TYPE });\n\t\t\t\tif (key.length < opts.defaultKeyLength) throw new APIError$1(\"FORBIDDEN\", { message: ERROR_CODES.INVALID_API_KEY });\n\t\t\t\tif (opts.customAPIKeyValidator) {\n\t\t\t\t\tif (!await opts.customAPIKeyValidator({\n\t\t\t\t\t\tctx,\n\t\t\t\t\t\tkey\n\t\t\t\t\t})) throw new APIError$1(\"FORBIDDEN\", { message: ERROR_CODES.INVALID_API_KEY });\n\t\t\t\t}\n\t\t\t\tconst apiKey$1 = await validateApiKey({\n\t\t\t\t\thashedKey: opts.disableKeyHashing ? key : await defaultKeyHasher(key),\n\t\t\t\t\tctx,\n\t\t\t\t\topts,\n\t\t\t\t\tschema: schema$1\n\t\t\t\t});\n\t\t\t\tdeleteAllExpiredApiKeys(ctx.context).catch((err) => {\n\t\t\t\t\tctx.context.logger.error(\"Failed to delete expired API keys:\", err);\n\t\t\t\t});\n\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(apiKey$1.userId);\n\t\t\t\tif (!user) throw new APIError$1(\"UNAUTHORIZED\", { message: ERROR_CODES.INVALID_USER_ID_FROM_API_KEY });\n\t\t\t\tconst session = {\n\t\t\t\t\tuser,\n\t\t\t\t\tsession: {\n\t\t\t\t\t\tid: apiKey$1.id,\n\t\t\t\t\t\ttoken: key,\n\t\t\t\t\t\tuserId: apiKey$1.userId,\n\t\t\t\t\t\tuserAgent: ctx.request?.headers.get(\"user-agent\") ?? null,\n\t\t\t\t\t\tipAddress: ctx.request ? getIp(ctx.request, ctx.context.options) : null,\n\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\texpiresAt: apiKey$1.expiresAt || getDate(ctx.context.options.session?.expiresIn || 3600 * 24 * 7, \"ms\")\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tctx.context.session = session;\n\t\t\t\tif (ctx.path === \"/get-session\") return session;\n\t\t\t\telse return { context: ctx };\n\t\t\t})\n\t\t}] },\n\t\tendpoints: {\n\t\t\tcreateApiKey: routes.createApiKey,\n\t\t\tverifyApiKey: routes.verifyApiKey,\n\t\t\tgetApiKey: routes.getApiKey,\n\t\t\tupdateApiKey: routes.updateApiKey,\n\t\t\tdeleteApiKey: routes.deleteApiKey,\n\t\t\tlistApiKeys: routes.listApiKeys,\n\t\t\tdeleteAllExpiredApiKeys: routes.deleteAllExpiredApiKeys\n\t\t},\n\t\tschema: schema$1\n\t};\n};\n\n//#endregion\n//#region src/plugins/last-login-method/index.ts\n/**\n* Plugin to track the last used login method\n*/\nconst lastLoginMethod = (userConfig) => {\n\tconst paths = [\n\t\t\"/callback/:id\",\n\t\t\"/oauth2/callback/:providerId\",\n\t\t\"/sign-in/email\",\n\t\t\"/sign-up/email\"\n\t];\n\tconst defaultResolveMethod = (ctx) => {\n\t\tif (paths.includes(ctx.path)) return ctx.params?.id || ctx.params?.providerId || ctx.path.split(\"/\").pop();\n\t\tif (ctx.path.includes(\"siwe\")) return \"siwe\";\n\t\tif (ctx.path.includes(\"/passkey/verify-authentication\")) return \"passkey\";\n\t\treturn null;\n\t};\n\tconst config = {\n\t\tcookieName: \"better-auth.last_used_login_method\",\n\t\tmaxAge: 3600 * 24 * 30,\n\t\t...userConfig\n\t};\n\treturn {\n\t\tid: \"last-login-method\",\n\t\tinit(ctx) {\n\t\t\treturn { options: { databaseHooks: {\n\t\t\t\tuser: { create: { async before(user, context) {\n\t\t\t\t\tif (!config.storeInDatabase) return;\n\t\t\t\t\tif (!context) return;\n\t\t\t\t\tconst lastUsedLoginMethod = config.customResolveMethod?.(context) ?? defaultResolveMethod(context);\n\t\t\t\t\tif (lastUsedLoginMethod) return { data: {\n\t\t\t\t\t\t...user,\n\t\t\t\t\t\tlastLoginMethod: lastUsedLoginMethod\n\t\t\t\t\t} };\n\t\t\t\t} } },\n\t\t\t\tsession: { create: { async after(session, context) {\n\t\t\t\t\tif (!config.storeInDatabase) return;\n\t\t\t\t\tif (!context) return;\n\t\t\t\t\tconst lastUsedLoginMethod = config.customResolveMethod?.(context) ?? defaultResolveMethod(context);\n\t\t\t\t\tif (lastUsedLoginMethod && session?.userId) try {\n\t\t\t\t\t\tawait ctx.internalAdapter.updateUser(session.userId, { lastLoginMethod: lastUsedLoginMethod });\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tctx.logger.error(\"Failed to update lastLoginMethod\", error);\n\t\t\t\t\t}\n\t\t\t\t} } }\n\t\t\t} } };\n\t\t},\n\t\thooks: { after: [{\n\t\t\tmatcher() {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst lastUsedLoginMethod = config.customResolveMethod?.(ctx) ?? defaultResolveMethod(ctx);\n\t\t\t\tif (lastUsedLoginMethod) {\n\t\t\t\t\tconst setCookie = ctx.context.responseHeaders?.get(\"set-cookie\");\n\t\t\t\t\tconst sessionTokenName = ctx.context.authCookies.sessionToken.name;\n\t\t\t\t\tif (setCookie && setCookie.includes(sessionTokenName)) {\n\t\t\t\t\t\tconst cookieAttributes = {\n\t\t\t\t\t\t\t...ctx.context.authCookies.sessionToken.options,\n\t\t\t\t\t\t\tmaxAge: config.maxAge,\n\t\t\t\t\t\t\thttpOnly: false\n\t\t\t\t\t\t};\n\t\t\t\t\t\tctx.setCookie(config.cookieName, lastUsedLoginMethod, cookieAttributes);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}] },\n\t\tschema: config.storeInDatabase ? { user: { fields: { lastLoginMethod: {\n\t\t\ttype: \"string\",\n\t\t\tinput: false,\n\t\t\trequired: false,\n\t\t\tfieldName: config.schema?.user?.lastLoginMethod || \"lastLoginMethod\"\n\t\t} } } } : void 0\n\t};\n};\n\n//#endregion\n//#region src/plugins/mcp/authorize.ts\nfunction redirectErrorURL(url, error, description) {\n\treturn `${url.includes(\"?\") ? \"&\" : \"?\"}error=${error}&error_description=${description}`;\n}\nasync function authorizeMCPOAuth(ctx, options) {\n\tctx.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n\tctx.setHeader(\"Access-Control-Allow-Methods\", \"POST, OPTIONS\");\n\tctx.setHeader(\"Access-Control-Allow-Headers\", \"Content-Type, Authorization\");\n\tctx.setHeader(\"Access-Control-Max-Age\", \"86400\");\n\tconst opts = {\n\t\tcodeExpiresIn: 600,\n\t\tdefaultScope: \"openid\",\n\t\t...options,\n\t\tscopes: [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\",\n\t\t\t...options?.scopes || []\n\t\t]\n\t};\n\tif (!ctx.request) throw new APIError(\"UNAUTHORIZED\", {\n\t\terror_description: \"request not found\",\n\t\terror: \"invalid_request\"\n\t});\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session) {\n\t\t/**\n\t\t* If the user is not logged in, we need to redirect them to the\n\t\t* login page.\n\t\t*/\n\t\tawait ctx.setSignedCookie(\"oidc_login_prompt\", JSON.stringify(ctx.query), ctx.context.secret, {\n\t\t\tmaxAge: 600,\n\t\t\tpath: \"/\",\n\t\t\tsameSite: \"lax\"\n\t\t});\n\t\tconst queryFromURL = ctx.request.url?.split(\"?\")[1];\n\t\tthrow ctx.redirect(`${options.loginPage}?${queryFromURL}`);\n\t}\n\tconst query = ctx.query;\n\tif (!query.client_id) throw ctx.redirect(`${ctx.context.baseURL}/error?error=invalid_client`);\n\tif (!query.response_type) throw ctx.redirect(redirectErrorURL(`${ctx.context.baseURL}/error`, \"invalid_request\", \"response_type is required\"));\n\tconst client = await ctx.context.adapter.findOne({\n\t\tmodel: \"oauthApplication\",\n\t\twhere: [{\n\t\t\tfield: \"clientId\",\n\t\t\tvalue: ctx.query.client_id\n\t\t}]\n\t}).then((res) => {\n\t\tif (!res) return null;\n\t\treturn {\n\t\t\t...res,\n\t\t\tredirectUrls: res.redirectUrls.split(\",\"),\n\t\t\tmetadata: res.metadata ? JSON.parse(res.metadata) : {}\n\t\t};\n\t});\n\tif (!client) throw ctx.redirect(`${ctx.context.baseURL}/error?error=invalid_client`);\n\tconst redirectURI = client.redirectUrls.find((url) => url === ctx.query.redirect_uri);\n\tif (!redirectURI || !query.redirect_uri)\n /**\n\t* show UI error here warning the user that the redirect URI is invalid\n\t*/\n\tthrow new APIError(\"BAD_REQUEST\", { message: \"Invalid redirect URI\" });\n\tif (client.disabled) throw ctx.redirect(`${ctx.context.baseURL}/error?error=client_disabled`);\n\tif (query.response_type !== \"code\") throw ctx.redirect(`${ctx.context.baseURL}/error?error=unsupported_response_type`);\n\tconst requestScope = query.scope?.split(\" \").filter((s) => s) || opts.defaultScope.split(\" \");\n\tconst invalidScopes = requestScope.filter((scope) => {\n\t\treturn !opts.scopes.includes(scope);\n\t});\n\tif (invalidScopes.length) throw ctx.redirect(redirectErrorURL(query.redirect_uri, \"invalid_scope\", `The following scopes are invalid: ${invalidScopes.join(\", \")}`));\n\tif ((!query.code_challenge || !query.code_challenge_method) && options.requirePKCE) throw ctx.redirect(redirectErrorURL(query.redirect_uri, \"invalid_request\", \"pkce is required\"));\n\tif (!query.code_challenge_method) query.code_challenge_method = \"plain\";\n\tif (![\"s256\", options.allowPlainCodeChallengeMethod ? \"plain\" : \"s256\"].includes(query.code_challenge_method?.toLowerCase() || \"\")) throw ctx.redirect(redirectErrorURL(query.redirect_uri, \"invalid_request\", \"invalid code_challenge method\"));\n\tconst code = generateRandomString(32, \"a-z\", \"A-Z\", \"0-9\");\n\tconst codeExpiresInMs = opts.codeExpiresIn * 1e3;\n\tconst expiresAt = new Date(Date.now() + codeExpiresInMs);\n\ttry {\n\t\t/**\n\t\t* Save the code in the database\n\t\t*/\n\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\tvalue: JSON.stringify({\n\t\t\t\tclientId: client.clientId,\n\t\t\t\tredirectURI: query.redirect_uri,\n\t\t\t\tscope: requestScope,\n\t\t\t\tuserId: session.user.id,\n\t\t\t\tauthTime: new Date(session.session.createdAt).getTime(),\n\t\t\t\trequireConsent: query.prompt === \"consent\",\n\t\t\t\tstate: query.prompt === \"consent\" ? query.state : null,\n\t\t\t\tcodeChallenge: query.code_challenge,\n\t\t\t\tcodeChallengeMethod: query.code_challenge_method,\n\t\t\t\tnonce: query.nonce\n\t\t\t}),\n\t\t\tidentifier: code,\n\t\t\texpiresAt\n\t\t});\n\t} catch (e) {\n\t\tthrow ctx.redirect(redirectErrorURL(query.redirect_uri, \"server_error\", \"An error occurred while processing the request\"));\n\t}\n\tif (query.prompt !== \"consent\") {\n\t\tconst redirectURIWithCode$1 = new URL(redirectURI);\n\t\tredirectURIWithCode$1.searchParams.set(\"code\", code);\n\t\tredirectURIWithCode$1.searchParams.set(\"state\", ctx.query.state);\n\t\tthrow ctx.redirect(redirectURIWithCode$1.toString());\n\t}\n\tif (options?.consentPage) {\n\t\tawait ctx.setSignedCookie(\"oidc_consent_prompt\", code, ctx.context.secret, {\n\t\t\tmaxAge: 600,\n\t\t\tpath: \"/\",\n\t\t\tsameSite: \"lax\"\n\t\t});\n\t\tconst urlParams = new URLSearchParams();\n\t\turlParams.set(\"consent_code\", code);\n\t\turlParams.set(\"client_id\", client.clientId);\n\t\turlParams.set(\"scope\", requestScope.join(\" \"));\n\t\tconst consentURI = `${options.consentPage}?${urlParams.toString()}`;\n\t\tthrow ctx.redirect(consentURI);\n\t}\n\tconst redirectURIWithCode = new URL(redirectURI);\n\tredirectURIWithCode.searchParams.set(\"code\", code);\n\tredirectURIWithCode.searchParams.set(\"state\", ctx.query.state);\n\tthrow ctx.redirect(redirectURIWithCode.toString());\n}\n\n//#endregion\n//#region src/plugins/mcp/index.ts\nconst getMCPProviderMetadata = (ctx, options) => {\n\tconst issuer = ctx.context.options.baseURL;\n\tconst baseURL = ctx.context.baseURL;\n\tif (!issuer || !baseURL) throw new APIError$1(\"INTERNAL_SERVER_ERROR\", {\n\t\terror: \"invalid_issuer\",\n\t\terror_description: \"issuer or baseURL is not set. If you're the app developer, please make sure to set the `baseURL` in your auth config.\"\n\t});\n\treturn {\n\t\tissuer,\n\t\tauthorization_endpoint: `${baseURL}/mcp/authorize`,\n\t\ttoken_endpoint: `${baseURL}/mcp/token`,\n\t\tuserinfo_endpoint: `${baseURL}/mcp/userinfo`,\n\t\tjwks_uri: `${baseURL}/mcp/jwks`,\n\t\tregistration_endpoint: `${baseURL}/mcp/register`,\n\t\tscopes_supported: [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\"\n\t\t],\n\t\tresponse_types_supported: [\"code\"],\n\t\tresponse_modes_supported: [\"query\"],\n\t\tgrant_types_supported: [\"authorization_code\", \"refresh_token\"],\n\t\tacr_values_supported: [\"urn:mace:incommon:iap:silver\", \"urn:mace:incommon:iap:bronze\"],\n\t\tsubject_types_supported: [\"public\"],\n\t\tid_token_signing_alg_values_supported: [\"RS256\", \"none\"],\n\t\ttoken_endpoint_auth_methods_supported: [\n\t\t\t\"client_secret_basic\",\n\t\t\t\"client_secret_post\",\n\t\t\t\"none\"\n\t\t],\n\t\tcode_challenge_methods_supported: [\"S256\"],\n\t\tclaims_supported: [\n\t\t\t\"sub\",\n\t\t\t\"iss\",\n\t\t\t\"aud\",\n\t\t\t\"exp\",\n\t\t\t\"nbf\",\n\t\t\t\"iat\",\n\t\t\t\"jti\",\n\t\t\t\"email\",\n\t\t\t\"email_verified\",\n\t\t\t\"name\"\n\t\t],\n\t\t...options?.metadata\n\t};\n};\nconst getMCPProtectedResourceMetadata = (ctx, options) => {\n\tconst baseURL = ctx.context.baseURL;\n\tconst origin = new URL(baseURL).origin;\n\treturn {\n\t\tresource: options?.resource ?? origin,\n\t\tauthorization_servers: [origin],\n\t\tjwks_uri: options?.oidcConfig?.metadata?.jwks_uri ?? `${baseURL}/mcp/jwks`,\n\t\tscopes_supported: options?.oidcConfig?.metadata?.scopes_supported ?? [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\"\n\t\t],\n\t\tbearer_methods_supported: [\"header\"],\n\t\tresource_signing_alg_values_supported: [\"RS256\", \"none\"]\n\t};\n};\nconst mcp = (options) => {\n\tconst opts = {\n\t\tcodeExpiresIn: 600,\n\t\tdefaultScope: \"openid\",\n\t\taccessTokenExpiresIn: 3600,\n\t\trefreshTokenExpiresIn: 604800,\n\t\tallowPlainCodeChallengeMethod: true,\n\t\t...options.oidcConfig,\n\t\tloginPage: options.loginPage,\n\t\tscopes: [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\",\n\t\t\t...options.oidcConfig?.scopes || []\n\t\t]\n\t};\n\tconst modelName = {\n\t\toauthClient: \"oauthApplication\",\n\t\toauthAccessToken: \"oauthAccessToken\",\n\t\toauthConsent: \"oauthConsent\"\n\t};\n\tconst provider = oidcProvider(opts);\n\treturn {\n\t\tid: \"mcp\",\n\t\thooks: { after: [{\n\t\t\tmatcher() {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\tconst cookie = await ctx.getSignedCookie(\"oidc_login_prompt\", ctx.context.secret);\n\t\t\t\tconst cookieName = ctx.context.authCookies.sessionToken.name;\n\t\t\t\tconst parsedSetCookieHeader = parseSetCookieHeader(ctx.context.responseHeaders?.get(\"set-cookie\") || \"\");\n\t\t\t\tconst hasSessionToken = parsedSetCookieHeader.has(cookieName);\n\t\t\t\tif (!cookie || !hasSessionToken) return;\n\t\t\t\tctx.setCookie(\"oidc_login_prompt\", \"\", { maxAge: 0 });\n\t\t\t\tconst sessionToken = (parsedSetCookieHeader.get(cookieName)?.value)?.split(\".\")[0];\n\t\t\t\tif (!sessionToken) return;\n\t\t\t\tconst session = await ctx.context.internalAdapter.findSession(sessionToken) || ctx.context.newSession;\n\t\t\t\tif (!session) return;\n\t\t\t\tconst promptSet = parsePrompt(String(ctx.query?.prompt));\n\t\t\t\tif (promptSet.has(\"login\")) {\n\t\t\t\t\tconst newPromptSet = new Set(promptSet);\n\t\t\t\t\tnewPromptSet.delete(\"login\");\n\t\t\t\t\tctx.query = {\n\t\t\t\t\t\t...ctx.query,\n\t\t\t\t\t\tprompt: Array.from(newPromptSet).join(\" \")\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tctx.context.session = session;\n\t\t\t\treturn await authorizeMCPOAuth(ctx, opts);\n\t\t\t})\n\t\t}] },\n\t\tendpoints: {\n\t\t\toAuthConsent: provider.endpoints.oAuthConsent,\n\t\t\tgetMcpOAuthConfig: createAuthEndpoint(\"/.well-known/oauth-authorization-server\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tmetadata: { ...HIDE_METADATA }\n\t\t\t}, async (c) => {\n\t\t\t\ttry {\n\t\t\t\t\tconst metadata = getMCPProviderMetadata(c, options);\n\t\t\t\t\treturn c.json(metadata);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log(e);\n\t\t\t\t\treturn c.json(null);\n\t\t\t\t}\n\t\t\t}),\n\t\t\tgetMCPProtectedResource: createAuthEndpoint(\"/.well-known/oauth-protected-resource\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tmetadata: { ...HIDE_METADATA }\n\t\t\t}, async (c) => {\n\t\t\t\tconst metadata = getMCPProtectedResourceMetadata(c, options);\n\t\t\t\treturn c.json(metadata);\n\t\t\t}),\n\t\t\tmcpOAuthAuthorize: createAuthEndpoint(\"/mcp/authorize\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\tquery: z.record(z.string(), z.any()),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Authorize an OAuth2 request using MCP\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"Authorization response generated successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\tdescription: \"Authorization response, contents depend on the authorize function implementation\"\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\treturn authorizeMCPOAuth(ctx, opts);\n\t\t\t}),\n\t\t\tmcpOAuthToken: createAuthEndpoint(\"/mcp/token\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.record(z.any(), z.any()),\n\t\t\t\tmetadata: {\n\t\t\t\t\tisAction: false,\n\t\t\t\t\tallowedMediaTypes: [\"application/x-www-form-urlencoded\", \"application/json\"]\n\t\t\t\t}\n\t\t\t}, async (ctx) => {\n\t\t\t\tctx.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n\t\t\t\tctx.setHeader(\"Access-Control-Allow-Methods\", \"POST, OPTIONS\");\n\t\t\t\tctx.setHeader(\"Access-Control-Allow-Headers\", \"Content-Type, Authorization\");\n\t\t\t\tctx.setHeader(\"Access-Control-Max-Age\", \"86400\");\n\t\t\t\tlet { body } = ctx;\n\t\t\t\tif (!body) throw ctx.error(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"request body not found\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif (body instanceof FormData) body = Object.fromEntries(body.entries());\n\t\t\t\tif (!(body instanceof Object)) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"request body is not an object\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tlet { client_id, client_secret } = body;\n\t\t\t\tconst authorization = ctx.request?.headers.get(\"authorization\") || null;\n\t\t\t\tif (authorization && !client_id && !client_secret && authorization.startsWith(\"Basic \")) try {\n\t\t\t\t\tconst encoded = authorization.replace(\"Basic \", \"\");\n\t\t\t\t\tconst decoded = new TextDecoder().decode(base64.decode(encoded));\n\t\t\t\t\tif (!decoded.includes(\":\")) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t\tconst [id, secret] = decoded.split(\":\");\n\t\t\t\t\tif (!id || !secret) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t\tclient_id = id;\n\t\t\t\t\tclient_secret = secret;\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthrow new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst { grant_type, code, redirect_uri, refresh_token, code_verifier } = body;\n\t\t\t\tif (grant_type === \"refresh_token\") {\n\t\t\t\t\tif (!refresh_token) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror_description: \"refresh_token is required\",\n\t\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t\t});\n\t\t\t\t\tconst token = await ctx.context.adapter.findOne({\n\t\t\t\t\t\tmodel: \"oauthAccessToken\",\n\t\t\t\t\t\twhere: [{\n\t\t\t\t\t\t\tfield: \"refreshToken\",\n\t\t\t\t\t\t\tvalue: refresh_token.toString()\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t\tif (!token) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid refresh token\",\n\t\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t\t});\n\t\t\t\t\tif (token.clientId !== client_id?.toString()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t\tif (token.refreshTokenExpiresAt < /* @__PURE__ */ new Date()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"refresh token expired\",\n\t\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t\t});\n\t\t\t\t\tconst accessToken$1 = generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\t\tconst newRefreshToken = generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\t\tconst accessTokenExpiresAt$1 = new Date(Date.now() + opts.accessTokenExpiresIn * 1e3);\n\t\t\t\t\tconst refreshTokenExpiresAt$1 = new Date(Date.now() + opts.refreshTokenExpiresIn * 1e3);\n\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\taccessToken: accessToken$1,\n\t\t\t\t\t\t\trefreshToken: newRefreshToken,\n\t\t\t\t\t\t\taccessTokenExpiresAt: accessTokenExpiresAt$1,\n\t\t\t\t\t\t\trefreshTokenExpiresAt: refreshTokenExpiresAt$1,\n\t\t\t\t\t\t\tclientId: client_id.toString(),\n\t\t\t\t\t\t\tuserId: token.userId,\n\t\t\t\t\t\t\tscopes: token.scopes,\n\t\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\taccess_token: accessToken$1,\n\t\t\t\t\t\ttoken_type: \"bearer\",\n\t\t\t\t\t\texpires_in: opts.accessTokenExpiresIn,\n\t\t\t\t\t\trefresh_token: newRefreshToken,\n\t\t\t\t\t\tscope: token.scopes\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (!code) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"code is required\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif (opts.requirePKCE && !code_verifier) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"code verifier is missing\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\t/**\n\t\t\t\t* We need to check if the code is valid before we can proceed\n\t\t\t\t* with the rest of the request.\n\t\t\t\t*/\n\t\t\t\tconst verificationValue = await ctx.context.internalAdapter.findVerificationValue(code.toString());\n\t\t\t\tif (!verificationValue) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"invalid code\",\n\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t});\n\t\t\t\tif (verificationValue.expiresAt < /* @__PURE__ */ new Date()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"code expired\",\n\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t});\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\tif (!client_id) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"client_id is required\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tif (!grant_type) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"grant_type is required\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif (grant_type !== \"authorization_code\") throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"grant_type must be 'authorization_code'\",\n\t\t\t\t\terror: \"unsupported_grant_type\"\n\t\t\t\t});\n\t\t\t\tif (!redirect_uri) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"redirect_uri is required\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tconst client = await ctx.context.adapter.findOne({\n\t\t\t\t\tmodel: modelName.oauthClient,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"clientId\",\n\t\t\t\t\t\tvalue: client_id.toString()\n\t\t\t\t\t}]\n\t\t\t\t}).then((res) => {\n\t\t\t\t\tif (!res) return null;\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...res,\n\t\t\t\t\t\tredirectUrls: res.redirectUrls.split(\",\"),\n\t\t\t\t\t\tmetadata: res.metadata ? JSON.parse(res.metadata) : {}\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t\tif (!client) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tif (client.disabled) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"client is disabled\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tif (client.type === \"public\") {\n\t\t\t\t\tif (!code_verifier) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror_description: \"code verifier is required for public clients\",\n\t\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tif (!client_secret) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"client_secret is required for confidential clients\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t\tif (!(client.clientSecret === client_secret.toString())) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\t\terror_description: \"invalid client_secret\",\n\t\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst value = JSON.parse(verificationValue.value);\n\t\t\t\tif (value.clientId !== client_id.toString()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tif (value.redirectURI !== redirect_uri.toString()) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"invalid redirect_uri\",\n\t\t\t\t\terror: \"invalid_client\"\n\t\t\t\t});\n\t\t\t\tif (value.codeChallenge && !code_verifier) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror_description: \"code verifier is missing\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tif ((value.codeChallengeMethod === \"plain\" ? code_verifier : await createHash(\"SHA-256\", \"base64urlnopad\").digest(code_verifier)) !== value.codeChallenge) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"code verification failed\",\n\t\t\t\t\terror: \"invalid_request\"\n\t\t\t\t});\n\t\t\t\tconst requestedScopes = value.scope;\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(verificationValue.id);\n\t\t\t\tconst accessToken = generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\tconst refreshToken = generateRandomString(32, \"A-Z\", \"a-z\");\n\t\t\t\tconst accessTokenExpiresAt = new Date(Date.now() + opts.accessTokenExpiresIn * 1e3);\n\t\t\t\tconst refreshTokenExpiresAt = new Date(Date.now() + opts.refreshTokenExpiresIn * 1e3);\n\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\taccessToken,\n\t\t\t\t\t\trefreshToken,\n\t\t\t\t\t\taccessTokenExpiresAt,\n\t\t\t\t\t\trefreshTokenExpiresAt,\n\t\t\t\t\t\tclientId: client_id.toString(),\n\t\t\t\t\t\tuserId: value.userId,\n\t\t\t\t\t\tscopes: requestedScopes.join(\" \"),\n\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(value.userId);\n\t\t\t\tif (!user) throw new APIError$1(\"UNAUTHORIZED\", {\n\t\t\t\t\terror_description: \"user not found\",\n\t\t\t\t\terror: \"invalid_grant\"\n\t\t\t\t});\n\t\t\t\tlet secretKey = {\n\t\t\t\t\talg: \"HS256\",\n\t\t\t\t\tkey: await getWebcryptoSubtle().generateKey({\n\t\t\t\t\t\tname: \"HMAC\",\n\t\t\t\t\t\thash: \"SHA-256\"\n\t\t\t\t\t}, true, [\"sign\", \"verify\"])\n\t\t\t\t};\n\t\t\t\tconst profile = {\n\t\t\t\t\tgiven_name: user.name.split(\" \")[0],\n\t\t\t\t\tfamily_name: user.name.split(\" \")[1],\n\t\t\t\t\tname: user.name,\n\t\t\t\t\tprofile: user.image,\n\t\t\t\t\tupdated_at: Math.floor(new Date(user.updatedAt).getTime() / 1e3)\n\t\t\t\t};\n\t\t\t\tconst email = {\n\t\t\t\t\temail: user.email,\n\t\t\t\t\temail_verified: user.emailVerified\n\t\t\t\t};\n\t\t\t\tconst userClaims = {\n\t\t\t\t\t...requestedScopes.includes(\"profile\") ? profile : {},\n\t\t\t\t\t...requestedScopes.includes(\"email\") ? email : {}\n\t\t\t\t};\n\t\t\t\tconst additionalUserClaims = opts.getAdditionalUserInfoClaim ? await opts.getAdditionalUserInfoClaim(user, requestedScopes, client) : {};\n\t\t\t\tconst idToken = await new SignJWT({\n\t\t\t\t\tsub: user.id,\n\t\t\t\t\taud: client_id.toString(),\n\t\t\t\t\tiat: Date.now(),\n\t\t\t\t\tauth_time: ctx.context.session ? new Date(ctx.context.session.session.createdAt).getTime() : void 0,\n\t\t\t\t\tnonce: value.nonce,\n\t\t\t\t\tacr: \"urn:mace:incommon:iap:silver\",\n\t\t\t\t\t...userClaims,\n\t\t\t\t\t...additionalUserClaims\n\t\t\t\t}).setProtectedHeader({ alg: secretKey.alg }).setIssuedAt().setExpirationTime(Math.floor(Date.now() / 1e3) + opts.accessTokenExpiresIn).sign(secretKey.key);\n\t\t\t\treturn ctx.json({\n\t\t\t\t\taccess_token: accessToken,\n\t\t\t\t\ttoken_type: \"Bearer\",\n\t\t\t\t\texpires_in: opts.accessTokenExpiresIn,\n\t\t\t\t\trefresh_token: requestedScopes.includes(\"offline_access\") ? refreshToken : void 0,\n\t\t\t\t\tscope: requestedScopes.join(\" \"),\n\t\t\t\t\tid_token: requestedScopes.includes(\"openid\") ? idToken : void 0\n\t\t\t\t}, { headers: {\n\t\t\t\t\t\"Cache-Control\": \"no-store\",\n\t\t\t\t\tPragma: \"no-cache\"\n\t\t\t\t} });\n\t\t\t}),\n\t\t\tregisterMcpClient: createAuthEndpoint(\"/mcp/register\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: z.object({\n\t\t\t\t\tredirect_uris: z.array(z.string()),\n\t\t\t\t\ttoken_endpoint_auth_method: z.enum([\n\t\t\t\t\t\t\"none\",\n\t\t\t\t\t\t\"client_secret_basic\",\n\t\t\t\t\t\t\"client_secret_post\"\n\t\t\t\t\t]).default(\"client_secret_basic\").optional(),\n\t\t\t\t\tgrant_types: z.array(z.enum([\n\t\t\t\t\t\t\"authorization_code\",\n\t\t\t\t\t\t\"implicit\",\n\t\t\t\t\t\t\"password\",\n\t\t\t\t\t\t\"client_credentials\",\n\t\t\t\t\t\t\"refresh_token\",\n\t\t\t\t\t\t\"urn:ietf:params:oauth:grant-type:jwt-bearer\",\n\t\t\t\t\t\t\"urn:ietf:params:oauth:grant-type:saml2-bearer\"\n\t\t\t\t\t])).default([\"authorization_code\"]).optional(),\n\t\t\t\t\tresponse_types: z.array(z.enum([\"code\", \"token\"])).default([\"code\"]).optional(),\n\t\t\t\t\tclient_name: z.string().optional(),\n\t\t\t\t\tclient_uri: z.string().optional(),\n\t\t\t\t\tlogo_uri: z.string().optional(),\n\t\t\t\t\tscope: z.string().optional(),\n\t\t\t\t\tcontacts: z.array(z.string()).optional(),\n\t\t\t\t\ttos_uri: z.string().optional(),\n\t\t\t\t\tpolicy_uri: z.string().optional(),\n\t\t\t\t\tjwks_uri: z.string().optional(),\n\t\t\t\t\tjwks: z.record(z.string(), z.any()).optional(),\n\t\t\t\t\tmetadata: z.record(z.any(), z.any()).optional(),\n\t\t\t\t\tsoftware_id: z.string().optional(),\n\t\t\t\t\tsoftware_version: z.string().optional(),\n\t\t\t\t\tsoftware_statement: z.string().optional()\n\t\t\t\t}),\n\t\t\t\tmetadata: { openapi: {\n\t\t\t\t\tdescription: \"Register an OAuth2 application\",\n\t\t\t\t\tresponses: { \"200\": {\n\t\t\t\t\t\tdescription: \"OAuth2 application registered successfully\",\n\t\t\t\t\t\tcontent: { \"application/json\": { schema: {\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Name of the OAuth2 application\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ticon: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\tdescription: \"Icon URL for the application\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\tdescription: \"Additional metadata for the application\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tclientId: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier for the client\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tclientSecret: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Secret key for the client. Not included for public clients.\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tredirectUrls: {\n\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tformat: \"uri\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdescription: \"List of allowed redirect URLs\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttype: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Type of the client\",\n\t\t\t\t\t\t\t\t\tenum: [\"web\", \"public\"]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tauthenticationScheme: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tdescription: \"Authentication scheme used by the client\",\n\t\t\t\t\t\t\t\t\tenum: [\"client_secret\", \"none\"]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdisabled: {\n\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\tdescription: \"Whether the client is disabled\",\n\t\t\t\t\t\t\t\t\tenum: [false]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\tdescription: \"ID of the user who registered the client, null if registered anonymously\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\tdescription: \"Creation timestamp\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\tdescription: \"Last update timestamp\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\"name\",\n\t\t\t\t\t\t\t\t\"clientId\",\n\t\t\t\t\t\t\t\t\"redirectUrls\",\n\t\t\t\t\t\t\t\t\"type\",\n\t\t\t\t\t\t\t\t\"authenticationScheme\",\n\t\t\t\t\t\t\t\t\"disabled\",\n\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\"updatedAt\"\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t} } }\n\t\t\t\t\t} }\n\t\t\t\t} }\n\t\t\t}, async (ctx) => {\n\t\t\t\tconst body = ctx.body;\n\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\t\tctx.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n\t\t\t\tctx.setHeader(\"Access-Control-Allow-Methods\", \"POST, OPTIONS\");\n\t\t\t\tctx.setHeader(\"Access-Control-Allow-Headers\", \"Content-Type, Authorization\");\n\t\t\t\tctx.setHeader(\"Access-Control-Max-Age\", \"86400\");\n\t\t\t\tctx.headers?.set(\"Access-Control-Max-Age\", \"86400\");\n\t\t\t\tif ((!body.grant_types || body.grant_types.includes(\"authorization_code\") || body.grant_types.includes(\"implicit\")) && (!body.redirect_uris || body.redirect_uris.length === 0)) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_redirect_uri\",\n\t\t\t\t\terror_description: \"Redirect URIs are required for authorization_code and implicit grant types\"\n\t\t\t\t});\n\t\t\t\tif (body.grant_types && body.response_types) {\n\t\t\t\t\tif (body.grant_types.includes(\"authorization_code\") && !body.response_types.includes(\"code\")) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_client_metadata\",\n\t\t\t\t\t\terror_description: \"When 'authorization_code' grant type is used, 'code' response type must be included\"\n\t\t\t\t\t});\n\t\t\t\t\tif (body.grant_types.includes(\"implicit\") && !body.response_types.includes(\"token\")) throw new APIError$1(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_client_metadata\",\n\t\t\t\t\t\terror_description: \"When 'implicit' grant type is used, 'token' response type must be included\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst clientId = opts.generateClientId?.() || generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\tconst clientSecret = opts.generateClientSecret?.() || generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\tconst clientType = body.token_endpoint_auth_method === \"none\" ? \"public\" : \"web\";\n\t\t\t\tconst finalClientSecret = clientType === \"public\" ? \"\" : clientSecret;\n\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\tmodel: modelName.oauthClient,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tname: body.client_name,\n\t\t\t\t\t\ticon: body.logo_uri,\n\t\t\t\t\t\tmetadata: body.metadata ? JSON.stringify(body.metadata) : null,\n\t\t\t\t\t\tclientId,\n\t\t\t\t\t\tclientSecret: finalClientSecret,\n\t\t\t\t\t\tredirectUrls: body.redirect_uris.join(\",\"),\n\t\t\t\t\t\ttype: clientType,\n\t\t\t\t\t\tauthenticationScheme: body.token_endpoint_auth_method || \"client_secret_basic\",\n\t\t\t\t\t\tdisabled: false,\n\t\t\t\t\t\tuserId: session?.session.userId,\n\t\t\t\t\t\tcreatedAt: /* @__PURE__ */ new Date(),\n\t\t\t\t\t\tupdatedAt: /* @__PURE__ */ new Date()\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tconst responseData = {\n\t\t\t\t\tclient_id: clientId,\n\t\t\t\t\tclient_id_issued_at: Math.floor(Date.now() / 1e3),\n\t\t\t\t\tredirect_uris: body.redirect_uris,\n\t\t\t\t\ttoken_endpoint_auth_method: body.token_endpoint_auth_method || \"client_secret_basic\",\n\t\t\t\t\tgrant_types: body.grant_types || [\"authorization_code\"],\n\t\t\t\t\tresponse_types: body.response_types || [\"code\"],\n\t\t\t\t\tclient_name: body.client_name,\n\t\t\t\t\tclient_uri: body.client_uri,\n\t\t\t\t\tlogo_uri: body.logo_uri,\n\t\t\t\t\tscope: body.scope,\n\t\t\t\t\tcontacts: body.contacts,\n\t\t\t\t\ttos_uri: body.tos_uri,\n\t\t\t\t\tpolicy_uri: body.policy_uri,\n\t\t\t\t\tjwks_uri: body.jwks_uri,\n\t\t\t\t\tjwks: body.jwks,\n\t\t\t\t\tsoftware_id: body.software_id,\n\t\t\t\t\tsoftware_version: body.software_version,\n\t\t\t\t\tsoftware_statement: body.software_statement,\n\t\t\t\t\tmetadata: body.metadata,\n\t\t\t\t\t...clientType !== \"public\" ? {\n\t\t\t\t\t\tclient_secret: finalClientSecret,\n\t\t\t\t\t\tclient_secret_expires_at: 0\n\t\t\t\t\t} : {}\n\t\t\t\t};\n\t\t\t\treturn new Response(JSON.stringify(responseData), {\n\t\t\t\t\tstatus: 201,\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t\t\"Cache-Control\": \"no-store\",\n\t\t\t\t\t\tPragma: \"no-cache\"\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}),\n\t\t\tgetMcpSession: createAuthEndpoint(\"/mcp/get-session\", {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\trequireHeaders: true\n\t\t\t}, async (c) => {\n\t\t\t\tconst accessToken = c.headers?.get(\"Authorization\")?.replace(\"Bearer \", \"\");\n\t\t\t\tif (!accessToken) {\n\t\t\t\t\tc.headers?.set(\"WWW-Authenticate\", \"Bearer\");\n\t\t\t\t\treturn c.json(null);\n\t\t\t\t}\n\t\t\t\tconst accessTokenData = await c.context.adapter.findOne({\n\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\twhere: [{\n\t\t\t\t\t\tfield: \"accessToken\",\n\t\t\t\t\t\tvalue: accessToken\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t\tif (!accessTokenData) return c.json(null);\n\t\t\t\treturn c.json(accessTokenData);\n\t\t\t})\n\t\t},\n\t\tschema\n\t};\n};\nconst withMcpAuth = (auth, handler) => {\n\treturn async (req) => {\n\t\tconst baseURL = getBaseURL(auth.options.baseURL, auth.options.basePath);\n\t\tif (!baseURL && !isProduction) logger.warn(\"Unable to get the baseURL, please check your config!\");\n\t\tconst session = await auth.api.getMcpSession({ headers: req.headers });\n\t\tconst wwwAuthenticateValue = `Bearer resource_metadata=\"${baseURL}/.well-known/oauth-protected-resource\"`;\n\t\tif (!session) return Response.json({\n\t\t\tjsonrpc: \"2.0\",\n\t\t\terror: {\n\t\t\t\tcode: -32e3,\n\t\t\t\tmessage: \"Unauthorized: Authentication required\",\n\t\t\t\t\"www-authenticate\": wwwAuthenticateValue\n\t\t\t},\n\t\t\tid: null\n\t\t}, {\n\t\t\tstatus: 401,\n\t\t\theaders: {\n\t\t\t\t\"WWW-Authenticate\": wwwAuthenticateValue,\n\t\t\t\t\"Access-Control-Expose-Headers\": \"WWW-Authenticate\"\n\t\t\t}\n\t\t});\n\t\treturn handler(req, session);\n\t};\n};\nconst oAuthDiscoveryMetadata = (auth) => {\n\treturn async (request) => {\n\t\tconst res = await auth.api.getMcpOAuthConfig();\n\t\treturn new Response(JSON.stringify(res), {\n\t\t\tstatus: 200,\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\"Access-Control-Allow-Origin\": \"*\",\n\t\t\t\t\"Access-Control-Allow-Methods\": \"POST, OPTIONS\",\n\t\t\t\t\"Access-Control-Allow-Headers\": \"Content-Type, Authorization\",\n\t\t\t\t\"Access-Control-Max-Age\": \"86400\"\n\t\t\t}\n\t\t});\n\t};\n};\nconst oAuthProtectedResourceMetadata = (auth) => {\n\treturn async (request) => {\n\t\tconst res = await auth.api.getMCPProtectedResource();\n\t\treturn new Response(JSON.stringify(res), {\n\t\t\tstatus: 200,\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\"Access-Control-Allow-Origin\": \"*\",\n\t\t\t\t\"Access-Control-Allow-Methods\": \"POST, OPTIONS\",\n\t\t\t\t\"Access-Control-Allow-Headers\": \"Content-Type, Authorization\",\n\t\t\t\t\"Access-Control-Max-Age\": \"86400\"\n\t\t\t}\n\t\t});\n\t};\n};\n\n//#endregion\nexport { getMCPProviderMetadata as a, oAuthProtectedResourceMetadata as c, API_KEY_TABLE_NAME as d, ERROR_CODES as f, getMCPProtectedResourceMetadata as i, withMcpAuth as l, defaultKeyHasher as m, createAuthMiddleware$1 as n, mcp as o, apiKey as p, optionsMiddleware as r, oAuthDiscoveryMetadata as s, createAuthEndpoint$1 as t, lastLoginMethod as u };","/**\n * SHA3 (keccak) hash function, based on a new \"Sponge function\" design.\n * Different from older hashes, the internal state is bigger than output size.\n *\n * Check out [FIPS-202](https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.202.pdf),\n * [Website](https://keccak.team/keccak.html),\n * [the differences between SHA-3 and Keccak](https://crypto.stackexchange.com/questions/15727/what-are-the-key-differences-between-the-draft-sha-3-standard-and-the-keccak-sub).\n *\n * Check out `sha3-addons` module for cSHAKE, k12, and others.\n * @module\n */\nimport { rotlBH, rotlBL, rotlSH, rotlSL, split } from './_u64.ts';\n// prettier-ignore\nimport {\n  abytes, aexists, anumber, aoutput,\n  clean, createHasher,\n  oidNist,\n  swap32IfBE,\n  u32,\n  type CHash, type CHashXOF,\n  type Hash,\n  type HashInfo,\n  type HashXOF\n} from './utils.ts';\n\n// No __PURE__ annotations in sha3 header:\n// EVERYTHING is in fact used on every export.\n// Various per round constants calculations\nconst _0n = BigInt(0);\nconst _1n = BigInt(1);\nconst _2n = BigInt(2);\nconst _7n = BigInt(7);\nconst _256n = BigInt(256);\nconst _0x71n = BigInt(0x71);\nconst SHA3_PI: number[] = [];\nconst SHA3_ROTL: number[] = [];\nconst _SHA3_IOTA: bigint[] = []; // no pure annotation: var is always used\nfor (let round = 0, R = _1n, x = 1, y = 0; round < 24; round++) {\n  // Pi\n  [x, y] = [y, (2 * x + 3 * y) % 5];\n  SHA3_PI.push(2 * (5 * y + x));\n  // Rotational\n  SHA3_ROTL.push((((round + 1) * (round + 2)) / 2) % 64);\n  // Iota\n  let t = _0n;\n  for (let j = 0; j < 7; j++) {\n    R = ((R << _1n) ^ ((R >> _7n) * _0x71n)) % _256n;\n    if (R & _2n) t ^= _1n << ((_1n << BigInt(j)) - _1n);\n  }\n  _SHA3_IOTA.push(t);\n}\nconst IOTAS = split(_SHA3_IOTA, true);\nconst SHA3_IOTA_H = IOTAS[0];\nconst SHA3_IOTA_L = IOTAS[1];\n\n// Left rotation (without 0, 32, 64)\nconst rotlH = (h: number, l: number, s: number) => (s > 32 ? rotlBH(h, l, s) : rotlSH(h, l, s));\nconst rotlL = (h: number, l: number, s: number) => (s > 32 ? rotlBL(h, l, s) : rotlSL(h, l, s));\n\n/** `keccakf1600` internal function, additionally allows to adjust round count. */\nexport function keccakP(s: Uint32Array, rounds: number = 24): void {\n  const B = new Uint32Array(5 * 2);\n  // NOTE: all indices are x2 since we store state as u32 instead of u64 (bigints to slow in js)\n  for (let round = 24 - rounds; round < 24; round++) {\n    // Theta \n    for (let x = 0; x < 10; x++) B[x] = s[x] ^ s[x + 10] ^ s[x + 20] ^ s[x + 30] ^ s[x + 40];\n    for (let x = 0; x < 10; x += 2) {\n      const idx1 = (x + 8) % 10;\n      const idx0 = (x + 2) % 10;\n      const B0 = B[idx0];\n      const B1 = B[idx0 + 1];\n      const Th = rotlH(B0, B1, 1) ^ B[idx1];\n      const Tl = rotlL(B0, B1, 1) ^ B[idx1 + 1];\n      for (let y = 0; y < 50; y += 10) {\n        s[x + y] ^= Th;\n        s[x + y + 1] ^= Tl;\n      }\n    }\n    // Rho () and Pi ()\n    let curH = s[2];\n    let curL = s[3];\n    for (let t = 0; t < 24; t++) {\n      const shift = SHA3_ROTL[t];\n      const Th = rotlH(curH, curL, shift);\n      const Tl = rotlL(curH, curL, shift);\n      const PI = SHA3_PI[t];\n      curH = s[PI];\n      curL = s[PI + 1];\n      s[PI] = Th;\n      s[PI + 1] = Tl;\n    }\n    // Chi ()\n    for (let y = 0; y < 50; y += 10) {\n      for (let x = 0; x < 10; x++) B[x] = s[y + x];\n      for (let x = 0; x < 10; x++) s[y + x] ^= ~B[(x + 2) % 10] & B[(x + 4) % 10];\n    }\n    // Iota ()\n    s[0] ^= SHA3_IOTA_H[round];\n    s[1] ^= SHA3_IOTA_L[round];\n  }\n  clean(B);\n}\n\n/** Keccak sponge function. */\nexport class Keccak implements Hash<Keccak>, HashXOF<Keccak> {\n  protected state: Uint8Array;\n  protected pos = 0;\n  protected posOut = 0;\n  protected finished = false;\n  protected state32: Uint32Array;\n  protected destroyed = false;\n\n  public blockLen: number;\n  public suffix: number;\n  public outputLen: number;\n  protected enableXOF = false;\n  protected rounds: number;\n\n  // NOTE: we accept arguments in bytes instead of bits here.\n  constructor(\n    blockLen: number,\n    suffix: number,\n    outputLen: number,\n    enableXOF = false,\n    rounds: number = 24\n  ) {\n    this.blockLen = blockLen;\n    this.suffix = suffix;\n    this.outputLen = outputLen;\n    this.enableXOF = enableXOF;\n    this.rounds = rounds;\n    // Can be passed from user as dkLen\n    anumber(outputLen, 'outputLen');\n    // 1600 = 5x5 matrix of 64bit.  1600 bits === 200 bytes\n    // 0 < blockLen < 200\n    if (!(0 < blockLen && blockLen < 200))\n      throw new Error('only keccak-f1600 function is supported');\n    this.state = new Uint8Array(200);\n    this.state32 = u32(this.state);\n  }\n  clone(): Keccak {\n    return this._cloneInto();\n  }\n  protected keccak(): void {\n    swap32IfBE(this.state32);\n    keccakP(this.state32, this.rounds);\n    swap32IfBE(this.state32);\n    this.posOut = 0;\n    this.pos = 0;\n  }\n  update(data: Uint8Array): this {\n    aexists(this);\n    abytes(data);\n    const { blockLen, state } = this;\n    const len = data.length;\n    for (let pos = 0; pos < len; ) {\n      const take = Math.min(blockLen - this.pos, len - pos);\n      for (let i = 0; i < take; i++) state[this.pos++] ^= data[pos++];\n      if (this.pos === blockLen) this.keccak();\n    }\n    return this;\n  }\n  protected finish(): void {\n    if (this.finished) return;\n    this.finished = true;\n    const { state, suffix, pos, blockLen } = this;\n    // Do the padding\n    state[pos] ^= suffix;\n    if ((suffix & 0x80) !== 0 && pos === blockLen - 1) this.keccak();\n    state[blockLen - 1] ^= 0x80;\n    this.keccak();\n  }\n  protected writeInto(out: Uint8Array): Uint8Array {\n    aexists(this, false);\n    abytes(out);\n    this.finish();\n    const bufferOut = this.state;\n    const { blockLen } = this;\n    for (let pos = 0, len = out.length; pos < len; ) {\n      if (this.posOut >= blockLen) this.keccak();\n      const take = Math.min(blockLen - this.posOut, len - pos);\n      out.set(bufferOut.subarray(this.posOut, this.posOut + take), pos);\n      this.posOut += take;\n      pos += take;\n    }\n    return out;\n  }\n  xofInto(out: Uint8Array): Uint8Array {\n    // Sha3/Keccak usage with XOF is probably mistake, only SHAKE instances can do XOF\n    if (!this.enableXOF) throw new Error('XOF is not possible for this instance');\n    return this.writeInto(out);\n  }\n  xof(bytes: number): Uint8Array {\n    anumber(bytes);\n    return this.xofInto(new Uint8Array(bytes));\n  }\n  digestInto(out: Uint8Array): Uint8Array {\n    aoutput(out, this);\n    if (this.finished) throw new Error('digest() was already called');\n    this.writeInto(out);\n    this.destroy();\n    return out;\n  }\n  digest(): Uint8Array {\n    return this.digestInto(new Uint8Array(this.outputLen));\n  }\n  destroy(): void {\n    this.destroyed = true;\n    clean(this.state);\n  }\n  _cloneInto(to?: Keccak): Keccak {\n    const { blockLen, suffix, outputLen, rounds, enableXOF } = this;\n    to ||= new Keccak(blockLen, suffix, outputLen, enableXOF, rounds);\n    to.state32.set(this.state32);\n    to.pos = this.pos;\n    to.posOut = this.posOut;\n    to.finished = this.finished;\n    to.rounds = rounds;\n    // Suffix can change in cSHAKE\n    to.suffix = suffix;\n    to.outputLen = outputLen;\n    to.enableXOF = enableXOF;\n    to.destroyed = this.destroyed;\n    return to;\n  }\n}\n\nconst genKeccak = (suffix: number, blockLen: number, outputLen: number, info: HashInfo = {}) =>\n  createHasher(() => new Keccak(blockLen, suffix, outputLen), info);\n\n/** SHA3-224 hash function. */\nexport const sha3_224: CHash = /* @__PURE__ */ genKeccak(\n  0x06,\n  144,\n  28,\n  /* @__PURE__ */ oidNist(0x07)\n);\n/** SHA3-256 hash function. Different from keccak-256. */\nexport const sha3_256: CHash = /* @__PURE__ */ genKeccak(\n  0x06,\n  136,\n  32,\n  /* @__PURE__ */ oidNist(0x08)\n);\n/** SHA3-384 hash function. */\nexport const sha3_384: CHash = /* @__PURE__ */ genKeccak(\n  0x06,\n  104,\n  48,\n  /* @__PURE__ */ oidNist(0x09)\n);\n/** SHA3-512 hash function. */\nexport const sha3_512: CHash = /* @__PURE__ */ genKeccak(\n  0x06,\n  72,\n  64,\n  /* @__PURE__ */ oidNist(0x0a)\n);\n\n/** keccak-224 hash function. */\nexport const keccak_224: CHash = /* @__PURE__ */ genKeccak(0x01, 144, 28);\n/** keccak-256 hash function. Different from SHA3-256. */\nexport const keccak_256: CHash = /* @__PURE__ */ genKeccak(0x01, 136, 32);\n/** keccak-384 hash function. */\nexport const keccak_384: CHash = /* @__PURE__ */ genKeccak(0x01, 104, 48);\n/** keccak-512 hash function. */\nexport const keccak_512: CHash = /* @__PURE__ */ genKeccak(0x01, 72, 64);\n\n/** Options for SHAKE XOF. */\nexport type ShakeOpts = { dkLen?: number };\n\nconst genShake = (suffix: number, blockLen: number, outputLen: number, info: HashInfo = {}) =>\n  createHasher<Keccak, ShakeOpts>(\n    (opts: ShakeOpts = {}) =>\n      new Keccak(blockLen, suffix, opts.dkLen === undefined ? outputLen : opts.dkLen, true),\n    info\n  );\n\n/** SHAKE128 XOF with 128-bit security. */\nexport const shake128: CHashXOF<Keccak, ShakeOpts> =\n  /* @__PURE__ */\n  genShake(0x1f, 168, 16, /* @__PURE__ */ oidNist(0x0b));\n/** SHAKE256 XOF with 256-bit security. */\nexport const shake256: CHashXOF<Keccak, ShakeOpts> =\n  /* @__PURE__ */\n  genShake(0x1f, 136, 32, /* @__PURE__ */ oidNist(0x0c));\n\n/** SHAKE128 XOF with 256-bit output (NIST version). */\nexport const shake128_32: CHashXOF<Keccak, ShakeOpts> =\n  /* @__PURE__ */\n  genShake(0x1f, 168, 32, /* @__PURE__ */ oidNist(0x0b));\n/** SHAKE256 XOF with 512-bit output (NIST version). */\nexport const shake256_64: CHashXOF<Keccak, ShakeOpts> =\n  /* @__PURE__ */\n  genShake(0x1f, 136, 64, /* @__PURE__ */ oidNist(0x0c));\n","import { getTableUniqueName, Table } from \"./table.js\";\nimport { Column } from \"./column.js\";\nimport { entityKind, is } from \"./entity.js\";\nimport { PrimaryKeyBuilder } from \"./pg-core/primary-keys.js\";\nimport {\n  and,\n  asc,\n  between,\n  desc,\n  eq,\n  exists,\n  gt,\n  gte,\n  ilike,\n  inArray,\n  isNotNull,\n  isNull,\n  like,\n  lt,\n  lte,\n  ne,\n  not,\n  notBetween,\n  notExists,\n  notIlike,\n  notInArray,\n  notLike,\n  or\n} from \"./sql/expressions/index.js\";\nimport { SQL, sql } from \"./sql/sql.js\";\nclass Relation {\n  constructor(sourceTable, referencedTable, relationName) {\n    this.sourceTable = sourceTable;\n    this.referencedTable = referencedTable;\n    this.relationName = relationName;\n    this.referencedTableName = referencedTable[Table.Symbol.Name];\n  }\n  static [entityKind] = \"Relation\";\n  referencedTableName;\n  fieldName;\n}\nclass Relations {\n  constructor(table, config) {\n    this.table = table;\n    this.config = config;\n  }\n  static [entityKind] = \"Relations\";\n}\nclass One extends Relation {\n  constructor(sourceTable, referencedTable, config, isNullable) {\n    super(sourceTable, referencedTable, config?.relationName);\n    this.config = config;\n    this.isNullable = isNullable;\n  }\n  static [entityKind] = \"One\";\n  withFieldName(fieldName) {\n    const relation = new One(\n      this.sourceTable,\n      this.referencedTable,\n      this.config,\n      this.isNullable\n    );\n    relation.fieldName = fieldName;\n    return relation;\n  }\n}\nclass Many extends Relation {\n  constructor(sourceTable, referencedTable, config) {\n    super(sourceTable, referencedTable, config?.relationName);\n    this.config = config;\n  }\n  static [entityKind] = \"Many\";\n  withFieldName(fieldName) {\n    const relation = new Many(\n      this.sourceTable,\n      this.referencedTable,\n      this.config\n    );\n    relation.fieldName = fieldName;\n    return relation;\n  }\n}\nfunction getOperators() {\n  return {\n    and,\n    between,\n    eq,\n    exists,\n    gt,\n    gte,\n    ilike,\n    inArray,\n    isNull,\n    isNotNull,\n    like,\n    lt,\n    lte,\n    ne,\n    not,\n    notBetween,\n    notExists,\n    notLike,\n    notIlike,\n    notInArray,\n    or,\n    sql\n  };\n}\nfunction getOrderByOperators() {\n  return {\n    sql,\n    asc,\n    desc\n  };\n}\nfunction extractTablesRelationalConfig(schema, configHelpers) {\n  if (Object.keys(schema).length === 1 && \"default\" in schema && !is(schema[\"default\"], Table)) {\n    schema = schema[\"default\"];\n  }\n  const tableNamesMap = {};\n  const relationsBuffer = {};\n  const tablesConfig = {};\n  for (const [key, value] of Object.entries(schema)) {\n    if (is(value, Table)) {\n      const dbName = getTableUniqueName(value);\n      const bufferedRelations = relationsBuffer[dbName];\n      tableNamesMap[dbName] = key;\n      tablesConfig[key] = {\n        tsName: key,\n        dbName: value[Table.Symbol.Name],\n        schema: value[Table.Symbol.Schema],\n        columns: value[Table.Symbol.Columns],\n        relations: bufferedRelations?.relations ?? {},\n        primaryKey: bufferedRelations?.primaryKey ?? []\n      };\n      for (const column of Object.values(\n        value[Table.Symbol.Columns]\n      )) {\n        if (column.primary) {\n          tablesConfig[key].primaryKey.push(column);\n        }\n      }\n      const extraConfig = value[Table.Symbol.ExtraConfigBuilder]?.(value[Table.Symbol.ExtraConfigColumns]);\n      if (extraConfig) {\n        for (const configEntry of Object.values(extraConfig)) {\n          if (is(configEntry, PrimaryKeyBuilder)) {\n            tablesConfig[key].primaryKey.push(...configEntry.columns);\n          }\n        }\n      }\n    } else if (is(value, Relations)) {\n      const dbName = getTableUniqueName(value.table);\n      const tableName = tableNamesMap[dbName];\n      const relations2 = value.config(\n        configHelpers(value.table)\n      );\n      let primaryKey;\n      for (const [relationName, relation] of Object.entries(relations2)) {\n        if (tableName) {\n          const tableConfig = tablesConfig[tableName];\n          tableConfig.relations[relationName] = relation;\n          if (primaryKey) {\n            tableConfig.primaryKey.push(...primaryKey);\n          }\n        } else {\n          if (!(dbName in relationsBuffer)) {\n            relationsBuffer[dbName] = {\n              relations: {},\n              primaryKey\n            };\n          }\n          relationsBuffer[dbName].relations[relationName] = relation;\n        }\n      }\n    }\n  }\n  return { tables: tablesConfig, tableNamesMap };\n}\nfunction relations(table, relations2) {\n  return new Relations(\n    table,\n    (helpers) => Object.fromEntries(\n      Object.entries(relations2(helpers)).map(([key, value]) => [\n        key,\n        value.withFieldName(key)\n      ])\n    )\n  );\n}\nfunction createOne(sourceTable) {\n  return function one(table, config) {\n    return new One(\n      sourceTable,\n      table,\n      config,\n      config?.fields.reduce((res, f) => res && f.notNull, true) ?? false\n    );\n  };\n}\nfunction createMany(sourceTable) {\n  return function many(referencedTable, config) {\n    return new Many(sourceTable, referencedTable, config);\n  };\n}\nfunction normalizeRelation(schema, tableNamesMap, relation) {\n  if (is(relation, One) && relation.config) {\n    return {\n      fields: relation.config.fields,\n      references: relation.config.references\n    };\n  }\n  const referencedTableTsName = tableNamesMap[getTableUniqueName(relation.referencedTable)];\n  if (!referencedTableTsName) {\n    throw new Error(\n      `Table \"${relation.referencedTable[Table.Symbol.Name]}\" not found in schema`\n    );\n  }\n  const referencedTableConfig = schema[referencedTableTsName];\n  if (!referencedTableConfig) {\n    throw new Error(`Table \"${referencedTableTsName}\" not found in schema`);\n  }\n  const sourceTable = relation.sourceTable;\n  const sourceTableTsName = tableNamesMap[getTableUniqueName(sourceTable)];\n  if (!sourceTableTsName) {\n    throw new Error(\n      `Table \"${sourceTable[Table.Symbol.Name]}\" not found in schema`\n    );\n  }\n  const reverseRelations = [];\n  for (const referencedTableRelation of Object.values(\n    referencedTableConfig.relations\n  )) {\n    if (relation.relationName && relation !== referencedTableRelation && referencedTableRelation.relationName === relation.relationName || !relation.relationName && referencedTableRelation.referencedTable === relation.sourceTable) {\n      reverseRelations.push(referencedTableRelation);\n    }\n  }\n  if (reverseRelations.length > 1) {\n    throw relation.relationName ? new Error(\n      `There are multiple relations with name \"${relation.relationName}\" in table \"${referencedTableTsName}\"`\n    ) : new Error(\n      `There are multiple relations between \"${referencedTableTsName}\" and \"${relation.sourceTable[Table.Symbol.Name]}\". Please specify relation name`\n    );\n  }\n  if (reverseRelations[0] && is(reverseRelations[0], One) && reverseRelations[0].config) {\n    return {\n      fields: reverseRelations[0].config.references,\n      references: reverseRelations[0].config.fields\n    };\n  }\n  throw new Error(\n    `There is not enough information to infer relation \"${sourceTableTsName}.${relation.fieldName}\"`\n  );\n}\nfunction createTableRelationsHelpers(sourceTable) {\n  return {\n    one: createOne(sourceTable),\n    many: createMany(sourceTable)\n  };\n}\nfunction mapRelationalRow(tablesConfig, tableConfig, row, buildQueryResultSelection, mapColumnValue = (value) => value) {\n  const result = {};\n  for (const [\n    selectionItemIndex,\n    selectionItem\n  ] of buildQueryResultSelection.entries()) {\n    if (selectionItem.isJson) {\n      const relation = tableConfig.relations[selectionItem.tsKey];\n      const rawSubRows = row[selectionItemIndex];\n      const subRows = typeof rawSubRows === \"string\" ? JSON.parse(rawSubRows) : rawSubRows;\n      result[selectionItem.tsKey] = is(relation, One) ? subRows && mapRelationalRow(\n        tablesConfig,\n        tablesConfig[selectionItem.relationTableTsKey],\n        subRows,\n        selectionItem.selection,\n        mapColumnValue\n      ) : subRows.map(\n        (subRow) => mapRelationalRow(\n          tablesConfig,\n          tablesConfig[selectionItem.relationTableTsKey],\n          subRow,\n          selectionItem.selection,\n          mapColumnValue\n        )\n      );\n    } else {\n      const value = mapColumnValue(row[selectionItemIndex]);\n      const field = selectionItem.field;\n      let decoder;\n      if (is(field, Column)) {\n        decoder = field;\n      } else if (is(field, SQL)) {\n        decoder = field.decoder;\n      } else {\n        decoder = field.sql.decoder;\n      }\n      result[selectionItem.tsKey] = value === null ? null : decoder.mapFromDriverValue(value);\n    }\n  }\n  return result;\n}\nexport {\n  Many,\n  One,\n  Relation,\n  Relations,\n  createMany,\n  createOne,\n  createTableRelationsHelpers,\n  extractTablesRelationalConfig,\n  getOperators,\n  getOrderByOperators,\n  mapRelationalRow,\n  normalizeRelation,\n  relations\n};\n//# sourceMappingURL=relations.js.map","import { bigint } from \"./bigint.js\";\nimport { bigserial } from \"./bigserial.js\";\nimport { boolean } from \"./boolean.js\";\nimport { char } from \"./char.js\";\nimport { cidr } from \"./cidr.js\";\nimport { customType } from \"./custom.js\";\nimport { date } from \"./date.js\";\nimport { doublePrecision } from \"./double-precision.js\";\nimport { inet } from \"./inet.js\";\nimport { integer } from \"./integer.js\";\nimport { interval } from \"./interval.js\";\nimport { json } from \"./json.js\";\nimport { jsonb } from \"./jsonb.js\";\nimport { line } from \"./line.js\";\nimport { macaddr } from \"./macaddr.js\";\nimport { macaddr8 } from \"./macaddr8.js\";\nimport { numeric } from \"./numeric.js\";\nimport { point } from \"./point.js\";\nimport { geometry } from \"./postgis_extension/geometry.js\";\nimport { real } from \"./real.js\";\nimport { serial } from \"./serial.js\";\nimport { smallint } from \"./smallint.js\";\nimport { smallserial } from \"./smallserial.js\";\nimport { text } from \"./text.js\";\nimport { time } from \"./time.js\";\nimport { timestamp } from \"./timestamp.js\";\nimport { uuid } from \"./uuid.js\";\nimport { varchar } from \"./varchar.js\";\nimport { bit } from \"./vector_extension/bit.js\";\nimport { halfvec } from \"./vector_extension/halfvec.js\";\nimport { sparsevec } from \"./vector_extension/sparsevec.js\";\nimport { vector } from \"./vector_extension/vector.js\";\nfunction getPgColumnBuilders() {\n  return {\n    bigint,\n    bigserial,\n    boolean,\n    char,\n    cidr,\n    customType,\n    date,\n    doublePrecision,\n    inet,\n    integer,\n    interval,\n    json,\n    jsonb,\n    line,\n    macaddr,\n    macaddr8,\n    numeric,\n    point,\n    geometry,\n    real,\n    serial,\n    smallint,\n    smallserial,\n    text,\n    time,\n    timestamp,\n    uuid,\n    varchar,\n    bit,\n    halfvec,\n    sparsevec,\n    vector\n  };\n}\nexport {\n  getPgColumnBuilders\n};\n//# sourceMappingURL=all.js.map","import { aliasedTable, aliasedTableColumn, mapColumnsInAliasedSQLToAlias, mapColumnsInSQLToAlias } from \"../alias.js\";\nimport { CasingCache } from \"../casing.js\";\nimport { Column } from \"../column.js\";\nimport { entityKind, is } from \"../entity.js\";\nimport { DrizzleError } from \"../errors.js\";\nimport {\n  PgColumn,\n  PgDate,\n  PgDateString,\n  PgJson,\n  PgJsonb,\n  PgNumeric,\n  PgTime,\n  PgTimestamp,\n  PgTimestampString,\n  PgUUID\n} from \"./columns/index.js\";\nimport { PgTable } from \"./table.js\";\nimport {\n  getOperators,\n  getOrderByOperators,\n  Many,\n  normalizeRelation,\n  One\n} from \"../relations.js\";\nimport { and, eq, View } from \"../sql/index.js\";\nimport {\n  Param,\n  SQL,\n  sql\n} from \"../sql/sql.js\";\nimport { Subquery } from \"../subquery.js\";\nimport { getTableName, getTableUniqueName, Table } from \"../table.js\";\nimport { orderSelectedFields } from \"../utils.js\";\nimport { ViewBaseConfig } from \"../view-common.js\";\nimport { PgViewBase } from \"./view-base.js\";\nclass PgDialect {\n  static [entityKind] = \"PgDialect\";\n  /** @internal */\n  casing;\n  constructor(config) {\n    this.casing = new CasingCache(config?.casing);\n  }\n  async migrate(migrations, session, config) {\n    const migrationsTable = typeof config === \"string\" ? \"__drizzle_migrations\" : config.migrationsTable ?? \"__drizzle_migrations\";\n    const migrationsSchema = typeof config === \"string\" ? \"drizzle\" : config.migrationsSchema ?? \"drizzle\";\n    const migrationTableCreate = sql`\n\t\t\tCREATE TABLE IF NOT EXISTS ${sql.identifier(migrationsSchema)}.${sql.identifier(migrationsTable)} (\n\t\t\t\tid SERIAL PRIMARY KEY,\n\t\t\t\thash text NOT NULL,\n\t\t\t\tcreated_at bigint\n\t\t\t)\n\t\t`;\n    await session.execute(sql`CREATE SCHEMA IF NOT EXISTS ${sql.identifier(migrationsSchema)}`);\n    await session.execute(migrationTableCreate);\n    const dbMigrations = await session.all(\n      sql`select id, hash, created_at from ${sql.identifier(migrationsSchema)}.${sql.identifier(migrationsTable)} order by created_at desc limit 1`\n    );\n    const lastDbMigration = dbMigrations[0];\n    await session.transaction(async (tx) => {\n      for await (const migration of migrations) {\n        if (!lastDbMigration || Number(lastDbMigration.created_at) < migration.folderMillis) {\n          for (const stmt of migration.sql) {\n            await tx.execute(sql.raw(stmt));\n          }\n          await tx.execute(\n            sql`insert into ${sql.identifier(migrationsSchema)}.${sql.identifier(migrationsTable)} (\"hash\", \"created_at\") values(${migration.hash}, ${migration.folderMillis})`\n          );\n        }\n      }\n    });\n  }\n  escapeName(name) {\n    return `\"${name}\"`;\n  }\n  escapeParam(num) {\n    return `$${num + 1}`;\n  }\n  escapeString(str) {\n    return `'${str.replace(/'/g, \"''\")}'`;\n  }\n  buildWithCTE(queries) {\n    if (!queries?.length) return void 0;\n    const withSqlChunks = [sql`with `];\n    for (const [i, w] of queries.entries()) {\n      withSqlChunks.push(sql`${sql.identifier(w._.alias)} as (${w._.sql})`);\n      if (i < queries.length - 1) {\n        withSqlChunks.push(sql`, `);\n      }\n    }\n    withSqlChunks.push(sql` `);\n    return sql.join(withSqlChunks);\n  }\n  buildDeleteQuery({ table, where, returning, withList }) {\n    const withSql = this.buildWithCTE(withList);\n    const returningSql = returning ? sql` returning ${this.buildSelection(returning, { isSingleTable: true })}` : void 0;\n    const whereSql = where ? sql` where ${where}` : void 0;\n    return sql`${withSql}delete from ${table}${whereSql}${returningSql}`;\n  }\n  buildUpdateSet(table, set) {\n    const tableColumns = table[Table.Symbol.Columns];\n    const columnNames = Object.keys(tableColumns).filter(\n      (colName) => set[colName] !== void 0 || tableColumns[colName]?.onUpdateFn !== void 0\n    );\n    const setSize = columnNames.length;\n    return sql.join(columnNames.flatMap((colName, i) => {\n      const col = tableColumns[colName];\n      const onUpdateFnResult = col.onUpdateFn?.();\n      const value = set[colName] ?? (is(onUpdateFnResult, SQL) ? onUpdateFnResult : sql.param(onUpdateFnResult, col));\n      const res = sql`${sql.identifier(this.casing.getColumnCasing(col))} = ${value}`;\n      if (i < setSize - 1) {\n        return [res, sql.raw(\", \")];\n      }\n      return [res];\n    }));\n  }\n  buildUpdateQuery({ table, set, where, returning, withList, from, joins }) {\n    const withSql = this.buildWithCTE(withList);\n    const tableName = table[PgTable.Symbol.Name];\n    const tableSchema = table[PgTable.Symbol.Schema];\n    const origTableName = table[PgTable.Symbol.OriginalName];\n    const alias = tableName === origTableName ? void 0 : tableName;\n    const tableSql = sql`${tableSchema ? sql`${sql.identifier(tableSchema)}.` : void 0}${sql.identifier(origTableName)}${alias && sql` ${sql.identifier(alias)}`}`;\n    const setSql = this.buildUpdateSet(table, set);\n    const fromSql = from && sql.join([sql.raw(\" from \"), this.buildFromTable(from)]);\n    const joinsSql = this.buildJoins(joins);\n    const returningSql = returning ? sql` returning ${this.buildSelection(returning, { isSingleTable: !from })}` : void 0;\n    const whereSql = where ? sql` where ${where}` : void 0;\n    return sql`${withSql}update ${tableSql} set ${setSql}${fromSql}${joinsSql}${whereSql}${returningSql}`;\n  }\n  /**\n   * Builds selection SQL with provided fields/expressions\n   *\n   * Examples:\n   *\n   * `select <selection> from`\n   *\n   * `insert ... returning <selection>`\n   *\n   * If `isSingleTable` is true, then columns won't be prefixed with table name\n   */\n  buildSelection(fields, { isSingleTable = false } = {}) {\n    const columnsLen = fields.length;\n    const chunks = fields.flatMap(({ field }, i) => {\n      const chunk = [];\n      if (is(field, SQL.Aliased) && field.isSelectionField) {\n        chunk.push(sql.identifier(field.fieldAlias));\n      } else if (is(field, SQL.Aliased) || is(field, SQL)) {\n        const query = is(field, SQL.Aliased) ? field.sql : field;\n        if (isSingleTable) {\n          chunk.push(\n            new SQL(\n              query.queryChunks.map((c) => {\n                if (is(c, PgColumn)) {\n                  return sql.identifier(this.casing.getColumnCasing(c));\n                }\n                return c;\n              })\n            )\n          );\n        } else {\n          chunk.push(query);\n        }\n        if (is(field, SQL.Aliased)) {\n          chunk.push(sql` as ${sql.identifier(field.fieldAlias)}`);\n        }\n      } else if (is(field, Column)) {\n        if (isSingleTable) {\n          chunk.push(sql.identifier(this.casing.getColumnCasing(field)));\n        } else {\n          chunk.push(field);\n        }\n      } else if (is(field, Subquery)) {\n        const entries = Object.entries(field._.selectedFields);\n        if (entries.length === 1) {\n          const entry = entries[0][1];\n          const fieldDecoder = is(entry, SQL) ? entry.decoder : is(entry, Column) ? { mapFromDriverValue: (v) => entry.mapFromDriverValue(v) } : entry.sql.decoder;\n          if (fieldDecoder) {\n            field._.sql.decoder = fieldDecoder;\n          }\n        }\n        chunk.push(field);\n      }\n      if (i < columnsLen - 1) {\n        chunk.push(sql`, `);\n      }\n      return chunk;\n    });\n    return sql.join(chunks);\n  }\n  buildJoins(joins) {\n    if (!joins || joins.length === 0) {\n      return void 0;\n    }\n    const joinsArray = [];\n    for (const [index, joinMeta] of joins.entries()) {\n      if (index === 0) {\n        joinsArray.push(sql` `);\n      }\n      const table = joinMeta.table;\n      const lateralSql = joinMeta.lateral ? sql` lateral` : void 0;\n      const onSql = joinMeta.on ? sql` on ${joinMeta.on}` : void 0;\n      if (is(table, PgTable)) {\n        const tableName = table[PgTable.Symbol.Name];\n        const tableSchema = table[PgTable.Symbol.Schema];\n        const origTableName = table[PgTable.Symbol.OriginalName];\n        const alias = tableName === origTableName ? void 0 : joinMeta.alias;\n        joinsArray.push(\n          sql`${sql.raw(joinMeta.joinType)} join${lateralSql} ${tableSchema ? sql`${sql.identifier(tableSchema)}.` : void 0}${sql.identifier(origTableName)}${alias && sql` ${sql.identifier(alias)}`}${onSql}`\n        );\n      } else if (is(table, View)) {\n        const viewName = table[ViewBaseConfig].name;\n        const viewSchema = table[ViewBaseConfig].schema;\n        const origViewName = table[ViewBaseConfig].originalName;\n        const alias = viewName === origViewName ? void 0 : joinMeta.alias;\n        joinsArray.push(\n          sql`${sql.raw(joinMeta.joinType)} join${lateralSql} ${viewSchema ? sql`${sql.identifier(viewSchema)}.` : void 0}${sql.identifier(origViewName)}${alias && sql` ${sql.identifier(alias)}`}${onSql}`\n        );\n      } else {\n        joinsArray.push(\n          sql`${sql.raw(joinMeta.joinType)} join${lateralSql} ${table}${onSql}`\n        );\n      }\n      if (index < joins.length - 1) {\n        joinsArray.push(sql` `);\n      }\n    }\n    return sql.join(joinsArray);\n  }\n  buildFromTable(table) {\n    if (is(table, Table) && table[Table.Symbol.IsAlias]) {\n      let fullName = sql`${sql.identifier(table[Table.Symbol.OriginalName])}`;\n      if (table[Table.Symbol.Schema]) {\n        fullName = sql`${sql.identifier(table[Table.Symbol.Schema])}.${fullName}`;\n      }\n      return sql`${fullName} ${sql.identifier(table[Table.Symbol.Name])}`;\n    }\n    return table;\n  }\n  buildSelectQuery({\n    withList,\n    fields,\n    fieldsFlat,\n    where,\n    having,\n    table,\n    joins,\n    orderBy,\n    groupBy,\n    limit,\n    offset,\n    lockingClause,\n    distinct,\n    setOperators\n  }) {\n    const fieldsList = fieldsFlat ?? orderSelectedFields(fields);\n    for (const f of fieldsList) {\n      if (is(f.field, Column) && getTableName(f.field.table) !== (is(table, Subquery) ? table._.alias : is(table, PgViewBase) ? table[ViewBaseConfig].name : is(table, SQL) ? void 0 : getTableName(table)) && !((table2) => joins?.some(\n        ({ alias }) => alias === (table2[Table.Symbol.IsAlias] ? getTableName(table2) : table2[Table.Symbol.BaseName])\n      ))(f.field.table)) {\n        const tableName = getTableName(f.field.table);\n        throw new Error(\n          `Your \"${f.path.join(\"->\")}\" field references a column \"${tableName}\".\"${f.field.name}\", but the table \"${tableName}\" is not part of the query! Did you forget to join it?`\n        );\n      }\n    }\n    const isSingleTable = !joins || joins.length === 0;\n    const withSql = this.buildWithCTE(withList);\n    let distinctSql;\n    if (distinct) {\n      distinctSql = distinct === true ? sql` distinct` : sql` distinct on (${sql.join(distinct.on, sql`, `)})`;\n    }\n    const selection = this.buildSelection(fieldsList, { isSingleTable });\n    const tableSql = this.buildFromTable(table);\n    const joinsSql = this.buildJoins(joins);\n    const whereSql = where ? sql` where ${where}` : void 0;\n    const havingSql = having ? sql` having ${having}` : void 0;\n    let orderBySql;\n    if (orderBy && orderBy.length > 0) {\n      orderBySql = sql` order by ${sql.join(orderBy, sql`, `)}`;\n    }\n    let groupBySql;\n    if (groupBy && groupBy.length > 0) {\n      groupBySql = sql` group by ${sql.join(groupBy, sql`, `)}`;\n    }\n    const limitSql = typeof limit === \"object\" || typeof limit === \"number\" && limit >= 0 ? sql` limit ${limit}` : void 0;\n    const offsetSql = offset ? sql` offset ${offset}` : void 0;\n    const lockingClauseSql = sql.empty();\n    if (lockingClause) {\n      const clauseSql = sql` for ${sql.raw(lockingClause.strength)}`;\n      if (lockingClause.config.of) {\n        clauseSql.append(\n          sql` of ${sql.join(\n            Array.isArray(lockingClause.config.of) ? lockingClause.config.of : [lockingClause.config.of],\n            sql`, `\n          )}`\n        );\n      }\n      if (lockingClause.config.noWait) {\n        clauseSql.append(sql` nowait`);\n      } else if (lockingClause.config.skipLocked) {\n        clauseSql.append(sql` skip locked`);\n      }\n      lockingClauseSql.append(clauseSql);\n    }\n    const finalQuery = sql`${withSql}select${distinctSql} ${selection} from ${tableSql}${joinsSql}${whereSql}${groupBySql}${havingSql}${orderBySql}${limitSql}${offsetSql}${lockingClauseSql}`;\n    if (setOperators.length > 0) {\n      return this.buildSetOperations(finalQuery, setOperators);\n    }\n    return finalQuery;\n  }\n  buildSetOperations(leftSelect, setOperators) {\n    const [setOperator, ...rest] = setOperators;\n    if (!setOperator) {\n      throw new Error(\"Cannot pass undefined values to any set operator\");\n    }\n    if (rest.length === 0) {\n      return this.buildSetOperationQuery({ leftSelect, setOperator });\n    }\n    return this.buildSetOperations(\n      this.buildSetOperationQuery({ leftSelect, setOperator }),\n      rest\n    );\n  }\n  buildSetOperationQuery({\n    leftSelect,\n    setOperator: { type, isAll, rightSelect, limit, orderBy, offset }\n  }) {\n    const leftChunk = sql`(${leftSelect.getSQL()}) `;\n    const rightChunk = sql`(${rightSelect.getSQL()})`;\n    let orderBySql;\n    if (orderBy && orderBy.length > 0) {\n      const orderByValues = [];\n      for (const singleOrderBy of orderBy) {\n        if (is(singleOrderBy, PgColumn)) {\n          orderByValues.push(sql.identifier(singleOrderBy.name));\n        } else if (is(singleOrderBy, SQL)) {\n          for (let i = 0; i < singleOrderBy.queryChunks.length; i++) {\n            const chunk = singleOrderBy.queryChunks[i];\n            if (is(chunk, PgColumn)) {\n              singleOrderBy.queryChunks[i] = sql.identifier(chunk.name);\n            }\n          }\n          orderByValues.push(sql`${singleOrderBy}`);\n        } else {\n          orderByValues.push(sql`${singleOrderBy}`);\n        }\n      }\n      orderBySql = sql` order by ${sql.join(orderByValues, sql`, `)} `;\n    }\n    const limitSql = typeof limit === \"object\" || typeof limit === \"number\" && limit >= 0 ? sql` limit ${limit}` : void 0;\n    const operatorChunk = sql.raw(`${type} ${isAll ? \"all \" : \"\"}`);\n    const offsetSql = offset ? sql` offset ${offset}` : void 0;\n    return sql`${leftChunk}${operatorChunk}${rightChunk}${orderBySql}${limitSql}${offsetSql}`;\n  }\n  buildInsertQuery({ table, values: valuesOrSelect, onConflict, returning, withList, select, overridingSystemValue_ }) {\n    const valuesSqlList = [];\n    const columns = table[Table.Symbol.Columns];\n    const colEntries = Object.entries(columns).filter(([_, col]) => !col.shouldDisableInsert());\n    const insertOrder = colEntries.map(\n      ([, column]) => sql.identifier(this.casing.getColumnCasing(column))\n    );\n    if (select) {\n      const select2 = valuesOrSelect;\n      if (is(select2, SQL)) {\n        valuesSqlList.push(select2);\n      } else {\n        valuesSqlList.push(select2.getSQL());\n      }\n    } else {\n      const values = valuesOrSelect;\n      valuesSqlList.push(sql.raw(\"values \"));\n      for (const [valueIndex, value] of values.entries()) {\n        const valueList = [];\n        for (const [fieldName, col] of colEntries) {\n          const colValue = value[fieldName];\n          if (colValue === void 0 || is(colValue, Param) && colValue.value === void 0) {\n            if (col.defaultFn !== void 0) {\n              const defaultFnResult = col.defaultFn();\n              const defaultValue = is(defaultFnResult, SQL) ? defaultFnResult : sql.param(defaultFnResult, col);\n              valueList.push(defaultValue);\n            } else if (!col.default && col.onUpdateFn !== void 0) {\n              const onUpdateFnResult = col.onUpdateFn();\n              const newValue = is(onUpdateFnResult, SQL) ? onUpdateFnResult : sql.param(onUpdateFnResult, col);\n              valueList.push(newValue);\n            } else {\n              valueList.push(sql`default`);\n            }\n          } else {\n            valueList.push(colValue);\n          }\n        }\n        valuesSqlList.push(valueList);\n        if (valueIndex < values.length - 1) {\n          valuesSqlList.push(sql`, `);\n        }\n      }\n    }\n    const withSql = this.buildWithCTE(withList);\n    const valuesSql = sql.join(valuesSqlList);\n    const returningSql = returning ? sql` returning ${this.buildSelection(returning, { isSingleTable: true })}` : void 0;\n    const onConflictSql = onConflict ? sql` on conflict ${onConflict}` : void 0;\n    const overridingSql = overridingSystemValue_ === true ? sql`overriding system value ` : void 0;\n    return sql`${withSql}insert into ${table} ${insertOrder} ${overridingSql}${valuesSql}${onConflictSql}${returningSql}`;\n  }\n  buildRefreshMaterializedViewQuery({ view, concurrently, withNoData }) {\n    const concurrentlySql = concurrently ? sql` concurrently` : void 0;\n    const withNoDataSql = withNoData ? sql` with no data` : void 0;\n    return sql`refresh materialized view${concurrentlySql} ${view}${withNoDataSql}`;\n  }\n  prepareTyping(encoder) {\n    if (is(encoder, PgJsonb) || is(encoder, PgJson)) {\n      return \"json\";\n    } else if (is(encoder, PgNumeric)) {\n      return \"decimal\";\n    } else if (is(encoder, PgTime)) {\n      return \"time\";\n    } else if (is(encoder, PgTimestamp) || is(encoder, PgTimestampString)) {\n      return \"timestamp\";\n    } else if (is(encoder, PgDate) || is(encoder, PgDateString)) {\n      return \"date\";\n    } else if (is(encoder, PgUUID)) {\n      return \"uuid\";\n    } else {\n      return \"none\";\n    }\n  }\n  sqlToQuery(sql2, invokeSource) {\n    return sql2.toQuery({\n      casing: this.casing,\n      escapeName: this.escapeName,\n      escapeParam: this.escapeParam,\n      escapeString: this.escapeString,\n      prepareTyping: this.prepareTyping,\n      invokeSource\n    });\n  }\n  // buildRelationalQueryWithPK({\n  // \tfullSchema,\n  // \tschema,\n  // \ttableNamesMap,\n  // \ttable,\n  // \ttableConfig,\n  // \tqueryConfig: config,\n  // \ttableAlias,\n  // \tisRoot = false,\n  // \tjoinOn,\n  // }: {\n  // \tfullSchema: Record<string, unknown>;\n  // \tschema: TablesRelationalConfig;\n  // \ttableNamesMap: Record<string, string>;\n  // \ttable: PgTable;\n  // \ttableConfig: TableRelationalConfig;\n  // \tqueryConfig: true | DBQueryConfig<'many', true>;\n  // \ttableAlias: string;\n  // \tisRoot?: boolean;\n  // \tjoinOn?: SQL;\n  // }): BuildRelationalQueryResult<PgTable, PgColumn> {\n  // \t// For { \"<relation>\": true }, return a table with selection of all columns\n  // \tif (config === true) {\n  // \t\tconst selectionEntries = Object.entries(tableConfig.columns);\n  // \t\tconst selection: BuildRelationalQueryResult<PgTable, PgColumn>['selection'] = selectionEntries.map((\n  // \t\t\t[key, value],\n  // \t\t) => ({\n  // \t\t\tdbKey: value.name,\n  // \t\t\ttsKey: key,\n  // \t\t\tfield: value as PgColumn,\n  // \t\t\trelationTableTsKey: undefined,\n  // \t\t\tisJson: false,\n  // \t\t\tselection: [],\n  // \t\t}));\n  // \t\treturn {\n  // \t\t\ttableTsKey: tableConfig.tsName,\n  // \t\t\tsql: table,\n  // \t\t\tselection,\n  // \t\t};\n  // \t}\n  // \t// let selection: BuildRelationalQueryResult<PgTable, PgColumn>['selection'] = [];\n  // \t// let selectionForBuild = selection;\n  // \tconst aliasedColumns = Object.fromEntries(\n  // \t\tObject.entries(tableConfig.columns).map(([key, value]) => [key, aliasedTableColumn(value, tableAlias)]),\n  // \t);\n  // \tconst aliasedRelations = Object.fromEntries(\n  // \t\tObject.entries(tableConfig.relations).map(([key, value]) => [key, aliasedRelation(value, tableAlias)]),\n  // \t);\n  // \tconst aliasedFields = Object.assign({}, aliasedColumns, aliasedRelations);\n  // \tlet where, hasUserDefinedWhere;\n  // \tif (config.where) {\n  // \t\tconst whereSql = typeof config.where === 'function' ? config.where(aliasedFields, operators) : config.where;\n  // \t\twhere = whereSql && mapColumnsInSQLToAlias(whereSql, tableAlias);\n  // \t\thasUserDefinedWhere = !!where;\n  // \t}\n  // \twhere = and(joinOn, where);\n  // \t// const fieldsSelection: { tsKey: string; value: PgColumn | SQL.Aliased; isExtra?: boolean }[] = [];\n  // \tlet joins: Join[] = [];\n  // \tlet selectedColumns: string[] = [];\n  // \t// Figure out which columns to select\n  // \tif (config.columns) {\n  // \t\tlet isIncludeMode = false;\n  // \t\tfor (const [field, value] of Object.entries(config.columns)) {\n  // \t\t\tif (value === undefined) {\n  // \t\t\t\tcontinue;\n  // \t\t\t}\n  // \t\t\tif (field in tableConfig.columns) {\n  // \t\t\t\tif (!isIncludeMode && value === true) {\n  // \t\t\t\t\tisIncludeMode = true;\n  // \t\t\t\t}\n  // \t\t\t\tselectedColumns.push(field);\n  // \t\t\t}\n  // \t\t}\n  // \t\tif (selectedColumns.length > 0) {\n  // \t\t\tselectedColumns = isIncludeMode\n  // \t\t\t\t? selectedColumns.filter((c) => config.columns?.[c] === true)\n  // \t\t\t\t: Object.keys(tableConfig.columns).filter((key) => !selectedColumns.includes(key));\n  // \t\t}\n  // \t} else {\n  // \t\t// Select all columns if selection is not specified\n  // \t\tselectedColumns = Object.keys(tableConfig.columns);\n  // \t}\n  // \t// for (const field of selectedColumns) {\n  // \t// \tconst column = tableConfig.columns[field]! as PgColumn;\n  // \t// \tfieldsSelection.push({ tsKey: field, value: column });\n  // \t// }\n  // \tlet initiallySelectedRelations: {\n  // \t\ttsKey: string;\n  // \t\tqueryConfig: true | DBQueryConfig<'many', false>;\n  // \t\trelation: Relation;\n  // \t}[] = [];\n  // \t// let selectedRelations: BuildRelationalQueryResult<PgTable, PgColumn>['selection'] = [];\n  // \t// Figure out which relations to select\n  // \tif (config.with) {\n  // \t\tinitiallySelectedRelations = Object.entries(config.with)\n  // \t\t\t.filter((entry): entry is [typeof entry[0], NonNullable<typeof entry[1]>] => !!entry[1])\n  // \t\t\t.map(([tsKey, queryConfig]) => ({ tsKey, queryConfig, relation: tableConfig.relations[tsKey]! }));\n  // \t}\n  // \tconst manyRelations = initiallySelectedRelations.filter((r) =>\n  // \t\tis(r.relation, Many)\n  // \t\t&& (schema[tableNamesMap[r.relation.referencedTable[Table.Symbol.Name]]!]?.primaryKey.length ?? 0) > 0\n  // \t);\n  // \t// If this is the last Many relation (or there are no Many relations), we are on the innermost subquery level\n  // \tconst isInnermostQuery = manyRelations.length < 2;\n  // \tconst selectedExtras: {\n  // \t\ttsKey: string;\n  // \t\tvalue: SQL.Aliased;\n  // \t}[] = [];\n  // \t// Figure out which extras to select\n  // \tif (isInnermostQuery && config.extras) {\n  // \t\tconst extras = typeof config.extras === 'function'\n  // \t\t\t? config.extras(aliasedFields, { sql })\n  // \t\t\t: config.extras;\n  // \t\tfor (const [tsKey, value] of Object.entries(extras)) {\n  // \t\t\tselectedExtras.push({\n  // \t\t\t\ttsKey,\n  // \t\t\t\tvalue: mapColumnsInAliasedSQLToAlias(value, tableAlias),\n  // \t\t\t});\n  // \t\t}\n  // \t}\n  // \t// Transform `fieldsSelection` into `selection`\n  // \t// `fieldsSelection` shouldn't be used after this point\n  // \t// for (const { tsKey, value, isExtra } of fieldsSelection) {\n  // \t// \tselection.push({\n  // \t// \t\tdbKey: is(value, SQL.Aliased) ? value.fieldAlias : tableConfig.columns[tsKey]!.name,\n  // \t// \t\ttsKey,\n  // \t// \t\tfield: is(value, Column) ? aliasedTableColumn(value, tableAlias) : value,\n  // \t// \t\trelationTableTsKey: undefined,\n  // \t// \t\tisJson: false,\n  // \t// \t\tisExtra,\n  // \t// \t\tselection: [],\n  // \t// \t});\n  // \t// }\n  // \tlet orderByOrig = typeof config.orderBy === 'function'\n  // \t\t? config.orderBy(aliasedFields, orderByOperators)\n  // \t\t: config.orderBy ?? [];\n  // \tif (!Array.isArray(orderByOrig)) {\n  // \t\torderByOrig = [orderByOrig];\n  // \t}\n  // \tconst orderBy = orderByOrig.map((orderByValue) => {\n  // \t\tif (is(orderByValue, Column)) {\n  // \t\t\treturn aliasedTableColumn(orderByValue, tableAlias) as PgColumn;\n  // \t\t}\n  // \t\treturn mapColumnsInSQLToAlias(orderByValue, tableAlias);\n  // \t});\n  // \tconst limit = isInnermostQuery ? config.limit : undefined;\n  // \tconst offset = isInnermostQuery ? config.offset : undefined;\n  // \t// For non-root queries without additional config except columns, return a table with selection\n  // \tif (\n  // \t\t!isRoot\n  // \t\t&& initiallySelectedRelations.length === 0\n  // \t\t&& selectedExtras.length === 0\n  // \t\t&& !where\n  // \t\t&& orderBy.length === 0\n  // \t\t&& limit === undefined\n  // \t\t&& offset === undefined\n  // \t) {\n  // \t\treturn {\n  // \t\t\ttableTsKey: tableConfig.tsName,\n  // \t\t\tsql: table,\n  // \t\t\tselection: selectedColumns.map((key) => ({\n  // \t\t\t\tdbKey: tableConfig.columns[key]!.name,\n  // \t\t\t\ttsKey: key,\n  // \t\t\t\tfield: tableConfig.columns[key] as PgColumn,\n  // \t\t\t\trelationTableTsKey: undefined,\n  // \t\t\t\tisJson: false,\n  // \t\t\t\tselection: [],\n  // \t\t\t})),\n  // \t\t};\n  // \t}\n  // \tconst selectedRelationsWithoutPK:\n  // \t// Process all relations without primary keys, because they need to be joined differently and will all be on the same query level\n  // \tfor (\n  // \t\tconst {\n  // \t\t\ttsKey: selectedRelationTsKey,\n  // \t\t\tqueryConfig: selectedRelationConfigValue,\n  // \t\t\trelation,\n  // \t\t} of initiallySelectedRelations\n  // \t) {\n  // \t\tconst normalizedRelation = normalizeRelation(schema, tableNamesMap, relation);\n  // \t\tconst relationTableName = relation.referencedTable[Table.Symbol.Name];\n  // \t\tconst relationTableTsName = tableNamesMap[relationTableName]!;\n  // \t\tconst relationTable = schema[relationTableTsName]!;\n  // \t\tif (relationTable.primaryKey.length > 0) {\n  // \t\t\tcontinue;\n  // \t\t}\n  // \t\tconst relationTableAlias = `${tableAlias}_${selectedRelationTsKey}`;\n  // \t\tconst joinOn = and(\n  // \t\t\t...normalizedRelation.fields.map((field, i) =>\n  // \t\t\t\teq(\n  // \t\t\t\t\taliasedTableColumn(normalizedRelation.references[i]!, relationTableAlias),\n  // \t\t\t\t\taliasedTableColumn(field, tableAlias),\n  // \t\t\t\t)\n  // \t\t\t),\n  // \t\t);\n  // \t\tconst builtRelation = this.buildRelationalQueryWithoutPK({\n  // \t\t\tfullSchema,\n  // \t\t\tschema,\n  // \t\t\ttableNamesMap,\n  // \t\t\ttable: fullSchema[relationTableTsName] as PgTable,\n  // \t\t\ttableConfig: schema[relationTableTsName]!,\n  // \t\t\tqueryConfig: selectedRelationConfigValue,\n  // \t\t\ttableAlias: relationTableAlias,\n  // \t\t\tjoinOn,\n  // \t\t\tnestedQueryRelation: relation,\n  // \t\t});\n  // \t\tconst field = sql`${sql.identifier(relationTableAlias)}.${sql.identifier('data')}`.as(selectedRelationTsKey);\n  // \t\tjoins.push({\n  // \t\t\ton: sql`true`,\n  // \t\t\ttable: new Subquery(builtRelation.sql as SQL, {}, relationTableAlias),\n  // \t\t\talias: relationTableAlias,\n  // \t\t\tjoinType: 'left',\n  // \t\t\tlateral: true,\n  // \t\t});\n  // \t\tselectedRelations.push({\n  // \t\t\tdbKey: selectedRelationTsKey,\n  // \t\t\ttsKey: selectedRelationTsKey,\n  // \t\t\tfield,\n  // \t\t\trelationTableTsKey: relationTableTsName,\n  // \t\t\tisJson: true,\n  // \t\t\tselection: builtRelation.selection,\n  // \t\t});\n  // \t}\n  // \tconst oneRelations = initiallySelectedRelations.filter((r): r is typeof r & { relation: One } =>\n  // \t\tis(r.relation, One)\n  // \t);\n  // \t// Process all One relations with PKs, because they can all be joined on the same level\n  // \tfor (\n  // \t\tconst {\n  // \t\t\ttsKey: selectedRelationTsKey,\n  // \t\t\tqueryConfig: selectedRelationConfigValue,\n  // \t\t\trelation,\n  // \t\t} of oneRelations\n  // \t) {\n  // \t\tconst normalizedRelation = normalizeRelation(schema, tableNamesMap, relation);\n  // \t\tconst relationTableName = relation.referencedTable[Table.Symbol.Name];\n  // \t\tconst relationTableTsName = tableNamesMap[relationTableName]!;\n  // \t\tconst relationTableAlias = `${tableAlias}_${selectedRelationTsKey}`;\n  // \t\tconst relationTable = schema[relationTableTsName]!;\n  // \t\tif (relationTable.primaryKey.length === 0) {\n  // \t\t\tcontinue;\n  // \t\t}\n  // \t\tconst joinOn = and(\n  // \t\t\t...normalizedRelation.fields.map((field, i) =>\n  // \t\t\t\teq(\n  // \t\t\t\t\taliasedTableColumn(normalizedRelation.references[i]!, relationTableAlias),\n  // \t\t\t\t\taliasedTableColumn(field, tableAlias),\n  // \t\t\t\t)\n  // \t\t\t),\n  // \t\t);\n  // \t\tconst builtRelation = this.buildRelationalQueryWithPK({\n  // \t\t\tfullSchema,\n  // \t\t\tschema,\n  // \t\t\ttableNamesMap,\n  // \t\t\ttable: fullSchema[relationTableTsName] as PgTable,\n  // \t\t\ttableConfig: schema[relationTableTsName]!,\n  // \t\t\tqueryConfig: selectedRelationConfigValue,\n  // \t\t\ttableAlias: relationTableAlias,\n  // \t\t\tjoinOn,\n  // \t\t});\n  // \t\tconst field = sql`case when ${sql.identifier(relationTableAlias)} is null then null else json_build_array(${\n  // \t\t\tsql.join(\n  // \t\t\t\tbuiltRelation.selection.map(({ field }) =>\n  // \t\t\t\t\tis(field, SQL.Aliased)\n  // \t\t\t\t\t\t? sql`${sql.identifier(relationTableAlias)}.${sql.identifier(field.fieldAlias)}`\n  // \t\t\t\t\t\t: is(field, Column)\n  // \t\t\t\t\t\t? aliasedTableColumn(field, relationTableAlias)\n  // \t\t\t\t\t\t: field\n  // \t\t\t\t),\n  // \t\t\t\tsql`, `,\n  // \t\t\t)\n  // \t\t}) end`.as(selectedRelationTsKey);\n  // \t\tconst isLateralJoin = is(builtRelation.sql, SQL);\n  // \t\tjoins.push({\n  // \t\t\ton: isLateralJoin ? sql`true` : joinOn,\n  // \t\t\ttable: is(builtRelation.sql, SQL)\n  // \t\t\t\t? new Subquery(builtRelation.sql, {}, relationTableAlias)\n  // \t\t\t\t: aliasedTable(builtRelation.sql, relationTableAlias),\n  // \t\t\talias: relationTableAlias,\n  // \t\t\tjoinType: 'left',\n  // \t\t\tlateral: is(builtRelation.sql, SQL),\n  // \t\t});\n  // \t\tselectedRelations.push({\n  // \t\t\tdbKey: selectedRelationTsKey,\n  // \t\t\ttsKey: selectedRelationTsKey,\n  // \t\t\tfield,\n  // \t\t\trelationTableTsKey: relationTableTsName,\n  // \t\t\tisJson: true,\n  // \t\t\tselection: builtRelation.selection,\n  // \t\t});\n  // \t}\n  // \tlet distinct: PgSelectConfig['distinct'];\n  // \tlet tableFrom: PgTable | Subquery = table;\n  // \t// Process first Many relation - each one requires a nested subquery\n  // \tconst manyRelation = manyRelations[0];\n  // \tif (manyRelation) {\n  // \t\tconst {\n  // \t\t\ttsKey: selectedRelationTsKey,\n  // \t\t\tqueryConfig: selectedRelationQueryConfig,\n  // \t\t\trelation,\n  // \t\t} = manyRelation;\n  // \t\tdistinct = {\n  // \t\t\ton: tableConfig.primaryKey.map((c) => aliasedTableColumn(c as PgColumn, tableAlias)),\n  // \t\t};\n  // \t\tconst normalizedRelation = normalizeRelation(schema, tableNamesMap, relation);\n  // \t\tconst relationTableName = relation.referencedTable[Table.Symbol.Name];\n  // \t\tconst relationTableTsName = tableNamesMap[relationTableName]!;\n  // \t\tconst relationTableAlias = `${tableAlias}_${selectedRelationTsKey}`;\n  // \t\tconst joinOn = and(\n  // \t\t\t...normalizedRelation.fields.map((field, i) =>\n  // \t\t\t\teq(\n  // \t\t\t\t\taliasedTableColumn(normalizedRelation.references[i]!, relationTableAlias),\n  // \t\t\t\t\taliasedTableColumn(field, tableAlias),\n  // \t\t\t\t)\n  // \t\t\t),\n  // \t\t);\n  // \t\tconst builtRelationJoin = this.buildRelationalQueryWithPK({\n  // \t\t\tfullSchema,\n  // \t\t\tschema,\n  // \t\t\ttableNamesMap,\n  // \t\t\ttable: fullSchema[relationTableTsName] as PgTable,\n  // \t\t\ttableConfig: schema[relationTableTsName]!,\n  // \t\t\tqueryConfig: selectedRelationQueryConfig,\n  // \t\t\ttableAlias: relationTableAlias,\n  // \t\t\tjoinOn,\n  // \t\t});\n  // \t\tconst builtRelationSelectionField = sql`case when ${\n  // \t\t\tsql.identifier(relationTableAlias)\n  // \t\t} is null then '[]' else json_agg(json_build_array(${\n  // \t\t\tsql.join(\n  // \t\t\t\tbuiltRelationJoin.selection.map(({ field }) =>\n  // \t\t\t\t\tis(field, SQL.Aliased)\n  // \t\t\t\t\t\t? sql`${sql.identifier(relationTableAlias)}.${sql.identifier(field.fieldAlias)}`\n  // \t\t\t\t\t\t: is(field, Column)\n  // \t\t\t\t\t\t? aliasedTableColumn(field, relationTableAlias)\n  // \t\t\t\t\t\t: field\n  // \t\t\t\t),\n  // \t\t\t\tsql`, `,\n  // \t\t\t)\n  // \t\t})) over (partition by ${sql.join(distinct.on, sql`, `)}) end`.as(selectedRelationTsKey);\n  // \t\tconst isLateralJoin = is(builtRelationJoin.sql, SQL);\n  // \t\tjoins.push({\n  // \t\t\ton: isLateralJoin ? sql`true` : joinOn,\n  // \t\t\ttable: isLateralJoin\n  // \t\t\t\t? new Subquery(builtRelationJoin.sql as SQL, {}, relationTableAlias)\n  // \t\t\t\t: aliasedTable(builtRelationJoin.sql as PgTable, relationTableAlias),\n  // \t\t\talias: relationTableAlias,\n  // \t\t\tjoinType: 'left',\n  // \t\t\tlateral: isLateralJoin,\n  // \t\t});\n  // \t\t// Build the \"from\" subquery with the remaining Many relations\n  // \t\tconst builtTableFrom = this.buildRelationalQueryWithPK({\n  // \t\t\tfullSchema,\n  // \t\t\tschema,\n  // \t\t\ttableNamesMap,\n  // \t\t\ttable,\n  // \t\t\ttableConfig,\n  // \t\t\tqueryConfig: {\n  // \t\t\t\t...config,\n  // \t\t\t\twhere: undefined,\n  // \t\t\t\torderBy: undefined,\n  // \t\t\t\tlimit: undefined,\n  // \t\t\t\toffset: undefined,\n  // \t\t\t\twith: manyRelations.slice(1).reduce<NonNullable<typeof config['with']>>(\n  // \t\t\t\t\t(result, { tsKey, queryConfig: configValue }) => {\n  // \t\t\t\t\t\tresult[tsKey] = configValue;\n  // \t\t\t\t\t\treturn result;\n  // \t\t\t\t\t},\n  // \t\t\t\t\t{},\n  // \t\t\t\t),\n  // \t\t\t},\n  // \t\t\ttableAlias,\n  // \t\t});\n  // \t\tselectedRelations.push({\n  // \t\t\tdbKey: selectedRelationTsKey,\n  // \t\t\ttsKey: selectedRelationTsKey,\n  // \t\t\tfield: builtRelationSelectionField,\n  // \t\t\trelationTableTsKey: relationTableTsName,\n  // \t\t\tisJson: true,\n  // \t\t\tselection: builtRelationJoin.selection,\n  // \t\t});\n  // \t\t// selection = builtTableFrom.selection.map((item) =>\n  // \t\t// \tis(item.field, SQL.Aliased)\n  // \t\t// \t\t? { ...item, field: sql`${sql.identifier(tableAlias)}.${sql.identifier(item.field.fieldAlias)}` }\n  // \t\t// \t\t: item\n  // \t\t// );\n  // \t\t// selectionForBuild = [{\n  // \t\t// \tdbKey: '*',\n  // \t\t// \ttsKey: '*',\n  // \t\t// \tfield: sql`${sql.identifier(tableAlias)}.*`,\n  // \t\t// \tselection: [],\n  // \t\t// \tisJson: false,\n  // \t\t// \trelationTableTsKey: undefined,\n  // \t\t// }];\n  // \t\t// const newSelectionItem: (typeof selection)[number] = {\n  // \t\t// \tdbKey: selectedRelationTsKey,\n  // \t\t// \ttsKey: selectedRelationTsKey,\n  // \t\t// \tfield,\n  // \t\t// \trelationTableTsKey: relationTableTsName,\n  // \t\t// \tisJson: true,\n  // \t\t// \tselection: builtRelationJoin.selection,\n  // \t\t// };\n  // \t\t// selection.push(newSelectionItem);\n  // \t\t// selectionForBuild.push(newSelectionItem);\n  // \t\ttableFrom = is(builtTableFrom.sql, PgTable)\n  // \t\t\t? builtTableFrom.sql\n  // \t\t\t: new Subquery(builtTableFrom.sql, {}, tableAlias);\n  // \t}\n  // \tif (selectedColumns.length === 0 && selectedRelations.length === 0 && selectedExtras.length === 0) {\n  // \t\tthrow new DrizzleError(`No fields selected for table \"${tableConfig.tsName}\" (\"${tableAlias}\")`);\n  // \t}\n  // \tlet selection: BuildRelationalQueryResult<PgTable, PgColumn>['selection'];\n  // \tfunction prepareSelectedColumns() {\n  // \t\treturn selectedColumns.map((key) => ({\n  // \t\t\tdbKey: tableConfig.columns[key]!.name,\n  // \t\t\ttsKey: key,\n  // \t\t\tfield: tableConfig.columns[key] as PgColumn,\n  // \t\t\trelationTableTsKey: undefined,\n  // \t\t\tisJson: false,\n  // \t\t\tselection: [],\n  // \t\t}));\n  // \t}\n  // \tfunction prepareSelectedExtras() {\n  // \t\treturn selectedExtras.map((item) => ({\n  // \t\t\tdbKey: item.value.fieldAlias,\n  // \t\t\ttsKey: item.tsKey,\n  // \t\t\tfield: item.value,\n  // \t\t\trelationTableTsKey: undefined,\n  // \t\t\tisJson: false,\n  // \t\t\tselection: [],\n  // \t\t}));\n  // \t}\n  // \tif (isRoot) {\n  // \t\tselection = [\n  // \t\t\t...prepareSelectedColumns(),\n  // \t\t\t...prepareSelectedExtras(),\n  // \t\t];\n  // \t}\n  // \tif (hasUserDefinedWhere || orderBy.length > 0) {\n  // \t\ttableFrom = new Subquery(\n  // \t\t\tthis.buildSelectQuery({\n  // \t\t\t\ttable: is(tableFrom, PgTable) ? aliasedTable(tableFrom, tableAlias) : tableFrom,\n  // \t\t\t\tfields: {},\n  // \t\t\t\tfieldsFlat: selectionForBuild.map(({ field }) => ({\n  // \t\t\t\t\tpath: [],\n  // \t\t\t\t\tfield: is(field, Column) ? aliasedTableColumn(field, tableAlias) : field,\n  // \t\t\t\t})),\n  // \t\t\t\tjoins,\n  // \t\t\t\tdistinct,\n  // \t\t\t}),\n  // \t\t\t{},\n  // \t\t\ttableAlias,\n  // \t\t);\n  // \t\tselectionForBuild = selection.map((item) =>\n  // \t\t\tis(item.field, SQL.Aliased)\n  // \t\t\t\t? { ...item, field: sql`${sql.identifier(tableAlias)}.${sql.identifier(item.field.fieldAlias)}` }\n  // \t\t\t\t: item\n  // \t\t);\n  // \t\tjoins = [];\n  // \t\tdistinct = undefined;\n  // \t}\n  // \tconst result = this.buildSelectQuery({\n  // \t\ttable: is(tableFrom, PgTable) ? aliasedTable(tableFrom, tableAlias) : tableFrom,\n  // \t\tfields: {},\n  // \t\tfieldsFlat: selectionForBuild.map(({ field }) => ({\n  // \t\t\tpath: [],\n  // \t\t\tfield: is(field, Column) ? aliasedTableColumn(field, tableAlias) : field,\n  // \t\t})),\n  // \t\twhere,\n  // \t\tlimit,\n  // \t\toffset,\n  // \t\tjoins,\n  // \t\torderBy,\n  // \t\tdistinct,\n  // \t});\n  // \treturn {\n  // \t\ttableTsKey: tableConfig.tsName,\n  // \t\tsql: result,\n  // \t\tselection,\n  // \t};\n  // }\n  buildRelationalQueryWithoutPK({\n    fullSchema,\n    schema,\n    tableNamesMap,\n    table,\n    tableConfig,\n    queryConfig: config,\n    tableAlias,\n    nestedQueryRelation,\n    joinOn\n  }) {\n    let selection = [];\n    let limit, offset, orderBy = [], where;\n    const joins = [];\n    if (config === true) {\n      const selectionEntries = Object.entries(tableConfig.columns);\n      selection = selectionEntries.map(([key, value]) => ({\n        dbKey: value.name,\n        tsKey: key,\n        field: aliasedTableColumn(value, tableAlias),\n        relationTableTsKey: void 0,\n        isJson: false,\n        selection: []\n      }));\n    } else {\n      const aliasedColumns = Object.fromEntries(\n        Object.entries(tableConfig.columns).map(([key, value]) => [key, aliasedTableColumn(value, tableAlias)])\n      );\n      if (config.where) {\n        const whereSql = typeof config.where === \"function\" ? config.where(aliasedColumns, getOperators()) : config.where;\n        where = whereSql && mapColumnsInSQLToAlias(whereSql, tableAlias);\n      }\n      const fieldsSelection = [];\n      let selectedColumns = [];\n      if (config.columns) {\n        let isIncludeMode = false;\n        for (const [field, value] of Object.entries(config.columns)) {\n          if (value === void 0) {\n            continue;\n          }\n          if (field in tableConfig.columns) {\n            if (!isIncludeMode && value === true) {\n              isIncludeMode = true;\n            }\n            selectedColumns.push(field);\n          }\n        }\n        if (selectedColumns.length > 0) {\n          selectedColumns = isIncludeMode ? selectedColumns.filter((c) => config.columns?.[c] === true) : Object.keys(tableConfig.columns).filter((key) => !selectedColumns.includes(key));\n        }\n      } else {\n        selectedColumns = Object.keys(tableConfig.columns);\n      }\n      for (const field of selectedColumns) {\n        const column = tableConfig.columns[field];\n        fieldsSelection.push({ tsKey: field, value: column });\n      }\n      let selectedRelations = [];\n      if (config.with) {\n        selectedRelations = Object.entries(config.with).filter((entry) => !!entry[1]).map(([tsKey, queryConfig]) => ({ tsKey, queryConfig, relation: tableConfig.relations[tsKey] }));\n      }\n      let extras;\n      if (config.extras) {\n        extras = typeof config.extras === \"function\" ? config.extras(aliasedColumns, { sql }) : config.extras;\n        for (const [tsKey, value] of Object.entries(extras)) {\n          fieldsSelection.push({\n            tsKey,\n            value: mapColumnsInAliasedSQLToAlias(value, tableAlias)\n          });\n        }\n      }\n      for (const { tsKey, value } of fieldsSelection) {\n        selection.push({\n          dbKey: is(value, SQL.Aliased) ? value.fieldAlias : tableConfig.columns[tsKey].name,\n          tsKey,\n          field: is(value, Column) ? aliasedTableColumn(value, tableAlias) : value,\n          relationTableTsKey: void 0,\n          isJson: false,\n          selection: []\n        });\n      }\n      let orderByOrig = typeof config.orderBy === \"function\" ? config.orderBy(aliasedColumns, getOrderByOperators()) : config.orderBy ?? [];\n      if (!Array.isArray(orderByOrig)) {\n        orderByOrig = [orderByOrig];\n      }\n      orderBy = orderByOrig.map((orderByValue) => {\n        if (is(orderByValue, Column)) {\n          return aliasedTableColumn(orderByValue, tableAlias);\n        }\n        return mapColumnsInSQLToAlias(orderByValue, tableAlias);\n      });\n      limit = config.limit;\n      offset = config.offset;\n      for (const {\n        tsKey: selectedRelationTsKey,\n        queryConfig: selectedRelationConfigValue,\n        relation\n      } of selectedRelations) {\n        const normalizedRelation = normalizeRelation(schema, tableNamesMap, relation);\n        const relationTableName = getTableUniqueName(relation.referencedTable);\n        const relationTableTsName = tableNamesMap[relationTableName];\n        const relationTableAlias = `${tableAlias}_${selectedRelationTsKey}`;\n        const joinOn2 = and(\n          ...normalizedRelation.fields.map(\n            (field2, i) => eq(\n              aliasedTableColumn(normalizedRelation.references[i], relationTableAlias),\n              aliasedTableColumn(field2, tableAlias)\n            )\n          )\n        );\n        const builtRelation = this.buildRelationalQueryWithoutPK({\n          fullSchema,\n          schema,\n          tableNamesMap,\n          table: fullSchema[relationTableTsName],\n          tableConfig: schema[relationTableTsName],\n          queryConfig: is(relation, One) ? selectedRelationConfigValue === true ? { limit: 1 } : { ...selectedRelationConfigValue, limit: 1 } : selectedRelationConfigValue,\n          tableAlias: relationTableAlias,\n          joinOn: joinOn2,\n          nestedQueryRelation: relation\n        });\n        const field = sql`${sql.identifier(relationTableAlias)}.${sql.identifier(\"data\")}`.as(selectedRelationTsKey);\n        joins.push({\n          on: sql`true`,\n          table: new Subquery(builtRelation.sql, {}, relationTableAlias),\n          alias: relationTableAlias,\n          joinType: \"left\",\n          lateral: true\n        });\n        selection.push({\n          dbKey: selectedRelationTsKey,\n          tsKey: selectedRelationTsKey,\n          field,\n          relationTableTsKey: relationTableTsName,\n          isJson: true,\n          selection: builtRelation.selection\n        });\n      }\n    }\n    if (selection.length === 0) {\n      throw new DrizzleError({ message: `No fields selected for table \"${tableConfig.tsName}\" (\"${tableAlias}\")` });\n    }\n    let result;\n    where = and(joinOn, where);\n    if (nestedQueryRelation) {\n      let field = sql`json_build_array(${sql.join(\n        selection.map(\n          ({ field: field2, tsKey, isJson }) => isJson ? sql`${sql.identifier(`${tableAlias}_${tsKey}`)}.${sql.identifier(\"data\")}` : is(field2, SQL.Aliased) ? field2.sql : field2\n        ),\n        sql`, `\n      )})`;\n      if (is(nestedQueryRelation, Many)) {\n        field = sql`coalesce(json_agg(${field}${orderBy.length > 0 ? sql` order by ${sql.join(orderBy, sql`, `)}` : void 0}), '[]'::json)`;\n      }\n      const nestedSelection = [{\n        dbKey: \"data\",\n        tsKey: \"data\",\n        field: field.as(\"data\"),\n        isJson: true,\n        relationTableTsKey: tableConfig.tsName,\n        selection\n      }];\n      const needsSubquery = limit !== void 0 || offset !== void 0 || orderBy.length > 0;\n      if (needsSubquery) {\n        result = this.buildSelectQuery({\n          table: aliasedTable(table, tableAlias),\n          fields: {},\n          fieldsFlat: [{\n            path: [],\n            field: sql.raw(\"*\")\n          }],\n          where,\n          limit,\n          offset,\n          orderBy,\n          setOperators: []\n        });\n        where = void 0;\n        limit = void 0;\n        offset = void 0;\n        orderBy = [];\n      } else {\n        result = aliasedTable(table, tableAlias);\n      }\n      result = this.buildSelectQuery({\n        table: is(result, PgTable) ? result : new Subquery(result, {}, tableAlias),\n        fields: {},\n        fieldsFlat: nestedSelection.map(({ field: field2 }) => ({\n          path: [],\n          field: is(field2, Column) ? aliasedTableColumn(field2, tableAlias) : field2\n        })),\n        joins,\n        where,\n        limit,\n        offset,\n        orderBy,\n        setOperators: []\n      });\n    } else {\n      result = this.buildSelectQuery({\n        table: aliasedTable(table, tableAlias),\n        fields: {},\n        fieldsFlat: selection.map(({ field }) => ({\n          path: [],\n          field: is(field, Column) ? aliasedTableColumn(field, tableAlias) : field\n        })),\n        joins,\n        where,\n        limit,\n        offset,\n        orderBy,\n        setOperators: []\n      });\n    }\n    return {\n      tableTsKey: tableConfig.tsName,\n      sql: result,\n      selection\n    };\n  }\n}\nexport {\n  PgDialect\n};\n//# sourceMappingURL=dialect.js.map","import { pgTable, uuid, varchar, jsonb, timestamp, boolean } from 'drizzle-orm/pg-core';\n\nexport interface SchoolConfig {\n  internshipDays: number;\n  requireMinTwoCompanies: boolean;\n  modules: {\n    expectations: boolean;\n    observations: boolean;\n    portfolio: boolean;\n    grading: boolean;\n  };\n  notifications: {\n    enabled: boolean;\n    reminderDaysBefore: number[];\n    escalationDaysAfter: number;\n  };\n  assessmentQuestions?: AssessmentQuestion[];\n  milestoneTemplates?: MilestoneTemplate[];\n}\n\nexport interface AssessmentQuestion {\n  id: string;\n  category: string;\n  question: string;\n  type: 'likert' | 'text' | 'boolean';\n  required: boolean;\n}\n\nexport interface MilestoneTemplate {\n  id: string;\n  type: string;\n  title: string;\n  description?: string;\n  phase: 'preparation' | 'execution' | 'followup';\n  defaultDaysOffset: number;\n  required: boolean;\n}\n\nexport interface SmtpConfig {\n  host: string;\n  port: number;\n  user: string;\n  password: string;\n  from: string;\n}\n\nexport const schools = pgTable('schools', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  name: varchar('name', { length: 255 }).notNull(),\n  slug: varchar('slug', { length: 100 }).notNull().unique(),\n\n  config: jsonb('config').$type<SchoolConfig>().default({\n    internshipDays: 15,\n    requireMinTwoCompanies: true,\n    modules: {\n      expectations: true,\n      observations: false,\n      portfolio: true,\n      grading: true,\n    },\n    notifications: {\n      enabled: true,\n      reminderDaysBefore: [7, 2],\n      escalationDaysAfter: 1,\n    },\n  }),\n\n  address: varchar('address', { length: 500 }),\n  email: varchar('email', { length: 255 }),\n  phone: varchar('phone', { length: 50 }),\n  website: varchar('website', { length: 255 }),\n  logoUrl: varchar('logo_url', { length: 500 }),\n\n  emailProvider: varchar('email_provider', { length: 20 }).default('resend'),\n  smtpConfig: jsonb('smtp_config').$type<SmtpConfig>(),\n\n  isActive: boolean('is_active').default(true),\n  createdAt: timestamp('created_at').defaultNow(),\n  updatedAt: timestamp('updated_at').defaultNow(),\n});\n","import type { StandardSchemaV1 } from \"./standard-schema\";\nimport { getAuthHeader } from \"./auth\";\nimport { methods } from \"./create-fetch\";\nimport type { BetterFetchOption, FetchEsque } from \"./types\";\n\nconst JSON_RE = /^application\\/(?:[\\w!#$%&*.^`~-]*\\+)?json(;.+)?$/i;\n\nexport type ResponseType = \"json\" | \"text\" | \"blob\";\nexport function detectResponseType(request: Response): ResponseType {\n\tconst _contentType = request.headers.get(\"content-type\");\n\tconst textTypes = new Set([\n\t\t\"image/svg\",\n\t\t\"application/xml\",\n\t\t\"application/xhtml\",\n\t\t\"application/html\",\n\t]);\n\tif (!_contentType) {\n\t\treturn \"json\";\n\t}\n\tconst contentType = _contentType.split(\";\").shift() || \"\";\n\tif (JSON_RE.test(contentType)) {\n\t\treturn \"json\";\n\t}\n\tif (textTypes.has(contentType) || contentType.startsWith(\"text/\")) {\n\t\treturn \"text\";\n\t}\n\treturn \"blob\";\n}\n\nexport function isJSONParsable(value: any) {\n\ttry {\n\t\tJSON.parse(value);\n\t\treturn true;\n\t} catch (error) {\n\t\treturn false;\n\t}\n}\n\n//https://github.com/unjs/ofetch/blob/main/src/utils.ts\nexport function isJSONSerializable(value: any) {\n\tif (value === undefined) {\n\t\treturn false;\n\t}\n\tconst t = typeof value;\n\tif (t === \"string\" || t === \"number\" || t === \"boolean\" || t === null) {\n\t\treturn true;\n\t}\n\tif (t !== \"object\") {\n\t\treturn false;\n\t}\n\tif (Array.isArray(value)) {\n\t\treturn true;\n\t}\n\tif (value.buffer) {\n\t\treturn false;\n\t}\n\treturn (\n\t\t(value.constructor && value.constructor.name === \"Object\") ||\n\t\ttypeof value.toJSON === \"function\"\n\t);\n}\n\nexport function jsonParse(text: string) {\n\ttry {\n\t\treturn JSON.parse(text);\n\t} catch (error) {\n\t\treturn text;\n\t}\n}\n\nexport function isFunction(value: any): value is () => any {\n\treturn typeof value === \"function\";\n}\n\nexport function getFetch(options?: BetterFetchOption): FetchEsque {\n\tif (options?.customFetchImpl) {\n\t\treturn options.customFetchImpl;\n\t}\n\tif (typeof globalThis !== \"undefined\" && isFunction(globalThis.fetch)) {\n\t\treturn globalThis.fetch;\n\t}\n\tif (typeof window !== \"undefined\" && isFunction(window.fetch)) {\n\t\treturn window.fetch;\n\t}\n\tthrow new Error(\"No fetch implementation found\");\n}\n\nexport function isPayloadMethod(method?: string) {\n\tif (!method) {\n\t\treturn false;\n\t}\n\tconst payloadMethod = [\"POST\", \"PUT\", \"PATCH\", \"DELETE\"];\n\treturn payloadMethod.includes(method.toUpperCase());\n}\n\nexport function isRouteMethod(method?: string) {\n\tconst routeMethod = [\"GET\", \"POST\", \"PUT\", \"PATCH\", \"DELETE\"];\n\tif (!method) {\n\t\treturn false;\n\t}\n\treturn routeMethod.includes(method.toUpperCase());\n}\n\nexport async function getHeaders(opts?: BetterFetchOption) {\n\tconst headers = new Headers(opts?.headers);\n\tconst authHeader = await getAuthHeader(opts);\n\tfor (const [key, value] of Object.entries(authHeader || {})) {\n\t\theaders.set(key, value);\n\t}\n\tif (!headers.has(\"content-type\")) {\n\t\tconst t = detectContentType(opts?.body);\n\t\tif (t) {\n\t\t\theaders.set(\"content-type\", t);\n\t\t}\n\t}\n\n\treturn headers;\n}\n\nexport function getURL(url: string, options?: BetterFetchOption) {\n\tif (url.startsWith(\"@\")) {\n\t\tconst m = url.toString().split(\"@\")[1].split(\"/\")[0];\n\t\tif (methods.includes(m)) {\n\t\t\turl = url.replace(`@${m}/`, \"/\");\n\t\t}\n\t}\n\tlet _url: string | URL;\n\ttry {\n\t\tif (url.startsWith(\"http\")) {\n\t\t\t_url = url;\n\t\t} else {\n\t\t\tlet baseURL = options?.baseURL;\n\t\t\tif (baseURL && !baseURL?.endsWith(\"/\")) {\n\t\t\t\tbaseURL = baseURL + \"/\";\n\t\t\t}\n\t\t\tif (url.startsWith(\"/\")) {\n\t\t\t\t_url = new URL(url.substring(1), baseURL);\n\t\t\t} else {\n\t\t\t\t_url = new URL(url, options?.baseURL);\n\t\t\t}\n\t\t}\n\t} catch (e) {\n\t\tif (e instanceof TypeError) {\n\t\t\tif (!options?.baseURL) {\n\t\t\t\tthrow TypeError(\n\t\t\t\t\t`Invalid URL ${url}. Are you passing in a relative url but not setting the baseURL?`,\n\t\t\t\t);\n\t\t\t}\n\t\t\tthrow TypeError(\n\t\t\t\t`Invalid URL ${url}. Please validate that you are passing the correct input.`,\n\t\t\t);\n\t\t}\n\t\tthrow e;\n\t}\n\n\t/**\n\t * Dynamic Parameters.\n\t */\n\tif (options?.params) {\n\t\tif (Array.isArray(options?.params)) {\n\t\t\tconst params = options?.params\n\t\t\t\t? Array.isArray(options.params)\n\t\t\t\t\t? `/${options.params.join(\"/\")}`\n\t\t\t\t\t: `/${Object.values(options.params).join(\"/\")}`\n\t\t\t\t: \"\";\n\t\t\t_url = _url.toString().split(\"/:\")[0];\n\t\t\t_url = `${_url.toString()}${params}`;\n\t\t} else {\n\t\t\tfor (const [key, value] of Object.entries(options?.params)) {\n\t\t\t\t_url = _url.toString().replace(`:${key}`, String(value));\n\t\t\t}\n\t\t}\n\t}\n\tconst __url = new URL(_url);\n\t/**\n\t * Query Parameters\n\t */\n\tconst queryParams = options?.query;\n\tif (queryParams) {\n\t\tfor (const [key, value] of Object.entries(queryParams)) {\n\t\t\t__url.searchParams.append(key, String(value));\n\t\t}\n\t}\n\treturn __url;\n}\n\nexport function detectContentType(body: any) {\n\tif (isJSONSerializable(body)) {\n\t\treturn \"application/json\";\n\t}\n\n\treturn null;\n}\n\nexport function getBody(options?: BetterFetchOption) {\n\tif (!options?.body) {\n\t\treturn null;\n\t}\n\tconst headers = new Headers(options?.headers);\n\tif (isJSONSerializable(options.body) && !headers.has(\"content-type\")) {\n\t\tfor (const [key, value] of Object.entries(options?.body)) {\n\t\t\tif (value instanceof Date) {\n\t\t\t\toptions.body[key] = value.toISOString();\n\t\t\t}\n\t\t}\n\t\treturn JSON.stringify(options.body);\n\t}\n\n\treturn options.body;\n}\n\nexport function getMethod(url: string, options?: BetterFetchOption) {\n\tif (options?.method) {\n\t\treturn options.method.toUpperCase();\n\t}\n\tif (url.startsWith(\"@\")) {\n\t\tconst pMethod = url.split(\"@\")[1]?.split(\"/\")[0];\n\t\tif (!methods.includes(pMethod)) {\n\t\t\treturn options?.body ? \"POST\" : \"GET\";\n\t\t}\n\t\treturn pMethod.toUpperCase();\n\t}\n\treturn options?.body ? \"POST\" : \"GET\";\n}\n\nexport function getTimeout(\n\toptions?: BetterFetchOption,\n\tcontroller?: AbortController,\n) {\n\tlet abortTimeout: ReturnType<typeof setTimeout> | undefined;\n\tif (!options?.signal && options?.timeout) {\n\t\tabortTimeout = setTimeout(() => controller?.abort(), options?.timeout);\n\t}\n\treturn {\n\t\tabortTimeout,\n\t\tclearTimeout: () => {\n\t\t\tif (abortTimeout) {\n\t\t\t\tclearTimeout(abortTimeout);\n\t\t\t}\n\t\t},\n\t};\n}\n\nexport function bodyParser(data: any, responseType: ResponseType) {\n\tif (responseType === \"json\") {\n\t\treturn JSON.parse(data);\n\t}\n\treturn data;\n}\n\nexport class ValidationError extends Error {\n\tpublic readonly issues: ReadonlyArray<StandardSchemaV1.Issue>;\n\n\tconstructor(issues: ReadonlyArray<StandardSchemaV1.Issue>, message?: string) {\n\t\t// Default message fallback in case one isn't supplied.\n\t\tsuper(message || JSON.stringify(issues, null, 2));\n\t\tthis.issues = issues;\n\n\t\t// Set the prototype explicitly to ensure that instanceof works correctly.\n\t\tObject.setPrototypeOf(this, ValidationError.prototype);\n\t}\n}\n\nexport async function parseStandardSchema<TSchema extends StandardSchemaV1>(\n\tschema: TSchema,\n\tinput: StandardSchemaV1.InferInput<TSchema>,\n): Promise<StandardSchemaV1.InferOutput<TSchema>> {\n\tlet result = await schema[\"~standard\"].validate(input);\n\n\tif (result.issues) {\n\t\tthrow new ValidationError(result.issues);\n\t}\n\treturn result.value;\n}\n","import type { BuildColumns } from '~/column-builder.ts';\nimport { entityKind, is } from '~/entity.ts';\nimport type { TypedQueryBuilder } from '~/query-builders/query-builder.ts';\nimport type { AddAliasToSelection } from '~/query-builders/select.types.ts';\nimport { SelectionProxyHandler } from '~/selection-proxy.ts';\nimport type { ColumnsSelection, SQL } from '~/sql/sql.ts';\nimport { getTableColumns } from '~/utils.ts';\nimport type { RequireAtLeastOne } from '~/utils.ts';\nimport type { PgColumn, PgColumnBuilderBase } from './columns/common.ts';\nimport { QueryBuilder } from './query-builders/query-builder.ts';\nimport { pgTable } from './table.ts';\nimport { PgViewBase } from './view-base.ts';\nimport { PgViewConfig } from './view-common.ts';\n\nexport type ViewWithConfig = RequireAtLeastOne<{\n\tcheckOption: 'local' | 'cascaded';\n\tsecurityBarrier: boolean;\n\tsecurityInvoker: boolean;\n}>;\n\nexport class DefaultViewBuilderCore<TConfig extends { name: string; columns?: unknown }> {\n\tstatic readonly [entityKind]: string = 'PgDefaultViewBuilderCore';\n\n\tdeclare readonly _: {\n\t\treadonly name: TConfig['name'];\n\t\treadonly columns: TConfig['columns'];\n\t};\n\n\tconstructor(\n\t\tprotected name: TConfig['name'],\n\t\tprotected schema: string | undefined,\n\t) {}\n\n\tprotected config: {\n\t\twith?: ViewWithConfig;\n\t} = {};\n\n\twith(config: ViewWithConfig): this {\n\t\tthis.config.with = config;\n\t\treturn this;\n\t}\n}\n\nexport class ViewBuilder<TName extends string = string> extends DefaultViewBuilderCore<{ name: TName }> {\n\tstatic override readonly [entityKind]: string = 'PgViewBuilder';\n\n\tas<TSelectedFields extends ColumnsSelection>(\n\t\tqb: TypedQueryBuilder<TSelectedFields> | ((qb: QueryBuilder) => TypedQueryBuilder<TSelectedFields>),\n\t): PgViewWithSelection<TName, false, AddAliasToSelection<TSelectedFields, TName, 'pg'>> {\n\t\tif (typeof qb === 'function') {\n\t\t\tqb = qb(new QueryBuilder());\n\t\t}\n\t\tconst selectionProxy = new SelectionProxyHandler<TSelectedFields>({\n\t\t\talias: this.name,\n\t\t\tsqlBehavior: 'error',\n\t\t\tsqlAliasedBehavior: 'alias',\n\t\t\treplaceOriginalName: true,\n\t\t});\n\t\tconst aliasedSelection = new Proxy(qb.getSelectedFields(), selectionProxy);\n\t\treturn new Proxy(\n\t\t\tnew PgView({\n\t\t\t\tpgConfig: this.config,\n\t\t\t\tconfig: {\n\t\t\t\t\tname: this.name,\n\t\t\t\t\tschema: this.schema,\n\t\t\t\t\tselectedFields: aliasedSelection,\n\t\t\t\t\tquery: qb.getSQL().inlineParams(),\n\t\t\t\t},\n\t\t\t}),\n\t\t\tselectionProxy as any,\n\t\t) as PgViewWithSelection<TName, false, AddAliasToSelection<TSelectedFields, TName, 'pg'>>;\n\t}\n}\n\nexport class ManualViewBuilder<\n\tTName extends string = string,\n\tTColumns extends Record<string, PgColumnBuilderBase> = Record<string, PgColumnBuilderBase>,\n> extends DefaultViewBuilderCore<{ name: TName; columns: TColumns }> {\n\tstatic override readonly [entityKind]: string = 'PgManualViewBuilder';\n\n\tprivate columns: Record<string, PgColumn>;\n\n\tconstructor(\n\t\tname: TName,\n\t\tcolumns: TColumns,\n\t\tschema: string | undefined,\n\t) {\n\t\tsuper(name, schema);\n\t\tthis.columns = getTableColumns(pgTable(name, columns));\n\t}\n\n\texisting(): PgViewWithSelection<TName, true, BuildColumns<TName, TColumns, 'pg'>> {\n\t\treturn new Proxy(\n\t\t\tnew PgView({\n\t\t\t\tpgConfig: undefined,\n\t\t\t\tconfig: {\n\t\t\t\t\tname: this.name,\n\t\t\t\t\tschema: this.schema,\n\t\t\t\t\tselectedFields: this.columns,\n\t\t\t\t\tquery: undefined,\n\t\t\t\t},\n\t\t\t}),\n\t\t\tnew SelectionProxyHandler({\n\t\t\t\talias: this.name,\n\t\t\t\tsqlBehavior: 'error',\n\t\t\t\tsqlAliasedBehavior: 'alias',\n\t\t\t\treplaceOriginalName: true,\n\t\t\t}),\n\t\t) as PgViewWithSelection<TName, true, BuildColumns<TName, TColumns, 'pg'>>;\n\t}\n\n\tas(query: SQL): PgViewWithSelection<TName, false, BuildColumns<TName, TColumns, 'pg'>> {\n\t\treturn new Proxy(\n\t\t\tnew PgView({\n\t\t\t\tpgConfig: this.config,\n\t\t\t\tconfig: {\n\t\t\t\t\tname: this.name,\n\t\t\t\t\tschema: this.schema,\n\t\t\t\t\tselectedFields: this.columns,\n\t\t\t\t\tquery: query.inlineParams(),\n\t\t\t\t},\n\t\t\t}),\n\t\t\tnew SelectionProxyHandler({\n\t\t\t\talias: this.name,\n\t\t\t\tsqlBehavior: 'error',\n\t\t\t\tsqlAliasedBehavior: 'alias',\n\t\t\t\treplaceOriginalName: true,\n\t\t\t}),\n\t\t) as PgViewWithSelection<TName, false, BuildColumns<TName, TColumns, 'pg'>>;\n\t}\n}\n\nexport type PgMaterializedViewWithConfig = RequireAtLeastOne<{\n\tfillfactor: number;\n\ttoastTupleTarget: number;\n\tparallelWorkers: number;\n\tautovacuumEnabled: boolean;\n\tvacuumIndexCleanup: 'auto' | 'off' | 'on';\n\tvacuumTruncate: boolean;\n\tautovacuumVacuumThreshold: number;\n\tautovacuumVacuumScaleFactor: number;\n\tautovacuumVacuumCostDelay: number;\n\tautovacuumVacuumCostLimit: number;\n\tautovacuumFreezeMinAge: number;\n\tautovacuumFreezeMaxAge: number;\n\tautovacuumFreezeTableAge: number;\n\tautovacuumMultixactFreezeMinAge: number;\n\tautovacuumMultixactFreezeMaxAge: number;\n\tautovacuumMultixactFreezeTableAge: number;\n\tlogAutovacuumMinDuration: number;\n\tuserCatalogTable: boolean;\n}>;\n\nexport class MaterializedViewBuilderCore<TConfig extends { name: string; columns?: unknown }> {\n\tstatic readonly [entityKind]: string = 'PgMaterializedViewBuilderCore';\n\n\tdeclare _: {\n\t\treadonly name: TConfig['name'];\n\t\treadonly columns: TConfig['columns'];\n\t};\n\n\tconstructor(\n\t\tprotected name: TConfig['name'],\n\t\tprotected schema: string | undefined,\n\t) {}\n\n\tprotected config: {\n\t\twith?: PgMaterializedViewWithConfig;\n\t\tusing?: string;\n\t\ttablespace?: string;\n\t\twithNoData?: boolean;\n\t} = {};\n\n\tusing(using: string): this {\n\t\tthis.config.using = using;\n\t\treturn this;\n\t}\n\n\twith(config: PgMaterializedViewWithConfig): this {\n\t\tthis.config.with = config;\n\t\treturn this;\n\t}\n\n\ttablespace(tablespace: string): this {\n\t\tthis.config.tablespace = tablespace;\n\t\treturn this;\n\t}\n\n\twithNoData(): this {\n\t\tthis.config.withNoData = true;\n\t\treturn this;\n\t}\n}\n\nexport class MaterializedViewBuilder<TName extends string = string>\n\textends MaterializedViewBuilderCore<{ name: TName }>\n{\n\tstatic override readonly [entityKind]: string = 'PgMaterializedViewBuilder';\n\n\tas<TSelectedFields extends ColumnsSelection>(\n\t\tqb: TypedQueryBuilder<TSelectedFields> | ((qb: QueryBuilder) => TypedQueryBuilder<TSelectedFields>),\n\t): PgMaterializedViewWithSelection<TName, false, AddAliasToSelection<TSelectedFields, TName, 'pg'>> {\n\t\tif (typeof qb === 'function') {\n\t\t\tqb = qb(new QueryBuilder());\n\t\t}\n\t\tconst selectionProxy = new SelectionProxyHandler<TSelectedFields>({\n\t\t\talias: this.name,\n\t\t\tsqlBehavior: 'error',\n\t\t\tsqlAliasedBehavior: 'alias',\n\t\t\treplaceOriginalName: true,\n\t\t});\n\t\tconst aliasedSelection = new Proxy(qb.getSelectedFields(), selectionProxy);\n\t\treturn new Proxy(\n\t\t\tnew PgMaterializedView({\n\t\t\t\tpgConfig: {\n\t\t\t\t\twith: this.config.with,\n\t\t\t\t\tusing: this.config.using,\n\t\t\t\t\ttablespace: this.config.tablespace,\n\t\t\t\t\twithNoData: this.config.withNoData,\n\t\t\t\t},\n\t\t\t\tconfig: {\n\t\t\t\t\tname: this.name,\n\t\t\t\t\tschema: this.schema,\n\t\t\t\t\tselectedFields: aliasedSelection,\n\t\t\t\t\tquery: qb.getSQL().inlineParams(),\n\t\t\t\t},\n\t\t\t}),\n\t\t\tselectionProxy as any,\n\t\t) as PgMaterializedViewWithSelection<TName, false, AddAliasToSelection<TSelectedFields, TName, 'pg'>>;\n\t}\n}\n\nexport class ManualMaterializedViewBuilder<\n\tTName extends string = string,\n\tTColumns extends Record<string, PgColumnBuilderBase> = Record<string, PgColumnBuilderBase>,\n> extends MaterializedViewBuilderCore<{ name: TName; columns: TColumns }> {\n\tstatic override readonly [entityKind]: string = 'PgManualMaterializedViewBuilder';\n\n\tprivate columns: Record<string, PgColumn>;\n\n\tconstructor(\n\t\tname: TName,\n\t\tcolumns: TColumns,\n\t\tschema: string | undefined,\n\t) {\n\t\tsuper(name, schema);\n\t\tthis.columns = getTableColumns(pgTable(name, columns));\n\t}\n\n\texisting(): PgMaterializedViewWithSelection<TName, true, BuildColumns<TName, TColumns, 'pg'>> {\n\t\treturn new Proxy(\n\t\t\tnew PgMaterializedView({\n\t\t\t\tpgConfig: {\n\t\t\t\t\ttablespace: this.config.tablespace,\n\t\t\t\t\tusing: this.config.using,\n\t\t\t\t\twith: this.config.with,\n\t\t\t\t\twithNoData: this.config.withNoData,\n\t\t\t\t},\n\t\t\t\tconfig: {\n\t\t\t\t\tname: this.name,\n\t\t\t\t\tschema: this.schema,\n\t\t\t\t\tselectedFields: this.columns,\n\t\t\t\t\tquery: undefined,\n\t\t\t\t},\n\t\t\t}),\n\t\t\tnew SelectionProxyHandler({\n\t\t\t\talias: this.name,\n\t\t\t\tsqlBehavior: 'error',\n\t\t\t\tsqlAliasedBehavior: 'alias',\n\t\t\t\treplaceOriginalName: true,\n\t\t\t}),\n\t\t) as PgMaterializedViewWithSelection<TName, true, BuildColumns<TName, TColumns, 'pg'>>;\n\t}\n\n\tas(query: SQL): PgMaterializedViewWithSelection<TName, false, BuildColumns<TName, TColumns, 'pg'>> {\n\t\treturn new Proxy(\n\t\t\tnew PgMaterializedView({\n\t\t\t\tpgConfig: {\n\t\t\t\t\ttablespace: this.config.tablespace,\n\t\t\t\t\tusing: this.config.using,\n\t\t\t\t\twith: this.config.with,\n\t\t\t\t\twithNoData: this.config.withNoData,\n\t\t\t\t},\n\t\t\t\tconfig: {\n\t\t\t\t\tname: this.name,\n\t\t\t\t\tschema: this.schema,\n\t\t\t\t\tselectedFields: this.columns,\n\t\t\t\t\tquery: query.inlineParams(),\n\t\t\t\t},\n\t\t\t}),\n\t\t\tnew SelectionProxyHandler({\n\t\t\t\talias: this.name,\n\t\t\t\tsqlBehavior: 'error',\n\t\t\t\tsqlAliasedBehavior: 'alias',\n\t\t\t\treplaceOriginalName: true,\n\t\t\t}),\n\t\t) as PgMaterializedViewWithSelection<TName, false, BuildColumns<TName, TColumns, 'pg'>>;\n\t}\n}\n\nexport class PgView<\n\tTName extends string = string,\n\tTExisting extends boolean = boolean,\n\tTSelectedFields extends ColumnsSelection = ColumnsSelection,\n> extends PgViewBase<TName, TExisting, TSelectedFields> {\n\tstatic override readonly [entityKind]: string = 'PgView';\n\n\t[PgViewConfig]: {\n\t\twith?: ViewWithConfig;\n\t} | undefined;\n\n\tconstructor({ pgConfig, config }: {\n\t\tpgConfig: {\n\t\t\twith?: ViewWithConfig;\n\t\t} | undefined;\n\t\tconfig: {\n\t\t\tname: TName;\n\t\t\tschema: string | undefined;\n\t\t\tselectedFields: ColumnsSelection;\n\t\t\tquery: SQL | undefined;\n\t\t};\n\t}) {\n\t\tsuper(config);\n\t\tif (pgConfig) {\n\t\t\tthis[PgViewConfig] = {\n\t\t\t\twith: pgConfig.with,\n\t\t\t};\n\t\t}\n\t}\n}\n\nexport type PgViewWithSelection<\n\tTName extends string = string,\n\tTExisting extends boolean = boolean,\n\tTSelectedFields extends ColumnsSelection = ColumnsSelection,\n> = PgView<TName, TExisting, TSelectedFields> & TSelectedFields;\n\nexport const PgMaterializedViewConfig = Symbol.for('drizzle:PgMaterializedViewConfig');\n\nexport class PgMaterializedView<\n\tTName extends string = string,\n\tTExisting extends boolean = boolean,\n\tTSelectedFields extends ColumnsSelection = ColumnsSelection,\n> extends PgViewBase<TName, TExisting, TSelectedFields> {\n\tstatic override readonly [entityKind]: string = 'PgMaterializedView';\n\n\treadonly [PgMaterializedViewConfig]: {\n\t\treadonly with?: PgMaterializedViewWithConfig;\n\t\treadonly using?: string;\n\t\treadonly tablespace?: string;\n\t\treadonly withNoData?: boolean;\n\t} | undefined;\n\n\tconstructor({ pgConfig, config }: {\n\t\tpgConfig: {\n\t\t\twith: PgMaterializedViewWithConfig | undefined;\n\t\t\tusing: string | undefined;\n\t\t\ttablespace: string | undefined;\n\t\t\twithNoData: boolean | undefined;\n\t\t} | undefined;\n\t\tconfig: {\n\t\t\tname: TName;\n\t\t\tschema: string | undefined;\n\t\t\tselectedFields: ColumnsSelection;\n\t\t\tquery: SQL | undefined;\n\t\t};\n\t}) {\n\t\tsuper(config);\n\t\tthis[PgMaterializedViewConfig] = {\n\t\t\twith: pgConfig?.with,\n\t\t\tusing: pgConfig?.using,\n\t\t\ttablespace: pgConfig?.tablespace,\n\t\t\twithNoData: pgConfig?.withNoData,\n\t\t};\n\t}\n}\n\nexport type PgMaterializedViewWithSelection<\n\tTName extends string = string,\n\tTExisting extends boolean = boolean,\n\tTSelectedFields extends ColumnsSelection = ColumnsSelection,\n> = PgMaterializedView<TName, TExisting, TSelectedFields> & TSelectedFields;\n\n/** @internal */\nexport function pgViewWithSchema(\n\tname: string,\n\tselection: Record<string, PgColumnBuilderBase> | undefined,\n\tschema: string | undefined,\n): ViewBuilder | ManualViewBuilder {\n\tif (selection) {\n\t\treturn new ManualViewBuilder(name, selection, schema);\n\t}\n\treturn new ViewBuilder(name, schema);\n}\n\n/** @internal */\nexport function pgMaterializedViewWithSchema(\n\tname: string,\n\tselection: Record<string, PgColumnBuilderBase> | undefined,\n\tschema: string | undefined,\n): MaterializedViewBuilder | ManualMaterializedViewBuilder {\n\tif (selection) {\n\t\treturn new ManualMaterializedViewBuilder(name, selection, schema);\n\t}\n\treturn new MaterializedViewBuilder(name, schema);\n}\n\nexport function pgView<TName extends string>(name: TName): ViewBuilder<TName>;\nexport function pgView<TName extends string, TColumns extends Record<string, PgColumnBuilderBase>>(\n\tname: TName,\n\tcolumns: TColumns,\n): ManualViewBuilder<TName, TColumns>;\nexport function pgView(name: string, columns?: Record<string, PgColumnBuilderBase>): ViewBuilder | ManualViewBuilder {\n\treturn pgViewWithSchema(name, columns, undefined);\n}\n\nexport function pgMaterializedView<TName extends string>(name: TName): MaterializedViewBuilder<TName>;\nexport function pgMaterializedView<TName extends string, TColumns extends Record<string, PgColumnBuilderBase>>(\n\tname: TName,\n\tcolumns: TColumns,\n): ManualMaterializedViewBuilder<TName, TColumns>;\nexport function pgMaterializedView(\n\tname: string,\n\tcolumns?: Record<string, PgColumnBuilderBase>,\n): MaterializedViewBuilder | ManualMaterializedViewBuilder {\n\treturn pgMaterializedViewWithSchema(name, columns, undefined);\n}\n\nexport function isPgView(obj: unknown): obj is PgView {\n\treturn is(obj, PgView);\n}\n\nexport function isPgMaterializedView(obj: unknown): obj is PgMaterializedView {\n\treturn is(obj, PgMaterializedView);\n}\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK"],"mappings":"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","ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,141,142,143,147,148,149,150,151,152,153,154,155,156,157,158,160,161,164,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,247,248]}