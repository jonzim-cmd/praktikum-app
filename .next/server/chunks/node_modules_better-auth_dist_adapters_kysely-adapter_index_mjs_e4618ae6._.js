module.exports=[69580,e=>{"use strict";var t=e.i(89695);e.i(96017),e.i(26863),e.i(59872),e.i(73625),e.i(18994);var l=e.i(48411),r=e.i(13031);let i=(e,t)=>{let i=null,n=e=>({getFieldName:l,schema:i,getDefaultFieldName:n,getDefaultModelName:a,getFieldAttributes:o,getModelName:s})=>{let u=e=>{let t=[],l=[];if(e)for(let[n,o]of Object.entries(e)){let e=i[a(n)]?.fields,[o,s]=n.includes(".")?n.split("."):[void 0,n];if(e)for(let[i,a]of(e.id={type:"string"},Object.entries(e)))t.push(r.sql`${r.sql.ref(`join_${s}`)}.${r.sql.ref(a.fieldName||i)} as ${r.sql.ref(`_joined_${s}_${a.fieldName||i}`)}`),l.push({joinModel:n,joinModelRef:s,fieldName:a.fieldName||i})}return{allSelectsStr:l,allSelects:t}},d=async(r,i,n,a)=>{if(t?.type==="mysql"){await i.execute();let t=r.id?"id":a.length>0&&a[0]?.field?a[0].field:"id";if(!r.id&&0===a.length)return await e.selectFrom(n).selectAll().orderBy(l({model:n,field:t}),"desc").limit(1).executeTakeFirst();let o=r[t]||a[0]?.value;return await e.selectFrom(n).selectAll().orderBy(l({model:n,field:t}),"desc").where(l({model:n,field:t}),"=",o).limit(1).executeTakeFirst()}return t?.type==="mssql"?await i.outputAll("inserted").executeTakeFirst():await i.returningAll().executeTakeFirst()};function f(e,t){if(!t)return{and:null,or:null};let r=[],i=[];return t.forEach(t=>{let{field:n,value:a,operator:o="=",connector:s="AND"}=t,u=l({model:e,field:n}),d=t=>{let l=`${e}.${u}`;return"in"===o.toLowerCase()?t(l,"in",Array.isArray(a)?a:[a]):"not_in"===o.toLowerCase()?t(l,"not in",Array.isArray(a)?a:[a]):"contains"===o?t(l,"like",`%${a}%`):"starts_with"===o?t(l,"like",`${a}%`):"ends_with"===o?t(l,"like",`%${a}`):t(l,"eq"===o?"=":"ne"===o?"<>":"gt"===o?">":"gte"===o?">=":"lt"===o?"<":"lte"===o?"<=":o,a)};"OR"===s?i.push(d):r.push(d)}),{and:r.length?r:null,or:i.length?i:null}}function c(e,t,r){if(!t||!e.length)return e;let i=new Map;for(let n of e){let e={},a={};for(let[e]of Object.entries(t))a[s(e)]={};for(let[t,i]of Object.entries(n)){let n=String(t),o=!1;for(let{joinModel:e,fieldName:t,joinModelRef:u}of r)if(n===`_joined_${u}_${t}`){a[s(e)][l({model:e,field:t})]=i,o=!0;break}o||(e[t]=i)}let o=e.id;if(!o)continue;if(!i.has(o)){let l={...e};for(let[e,r]of Object.entries(t))l[s(e)]="one-to-one"===r.relation?null:[];i.set(o,l)}let u=i.get(o);for(let[e,r]of Object.entries(t)){let t="one-to-one"===r.relation,i=r.limit??100,n=a[s(e)],o=n&&Object.keys(n).length>0&&Object.values(n).some(e=>null!=e);if(t)u[s(e)]=o?n:null;else{let t=s(e);if(Array.isArray(u[t])&&o){if(u[t].length>=i)continue;let r=l({model:e,field:"id"}),a=n[r];a?!u[t].some(e=>e[r]===a)&&u[t].length<i&&u[t].push(n):u[t].length<i&&u[t].push(n)}}}}let n=Array.from(i.values());for(let e of n)for(let[l,r]of Object.entries(t))if("one-to-one"!==r.relation){let t=s(l);if(Array.isArray(e[t])){let l=r.limit??100;e[t].length>l&&(e[t]=e[t].slice(0,l))}}return n}return{create:async({data:t,model:l})=>await d(t,e.insertInto(l).values(t),l,[]),async findOne({model:t,where:l,select:r,join:i}){let{and:n,or:a}=f(t,l),o=e.selectFrom(e=>{let l=e.selectFrom(t);return n&&(l=l.where(e=>e.and(n.map(t=>t(e))))),a&&(l=l.where(e=>e.or(a.map(t=>t(e))))),l.selectAll().as("primary")}).selectAll("primary");if(i)for(let[e,t]of Object.entries(i)){let[l,r]=e.includes(".")?e.split("."):[void 0,e];o=o.leftJoin(`${e} as join_${r}`,e=>e.onRef(`join_${r}.${t.on.to}`,"=",`primary.${t.on.from}`))}let{allSelectsStr:s,allSelects:d}=u(i);o=o.select(d);let p=await o.execute();if(!p||!Array.isArray(p)||0===p.length)return null;let y=p[0];return i?c(p,i,s)[0]:y},async findMany({model:r,where:i,limit:n,offset:a,sortBy:o,join:s}){let{and:d,or:p}=f(r,i),y=e.selectFrom(e=>{let i=e.selectFrom(r);return t?.type==="mssql"?void 0!==a?(o||(i=i.orderBy(l({model:r,field:"id"}))),i=i.offset(a).fetch(n||100)):void 0!==n&&(i=i.top(n)):(void 0!==n&&(i=i.limit(n)),void 0!==a&&(i=i.offset(a))),o?.field&&(i=i.orderBy(`${l({model:r,field:o.field})}`,o.direction)),d&&(i=i.where(e=>e.and(d.map(t=>t(e))))),p&&(i=i.where(e=>e.or(p.map(t=>t(e))))),i.selectAll().as("primary")}).selectAll("primary");if(s)for(let[e,t]of Object.entries(s)){let[l,r]=e.includes(".")?e.split("."):[void 0,e];y=y.leftJoin(`${e} as join_${r}`,e=>e.onRef(`join_${r}.${t.on.to}`,"=",`primary.${t.on.from}`))}let{allSelectsStr:m,allSelects:h}=u(s);y=y.select(h),o?.field&&(y=y.orderBy(`${l({model:r,field:o.field})}`,o.direction));let w=await y.execute();return w?s?c(w,s,m):w:[]},async update({model:t,where:l,update:r}){let{and:i,or:n}=f(t,l),a=e.updateTable(t).set(r);return i&&(a=a.where(e=>e.and(i.map(t=>t(e))))),n&&(a=a.where(e=>e.or(n.map(t=>t(e))))),await d(r,a,t,l)},async updateMany({model:t,where:l,update:r}){let{and:i,or:n}=f(t,l),a=e.updateTable(t).set(r);return i&&(a=a.where(e=>e.and(i.map(t=>t(e))))),n&&(a=a.where(e=>e.or(n.map(t=>t(e))))),(await a.execute()).length},async count({model:t,where:l}){let{and:r,or:i}=f(t,l),n=e.selectFrom(t).select(e.fn.count("id").as("count"));r&&(n=n.where(e=>e.and(r.map(t=>t(e))))),i&&(n=n.where(e=>e.or(i.map(t=>t(e)))));let a=await n.execute();return"number"==typeof a[0].count?a[0].count:"bigint"==typeof a[0].count?Number(a[0].count):parseInt(a[0].count)},async delete({model:t,where:l}){let{and:r,or:i}=f(t,l),n=e.deleteFrom(t);r&&(n=n.where(e=>e.and(r.map(t=>t(e))))),i&&(n=n.where(e=>e.or(i.map(t=>t(e))))),await n.execute()},async deleteMany({model:t,where:l}){let{and:r,or:i}=f(t,l),n=e.deleteFrom(t);return r&&(n=n.where(e=>e.and(r.map(t=>t(e))))),i&&(n=n.where(e=>e.or(i.map(t=>t(e))))),(await n.execute()).length},options:t}},a=null;a={config:{adapterId:"kysely",adapterName:"Kysely Adapter",usePlural:t?.usePlural,debugLogs:t?.debugLogs,supportsBooleans:t?.type!=="sqlite"&&t?.type!=="mssql"&&t?.type!=="mysql"&&!!t?.type,supportsDates:t?.type!=="sqlite"&&t?.type!=="mssql"&&!!t?.type,supportsJSON:!1,supportsUUIDs:t?.type==="postgres",transaction:!!t?.transaction&&(t=>e.transaction().execute(e=>t((0,l.t)({config:a.config,adapter:n(e)})(i))))},adapter:n(e)};let o=(0,l.t)(a);return e=>(i=e,o(e))};e.s(["kyselyAdapter",()=>i],85635),e.i(85635),e.s(["createKyselyAdapter",()=>t.t,"getKyselyDatabaseType",()=>t.n,"kyselyAdapter",()=>i],69580)}];

//# sourceMappingURL=node_modules_better-auth_dist_adapters_kysely-adapter_index_mjs_e4618ae6._.js.map