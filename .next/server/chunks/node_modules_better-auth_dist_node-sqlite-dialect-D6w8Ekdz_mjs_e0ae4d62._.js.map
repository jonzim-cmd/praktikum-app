{"version":3,"sources":["../../../node_modules/better-auth/dist/node-sqlite-dialect-D6w8Ekdz.mjs"],"sourcesContent":["import { CompiledQuery, DEFAULT_MIGRATION_LOCK_TABLE, DEFAULT_MIGRATION_TABLE, DefaultQueryCompiler, sql } from \"kysely\";\n\n//#region src/adapters/kysely-adapter/node-sqlite-dialect.ts\nvar NodeSqliteAdapter = class {\n\tget supportsCreateIfNotExists() {\n\t\treturn true;\n\t}\n\tget supportsTransactionalDdl() {\n\t\treturn false;\n\t}\n\tget supportsReturning() {\n\t\treturn true;\n\t}\n\tasync acquireMigrationLock() {}\n\tasync releaseMigrationLock() {}\n\tget supportsOutput() {\n\t\treturn true;\n\t}\n};\nvar NodeSqliteDriver = class {\n\t#config;\n\t#connectionMutex = new ConnectionMutex();\n\t#db;\n\t#connection;\n\tconstructor(config) {\n\t\tthis.#config = { ...config };\n\t}\n\tasync init() {\n\t\tthis.#db = this.#config.database;\n\t\tthis.#connection = new NodeSqliteConnection(this.#db);\n\t\tif (this.#config.onCreateConnection) await this.#config.onCreateConnection(this.#connection);\n\t}\n\tasync acquireConnection() {\n\t\tawait this.#connectionMutex.lock();\n\t\treturn this.#connection;\n\t}\n\tasync beginTransaction(connection) {\n\t\tawait connection.executeQuery(CompiledQuery.raw(\"begin\"));\n\t}\n\tasync commitTransaction(connection) {\n\t\tawait connection.executeQuery(CompiledQuery.raw(\"commit\"));\n\t}\n\tasync rollbackTransaction(connection) {\n\t\tawait connection.executeQuery(CompiledQuery.raw(\"rollback\"));\n\t}\n\tasync releaseConnection() {\n\t\tthis.#connectionMutex.unlock();\n\t}\n\tasync destroy() {\n\t\tthis.#db?.close();\n\t}\n};\nvar NodeSqliteConnection = class {\n\t#db;\n\tconstructor(db) {\n\t\tthis.#db = db;\n\t}\n\texecuteQuery(compiledQuery) {\n\t\tconst { sql: sql$1, parameters } = compiledQuery;\n\t\tconst rows = this.#db.prepare(sql$1).all(...parameters);\n\t\treturn Promise.resolve({ rows });\n\t}\n\tasync *streamQuery() {\n\t\tthrow new Error(\"Streaming query is not supported by SQLite driver.\");\n\t}\n};\nvar ConnectionMutex = class {\n\t#promise;\n\t#resolve;\n\tasync lock() {\n\t\twhile (this.#promise) await this.#promise;\n\t\tthis.#promise = new Promise((resolve) => {\n\t\t\tthis.#resolve = resolve;\n\t\t});\n\t}\n\tunlock() {\n\t\tconst resolve = this.#resolve;\n\t\tthis.#promise = void 0;\n\t\tthis.#resolve = void 0;\n\t\tresolve?.();\n\t}\n};\nvar NodeSqliteIntrospector = class {\n\t#db;\n\tconstructor(db) {\n\t\tthis.#db = db;\n\t}\n\tasync getSchemas() {\n\t\treturn [];\n\t}\n\tasync getTables(options = { withInternalKyselyTables: false }) {\n\t\tlet query = this.#db.selectFrom(\"sqlite_schema\").where(\"type\", \"=\", \"table\").where(\"name\", \"not like\", \"sqlite_%\").select(\"name\").$castTo();\n\t\tif (!options.withInternalKyselyTables) query = query.where(\"name\", \"!=\", DEFAULT_MIGRATION_TABLE).where(\"name\", \"!=\", DEFAULT_MIGRATION_LOCK_TABLE);\n\t\tconst tables = await query.execute();\n\t\treturn Promise.all(tables.map(({ name }) => this.#getTableMetadata(name)));\n\t}\n\tasync getMetadata(options) {\n\t\treturn { tables: await this.getTables(options) };\n\t}\n\tasync #getTableMetadata(table) {\n\t\tconst db = this.#db;\n\t\tconst autoIncrementCol = (await db.selectFrom(\"sqlite_master\").where(\"name\", \"=\", table).select(\"sql\").$castTo().execute())[0]?.sql?.split(/[\\(\\),]/)?.find((it) => it.toLowerCase().includes(\"autoincrement\"))?.split(/\\s+/)?.[0]?.replace(/[\"`]/g, \"\");\n\t\treturn {\n\t\t\tname: table,\n\t\t\tcolumns: (await db.selectFrom(sql`pragma_table_info(${table})`.as(\"table_info\")).select([\n\t\t\t\t\"name\",\n\t\t\t\t\"type\",\n\t\t\t\t\"notnull\",\n\t\t\t\t\"dflt_value\"\n\t\t\t]).execute()).map((col) => ({\n\t\t\t\tname: col.name,\n\t\t\t\tdataType: col.type,\n\t\t\t\tisNullable: !col.notnull,\n\t\t\t\tisAutoIncrementing: col.name === autoIncrementCol,\n\t\t\t\thasDefaultValue: col.dflt_value != null\n\t\t\t})),\n\t\t\tisView: true\n\t\t};\n\t}\n};\nvar NodeSqliteQueryCompiler = class extends DefaultQueryCompiler {\n\tgetCurrentParameterPlaceholder() {\n\t\treturn \"?\";\n\t}\n\tgetLeftIdentifierWrapper() {\n\t\treturn \"\\\"\";\n\t}\n\tgetRightIdentifierWrapper() {\n\t\treturn \"\\\"\";\n\t}\n\tgetAutoIncrement() {\n\t\treturn \"autoincrement\";\n\t}\n};\nvar NodeSqliteDialect = class {\n\t#config;\n\tconstructor(config) {\n\t\tthis.#config = { ...config };\n\t}\n\tcreateDriver() {\n\t\treturn new NodeSqliteDriver(this.#config);\n\t}\n\tcreateQueryCompiler() {\n\t\treturn new NodeSqliteQueryCompiler();\n\t}\n\tcreateAdapter() {\n\t\treturn new NodeSqliteAdapter();\n\t}\n\tcreateIntrospector(db) {\n\t\treturn new NodeSqliteIntrospector(db);\n\t}\n};\n\n//#endregion\nexport { NodeSqliteDialect };"],"names":[],"mappings":"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","ignoreList":[0]}